<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAS Connection Debugger</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .pending {
            background: #f0f0f0;
            border: 1px solid #ccc;
        }

        .success {
            background: #e6fffa;
            border: 1px solid #38b2ac;
            color: #234e52;
        }

        .error {
            background: #fff5f5;
            border: 1px solid #fc8181;
            color: #c53030;
        }

        code {
            background: #eee;
            padding: 2px 4px;
            border-radius: 4px;
            word-break: break-all;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #3182ce;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button:hover {
            background: #2c5282;
        }
    </style>
</head>

<body>
    <h1>Google Apps Script ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìŠ¤í¬ë¦½íŠ¸ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <div style="margin-bottom: 20px;">
        <strong>í…ŒìŠ¤íŠ¸ ëŒ€ìƒ URL:</strong><br>
        <code id="targetUrl"></code>
    </div>

    <button onclick="runTest()">í…ŒìŠ¤íŠ¸ ì‹œì‘ ì‹¤í–‰</button>

    <div id="results" style="margin-top: 30px;"></div>

    <script>
        // ì‚¬ìš©ìê°€ ì œê³µí•œ ìµœì‹  URL
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbx2tNwJpQQKx-0ZQTEjo9eRM646jYrjj8xJiOK8-_W4mgK0OLq5POf1nJF3h3u3Llns4Q/exec';

        document.getElementById('targetUrl').textContent = GAS_URL;

        async function runTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="status pending">í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</div>';

            try {
                // 1. POST í…ŒìŠ¤íŠ¸ (no-cors) - ì‹¤ì œ í¼ ì „ì†¡ ë°©ì‹
                log(resultsDiv, '1. POST ìš”ì²­ ì‹œë„ (mode: no-cors)...');
                const start = Date.now();

                await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: true, message: "Debug Test" })
                });

                log(resultsDiv, `âœ… POST ìš”ì²­ ì™„ë£Œ (ì†Œìš”ì‹œê°„: ${Date.now() - start}ms)`, 'success');
                log(resultsDiv, 'ğŸ‘‰ no-cors ëª¨ë“œëŠ” ì„±ê³µ ì—¬ë¶€ë¥¼ ì •í™•íˆ ì•Œ ìˆ˜ ì—†ì§€ë§Œ, ì—ëŸ¬ê°€ ì•ˆ ë‚¬ë‹¤ë©´ "ì „ì†¡ ì‹œë„"ëŠ” ì„±ê³µí•œ ê²ƒì…ë‹ˆë‹¤.');

                // 2. GET í…ŒìŠ¤íŠ¸ (cors í—ˆìš© ì—¬ë¶€ í™•ì¸ìš©, ë³´í†µì€ ì‹¤íŒ¨í•¨)
                log(resultsDiv, '2. GET ìš”ì²­ ì‹œë„ (ì¼ë°˜ ì ‘ì†)...');
                try {
                    const response = await fetch(GAS_URL + '?test=1');
                    if (response.ok) {
                        log(resultsDiv, `âœ… GET ìš”ì²­ ì„±ê³µ: ${response.status}`, 'success');
                    } else {
                        log(resultsDiv, `âš ï¸ GET ìš”ì²­ ì‘ë‹µ: ${response.status} ${response.statusText}`, 'error');
                        const text = await response.text();
                        if (text.includes("Google Drive")) {
                            log(resultsDiv, `ğŸš¨ ê²°ê³¼ê°€ "Google Drive" ì—ëŸ¬ í˜ì´ì§€ì…ë‹ˆë‹¤. URLì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`, 'error');
                        }
                    }
                } catch (e) {
                    log(resultsDiv, `âŒ GET ìš”ì²­ ì‹¤íŒ¨ (CORS ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜): ${e.message}`, 'error');
                }

            } catch (error) {
                log(resultsDiv, `âŒ ì¹˜ëª…ì  ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function log(container, message, type = '') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
    </script>
</body>

</html>