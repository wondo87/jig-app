<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê° ë°ì´í„° í•„ë“œ ì§„ë‹¨</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #0071e3;
            color: white;
        }
        .missing {
            background: #fff3cd;
        }
        .present {
            background: #d4edda;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>ğŸ” ê³ ê° ë°ì´í„° í•„ë“œ ì§„ë‹¨</h1>

    <div>
        <button onclick="loadAndAnalyze()">ê³ ê° ë°ì´í„° ë¶„ì„ ì‹œì‘</button>
    </div>

    <div id="status"></div>
    <div id="results"></div>

    <script src="admin_config.js"></script>
    <script>
        async function loadAndAnalyze() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            statusDiv.innerHTML = '<div class="status">ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...</div>';
            resultsDiv.innerHTML = '';

            try {
                // ê³ ê° ë°ì´í„° ë¡œë“œ
                const params = new URLSearchParams({
                    sheet: 'ê³ ê°ê´€ë¦¬_ê²¬ì ì„œ',
                    t: new Date().getTime()
                });

                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const customers = await response.json();

                statusDiv.innerHTML = `<div class="status success">âœ… ${customers.length}ëª…ì˜ ê³ ê° ë°ì´í„° ë¡œë“œ ì™„ë£Œ</div>`;

                // ì²« ë²ˆì§¸ ê³ ê° ë°ì´í„° ë¶„ì„
                if (customers.length === 0) {
                    resultsDiv.innerHTML = '<p>ê³ ê° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                const firstCustomer = customers[0];

                // HTMLì—ì„œ ê¸°ëŒ€í•˜ëŠ” í•„ë“œ ëª©ë¡
                const expectedFields = [
                    'clientName', 'clientPhone', 'spouseName', 'spousePhone',
                    'clientAddress', 'clientEmail', 'clientSource',
                    'projectName', 'siteAddress', 'area', 'buildingType',
                    'constructionPeriod', 'contractDate', 'warrantyPeriod',
                    'movingDate', 'finalPaymentDate', 'manager'
                ];

                // í…Œì´ë¸” ìƒì„±
                let html = '<h2>ì²« ë²ˆì§¸ ê³ ê° ë°ì´í„° ë¶„ì„</h2>';
                html += `<p><strong>ê³ ê° ID:</strong> ${firstCustomer.customerId}</p>`;
                html += '<table>';
                html += '<tr><th>í•„ë“œëª…</th><th>ë°ì´í„° ì¡´ì¬</th><th>ê°’</th></tr>';

                expectedFields.forEach(field => {
                    const hasData = firstCustomer.hasOwnProperty(field) && firstCustomer[field];
                    const rowClass = hasData ? 'present' : 'missing';
                    const value = firstCustomer[field] || '(ì—†ìŒ)';

                    html += `<tr class="${rowClass}">`;
                    html += `<td><code>${field}</code></td>`;
                    html += `<td>${hasData ? 'âœ…' : 'âŒ'}</td>`;
                    html += `<td>${value}</td>`;
                    html += '</tr>';
                });

                html += '</table>';

                // ì „ì²´ ë°ì´í„° êµ¬ì¡° ì¶œë ¥
                html += '<h2>ì „ì²´ ë°ì´í„° êµ¬ì¡° (JSON)</h2>';
                html += '<pre style="background: #f5f5f5; padding: 15px; overflow-x: auto;">';
                html += JSON.stringify(firstCustomer, null, 2);
                html += '</pre>';

                // ëª¨ë“  ê³ ê°ì˜ í•„ë“œ ì¡´ì¬ ì—¬ë¶€ í†µê³„
                html += '<h2>ì „ì²´ ê³ ê° í•„ë“œ í†µê³„</h2>';
                html += '<table>';
                html += '<tr><th>í•„ë“œëª…</th><th>ë°ì´í„° ìˆëŠ” ê³ ê° ìˆ˜</th><th>ë¹„ìœ¨</th></tr>';

                expectedFields.forEach(field => {
                    const count = customers.filter(c => c.hasOwnProperty(field) && c[field]).length;
                    const percentage = ((count / customers.length) * 100).toFixed(1);

                    html += '<tr>';
                    html += `<td><code>${field}</code></td>`;
                    html += `<td>${count} / ${customers.length}</td>`;
                    html += `<td>${percentage}%</td>`;
                    html += '</tr>';
                });

                html += '</table>';

                resultsDiv.innerHTML = html;

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
                console.error(error);
            }
        }
    </script>
</body>
</html>
