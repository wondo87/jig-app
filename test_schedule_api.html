<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ” ìŠ¤ì¼€ì¤„ API ì‘ë‹µ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: system-ui;
            padding: 40px;
            background: #f5f5f5;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            background: #34c759;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
        }
        button:hover {
            background: #2fb34a;
        }
        #result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        .success {
            color: #34c759;
            font-weight: bold;
        }
        .error {
            color: #ff3b30;
            font-weight: bold;
        }
        .info {
            color: #007aff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ API ì‘ë‹µ ë””ë²„ê¹…</h1>
    <p>Google Apps Scriptì—ì„œ ë°˜í™˜ë˜ëŠ” ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <button onclick="testAPI()">API í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button onclick="clearResult()" style="background:#ff3b30;">ì´ˆê¸°í™”</button>

    <div id="result">ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...</div>

    <script src="admin_config.js"></script>
    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            let output = '';

            output += '=' .repeat(80) + '\n';
            output += 'ğŸ“¡ API ìš”ì²­ ì‹œì‘...\n';
            output += '=' .repeat(80) + '\n\n';

            try {
                // 1. URL í™•ì¸
                output += `ğŸ”— API URL: ${CUSTOMER_SYNC_URL}\n\n`;

                // 2. ìš”ì²­ íŒŒë¼ë¯¸í„°
                const params = new URLSearchParams({
                    sheet: 'ê³µì‚¬ ìŠ¤ì¼€ì¤„ ê´€ë¦¬',
                    t: Date.now()
                });
                const fullURL = `${CUSTOMER_SYNC_URL}?${params}`;
                output += `ğŸ“‹ ì „ì²´ ìš”ì²­ URL:\n${fullURL}\n\n`;

                // 3. ìš”ì²­ ì „ì†¡
                output += 'â³ ìš”ì²­ ì „ì†¡ ì¤‘...\n';
                resultDiv.textContent = output;

                const startTime = Date.now();
                const response = await fetch(fullURL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const endTime = Date.now();

                output += `âœ… ì‘ë‹µ ë°›ìŒ (${endTime - startTime}ms)\n`;
                output += `ğŸ“Š HTTP Status: ${response.status} ${response.statusText}\n\n`;

                // 4. ì‘ë‹µ ë°ì´í„° íŒŒì‹±
                const data = await response.json();

                output += '=' .repeat(80) + '\n';
                output += 'ğŸ“¦ ì‘ë‹µ ë°ì´í„° ë¶„ì„\n';
                output += '=' .repeat(80) + '\n\n';

                // 5. ë°ì´í„° íƒ€ì… í™•ì¸
                output += `ğŸ” ë°ì´í„° íƒ€ì…: ${Array.isArray(data) ? 'Array' : typeof data}\n`;

                if (Array.isArray(data)) {
                    output += `ğŸ“Š ë°°ì—´ ê¸¸ì´: ${data.length}ê°œ í•­ëª©\n\n`;

                    if (data.length > 0) {
                        output += 'ğŸ”‘ ì²« ë²ˆì§¸ í•­ëª©ì˜ í•„ë“œ:\n';
                        const firstItem = data[0];
                        const fields = Object.keys(firstItem);
                        fields.forEach((field, idx) => {
                            output += `  ${idx + 1}. ${field}: ${JSON.stringify(firstItem[field])}\n`;
                        });
                        output += '\n';

                        // 6. ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ë°ì´í„°ì¸ì§€ í™•ì¸
                        const hasCategory = firstItem.hasOwnProperty('category');
                        const hasName = firstItem.hasOwnProperty('name');
                        const hasCheckPoint = firstItem.hasOwnProperty('checkPoint');

                        output += '=' .repeat(80) + '\n';
                        output += 'âœ… í•„ìˆ˜ í•„ë“œ ê²€ì¦\n';
                        output += '=' .repeat(80) + '\n\n';
                        output += `  category í•„ë“œ: ${hasCategory ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}\n`;
                        output += `  name í•„ë“œ: ${hasName ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}\n`;
                        output += `  checkPoint í•„ë“œ: ${hasCheckPoint ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}\n\n`;

                        if (hasCategory && hasName) {
                            output += 'âœ… ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ë°ì´í„° í˜•ì‹ í™•ì¸!\n\n';

                            // 7. ì¹´í…Œê³ ë¦¬ ë¶„ì„
                            const categories = [...new Set(data.map(item => item.category).filter(Boolean))];
                            output += `ğŸ“ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜: ${categories.length}ê°œ\n`;
                            output += 'ğŸ“‹ ì¹´í…Œê³ ë¦¬ ëª©ë¡:\n';
                            categories.forEach((cat, idx) => {
                                const count = data.filter(item => item.category === cat).length;
                                output += `  ${idx + 1}. ${cat} (${count}ê°œ ê³µì •)\n`;
                            });
                            output += '\n';

                            // 8. ì „ì²´ ë°ì´í„° ìƒ˜í”Œ (ì²˜ìŒ 5ê°œ)
                            output += '=' .repeat(80) + '\n';
                            output += 'ğŸ“‹ ë°ì´í„° ìƒ˜í”Œ (ì²˜ìŒ 5ê°œ í•­ëª©)\n';
                            output += '=' .repeat(80) + '\n\n';
                            data.slice(0, 5).forEach((item, idx) => {
                                output += `${idx + 1}. ì¹´í…Œê³ ë¦¬: ${item.category || 'N/A'}\n`;
                                output += `   ê³µì •ëª…: ${item.name || 'N/A'}\n`;
                                output += `   ì²´í¬í¬ì¸íŠ¸: ${item.checkPoint || 'N/A'}\n`;
                                output += `   ë‹´ë‹¹ì: ${item.inCharge || 'N/A'}\n`;
                                output += '\n';
                            });

                        } else {
                            output += 'âŒ ê²½ê³ : ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤!\n';
                            output += 'í˜„ì¬ ë°ì´í„°ëŠ” ë‹¤ë¥¸ ì‹œíŠ¸ì˜ ë°ì´í„°ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\n';

                            output += 'ğŸ” ì‹¤ì œ ë°›ì€ ë°ì´í„° êµ¬ì¡°:\n';
                            output += JSON.stringify(firstItem, null, 2) + '\n\n';
                        }

                    } else {
                        output += 'âš ï¸ ë°°ì—´ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\n\n';
                    }

                } else {
                    output += 'âŒ ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.\n';
                    output += 'ğŸ” ì‹¤ì œ ì‘ë‹µ:\n';
                    output += JSON.stringify(data, null, 2) + '\n\n';
                }

                // 9. ì „ì²´ JSON ì¶œë ¥
                output += '=' .repeat(80) + '\n';
                output += 'ğŸ“„ ì „ì²´ ì‘ë‹µ ë°ì´í„° (JSON)\n';
                output += '=' .repeat(80) + '\n\n';
                output += JSON.stringify(data, null, 2);

                resultDiv.textContent = output;

            } catch (error) {
                output += '\n\n';
                output += '=' .repeat(80) + '\n';
                output += 'âŒ ì˜¤ë¥˜ ë°œìƒ\n';
                output += '=' .repeat(80) + '\n\n';
                output += `ì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}\n`;
                output += `ì˜¤ë¥˜ ìŠ¤íƒ:\n${error.stack}\n`;

                resultDiv.textContent = output;
                console.error('âŒ API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        function clearResult() {
            document.getElementById('result').textContent = 'ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...';
        }
    </script>
</body>
</html>
