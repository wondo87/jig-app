<!DOCTYPE html>
<!-- Deployed: 2026-02-07 17:55 - Fix specific deployment issue -->
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎîîÏûêÏù∏ÏßÄÍ∑∏ ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png?v=final_orig_file">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png?v=final_orig_file">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png?v=final_orig_file">
    <meta name="theme-color" content="#1d1d1f">
    <!-- Cache Version: dz-admin-v1.2.0 (2026-02-10) -->
    <script>
        console.log('üöÄ [System] Version: v1.2.0 (2026-02-10)');
        // CORS mitigation for file:// protocol
        if (window.location.protocol === 'file:') {
            console.warn('‚ö†Ô∏è [System] Local file protocol detected. Some features (Manifest, SW) are disabled to prevent CORS errors.');
        } else {
            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = 'manifest.json?v=final_orig_file';
            document.head.appendChild(link);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"
        onerror="console.warn('Cloudinary widget failed to load')"></script>
    <!-- ÌôòÍ≤Ω ÏÑ§Ï†ï ÌååÏùº Î°úÎìú (ÎπÑÎ∞ÄÎ≤àÌò∏ Îì±) -->
    <script src="admin_config.js?v=20260130"></script>

    <script>
        (function () {
            // ÌéòÏù¥ÏßÄÎäî Ïó¥Îûå Î™®ÎìúÎ°ú Î≥º Ïàò ÏûàÏùå
            // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ÏùÄ Ìó§ÎçîÏùò Î°úÍ∑∏Ïù∏ Î≤ÑÌäº ÌÜµÌï¥ ÏßÑÌñâ
            sessionStorage.setItem('DJ_admin_page_auth', 'true');

            // [Mobile Redirect]
            // Î™®Î∞îÏùº Í∏∞Í∏∞Î°ú Ï†ëÏÜç Ïãú Î™®Î∞îÏùº Ï†ÑÏö© ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ (Îã®, ?desktop=true ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞)
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const urlParams = new URLSearchParams(window.location.search);
            const isDesktopMode = urlParams.get('desktop') === 'true';

            if (isMobile && !isDesktopMode && window.innerWidth <= 768) {
                const currentPath = window.location.pathname;
                // VercelÏóêÏÑú /adminwonpro Í≤ΩÎ°úÎ°ú Ï†ëÍ∑º ÏãúÏóêÎèÑ Î¶¨Îã§Ïù¥Î†âÌä∏
                if (currentPath.endsWith('adminwonpro.html') || currentPath.endsWith('adminwonpro') || currentPath === '/') {
                    // Î£®Ìä∏ Í≤ΩÎ°úÏù∏ Í≤ΩÏö∞, Î©îÏù∏ ÌéòÏù¥ÏßÄÍ∞Ä adminwonproÎùºÎ©¥ Î¶¨Îã§Ïù¥Î†âÌä∏ (ÏÉÅÌô©Ïóê Îî∞Îùº Îã§Î¶Ñ)
                    // Ïó¨Í∏∞ÏÑúÎäî Î™ÖÏãúÏ†ÅÏúºÎ°ú adminwonpro Í¥ÄÎ†® Ï†ëÍ∑ºÎßå Ï≤òÎ¶¨
                }

                // Îçî Í∞ïÎ†•Ìïú Î¶¨Îã§Ïù¥Î†âÌä∏ Ï°∞Í±¥: ÌòÑÏû¨ ÌååÏùºÏù¥ Îç∞Ïä§ÌÅ¨ÌÉë Î∑∞Ïù∏Îç∞ Î™®Î∞îÏùº ÌôòÍ≤ΩÏù¥Î©¥ Î¨¥Ï°∞Í±¥ Ïù¥Îèô
                window.location.href = 'adminwonpro_mobile.html' + window.location.search;
            }
        })();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --font-size-base: 12px;
            --font-size-xs: calc(var(--font-size-base) * 0.75);
            --font-size-sm: calc(var(--font-size-base) * 0.85);
            --font-size-md: var(--font-size-base);
            --font-size-lg: calc(var(--font-size-base) * 1.15);
            --font-size-xl: calc(var(--font-size-base) * 1.35);
            --font-size-2xl: calc(var(--font-size-base) * 1.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            /* Í≥†Ï†ï Ìó§Îçî ÎÜíÏù¥ÎßåÌÅº ÏÉÅÎã® Ïó¨Î∞± Ï∂îÍ∞Ä. Ìó§Îçî ÎÜíÏù¥(ÏïΩ 56px) + Ïó¨Ïú† */
            padding-top: 56px;
        }

        /* Vercel Toolbar Ïà®ÍπÄ */
        #__next-build-watcher,
        [data-vercel-toolbar],
        [class*="vercel-toolbar"],
        [id*="vercel-toolbar"] {
            display: none !important;
        }

        /* ‚öôÔ∏è ÏÑ§Ï†ï ÎìúÎ°≠Îã§Ïö¥ Ìå®ÎÑê */
        .settings-toggle-btn {
            background: rgba(255, 255, 255, 0.12);
            border: none;
            color: #fff;
            font-size: 16px;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .settings-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.22);
        }

        .settings-panel {
            display: none !important;
            visibility: hidden;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 6px;
            background: #1d1d1f;
            border-radius: 12px;
            padding: 14px 16px;
            min-width: 260px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 9999;
        }

        .settings-panel.show {
            display: block !important;
            visibility: visible;
        }

        .settings-panel .sp-title {
            color: #86868b;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .settings-panel .sp-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .settings-panel .sp-row label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            min-width: 36px;
            white-space: nowrap;
        }

        .settings-panel .sp-row input[type="range"] {
            flex: 1;
            height: 3px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .settings-panel .sp-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #0071e3;
            border-radius: 50%;
            cursor: pointer;
        }

        .settings-panel .sp-val {
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            min-width: 28px;
            text-align: right;
        }

        .settings-panel .sp-divider {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 10px 0;
        }

        .settings-panel .sp-format-row {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .settings-panel .sp-format-row button {
            border: none;
            background: rgba(255, 255, 255, 0.08);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            line-height: 1;
            transition: background 0.15s;
        }

        .settings-panel .sp-format-row button:hover {
            background: rgba(255, 255, 255, 0.18);
        }

        .fmt-bold {
            color: #fff !important;
            font-weight: 900 !important;
        }

        .fmt-red {
            color: #ff3b30 !important;
        }

        .fmt-blue {
            color: #007aff !important;
        }

        .fmt-orange {
            color: #ff9500 !important;
        }

        .fmt-underline {
            color: #fff !important;
            text-decoration: underline !important;
        }

        .fmt-strike {
            color: #fff !important;
            text-decoration: line-through !important;
        }

        .fmt-italic {
            color: #fff !important;
            font-style: italic !important;
        }

        .fmt-black {
            color: #000 !important;
            background: #fff !important;
            border: 1px solid #999 !important;
        }

        .fmt-clear {
            color: #ff3b30 !important;
            font-weight: bold;
        }

        /* ÌÖçÏä§Ìä∏ ÏÑúÏãù ÌîåÎ°úÌåÖ Ìà¥Î∞î (ÎìúÎûòÍ∑∏ ÏÑ†ÌÉù Ïãú) */
        .text-format-toolbar {
            display: none;
            visibility: hidden;
            position: fixed;
            background: #1d1d1f;
            border-radius: 8px;
            padding: 4px 6px;
            gap: 2px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            align-items: center;
        }

        .text-format-toolbar.show {
            display: flex;
            visibility: visible;
        }

        .text-format-toolbar button {
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 700;
            line-height: 1;
            transition: background 0.15s;
        }

        .text-format-toolbar button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1d1d1f;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            z-index: 9999;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: #34c759;
        }

        .toast.error {
            background: #ff3b30;
        }

        .toast.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.85;
                transform: scale(1.02);
            }
        }

        /* Ìó§Îçî */
        .main-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
            padding: 12px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 12px;
        }

        .logo-text {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }

        .logo-text span {
            color: #86868b;
            font-weight: 400;
            font-size: 11px;
            margin-left: 6px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 7px 14px;
            border-radius: 6px;
            border: none;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-btn.primary {
            background: #0071e3;
            color: #fff;
        }

        .header-btn.primary:hover {
            background: #0077ed;
        }

        .header-btn.warning {
            background: #ff9500;
            color: #fff;
        }

        .header-btn.warning:hover {
            background: #ffaa33;
        }

        .header-btn.secondary {
            background: #424245;
            color: #fff;
        }

        .header-btn.secondary:hover {
            background: #525255;
        }

        /* Í¥ÄÎ¶¨Ïûê Î™®Îìú */
        .admin-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 12px;
        }

        .admin-badge.admin {
            background: linear-gradient(135deg, #ff9500, #ff6b00);
            color: #fff;
        }

        .admin-badge.viewer {
            background: #e8e8ed;
            color: #86868b;
        }

        .admin-login-btn {
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-login-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Î™®Î∞îÏùº PWA ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            body {
                padding-top: calc(56px + env(safe-area-inset-top));
                padding-bottom: env(safe-area-inset-bottom);
            }

            .main-header {
                padding: 12px 16px;
                padding-top: calc(12px + env(safe-area-inset-top));
            }

            /* Î≤ÑÌäº ÌÑ∞Ïπò ÏòÅÏó≠ 44px Ïù¥ÏÉÅ ÌôïÎ≥¥ */
            button,
            .header-btn,
            .tab-btn {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
            }

            /* ÌÖåÏù¥Î∏î Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ */
            .tab-content,
            .table-container,
            .data-table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
            }

            table {
                min-width: 800px;
            }

            /* Toast ÏúÑÏπò Ï°∞Ï†ï (Safe Area) */
            .toast {
                top: calc(20px + env(safe-area-inset-top));
                left: 20px;
                right: 20px;
                width: auto;
                justify-content: center;
            }
        }

        /* Í¥ÄÎ¶¨Ïûê Î™®Îã¨ */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .admin-modal.show {
            display: flex;
        }

        /* Ìú¥ÏßÄÌÜµ Î™®Îã¨ */
        .trash-modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 14px;
            width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .trash-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #e8e8ed;
            border-radius: 8px;
            margin: 16px 0;
        }

        .trash-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f5f5f7;
        }

        .trash-item:last-child {
            border-bottom: none;
        }

        .trash-actions {
            display: flex;
            gap: 8px;
        }

        /* Ï†ëÍ∑º Ï†úÌïú Ïò§Î≤ÑÎ†àÏù¥ (Í≥†Í∞ùÎ≥Ñ) */
        .access-denied-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 500;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .admin-modal-content {
            background: #fff;
            border-radius: 16px;
            padding: 32px;
            width: 320px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .admin-modal-content h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #1d1d1f;
        }

        .admin-modal-content p {
            font-size: 12px;
            color: #86868b;
            margin-bottom: 20px;
        }

        .admin-modal-content input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            margin-bottom: 16px;
        }

        .admin-modal-content input:focus {
            outline: none;
            border-color: #0071e3;
        }

        .admin-modal-btns {
            display: flex;
            gap: 8px;
        }

        .admin-modal-btns button {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .admin-modal-btns .cancel-btn {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .admin-modal-btns .confirm-btn {
            background: #0071e3;
            color: #fff;
        }

        /* ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïû†Í∏à ÏÉÅÌÉú */
        .cost-locked .data-table input,
        .cost-locked .data-table select,
        .cost-locked .data-table textarea,
        .cost-locked .category-memo textarea {
            pointer-events: none;
            background: #f5f5f7 !important;
            color: #86868b;
        }

        .cost-locked .add-row-btn {
            display: none;
        }

        .cost-lock-overlay {
            background: linear-gradient(135deg, #fff5e6, #fff);
            border: 1px solid #ffcc80;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .cost-lock-overlay .lock-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #e65100;
        }

        /* =========================================
           Î∏îÎ°ù ÌòïÌÉú ÎåÄÏãúÎ≥¥Îìú (Dashboard) Ïä§ÌÉÄÏùº
           ========================================= */
        /* ------------------------------------------------------------------
         * MAIN BOARD (LANDING PAGE)
         * ------------------------------------------------------------------ */
        .main-board-wrapper {
            padding: 40px;
            background: #fbfbfd;
            height: 100%;
            overflow-y: auto;
        }

        .main-board-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 20px;
        }

        .main-board-header h1 {
            font-size: 26px;
            font-weight: 800;
            color: #1d1d1f;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .main-board-stats {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .board-filter-select {
            padding: 10px 14px;
            border: 1px solid #e2e2e7;
            border-radius: 12px;
            font-size: 13px;
            color: #1d1d1f;
            background: #fff;
            outline: none;
            cursor: pointer;
            transition: all 0.2s;
            height: 48px;
            font-weight: 500;
        }

        .board-filter-select:hover {
            border-color: #d2d2d7;
            background: #fdfdfd;
        }

        .board-stat-item {
            background: #fff;
            padding: 0 20px;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 110px;
            height: 48px;
            border: 1px solid rgba(0, 0, 0, 0.02);
            transition: transform 0.2s;
        }

        .board-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .board-stat-label {
            font-size: 10px;
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 2px;
        }

        .board-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1d1d1f;
            line-height: 1;
        }

        .main-board-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .project-card {
            background: #fff;
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.02);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
        }

        .project-card-header {
            margin-bottom: 12px;
        }

        .project-card-title {
            font-size: 18px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .project-card-client {
            font-size: 14px;
            color: #86868b;
            font-weight: 500;
        }

        .project-card-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 12px;
        }

        /* Status Colors */
        .status-consulting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-estimate {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-contracted {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status-in_progress {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .status-completed {
            background: #f5f5f7;
            color: #424245;
        }

        .project-card-footer {
            margin-top: 20px;
            border-top: 1px solid #f5f5f7;
            padding-top: 12px;
            font-size: 12px;
            color: #86868b;
            display: flex;
            justify-content: space-between;
        }

        .dashboard-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .dashboard-card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            position: relative;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .dashboard-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 1. ÌîÑÎ°úÌïÑ Ïπ¥Îìú */
        .card-profile {
            grid-column: span 5;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #0071e3, #42a5f5);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
        }

        .profile-info h2 {
            font-size: 20px;
            margin-bottom: 4px;
            color: #1d1d1f;
        }

        .profile-info p {
            font-size: 12px;
            color: #86868b;
        }

        .profile-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 13px;
        }

        .profile-detail-item {
            background: #f5f5f7;
            padding: 10px 12px;
            border-radius: 8px;
        }

        .profile-detail-label {
            font-size: 11px;
            color: #86868b;
            margin-bottom: 4px;
        }

        .profile-detail-value {
            font-weight: 600;
            color: #1d1d1f;
        }

        /* 2. ÏÉÅÌÉú/ÏùºÏ†ï Ïπ¥Îìú */
        .card-status {
            grid-column: span 7;
        }

        .status-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            position: relative;
        }

        /* ÌÉÄÏûÑÎùºÏù∏ Î∞î */
        .timeline-bar {
            position: absolute;
            top: 24px;
            /* dot center */
            left: 0;
            right: 0;
            height: 4px;
            background: #e5e5e5;
            z-index: 1;
        }

        .timeline-progress {
            position: absolute;
            top: 24px;
            left: 0;
            height: 4px;
            background: #0071e3;
            z-index: 2;
            width: 0%;
            /* JSÎ°ú Ï†úÏñ¥ */
        }

        .timeline-step {
            position: relative;
            z-index: 3;
            text-align: center;
            flex: 1;
        }

        .timeline-dot {
            width: 12px;
            height: 12px;
            background: #fff;
            border: 3px solid #e5e5e5;
            border-radius: 50%;
            margin: 18px auto 8px;
            /* Î∞î ÏúÑÏπò Î≥¥Ï†ï */
            transition: all 0.3s;
        }

        .timeline-step.active .timeline-dot {
            border-color: #0071e3;
            background: #0071e3;
            transform: scale(1.2);
        }

        .timeline-label {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        .timeline-step.active .timeline-label {
            color: #0071e3;
            font-weight: 700;
        }

        .d-day-badge {
            display: inline-block;
            background: #ff3b30;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-left: auto;
        }

        /* 3. ÏõêÍ∞Ä/Ï†ïÏÇ∞ ÏöîÏïΩ (ÌïµÏã¨) -> ÌÅ¥Î¶≠ Ïãú ÏõêÍ∞Ä ÏÉÅÏÑ∏Î°ú Ïù¥Îèô */
        .card-cost-summary {
            grid-column: span 12;
            background: linear-gradient(135deg, #1d1d1f 0%, #2c2c2e 100%);
            color: white;
            cursor: pointer;
            border: none;
        }

        .card-cost-summary h3 {
            color: white;
        }

        .cost-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 10px;
        }

        .cost-stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .cost-stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .cost-stat-value {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .cost-stat-item.profit .cost-stat-value {
            color: #34c759;
        }

        /* 4. ÌÄµ Î©îÎâ¥ Í∑∏Î¶¨Îìú (Navigation) */
        .card-nav {
            grid-column: span 12;
            padding: 0;
            /* ÎÇ¥Î∂Ä Í∑∏Î¶¨Îìú Ìå®Îî© ÏÇ¨Ïö© */
            background: transparent;
            box-shadow: none;
            border: none;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
        }

        .nav-btn {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
            border-color: #0071e3;
        }

        .nav-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .nav-sub {
            font-size: 10px;
            color: #86868b;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 900px) {
            .card-profile {
                grid-column: span 12;
            }

            .card-status {
                grid-column: span 12;
            }

            .cost-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .cost-lock-overlay .unlock-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            background: #ff9500;
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
        }

        .cost-lock-overlay .unlock-btn:hover {
            background: #e68600;
        }

        /* ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω */
        .settings-section {
            margin-top: 16px;
            padding: 16px;
            background: #f9f9fb;
            border-radius: 8px;
        }

        .settings-section h4 {
            font-size: 12px;
            color: #1d1d1f;
            margin-bottom: 12px;
        }

        .settings-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .settings-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 12px;
        }

        .settings-row button {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            background: #0071e3;
            color: #fff;
            font-size: 11px;
            cursor: pointer;
        }

        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ */
        .main-layout {
            display: flex;
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î */
        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e8e8ed;
            /* [New] Fixed height and scrollable content */
            height: 100vh;
            position: sticky;
            top: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Prevent sidebar itself from scrolling */
        }

        .sidebar-header {
            padding: 14px 16px;
            border-bottom: 1px solid #e8e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            /* Header stays fixed */
        }

        .sidebar-header h3 {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .sidebar-search {
            padding: 10px 14px;
            border-bottom: 1px solid #e8e8ed;
            flex-shrink: 0;
        }

        .sidebar-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e8e8ed;
            border-radius: 6px;
            font-size: 12px;
        }

        .sidebar-search input:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ÎÖÑ/Ïõî ÌïÑÌÑ∞ */
        .date-filter {
            padding: 10px 14px;
            border-bottom: 1px solid #e8e8ed;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .date-filter select {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 11px;
            background: #fff;
            cursor: pointer;
        }

        .date-filter select:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ÏÉÅÌÉú ÌïÑÌÑ∞ */
        .status-filter {
            padding: 8px 14px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            flex-shrink: 0;
        }

        .filter-btn {
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid #e8e8ed;
            background: #fff;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: #f5f5f7;
        }

        .filter-btn.active {
            background: #0071e3;
            color: #fff;
            border-color: #0071e3;
        }

        /* [New] Scrollable Customer List */
        .customer-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            /* Important for firefox/flex */
        }

        .customer-item {
            padding: 12px 14px;
            margin: 8px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .customer-item:hover {
            background: #f9f9fb;
            border-color: #d2d2d7;
        }

        .customer-item.active {
            background: #e6f9ed !important;
            /* Green tint */
            border: 2px solid #34c759 !important;
            /* Green border */
        }

        .customer-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .customer-item-id {
            font-size: 10px;
            font-weight: 600;
            color: #0071e3;
        }

        .customer-item-name {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .customer-item-info {
            font-size: 10px;
            color: #86868b;
            line-height: 1.35;
            word-break: keep-all;
            /* ÌïúÍ∏Ä Îã®Ïñ¥ Îã®ÏúÑ Ï§ÑÎ∞îÍøà */
            overflow-wrap: anywhere;
            /* Í∏¥ Ï£ºÏÜå Í∞ïÏ†ú Ï§ÑÎ∞îÍøà */
        }

        .customer-item-creator {
            font-size: 9px;
            color: #a0a0a5;
            margin-top: 4px;
        }

        /* ÏÉÅÌÉú Î±ÉÏßÄ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
        }

        .status-badge.consulting {
            background: #fff3e0;
            color: #ff9500;
        }

        .status-badge.estimate {
            background: #e3f2fd;
            color: #2196f3;
        }

        .status-badge.hold {
            background: #f5f5f7;
            color: #8e8e93;
        }

        .status-badge.budget_over {
            background: #ffebee;
            color: #ff3b30;
        }

        .status-badge.other_company {
            background: #f3e5f5;
            color: #5856d6;
        }

        .status-badge.contracted {
            background: #e8f5e9;
            color: #34c759;
        }

        .status-badge.in_progress {
            background: #fff3e0;
            color: #ff9500;
        }

        .status-badge.completed {
            background: #e8f5e9;
            color: #30d158;
        }

        .status-badge.as_done {
            background: #e0f7fa;
            color: #00c7be;
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
        .main-content {
            flex: 1;
            overflow: visible !important;
            /* Sticky ÎèôÏûëÏùÑ ÏúÑÌï¥ ÌïÑÏàò */
            background: #f5f5f7;
        }

        #mainContent {
            overflow: visible !important;
        }

        /* Í≥†Í∞ù ÏÉÅÏÑ∏ Ìó§Îçî */
        .customer-header-bar {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            padding: 10px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Ìó§Îçî Í≥†Ï†ï (Sticky) */
            position: sticky;
            top: 56px;
            /* Î©îÏù∏ Ìó§Îçî ÎÜíÏù¥ÎßåÌÅº ÎùÑÏõÄ. Ï°∞Í∏à Í≤πÏ≥ê Î≥¥Ïù¥Í±∞ÎÇò Í∞ÑÍ≤© Ï°∞Ï†ï ÌïÑÏöîÏãú Ïà´Ïûê Î≥ÄÍ≤Ω */
            z-index: 99;
        }

        .customer-header-left h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .customer-header-left .customer-id-display {
            font-size: 11px;
            opacity: 0.8;
        }

        .customer-header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .status-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
        }

        .status-select option {
            color: #1d1d1f;
        }

        .as-date-input {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 11px;
            width: 120px;
        }

        .as-date-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .delete-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 59, 48, 0.8);
            color: #fff;
            font-size: 11px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #ff3b30;
        }

        /* Í≥†Í∞ù ÎÇ¥Î∂Ä ÌÉ≠ */
        .customer-tabs {
            background: #fff;
            border-bottom: 1px solid #e8e8ed;
            padding: 0 28px;
            display: flex;
            gap: 2px;
        }

        .customer-tab {
            padding: 12px 16px;
            background: transparent;
            border: none;
            color: #86868b;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .customer-tab:hover {
            color: #1d1d1f;
        }

        .customer-tab.active {
            color: #0071e3;
            border-bottom-color: #0071e3;
        }

        /* ÌÉ≠ Ìå®ÎÑê */
        .tab-panel {
            display: none;
            padding: 24px 28px;
        }

        .tab-panel.active {
            display: block;
        }

        /* Îπà ÏÉÅÌÉú */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #86868b;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #1d1d1f;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 13px;
            margin-bottom: 20px;
        }

        /* Î≤ÑÌäº */
        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-primary {
            background: #0071e3;
            color: #fff;
        }

        .btn-primary:hover {
            background: #0077ed;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 11px;
        }

        /* ÏÑπÏÖò */
        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f5f5f7;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-number {
            background: #0071e3;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .info-grid.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        /* [NEW] Cost Summary Block Design */
        .cost-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        .cost-block {
            background: #2c2c2e;
            /* Darker block within dark card */
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s;
        }

        .cost-block:hover {
            transform: translateY(-2px);
            background: #3a3a3c;
        }

        .cost-block-title {
            font-size: 14px;
            color: #a1a1a6;
            /* Lighter gray for better contrast */
            margin-bottom: 12px;
            font-weight: 500;
        }

        .cost-block-value {
            font-size: 26px;
            /* Larger font */
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .cost-block-sub {
            font-size: 13px;
            /* Larger sub-text */
            color: #b0b0b5;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        /* New Per Pyeong Design */
        .cost-block-badge {
            margin-top: auto;
            /* Push to bottom */
            font-size: 14px;
            font-weight: 600;
            color: #64d2ff;
            /* Brighter blue */
            background: transparent;
            padding: 4px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            padding-top: 12px;
        }

        .cost-block-badge.profit {
            color: #30d158;
            background: transparent;
        }

        .cost-block-badge.loss {
            color: #ff453a;
            background: transparent;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cost-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ========================= */
        /* Í≥µÏ†ïÎ≥Ñ ÏàòÏùµÍ∏à (Profit Analysis) */
        /* ========================= */
        .profit-summary-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .profit-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px 14px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #e5e7eb;
        }

        .profit-card-highlight {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border: 1.5px solid #86efac;
        }

        .profit-card-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .profit-card-value {
            font-size: 20px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .profit-analysis-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            background: #fff;
        }

        .profit-analysis-table thead tr {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #fff;
        }

        .profit-analysis-table th {
            padding: 10px 8px;
            font-weight: 600;
            text-align: center;
            font-size: 11px;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .profit-analysis-table td {
            padding: 8px 8px;
            border: 1px solid #e5e7eb;
            text-align: right;
            color: #374151;
        }

        .profit-analysis-table td:nth-child(1),
        .profit-analysis-table td:nth-child(2),
        .profit-analysis-table td:nth-child(3),
        .profit-analysis-table td:nth-child(4),
        .profit-analysis-table td:nth-child(5) {
            text-align: center;
        }

        .profit-analysis-table tbody tr:hover {
            background: #f8fafc;
        }

        .profit-cat-header td {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%) !important;
            font-weight: 700 !important;
            color: #4338ca !important;
            font-size: 13px !important;
            padding: 10px 8px !important;
            border-bottom: 2px solid #667eea !important;
        }

        .profit-cat-subtotal td {
            background: #f0f4ff !important;
            font-weight: 600 !important;
            color: #1e293b !important;
            border-top: 1.5px solid #667eea !important;
        }

        .profit-final-row td {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
            color: #fff !important;
            font-weight: 700 !important;
            font-size: 13px !important;
            padding: 12px 8px !important;
            border: none !important;
        }

        .profit-positive {
            color: #16a34a !important;
        }

        .profit-negative {
            color: #dc2626 !important;
        }

        .profit-zero {
            color: #6b7280 !important;
        }

        @media (max-width: 768px) {
            .profit-summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .info-grid.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .info-item {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid #e8e8ed;
        }

        .info-item.full {
            grid-column: 1 / -1;
        }

        .info-item.span-2 {
            grid-column: span 2;
        }

        .info-item label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: block;
            margin-bottom: 4px;
        }

        .info-item input,
        .info-item textarea,
        .info-item select {
            width: 100%;
            font-size: var(--font-size-lg);
            color: #1d1d1f;
            font-weight: 500;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 3px 0;
            background: transparent;
        }

        .info-item input:focus,
        .info-item textarea:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        .info-item input::placeholder {
            color: #c7c7cc;
            font-weight: 400;
        }

        /* Î¨∏ÏÑú ÎûòÌçº */
        .document-wrapper {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .doc-header {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #ffffff;
            padding: 24px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .doc-header h1 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .doc-header .subtitle {
            font-size: 11px;
            opacity: 0.7;
        }

        .pdf-btn {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }

        .pdf-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .doc-content {
            padding: 28px 28px;
        }

        .doc-content>p:first-child,
        .doc-content>.category-section:first-child {
            margin-top: 8px;
        }

        /* ÎåÄÍ∏à ÏßÄÍ∏â */
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .payment-item {
            background: #fff;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #e8e8ed;
            text-align: center;
        }

        .payment-item label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .payment-item input {
            width: 100%;
            text-align: center;
            border: none;
            border-bottom: 2px solid #f5f5f7;
            padding: 3px 0;
            font-size: var(--font-size-lg);
            font-weight: 500;
            color: #1d1d1f;
            background: transparent;
        }

        .payment-item input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        /* Ï°∞Ìï≠ */
        .clause {
            background: #fff;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 6px;
            border: 1px solid #e8e8ed;
        }

        .clause-title {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
            font-size: var(--font-size-lg);
        }

        .clause-content {
            color: #424245;
            line-height: 1.5;
            font-size: var(--font-size-md);
        }

        .important-clause {
            background: #fff5f5;
            border: 2px solid #ff3b30;
        }

        .important-clause .clause-title {
            color: #ff3b30;
        }

        /* ÌäπÏïΩÏÇ¨Ìï≠ */
        .special-note {
            background: #fbfbfd;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #e8e8ed;
            margin-top: 16px;
        }

        .special-note-title {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 8px;
            font-size: var(--font-size-md);
        }

        .special-note textarea {
            width: 100%;
            min-height: 50px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            border-radius: 4px;
            font-size: var(--font-size-md);
            color: #424245;
            line-height: 1.4;
            resize: vertical;
        }

        .special-note textarea:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ÎÇ†Ïßú Î∞ïÏä§ */
        .date-box {
            text-align: center;
            padding: 16px;
            background: #fbfbfd;
            border-radius: 8px;
            margin: 16px 0;
            border: 1px solid #e8e8ed;
        }

        .date-box label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .date-box input {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #1d1d1f;
            border: none;
            border-bottom: 2px solid #d2d2d7;
            padding: 4px 12px;
            background: transparent;
            text-align: center;
        }

        .date-box input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        /* ÏÑúÎ™Ö Í∑∏Î¶¨Îìú */
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .signature-card {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 14px;
            border: 1px solid #e8e8ed;
        }

        .signature-card h4 {
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e8e8ed;
        }

        .sig-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 6px;
        }

        .sig-field {
            margin-bottom: 4px;
        }

        .sig-field label {
            display: block;
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .sig-field input {
            width: 100%;
            padding: 3px 0;
            border: none;
            border-bottom: 1px solid #d2d2d7;
            font-size: var(--font-size-md);
            color: #1d1d1f;
            font-weight: 500;
            background: transparent;
        }

        .sig-field input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        .signature-box {
            margin-top: 8px;
            padding: 14px;
            background: #fff;
            border: 2px dashed #d2d2d7;
            border-radius: 6px;
            text-align: center;
            color: #86868b;
            font-size: var(--font-size-sm);
        }

        .stamp-warning {
            margin-top: 6px;
            background: #fff9e6;
            border: 2px solid #ffcc00;
            border-radius: 4px;
            padding: 5px;
            text-align: center;
            font-size: var(--font-size-sm);
            color: #1d1d1f;
            font-weight: 500;
        }

        /* ÏöîÏïΩ ÌÖåÏù¥Î∏î */
        .summary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 14px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e8e8ed;
            font-size: var(--font-size-md);
        }

        .summary-table thead th {
            background: #f5f5f7;
            padding: 8px 10px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #1d1d1f;
            text-align: left;
            border-bottom: 2px solid #e8e8ed;
        }

        .summary-table thead th:last-child {
            text-align: right;
        }

        .summary-table tbody td {
            padding: 8px 10px;
            color: #1d1d1f;
            border-bottom: 1px solid #f5f5f7;
        }

        .summary-table tbody tr:hover {
            background: #fbfbfd;
        }

        .summary-table .no {
            width: 30px;
            text-align: center;
            color: #86868b;
        }

        .summary-table .amount {
            text-align: right;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
            min-width: 120px;
        }

        /* ÌëúÏßÄÍ≥ÑÏïΩÏÑú Í∏àÏï° Ï†ïÎ†¨ - ‚Ç© ÏôºÏ™Ω Í≥†Ï†ï, Í∏àÏï° Ïö∞Ï∏° Ï†ïÎ†¨ */
        .summary-table .amount .money-align {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .summary-table .amount .money-align .currency {
            flex-shrink: 0;
            margin-right: 4px;
        }

        .summary-table .amount .money-align .value {
            flex-grow: 1;
            text-align: right;
        }

        .summary-table .amount input {
            width: 100%;
            text-align: right;
            border: none;
            background: transparent;
            font-size: var(--font-size-md);
            font-weight: 600;
            color: #1d1d1f;
        }

        .summary-table .amount input:focus {
            outline: none;
        }

        .summary-table .subtotal td {
            background: #f5f5f7;
            font-weight: 600;
        }

        .summary-table .vat td {
            background: #e8f4fd;
            color: #0071e3;
        }

        .summary-table .total td {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            font-weight: 700;
        }

        /* Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑπÏÖò */
        .category-section {
            margin-bottom: 20px;
        }

        .category-section:first-child {
            margin-top: 12px;
        }

        .category-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #424245 100%);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-header h3 {
            font-size: var(--font-size-md);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-header .cat-no {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: var(--font-size-sm);
        }

        .category-header .subtotal {
            font-size: var(--font-size-lg);
            font-weight: 700;
        }

        /* Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            border: 1px solid #e8e8ed;
            border-top: none;
            font-size: var(--font-size-md);
        }

        .data-table thead {
            background: #f5f5f7;
        }

        .data-table th {
            padding: 6px 4px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #1d1d1f;
            text-align: center;
            border-bottom: 2px solid #e8e8ed;
            white-space: nowrap;
        }

        .data-table td {
            padding: 6px 4px;
            color: #1d1d1f;
            border-bottom: 1px solid #f5f5f7;
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .data-table tbody tr:hover {
            background: #fbfbfd;
        }

        .data-table input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: var(--font-size-md);
            color: #1d1d1f;
            padding: 3px;
        }

        .data-table input:focus {
            outline: none;
            background: #fff;
        }

        .data-table .col-no {
            text-align: center;
            color: #86868b;
            font-size: var(--font-size-sm);
        }

        .data-table .col-unit {
            text-align: center;
        }

        .data-table .col-unit .unit-select {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
            text-align: center;
        }

        .data-table .col-unit .unit-wrapper {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .data-table .col-unit .unit-input {
            flex: 1;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
            background: #f0f7ff;
        }

        .data-table .col-unit .unit-toggle-btn {
            padding: 2px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 3px;
            background: #f5f5f7;
            cursor: pointer;
            font-size: 8px;
            color: #86868b;
        }

        .data-table .col-unit .unit-toggle-btn:hover {
            background: #e8e8ed;
        }

        .data-table .col-spec .spec-wrapper {
            width: 100%;
        }

        .data-table .col-spec .spec-select {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #f0f7ff;
            cursor: pointer;
        }

        .data-table .col-spec .spec-input {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #f0f7ff;
        }

        .data-table .col-qty {
            text-align: center;
        }

        .data-table .col-price {
            text-align: right;
        }

        .data-table .col-price input {
            text-align: right;
        }

        .data-table .col-total {
            text-align: right;
            font-weight: 600;
            font-size: var(--font-size-md);
            white-space: nowrap;
            padding-right: 6px;
        }



        .data-table .col-price {
            width: 85px;
            text-align: right;
        }

        .data-table th.material {
            background: #e8f9ec;
            color: #34c759;
        }

        .data-table th.labor {
            background: #fff3e0;
            color: #ff9500;
        }

        .data-table th.expense {
            background: #f3e5f5;
            color: #af52de;
        }

        .div-badge {
            display: inline-block;
            padding: 2px 5px;
            background: #e8f4fd;
            color: #0071e3;
            border-radius: 3px;
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .div-badge.direct {
            background: #fff9e6;
            color: #ff9500;
            cursor: pointer;
        }

        .div-badge.direct:hover {
            background: #ff9500;
            color: #fff;
        }

        .add-row-btn {
            width: 100%;
            padding: 5px;
            background: #fbfbfd;
            border: 1px dashed #d2d2d7;
            border-top: none;
            border-radius: 0 0 6px 6px;
            color: #86868b;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-row-btn:hover {
            background: #f5f5f7;
            color: #0071e3;
        }

        .category-memo {
            background: #fbfbfd;
            border: 1px solid #e8e8ed;
            border-top: none;
            padding: 8px 12px;
        }

        .category-memo label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
        }

        .category-memo textarea {
            width: 100%;
            min-height: 40px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            border-radius: 4px;
            font-size: var(--font-size-md);
            color: #424245;
            line-height: 1.6;
            resize: none;
            overflow: hidden;
        }

        .category-memo textarea:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* Ï¥ùÌï©Í≥Ñ */
        .grand-total {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 14px;
            margin-top: 16px;
            border: 1px solid #e8e8ed;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #e8e8ed;
        }

        .total-row:last-child {
            border-bottom: none;
        }

        .total-row.main {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            margin: 8px -14px -14px;
            padding: 12px 14px;
            border-radius: 0 0 8px 8px;
        }

        .total-row label {
            font-size: var(--font-size-md);
            color: #424245;
            font-weight: 500;
        }

        .total-row.main label {
            color: #fff;
        }

        .total-row .amount {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: #1d1d1f;
        }

        .total-row.main .amount {
            color: #fff;
            font-size: var(--font-size-xl);
        }

        /* Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú ÏÑ†ÌÉù ÌÖåÏù¥Î∏î */
        .estimate-table-wrapper {
            margin-bottom: 16px;
        }

        .estimate-select-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-md);
        }

        .estimate-select-table th {
            background: #f5f5f7;
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #e8e8ed;
        }

        .estimate-select-table td {
            padding: 4px;
            border: 1px solid #e8e8ed;
            text-align: center;
            vertical-align: middle;
        }

        .estimate-select-table select {
            width: 100%;
            padding: 6px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
        }

        .estimate-select-table input[type="number"] {
            width: 100%;
            padding: 6px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
        }

        .estimate-select-table .readonly-cell {
            background: #f9f9fb;
            color: #424245;
            font-size: var(--font-size-md);
        }

        .estimate-select-table .delete-btn {
            background: #ff3b30;
            color: #fff;
            border: none;
            border-radius: 4px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            line-height: 1;
        }

        .estimate-select-table .delete-btn:hover {
            background: #d70015;
        }

        .profit-rate-row {
            background: #f0f7ff;
            border-radius: 6px;
            margin: 8px 0;
        }

        .profit-rate-input {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .profit-rate-input input {
            width: 60px;
            padding: 6px 8px;
            border: 1px solid #0071e3;
            border-radius: 6px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            text-align: right;
            color: #0071e3;
        }

        .profit-rate-input span {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #0071e3;
        }

        @media print {
            .estimate-select-table .delete-btn {
                display: none;
            }
        }

        @media print {
            .estimate-select-table .col-div {
                display: none;
            }

            .estimate-select-table th.col-div {
                display: none;
            }
        }

        @media print {
            .estimate-select-table tr {
                opacity: 1 !important;
                text-decoration: none !important;
            }
        }

        @media print {
            .estimate-select-table input[type="checkbox"] {
                display: none;
            }
        }

        .estimate-select-table input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .estimate-actions .add-row-btn {
            padding: 8px 14px;
            font-size: var(--font-size-sm);
        }

        /* Í≤¨Ï†ÅÏÑú Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÖåÏù¥Î∏î */
        .estimate-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            font-size: var(--font-size-md);
            margin-bottom: 8px;
        }

        .estimate-table th {
            background: #f5f5f7;
            padding: 8px 4px;
            text-align: center !important;
            font-weight: 600;
            border: 1px solid #e8e8ed;
            font-size: var(--font-size-sm);
            white-space: nowrap;
            overflow: visible;
        }

        .estimate-table td {
            padding: 8px 4px;
            border: 1px solid #e8e8ed;
            text-align: center;
            vertical-align: middle;
            overflow: visible;
            line-height: 1.3;
        }

        /* No ÏÖÄ (1Î≤àÏß∏) */
        .estimate-table th:nth-child(1),
        .estimate-table td:nth-child(1) {
            width: 28px;
        }

        /* Íµ¨Î∂Ñ ÏÖÄ (2Î≤àÏß∏) - ÎÑâÎÑâÌïòÍ≤å */
        .estimate-table th:nth-child(2),
        .estimate-table td:nth-child(2) {
            width: 75px;
        }

        /* ÌíàÎ™Ö ÏÖÄ (3Î≤àÏß∏) - ÏûêÎèôÌôïÏû•, Ï¢åÏ∏°Ï†ïÎ†¨ */
        .estimate-table th:nth-child(3),
        .estimate-table td:nth-child(3) {
            text-align: left;
            width: auto;
            min-width: 150px;
        }

        /* ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏÖÄ (4Î≤àÏß∏) - Ï¢åÏ∏°Ï†ïÎ†¨, ÎÑìÍ≤å */
        .estimate-table th:nth-child(4),
        .estimate-table td:nth-child(4) {
            text-align: left;
            width: auto;
            min-width: 250px;
        }

        .estimate-table .spec-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: left;
            cursor: pointer;
        }

        .estimate-table .editable-input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: 11px;
            background: #f0f7ff;
            box-sizing: border-box;
        }

        .estimate-table .editable-input:focus {
            outline: none;
            border-color: #0051a8;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        .estimate-table .editable-price-input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: 11px;
            background: #f0f7ff;
            text-align: right;
            box-sizing: border-box;
        }

        .estimate-table .editable-price-input:focus {
            outline: none;
            border-color: #0051a8;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        /* Îã®ÏúÑ ÏÖÄ (5Î≤àÏß∏) */
        .estimate-table th:nth-child(5),
        .estimate-table td:nth-child(5) {
            width: 35px;
        }

        .estimate-table .unit-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: center;
            cursor: pointer;
        }

        /* ÏàòÎüâ ÏÖÄ (6Î≤àÏß∏) - Ï§ëÏïôÏ†ïÎ†¨ */
        .estimate-table th:nth-child(6),
        .estimate-table td:nth-child(6) {
            width: 50px;
            text-align: center;
        }

        /* Îã®Í∞Ä ÏÖÄ (7Î≤àÏß∏) - ÎÑàÎπÑ Ï∂ïÏÜå, Ï§ëÏïôÏ†ïÎ†¨ */
        .estimate-table th:nth-child(7),
        .estimate-table td:nth-child(7) {
            width: 80px;
        }

        .estimate-table .price-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            background: #fafafa;
            font-size: var(--font-size-md);
            padding: 0 !important;
            /* ÎÇ¥Î∂Ä divÍ∞Ä Ìå®Îî© Ï≤òÎ¶¨ */
            vertical-align: middle;
        }

        .money-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            white-space: nowrap;
        }

        /* Í∏àÏï° ÏÖÄ (8Î≤àÏß∏) - ÎÑàÎπÑ Ï∂ïÏÜå, Ï§ëÏïôÏ†ïÎ†¨ */
        .estimate-table th:nth-child(8),
        .estimate-table td:nth-child(8) {
            width: 100px;
            /* Í∏àÏï°Ïù¥ ÏûòÎ¶¨ÏßÄ ÏïäÎèÑÎ°ù ÎÑàÎπÑ ÌôïÎ≥¥ */
        }



        .estimate-table .amount-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: center;
        }



        /* ÎπÑÍ≥† ÏÖÄ (9Î≤àÏß∏) */
        .estimate-table th:nth-child(9) {
            text-align: center !important;
        }

        .estimate-table td:nth-child(9) {
            text-align: left;
            white-space: pre-wrap;
            word-break: keep-all;
            overflow: visible;
        }



        /* Ïª¨Îüº Î¶¨ÏÇ¨Ïù¥Ï¶à Ìï∏Îì§ */
        .estimate-table th {
            position: relative;
        }

        .estimate-table th .col-resize-handle {
            position: absolute;
            right: -3px;
            top: 0;
            bottom: 0;
            width: 6px;
            cursor: col-resize;
            z-index: 10;
            background: transparent;
        }

        .estimate-table th .col-resize-handle:hover,
        .estimate-table th .col-resize-handle.resizing {
            background: rgba(0, 113, 227, 0.3);
        }

        .estimate-table select {
            width: 100%;
            padding: 5px 3px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
        }

        .estimate-table .qty-input {
            width: 45px;
            padding: 2px 3px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
        }

        /* ÏÇ≠Ï†ú Î≤ÑÌäº (ÌÖåÏù¥Î∏î ÏôºÏ™Ω Ïó¨Î∞±Ïóê ÎùÑÏö∞Í∏∞) */
        .del-btn-floating {
            position: absolute;
            left: -22px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            /* Ï°∞Í∏à Îçî ÌÅ¨Í≤å */
            height: 18px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            opacity: 1;
            /* Ìï≠ÏÉÅ ÌëúÏãú */
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .del-btn-floating:hover {
            background: #d70015;
            transform: translateY(-50%) scale(1.1);
        }

        @media print {
            .del-btn-floating {
                display: none !important;
            }
        }

        /* ÎπÑÍ≥† ÏûÖÎ†•Ïπ∏ Ïä§ÌÉÄÏùº */
        .estimate-table .remark-input {
            width: 100%;
            min-width: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 11px;
            resize: none;
            overflow-y: hidden;
            box-sizing: border-box;
            line-height: 1.3;
        }

        .estimate-table .remark-editable {
            width: 100%;
            min-width: 60px;
            min-height: 24px;
            padding: 4px 6px;
            font-size: 11px;
            outline: none;
            white-space: pre-wrap;
            word-break: keep-all;
            line-height: 1.4;
            box-sizing: border-box;
        }

        .estimate-table .remark-editable:focus {
            background: #f8f9fa;
            border-radius: 4px;
        }

        .estimate-table .remark-editable:empty:before {
            content: '';
            color: #999;
        }



        .estimate-table .del-btn {
            background: none;
            border: none;
            color: #ff3b30;
            cursor: pointer;
            font-size: 12px;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .estimate-table .del-btn:hover {
            background: #ffebeb;
        }

        .estimate-memo {
            background: #f9f9fb;
            padding: 10px 12px;
            margin-top: 8px;
            border-radius: 6px;
            font-size: 11px;
            color: #424245;
            border-left: 3px solid #0071e3;
        }

        .estimate-memo .memo-textarea {
            width: 100%;
            min-height: 50px;
            padding: 8px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: 11px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        /* contenteditable Î©îÎ™® ÏòÅÏó≠ (ÏÑúÏãù Ï†ÅÏö© Í∞ÄÎä•) */
        .estimate-memo .memo-editable {
            width: 100%;
            min-height: 50px;
            max-height: 150px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: 11px;
            font-family: inherit;
            line-height: 1.6;
            outline: none;
            white-space: pre-wrap;
            word-break: break-word;
            display: block;
            box-sizing: border-box;
            text-align: left;
        }

        .estimate-memo .memo-editable:focus {
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.15);
        }

        .estimate-memo .memo-editable:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }

        /* ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ìñâ Ïä§ÌÉÄÏùº */
        .draggable-row.dragging {
            opacity: 0.5;
            background-color: #f0f0f0;
        }

        .estimate-table .drag-handle {
            cursor: grab;
        }

        .estimate-table .drag-handle:active {
            cursor: grabbing;
        }

        @media print {

            .estimate-table .col-div,
            .estimate-table th.col-div,
            .estimate-table col.col-div {
                display: none !important;
            }

            /* Ïù∏ÏáÑ Ïãú Ïª¨Îüº ÎÑàÎπÑ Ï°∞Ï†ï (1: No, 2: Div, 3: Name, 4: Spec, 5: Unit, 6: Qty, 7: Price, 8: Amount, 9: Remark) */
            /* Ï∞∏Í≥†: 2Î≤à Íµ¨Î∂Ñ Ïª¨ÎüºÏùÄ Ïù∏ÏáÑ Ïãú Ïà®Í≤®Ïßê */
            .estimate-table col:nth-child(1) {
                width: 4% !important;
            }

            .estimate-table col:nth-child(3) {
                width: 18% !important;
            }

            .estimate-table col:nth-child(4) {
                width: 20% !important;
            }

            /* ÏÉÅÏÑ∏ÎÇ¥Ïö© */
            .estimate-table col:nth-child(5) {
                width: 8% !important;
            }

            /* Îã®ÏúÑ (ÌôïÎåÄ) */
            .estimate-table col:nth-child(6) {
                width: 8% !important;
            }

            /* ÏàòÎüâ (ÌôïÎåÄ) */
            .estimate-table col:nth-child(7) {
                width: 11% !important;
            }

            /* Îã®Í∞Ä (ÌôïÎåÄ) */
            .estimate-table col:nth-child(8) {
                width: 11% !important;
            }

            /* Í∏àÏï° (ÌôïÎåÄ) */
            .estimate-table col:nth-child(9) {
                width: 20% !important;
            }

            /* ÎπÑÍ≥† (ÏÉÅÏÑ∏ÎÇ¥Ïö©Í≥º 1:1) */

            /* Ïù∏ÏáÑ Ïãú Î©îÎ™® Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº ÌôïÏù∏ (ÎåÄÍ¥ÑÌò∏ Í∞ôÏùÄ ÌååÎûÄ ÏÑ† Î≥µÍµ¨: Îë•Í∑º Î™®ÏÑúÎ¶¨) */
            .estimate-memo {
                border: 3px solid transparent !important;
                border-left-color: #0071e3 !important;
                border-radius: 12px !important;
                /* Îë•Í∏ÄÍ≤å Í∫æÏù¥ÎèÑÎ°ù */

                padding-left: 12px !important;
                margin-top: 10px !important;
                display: block !important;
            }

            /* Ïù∏ÏáÑ Ïãú Î©îÎ™®ÎûÄ Ïä§ÌÉÄÏùº Í∞úÏÑ†: ÌöåÏÉâ Î∞ïÏä§Îßå ÌëúÏãú (ÌååÎûÄÏÑ†ÏùÄ Î∂ÄÎ™®Í∞Ä Îã¥Îãπ -> ÏÇ≠Ï†úÎê®) */
            .estimate-memo .memo-editable {
                display: block !important;
                height: auto !important;
                min-height: 50px !important;
                max-height: none !important;
                overflow: visible !important;
                white-space: pre-wrap !important;

                /* Ïä§ÌÉÄÏùºÎßÅ: ÌöåÏÉâ Î∞∞Í≤Ω, ÌÖåÎëêÎ¶¨ ÏóÜÏùå */
                border: none !important;
                background-color: #f9f9fb !important;
                border-radius: 4px !important;
                /* 4Î©¥ Î™®Îëê Îë•Í∏ÄÍ≤å */
                padding: 12px 16px !important;
                margin-top: 5px !important;

                width: 100% !important;
                box-sizing: border-box !important;

                /* Ìè∞Ìä∏ Î∞è Ïó¨Î∞± Ï°∞Ï†ï */
                font-size: 11px !important;
                line-height: 1.6 !important;
                color: #333 !important;

                /* Ïä§ÌÅ¨Î°§Î∞î Í∞ïÏ†ú Ïà®ÍπÄ */
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;

                /* ÌéòÏù¥ÏßÄ ÎÑòÍπÄ Î∞©ÏßÄ */
                page-break-inside: avoid !important;
            }

            /* ÏõπÌÇ∑(Chrome/Safari) Ïä§ÌÅ¨Î°§Î∞î Ïà®ÍπÄ */
            .estimate-memo .memo-editable::-webkit-scrollbar {
                display: none !important;
                width: 0 !important;
                height: 0 !important;
            }
        }

        /* ÏàòÏùµ Î∂ÑÏÑù */
        .profit-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .profit-item {
            background: #fff;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #e8e8ed;
            text-align: center;
        }

        .profit-item.profit {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            border: none;
            color: #fff;
        }

        .profit-item label {
            font-size: 9px;
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
        }

        .profit-item.profit label {
            color: rgba(255, 255, 255, 0.7);
        }

        .profit-item .value {
            font-size: 13px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .profit-item.profit .value {
            color: #fff;
        }

        /* Í∏∞ÏóÖÏù¥Ïú® Î∞ïÏä§ */
        .rate-box {
            background: #fbfbfd;
            border: 1px solid #e8e8ed;
            border-radius: 6px;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .rate-box label {
            font-size: 10px;
            color: #86868b;
            font-weight: 600;
        }

        .rate-box input {
            font-size: 14px;
            font-weight: 700;
            color: #0071e3;
            border: none;
            background: transparent;
            text-align: right;
            width: 60px;
        }

        .rate-box input:focus {
            outline: none;
        }

        /* ÌÜµÍ≥Ñ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 16px;
            border: 1px solid #e8e8ed;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            border: none;
            color: #fff;
        }

        .stat-card label {
            font-size: 9px;
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            display: block;
            margin-bottom: 4px;
        }

        .stat-card.highlight label {
            color: rgba(255, 255, 255, 0.7);
        }

        .stat-card .value {
            font-size: 22px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .stat-card.highlight .value {
            color: #fff;
        }

        .stat-card .sub {
            font-size: 10px;
            color: #86868b;
            margin-top: 2px;
        }

        .stat-card.highlight .sub {
            color: rgba(255, 255, 255, 0.7);
        }

        .no-print {
            display: block;
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î ÌÜµÍ≥Ñ Î≤ÑÌäº */
        .sidebar-stats-btn {
            padding: 14px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 600;
        }

        .sidebar-stats-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .sidebar-stats-btn .stats-arrow {
            margin-left: auto;
            transition: transform 0.2s ease;
        }

        .sidebar-stats-btn:hover .stats-arrow {
            transform: translateX(3px);
        }

        /* ÌéòÏù¥Ïßï Ïä§ÌÉÄÏùº */
        .pagination-container {
            padding: 10px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e5e5e5;
            text-align: center;
        }

        .pagination-info {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .pagination-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }

        .pagination-btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .pagination-btn:hover {
            background: #005bb5;
        }

        .pagination-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .pagination-current {
            font-size: 12px;
            font-weight: 700;
            color: #333;
            min-width: 60px;
        }

        /* ÌÜµÍ≥Ñ Î™®Îã¨ */
        .stats-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .stats-modal-overlay.show {
            display: flex;
        }

        .stats-modal {
            background: #f5f5f7;
            border-radius: 16px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stats-modal-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
            color: #fff;
            padding: 18px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-modal-header h2 {
            font-size: 16px;
            font-weight: 700;
        }

        .stats-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
        }

        .stats-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-modal-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 70px);
        }

        /* ÏöîÏïΩ Ïπ¥Îìú */
        .stats-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stats-summary-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e8e8ed;
        }

        .stats-summary-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ed 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stats-summary-card.blue .stats-summary-icon {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .stats-summary-card.green .stats-summary-icon {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .stats-summary-card.purple .stats-summary-icon {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .stats-summary-value {
            font-size: 22px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .stats-summary-label {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï: KPI Í∑∏Î¶¨Îìú */
        @media (max-width: 768px) {
            .stats-kpi-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }

            .stats-kpi-grid .kpi-card.highlight {
                grid-column: span 2;
            }

            .stats-secondary-kpi {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .stats-filter-bar {
                flex-direction: column;
                gap: 10px !important;
            }

            .stats-main-chart {
                padding: 16px !important;
            }

            .stats-main-chart h3 {
                font-size: 15px !important;
            }

            .stats-main-chart>div:first-child {
                flex-direction: column;
                gap: 12px;
            }

            .stats-content-area .stats-chart-card {
                grid-column: span 2;
            }

            #view-stats-others>div {
                grid-template-columns: 1fr !important;
            }
        }

        /* Ï∞®Ìä∏ Í∑∏Î¶¨Îìú */
        .stats-chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stats-chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e8e8ed;
        }

        .stats-chart-card.wide {
            grid-column: span 2;
        }

        .stats-chart-card h3 {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f5f5f7;
        }

        .stats-chart-card canvas {
            max-height: 220px;
        }

        /* Ï†ÑÌôòÏú® ÌëúÏãú */
        .conversion-rate-display {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 10px 0;
        }

        .conversion-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#34c759 0%, #34c759 0%, #e8e8ed 0%, #e8e8ed 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .conversion-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: #fff;
            border-radius: 50%;
        }

        .conversion-circle span {
            position: relative;
            font-size: 24px;
            font-weight: 700;
            color: #34c759;
        }

        .conversion-details {
            flex: 1;
        }

        .conversion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 12px;
            color: #424245;
        }

        .conversion-item .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .conversion-item .dot.green {
            background: #34c759;
        }

        .conversion-item .dot.red {
            background: #ff3b30;
        }

        .conversion-item .dot.gray {
            background: #86868b;
        }

        @media (max-width: 900px) {
            .stats-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-chart-grid {
                grid-template-columns: 1fr;
            }

            .stats-chart-card.wide {
                grid-column: span 1;
            }
        }

        /* Î°úÍ∑∏Ïù∏ Ïò§Î≤ÑÎ†àÏù¥ (Í∞ïÏ†ú Î°úÍ∑∏Ïù∏) */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f5f7;
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .login-card {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            width: 360px;
            text-align: center;
        }

        .login-logo {
            font-size: 24px;
            font-weight: 700;
            color: #0071e3;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .login-subtitle {
            font-size: 14px;
            color: #86868b;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 14px;
            background: #fbfbfd;
            transition: all 0.2s;
        }

        .login-input:focus {
            background: #fff;
            border-color: #0071e3;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .login-btn-primary {
            width: 100%;
            padding: 14px;
            background: #0071e3;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }

        .login-btn-primary:hover {
            background: #0077ed;
        }

        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                size: A4;
                margin: 8mm 5mm 8mm 5mm;
                /* ÏÉÅ Ïö∞ Ìïò Ï¢å - Ï¢åÏö∞ ÏµúÏÜåÌôî */
            }

            html,
            body {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .main-header,
            .sidebar,
            .customer-tabs,
            .add-row-btn,
            .pdf-btn,
            .no-print,
            .font-size-control,
            .header-actions {
                display: none !important;
            }

            body {
                background: white;
                font-size: 11px !important;
                zoom: 0.75;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .main-layout {
                display: block;
                width: 100% !important;
            }

            .main-content {
                overflow: visible;
                padding: 0 !important;
                width: 100% !important;
            }

            .customer-panel {
                padding: 0 !important;
            }

            .document-wrapper {
                box-shadow: none !important;
                border-radius: 0 !important;
                page-break-after: auto !important;
                margin: 0 !important;
                padding: 24px !important;
                /* ÎÇ¥Î∂Ä Ïó¨Î∞± Ï¶ùÍ∞Ä */
                width: 100% !important;
                max-width: none !important;
                min-height: 0 !important;
            }

            /* Ìó§Îçî Ïä§ÌÉÄÏùº Ïù∏ÏáÑÏö© Ï°∞Ï†ï */
            .doc-header {
                padding: 24px !important;
                margin: -24px -24px 24px -24px !important;
                background-color: #0071e3 !important;
                /* Î∞∞Í≤ΩÏÉâ Í∞ïÏ†ú Ï†ÅÏö© */
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: white !important;
            }

            .doc-header h1 {
                margin-bottom: 4px !important;
            }

            /* ÌÖåÏù¥Î∏î Ï†ÑÏ≤¥ ÎÑàÎπÑ ÏÇ¨Ïö© */
            .data-table,
            .estimate-table,
            .summary-table,
            .estimate-select-table {
                width: 100% !important;
                table-layout: fixed !important;
            }

            /* ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïª¨Îüº ÎÑàÎπÑ (Ïù∏ÏáÑÏö©) */
            .data-table .col-no {
                width: 20px !important;
            }

            .data-table .col-div {
                width: 35px !important;
            }

            .data-table .col-name {
                width: auto !important;
            }

            /* Ïù∏ÏáÑ Ïãú Ïà®ÍπÄ */
            .no-print {
                display: none !important;
            }

            /* Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Ìå®ÎÑê Ïù∏ÏáÑ ÏÑ§Ï†ï */
            #panel-schedule .data-table th:last-child,
            #panel-schedule .data-table td:last-child {
                display: none !important;
            }

            /* Ïä§ÏºÄÏ§Ñ ÌÖåÏù¥Î∏î Ïª¨Îüº ÎÑàÎπÑ Ï°∞Ï†ï (Ïù∏ÏáÑÏö©) */
            #panel-schedule .data-table th:nth-child(1),
            #panel-schedule .data-table td:nth-child(1) {
                width: 5% !important;
            }

            /* No */
            #panel-schedule .data-table th:nth-child(2),
            #panel-schedule .data-table td:nth-child(2) {
                width: 30% !important;
            }

            /* Í≥µÏ†ïÎ™Ö */
            #panel-schedule .data-table th:nth-child(3),
            #panel-schedule .data-table td:nth-child(3) {
                width: 15% !important;
            }

            /* ÏãúÏûëÏùº */
            #panel-schedule .data-table th:nth-child(4),
            #panel-schedule .data-table td:nth-child(4) {
                width: 15% !important;
            }

            /* Ï¢ÖÎ£åÏùº */
            #panel-schedule .data-table th:nth-child(5),
            #panel-schedule .data-table td:nth-child(5) {
                width: 10% !important;
            }

            /* Îã¥ÎãπÏûê */
            #panel-schedule .data-table th:nth-child(6),
            #panel-schedule .data-table td:nth-child(6) {
                width: 25% !important;
            }

            /* ÎπÑÍ≥† */

            /* ÌíàÎ™Ö - ÎÇòÎ®∏ÏßÄ Í≥µÍ∞Ñ Ï∞®ÏßÄ */
            .data-table .col-spec {
                width: 80px !important;
            }

            .data-table .col-unit {
                width: 30px !important;
            }

            .data-table .col-qty {
                width: 30px !important;
            }

            .data-table .col-price {
                width: 55px !important;
            }

            .data-table .col-total {
                width: 65px !important;
            }

            .data-table .col-note {
                width: 50px !important;
            }

            /* Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú Ïª¨Îüº ÎÑàÎπÑ (Ïù∏ÏáÑÏö©) */
            .estimate-table th:nth-child(1) {
                width: 20px !important;
            }

            /* No */
            .estimate-table th:nth-child(2) {
                width: auto !important;
            }

            /* ÌíàÎ™Ö - ÎÇòÎ®∏ÏßÄ Í≥µÍ∞Ñ */
            .estimate-table th:nth-child(3) {
                width: 80px !important;
            }

            /* Í∑úÍ≤© */
            .estimate-table th:nth-child(4) {
                width: 30px !important;
            }

            /* Îã®ÏúÑ */
            .estimate-table th:nth-child(5) {
                width: 30px !important;
            }

            /* ÏàòÎüâ */
            .estimate-table th:nth-child(6) {
                width: 65px !important;
            }

            /* Îã®Í∞Ä */
            .estimate-table th:nth-child(7) {
                width: 65px !important;
            }

            /* Í∏àÏï° */

            /* Í≤¨Ï†ÅÏÑú Ìó§Îçî Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ (Ïù∏ÏáÑ) */
            .estimate-table th {
                text-align: center !important;
            }

            /* ÏÖÄ ÎÇ¥Ïö© Ï§ÑÎ∞îÍøà Î∞©ÏßÄ */
            .data-table td,
            .estimate-table td,
            .summary-table td {
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                padding: 4px 3px !important;
                font-size: 10px !important;
            }

            /* ÌíàÎ™Ö/Í∑úÍ≤© Ïó¥ÏùÄ Ï§ÑÎ∞îÍøà ÌóàÏö© */
            .data-table .col-name,
            .data-table .col-spec,
            .estimate-table td:nth-child(2),
            .estimate-table td:nth-child(3) {
                white-space: normal !important;
                word-break: keep-all !important;
            }

            .data-table th,
            .estimate-table th,
            .summary-table th {
                padding: 4px 3px !important;
                font-size: 9px !important;
                white-space: nowrap !important;
            }

            /* Ïπ¥ÌÖåÍ≥†Î¶¨ Ìó§Îçî */
            .category-header {
                padding: 6px 8px !important;
            }

            .category-header h3 {
                font-size: 11px !important;
            }

            .category-header .subtotal {
                font-size: 11px !important;
            }

            /* Ï¥ùÌï©Í≥Ñ */
            .grand-total {
                padding: 8px !important;
                margin-top: 8px !important;
            }

            .total-row {
                padding: 4px 0 !important;
            }

            .total-row label {
                font-size: 10px !important;
            }

            .total-row .amount {
                font-size: 11px !important;
            }

            .total-row.main .amount {
                font-size: 13px !important;
            }

            /* Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú */
            .info-grid {
                gap: 12px !important;
                /* Í∞ÑÍ≤© ÎÑìÌûò */
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                width: 100% !important;
            }

            /* ÏÑπÏÖò Í∞ÑÍ≤© ÎÑìÌûò */
            .section {
                margin-bottom: 24px !important;
            }

            .section-title {
                margin-bottom: 12px !important;
            }

            .info-grid.cols-3 {
                grid-template-columns: repeat(3, 1fr) !important;
            }

            .info-grid.cols-4 {
                grid-template-columns: repeat(4, 1fr) !important;
            }

            .info-item.full {
                grid-column: span 2 !important;
            }

            .info-item {
                padding: 6px 8px !important;
            }

            .info-item label {
                font-size: 8px !important;
            }

            .info-item input,
            .info-item select {
                font-size: 10px !important;
            }

            /* Î©îÎ™® ÏòÅÏó≠ */
            .category-memo,
            .estimate-memo {
                overflow: visible !important;
                max-height: none !important;
            }

            .category-memo textarea {
                font-size: 9px !important;
            }

            .estimate-memo .memo-content {
                font-size: 9px !important;
            }

            /* ÏÑúÎ™Ö ÏòÅÏó≠ */
            .signature-card h4 {
                font-size: 10px !important;
            }

            .sig-field label {
                font-size: 7px !important;
            }

            .sig-field input {
                font-size: 9px !important;
            }

            /* ÌéòÏù¥ÏßÄ Îß§ÍπÄ Î∞©ÏßÄ: ÎÇ¥Ïö©Ïù¥ ÏûòÎ¶¨ÏßÄ ÏïäÍ≥† Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú ÎÑòÏñ¥Í∞ÄÎèÑÎ°ù ÏÑ§Ï†ï */
            .section,
            .info-grid,
            .signature-card,
            .clause,
            .contract-article,
            .category-box,
            tr,
            .estimate-row,
            .category-memo,
            .estimate-memo {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            /* Ï°∞Ìï≠ */
            .clause {
                padding: 8px !important;
                margin-bottom: 4px !important;
            }

            .clause-title {
                font-size: 10px !important;
            }

            /* ÎåÄÍ∏à ÏßÄÍ∏â Ìïú Ï§ÑÎ°ú ÌëúÏãú */
            .payment-grid {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr) !important;
                gap: 8px !important;
                width: 100% !important;
            }

            .clause-content {
                font-size: 9px !important;
            }

            /* ÏÑúÎ™Ö Í∑∏Î¶¨Îìú 2Ïó¥ Ïú†ÏßÄ (Ïù∏ÏáÑ) */
            .signature-grid {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }

            .signature-card {
                background: #fbfbfd !important;
                border-radius: 8px !important;
                padding: 14px !important;
                border: 1px solid #e8e8ed !important;
            }

            .signature-card h4 {
                text-align: center !important;
                font-size: 11px !important;
                font-weight: 700 !important;
                margin-bottom: 10px !important;
                padding-bottom: 6px !important;
                border-bottom: 1px solid #e8e8ed !important;
            }

            .sig-row {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }

            .signature-box {
                margin-top: 8px !important;
                padding: 14px !important;
                border: 2px dashed #d2d2d7 !important;
                border-radius: 6px !important;
                text-align: center !important;
            }

            .stamp-warning {
                margin-top: 6px !important;
                background: #fff9e6 !important;
                border: 2px solid #ffcc00 !important;
                border-radius: 4px !important;
                padding: 5px !important;
                text-align: center !important;
                font-weight: 500 !important;
            }

            .date-box {
                text-align: center !important;
                padding: 16px !important;
                background: #fbfbfd !important;
                border-radius: 8px !important;
                margin: 16px 0 !important;
                border: 1px solid #e8e8ed !important;
            }
        }

        /* Î©ÄÌã∞ ÏÖÄÎ†âÌä∏ UI Ïä§ÌÉÄÏùº */
        .multi-select-wrapper {
            position: relative;
            width: 100%;
        }

        .multi-select-box {
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            margin-top: 4px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
            padding: 4px;
        }

        .multi-select-dropdown.show {
            display: block;
        }

        .multi-select-option {
            display: block;
            padding: 0;
            border-radius: 4px;
        }

        .multi-select-option:hover {
            background: #f5f5f7;
        }

        .multi-select-option label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
            padding: 6px 8px !important;
            margin: 0 !important;
            font-size: 11px;
        }

        .multi-select-option input {
            cursor: pointer;
            margin: 0;
            accent-color: #0071e3;
        }

        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 300px;
            }

            .profit-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 10px 16px;
            }

            .info-grid,
            .signature-grid {
                grid-template-columns: 1fr;
            }

            .payment-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .customer-tabs {
                overflow-x: auto;
            }

            .customer-tab {
                white-space: nowrap;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú ÏÑ§Ï†ï Î≤ÑÌäº/Ìå®ÎÑê/ÏÑúÏãù Ìà¥Î∞î Ïà®Í∏∞Í∏∞ */
            .settings-toggle-btn,
            .settings-panel,
            .text-format-toolbar,
            .col-resize-handle {
                display: none !important;
            }
        }

        /* Ïû†Í∏à ÌÜ†Í∏Ä Î≤ÑÌäº */
        .lock-toggle-btn {
            border: none;
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .lock-toggle-btn.unlocked {
            background-color: #e5f9e7;
            color: #34c759;
        }

        .lock-toggle-btn.locked {
            background-color: #ffe5e5;
            color: #ff3b30;
        }
    </style>
    <style>
        /* Editable Dropdown & Rich Text Input Styles */
        .editable-cell-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            width: 100%;
        }

        .editable-content {
            flex: 1;
            min-height: 24px;
            padding: 4px;
            border: 1px solid transparent;
            outline: none;
            transition: border-color 0.2s;
            white-space: pre-wrap;
            word-break: break-all;
            cursor: text;
            font-size: 12px;
        }

        .editable-content:focus {
            border-bottom: 2px solid #0071e3;
            background: rgba(0, 113, 227, 0.05);
        }

        .editable-content:empty::before {
            content: attr(placeholder);
            color: #c7c7cc;
            pointer-events: none;
        }

        .dropdown-toggle-btn {
            width: 20px;
            height: 100%;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #86868b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            padding: 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .editable-cell-wrapper:hover .dropdown-toggle-btn {
            opacity: 1;
        }

        .dropdown-toggle-btn:hover {
            color: #0071e3;
            background: #f5f5f7;
            border-radius: 3px;
        }

        .custom-dropdown-portal {
            position: fixed;
            z-index: 9999;
            background: #fff;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .custom-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            color: #1d1d1f;
            transition: background 0.1s;
            border-bottom: 1px solid #f5f5f7;
        }

        .custom-dropdown-item:last-child {
            border-bottom: none;
        }

        .custom-dropdown-item:hover {
            background: #f5f5f7;
            color: #0071e3;
        }

        .custom-dropdown-item.selected {
            background: #e8f4fd;
            color: #0071e3;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- [Phase 2] Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ïò§Î≤ÑÎ†àÏù¥ -->
    <div id="initialSyncOverlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:24px; transition: opacity 0.5s ease;">
        <div class="sync-loader"
            style="width:50px; height:50px; border:4px solid #f3f3f3; border-top:4px solid #0071e3; border-radius:50%; animation: sync-spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;">
        </div>
        <div style="text-align:center;">
            <div style="font-size:18px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º ÎèôÍ∏∞ÌôîÌïòÍ≥† ÏûàÏäµÎãàÎã§</div>
            <div id="initialSyncStatus" style="font-size:14px; color:#86868b;">ÏÑúÎ≤ÑÏóêÏÑú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>
        </div>
        <div id="syncErrorContent"
            style="display:none; text-align:center; max-width:400px; padding:20px; background:#fff1f0; border:1px solid #ffa39e; border-radius:12px;">
            <div style="color:#cf1322; font-weight:600; margin-bottom:12px;">Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ïã§Ìå®</div>
            <div id="syncErrorMessage" style="font-size:13px; color:#5c0011; margin-bottom:16px;">ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.
            </div>
            <button onclick="location.reload()"
                style="padding:10px 20px; background:#cf1322; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Îã§Ïãú
                ÏãúÎèÑ</button>
        </div>
        <style>
            @keyframes sync-spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </div>
    <!-- ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º -->
    <div class="toast" id="toast" style="display:none; align-items:flex-start;">
        <span id="toastIcon" style="font-size:18px; margin-top:2px;">‚úì</span>
        <span id="toastMessage" style="flex:1; word-break:break-all; line-height:1.4;">Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§</span>
    </div>

    <!-- Î©îÏù∏ Ìó§Îçî -->
    <header class="main-header">
        <div class="logo">
            <a href="javascript:void(0)" onclick="location.reload();"
                style="display:flex;align-items:center;gap:10px;text-decoration:none;cursor:pointer;">
                <div class="logo-icon">DJ</div>
                <div class="logo-text">ÎîîÏûêÏù∏ÏßÄÍ∑∏ <span>ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</span></div>
            </a>
        </div>
        <div class="header-actions">

            <a href="index.html" class="header-btn secondary" style="text-decoration:none;">üè† ÌôàÌéòÏù¥ÏßÄ</a>
            <!-- Í¥ÄÎ¶¨Ïûê ÏÉÅÌÉú ÌëúÏãú -->
            <div id="adminStatus">
                <span class="admin-badge viewer" id="adminBadge">üëÅ Ïó¥Îûå Î™®Îìú</span>
                <button class="admin-login-btn" onclick="showAdminModal()">üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</button>
            </div>
            <div style="position:relative;">
                <button class="settings-toggle-btn no-print" onclick="toggleSettingsPanel(event)"
                    title="Í∏ÄÏî® ÌÅ¨Í∏∞ ¬∑ ÏÑúÏãù ÏÑ§Ï†ï">‚öôÔ∏è</button>
                <div class="settings-panel no-print" id="settingsPanel">
                    <div class="sp-title">Í∏ÄÏî® ÌÅ¨Í∏∞</div>
                    <div class="sp-row">
                        <label>Ï†ÑÏ≤¥</label>
                        <input type="range" id="fontSizeSlider" min="8" max="18" value="12"
                            oninput="changeFontSize(this.value)">
                        <span class="sp-val" id="fontSizeValue">12px</span>
                    </div>
                    <div class="sp-row">
                        <label>Ìó§Îçî</label>
                        <input type="range" id="fsCatHeader" min="8" max="18" value="13"
                            oninput="changePartFontSize('catHeader', this.value)">
                        <span class="sp-val" id="fsCatHeaderVal">13px</span>
                    </div>
                    <div class="sp-row">
                        <label>ÌñâÌó§Îçî</label>
                        <input type="range" id="fsColHeader" min="8" max="18" value="10"
                            oninput="changePartFontSize('colHeader', this.value)">
                        <span class="sp-val" id="fsColHeaderVal">10px</span>
                    </div>
                    <div class="sp-row">
                        <label>ÎÇ¥Ïö©</label>
                        <input type="range" id="fsContent" min="8" max="18" value="11"
                            oninput="changePartFontSize('content', this.value)">
                        <span class="sp-val" id="fsContentVal">11px</span>
                    </div>
                    <div class="sp-row">
                        <label>Î©îÎ™®</label>
                        <input type="range" id="fsMemo" min="8" max="18" value="11"
                            oninput="changePartFontSize('memo', this.value)">
                        <span class="sp-val" id="fsMemoVal">11px</span>
                    </div>
                    <hr class="sp-divider">
                    <div class="sp-title">ÌÖçÏä§Ìä∏ ÏÑúÏãù (ÎìúÎûòÍ∑∏ ÌõÑ Ï†ÅÏö©)</div>
                    <div class="sp-format-row">
                        <button class="fmt-bold" onclick="applyTextFormat('bold')" title="ÍµµÍ≤å">B</button>
                        <button class="fmt-red" onclick="applyTextFormat('color','#ff3b30')" title="Îπ®Í∞ÑÏÉâ">A</button>
                        <button class="fmt-blue" onclick="applyTextFormat('color','#007aff')" title="ÌååÎûÄÏÉâ">A</button>
                        <button class="fmt-orange" onclick="applyTextFormat('color','#ff9500')" title="Ï£ºÌô©ÏÉâ">A</button>
                        <button class="fmt-underline" onclick="applyTextFormat('underline')" title="Î∞ëÏ§Ñ">U</button>
                        <button class="fmt-strike" onclick="applyTextFormat('strikethrough')" title="Ï∑®ÏÜåÏÑ†">S</button>
                        <button class="fmt-italic" onclick="applyTextFormat('italic')" title="Í∏∞Ïö∏ÏûÑ">I</button>
                    </div>
                </div>
            </div>
            <button class="header-btn secondary" onclick="exportAllData()">üìä Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
            <button class="header-btn secondary" onclick="importData()">üì• Î∂àÎü¨Ïò§Í∏∞</button>
            <button class="header-btn secondary" onclick="exportCurrentCustomerData()">üíæ Í≥†Í∞ùÏ†ÄÏû•(JSON)</button>
        </div>
    </header>

    <!-- ÌÖçÏä§Ìä∏ ÏÑúÏãù ÌîåÎ°úÌåÖ Ìà¥Î∞î -->
    <div class="text-format-toolbar no-print" id="textFormatToolbar">
        <button class="fmt-bold" onclick="applyTextFormat('bold')" title="ÍµµÍ≤å">B</button>
        <button class="fmt-black" onclick="applyTextFormat('color','#000000')" title="Í≤ÄÏ†ïÏÉâ">A</button>
        <button class="fmt-red" onclick="applyTextFormat('color','#ff3b30')" title="Îπ®Í∞ÑÏÉâ">A</button>
        <button class="fmt-blue" onclick="applyTextFormat('color','#007aff')" title="ÌååÎûÄÏÉâ">A</button>
        <button class="fmt-orange" onclick="applyTextFormat('color','#ff9500')" title="Ï£ºÌô©ÏÉâ">A</button>
        <button class="fmt-underline" onclick="applyTextFormat('underline')" title="Î∞ëÏ§Ñ">U</button>
        <button class="fmt-strike" onclick="applyTextFormat('strikethrough')" title="Ï∑®ÏÜåÏÑ†">S</button>
        <button class="fmt-italic" onclick="applyTextFormat('italic')" title="Í∏∞Ïö∏ÏûÑ">I</button>
        <button class="fmt-clear" onclick="applyTextFormat('removeFormat')" title="ÏÑúÏãù Ï†úÍ±∞">‚úï</button>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <h3>üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</h3>
            <p>Í¥ÄÎ¶¨Ïûê ÏïÑÏù¥ÎîîÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
            <input type="text" id="adminId" placeholder="ÏïÑÏù¥Îîî" style="margin-bottom:8px;"
                onkeypress="if(event.key==='Enter')document.getElementById('adminPassword').focus()">
            <input type="password" id="adminPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                onkeypress="if(event.key==='Enter')loginAdmin()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeAdminModal()">Ï∑®ÏÜå</button>
                <button class="confirm-btn" onclick="loginAdmin()">Î°úÍ∑∏Ïù∏</button>
            </div>
        </div>
    </div>

    <!-- ÏÇ≠Ï†ú ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ -->
    <div class="admin-modal" id="deletePasswordModal">
        <div class="admin-modal-content">
            <h3>üóëÔ∏è ÏÇ≠Ï†ú ÌôïÏù∏</h3>
            <p>ÏÇ≠Ï†úÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
            <input type="password" id="deletePassword" placeholder="ÏÇ≠Ï†ú ÎπÑÎ∞ÄÎ≤àÌò∏"
                onkeypress="if(event.key==='Enter')confirmDeletePassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeDeletePasswordModal()">Ï∑®ÏÜå</button>
                <button class="confirm-btn" onclick="confirmDeletePassword()">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ (Î©îÏù∏Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©) -->
    <div class="admin-modal" id="adminManagerModal">
        <div class="admin-modal-content" style="max-width:400px;">
            <h3>üë• ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨</h3>
            <p style="font-size:11px;color:#86868b;">Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Í¥ÄÎ¶¨ Í∞ÄÎä•Ìï©ÎãàÎã§</p>

            <!-- ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê Î™©Î°ù -->
            <div id="regularAdminList"
                style="max-height:200px;overflow-y:auto;border:1px solid #e8e8ed;border-radius:6px;margin-bottom:15px;">
            </div>

            <!-- ÏÉà Í¥ÄÎ¶¨Ïûê Ï∂îÍ∞Ä -->
            <div style="background:#f5f5f7;padding:12px;border-radius:6px;margin-bottom:15px;">
                <div style="font-weight:600;margin-bottom:8px;font-size:12px;">‚ûï ÏÉà ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê Ï∂îÍ∞Ä</div>
                <input type="text" id="newAdminId" placeholder="ÏïÑÏù¥Îîî" style="margin-bottom:6px;">
                <input type="password" id="newAdminPw" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" style="margin-bottom:8px;">
                <button class="btn btn-primary btn-sm" onclick="addRegularAdmin()" style="width:100%;">Ï∂îÍ∞Ä</button>
            </div>

            <div class="admin-modal-btns">
                <button class="confirm-btn" onclick="closeAdminManagerModal()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>

    <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï Î™®Îã¨ (ÎØ∏ÏÇ¨Ïö©) -->
    <div class="admin-modal" id="passwordModal">
        <div class="admin-modal-content">
            <h3>üîë ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï</h3>
            <p>ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î≥¥Ìò∏Î•º ÏúÑÌïú Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</p>
            <input type="password" id="newPassword" placeholder="ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ (4ÏûêÎ¶¨ Ïù¥ÏÉÅ)">
            <input type="password" id="confirmPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏" style="margin-top:-8px;"
                onkeypress="if(event.key==='Enter')setAdminPassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closePasswordModal()">Ï∑®ÏÜå</button>
                <button class="confirm-btn" onclick="setAdminPassword()">ÏÑ§Ï†ï</button>
            </div>
        </div>
    </div>

    <!-- Ìú¥ÏßÄÌÜµ Î™®Îã¨ -->
    <div class="admin-modal" id="trashModal">
        <div class="trash-modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h3 style="margin:0;">üóëÔ∏è Ìú¥ÏßÄÌÜµ</h3>
                <button onclick="closeTrashModal()"
                    style="border:none; background:none; cursor:pointer; font-size:18px;">‚úï</button>
            </div>
            <div id="trashList" class="trash-list">
                <!-- ÏÇ≠Ï†úÎêú Ìï≠Î™© ÌëúÏãú -->
            </div>
            <div style="font-size:12px; color:#86868b; margin-top:10px;">
                * ÏòÅÍµ¨ ÏÇ≠Ï†ú Ïãú Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.
            </div>
        </div>
    </div>

    <!-- ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î≥¥Ïïà Ï†ëÍ∑º Î™®Îã¨ -->
    <div class="admin-modal" id="costPasswordModal">
        <div class="admin-modal-content">
            <h3>üîí Î≥¥Ïïà Ï†ëÍ∑º</h3>
            <p>ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ï†ëÍ∑ºÏùÑ ÏúÑÌï¥<br>Î≥¥Ïïà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
            <input type="password" id="costAccessPin" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•"
                onkeypress="if(event.key==='Enter')checkCostPassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeCostPasswordModal()">Ï∑®ÏÜå</button>
                <button class="confirm-btn" onclick="checkCostPassword()">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ -->
    <div class="main-layout">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î: Í≥†Í∞ù Î™©Î°ù -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Í≥†Í∞ù Î™©Î°ù</h3>
                <div style="display:flex;gap:6px;">
                    <!-- [NEW] Î©îÏù∏ Î≥¥Îìú Ïù¥Îèô Î≤ÑÌäº -->
                    <button class="btn btn-sm" onclick="showMainBoardView()" title="ÌôàÏúºÎ°ú (Î©îÏù∏ Î≥¥Îìú)"
                        style="background:#8e8e93; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">üè†</button>
                    <!-- Ìú¥ÏßÄÌÜµ (Î©îÏù∏ Í¥ÄÎ¶¨ÏûêÏö©) - ÏÉÅÎã® Ïù¥Îèô -->
                    <button class="btn btn-sm" id="trashBtnHeader" onclick="showTrashModal()" title="Ìú¥ÏßÄÌÜµ"
                        style="background:#ff3b30; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">üóëÔ∏è</button>
                    <button class="btn btn-sm" onclick="syncFromCloud();" title="ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞"
                        style="background:#34c759; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">‚òÅÔ∏è‚Üì</button>
                    <button class="btn btn-primary btn-sm" onclick="newCustomer()">+ Ïã†Í∑ú</button>
                </div>
            </div>
            <div class="sidebar-search">
                <input type="text" placeholder="Ïù¥Î¶Ñ, Ïó∞ÎùΩÏ≤ò Í≤ÄÏÉâ..." id="searchInput" oninput="filterCustomers()">
            </div>
            <!-- ÎÖÑ/Ïõî ÌïÑÌÑ∞ -->
            <div class="date-filter">
                <select id="yearFilter" onchange="filterCustomers()">
                    <option value="">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>
                </select>
                <select id="monthFilter" onchange="filterCustomers()">
                    <option value="">Ï†ÑÏ≤¥ Ïõî</option>
                    <option value="01">1Ïõî</option>
                    <option value="02">2Ïõî</option>
                    <option value="03">3Ïõî</option>
                    <option value="04">4Ïõî</option>
                    <option value="05">5Ïõî</option>
                    <option value="06">6Ïõî</option>
                    <option value="07">7Ïõî</option>
                    <option value="08">8Ïõî</option>
                    <option value="09">9Ïõî</option>
                    <option value="10">10Ïõî</option>
                    <option value="11">11Ïõî</option>
                    <option value="12">12Ïõî</option>
                </select>
            </div>
            <!-- ÏÉÅÌÉú ÌïÑÌÑ∞ -->
            <div class="status-filter">
                <button class="filter-btn active" data-status="all" onclick="setStatusFilter('all')">Ï†ÑÏ≤¥</button>
                <button class="filter-btn" data-status="consulting" onclick="setStatusFilter('consulting')">ÏÉÅÎã¥Ï§ë</button>
                <button class="filter-btn" data-status="estimate" onclick="setStatusFilter('estimate')">Í≤¨Ï†ÅÏÑú</button>
                <button class="filter-btn" data-status="hold" onclick="setStatusFilter('hold')">Î≥¥Î•ò</button>
                <button class="filter-btn" data-status="budget_over"
                    onclick="setStatusFilter('budget_over')">ÏòàÏÇ∞Ï¥àÍ≥º</button>
                <button class="filter-btn" data-status="other_company"
                    onclick="setStatusFilter('other_company')">ÌÉÄÏóÖÏ≤¥</button>
                <button class="filter-btn" data-status="contracted"
                    onclick="setStatusFilter('contracted')">Í≥ÑÏïΩÏôÑÎ£å</button>
                <button class="filter-btn" data-status="in_progress"
                    onclick="setStatusFilter('in_progress')">Í≥µÏÇ¨Ï§ë</button>
                <button class="filter-btn" data-status="completed" onclick="setStatusFilter('completed')">Í≥µÏÇ¨ÏôÑÎ£å</button>
                <button class="filter-btn" data-status="as_done" onclick="setStatusFilter('as_done')">A/S</button>
            </div>
            <div class="customer-list" id="customerList"></div>
            <!-- ÌéòÏù¥Ïßï UI (500Î™Ö Ïù¥ÏÉÅÏãú ÏûêÎèô ÌëúÏãú) -->
            <div class="pagination-container" id="paginationContainer" style="display:none;">
                <div class="pagination-info" id="paginationInfo"></div>
                <div class="pagination-buttons">
                    <button class="pagination-btn" id="prevPageBtn" onclick="goToPrevPage()">‚óÄ Ïù¥Ï†Ñ</button>
                    <span class="pagination-current" id="currentPageSpan">1</span>
                    <button class="pagination-btn" id="nextPageBtn" onclick="goToNextPage()">Îã§Ïùå ‚ñ∂</button>
                </div>
            </div>
            <!-- ÌÜµÍ≥Ñ Î≤ÑÌäº -->
            <div class="sidebar-stats-btn" onclick="openStatsModal()">
                <span>üìä</span>
                <span>Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú</span>
                <span class="stats-arrow">‚Üí</span>
            </div>
            <!-- Ïö¥ÏòÅÎπÑ Í¥ÄÎ¶¨ Î≤ÑÌäº -->
            <div class="sidebar-stats-btn" onclick="showMainView('expenses')"
                style="margin-top:10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                <span style="font-size:18px;">üí∏</span>
                <span style="font-weight:600;">Ïö¥ÏòÅÎπÑ Í¥ÄÎ¶¨</span>
                <span class="stats-arrow">‚Üí</span>
            </div>
        </div>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="main-content" id="mainContent">
            <!-- [Ïã†Í∑ú] Ïö¥ÏòÅÎπÑ Í¥ÄÎ¶¨ Î∑∞ (Ï†ÑÏó≠) -->
            <div id="view-expenses"
                style="display:none; padding:40px; height:100%; overflow-y:auto; background:linear-gradient(180deg, #f0fdf4 0%, #f5f5f7 100%);">
                <div class="document-wrapper"
                    style="min-height: 500px; max-width:1200px; margin:0 auto; background:white; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,0.1);">
                    <div class="doc-header"
                        style="padding:24px 30px; border-bottom:1px solid #e5e7eb; background:linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius:16px 16px 0 0;">
                        <div>
                            <div
                                style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color:#059669;">
                                DESIGN JIG ADMIN</div>
                            <h2 style="margin:0; font-size:26px; color:#064e3b; font-weight:700;">üí∞ Ïö¥ÏòÅÎπÑ Î∞è Í≥†Ï†ïÏßÄÏ∂ú Í¥ÄÎ¶¨ ÎåÄÏû•
                            </h2>

                            <!-- ÏïàÎÇ¥ Î¨∏Íµ¨ Î∞ïÏä§ -->
                            <div
                                style="margin-top:16px; padding:16px; background:rgba(255,255,255,0.6); border:1px solid rgba(16,185,129,0.2); border-radius:8px; font-size:13px; color:#065f46; line-height:1.6;">
                                <ul style="margin:0; padding-left:20px; list-style-type:disc;">
                                    <li>Î≥∏ ÌôîÎ©¥ÏùÄ ÌòÑÏû• Í≥µÏÇ¨ Ï†ïÏÇ∞Ïù¥ ÏïÑÎãå, <b>ÏûÑÎåÄÎ£å¬∑Í∏âÏó¨¬∑Ï∞®ÎüâÎπÑ¬∑ÏÑ∏Í∏à</b> Îì± ÏÇ¨ÏóÖÏ≤¥ Ïö¥ÏòÅÏùÑ ÏúÑÌïú ÎπÑÏö©ÏùÑ Í¥ÄÎ¶¨ÌïòÎäî ÏãúÌä∏ÏûÖÎãàÎã§.</li>
                                    <li>ÏÉÅÎã® <b>'Ï°∞Ìöå Ïõî'</b>ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Í≥†Ï†ïÏßÄÏ∂úÍ≥º ÏõîÎ≥Ñ Ïö¥ÏòÅÎπÑÎ•º Ìï®Íªò Í¥ÄÎ¶¨Ìï©ÎãàÎã§.</li>
                                    <li><b>Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™©</b>ÏùÄ Ìïú Î≤à ÏÑ§Ï†ïÌïòÎ©¥ Îß§Îã¨ ÏûêÎèôÏúºÎ°ú Î∞òÏòÅÎê©ÎãàÎã§. (Ìï≠Î™©Î™Ö, Í∏àÏï° ÏûêÎèô Í≥ÑÏÇ∞)</li>
                                    <li>ÌïòÎã® ÌëúÏóêÎäî Ìï¥Îãπ ÏõîÏóê Ïã§Ï†ú Î∞úÏÉùÌïú <b>Î≥ÄÎèô Ïö¥ÏòÅÎπÑ</b>Îßå ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî.</li>
                                    <li>Ï¥ù Ïö¥ÏòÅÎπÑ Ìï©Í≥ÑÎäî ÏÜêÏùµ¬∑ÌÜµÍ≥Ñ¬∑ÏÑ∏Î¨¥ Ï†ïÎ¶¨Ïùò Í∏∞Ï§ÄÏúºÎ°ú ÏÇ¨Ïö©Îê©ÎãàÎã§.</li>
                                </ul>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <button onclick="saveExpensesToCloud()" id="btnSaveExpenses"
                                style="padding:10px 16px; background:linear-gradient(135deg, #3b82f6, #2563eb); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(59,130,246,0.3); transition:all 0.2s;">
                                ‚òÅÔ∏è Ï†ÄÏû•ÌïòÍ∏∞
                            </button>
                            <button onclick="syncExpensesFromCloud()" id="btnLoadExpenses"
                                style="padding:10px 16px; background:white; color:#059669; border:2px solid #10b981; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.2s;">
                                üîÑ Î∂àÎü¨Ïò§Í∏∞
                            </button>
                        </div>
                    </div>

                    <div style="padding:30px;">
                        <!-- Ïõî ÏÑ†ÌÉù Î∞è Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï ÏòÅÏó≠ -->
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:12px;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <label style="font-weight:600; color:#374151; font-size:14px;">üìÖ Ï°∞Ìöå Ïõî:</label>
                                <input type="month" id="expenseMonthFilter" onchange="renderExpensesTable()"
                                    style="padding:8px 14px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; cursor:pointer;">
                            </div>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button onclick="addExpenseRow()"
                                    style="padding:10px 16px; background:linear-gradient(135deg, #10b981, #059669); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(16,185,129,0.3); transition:all 0.2s;">
                                    ‚ûï Ìñâ Ï∂îÍ∞Ä
                                </button>
                                <button onclick="toggleFixedExpenseSettings()"
                                    style="padding:10px 16px; background:linear-gradient(135deg, #f59e0b, #d97706); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px;">
                                    ‚öôÔ∏è Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï
                                </button>
                            </div>
                        </div>

                        <!-- Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Ìå®ÎÑê (Ï†ëÏù¥Ïãù) -->
                        <div id="fixedExpenseSettingsPanel"
                            style="display:none; margin-bottom:24px; background:linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border:2px solid #f59e0b; border-radius:12px; padding:20px;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                                <h4 style="margin:0; color:#92400e; font-size:16px;">üîí Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™© ÏÑ§Ï†ï</h4>
                                <div style="display:flex; gap:8px;">
                                    <button onclick="addFixedExpenseItem()"
                                        style="padding:8px 14px; background:#d97706; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        ‚ûï Ìï≠Î™© Ï∂îÍ∞Ä
                                    </button>
                                    <button onclick="saveFixedExpensesToCloud()" id="btnSaveFixed"
                                        style="padding:8px 14px; background:#059669; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        üíæ Ï†ÄÏû•
                                    </button>
                                    <button onclick="loadFixedExpensesFromCloud()" id="btnLoadFixed"
                                        style="padding:8px 14px; background:#3b82f6; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        üîÑ Î∂àÎü¨Ïò§Í∏∞
                                    </button>
                                </div>
                            </div>
                            <p style="margin:0 0 12px 0; font-size:12px; color:#92400e;">Îß§Ïõî ÏûêÎèôÏúºÎ°ú Î∞òÏòÅÎêòÎäî Í≥†Ï†ï ÎπÑÏö©ÏûÖÎãàÎã§. (Ïòà: ÏûÑÎåÄÎ£å,
                                Ïù∏Í±¥ÎπÑ, Ï∞®ÎüâÏö¥ÏòÅÎπÑ Îì±)</p>
                            <table
                                style="width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden;">
                                <thead>
                                    <tr style="background:#fef3c7;">
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:40px;">
                                        </th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:120px;">
                                            ÎåÄÎ∂ÑÎ•ò</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e;">
                                            ÏÉÅÏÑ∏ÎÇ¥Ïó≠</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:120px;">
                                            Ïõî Í≥†Ï†ïÍ∏àÏï°</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:100px;">
                                            Í≤∞Ï†úÏàòÎã®</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:100px;">
                                            Ï¶ùÎπôÏûêÎ£å</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:60px;">
                                            ÌôúÏÑ±Ìôî</th>
                                    </tr>
                                </thead>
                                <tbody id="fixedExpenseTableBody">
                                    <!-- JSÎ°ú Î†åÎçîÎßÅ -->
                                </tbody>
                            </table>
                        </div>

                        <table class="data-table" style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:linear-gradient(135deg, #f0fdf4, #ecfdf5);">
                                    <th
                                        style="width:50px; padding:12px 8px; border:1px solid #d1fae5; text-align:center; font-size:12px; color:#059669;">
                                        No</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ÎÇ†Ïßú</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ÎåÄÎ∂ÑÎ•ò</th>
                                    <th
                                        style="width:200px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ÏÉÅÏÑ∏ÎÇ¥Ïó≠</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        Í∏àÏï°</th>
                                    <th
                                        style="width:100px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        Í≤∞Ï†úÏàòÎã®</th>
                                    <th
                                        style="width:100px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        Ï¶ùÎπôÏûêÎ£å</th>
                                    <th
                                        style="width:200px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ÎπÑÍ≥†</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <!-- JSÎ°ú Î†åÎçîÎßÅ -->
                            </tbody>
                            <tfoot>
                                <tr style="background:linear-gradient(135deg, #fef3c7, #fde68a);">
                                    <td colspan="4"
                                        style="padding:14px 10px; text-align:center; font-weight:700; color:#92400e; font-size:14px;">
                                        üíµ Ï¥ù Ïö¥ÏòÅÎπÑ Ìï©Í≥Ñ</td>
                                    <td style="padding:14px 10px; text-align:right; color:#dc2626; font-weight:700; font-size:16px;"
                                        id="totalExpenseFooter">‚Ç©0</td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Empty State -> Global Main Board -->
            <div id="mainBoardView" class="main-board-wrapper">
                <div class="main-board-header">
                    <div>
                        <h1>Project Overview</h1>
                        <p style="color:#86868b; font-size:13px; margin-top:4px; opacity:0.8;">Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©ÏùÑ ÌïúÎààÏóê ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                    </div>
                    <div class="main-board-stats">
                        <select class="board-filter-select" id="mbYearFilter" onchange="renderMainBoard()">
                            <option value="">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>
                            <option value="2026">2026ÎÖÑ</option>
                            <option value="2025">2025ÎÖÑ</option>
                            <option value="2024">2024ÎÖÑ</option>
                        </select>
                        <select class="board-filter-select" id="mbStatusFilter" onchange="renderMainBoard()">
                            <option value="">Ï†ÑÏ≤¥ ÏÉÅÌÉú</option>
                            <option value="consulting">ÏÉÅÎã¥Ï§ë</option>
                            <option value="estimate">Í≤¨Ï†Å</option>
                            <option value="contracted">Í≥ÑÏïΩÏôÑÎ£å</option>
                            <option value="in_progress">Í≥µÏÇ¨Ï§ë</option>
                            <option value="completed">ÏôÑÎ£å</option>
                            <option value="as_done">A/S</option>
                        </select>

                        <div class="board-stat-item">
                            <div class="board-stat-label">Total Projects</div>
                            <div class="board-stat-value" id="statsTotal">0</div>
                        </div>
                        <div class="board-stat-item">
                            <div class="board-stat-label">In Progress</div>
                            <div class="board-stat-value" id="statsProgress" style="color:#0071e3;">0</div>
                        </div>
                    </div>
                </div>

                <div id="mainBoardGrid" class="main-board-grid">
                    <!-- Project Cards will be rendered here via JS -->
                </div>

                <button onclick="newCustomer()" style="
                    position: fixed;
                    bottom: 40px;
                    right: 40px;
                    width: 60px;
                    height: 60px;
                    border-radius: 30px;
                    background: #0071e3;
                    color: white;
                    border: none;
                    text-align: center;
                    font-size: 24px;
                    box-shadow: 0 4px 12px rgba(0,113,227,0.3);
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    +
                </button>
            </div>

            <!-- Í≥†Í∞ù ÏÉÅÏÑ∏ Î∑∞ -->
            <div id="customerView" style="display:none; position:relative;">
                <!-- Ï†ëÍ∑º Ï†úÌïú Ïò§Î≤ÑÎ†àÏù¥ -->
                <div id="accessDeniedOverlay" class="access-denied-overlay">
                    <div style="font-size:48px; margin-bottom:16px;">üîí</div>
                    <h3 style="margin-bottom:10px;">Ï†ëÍ∑ºÏù¥ Ï†úÌïúÎêú Í≥†Í∞ùÏûÖÎãàÎã§</h3>
                    <p style="color:#86868b; margin-bottom:24px;">Ïù¥ Í≥†Í∞ù Ï†ïÎ≥¥Ïóê Ï†ëÍ∑ºÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§</p>
                    <div style="display:flex; gap:8px;">
                        <input type="password" id="lockedPasswordInput" class="login-input"
                            style="width:200px; margin:0;" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•"
                            onkeypress="if(event.key==='Enter')unlockCustomerAccess()">
                        <button class="btn btn-primary" onclick="unlockCustomerAccess()">ÌôïÏù∏</button>
                    </div>
                </div>
                <!-- Í≥†Í∞ù Ìó§Îçî -->
                <div class="customer-header-bar">
                    <div class="customer-header-left">
                        <h2 id="headerCustomerName">Í≥†Í∞ùÎ™Ö</h2>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <div class="customer-id-display" id="headerCustomerId">DJ-000000</div>
                            <button id="lockToggleBtn" onclick="toggleCustomerLock()"
                                class="lock-toggle-btn unlocked">üîì Ïó¥Î¶º</button>
                            <span id="headerCreatedBy" style="font-size:10px;color:#86868b;">üìù -</span>
                        </div>
                    </div>
                    <div class="customer-header-right">
                        <select id="customerStatus" onchange="updateStatus()">
                            <option value="consulting">üü° ÏÉÅÎã¥Ï§ë</option>
                            <option value="estimate">üìã Í≤¨Ï†ÅÏÑú</option>
                            <option value="hold">‚ö™ Î≥¥Î•ò(Í≥†ÎØºÏ§ë)</option>
                            <option value="budget_over">üî¥ ÏòàÏÇ∞Ï¥àÍ≥º(ÎØ∏Í≥ÑÏïΩ)</option>
                            <option value="other_company">üü£ ÌÉÄÏóÖÏ≤¥ÏÑ†Ï†ï(ÎØ∏Í≥ÑÏïΩ)</option>
                            <option value="contracted">üü¢ Í≥ÑÏïΩÏôÑÎ£å</option>
                            <option value="in_progress">üü£ Í≥µÏÇ¨Ï§ë</option>
                            <option value="completed">üü¢ Í≥µÏÇ¨ÏôÑÎ£å</option>
                            <option value="as_done">ü©µ A/S</option>
                        </select>
                        <span id="asEndDateDisplay"
                            style="display:none; padding:8px 12px; background:rgba(255,255,255,0.2); border-radius:6px; font-size:11px;">A/S
                            ~</span>
                        <button onclick="saveData()"
                            style="padding: 6px 12px; margin-left: 8px; border: 1px solid #ffcfd6; background: #fff0f5; border-radius: 6px; font-size: 12px; cursor: pointer; color: #d63384; font-weight: 600;">üíæ
                            Ï†ÄÏû•</button>
                        <button onclick="exportToNotion('all', event);"
                            style="padding: 6px 12px; margin-left: 8px; border: none; background: #37352f; border-radius: 6px; font-size: 12px; cursor: pointer; color: white; display: inline-flex; align-items: center; gap: 4px; font-weight: 500;"
                            title="Í≥†Í∞ùÏ†ïÎ≥¥, Ïä§ÏºÄÏ§Ñ, Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏, A/S Î¶¨Ïä§Ìä∏Î•º Î™®Îëê ÎÖ∏ÏÖòÏúºÎ°ú ÎÇ¥Î≥¥ÎÉÖÎãàÎã§">
                            üì§ ÌÜµÌï© ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                        <button onclick="printCurrentCustomerAll()"
                            style="padding: 6px 12px; margin-left: 8px; border: 1px solid #d2d2d7; background: white; border-radius: 6px; font-size: 12px; cursor: pointer; color: #1d1d1f;">üñ®Ô∏è
                            ÌÜµÌï©Ïù∏ÏáÑ</button>
                        <button class="delete-btn" onclick="deleteCurrentCustomer()">üóëÔ∏è</button>
                    </div>
                </div>

                <div class="customer-tabs">
                    <button class="customer-tab active" onclick="showCustomerTab('dashboard')" data-tab="dashboard">üè†
                        Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú</button>
                    <button class="customer-tab" onclick="showCustomerTab('info')" data-tab="info">üë§
                        Í≥†Í∞ùÏ†ïÎ≥¥</button>
                    <button class="customer-tab" onclick="showCustomerTab('contract')" data-tab="contract">üìã
                        ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú</button>
                    <button class="customer-tab" onclick="showCustomerTab('cover')" data-tab="cover">üìä ÌëúÏßÄÍ≥ÑÏïΩÏÑú</button>
                    <button class="customer-tab" onclick="showCustomerTab('estimate')" data-tab="estimate">üìù
                        Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú</button>
                    <button class="customer-tab" onclick="showCustomerTab('cost')" data-tab="cost">üí∞ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú</button>
                    <button class="customer-tab" onclick="showCustomerTab('schedule')" data-tab="schedule">üìÖ
                        Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ</button>
                    <button class="customer-tab" onclick="showCustomerTab('checklist')" data-tab="checklist">‚úÖ
                        Í≥µÏ†ï Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</button>
                    <button class="customer-tab" onclick="showCustomerTab('as_list')" data-tab="as_list">üõ†Ô∏è
                        A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏</button>
                    <button class="customer-tab" onclick="showCustomerTab('settlement')" data-tab="settlement">üí∞
                        Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû•</button>
                    <button class="customer-tab" onclick="showCustomerTab('stats')" data-tab="stats">üìä Í≥µÏ†ïÎ≥Ñ
                        ÏàòÏùµÍ∏à</button>
                </div>

                <!-- ÎåÄÏãúÎ≥¥Îìú Ìå®ÎÑê (New) -->
                <div class="tab-panel active" id="panel-dashboard">
                    <div class="dashboard-container">
                        <div class="dashboard-grid">
                            <!-- 1. ÌîÑÎ°úÌïÑ Ïπ¥Îìú -->
                            <div class="dashboard-card card-profile">
                                <div class="profile-header">
                                    <div class="profile-avatar" id="dashAvatar">?</div>
                                    <div class="profile-info">
                                        <h2 id="dashName">Í≥†Í∞ùÎ™Ö</h2>
                                        <p id="dashPhone">ÏÑ±Î™Ö(Ïó∞ÎùΩÏ≤ò) | Î∞∞Ïö∞Ïûê(Ïó∞ÎùΩÏ≤ò)</p>
                                    </div>
                                </div>
                                <div class="profile-details">
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">ÌòÑÏû•Ï£ºÏÜå</div>
                                        <div class="profile-detail-value" id="dashAddress">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">ÌèâÏàò/Ïú†Ìòï</div>
                                        <div class="profile-detail-value" id="dashAreaType">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">Í≥ÑÏïΩÏùº</div>
                                        <div class="profile-detail-value" id="dashContractDate">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">Ï¥ù Í≥ÑÏïΩÍ∏àÏï° (VAT Ìè¨Ìï®)</div>
                                        <div class="profile-detail-value" id="dashContractAmount">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. ÏÉÅÌÉú/ÏùºÏ†ï Ïπ¥Îìú -->
                            <div class="dashboard-card card-status">
                                <h3>üöÄ ÏßÑÌñâ ÌòÑÌô©</h3>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                                    <span id="dashStatusBadge" class="status-badge"
                                        style="font-size:14px; padding:6px 12px; background:#f5f5f7; color:#86868b;">ÏÉÅÎã¥Ï§ë</span>
                                    <span id="dashDDay" class="d-day-badge" style="display:none;">D-Day</span>
                                </div>
                                <!-- Í∏∞Í∞Ñ Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú -->
                                <div
                                    style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px; font-size:13px;">
                                    <div style="background:#f5f5f7; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#86868b; font-size:11px; margin-bottom:4px;">Í≥µÏÇ¨ Í∏∞Í∞Ñ</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashPeriod">- ~ -</div>
                                    </div>
                                    <div style="background:#f5f5f7; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#86868b; font-size:11px; margin-bottom:4px;">Ïù¥ÏÇ¨ÏòàÏ†ïÏùº</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashMovingDate">-</div>
                                    </div>
                                    <div style="background:#e8f5e9; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#2e7d32; font-size:11px; margin-bottom:4px;">A/S Í∏∞Í∞Ñ (ÏûîÍ∏àÏùº+12Í∞úÏõî)
                                        </div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashASPeriod">-</div>
                                    </div>
                                    <div style="background:#e3f2fd; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#1565c0; font-size:11px; margin-bottom:4px;">ÌôîÏû•Ïã§ ÎàÑÏàò Î≥¥Ï¶ù</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashBathroomWarranty">-</div>
                                    </div>
                                </div>
                                <!-- ÏÉÅÌÉú ÌÉÄÏûÑÎùºÏù∏ -->
                                <div class="status-timeline">
                                    <div class="timeline-bar"></div>
                                    <div class="timeline-progress" id="dashProgressWidth" style="width: 0%;"></div>
                                    <!-- Steps -->
                                    <div class="timeline-step active" id="step-consulting">
                                        <div class="timeline-label">ÏÉÅÎã¥</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-contract">
                                        <div class="timeline-label">Í≥ÑÏïΩ</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-construction">
                                        <div class="timeline-label">Í≥µÏÇ¨Ï§ë</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-completed">
                                        <div class="timeline-label">ÏôÑÎ£å</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. ÏõêÍ∞Ä/Ï†ïÏÇ∞ ÏöîÏïΩ (ÌÅ¥Î¶≠ Ïãú ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎ°ú Ïù¥Îèô) -->
                            <button class="dashboard-card card-cost-summary" onclick="showCustomerTab('stats')">
                                <h3>üí∞ Ïö¥ÏòÅ ÏõêÍ∞Ä ÏöîÏïΩ <span
                                        style="font-size:12px; font-weight:400; opacity:0.7; margin-left:auto;">ÌÅ¥Î¶≠ÌïòÏó¨ ÏÉÅÏÑ∏
                                        Î≥¥Í∏∞ ‚Üí</span></h3>
                                <div class="card-content">
                                    <div class="cost-summary-grid">
                                        <div class="cost-block">
                                            <div class="cost-block-title">Ï¥ù Í≥ÑÏïΩÍ∏àÏï°</div>
                                            <div class="cost-block-value" id="dashTotalAmount">0Ïõê</div>
                                            <div class="cost-block-sub">
                                                Í≥µÍ∏â <span id="dashTotalSupply">0</span><br>
                                                Î∂ÄÍ∞ÄÏÑ∏ <span id="dashTotalVat">0</span>
                                            </div>
                                            <div class="cost-block-badge">
                                                ÌèâÎãπ <span id="dashTotalPerPy">0</span>
                                            </div>
                                        </div>

                                        <div class="cost-block">
                                            <div class="cost-block-title">Ï¥ù ÏßÄÏ∂ú(ÏõêÍ∞Ä)</div>
                                            <div class="cost-block-value" id="dashTotalCost">0Ïõê</div>
                                            <div class="cost-block-sub">
                                                -<br>
                                                -
                                            </div>
                                            <div class="cost-block-badge">
                                                ÌèâÎãπ <span id="dashCostPerPy">0</span>
                                            </div>
                                        </div>

                                        <div class="cost-block">
                                            <div class="cost-block-title">ÏòàÏÉÅ ÏàúÏù¥Ïùµ (ÏÑ§Í≥Ñ+Ïù¥Ïú§, VAT Î≥ÑÎèÑ)</div>
                                            <div class="cost-block-value" id="dashNetProfit">0Ïõê</div>
                                            <div class="cost-block-sub">
                                                ÏàòÏùµÎ•† <span id="dashEstRate"
                                                    style="font-weight:600; color:#30d158;">0%</span> <span
                                                    style="font-size:11px; opacity:0.7;">(VAT Î≥ÑÎèÑ)</span><br>
                                                Î∂ÄÍ∞ÄÏÑ∏ <span id="dashProfitVat">0</span> Î≥ÑÎèÑ
                                            </div>
                                            <div class="cost-block-badge profit">
                                                ÌèâÎãπ <span id="dashProfitPerPy">0</span>
                                            </div>
                                        </div>

                                        <div class="cost-block">
                                            <div class="cost-block-title">Ïã§Ï†ú ÏàúÏù¥Ïùµ (Í≥ÑÏïΩ-ÏßÄÏ∂ú)</div>
                                            <div class="cost-block-value" id="dashActualProfit">0Ïõê</div>
                                            <div class="cost-block-sub">
                                                ÏàòÏùµÎ•† <span id="dashActualRate">0%</span><br>
                                                Ï∞®Ïù¥ <span id="dashProfitDiff">0</span>
                                            </div>
                                            <div class="cost-block-badge" id="dashActualPerPyBadge">
                                                ÌèâÎãπ <span id="dashActualPerPy">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </button>

                            <!-- 4. ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í∑∏Î¶¨Îìú -->
                            <!-- 4. ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í∑∏Î¶¨Îìú (ÏÇ≠Ï†úÎê®) -->
                        </div>
                    </div>
                </div>

                <!-- Í≥†Í∞ùÏ†ïÎ≥¥ Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-info">
                    <div class="document-wrapper" id="customerInfoDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>Í≥†Í∞ù Ï†ïÎ≥¥</h1>
                                <div class="subtitle">Customer Information</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('customer', event);"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;"
                                    title="ÎÖ∏ÏÖòÏúºÎ°ú Í≥†Í∞ù Ï†ïÎ≥¥Îßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                                    üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                </button>
                                <button class="pdf-btn" onclick="downloadPDF('customerInfoDoc', 'Í≥†Í∞ùÏ†ïÎ≥¥')">üñ®Ô∏è
                                    Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <div class="section">
                                <div class="section-title"><span class="section-number">01</span> Ïù∏Ï†ÅÏÇ¨Ìï≠</div>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>ÏÑ±Î™Ö</label>
                                        <input type="text" class="customer-field" data-field="clientName"
                                            placeholder="Í≥†Í∞ù ÏÑ±Ìï®" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Ïó∞ÎùΩÏ≤ò</label>
                                        <input type="text" class="customer-field" data-field="clientPhone"
                                            placeholder="010-0000-0000"
                                            oninput="autoFormatPhone(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö</label>
                                        <input type="text" class="customer-field" data-field="spouseName"
                                            placeholder="Î∞∞Ïö∞Ïûê ÏÑ±Ìï®" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Î∞∞Ïö∞Ïûê Ïó∞ÎùΩÏ≤ò</label>
                                        <input type="text" class="customer-field" data-field="spousePhone"
                                            placeholder="010-0000-0000"
                                            oninput="autoFormatPhone(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item full">
                                        <label>Ï£ºÏÜå</label>
                                        <input type="text" class="customer-field" data-field="clientAddress"
                                            placeholder="Í≥†Í∞ù Ï£ºÏÜå" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Ïù¥Î©îÏùº</label>
                                        <input type="email" class="customer-field" data-field="clientEmail"
                                            placeholder="email@example.com" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Ïú†ÏûÖÍ≤ΩÎ°ú</label>
                                        <input type="text" class="customer-field" data-field="clientSource"
                                            placeholder="Î∏îÎ°úÍ∑∏, ÏÜåÍ∞ú Îì±" oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">02</span> Í≥µÏÇ¨Ï†ïÎ≥¥</div>
                                <div class="info-grid">
                                    <div class="info-item full">
                                        <label>Í≥µÏÇ¨Î™Ö</label>
                                        <input type="text" class="customer-field synced-input" data-field="projectName"
                                            data-sync="projectName" onchange="updateCustomerField(this)"
                                            placeholder="Í≥µÏÇ¨Î™Ö ÏûÖÎ†•">
                                    </div>
                                    <div class="info-item full">
                                        <label>ÌòÑÏû•Ï£ºÏÜå</label>
                                        <input type="text" class="customer-field" data-field="siteAddress"
                                            placeholder="ÌòÑÏû• Ï£ºÏÜå" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ÌèâÏàò</label>
                                        <input type="text" class="customer-field" data-field="area" placeholder="00Ìèâ"
                                            oninput="updateCustomerField(this)"
                                            onblur="autoFormatArea(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Í±¥Î¨ºÏú†Ìòï</label>
                                        <input type="text" class="customer-field" data-field="buildingType"
                                            placeholder="ÏïÑÌååÌä∏, ÎπåÎùº Îì±" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Í≥µÏÇ¨Í∏∞Í∞Ñ (ÏãúÏûë ~ Ï¢ÖÎ£å)</label>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="date" id="constructionStartInput" class="customer-field"
                                                style="flex: 1; padding: 8px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;"
                                                oninput="updateConstructionPeriod()">
                                            <span>~</span>
                                            <input type="date" id="constructionEndInput" class="customer-field"
                                                style="flex: 1; padding: 8px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;"
                                                oninput="updateConstructionPeriod()">
                                        </div>
                                        <input type="hidden" class="customer-field" data-field="constructionPeriod"
                                            id="hiddenConstructionPeriod">
                                    </div>
                                    <div class="info-item">
                                        <label>Ïù¥ÏÇ¨ÏòàÏ†ïÏùº</label>
                                        <input type="date" class="customer-field" data-field="movingDate"
                                            placeholder="Ïó∞ÎèÑ. Ïõî. Ïùº." oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ÏûîÍ∏àÏùº</label>
                                        <input type="date" class="customer-field" data-field="finalPaymentDate"
                                            oninput="updateCustomerField(this); calculateAsEndDate();">
                                    </div>
                                    <div class="info-item">
                                        <label>A/S Í∏∞Í∞Ñ (ÏûîÍ∏àÏùº +12Í∞úÏõî)</label>
                                        <input type="text" class="customer-field" data-field="asEndDate"
                                            placeholder="ÏûêÎèô Í≥ÑÏÇ∞" readonly
                                            style="background:#f0f7ff; color:#0071e3; font-weight:600;">
                                    </div>
                                    <div class="info-item">
                                        <label>Í∏∞ÏóÖÏù¥Ïú®</label>
                                        <input type="text" class="customer-field" data-field="profitRate"
                                            placeholder="15%" value="15%" oninput="updateCustomerField(this)"
                                            onblur="autoFormatProfit(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Í≥µÏÇ¨ Îã¥ÎãπÏûê</label>
                                        <input type="text" class="customer-field" data-field="manager"
                                            placeholder="ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)" value="ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Í≥ÑÏïΩÏùº</label>
                                        <input type="date" class="customer-field" data-field="contractDate"
                                            placeholder="Ïó∞ÎèÑ. Ïõî. Ïùº." oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>Ï¥ù Í≥ÑÏïΩÍ∏àÏï° (VAT Ìè¨Ìï®)</label>
                                        <input type="text" class="customer-field" data-field="totalAmount"
                                            placeholder="‚Ç© 0,000,000" oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">03</span> ÎåÄÍ∏à ÏßÄÍ∏â</div>
                                <div class="payment-grid">
                                    <div class="payment-item">
                                        <label>1Ï∞® Í≥ÑÏïΩÍ∏à</label>
                                        <input type="text" class="customer-field" data-field="payment1" placeholder="‚Ç©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>2Ï∞® Ï§ëÎèÑÍ∏à</label>
                                        <input type="text" class="customer-field" data-field="payment2" placeholder="‚Ç©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>3Ï∞® Ï§ëÎèÑÍ∏à</label>
                                        <input type="text" class="customer-field" data-field="payment3" placeholder="‚Ç©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>4Ï∞® Ï§ëÎèÑÍ∏à</label>
                                        <input type="text" class="customer-field" data-field="payment4" placeholder="‚Ç©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>ÏûîÍ∏à</label>
                                        <input type="text" class="customer-field" data-field="payment5" placeholder="‚Ç©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">04</span> Î©îÎ™®</div>
                                <div class="info-grid">
                                    <div class="info-item full">
                                        <label>Í≥†Í∞ù ÏöîÏ≤≠ÏÇ¨Ìï≠</label>
                                        <textarea class="customer-field" data-field="customerRequest" rows="3"
                                            placeholder="Í≥†Í∞ùÏù¥ ÏöîÏ≤≠Ìïú ÏÇ¨Ìï≠ÏùÑ Í∏∞Î°ùÌïòÏÑ∏Ïöî..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                    <div class="info-item full">
                                        <label>ÌäπÏïΩÏÇ¨Ìï≠</label>
                                        <textarea class="customer-field" data-field="specialNote" rows="3"
                                            placeholder="ÌäπÏïΩÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                    <div class="info-item full">
                                        <label>ÎÇ¥Î∂Ä Î©îÎ™®</label>
                                        <textarea class="customer-field" data-field="internalMemo" rows="3"
                                            placeholder="ÎÇ¥Î∂Ä Ï∞∏Í≥†Ïö© Î©îÎ™®..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-contract">
                    <div class="document-wrapper" id="contractDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>Ïù∏ÌÖåÎ¶¨Ïñ¥ Í≥µÏÇ¨ ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú</h1>
                                <div class="subtitle">Interior Construction Contract</div>
                            </div>
                            <button class="pdf-btn" onclick="downloadPDF('contractDoc', 'ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú')">üñ®Ô∏è Ïù∏ÏáÑ/PDF</button>
                        </div>
                        <div class="doc-content">
                            <p
                                style="background:#f5f5f7; padding:12px; border-radius:6px; margin-bottom:16px; line-height:1.5; font-size:11px; color:#424245;">
                                Î∞úÏ£ºÏûê(Ïù¥Ìïò "Í∞ë")ÏôÄ ÏàòÍ∏âÏù∏(Ïù¥Ìïò "ÏùÑ")ÏùÄ ÏïÑÎûòÏùò Ïù∏ÌÖåÎ¶¨Ïñ¥ Í≥µÏÇ¨Ïóê Í¥ÄÌïòÏó¨ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÎèÑÍ∏âÍ≥ÑÏïΩÏùÑ Ï≤¥Í≤∞ÌïòÍ≥†, Ïã†ÏùòÏÑ±Ïã§Ïùò ÏõêÏπôÏóê Îî∞Îùº Ïù¥Î•º Ïù¥ÌñâÌï† Í≤ÉÏùÑ
                                ÌôïÏïΩÌï©ÎãàÎã§.
                            </p>

                            <div class="section">
                                <div class="section-title"><span class="section-number">01</span> Í≥µÏÇ¨ Í∞úÏöî</div>
                                <div class="info-grid">
                                    <div class="info-item full"><label>Í≥µÏÇ¨Î™Ö</label><input type="text"
                                            class="synced-input" data-sync="projectName" readonly></div>
                                    <div class="info-item full"><label>ÌòÑÏû•Ï£ºÏÜå</label><input type="text"
                                            class="synced-input" data-sync="siteAddress" readonly></div>
                                    <div class="info-item"><label>Í≥µÏÇ¨Í∏∞Í∞Ñ</label><input type="text" class="synced-input"
                                            data-sync="constructionPeriod" readonly></div>
                                    <div class="info-item"><label>Ïù¥ÏÇ¨ÏòàÏ†ïÏùº</label><input type="text" class="synced-input"
                                            data-sync="movingDate" readonly></div>
                                    <div class="info-item full"><label>Ï¥ù Í≥ÑÏïΩÍ∏àÏï° (VAT Ìè¨Ìï®)</label><input type="text"
                                            class="synced-input" data-sync="totalAmount" readonly></div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">02</span> ÎåÄÍ∏à ÏßÄÍ∏â ÏùºÏ†ï</div>
                                <div class="payment-grid">
                                    <div class="payment-item"><label>1Ï∞® Í≥ÑÏïΩÍ∏à</label><input type="text"
                                            class="synced-input" data-sync="payment1" readonly></div>
                                    <div class="payment-item"><label>2Ï∞® Ï§ëÎèÑÍ∏à</label><input type="text"
                                            class="synced-input" data-sync="payment2" readonly></div>
                                    <div class="payment-item"><label>3Ï∞® Ï§ëÎèÑÍ∏à</label><input type="text"
                                            class="synced-input" data-sync="payment3" readonly></div>
                                    <div class="payment-item"><label>4Ï∞® Ï§ëÎèÑÍ∏à</label><input type="text"
                                            class="synced-input" data-sync="payment4" readonly></div>
                                    <div class="payment-item"><label>ÏûîÍ∏à</label><input type="text" class="synced-input"
                                            data-sync="payment5" readonly></div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">03</span> Í≥ÑÏïΩ Ï°∞Í±¥</div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú1Ï°∞ (Í≥ÑÏïΩÏùò Î™©Ï†Å)</div>
                                    <div class="clause-content">Î≥∏ Í≥ÑÏïΩÏùÄ Í∞ëÏù¥ ÏùÑÏóêÍ≤å ÏÉÅÍ∏∞ ÌòÑÏû•Ïùò Ïù∏ÌÖåÎ¶¨Ïñ¥ Í≥µÏÇ¨Î•º ÎèÑÍ∏âÌïòÍ≥†, ÏùÑÏùÄ Ïù¥Î•º ÏÑ±Ïã§Ìûà ÏãúÍ≥µÌïòÏó¨ ÏôÑÍ≥µÌï®ÏùÑ
                                        Î™©Ï†ÅÏúºÎ°ú Ìï©ÎãàÎã§.</div>
                                </div>
                                <div class="clause important-clause">
                                    <div class="clause-title">‚ö† Ï†ú2Ï°∞ (Í≥ÑÏïΩÏÑú Î∞è Í≤¨Ï†ÅÏÑúÏùò Ìö®Î†•)</div>
                                    <div class="clause-content">‚ë† Î™®Îì† Í≥ÑÏïΩÏÑú Î∞è Í≤¨Ï†ÅÏÑúÏóêÎäî Î∞òÎìúÏãú Í∞ëÍ≥º ÏùÑ ÏåçÎ∞©Ïùò ÏßÄÏû•(ÏßÅÏù∏)ÏùÑ ÎÇ†Ïù∏ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.<br>‚ë°
                                        ÏßÄÏû•Ïù¥ ÎÇ†Ïù∏ÎêòÏßÄ ÏïäÏùÄ Î¨∏ÏÑúÎäî Î≤ïÏ†Å Ìö®Î†•Ïù¥ ÏóÜÏäµÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú3Ï°∞ (Í≥µÏÇ¨ Î≤îÏúÑ Î∞è ÎÇ¥Ïö©)</div>
                                    <div class="clause-content">Í≥µÏÇ¨ Î≤îÏúÑ Î∞è ÏÑ∏Î∂Ä ÎÇ¥Ïö©ÏùÄ Î≥ÑÎèÑ Ï≤®Î∂ÄÎêú Í≤¨Ï†ÅÏÑú Î∞è ÎèÑÎ©¥Ïóê Îî∞Î¶ÖÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú4Ï°∞ (ÎåÄÍ∏à ÏßÄÍ∏â)</div>
                                    <div class="clause-content">Í≥ÑÏïΩÍ∏àÏï°ÏùÄ ÏúÑ ÌëúÏóê Î™ÖÏãúÎêú ÏßÄÍ∏â ÏùºÏ†ïÏóê Îî∞Îùº ÏßÄÍ∏âÌï©ÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú5Ï°∞ (Í≥µÏÇ¨ Í∏∞Í∞Ñ)</div>
                                    <div class="clause-content">ÏùÑÏùÄ Í≥ÑÏïΩÏÑúÏóê Î™ÖÏãúÎêú Í≥µÏÇ¨ Í∏∞Ìïú ÎÇ¥Ïóê Í≥µÏÇ¨Î•º ÏôÑÎ£åÌïòÏó¨Ïïº Ìï©ÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú6Ï°∞ (ÏßÄÏ≤¥ÏÉÅÍ∏à)</div>
                                    <div class="clause-content">Ï†ïÎãπÌïú ÏÇ¨Ïú† ÏóÜÏù¥ Í≥µÍ∏∞ ÏßÄÏ≤¥ Ïãú Í≥ÑÏïΩÍ∏àÏï°Ïùò 1/1000 ÏßÄÏ≤¥ÏÉÅÍ∏àÏùÑ Î∂ÄÎã¥Ìï©ÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú7Ï°∞ (ÌïòÏûêÎ≥¥Ïàò)</div>
                                    <div class="clause-content">ÏùÑÏùÄ Í≥µÏÇ¨ ÏôÑÎ£åÏùºÎ°úÎ∂ÄÌÑ∞ 1ÎÖÑÍ∞Ñ ÌïòÏûêÏóê ÎåÄÌï¥ Î¨¥ÏÉÅ Î≥¥Ïàò Ï±ÖÏûÑÏùÑ ÏßëÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú8Ï°∞ (ÏïàÏ†Ñ Í¥ÄÎ¶¨)</div>
                                    <div class="clause-content">ÏùÑÏùÄ Í≥µÏÇ¨ Í∏∞Í∞Ñ Ï§ë ÌòÑÏû•Ïùò ÏïàÏ†Ñ Í¥ÄÎ¶¨ Ï±ÖÏûÑÏùÑ ÏßëÎãàÎã§.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">Ï†ú9Ï°∞ (Î∂ÑÏüÅ Ìï¥Í≤∞)</div>
                                    <div class="clause-content">Î∂ÑÏüÅÏùÄ ÏùÑÏùò Ï£ºÏÜåÏßÄ Í¥ÄÌï† Î≤ïÏõêÏùÑ Ï†ÑÏÜç Í¥ÄÌï†Î°ú Ìï©ÎãàÎã§.</div>
                                </div>
                            </div>

                            <div class="special-note">
                                <div class="special-note-title">üìù ÌäπÏïΩÏÇ¨Ìï≠</div>
                                <textarea class="synced-input" data-sync="specialNote" readonly
                                    style="min-height:40px;"></textarea>
                            </div>

                            <div class="date-box">
                                <label>Í≥ÑÏïΩ Ï≤¥Í≤∞Ïùº</label>
                                <input type="text" class="synced-input" data-sync="contractDate" readonly>
                            </div>

                            <div class="signature-grid">
                                <div class="signature-card">
                                    <h4>Î∞úÏ£ºÏûê (Í∞ë)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ÏÑ±Î™Ö</label><input type="text" class="synced-input"
                                                data-sync="clientName" readonly></div>
                                        <div class="sig-field"><label>Ïó∞ÎùΩÏ≤ò</label><input type="text" class="synced-input"
                                                data-sync="clientPhone" readonly></div>
                                    </div>
                                    <div class="sig-field"><label>Ï£ºÏÜå</label><input type="text" class="synced-input"
                                            data-sync="clientAddress" readonly></div>
                                    <div class="signature-box">ÏÑúÎ™Ö ÎòêÎäî ÎÇ†Ïù∏</div>
                                    <div class="stamp-warning">‚ö† ÏßÄÏû•(ÏßÅÏù∏) ÌïÑÏàò ÎÇ†Ïù∏</div>
                                </div>
                                <div class="signature-card">
                                    <h4>ÏàòÍ∏âÏù∏ (ÏùÑ)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ÏÉÅÌò∏</label><input type="text" value="ÎîîÏûêÏù∏ÏßÄÍ∑∏"
                                                readonly></div>
                                        <div class="sig-field"><label>ÎåÄÌëúÏûê</label><input type="text" id="companyRep"
                                                placeholder="ÎåÄÌëúÏûêÎ™Ö"></div>
                                    </div>
                                    <div class="sig-field"><label>ÏÇ¨ÏóÖÏû• Ï£ºÏÜå</label><input type="text" value="Í≤ΩÍ∏∞ÎèÑ Ïö©Ïù∏Ïãú Î≥¥Ï†ïÎèô"
                                            readonly></div>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏</label><input type="text"
                                                id="companyRegNo" placeholder="000-00-00000"></div>
                                        <div class="sig-field"><label>Ïó∞ÎùΩÏ≤ò</label><input type="text" id="companyPhone"
                                                placeholder="Ïó∞ÎùΩÏ≤ò"></div>
                                    </div>
                                    <div class="signature-box">ÏÑúÎ™Ö ÎòêÎäî ÎÇ†Ïù∏</div>
                                    <div class="stamp-warning">‚ö† ÏßÄÏû•(ÏßÅÏù∏) ÌïÑÏàò ÎÇ†Ïù∏</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÌëúÏßÄÍ≥ÑÏïΩÏÑú Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-cover">
                    <div class="document-wrapper" id="coverDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>Í≥µÏÇ¨ÎèÑÍ∏â ÌëúÏßÄÍ≥ÑÏïΩÏÑú</h1>
                                <div class="subtitle">Construction Contract Summary</div>
                            </div>
                            <button class="pdf-btn" onclick="downloadPDF('coverDoc', 'ÌëúÏßÄÍ≥ÑÏïΩÏÑú')">üñ®Ô∏è Ïù∏ÏáÑ/PDF</button>
                        </div>
                        <div class="doc-content">
                            <div class="info-grid" style="margin-bottom:16px;">
                                <div class="info-item full"><label>Í≥µÏÇ¨Î™Ö</label>
                                    <div class="synced-display" data-sync="projectName"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item full"><label>ÌòÑÏû•Ï£ºÏÜå</label>
                                    <div class="synced-display" data-sync="siteAddress"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item"><label>Í≥†Í∞ùÎ™Ö</label>
                                    <div class="synced-display" data-sync="clientName"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item"><label>Í≥µÏÇ¨Í∏∞Í∞Ñ</label>
                                    <div class="synced-display" data-sync="constructionPeriod"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                            </div>

                            <div class="section-title"><span class="section-number">01</span> Í≥µÏÇ¨ Ìï≠Î™©Î≥Ñ Í≥ÑÏïΩÍ∏àÏï°</div>
                            <table class="summary-table">
                                <thead>
                                    <tr>
                                        <th style="width:30px;">No</th>
                                        <th>Í≥µÏÇ¨ Ìï≠Î™©</th>
                                        <th style="width:130px;text-align:right;">Í≥ÑÏïΩ Í∏àÏï°</th>
                                    </tr>
                                </thead>
                                <tbody id="coverTableBody"></tbody>
                            </table>

                            <div class="date-box">
                                <label>Í≥ÑÏïΩ Ï≤¥Í≤∞Ïùº</label>
                                <div class="synced-display" data-sync="contractDate"
                                    style="font-size:13px;font-weight:600;">-</div>
                            </div>

                            <div class="signature-grid">
                                <div class="signature-card">
                                    <h4>Î∞úÏ£ºÏûê (Í∞ë)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ÏÑ±Î™Ö</label><input type="text" class="synced-input"
                                                data-sync="clientName" readonly></div>
                                        <div class="sig-field"><label>Ïó∞ÎùΩÏ≤ò</label><input type="text" class="synced-input"
                                                data-sync="clientPhone" readonly></div>
                                    </div>
                                    <div class="signature-box">ÏÑúÎ™Ö ÎòêÎäî ÎÇ†Ïù∏</div>
                                    <div class="stamp-warning">‚ö† ÏßÄÏû•(ÏßÅÏù∏) ÌïÑÏàò</div>
                                </div>
                                <div class="signature-card">
                                    <h4>ÏàòÍ∏âÏù∏ (ÏùÑ)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ÏÉÅÌò∏</label><input type="text" value="ÎîîÏûêÏù∏ÏßÄÍ∑∏"
                                                readonly></div>
                                        <div class="sig-field"><label>ÎåÄÌëúÏûê</label><input type="text" class="company-sync"
                                                data-sync="companyRep" readonly></div>
                                    </div>
                                    <div class="signature-box">ÏÑúÎ™Ö ÎòêÎäî ÎÇ†Ïù∏</div>
                                    <div class="stamp-warning">‚ö† ÏßÄÏû•(ÏßÅÏù∏) ÌïÑÏàò</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-estimate">
                    <div class="document-wrapper" id="estimateDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>Í≥ÑÏïΩ Í≤¨Ï†ÅÏÑú</h1>
                                <div class="subtitle">Contract Estimate</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sample-btn no-print" onclick="openSampleEstimateModal()"
                                    style="background: #ff9500; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ÏÉòÌîå Í≤¨Ï†ÅÏÑú">üìã ÏÉòÌîå</button>
                                <button class="pdf-btn" onclick="downloadPDF('estimateDoc', 'Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú')">üñ®Ô∏è
                                    Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <p class="no-print"
                                style="background:#e8f4fd; padding:10px 14px; border-radius:6px; margin-bottom:16px; font-size:11px; color:#0071e3;">
                                ‚ÑπÔ∏è Íµ¨Î∂Ñ/ÌíàÎ™Ö ÏÑ†ÌÉù Ïãú Îã®Í∞Ä ÏûêÎèô ÏûÖÎ†•. Î™®Îì† ÎìúÎ°≠Îã§Ïö¥(Íµ¨Î∂Ñ¬∑ÌíàÎ™Ö¬∑ÏÉÅÏÑ∏)ÏùÑ ÎçîÎ∏îÌÅ¥Î¶≠ÌïòÎ©¥ ÏßÅÏ†ë Ìé∏Ïßë Í∞ÄÎä•. Îã®ÏúÑ/Îã®Í∞ÄÎäî ÌÅ¥Î¶≠ÏúºÎ°ú ÏàòÏ†ï. ESCÎ°ú ÎìúÎ°≠Îã§Ïö¥
                                Î≥µÍ∑Ä.
                            </p>
                            <div id="estimateCategories"></div>
                            <div class="grand-total">
                                <div class="total-row"><label>Í≥µÍ∏âÍ∞ÄÏï° Ìï©Í≥Ñ</label>
                                    <div class="amount" id="estimateSubtotal">‚Ç© 0</div>
                                </div>
                                <div class="total-row profit-rate-row">
                                    <label>Í∏∞ÏóÖÏù¥Ïú§Ïú®</label>
                                    <div class="profit-rate-input">
                                        <input type="number" id="estimateProfitRate" value="15" min="0" max="100"
                                            onchange="updateEstimateTotals()">
                                        <span>%</span>
                                    </div>
                                </div>
                                <div class="total-row"><label>Í∏∞ÏóÖÏù¥Ïú§</label>
                                    <div class="amount" id="estimateProfit">‚Ç© 0</div>
                                </div>
                                <div class="total-row"><label>Î∂ÄÍ∞ÄÍ∞ÄÏπòÏÑ∏ (VAT 10%)</label>
                                    <div class="amount" id="estimateVat">‚Ç© 0</div>
                                </div>
                                <div class="total-row main"><label>Ï¥ù Í≤¨Ï†ÅÍ∏àÏï°</label>
                                    <div class="amount" id="estimateTotal">‚Ç© 0</div>
                                </div>
                            </div>
                            <!-- ÏûëÏÑ±Ïûê ÌëúÏãú -->
                            <div class="estimate-author no-print"
                                style="text-align:right; margin-top:16px; padding:12px 16px; background:#f5f5f7; border-radius:8px; font-size:12px; color:#666;">
                                üìù ÏûëÏÑ±Ïûê: <span id="estimateAuthor">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-cost">
                    <div class="document-wrapper" id="costDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>Í≥µÏÇ¨ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú</h1>
                                <div class="subtitle">Construction Cost Management</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sync-btn no-print" onclick="syncCostFromCloud()"
                                    style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="Google SheetsÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞">‚òÅÔ∏è‚Üì Î∂àÎü¨Ïò§Í∏∞</button>
                                <span class="no-print"
                                    style="font-size: 11px; color: #ff3b30; font-weight: 600;">(Master Read-Only)</span>

                                <button class="pdf-btn" onclick="downloadPDF('costDoc', 'ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú')">üñ®Ô∏è Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <!-- Ïû†Í∏à ÏÉÅÌÉú ÌëúÏãú -->
                            <div class="cost-lock-overlay" id="costLockOverlay">
                                <div class="lock-info">
                                    <span>üîí</span>
                                    <span>ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎäî Í¥ÄÎ¶¨ÏûêÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§</span>
                                </div>
                                <button class="unlock-btn" onclick="showAdminModal()">üîì Ïû†Í∏à Ìï¥Ï†ú</button>
                            </div>
                            <!-- Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï (Í¥ÄÎ¶¨Ïûê Î™®ÎìúÏùº ÎïåÎßå ÌëúÏãú) -->
                            <div class="settings-section" id="adminSettings" style="display:none;">
                                <h4>‚öôÔ∏è Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï</h4>
                                <div class="settings-row" style="display: none;">
                                    <input type="password" id="changePassword" placeholder="ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏">
                                    <button onclick="changeAdminPassword()">ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</button>
                                </div>
                                <button onclick="logoutAdmin()"
                                    style="width:100%; margin-top:8px; padding:12px; border-radius:12px; border:1px solid #ff3b30; background:#fff; color:#ff3b30; font-size:12px; font-weight:600; cursor:pointer;">üîí
                                    Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏ÏïÑÏõÉ</button>
                            </div>
                            <div id="costCategoriesWrapper" class="cost-locked">
                                <div id="costCategories"></div>
                            </div>
                            <div
                                style="background:#fbfbfd; border-radius:8px; padding:14px; margin-top:16px; border:1px solid #e8e8ed;">
                                <div class="section-title"
                                    style="margin-bottom:8px; border:none; padding:0; font-size:12px;">üìä ÏàòÏùµ Î∂ÑÏÑù</div>
                                <div class="profit-grid">
                                    <div class="profit-item"><label>Ï¥ù ÏõêÍ∞Ä</label>
                                        <div class="value" id="profitCost">‚Ç© 0</div>
                                    </div>
                                    <div class="profit-item"><label>Í≥ÑÏïΩÍ∏àÏï°</label>
                                        <div class="value synced-display" data-sync="totalAmount">-</div>
                                    </div>
                                    <div class="profit-item"><label>Ïù¥ÏùµÎ•†</label>
                                        <div class="value" id="profitRateCalc">0%</div>
                                    </div>
                                    <div class="profit-item profit"><label>ÏòàÏÉÅ ÏàòÏùµ</label>
                                        <div class="value" id="profitAmountCalc">‚Ç© 0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Í≥µÏ†ï Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-checklist">
                    <div class="document-wrapper"
                        style="width:100%; max-width:1200px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header"
                            style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color: #ffffff; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color: #fff;">
                                    DESIGN JIG</div>
                                <h1 style="color: #fff; margin: 0; font-size: 24px;"><span class="emoji-icon">‚úÖ</span>
                                    Í≥µÏ†ï Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h1>
                                <div class="subtitle" style="color: #fff; font-size: 14px; opacity: 0.9;">Process
                                    Checklist
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <!-- [ÏàòÏ†ï] Ï†ÄÏû•ÎÇ¥Ïö©Î∂àÎü¨Ïò§Í∏∞ Î≤ÑÌäºÎßå Ïú†ÏßÄ -->
                                <button class="restore-btn no-print"
                                    onclick="syncFromCloud().then(() => { if (currentCustomerId) { selectCustomer(currentCustomerId); renderChecklistItems(); } })"
                                    style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="Google SheetsÏóêÏÑú Ï†ÄÏû•Îêú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î∂àÎü¨Ïò§Í∏∞">
                                    <span>‚Ü© Ï†ÄÏû•ÎÇ¥Ïö©Î∂àÎü¨Ïò§Í∏∞</span>
                                </button>
                                <!-- [New] ÏùºÏ†ïÌëú Ïó∞Îèô Î≤ÑÌäº -->
                                <button class="sync-sch-btn no-print" onclick="syncChecklistFromSchedule()"
                                    style="background: #007aff; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="ÏùºÏ†ïÌëúÏóê ÏûàÎäî Í≥µÏ†ïÏùÑ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Ïóê ÏûêÎèô Ï∂îÍ∞ÄÌï©ÎãàÎã§">
                                    <span>üìÖ ÏùºÏ†ïÌëú Ïó∞Îèô</span>
                                </button>
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('checklist', event)"
                                    style="background: #000; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ÎÖ∏ÏÖòÏúºÎ°ú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                                    üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                </button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printChecklist()"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">üñ®Ô∏è
                                    Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- ÏßÑÌñâ ÏÉÅÌô© ÏöîÏïΩ -->
                            <div
                                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
                                <div
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">Ï†ÑÏ≤¥ Ìï≠Î™©</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistTotalCount">0</div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #34c759 0%, #28a745 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ÏôÑÎ£å</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistCompletedCount">0</div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #ff9500 0%, #ff6b00 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ÏßÑÌñâ Ï§ë</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistInProgressCount">0
                                    </div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ÏßÑÌñâÎ•†</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistProgressRate">0%</div>
                                </div>
                            </div>

                            <!-- Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌïÑÌÑ∞ -->
                            <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <label
                                        style="font-size: 11px; color: #86868b; margin-bottom: 4px; display: block;">ÏßÑÌñâÎã®Í≥Ñ
                                        ÌïÑÌÑ∞ (Îã§Ï§ë ÏÑ†ÌÉù)</label>
                                    <select id="checklistStageFilter" style="display:none;"></select>
                                    <!-- Ìò∏ÌôòÏÑ± Ïú†ÏßÄÏö© hidden -->
                                    <div class="multi-select-wrapper" id="checklistStageFilterWrapper">
                                        <div class="multi-select-box"
                                            onclick="toggleMultiSelect('checklistStageFilter')">
                                            <span id="checklistStageFilterLabel">Ï†ÑÏ≤¥ Î≥¥Í∏∞</span>
                                            <span style="font-size: 10px; color: #86868b;">‚ñº</span>
                                        </div>
                                        <div class="multi-select-dropdown" id="checklistStageFilterDropdown"></div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 200px;">
                                    <label
                                        style="font-size: 11px; color: #86868b; margin-bottom: 4px; display: block;">Ïπ¥ÌÖåÍ≥†Î¶¨
                                        ÌïÑÌÑ∞</label>
                                    <select id="checklistCategoryFilter" style="display:none;"></select>
                                    <!-- Ìò∏ÌôòÏÑ± Ïú†ÏßÄÏö© hidden -->
                                    <div class="multi-select-wrapper" id="checklistCategoryFilterWrapper">
                                        <div class="multi-select-box"
                                            onclick="toggleMultiSelect('checklistCategoryFilter')">
                                            <span id="checklistCategoryFilterLabel">Ï†ÑÏ≤¥ Î≥¥Í∏∞</span>
                                            <span style="font-size: 10px; color: #86868b;">‚ñº</span>
                                        </div>
                                        <div class="multi-select-dropdown" id="checklistCategoryFilterDropdown"></div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 200px; display: flex; align-items: flex-end;">
                                    <button class="btn btn-primary btn-sm no-print"
                                        onclick="showAddChecklistItemModal()"
                                        style="background: rgba(52, 199, 89, 0.9); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; width: 100%;"
                                        title="ÌòÑÏû¨ ÌïÑÌÑ∞ Ï°∞Í±¥Ïùò Ìï≠Î™©ÏùÑ ÏùºÍ¥Ñ Ï∂îÍ∞Ä">
                                        ‚ûï ÌïÑÌÑ∞ Ìï≠Î™© Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            </div>

                            <!-- Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌÖåÏù¥Î∏î -->
                            <div id="checklistTableContainer" style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                    <thead>
                                        <tr style="background: #f5f5f7;">
                                            <!-- [Ï∂îÍ∞Ä] ÏÇ≠Ï†ú Ïª¨Îüº -->
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 50px; color: #ff3b30;">
                                                ÏÇ≠Ï†ú</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 60px;">
                                                Ï≤¥ÌÅ¨</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 60px;">
                                                NO</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 150px;">
                                                Ìï≠Î™©</th>
                                            <th style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">ÎÇ¥Ïö©
                                            </th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 150px;">
                                                ÎπÑÍ≥†</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 120px;">
                                                ÏßÑÌñâÎã®Í≥Ñ</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 120px;">
                                                Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checklistTableBody">
                                        <tr>
                                            <td colspan="7" style="text-align: center; padding: 40px; color: #86868b;">
                                                ÎèôÍ∏∞Ìôî Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Ìå®ÎÑê -->
                <div class="tab-panel" id="panel-schedule">
                    <div class="document-wrapper" id="scheduleDoc"
                        style="max-width:1000px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1><span class="emoji-icon">üìÖ</span> Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨</h1>
                                <div class="subtitle">Construction Schedule Manager</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('schedule', event)"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ÎÖ∏ÏÖòÏúºÎ°ú Ïä§ÏºÄÏ§Ñ ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                                    üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                </button>
                                <button class="notion-export-btn" onclick="openNotionShareModal()"
                                    style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="ÎÖ∏ÏÖò Í≥†Í∞ù Í≥µÏú† URL ÏÉùÏÑ±">
                                    üìã ÎÖ∏ÏÖò Í≥†Í∞ù Í≥µÏú†
                                </button>
                                <button class="notion-export-btn" onclick="openScheduleMessageModal()"
                                    style="background: linear-gradient(135deg, #34C759 0%, #30B753 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="Ïä§ÏºÄÏ§Ñ Î¨∏Ïûê Î≥¥ÎÇ¥Í∏∞">
                                    üí¨ Î¨∏ÏûêÎ≥¥ÎÇ¥Í∏∞
                                </button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printSchedule(true)"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none;">üñ®Ô∏è
                                    Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- Ïä§ÏºÄÏ§Ñ ÏÉÅÎã® Ï†ïÎ≥¥ (Schedule Info Table) -->
                            <table class="schedule-info-table"
                                style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:12px; border:1px solid #000;">
                                <colgroup>
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                </colgroup>
                                <tbody style="text-align: center;">
                                    <tr>
                                        <!-- Row 1 -->
                                        <th
                                            style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; font-weight:bold;">
                                            Í≥µÏÇ¨ Îã¥ÎãπÏûê</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" class="sch-input" id="schManagerInput"
                                                data-field="manager"
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                value="ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">Í≥µÏÇ¨Í∏∞Í∞Ñ(ÏãúÏûë~Ï¢ÖÎ£å)
                                        </th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schPeriod"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 2 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">Í¥ÄÎ¶¨ÏÇ¨Î¨¥ÏÜå</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder="ÏûÖÎ†•"
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="office">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÌèâÏàò</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schArea"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 3 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px;" rowspan="2">Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schClient1"></td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">Ïù¥ÏÇ¨ÏòàÏ†ïÏùº</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schMoveDate"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 4 -->
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder=""
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="client2">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÌñâÏúÑÌóàÍ∞Ä ÌïÑÏ¶ù</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder="ÎπÑÍ≥†(Ïòà: ÌôïÏû•)" class="sch-input"
                                                data-field="permit_memo"
                                                style="width:60px; text-align:center; border:none; border-bottom:1px solid #eee; background:transparent;">
                                            <label><input type="radio" name="permit_status" value="ÏôÑÎ£å" class="sch-radio"
                                                    data-field="permit_status"> ÏôÑÎ£å</label>
                                            <label><input type="radio" name="permit_status" value="ÎØ∏ÏôÑÎ£å"
                                                    class="sch-radio" data-field="permit_status"> ÎØ∏ÏôÑÎ£å</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 5 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">Ïù∏ÏàòÏù∏Í≥Ñ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="date"
                                                style="width:100%; border:none; outline:none; text-align:center; font-family:inherit; background:transparent;"
                                                class="sch-input" data-field="handover">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">Í≥µÏÇ¨ ÎèôÏùòÏÑú</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <label><input type="radio" name="consent_status" value="ÏôÑÎ£å"
                                                    class="sch-radio" data-field="consent_status"> ÏôÑÎ£å</label>
                                            <label><input type="radio" name="consent_status" value="ÎØ∏ÏôÑÎ£å"
                                                    class="sch-radio" data-field="consent_status"> ÎØ∏ÏôÑÎ£å</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 6 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÌòÑÏû•Ï£ºÏÜå</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" colspan="3"
                                            id="schSiteAddr"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 7 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÎπÑÎ∞ÄÎ≤àÌò∏</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; text-align:left;"
                                            colspan="3">
                                            Í≥µÎèôÌòÑÍ¥Ä : <input type="text"
                                                style="width:100px; border:none; border-bottom:1px solid #eee; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="gatePw">
                                            &nbsp;&nbsp;
                                            ÏÑ∏ÎåÄÌòÑÍ¥Ä : <input type="text"
                                                style="width:100px; border:none; border-bottom:1px solid #eee; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="doorPw">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div
                                style="background:#f0f7ff; padding:12px 16px; border-radius:8px; margin-bottom:16px; font-size:13px; color:#004182; border:1px solid #c2e0ff;">
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                    <strong id="scheduleGuidelinesTitle" class="text-formattable"
                                        contenteditable="false" ondblclick="this.contentEditable=true;this.focus();"
                                        onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                                        onblur="this.contentEditable=false;">üí° Í≥µÏÇ¨ ÏßÑÌñâ ÏïàÎÇ¥ Î∞è Ïú†ÏùòÏÇ¨Ìï≠</strong>
                                    <button class="btn btn-sm no-print" onclick="loadScheduleGuidelines()"
                                        style="background:#0071e3; color:white; border:none; padding:4px 12px; border-radius:6px; font-size:11px; cursor:pointer;">
                                        üì• Ïú†ÏùòÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞
                                    </button>
                                </div>
                                <ul id="scheduleGuidelinesList" class="text-formattable" contenteditable="false"
                                    ondblclick="this.contentEditable=true;this.focus();"
                                    onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                                    onblur="this.contentEditable=false;"
                                    style="margin: 5px 0 0 20px; padding: 0; list-style-type: disc; line-height: 1.6;">
                                    <li>Í≥µÏÇ¨Îäî Í∏∞ÏÉÅ, ÏûêÏû¨ ÏàòÍ∏â, Í≥µÏ†ï Í∞ÑÏÑ≠ Îì± ÌòÑÏû• ÏÉÅÌô©Ïóê Îî∞Îùº ÏùºÏ†ïÏù¥ ÏùºÎ∂Ä Ï°∞Ï†ïÎê† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                    <li>Í≥†Í∞ùÎãòÍªòÏÑú ÏßÅÏ†ë Î∞úÏ£ºÌïòÏã† ÏûêÏû¨ ÎòêÎäî ÏãúÍ≥µ Ìï≠Î™©ÏùÄ Î∞òÎìúÏãú ÏÇ¨Ï†Ñ ÌòëÏùò ÌõÑ ÏßÑÌñâ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.<br>
                                        <span style="color:#666; font-size:0.9em;">(ÏÇ¨Ï†Ñ ÌòëÏùò ÏóÜÏù¥ ÏßÑÌñâ Ïãú Í≥µÏ†ï Í∞ÑÏÑ≠ ÎòêÎäî Ï±ÖÏûÑ Î≤îÏúÑ Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌï†
                                            Ïàò ÏûàÏäµÎãàÎã§)</span>
                                    </li>
                                    <li>Í≥µÏÇ¨ Í∏∞Í∞Ñ Ï§ëÏóêÎäî ÏïàÏ†ÑÏÇ¨Í≥† ÏòàÎ∞©ÏùÑ ÏúÑÌï¥ ÌòÑÏû• Ï∂úÏûÖÏù¥ Ï†úÌïúÎê† Ïàò ÏûàÏúºÎ©∞, ÏûëÏóÖ Íµ¨Í∞Ñ Ï∂úÏûÖÏùÄ ÏÇºÍ∞Ä Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.</li>
                                    <li>Í≥µÏ†ï ÌäπÏÑ±ÏÉÅ ÏÜåÏùå, Î∂ÑÏßÑ, ÎÉÑÏÉàÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÍ≥†, ÏùºÏ†ï ÏãúÍ∞ÑÎåÄÏóêÎäî ÏûëÏóÖÏù¥ ÏßëÏ§ëÎê† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                    <li>Í≥µÏÇ¨ Ï§ë Ï∂îÍ∞Ä ÏöîÏ≤≠Ïù¥ÎÇò Î≥ÄÍ≤Ω ÏÇ¨Ìï≠Ïù¥ ÏûàÏùÑ Í≤ΩÏö∞, Í≥µÏ†ï Î∞è ÎπÑÏö©Ïóê ÏòÅÌñ•Ïù¥ ÏûàÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú Î∞òÎìúÏãú Í≥µÏÇ¨ Îã¥ÎãπÏûêÏôÄ Î®ºÏ†Ä ÌòëÏùò Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.</li>
                                    <li>Í≥µÏ†ï ÏôÑÎ£å ÌõÑÏóêÎäî Îã§Ïùå Í≥µÏ†ïÏùÑ ÏúÑÌï¥ ÌòÑÏû• Ï†ïÎ¶¨ Î∞è ÏñëÏÉù ÏãúÍ∞ÑÏù¥ ÌïÑÏöîÌï† Ïàò ÏûàÏúºÎ©∞, Ïù¥ Í∏∞Í∞Ñ ÎèôÏïà ÌòÑÏû• Ï∂úÏûÖÏù¥ Ï†úÌïúÎê† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                </ul>
                            </div>
                            <table class="data-table" style="width:100%; border-collapse:collapse;">
                                <thead>
                                    <tr style="background:#f5f5f7;">
                                        <th style="width:40px; padding:12px; border:1px solid #d2d2d7;">No</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ÏÑ∏Î∂Ä Í≥µÏ†ïÎ™Ö</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ÌïµÏã¨ Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏</th>
                                        <th style="width:130px; padding:12px; border:1px solid #d2d2d7;">ÏãúÏûëÏùº</th>
                                        <th style="width:130px; padding:12px; border:1px solid #d2d2d7;">Ï¢ÖÎ£åÏùº</th>
                                        <th style="width:120px; padding:12px; border:1px solid #d2d2d7;">Îã¥ÎãπÏûê</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7; text-align:center;">ÎπÑÍ≥†</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleTableBody">
                                    <!-- Dynamic Rows-->
                                </tbody>
                            </table>
                            <button onclick="addScheduleRow()" class="no-print"
                                style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                                + Í≥µÏ†ï Ï∂îÍ∞Ä
                            </button>
                            <div id="scheduleEmptyState"
                                style="text-align:center; padding:40px; color:#86868b; display:none;">
                                Îì±Î°ùÎêú Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§. Í≥µÏ†ïÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-panel" id="panel-as_list">
                    <div class="document-wrapper" id="asListDoc"
                        style="max-width:1000px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1><span class="emoji-icon">üõ†Ô∏è</span> A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏</h1>
                                <div class="subtitle">A/S Management List</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sync-btn no-print" onclick="syncASListFromCloud()"
                                    style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="Google SheetsÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞">‚òÅÔ∏è‚Üì Î∂àÎü¨Ïò§Í∏∞</button>
                                <button type="button" class="sync-btn no-print" onclick="exportASListToNotion()"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ÎÖ∏ÏÖòÏúºÎ°ú A/S Î¶¨Ïä§Ìä∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞">üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printASList(true)"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none;">üñ®Ô∏è
                                    Ïù∏ÏáÑ/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- A/S ÏÉÅÎã® Ï†ïÎ≥¥ (Schedule Style) -->
                            <table class="schedule-info-table"
                                style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:12px; border:1px solid #000;">
                                <colgroup>
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                </colgroup>
                                <tbody style="text-align: center;">
                                    <tr>
                                        <!-- Row 1 -->
                                        <!-- Row 1 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">A/S Îã¥ÎãπÏûê</th>
                                        <td
                                            style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; font-weight:bold;">
                                            <span class="synced-display" data-sync="manager">-</span>
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÏûîÍ∏àÏùº</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <span class="synced-display" data-sync="finalPaymentDate">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 2 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" rowspan="2">
                                            Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; line-height: 1.4;"
                                            id="asClientInfo1">
                                            <!-- Î≥∏Ïù∏ Ï†ïÎ≥¥ -->
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">A/S Í∏∞Í∞Ñ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <span class="synced-display" data-sync="warrantyPeriod">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 3 -->
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; line-height: 1.4;"
                                            id="asClientInfo2">
                                            <!-- Î∞∞Ïö∞Ïûê Ï†ïÎ≥¥ -->
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÌôîÏû•Ïã§ ÎàÑÏàò Î≥¥Ï¶ù Í∏∞Í∞Ñ
                                        </th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="bathroomLeakWarranty">
                                            -
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 4 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ÌòÑÏû•Ï£ºÏÜå</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" colspan="3">
                                            <span class="synced-display" data-sync="siteAddress">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <div
                                style="background:#f0f7ff; padding:12px 16px; border-radius:8px; margin-bottom:16px; font-size:13px; color:#004182; border:1px solid #c2e0ff;">
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                    <strong>üí° A/S(ÏÇ¨ÌõÑÍ¥ÄÎ¶¨) ÏïàÎÇ¥ Î∞è Ïú†ÏùòÏÇ¨Ìï≠</strong>
                                    <button class="btn btn-sm no-print" onclick="loadASGuidelines()"
                                        style="background:#0071e3; color:white; border:none; padding:4px 12px; border-radius:6px; font-size:11px; cursor:pointer;">
                                        üì• Ïú†ÏùòÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞
                                    </button>
                                </div>
                                <ul id="asGuidelinesList"
                                    style="margin: 5px 0 0 20px; padding: 0; list-style-type: disc; line-height: 1.6;">
                                    <li>Í∏∞Î≥∏ A/S Í∏∞Í∞ÑÏùÄ Í≥µÏÇ¨ ÏôÑÎ£åÏùºÎ°úÎ∂ÄÌÑ∞ 12Í∞úÏõîÏûÖÎãàÎã§.</li>
                                    <li>ÏûêÏû¨ A/SÎäî ÏûêÏû¨ ÏûÖÍ≥†Ïùº Í∏∞Ï§Ä 1ÎÖÑÏù¥Î©∞, Ï†úÏ°∞ÏÇ¨ Í∏∞Ï§ÄÏù¥ Ïö∞ÏÑ† Ï†ÅÏö©Îê©ÎãàÎã§.</li>
                                    <li>ÌôîÏû•Ïã§ ÎàÑÏàò A/SÎäî ÏûîÍ∏àÏùºÎ°úÎ∂ÄÌÑ∞ 24Í∞úÏõîÏù¥Î©∞, Î≥ÑÎèÑ ÏßÄÏπ®Ïóê Ìï¥ÎãπÌïòÎäî Í≤ΩÏö∞ÏóêÎßå Ï†ÅÏö©Îê©ÎãàÎã§.</li>
                                    <li>ÏÇ¨Ïö© Î∂ÄÏ£ºÏùò, ÏûêÏó∞ ÎÖ∏ÌõÑ, Í≥†Í∞ù ÏßÅÏ†ë Î∞úÏ£º ÏûêÏû¨Î°ú Ïù∏Ìïú ÌïòÏûêÎäî A/S ÎåÄÏÉÅÏóêÏÑú Ï†úÏô∏Îê©ÎãàÎã§.</li>
                                    <li>A/S Ï†ëÏàòÎäî Í¥ÄÎ†® Ïù¥ÎØ∏ÏßÄ Î∞è ÎèôÏòÅÏÉÅÏùÑ Î∞òÎìúÏãú Ï≤®Î∂ÄÌï¥ Ï£ºÏÖîÏïº ÏõêÌôúÌïòÍ≤å ÏßÑÌñâÎê©ÎãàÎã§.</li>
                                    <li>A/S Í∏∞Í∞Ñ ÎßåÎ£å ÌõÑÏóêÎäî ÏÇ¨Ï†ÑÏóê ÏïàÎÇ¥ÎìúÎ¶∞ Í≥†Í∞ùÏÑºÌÑ∞Î•º ÌÜµÌï¥ Ï†ëÏàòÌï¥ Ï£ºÏÖîÏïº Ìï©ÎãàÎã§.</li>
                                </ul>
                            </div>
                            <table class="data-table" style="width:100%; border-collapse:collapse;">
                                <thead>
                                    <tr style="background:#f5f5f7;">
                                        <th style="width:40px; padding:12px; border:1px solid #d2d2d7;">No</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">Î∏åÎûúÎìú</th>
                                        <th style="width:150px; padding:12px; border:1px solid #d2d2d7;">ÏÑ∏Î∂ÄÌï≠Î™©</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ÌíàÎ≤à</th>
                                        <th style="width:80px; padding:12px; border:1px solid #d2d2d7;">ÏπòÏàò</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ÏÑúÎπÑÏä§ÏÑºÌÑ∞</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">Î≥¥Ï¶ùÍ∏∞Í∞Ñ</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ÎπÑÍ≥†</th>
                                    </tr>
                                </thead>
                                <tbody id="asListTableBody">
                                    <!-- Dynamic Rows -->
                                </tbody>
                            </table>
                            <button onclick="addASListItem()" class="no-print"
                                style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                                + Ìï≠Î™© Ï∂îÍ∞Ä
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [Ïã†Í∑ú] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• -->
            <div class="tab-panel" id="panel-settlement" style="height: 100%; overflow-y: auto;">
                <div class="document-wrapper"
                    style="width:100%; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                    <div class="doc-header">
                        <div>
                            <div
                                style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                DESIGN
                                JIG</div>
                            <h1>üí∞ Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû•</h1>
                            <div class="subtitle">Settlement Management Ledger</div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span id="settlementDirtyIndicator"
                                style="display:none; font-size:11px; font-weight:600; padding:4px 8px; border-radius:12px; background:#fff8e6;"></span>
                            <button class="sync-btn no-print" id="btnLoadSettlement" onclick="syncSettlementFromCloud()"
                                style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="Îç∞Ïù¥ÌÑ∞ Î∞è ÏòµÏÖò ÎèôÍ∏∞Ìôî">üîÑ Î∂àÎü¨Ïò§Í∏∞</button>
                            <button class="no-print" id="btnSaveSettlement" onclick="syncSettlementToCloud()"
                                style="background: #0071e3; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="Íµ¨Í∏Ä ÏãúÌä∏Ïóê Ï†ÄÏû•">üíæ Ï†ÄÏû•ÌïòÍ∏∞</button>
                            <button class="no-print" onclick="printSettlement()"
                                style="background: white; color: #1d1d1f; border: 1px solid #d2d2d7; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• Ïù∏ÏáÑ">üñ®Ô∏è Ïù∏ÏáÑ</button>
                        </div>
                    </div>

                    <!-- Ìï©Í≥Ñ ÏöîÏïΩ ÏòÅÏó≠ -->
                    <div
                        style="background:#f9f9f9; padding:16px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-around; align-items:center;">
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">Ï¥ù ÏûÖÍ∏àÏï°(Îß§Ï∂ú)</div>
                            <div style="font-size:16px; font-weight:700; color:#0071e3;" id="settlementTotalIncome">0
                            </div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">Ï¥ù ÏßÄÏ∂úÏï°</div>
                            <div style="font-size:16px; font-weight:700; color:#ff3b30;" id="settlementTotalExpense">0
                            </div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ÏàòÏùµÍ∏à</div>
                            <div style="font-size:16px; font-weight:700; color:#34c759;" id="settlementProfit">0</div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ÏàòÏùµÎ•†</div>
                            <div style="font-size:16px; font-weight:700; color:#333;" id="settlementProfitRate">0%</div>
                        </div>
                    </div>

                    <div style="padding:20px;">
                        <table class="data-table" style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:#f5f5f7;">
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">No
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">Ïπ¥ÌÖåÍ≥†Î¶¨
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">Í≥µÏ†ïÎ∂ÑÎ•ò
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        Í±∞ÎûòÏ≤ò/ÏûëÏóÖÏûê</th>
                                    <th style="width:70px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ÎπÑÏö©Íµ¨Î∂Ñ
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ÎåÄÍ∏àÎ∞©Ïãù
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        ÏÇ¨ÏóÖÏûê/Ï£ºÎØºÎ≤àÌò∏</th>
                                    <th style="width:180px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        ÏùÄÌñâÎ™Ö/ÏòàÍ∏àÏ£º/Í≥ÑÏ¢åÎ≤àÌò∏</th>
                                    <th style="width:90px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">Í≤∞Ï†úÍ∏àÏï°
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">Í≤∞Ï†úÏùº
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">Í≤∞Ï†úÏÉÅÌÉú
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ÎπÑÍ≥†
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="settlementTableBody">
                                <!-- Dynamic Rows -->
                            </tbody>
                        </table>
                        <button onclick="addSettlementRow()" class="no-print"
                            style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                            + Ìï≠Î™© Ï∂îÍ∞Ä
                        </button>
                        <datalist id="settlementItemOptions">
                            <option value="Í≥ÑÏïΩÍ∏à"></option>
                            <option value="Ï∞©ÏàòÍ∏à"></option>
                            <option value="Ï§ëÎèÑÍ∏à"></option>
                            <option value="ÏûîÍ∏à"></option>
                            <option value="ÏûêÏû¨ÎπÑ"></option>
                            <option value="Ïù∏Í±¥ÎπÑ"></option>
                            <option value="Ï≤†Í±∞ÎπÑ"></option>
                            <option value="ÌèêÍ∏∞Î¨ºÏ≤òÎ¶¨ÎπÑ"></option>
                            <option value="ÏãùÎåÄ"></option>
                            <option value="Í≤ΩÎπÑ"></option>
                            <option value="Í∏∞ÌÉÄ"></option>
                        </datalist>
                    </div>
                </div>
            </div>
            <!-- [Ïã†Í∑ú] Í≥µÏ†ïÎ≥Ñ ÏàòÏùµÍ∏à Ìå®ÎÑê -->
            <div class="tab-panel" id="panel-stats">
                <div class="document-wrapper"
                    style="width:100%; max-width:1200px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                    <div class="doc-header"
                        style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color: #ffffff; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 0;">
                        <div>
                            <div
                                style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color:#fff;">
                                DESIGN JIG</div>
                            <h1 style="color: #fff; margin: 0; font-size: 24px;"><span class="emoji-icon">üìä</span> Í≥µÏ†ïÎ≥Ñ
                                ÏàòÏùµÍ∏à</h1>
                            <div class="subtitle" style="color: #fff; font-size: 14px; opacity: 0.9;">Profit by Process
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="pdf-btn no-print" onclick="downloadPDF('panel-stats', 'Í≥µÏ†ïÎ≥ÑÏàòÏùµÍ∏à')"
                                style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">
                                üñ®Ô∏è Ïù∏ÏáÑ/PDF</button>
                        </div>
                    </div>
                    <div style="padding:20px;">
                        <!-- ÏöîÏïΩ Ïπ¥Îìú -->
                        <div class="profit-summary-cards" id="profitSummaryCards">
                            <div class="profit-card">
                                <div class="profit-card-label">Ï¥ù Í≤¨Ï†ÅÎπÑÏö©</div>
                                <div class="profit-card-value" id="profitTotalEstimate">0Ïõê</div>
                            </div>
                            <div class="profit-card">
                                <div class="profit-card-label">Ï¥ù ÏßÄÏ∂úÎπÑÏö©</div>
                                <div class="profit-card-value" id="profitTotalExpense" style="color:#ff9500;">0Ïõê</div>
                            </div>
                            <div class="profit-card profit-card-highlight">
                                <div class="profit-card-label">Ï¥ù ÏàòÏùµÍ∏à</div>
                                <div class="profit-card-value" id="profitTotalProfit" style="color:#34c759;">0Ïõê</div>
                            </div>
                            <div class="profit-card">
                                <div class="profit-card-label">Ï¥ù ÏàòÏùµÎ•†</div>
                                <div class="profit-card-value" id="profitTotalRate" style="color:#007aff;">0%</div>
                            </div>
                        </div>
                        <!-- ÏàòÏùµÍ∏à Î∂ÑÏÑù ÌÖåÏù¥Î∏î -->
                        <div style="overflow-x:auto; border-radius:12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
                            <table class="profit-analysis-table" id="profitAnalysisTable">
                                <thead>
                                    <tr>
                                        <th style="width:40px;">No</th>
                                        <th style="width:100px;">Íµ¨Î∂Ñ</th>
                                        <th>ÌíàÎ™Ö</th>
                                        <th style="width:50px;">ÏàòÎüâ</th>
                                        <th style="width:50px;">Îã®ÏúÑ</th>
                                        <th style="width:100px;">Í≤¨Ï†ÅÎã®Í∞Ä</th>
                                        <th style="width:110px;">Í≤¨Ï†ÅÍ∏àÏï°</th>
                                        <th style="width:110px;">Ïã§ÌñâÍ∏àÏï°</th>
                                        <th style="width:110px;">Ï∞®Ïù¥</th>
                                        <th style="width:70px;">ÏàòÏùµÎ•†</th>
                                    </tr>
                                </thead>
                                <tbody id="profitAnalysisBody">
                                    <!-- JS Î†åÎçîÎßÅ -->
                                </tbody>
                            </table>
                        </div>
                        <!-- Ï∞®Ìä∏ ÏòÅÏó≠ -->
                        <div style="margin-top:32px;">
                            <h3
                                style="font-size:18px; font-weight:700; color:#1d1d1f; margin-bottom:20px; display:flex; align-items:center; gap:8px;">
                                <span>üìà</span> Í≥µÏ†ïÎ≥Ñ ÏàòÏùµ Î∂ÑÏÑù Ï∞®Ìä∏
                            </h3>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px;">
                                <div
                                    style="background:#f8f9fa; border-radius:16px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                                    <h4
                                        style="font-size:14px; font-weight:600; color:#666; margin-bottom:16px; text-align:center;">
                                        Í≥µÏ†ïÎ≥Ñ Í≤¨Ï†Å vs Ïã§Ìñâ ÎπÑÍµê</h4>
                                    <div style="position:relative; height:350px;">
                                        <canvas id="profitBarChart"></canvas>
                                    </div>
                                </div>
                                <div
                                    style="background:#f8f9fa; border-radius:16px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                                    <h4
                                        style="font-size:14px; font-weight:600; color:#666; margin-bottom:16px; text-align:center;">
                                        Í≥µÏ†ïÎ≥Ñ Í≤¨Ï†Å ÎπÑÏ§ë</h4>
                                    <div style="position:relative; height:350px;">
                                        <canvas id="profitDoughnutChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(event)">



    <!-- ÌÜµÍ≥Ñ Î™®Îã¨ -->
    <div class="stats-modal-overlay" id="statsModal" onclick="closeStatsModal(event)">
        <div class="stats-modal" onclick="event.stopPropagation()">
            <div class="stats-modal-header">
                <h2>üìä Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú</h2>
                <button class="stats-close-btn" onclick="closeStatsModal()">‚úï</button>
            </div>
            <div class="stats-modal-content">

                <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ ÏòÅÏó≠ -->
                <div class="stats-filter-bar"
                    style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:20px; padding:15px; background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius:12px; border:1px solid #e2e8f0;">
                    <!-- ÏßëÍ≥Ñ Îã®ÏúÑ ÌÜ†Í∏Ä -->
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size:13px; font-weight:600; color:#64748b;">ÏßëÍ≥Ñ Îã®ÏúÑ:</span>
                        <div
                            style="display:flex; background:#fff; border-radius:8px; border:1px solid #e2e8f0; overflow:hidden;">
                            <button id="filterMonthly" onclick="setAggregationType('monthly')"
                                style="padding:8px 16px; border:none; background:#0071e3; color:white; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s;">ÏõîÎ≥Ñ</button>
                            <button id="filterYearly" onclick="setAggregationType('yearly')"
                                style="padding:8px 16px; border:none; background:white; color:#64748b; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s;">Ïó∞ÎèÑÎ≥Ñ</button>
                        </div>
                    </div>
                    <!-- Í∏∞Í∞Ñ Î≤îÏúÑ -->
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size:13px; font-weight:600; color:#64748b;">Í∏∞Í∞Ñ:</span>
                        <select id="statsPeriodFilter" onchange="renderAllStats()"
                            style="padding:8px 14px; border:1px solid #e2e8f0; border-radius:8px; font-size:12px; font-weight:500; background:white; cursor:pointer;">
                            <option value="12months">ÏµúÍ∑º 12Í∞úÏõî</option>
                            <option value="thisyear">Ïò¨Ìï¥</option>
                            <option value="lastyear">ÏûëÎÖÑ</option>
                            <option value="all">Ï†ÑÏ≤¥ Í∏∞Í∞Ñ</option>
                        </select>
                    </div>
                </div>

                <!-- ÌïµÏã¨ KPI Ïπ¥Îìú (3Í∞ú Ïö∞ÏÑ† + 3Í∞ú Î≥¥Ï°∞) -->
                <div class="stats-kpi-grid"
                    style="display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-bottom:24px;">
                    <!-- ÌïµÏã¨ KPI 1: Ï¥ù Îß§Ï∂ú -->
                    <div class="kpi-card primary"
                        style="background:linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 15px rgba(14,165,233,0.3);">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px;">
                                    üí∞ Ï¥ù Îß§Ï∂ú</div>
                                <div id="kpiTotalRevenue" style="font-size:28px; font-weight:800; line-height:1.2;">‚Ç©0
                                </div>
                            </div>
                            <div style="font-size:32px; opacity:0.3;">üìà</div>
                        </div>
                        <div style="margin-top:12px; font-size:11px; opacity:0.8;">
                            Í≥ÑÏïΩÍ±¥Ïàò: <span id="kpiContractCount">0</span>Í±¥
                        </div>
                    </div>

                    <!-- ÌïµÏã¨ KPI 2: Ï¥ù ÏßÄÏ∂ú -->
                    <div class="kpi-card"
                        style="background:linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 15px rgba(244,63,94,0.3);">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px;">
                                    üí∏ Ï¥ù ÏßÄÏ∂ú</div>
                                <div id="kpiTotalExpense" style="font-size:28px; font-weight:800; line-height:1.2;">‚Ç©0
                                </div>
                            </div>
                            <div style="font-size:32px; opacity:0.3;">üìâ</div>
                        </div>
                        <div style="margin-top:12px; font-size:11px; opacity:0.8;">
                            Ïö¥ÏòÅÎπÑ Ìï≠Î™©: <span id="kpiExpenseItems">0</span>Í±¥
                        </div>
                    </div>

                    <!-- ÌïµÏã¨ KPI 3: ÏàúÏù¥Ïùµ (Í∞ÄÏû• ÎààÏóê ÎùÑÍ≤å) -->
                    <div class="kpi-card highlight"
                        style="background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 20px rgba(16,185,129,0.4); border:3px solid rgba(255,255,255,0.3); position:relative; overflow:hidden;">
                        <div style="position:absolute; top:-20px; right:-20px; font-size:80px; opacity:0.1;">üíé</div>
                        <div
                            style="display:flex; justify-content:space-between; align-items:flex-start; position:relative;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px; display:flex; align-items:center; gap:6px;">
                                    üíé ÏàúÏù¥Ïùµ <span
                                        style="background:rgba(255,255,255,0.3); padding:2px 8px; border-radius:10px; font-size:10px;">HIGHLIGHT</span>
                                </div>
                                <div id="kpiNetProfit"
                                    style="font-size:32px; font-weight:900; line-height:1.2; text-shadow:0 2px 10px rgba(0,0,0,0.2);">
                                    ‚Ç©0</div>
                            </div>
                        </div>
                        <div style="margin-top:12px; font-size:12px; display:flex; align-items:center; gap:8px;">
                            <span
                                style="background:rgba(255,255,255,0.2); padding:4px 10px; border-radius:12px; font-weight:600;">
                                Ïù¥ÏùµÎ•†: <span id="kpiProfitRate">0</span>%
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Î≥¥Ï°∞ KPI Ïπ¥Îìú (2Ïó¥ Í∑∏Î¶¨Îìú) -->
                <div class="stats-secondary-kpi"
                    style="display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-bottom:24px;">
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#f0f9ff; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            üë•</div>
                        <div>
                            <div id="kpiTotalCustomers" style="font-size:20px; font-weight:700; color:#1e293b;">0</div>
                            <div style="font-size:11px; color:#64748b;">Ï¥ù Í≥†Í∞ù Ïàò</div>
                        </div>
                    </div>
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#fef3c7; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            üìù</div>
                        <div>
                            <div id="kpiContractsTotal" style="font-size:20px; font-weight:700; color:#1e293b;">0</div>
                            <div style="font-size:11px; color:#64748b;">Í≥ÑÏïΩ Í±¥Ïàò</div>
                        </div>
                    </div>
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#f0fdf4; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            üìä</div>
                        <div>
                            <div id="kpiAvgContract" style="font-size:20px; font-weight:700; color:#1e293b;">‚Ç©0</div>
                            <div style="font-size:11px; color:#64748b;">ÌèâÍ∑† Í≥ÑÏïΩÍ∏àÏï°</div>
                        </div>
                    </div>
                </div>

                <!-- ÌÜµÌï© ÏàòÏùµÏÑ± Ï∞®Ìä∏ (Îß§Ï∂ú ÎßâÎåÄ, ÏßÄÏ∂ú ÎßâÎåÄ, ÏàúÏù¥Ïùµ ÏÑ†) -->
                <div class="stats-main-chart"
                    style="background:white; padding:24px; border-radius:16px; border:1px solid #e2e8f0; box-shadow:0 1px 3px rgba(0,0,0,0.05); margin-bottom:24px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <div>
                            <h3 style="margin:0; font-size:18px; font-weight:700; color:#1e293b;">üìä ÏàòÏùµÏÑ± Î∂ÑÏÑù Ï∞®Ìä∏</h3>
                            <p style="margin:4px 0 0 0; font-size:12px; color:#64748b;">Îß§Ï∂ú vs ÏßÄÏ∂ú vs ÏàúÏù¥Ïùµ Ï∂îÏù¥</p>
                        </div>
                        <!-- Î≤îÎ°Ä -->
                        <div style="display:flex; gap:16px; font-size:11px;">
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:12px; background:#0ea5e9; border-radius:2px;"></span> Îß§Ï∂ú
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:12px; background:#f43f5e; border-radius:2px;"></span> ÏßÄÏ∂ú
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:3px; background:#10b981; border-radius:2px;"></span> ÏàúÏù¥Ïùµ
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:3px; background:#8b5cf6; border-radius:2px; border:1px dashed #8b5cf6;"></span>
                                Ïù¥ÏùµÎ•†(%)</div>
                        </div>
                    </div>
                    <div style="height:380px;">
                        <canvas id="profitabilityChart"></canvas>
                    </div>
                </div>

                <!-- ÌÉ≠ Î©îÎâ¥ (Í∏∞ÌÉÄ ÏÉÅÏÑ∏ ÌÜµÍ≥Ñ) -->
                <div class="stats-tabs-container"
                    style="display:flex; gap:10px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <button id="tab-expenses" class="stats-tab-btn active" onclick="switchStatsTab('expenses')"
                        style="padding:8px 16px; border:none; background:#f5f5f7; border-radius:6px; cursor:pointer; font-weight:600; color:#333; transition:all 0.2s;">üí∏
                        Ïö¥ÏòÅÎπÑ Î∂ÑÏÑù</button>
                    <button id="tab-others" class="stats-tab-btn" onclick="switchStatsTab('others')"
                        style="padding:8px 16px; border:none; background:white; border-radius:6px; cursor:pointer; font-weight:600; color:#888; transition:all 0.2s;">üéØ
                        Í∏∞ÌÉÄ ÌÜµÍ≥Ñ</button>
                </div>

                <!-- ÌÉ≠ Ïª®ÌÖêÏ∏† ÏòÅÏó≠ -->
                <div class="stats-content-area" style="min-height:300px;">
                    <!-- Ïö¥ÏòÅÎπÑ ÌÉ≠ -->
                    <div id="view-stats-expenses" class="stats-view-content"
                        style="display:block; animation: fadeIn 0.3s;">
                        <div class="stats-chart-card wide"
                            style="height:350px; padding:25px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                            <h3 style="margin:0 0 20px 0; font-size:18px; color:#1d1d1f;">üí∏ Ïö¥ÏòÅÎπÑ ÏßÄÏ∂ú ÏÉÅÏÑ∏ (ÎåÄÎ∂ÑÎ•ò)</h3>
                            <div style="height:260px; display:flex; justify-content:center;">
                                <canvas id="expenseBreakdownChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Í∏∞ÌÉÄ ÌÉ≠ -->
                    <div id="view-stats-others" class="stats-view-content"
                        style="display:none; animation: fadeIn 0.3s;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                            <!-- ÏÉÅÌÉúÎ≥Ñ -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>üéØ ÏÉÅÌÉúÎ≥Ñ Í≥†Í∞ù Î∂ÑÌè¨</h3>
                                <div style="height:220px;"><canvas id="statusChart"></canvas></div>
                            </div>
                            <!-- Ïú†ÏûÖÍ≤ΩÎ°ú -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>üîç Ïú†ÏûÖÍ≤ΩÎ°ú Î∂ÑÏÑù</h3>
                                <div style="height:220px;"><canvas id="sourceChart"></canvas></div>
                            </div>
                            <!-- Í±¥Î¨ºÏú†Ìòï -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>üè† Í±¥Î¨ºÏú†ÌòïÎ≥Ñ Î∂ÑÌè¨</h3>
                                <div style="height:220px;"><canvas id="buildingChart"></canvas></div>
                            </div>
                            <!-- Ï†ÑÌôòÏú® -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>‚úÖ Í≥ÑÏïΩ Ï†ÑÌôòÏú®</h3>
                                <div class="conversion-rate-display">
                                    <div class="conversion-circle" id="conversionCircle">
                                        <span id="conversionRate">0%</span>
                                    </div>
                                    <div class="conversion-details">
                                        <div class="conversion-item"><span class="dot green"></span> Í≥ÑÏïΩ ÏôÑÎ£å: <strong
                                                id="contractedCount">0</strong></div>
                                        <div class="conversion-item"><span class="dot red"></span> ÎØ∏Í≥ÑÏïΩ: <strong
                                                id="notContractedCount">0</strong></div>
                                        <div class="conversion-item"><span class="dot gray"></span> ÏÉÅÎã¥Ï§ë: <strong
                                                id="consultingCount">0</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>





    <script>
        console.log('Main admin script loading...');

        // [Phase 2] Cleanup Function - ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî ÏÑ±Í≥µ ÌõÑ Ïã§Ìñâ
        function runPhase2Cleanup() {
            const keysToRemove = [
                'dz_customers', 'dz_regular_admins', 'dz_checklist_master',
                'dz_global_cost', 'dz_admin_page_auth', 'dz_device_trust',
                'designzig_expenses', 'designzig_fixed_expenses', 'designzig_fontsize',
                'designzig_estimate_data', 'dz_estimate_data',
                'DJ_migrated_v1',
                'DJ_customers', 'DJ_global_cost', 'DJ_checklist_master', 'DJ_expenses', 'DJ_fixed_expenses',
                'DJ_regular_admins', 'DJ_editHistory'
            ];

            let removedCount = 0;
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    removedCount++;
                }
            });
            if (removedCount > 0) {
                console.log(`[Phase 2 Cleanup] ${removedCount}Í∞úÏùò ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï∫êÏãúÎ•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÍ±∞ÌñàÏäµÎãàÎã§.`);
            }
        }

        // ==========================================
        // Í∏∞Í∏∞ Ïã†Î¢∞ & PIN Î°úÍ∑∏Ïù∏ ÏãúÏä§ÌÖú
        // ==========================================
        const DEVICE_TRUST_KEY = 'DJ_device_trust';
        const DEVICE_TRUST_DAYS = 30;

        // Í∏∞Í∏∞ Ïã†Î¢∞ Ï†ïÎ≥¥ ÌôïÏù∏
        function checkDeviceTrust() {
            try {
                const trustData = localStorage.getItem(DEVICE_TRUST_KEY);
                if (!trustData) return null;

                const trust = JSON.parse(trustData);
                const now = Date.now();
                const expiry = trust.expiry || 0;

                // 30Ïùº Í≤ΩÍ≥º Ïãú ÎßåÎ£å
                if (now > expiry) {
                    localStorage.removeItem(DEVICE_TRUST_KEY);
                    return null;
                }

                // ÌôòÍ≤Ω Î≥ÄÍ≤Ω Í∞êÏßÄ (Í∞ÑÎã®Ìïú fingerprint ÎπÑÍµê)
                if (trust.fingerprint !== getDeviceFingerprint()) {
                    localStorage.removeItem(DEVICE_TRUST_KEY);
                    return null;
                }

                return trust;
            } catch (e) {
                localStorage.removeItem(DEVICE_TRUST_KEY);
                return null;
            }
        }

        // Í∞ÑÎã®Ìïú Í∏∞Í∏∞ ÌïëÍ±∞ÌîÑÎ¶∞Ìä∏ ÏÉùÏÑ±
        function getDeviceFingerprint() {
            const ua = navigator.userAgent;
            const lang = navigator.language;
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const screen = `${window.screen.width}x${window.screen.height}`;
            return btoa(ua + lang + tz + screen).slice(0, 32);
        }

        // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ Ï†ÑÌôò
        function showLoginView(view) {
            document.getElementById('loginCardIdPw').style.display = 'none';
            document.getElementById('loginCardPin').style.display = 'none';
            document.getElementById('loginCardPinSetup').style.display = 'none';

            if (view === 'idpw') {
                document.getElementById('loginCardIdPw').style.display = 'block';
                document.getElementById('loginId').focus();
            } else if (view === 'pin') {
                document.getElementById('loginCardPin').style.display = 'block';
                document.getElementById('loginPin').value = '';
                document.getElementById('loginPin').focus();
            } else if (view === 'setup') {
                document.getElementById('loginCardPinSetup').style.display = 'block';
                document.getElementById('newPin').value = '';
                document.getElementById('confirmPin').value = '';
                document.getElementById('newPin').focus();
            }
        }

        // PIN Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        async function performPinLogin() {
            const pin = document.getElementById('loginPin').value;
            if (pin.length !== 4) {
                showToast('PIN 4ÏûêÎ¶¨Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'warning');
                return;
            }

            const trust = checkDeviceTrust();
            if (!trust) {
                showToast('Í∏∞Í∏∞ Ïã†Î¢∞Í∞Ä ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§', 'error');
                showLoginView('idpw');
                return;
            }

            const pinHash = await hashPassword(pin);
            if (pinHash !== trust.pinHash) {
                showToast('PINÏù¥ ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
                document.getElementById('loginPin').value = '';
                document.getElementById('loginPin').focus();
                return;
            }

            // PIN ÏùºÏπò - Ï†ÄÏû•Îêú Í¥ÄÎ¶¨Ïûê Ï†ïÎ≥¥Î°ú Î°úÍ∑∏Ïù∏
            currentAdmin = {
                id: trust.adminId,
                role: trust.adminRole,
                name: trust.adminName
            };

            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast(`${trust.adminName || trust.adminId}Îãò ÌôòÏòÅÌï©ÎãàÎã§`, 'success');
        }

        // PIN ÏÑ§Ï†ï (Í∏∞Í∏∞ Ïã†Î¢∞ ÏÉùÏÑ±)
        async function setupDevicePin() {
            const newPin = document.getElementById('newPin').value;
            const confirmPin = document.getElementById('confirmPin').value;

            if (newPin.length !== 4) {
                showToast('PINÏùÄ 4ÏûêÎ¶¨ Ïà´ÏûêÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'warning');
                return;
            }

            if (newPin !== confirmPin) {
                showToast('PINÏù¥ ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
                document.getElementById('confirmPin').value = '';
                document.getElementById('confirmPin').focus();
                return;
            }

            const pinHash = await hashPassword(newPin);
            const expiry = Date.now() + (DEVICE_TRUST_DAYS * 24 * 60 * 60 * 1000);

            const trustData = {
                adminId: currentAdmin.id,
                adminRole: currentAdmin.role,
                adminName: currentAdmin.name || currentAdmin.id,
                pinHash: pinHash,
                fingerprint: getDeviceFingerprint(),
                expiry: expiry,
                createdAt: Date.now()
            };

            localStorage.setItem(DEVICE_TRUST_KEY, JSON.stringify(trustData));

            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast('PINÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§. Îã§ÏùåÎ∂ÄÌÑ∞ Îπ†Î•¥Í≤å Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî!', 'success');
        }

        // PIN ÏÑ§Ï†ï Í±¥ÎÑàÎõ∞Í∏∞
        function skipPinSetup() {
            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast(`${currentAdmin.name || currentAdmin.id}Î°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§`, 'success');
        }

        // Í∏∞Í∏∞ Ïã†Î¢∞ Ìï¥Ï†ú (Îã§Î•∏ Í≥ÑÏ†ï Î°úÍ∑∏Ïù∏)
        function clearDeviceTrust() {
            localStorage.removeItem(DEVICE_TRUST_KEY);
            showLoginView('idpw');
            showToast('Í∏∞Í∏∞ Ïã†Î¢∞Í∞Ä Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§', 'info');
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í∏∞Í∏∞ Ïã†Î¢∞ ÌôïÏù∏
        function initLoginScreen() {
            const trust = checkDeviceTrust();
            if (trust) {
                // Í∏∞Í∏∞ Ïã†Î¢∞ ÏûàÏùå ‚Üí PIN Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
                document.getElementById('trustedUserName').textContent = trust.adminName || trust.adminId;
                showLoginView('pin');
            } else {
                // Í∏∞Í∏∞ Ïã†Î¢∞ ÏóÜÏùå ‚Üí ID/PW Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
                showLoginView('idpw');
            }
        }

        // (performLogin function has been moved to script top)
        // Ïò§Î≤ÑÎ†àÏù¥ Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ (Ïä§ÌÅ¨Î¶ΩÌä∏ ÏµúÏÉÅÎã® Ïù¥Îèô)
        async function performLogin() {
            console.log('performLogin function executed');
            const inputId = document.getElementById('loginId').value.trim();
            const inputPw = document.getElementById('loginPw').value;

            if (!inputId || !inputPw) {
                showToast('ÏïÑÏù¥ÎîîÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'warning');
                return;
            }

            // Î©îÏù∏Í¥ÄÎ¶¨Ïûê ÌôïÏù∏ (Ìï¥Ïãú ÎπÑÍµê) - Î≥µÏàò Í¥ÄÎ¶¨Ïûê ÏßÄÏõê
            const inputHash = await hashPassword(inputPw);
            const mainAdmin = MAIN_ADMINS.find(admin => admin.id === inputId && admin.passwordHash === inputHash);
            if (mainAdmin) {
                currentAdmin = { id: mainAdmin.id, role: 'main', name: mainAdmin.name };
                // PIN ÏÑ§Ï†ï ÌôîÎ©¥ÏúºÎ°ú Ï†ÑÌôò
                showLoginView('setup');
                return;
            }

            // ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê ÌôïÏù∏ (1Ï∞®: Î°úÏª¨ Îç∞Ïù¥ÌÑ∞)
            let admins = getRegularAdmins();
            let found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);

            // Î°úÏª¨Ïóê ÏóÜÍ±∞ÎÇò Ïã§Ìå®ÌïòÎ©¥ ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî ÌõÑ Ïû¨ÏãúÎèÑ (2Ï∞®: ÌÅ¥ÎùºÏö∞Îìú Îç∞Ïù¥ÌÑ∞)
            // Ïù¥ÎØ∏ Ï¥àÍ∏∞ ÎèôÍ∏∞ÌôîÍ∞Ä ÏôÑÎ£åÎêú Í≤ΩÏö∞ Ï§ëÎ≥µ Ìò∏Ï∂ú Î∞©ÏßÄ
            if (!found && !adminsSyncedOnce) {
                await syncAdminsFromCloud();
                admins = getRegularAdmins();
                found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);
            }

            if (found) {
                currentAdmin = { id: found.id, role: 'regular', name: found.name || found.id };
                // PIN ÏÑ§Ï†ï ÌôîÎ©¥ÏúºÎ°ú Ï†ÑÌôò
                showLoginView('setup');
            } else {
                showToast('ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
            }
        }

        let asListItems = []; // A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞

        const categories = [
            { no: '01', name: 'Í∞ÄÏÑ§Í≥µÏÇ¨' },
            { no: '02', name: 'ÏÑ§Í≥Ñ Î∞è Í¥ÄÎ¶¨ÎπÑ' },
            { no: '03', name: 'Ï≤†Í±∞Í≥µÏÇ¨' },
            { no: '04', name: 'ÏÑ§ÎπÑ/Î∞©ÏàòÍ≥µÏÇ¨' },
            { no: '05', name: 'ÌôïÏû•/Îã®Ïó¥Í≥µÏÇ¨' },
            { no: '06', name: 'Ï∞ΩÌò∏Í≥µÏÇ¨' },
            { no: '07', name: 'Ï†ÑÍ∏∞/Ï°∞Î™ÖÍ≥µÏÇ¨' },
            { no: '08', name: 'ÏóêÏñ¥Ïª®Í≥µÏÇ¨' },
            { no: '09', name: 'Î™©Í≥µ/ÎèÑÏñ¥Í≥µÏÇ¨' },
            { no: '10', name: 'ÌïÑÎ¶ÑÍ≥µÏÇ¨' },
            { no: '11', name: 'ÌÉÄÏùºÍ≥µÏÇ¨' },
            { no: '12', name: 'ÏöïÏã§Í≥µÏÇ¨' },
            { no: '13', name: 'ÎèÑÏû•Í≥µÏÇ¨' },
            { no: '14', name: 'ÎèÑÎ∞∞Í≥µÏÇ¨' },
            { no: '15', name: 'Î∞îÎã•Ïû¨Í≥µÏÇ¨' },
            { no: '16', name: 'Í∞ÄÍµ¨Í≥µÏÇ¨' },
            { no: '17', name: 'ÎßàÍ∞êÍ≥µÏÇ¨' },
            { no: '18', name: 'Í∏∞ÌÉÄÍ≥µÏÇ¨' }
        ];



        // Îã®ÏúÑ ÏòµÏÖò
        const unitOptions = ['Ïãù', 'py', 'm¬≤', 'm', 'ea', 'set', 'unit', 'Î©¥', 'Ïûê', 'Î°§'];

        function getUnitSelectHTML(selectedValue = '') {
            const isCustom = selectedValue && !unitOptions.includes(selectedValue);
            if (isCustom) {
                // ÏßÅÏ†ëÏûÖÎ†•Îêú Í∞íÏù¥Î©¥ inputÏúºÎ°ú ÌëúÏãú
                return `<div class= "unit-wrapper" >
                <input type="text" class="unit-input" value="${selectedValue}" placeholder="Îã®ÏúÑ" onblur="onUnitInputBlur(this)">
                    <button class="unit-toggle-btn" onclick="toggleUnitToSelect(this)" title="Î™©Î°ùÏóêÏÑú ÏÑ†ÌÉù">‚ñº</button>
                </div>`;
            }
            return `<select class= "unit-select" onchange = "onUnitChange(this)" > ${unitOptions.map(u =>
                `<option value="${u}" ${u === selectedValue ? 'selected' : ''}>${u}</option>`
            ).join('')
                } <option value = "__custom__" >‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option></select> `;
        }

        // Îã®ÏúÑ ÎìúÎ°≠Îã§Ïö¥ Î≥ÄÍ≤Ω Ïãú
        function onUnitChange(select) {
            if (select.value === '__custom__') {
                const wrapper = document.createElement('div');
                wrapper.className = 'unit-wrapper';
                wrapper.innerHTML = `
                <input type = "text" class= "unit-input" placeholder = "Îã®ÏúÑ ÏûÖÎ†•" autofocus onblur = "onUnitInputBlur(this)" >
                <button class="unit-toggle-btn" onclick="toggleUnitToSelect(this)" title="Î™©Î°ùÏóêÏÑú ÏÑ†ÌÉù">‚ñº</button>
    `;
                select.parentNode.replaceChild(wrapper, select);
                wrapper.querySelector('input').focus();
            }
        }

        // ÏßÅÏ†ëÏûÖÎ†• -> ÎìúÎ°≠Îã§Ïö¥ÏúºÎ°ú Ï†ÑÌôò
        function toggleUnitToSelect(btn) {
            const wrapper = btn.closest('.unit-wrapper');
            const currentValue = wrapper.querySelector('.unit-input').value || 'Ïãù';
            const select = document.createElement('select');
            select.className = 'unit-select';
            select.setAttribute('onchange', 'onUnitChange(this)');
            select.innerHTML = unitOptions.map(u =>
                `<option value = "${u}" ${u === currentValue ? 'selected' : ''}> ${u}</option> `
            ).join('') + '<option value="__custom__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>';
            wrapper.parentNode.replaceChild(select, wrapper);
        }

        // Îã®ÏúÑ ÏûÖÎ†• Î∏îÎü¨ Ïãú ÎπàÍ∞íÏù¥Î©¥ Í∏∞Î≥∏Í∞í
        function onUnitInputBlur(input) {
            if (!input.value.trim()) {
                input.value = 'Ïãù';
            }
        }

        // Í∏∞Î≥∏ ÏõêÍ∞Ä Îç∞Ïù¥ÌÑ∞ (Í∞ÄÏÑ§Í≥µÏÇ¨)
        const defaultCostData = {
            '01': [
                { div: 'Î≥¥Ïñë', name: 'ÏäπÍ∞ïÍ∏∞ ÌïòÌîÑÎ≥¥Ïñë', spec: 'ÏäπÍ∞ïÍ∏∞ ÌïòÌîÑÎ≥¥Ïñë', unit: 'Ïãù', qty: '1', price: '90000' },
                { div: 'Î≥¥Ïñë', name: 'ÏäπÍ∞ïÍ∏∞ Ï§ÄÎ≥¥Ïñë', spec: 'ÏäπÍ∞ïÍ∏∞ Ï§ÄÎ≥¥Ïñë', unit: 'Ïãù', qty: '1', price: '120000' },
                { div: 'Î≥¥Ïñë', name: 'ÏäπÍ∞ïÍ∏∞ Ïò¨Î≥¥Ïñë', spec: 'ÏäπÍ∞ïÍ∏∞ Ïò¨Î≥¥Ïñë', unit: 'Ïãù', qty: '1', price: '160000' },
                { div: 'Î≥¥Ïñë', name: 'Î≥µÎèÑÎ≥¥Ïñë', spec: 'ÌîåÎùºÎ≤†ÎãàÏïÑ (Í∏∞Î≥∏ 12Ïû•)', unit: 'Ïãù', qty: '1', price: '120000' },
                { div: 'Î≥¥Ïñë', name: 'ÎèôÏÑ†Î≥¥Ïñë', spec: 'Ï∂îÍ∞ÄÌï≠Î™©', unit: 'Ïãù', qty: '1', price: '6000' },
                { div: 'Î≥¥Ïñë', name: 'ÌòÑÍ¥ÄÎ¨∏ Î≥¥Ïñë', spec: 'ÌòÑÍ¥ÄÎ¨∏ Î≥¥Ïñë', unit: 'Ïãù', qty: '1', price: '50000' },
                { div: 'Î≥¥Ïñë', name: 'Ï∞ΩÌò∏ Î≥¥Ïñë', spec: 'Ïßë Ï†ÑÏ≤¥ Ï∞ΩÌò∏', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'Î≥¥Ïñë', name: 'Ïã§ÎÇ¥ Î∞îÎã• Î≥¥Ïñë', spec: 'Floor Veneer Í∏∞Î≥∏ 12Ïû•', unit: 'Ïãù', qty: '1', price: '120000' },
                { div: 'Î≥¥Ïñë', name: 'Ïã§ÎÇ¥ Î∞îÎã• Î≥¥Ïñë (Ï∂îÍ∞Ä)', spec: 'Floor Veneer', unit: 'Ïãù', qty: '1', price: '6000' },
                { div: 'Î≥¥Ïñë', name: 'Ïã§ÎÇ¥ Î∞îÎã• Î≥¥Ïñë', spec: 'Î°§ Í≥®ÌåêÏßÄ', unit: 'Î°§', qty: '1', price: '90000' },
                { div: 'Î≥¥Ïñë', name: 'ÎπÑÎãê Î≥¥Ïñë', spec: 'Ïª§Î≤ÑÎßÅ 2.4', unit: 'Ïãù', qty: '1', price: '50000' },
                { div: 'ÎèôÏùòÏÑú', name: 'ÏûÖÏ£ºÎØº ÎèôÏùòÏÑú', spec: '1~80 ÏÑ∏ÎåÄ (50%Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '160000' },
                { div: 'ÎèôÏùòÏÑú', name: 'ÏûÖÏ£ºÎØº ÎèôÏùòÏÑú', spec: '81~100 ÏÑ∏ÎåÄ (50%Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '190000' },
                { div: 'ÎèôÏùòÏÑú', name: 'ÏûÖÏ£ºÎØº ÎèôÏùòÏÑú', spec: '101~120 ÏÑ∏ÎåÄ (50%Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '210000' },
                { div: 'ÎèôÏùòÏÑú', name: 'ÏûÖÏ£ºÎØº ÎèôÏùòÏÑú', spec: '121~140 ÏÑ∏ÎåÄ (50%Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '230000' },
                { div: 'ÎèôÏùòÏÑú', name: 'ÏûÖÏ£ºÎØº ÎèôÏùòÏÑú', spec: 'Ï∂îÍ∞Ä 20ÏÑ∏ÎåÄ', unit: 'Ïãù', qty: '1', price: '20000' },
                { div: 'ÌóàÍ∞Ä', name: 'Í≥µÎèôÏ£ºÌÉù ÌñâÏúÑÌóàÍ∞Ä', spec: 'Ï£ºÌÉùÍ≥º', unit: 'Ïãù', qty: '1', price: '440000' },
                { div: 'ÌóàÍ∞Ä', name: 'Í≥µÎèôÏ£ºÌÉù ÌñâÏúÑÌóàÍ∞Ä', spec: 'Í±¥Ï∂ïÍ≥º', unit: 'Ïãù', qty: '1', price: '880000' },
                { div: 'ÌïÑÏ¶ù', name: 'Î∞©ÌôîÌåê', spec: 'ÏûêÏû¨+ÏãúÍ≥µ (1200*550)', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ÌïÑÏ¶ù', name: 'Î∞©ÌôîÏú†Î¶¨ (ÏßÅÏÑ†)', spec: 'ÏûêÏû¨+ÏãúÍ≥µ', unit: 'm', qty: '1', price: '180000' },
                { div: 'ÌïÑÏ¶ù', name: 'Î∞©ÌôîÏú†Î¶¨ (Í≥°ÏÑ†)', spec: 'ÏûêÏû¨+ÏãúÍ≥µ', unit: 'm', qty: '1', price: '200000' },
                { div: 'ÌïÑÏ¶ù', name: 'Í∞ëÏ¢Ö Î∞©ÌôîÎ¨∏', spec: 'ÏûêÏû¨+ÏãúÍ≥µ+ÏãúÌóòÏÑ±Ï†ÅÏÑú (900*2000)', unit: 'ea', qty: '1', price: '1300000' },
                { div: 'ÌïÑÏ¶ù', name: 'ÏÜåÎ∞© Í∞êÏßÄÍ∏∞', spec: 'Í±¥Ï†ÑÏßÄ Î∞©Ïãù', unit: 'ea', qty: '1', price: '20000' },
                { div: 'Ïö©ÎèÑÎ≥ÄÍ≤Ω', name: 'ÏÉÅÏóÖÍ≥µÍ∞Ñ Ïö©ÎèÑÎ≥ÄÍ≤Ω', spec: 'Íµ¨Ï°∞¬∑ÏÑ§ÎπÑ¬∑ÏúÑÏÉù¬∑ÏïàÏ†Ñ Í∏∞Ï§Ä Ï∂©Ï°± Ïó¨Î∂ÄÏóê Îî∞Î•∏ Ïã†Í≥†/ÌóàÍ∞Ä', unit: 'Ïãù', qty: '1', price: '0' }
            ],
            '02': [
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© Ï≤†Í±∞ (ÏÜåÌòï)', spec: '„Ö°Ïûê, „Ñ±Ïûê (3.5M ÎØ∏Îßå)', unit: 'set', qty: '1', price: '70000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© Ï≤†Í±∞ (Ï§ëÌòï)', spec: '„Ö°Ïûê, „Ñ±Ïûê (5M ÎØ∏Îßå)', unit: 'set', qty: '1', price: '90000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© Ï≤†Í±∞ (ÎåÄÌòï)', spec: '„Ö°Ïûê, „Ñ±Ïûê (5M Ïù¥ÏÉÅ)', unit: 'set', qty: '1', price: '100000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© Ï≤†Í±∞ (ÌäπÎåÄ)', spec: '12M ÎØ∏Îßå „Ñ∑Ïûê, „ÖÅÏûê, Î≥ëÎ†¨Ìòï', unit: 'set', qty: '1', price: '130000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© Ï≤†Í±∞ (Ï¥àÌäπÎåÄ)', spec: '12M Ïù¥ÏÉÅ „Ñ∑Ïûê, „ÖÅÏûê, Î≥ëÎ†¨Ìòï', unit: 'set', qty: '1', price: '160000' },
                { div: 'Ï£ºÎ∞©', name: 'Ïã±ÌÅ¨ÎåÄ Ï∂îÍ∞Ä (MÎãπ)', spec: 'Í∏∞Î≥∏ ÏÑ∏Ìä∏ Ï¥àÍ≥º Î¨ºÎüâ', unit: 'M', qty: '1', price: '10000' },
                { div: 'Ï£ºÎ∞©', name: 'ÏïÑÏùºÎûúÎìú ÏãùÌÉÅ', spec: 'ÎèÖÎ¶ΩÌòï (Ïπ¥Ïö¥ÌÑ∞ ÌÉÄÏûÖ Ï†úÏô∏)', unit: 'set', qty: '1', price: '35000' },
                { div: 'Ï£ºÎ∞©', name: 'Î≥¥Ï°∞Ï£ºÎ∞©', spec: 'Î∞úÏΩîÎãà Î≥¥Ï°∞Ï£ºÎ∞©', unit: 'set', qty: '1', price: '40000' },
                { div: 'Ï£ºÎ∞©', name: 'ÎÉâÏû•Í≥†Ïû•/ÌÇ§ÌÅ∞Ïû•', spec: 'Ïûê(30cm)Îãπ Îã®Í∞Ä', unit: 'Ïûê', qty: '1', price: '10000' },
                { div: 'Ï£ºÎ∞©', name: 'ÌÇ§ÌÅ∞Ïû• (Ïú†Î¶¨Ïû•Ïãù)', spec: 'ÎåÄÌòïÌèâÏàò Ïú†Î¶¨ Ïû•ÏãùÏû•', unit: 'Ïûê', qty: '1', price: '15000' },
                { div: 'Ï£ºÎ∞©', name: 'ÎÉâÏû•Í≥†Ïû• (Ïã†Ï∂ï EP)', spec: 'Î∞îÎã•/Ï≤úÏû• Ïû¨ÏÇ¨Ïö© Ïãú (Ï¢åÏö∞ EP)', unit: 'Ìåê', qty: '1', price: '50000' },
                { div: 'Ï£ºÎ∞©', name: 'ÎπåÌä∏Ïù∏ Í∏∞Í∏∞', spec: 'ÏãùÍ∏∞ÏÑ∏Ï≤ôÍ∏∞, Ïò§Î∏ê, ÏÑ∏ÌÉÅÍ∏∞ Îì±', unit: 'ea', qty: '1', price: '20000' },
                { div: 'Ï£ºÎ∞©', name: 'ÏàòÏ†Ñ(ÎÉâ/Ïò®)', spec: '1m ÎØ∏Îßå / ÎÇ¥Î¶ºÏÑ§ÎπÑ', unit: 'ea', qty: '1', price: '75000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© ÌÉÄÏùº Ï≤†Í±∞', spec: '1M Í∏∞Ï§Ä (H1200 Ïù¥Ìïò)', unit: 'M', qty: '1', price: '18000' },
                { div: 'Ï£ºÎ∞©', name: 'Ï£ºÎ∞© ÌÉÄÏùº+ÏÑ∏ÎùºÌîΩÏä§', spec: 'ÏÉåÎî© ÏûëÏóÖ Ìè¨Ìï® (ÏµúÍ≥†Í∞Ä Ï†ÅÏö©)', unit: 'py', qty: '1', price: '100000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Î∂ôÎ∞ïÏù¥Ïû•/Ïû•Î°±', spec: 'ÎèÑÏñ¥ 1Í∞ú Í∏∞Ï§Ä (Ïä¨ÎùºÏù¥Îî© x2)', unit: 'EA', qty: '1', price: '13000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Î∂ôÎ∞ïÏù¥Ïû• (Ïûê Îã®ÏúÑ)', spec: 'Ïûê(30cm)Îãπ Í≥ÑÏÇ∞ Ïãú', unit: 'Ïûê', qty: '1', price: '10000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'ÌòÑÍ¥ÄÏû• (Ïã†Î∞úÏû•)', spec: 'ÎèÑÏñ¥ 1Í∞ú Í∏∞Ï§Ä', unit: 'ea', qty: '1', price: '11000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Î≤ΩÎ∞ïÏù¥Ïû•/Ï∞ΩÍ≥†Ïû•', spec: 'Î¨∏ÌãÄ/Î¨∏ÏÑ†/Î¨∏Ïßù Ìè¨Ìï® (ÎØ∏Ïû•Î≥ÑÎèÑ)', unit: 'ea', qty: '1', price: '16000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Î≤ΩÎ∞ïÏù¥Ïû• (ÏÑ∏Ìä∏)', spec: 'Î¨∏4Í∞ú+ÎÇ¥Î∂ÄÏû• (ÎåÄÌòï)', unit: 'set', qty: '1', price: '120000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Í±∞Ïã§Ïû• (ÏÑ∏Ìä∏)', spec: 'ÏÜå2+Ï§ë1 Í∏∞Ï§Ä', unit: 'set', qty: '1', price: '30000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'ÎπåÌä∏Ïù∏ ÌôîÏû•ÎåÄ', spec: '1.5M Ïù¥Ìïò', unit: 'ea', qty: '1', price: '35000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Î≤†ÎûÄÎã§Ïû• (Ï∞ΩÍ≥†)', spec: 'ÎÇ¥Î∂Ä ÏÑ†Î∞ò Ìè¨Ìï®', unit: 'ea', qty: '1', price: '30000' },
                { div: 'Í∞ÄÍµ¨(ÏàòÎÇ©)', name: 'Ïπ®ÎåÄ+Îß§Ìä∏Î¶¨Ïä§', spec: 'ÌèêÍ∏∞Î¨º Ïä§Ìã∞Ïª§ Î∂ÄÏ∞© Í∂åÏû•', unit: 'ea', qty: '1', price: '60000' },
                { div: 'Î∞îÎã•', name: 'ÎßàÎ£® Ï≤†Í±∞ (Î≥∏ÎìúÏãù)', spec: 'Í∞ïÎßàÎ£®, Ìï©Ìåê, ÏõêÎ™© (Í∏∞Î≥∏ÏÉåÎî©)', unit: 'py', qty: '1', price: '25000' },
                { div: 'Î∞îÎã•', name: 'Í∞ïÌôîÎßàÎ£®', spec: 'Ï°∞Î¶ΩÏãù (Í∏∞Î≥∏ÏÉåÎî©)', unit: 'py', qty: '1', price: '17000' },
                { div: 'Î∞îÎã•', name: 'Îç∞ÏΩîÌÉÄÏùº', spec: '(Í∏∞Î≥∏ÏÉåÎî©)', unit: 'py', qty: '1', price: '20000' },
                { div: 'Î∞îÎã•', name: 'Ìè¥Î¶¨Ïã± ÌÉÄÏùº', spec: 'ÌÉÄÏùº+Î≥∏Îìú+ÏÉåÎî©', unit: 'py', qty: '1', price: '90000' },
                { div: 'Î∞îÎã•', name: 'ÎåÄÎ¶¨ÏÑù', spec: 'ÎåÄÎ¶¨ÏÑù+ÏÇ¨Î™®Îûò+Î™∞ÌÉàÎØ∏Ïû•(ÎÇúÎ∞©Î∞∞Í¥ÄÎØ∏Ìè¨Ìï®)', unit: 'py', qty: '1', price: '250000' },
                { div: 'Î∞îÎã•', name: 'ÎåÄÎ¶¨ÏÑù', spec: 'ÎåÄÎ¶¨ÏÑù+ÏÇ¨Î™®Îûò+Î™∞ÌÉàÎØ∏Ïû•(ÎÇúÎ∞©Î∞∞Í¥ÄÏû¨ÏãúÍ≥µ)', unit: 'py', qty: '1', price: '330000' },
                { div: 'Î∞îÎã•', name: 'Ïû•Ìåê Ï≤†Í±∞', spec: 'Î∞© 1Í∞ú Í∏∞Ï§Ä', unit: 'ea', qty: '1', price: '12000' },
                { div: 'Î∞îÎã•', name: 'ÌïúÏßÄ Ïû•Ìåê', spec: 'ÏÉåÎî©', unit: 'py', qty: '1', price: '12000' },
                { div: 'Î∞îÎã•', name: 'Î∞îÎã• ÏÉåÎî©', spec: 'Îã®Ï∞®/ÌèâÌôúÎèÑ Î∂àÎüâÏãú(Î¨∏ÌÑ±)', unit: 'ea', qty: '1', price: '60000' },
                { div: 'Ï∞ΩÌò∏', name: 'Í±∞Ïã§ Î∂ÑÌï©Ï∞Ω', spec: 'ÌôïÏû•Ïãú ÏÑ†Ï≤†Í±∞', unit: 'set', qty: '1', price: '150000' },
                { div: 'Ï∞ΩÌò∏', name: 'ÏûëÏùÄÎ∞© Î∂ÑÌï©Ï∞Ω', spec: 'ÌôïÏû•Ïãú ÏÑ†Ï≤†Í±∞', unit: 'set', qty: '1', price: '90000' },
                { div: 'Ï∞ΩÌò∏', name: 'ÎåÄÌòï ÏÉ∑Ïãú/Ìè¥Îî©', spec: 'ÌäπÎåÄÌòï Íµ¨Î∂Ñ', unit: 'set', qty: '1', price: '250000' },
                { div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ ÏÑ∏Ìä∏ Ï≤†Í±∞', spec: 'Î¨∏ÌãÄ+Î¨∏Ïßù+Î¨∏ÏÑ†+Ïù∏Î∞©', unit: 'set', qty: '1', price: '32000' },
                { div: 'ÎèÑÏñ¥', name: 'ÌäπÏàò Î¨∏ÌãÄ (Îèå/ABS)', spec: 'ÌèêÍ∏∞Î¨º Ìè¨Ìï®Ïãú (ÏµúÍ≥†Í∞Ä)', unit: 'set', qty: '1', price: '50000' },
                { div: 'ÎèÑÏñ¥', name: 'Î¨∏ÏßùÎßå Ï≤†Í±∞', spec: '', unit: 'ea', qty: '1', price: '30000' },
                { div: 'ÎèÑÏñ¥', name: 'Î¨∏ÌÑ± Ï†úÍ±∞', spec: 'ÎØ∏Ïû• Ìè¨Ìï®', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ÎèÑÏñ¥', name: 'Ï§ëÎ¨∏ Ï≤†Í±∞', spec: '3Ïó∞Îèô, „Ñ±ÏûêÎì± Ï¢ÖÎ•ò Î¨¥Í¥Ä', unit: 'set', qty: '1', price: '100000' },
                { div: 'ÎèÑÏñ¥', name: 'Î∞©ÌôîÎ¨∏ Ï≤†Í±∞', spec: '', unit: 'ea', qty: '1', price: '80000' },
                { div: 'Î≤ΩÎ©¥', name: 'Î≤ΩÎ©¥ Ï≤†Í±∞', spec: 'ÏÑùÍ≥† (h:2400)', unit: 'm', qty: '1', price: '40000' },
                { div: 'Î≤ΩÎ©¥', name: 'Îã®Ïó¥Î≤Ω Ï≤†Í±∞', spec: 'Î™©Ïû¨+Îã®Ïó¥(Ïä§Ìã∞Î°úÌè¥)+ÏÑùÍ≥† (h:2400)', unit: 'm', qty: '1', price: '70000' },
                { div: 'Î≤ΩÎ©¥', name: 'Îã®Ïó¥Î≤Ω Ï≤†Í±∞', spec: 'Î™©Ïû¨+Îã®Ïó¥(Ïú†Î¶¨ÏÑ¨Ïú†)+ÏÑùÍ≥† (h:2400)', unit: 'm', qty: '1', price: '90000' },
                { div: 'Î≤ΩÎ©¥', name: 'Í∞ÄÎ≤ΩÏ≤†Í±∞', spec: 'Î™©Í≥µ+ÏÑùÍ≥† (h:2400)', unit: 'm', qty: '1', price: '50000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Í∞ÄÎ≤Ω Ï≤†Í±∞', spec: 'Î™©Í≥µ/ÏÑùÍ≥†/Îã®Ïó¥Ïû¨ (H2400)', unit: 'M', qty: '1', price: '55000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ALC Î∏îÎü≠ Í∞ÄÎ≤Ω', spec: 'Î∏åÎùºÎçî ÏÉÅÏÑ∏ Ìï≠Î™©', unit: 'M', qty: '1', price: '120000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Ï°∞Ï†ÅÎ≤Ω (Î∂ÄÎ∂Ñ/ÎÇ†Í∞ú)', spec: 'ÎπÑÎÇ¥Î†• Ï°∞Ï†Å 1M', unit: 'M', qty: '1', price: '100000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Ï°∞Ï†ÅÎ≤Ω (ÎëêÍ≤π)', spec: 'Î∏åÎùºÎçî ÏÉÅÏÑ∏ Ìï≠Î™©', unit: 'M', qty: '1', price: '250000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ÏïÑÌä∏Ïõî (Î™©Í≥µ)', spec: 'H2400 Ïù¥Ìïò', unit: 'M', qty: '1', price: '33000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ÏïÑÌä∏Ïõî (ÌÉÄÏùº/ÏÑùÏû¨)', spec: 'H2400 Ïù¥Ìïò (ÏµúÍ≥†Í∞Ä Ï†ÅÏö©)', unit: 'M', qty: '1', price: '60000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ÏòπÎ≤Ω Ïª∑ÌåÖ', spec: 'Ïû•ÎπÑ(Î≤ΩÏ≤¥15, ÏÉ§ÏãúÌïòÎã®Î∂Ä45, ÌïòÎ£®65)', unit: 'Ïãù', qty: '1', price: '650000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨ºÏ≤úÏû• Í∏∞Î≥∏ Ï≤†Í±∞', spec: 'Ï£ºÎ≥Ä Î™∞Îî©Îßå', unit: 'set', qty: '1', price: '30000' },
                { div: 'Ï≤úÏû•', name: 'Îì±Î∞ïÏä§ Ï≤†Í±∞ (ÎåÄÌòï)', spec: 'Ï≤†Ï†ú/ÎåÄÌòï Îì±Î∞ïÏä§', unit: 'set', qty: '1', price: '200000' },
                { div: 'Ï≤úÏû•', name: 'Îì±Î∞ïÏä§ Ï≤†Í±∞ (ÏùºÎ∞ò)', spec: 'ÏùºÎ∞ò Î™©Í≥µ Îì±Î∞ïÏä§', unit: 'set', qty: '1', price: '50000' },
                { div: 'Ï≤úÏû•', name: 'Ï≤úÏû• Ï†ÑÏ≤¥ Ï≤†Í±∞', spec: 'ÏÑùÍ≥†Îßå(ÎåÑÏ°∞ Ïú†ÏßÄ)', unit: 'py', qty: '1', price: '20000' },
                { div: 'Ï≤úÏû•', name: 'Ï≤úÏû• Ï†ÑÏ≤¥ Ï≤†Í±∞', spec: 'Ïö∞Î¨ºÏ≤úÏû• ÎåÑÏ°∞Ìè¨Ìï® ÌèâÎãπ', unit: 'py', qty: '1', price: '40000' },
                { div: 'Ï≤úÏû•', name: 'Î™∞Îî©/Í±∏Î†àÎ∞õÏù¥', spec: 'ÌèâÎãπ Í∏∞Ï§Ä', unit: 'py', qty: '1', price: '4000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Í∏∞Î≥∏ Ï≤†Í±∞', spec: 'ÎèÑÍ∏∞/ÏöïÏ°∞/Ï≤úÏû•/Ïï°ÏÑ∏ÏÑúÎ¶¨', unit: 'set', qty: '1', price: '150000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Í∏∞Î≥∏ Ï≤†Í±∞', spec: 'ÎèÑÍ∏∞/frpÏöïÏ°∞/Ï≤úÏû•/Ïï°ÏÑ∏ÏÑúÎ¶¨', unit: 'set', qty: '1', price: '200000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Ï†ÑÏ≤¥ Ï≤†Í±∞', spec: 'ÌÉÄÏùº+Î∞©ÏàòÏ∏µ Ï†ÑÏ≤¥ (ÎåÄÌòï) - ÎÇúÎ∞©Î∞∞Í¥Ä Î≥ÑÎèÑ(10)', unit: 'set', qty: '1', price: '900000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Ï†ÑÏ≤¥ Ï≤†Í±∞', spec: 'ÌÉÄÏùº+Î∞©ÏàòÏ∏µ Ï†ÑÏ≤¥ (Ï§ëÌòï) - ÎÇúÎ∞©Î∞∞Í¥Ä Î≥ÑÎèÑ(7)', unit: 'set', qty: '1', price: '750000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Ï†ÑÏ≤¥ Ï≤†Í±∞', spec: 'ÌÉÄÏùº+Î∞©ÏàòÏ∏µ Ï†ÑÏ≤¥ (ÏÜåÌòï) - ÎÇúÎ∞©Î∞∞Í¥Ä Î≥ÑÎèÑ(5)', unit: 'set', qty: '1', price: '600000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Î∞îÎã• Ï≤†Í±∞', spec: 'Î∞îÎã• ÌÉÄÏùº+Ïï°Ï≤¥Î∞©Ïàò 1Ï∞®', unit: 'set', qty: '1', price: '400000' },
                { div: 'ÏöïÏã§', name: 'UBR ÏöïÏã§ Ï≤†Í±∞', spec: 'Ï†ÑÏ≤¥Ï≤†Í±∞+ÏÑ§ÎπÑ+Î∞©Ïàò 1Ï∞® (Ï°∞Ï†ÅÎ≤Ω Î≥ÑÎèÑ)', unit: 'set', qty: '1', price: '1200000' },
                { div: 'ÏöïÏã§', name: 'UBR ÏöïÏã§ Ï°∞Ï†Å', spec: 'ÏûÖÍµ¨ Î≤ΩÎ©¥ (h:1500)', unit: 'Î©¥', qty: '1', price: '200000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏ°∞ Ï≤†Í±∞', spec: 'ÏïÑÌÅ¨Î¶¥ ÏöïÏ°∞ (Í∞úÎ≥Ñ Ï≤†Í±∞Ïãú)', unit: 'ea', qty: '1', price: '35000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏ°∞ Ï≤†Í±∞', spec: 'ÏõîÌíÄ ÏöïÏ°∞ (Í∞úÎ≥Ñ Ï≤†Í±∞Ïãú)', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏ°∞ Ï≤†Í±∞ (Ï°∞Ï†Å)', spec: 'Ï°∞Ï†Å/Îß§Î¶Ω ÌòïÌÉú', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÏöïÏã§', name: 'ÏöïÏã§ Î≤ΩÌÉÄÏùº(1Î©¥)', spec: 'ÎçßÎ∞© Î∂àÍ∞ÄÏãú', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÏöïÏã§', name: 'ÎùºÎîîÏóêÏù¥ÌÑ∞ Ï≤†Í±∞', spec: 'Î©îÍæ∏Îùº/ÎØ∏Ïû• Ìè¨Ìï®', unit: 'EA', qty: '1', price: '100000' },
                { div: 'ÌÉÄÏùº', name: 'ÌòÑÍ¥Ä ÎîîÎî§ÏÑù', spec: 'ÌïúÎ©¥', unit: 'Ïãù', qty: '1', price: '50000' },
                { div: 'ÌÉÄÏùº', name: 'ÌòÑÍ¥Ä Î∞îÎã•', spec: 'ÌÉÄÏùºÎßå', unit: 'py', qty: '1', price: '50000' },
                { div: 'ÌÉÄÏùº', name: 'ÌòÑÍ¥Ä Î∞îÎã•', spec: 'ÏõêÎ∞îÎã•(ÌÉÄÏùº ÏãúÍ≥µÏãú Ï≠àÍæ∏ÎØ∏ÎπÑÏö© ÌèâÎãπ 5ÎßåÏõê Î≥ÑÎèÑ)', unit: 'py', qty: '1', price: '100000' },
                { div: 'ÌÉÄÏùº', name: 'Î∞úÏΩîÎãà Î∞îÎã•ÌÉÄÏùº Ï≤†Í±∞', spec: 'ÌÉÄÏùºÎßå 0.5Ìèâ(1.3M√ó1.3M)', unit: 'Ïãù', qty: '1', price: '50000' },
                { div: 'ÌÉÄÏùº', name: 'Î∞úÏΩîÎãà Î∞îÎã•ÌÉÄÏùº Ï≤†Í±∞', spec: 'ÌÉÄÏùº+ÏïïÏ∞©Î≥∏Îìú 0.5Ìèâ(1.3M√ó1.3M)', unit: 'Ïãù', qty: '1', price: '70000' },
                { div: 'ÌÉÄÏùº', name: 'Î∞úÏΩîÎãà Î∞îÎã•ÌÉÄÏùº Ï≤†Í±∞', spec: 'Ïõê Î∞îÎã•ÍπåÏßÄ(Î∞©ÏàòÎ≥ÑÎèÑ) 0.5Ìèâ(1.3M√ó1.3M)', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'Ï°∞Î™Ö', name: 'Î∞©Îì±', spec: '', unit: 'ea', qty: '1', price: '5000' },
                { div: 'Ï°∞Î™Ö', name: 'Í±∞Ïã§Îì±', spec: '', unit: 'ea', qty: '1', price: '15000' },
                { div: 'Ï°∞Î™Ö', name: 'Îß§ÏûÖÎì±', spec: '', unit: 'ea', qty: '1', price: '2000' },
                { div: 'Ï°∞Î™Ö', name: 'Ïä§ÏúÑÏπò/ÏΩòÏÑºÌä∏', spec: '', unit: 'Ìèâ', qty: '1', price: '4000' },
                { div: 'ÌôîÎã®', name: 'ÌôîÎã®', spec: 'Ìùô (Ïì∞Î†àÍ∏∞ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price: '100000' },
                { div: 'ÌôîÎã®', name: 'ÌôîÎã®', spec: 'Ï°∞Ï†Å (h:600 Í∏∞Ï§Ä)', unit: 'm', qty: '1', price: '100000' },
                { div: 'ÌôîÎã®', name: 'ÌôîÎã®', spec: 'ÏòπÎ≤Ω (h:600 Í∏∞Ï§Ä)', unit: 'm', qty: '1', price: '150000' },
                { div: 'ÌôîÎã®', name: 'ÌôîÎã®', spec: 'ÏòπÎ≤Ω (h:600 Í∏∞Ï§Ä-ÌÅ¨ÎùºÏÉ§ ÏûëÏóÖ)', unit: 'm', qty: '1', price: '250000' },
                { div: 'Í∞ÄÏä§', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Î∂ÄÎ∂ÑÏ≤†Í±∞', spec: 'Í∞ÄÏä§Î∞∞Í¥Ä ÎÇ¥Î∂Ä (Í≥ÑÎüâÍ∏∞ Ïú†ÏßÄ)', unit: 'Ïãù', qty: '1', price: '100000' },
                { div: 'Í∞ÄÏä§', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï†ÑÏ≤¥Ï≤†Í±∞', spec: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï†ÑÏ≤¥ Ï≤†Í±∞ (Ïô∏Î∂ÄÏóêÏÑú ÎßàÍ∞ê - Í≥ÑÎüâÍ∏∞ ÌòÑÏû•Ïóê Î≥¥Í¥Ä)', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: '1ÌÜ§ Ìä∏Îü≠ (ÎßåÏ∞®)', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'ÎåÄ', qty: '1', price: '550000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: '1ÌÜ§ Ìä∏Îü≠ (3/4)', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'ÎåÄ', qty: '1', price: '520000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: '1ÌÜ§ Ìä∏Îü≠ (1/2)', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'ÎåÄ', qty: '1', price: '320000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: '1ÌÜ§ Ìä∏Îü≠ (1/4)', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'ÎåÄ', qty: '1', price: '250000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: '1ÌÜ§ Ìä∏Îü≠ (Ï†ÅÏû¨Ìï®Î∞òÏ∞®)', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'ÎåÄ', qty: '1', price: '150000' },
                { div: 'ÌèêÍ∏∞Î¨º', name: 'ÏÜåÎüâ ÌèêÍ∏∞Î¨º', spec: 'ÌòºÌï©ÌèêÍ∏∞Î¨º (Ï†ïÎ¶¨Î∞è Ïù¥ÎèôÎπÑ Ìè¨Ìï®)', unit: 'Ïãù', qty: '1', price: '100000' }
            ],
            '03': [
                { div: 'Î∞©Ïàò', name: '2Ï∞® Ïï°Ï≤¥ Î∞©Ïàò', spec: 'Ï†ÑÏ≤¥ Î∞îÎã•/Î≤Ω(h:1000Ïù¥ÏÉÅ) Î∞©ÏàòÎ™∞ÌÉà', unit: 'Ïπ∏', qty: '1', price: '120000' },
                { div: 'Î∞©Ïàò', name: 'ÏöïÏ°∞ Î∞©Ïàò', spec: 'ÏöïÏ°∞Î∂ÄÎßå Î∞©Ïàò', unit: 'ea', qty: '1', price: '60000' },
                { div: 'Î∞©Ïàò', name: '3Ï∞® ÎèÑÎßâ Î∞©Ïàò ÏΩîÎÑàÎßå (2Ìöå)', spec: 'ÎßàÌéòÏù¥/ÏïÑÎç±Ïä§(ÌîÑÎùºÏù¥Î®∏+Î∞©ÏàòÏ†ú)-Ï∑®ÏïΩÎ∂ÄÏúÑ', unit: 'Ïπ∏', qty: '1', price: '200000' },
                { div: 'Î∞©Ïàò', name: '3Ï∞® ÎèÑÎßâ Î∞©Ïàò Ï†ÑÏ≤¥ (2Ìöå)', spec: 'ÎßàÌéòÏù¥/ÏïÑÎç±Ïä§(ÌîÑÎùºÏù¥Î®∏+Î∞©ÏàòÏ†ú)-(h:1000Ïù¥ÏÉÅ)', unit: 'Ïπ∏', qty: '1', price: '400000' },
                { div: 'ÎÇúÎ∞©Î∞∞Í¥Ä', name: 'ÎùºÏßÄÏóêÏù¥ÌÑ∞', spec: 'Ï≤†Í±∞ ÌõÑ ÏóëÏÖÄ ÎßàÍ∞ê+ÎØ∏Ïû• Ìè¨Ìï®', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÎÇúÎ∞©Î∞∞Í¥Ä', name: 'ÌôîÏû•Ïã§ ÎÇúÎ∞©Î∞∞Í¥Ä Ïó∞Ïû•', spec: 'ÌôîÏû•Ïã§ Î∞îÎã• ÎÇúÎ∞©Î∞∞Í¥Ä Ïó∞Ïû• - Í∏∞Î≥∏', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÎÇúÎ∞©Î∞∞Í¥Ä', name: 'ÌôîÏû•Ïã§ ÎÇúÎ∞©Î∞∞Í¥Ä Ïó∞Ïû•', spec: 'ÌôîÏû•Ïã§ Î∞îÎã• ÎÇúÎ∞©Î∞∞Í¥Ä Ïó∞Ïû• - ÌäπÎåÄ', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ÏàòÎèÑ', name: 'Í∏âÏàòÍ¥Ä Ïã†ÏÑ§ (ÎÖ∏Ï∂ú-1Î©¥)', spec: 'ÎÉâ/Ïò®Ïàò 1Ï°∞ Ïã†ÏÑ§ (1Î©¥ Í∫æÏùå Í∏∞Ï§Ä) - ÎÖ∏Ï∂ú', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ÏàòÎèÑ', name: 'Í∏âÏàòÍ¥Ä Ïã†ÏÑ§ (ÎÖ∏Ï∂ú-2Î©¥)', spec: 'ÎÉâ/Ïò®Ïàò 1Ï°∞ Ïã†ÏÑ§ (2Î©¥ Í∫æÏùå Í∏∞Ï§Ä) - ÎÖ∏Ï∂ú', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ÏàòÎèÑ', name: 'Í∏âÏàòÍ¥Ä Ïã†ÏÑ§ (Îß§Î¶Ω)', spec: 'ÎÉâ/Ïò®Ïàò 1Ï°∞ Ïã†ÏÑ§ (ÏòπÎ≤ΩÏùò Í≤ΩÏö∞) - Îß§Î¶Ω', unit: 'ea', qty: '1', price: '350000' },
                { div: 'ÏàòÎèÑ', name: 'Í∏âÏàòÍ¥Ä Ïù¥Îèô', spec: 'Í∏∞Ï°¥Î©¥ Ïù¥Îèô (ÏÑ∏Î©¥Î∂Ä Î™®Ïùå, ÏÉ§ÏõåÎ∂Ä ÎÜíÏù¥ Ï°∞Ï†à Îì±)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÌïòÏàò', name: 'PÌä∏Îû© Ï†ÑÌôò', spec: 'Î∞îÎã• Î∞∞Ïàò ‚Üí Î≤Ω Î∞∞Ïàò Ï†ÑÌôò (Ï≤†Í±∞, Îß§Î¶Ω Ìè¨Ìï®)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÌïòÏàò', name: 'ÌïòÏàòÍ¥Ä Ïù¥Îèô', spec: 'Î∞îÎã• Î∞∞Ïàò Ïù¥Îèô', unit: 'ea', qty: '1', price: '150000' },
                { div: 'Ïò§Ïàò', name: 'Ïò§Ïàò Î∞∞Í¥Ä', spec: '200~250mm Ïù¥Îèô', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ÏàòÎèÑ', name: 'ÏàòÎèÑ ÎßâÏùå', spec: 'Í∏∞Ï°¥ ÏàòÎèÑ ÎÉâ/Ïò®Ïàò 1Ï°∞', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÏàòÎèÑ', name: 'Îß§Î¶ΩÏàòÏ†Ñ', spec: 'ÏÉ§Ïõå/ÏÑ∏Î©¥ÎåÄ (Ï††Îã§Ïù¥ ÌïÑÏàò-Ìè¨Ìï®)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'Ï°∞Ï†Å', name: 'Ï°∞Ï†Å Ï††Îã§Ïù¥ (Ïàè)', spec: 'ÏÑ∏Î©¥ÎåÄÎ∂Ä Ï°∞Ï†Å Ï††Îã§Ïù¥ ÏãúÍ≥µ (h:1100)', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'Ï°∞Ï†Å', name: 'Ï°∞Ï†Å Ï††Îã§Ïù¥ (Î°±)', spec: 'ÏÑ∏Î©¥ÎåÄ+ÏÉ§Ïõå Ï†ÑÏ≤¥ Ï°∞Ï†Å Ï††Îã§Ïù¥ ÏãúÍ≥µ (h:1100)', unit: 'Ïãù', qty: '1', price: '250000' },
                {
                    div: 'Î∂ÑÎ∞∞Í∏∞', name: 'Î∂ÑÎ∞∞Í∏∞ ÍµêÏ≤¥ - Í∏∞Î≥∏', spec: 'Í∏∞Ï°¥ Î∂ÑÎ∞∞Í∏∞ ÍµêÏ≤¥ - ÏùºÎ∞ò (Ïù¥Îèô ÏóÜÏùå, ÏãúÏä§ÌÖú Íµ¨ÎèôÍ∏∞ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price: '1300000'
                },
                {
                    div: 'Î∂ÑÎ∞∞Í∏∞', name: 'Î∂ÑÎ∞∞Í∏∞ ÍµêÏ≤¥ - Îß§Î¶ΩÌòï', spec: 'Í∏∞Ï°¥ Î∂ÑÎ∞∞Í∏∞ ÍµêÏ≤¥ -Îß§Î¶ΩÌòï (Ïù¥Îèô ÏóÜÏùå, ÏãúÏä§ÌÖú Íµ¨ÎèôÍ∏∞ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '1500000'
                },
                { div: 'Î∂ÑÎ∞∞Í∏∞', name: 'Î∂ÑÎ∞∞Í∏∞ Ïù¥Îèô', spec: 'Í∏∞Ï°¥ Î∂ÑÎ∞∞Í∏∞ ÏúÑÏπòÏóêÏÑú 2m Ïù¥ÎÇ¥ Ïù¥Îèô (Í∏∞Ï°¥ Î∂ÑÎ∞∞Í∏∞ Ïû¨ÏÇ¨Ïö©)', unit: 'Ïãù', qty: '1', price: '1600000' },
                { div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï≤†Í±∞', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï≤†Í±∞', spec: 'Í∏∞Î≥∏ Ï≤†Í±∞ (Î∂ÄÎ∂Ñ Ï≤†Í±∞, Í≥ÑÎüâÍ∏∞ Ïú†ÏßÄÏÉÅÌÉú)', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï≤†Í±∞', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ï≤†Í±∞', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ (Ïô∏Î∂ÄÏóêÏÑú ÎßàÍ∞ê, Í≥ÑÎüâÍ∏∞ ÏÑ∏ÎåÄÎ≥¥Í¥Ä)', unit: 'Ïãù', qty: '1', price: '250000' },
                { div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïó∞Ïû•', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïó∞Ïû• (Í∏∞Ï°¥Ïú†ÏßÄ)', spec: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïù¥Îèô Í∏∞Ï°¥ Ïú†ÏßÄÌïòÎäî ÏÉÅÌÉúÏóêÏÑú', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïó∞Ïû•', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïó∞Ïû• (Î∂ÄÎ∂ÑÏ≤†Í±∞)', spec: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïù¥Îèô Î∂ÄÎ∂Ñ Ï≤†Í±∞', unit: 'Ïãù', qty: '1', price: '350000' },
                { div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§ (ÏÉÅÍ∞Ä)-Í∏∞Î≥∏', spec: 'Í∏∞Ï°¥ Í±¥Î¨ºÏóêÏÑú Î∞∞Í¥Ä Ïó∞Ïû•+ÏïàÏ†ÑÍ≤ÄÏÇ¨+ÏäπÏù∏', unit: 'Ïãù', qty: '1', price: '2000000' },
                {
                    div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§ (ÏÉÅÍ∞Ä)-Ï§ëÏÉÅ', spec: 'Í∏∞Ï°¥ Í±¥Î¨ºÏóêÏÑú Î∞∞Í¥Ä Ïó∞Ïû•+Î≥µÏû°ÌïúÍµ¨Ï°∞+ÏïàÏ†ÑÍ≤ÄÏÇ¨+ÏäπÏù∏', unit: 'Ïãù', qty: '1', price:
                        '3500000'
                },
                {
                    div: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§', name: 'Í∞ÄÏä§Î∞∞Í¥Ä Ïã†ÏÑ§ (ÏÉÅÍ∞Ä)-ÏµúÏÉÅ', spec: 'Í∏∞Ï°¥ Í±¥Î¨ºÏóêÏÑú Î∞∞Í¥Ä Ïó∞Ïû•+Î≥µÏû°ÌïúÍµ¨Ï°∞+ÏïàÏ†ÑÍ≤ÄÏÇ¨+ÏäπÏù∏(Îß§Î¶Ω-Ïû•ÎπÑ)', unit: 'Ïãù', qty: '1', price:
                        '5000000'
                },
                { div: 'ÎàÑÏàòÌÉêÏßÄ', name: 'ÎàÑÏàòÌÉêÏßÄ ÏàòÎèÑ Î∞∞Í¥Ä', spec: 'Ïßë ÎÇ¥Î∂Ä ÏàòÎèÑÎ∞∞Í¥Ä(ÎÉâ/Ïò®)', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'ÎàÑÏàòÌÉêÏßÄ', name: 'ÎàÑÏàòÌÉêÏßÄ ÎÇúÎ∞© Î∞∞Í¥Ä', spec: 'Ïßë ÎÇ¥Î∂Ä ÎÇúÎ∞©Î∞∞Í¥Ä Ï†êÍ≤Ä', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'ÎàÑÏàòÌÉêÏßÄ', name: 'ÎàÑÏàòÌÉêÏßÄ ÏàòÎèÑ/ÎÇúÎ∞© Î∞∞Í¥Ä', spec: 'Ïßë ÎÇ¥Î∂Ä ÏàòÎèÑÎ∞∞Í¥Ä(ÎÉâ/Ïò®) Î∞è ÎÇúÎ∞©Î∞∞Í¥Ä Ï†êÍ≤Ä', unit: 'Ïãù', qty: '1', price: '500000' }
            ],
            '04': [
                { div: 'ÌôïÏû•', name: 'Í±∞Ïã§ ÌôïÏû•', spec: 'Ï≤†Í±∞+Îã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+ÏóëÏÉê (ÌäπÎåÄ-ÌÜµÎ∞îÎã•)', unit: 'Ïãù', qty: '1', price: '1100000' },
                { div: 'ÌôïÏû•', name: 'Í±∞Ïã§ ÌôïÏû•', spec: 'Ï≤†Í±∞+Îã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+ÏóëÏÉê (ÎåÄÌòï)', unit: 'Ïãù', qty: '1', price: '900000' },
                { div: 'ÌôïÏû•', name: 'Í±∞Ïã§ ÌôïÏû•', spec: 'Ï≤†Í±∞+Îã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+ÏóëÏÉê (Í∏∞Î≥∏)', unit: 'Ïãù', qty: '1', price: '800000' },
                { div: 'ÌôïÏû•', name: 'Î∞©/Ï£ºÎ∞© ÌôïÏû•', spec: 'Ï≤†Í±∞+Îã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+ÏóëÏÉê (ÌÜµÎ∞îÎã•)', unit: 'Ïãù', qty: '1', price: '800000' },
                { div: 'ÌôïÏû•', name: 'Î∞©/Ï£ºÎ∞© ÌôïÏû•', spec: 'Ï≤†Í±∞+Îã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+ÏóëÏÉê (Í∏∞Î≥∏)', unit: 'Ïãù', qty: '1', price: '700000' },
                { div: 'ÌôïÏû•Îã®Ïó¥', name: 'Í±∞Ïã§ ÌôïÏû•Î∂Ä Îã®Ïó¥', spec: 'Î≤ΩÎã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+Ï≤úÏû•Îã®Ïó¥(Ïò®ÎèÑÎ¶¨)-Í∏∞Î≥∏', unit: 'Ïãù', qty: '1', price: '1100000' },
                { div: 'ÌôïÏû•Îã®Ïó¥', name: 'Î∞©/Ï£ºÎ∞© ÌôïÏû•Î∂Ä Îã®Ïó¥', spec: 'Î≤ΩÎã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+Ï≤úÏû•Îã®Ïó¥(Ïò®ÎèÑÎ¶¨)-Í∏∞Î≥∏', unit: 'Ïãù', qty: '1', price: '900000' },
                { div: 'ÌôïÏû•Îã®Ïó¥', name: 'Í±∞Ïã§ ÌôïÏû•Î∂Ä Îã®Ïó¥', spec: 'Î≤ΩÎã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+Ï≤úÏû•Îã®Ïó¥(Ïò®ÎèÑÎ¶¨)-ÎåÄÌòï(Îã®Ïó¥Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '1500000' },
                { div: 'ÌôïÏû•Îã®Ïó¥', name: 'Î∞©/Ï£ºÎ∞© ÌôïÏû•Î∂Ä Îã®Ïó¥', spec: 'Î≤ΩÎã®Ïó¥(ÏïÑÏù¥ÏÜåÌïëÌÅ¨)+Ï≤úÏû•Îã®Ïó¥(Ïò®ÎèÑÎ¶¨)-ÎåÄÌòï(Îã®Ïó¥Í∏∞Ï§Ä)', unit: 'Ïãù', qty: '1', price: '1200000' },
                { div: 'Îã®Ïó¥', name: 'ÏïàÎ∞© Ïô∏Î≤Ω Îã®Ïó¥', spec: 'ÏïÑÏù¥ÏÜåÌïëÌÅ¨(50t+50t)+ÏÑùÍ≥†1p-Í∏∞Î≥∏', unit: 'Î©¥', qty: '1', price: '800000' },
                { div: 'Îã®Ïó¥', name: 'ÏïàÎ∞© Ïô∏Î≤Ω Îã®Ïó¥', spec: 'ÏïÑÏù¥ÏÜåÌïëÌÅ¨(50t+50t)+Îã§Î£®ÎÅº+Í∏∞Î∞Ä(ÎìÄÌè∞Ìà¨Ïäµ)_ÏÑùÍ≥†2p-Í≥†Í∏â', unit: 'Î©¥', qty: '1', price: '1100000' },
                { div: 'Îã®Ïó¥', name: 'Î∞© Ïô∏Î≤Ω Îã®Ïó¥', spec: 'ÏïÑÏù¥ÏÜåÌïëÌÅ¨(50t+50t)+ÏÑùÍ≥†1p-Í∏∞Î≥∏', unit: 'Î©¥', qty: '1', price: '500000' },
                { div: 'Îã®Ïó¥', name: 'Î∞© Ïô∏Î≤Ω Îã®Ïó¥', spec: 'ÏïÑÏù¥ÏÜåÌïëÌÅ¨(50t+50t)+Îã§Î£®ÎÅº+Í∏∞Î∞Ä(ÎìÄÌè∞Ìà¨Ïäµ)_ÏÑùÍ≥†2p-Í≥†Í∏â', unit: 'Î©¥', qty: '1', price: '800000' },
                { div: 'Îã®Ïó¥', name: 'ÌôîÏû•Ïã§ Î≤ΩÎ©¥ Îã®Ïó¥', spec: 'ÏïÑÏù¥ÏÜåÌïëÌÅ¨(30t)+ÏÑùÍ≥†1p', unit: 'Î©¥', qty: '1', price: '300000' }
            ],
            '05': [
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '20Ìèâ Ïù¥Ìïò ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '6000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '21~25Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '8000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '26~30Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '9000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '31~35Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '10000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '36~40Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '13000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '41~45Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '16000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '46~50Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '19000000' },
                { div: 'Ï∞ΩÌò∏', name: 'kcc Ï∞ΩÌò∏', spec: '51Ìèâ Ïù¥ÏÉÅ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '22000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '20Ìèâ Ïù¥Ìïò ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '7000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '21~25Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '8000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '26~30Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '11000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '31~35Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '13000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '36~40Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '16000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '41~45Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '19000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '46~50Ìèâ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '22000000' },
                { div: 'Ï∞ΩÌò∏', name: 'LX ÏßÄÏù∏ Ï∞ΩÌò∏ Î∑∞ÌîÑÎ†àÏûÑ', spec: '51Ìèâ Ïù¥ÏÉÅ ÏòàÏÉÅÍ≤¨Ï†ÅÍ∞Ä - Ïã§Ï∏° ÏôÑÎ£å ÌõÑ Ïû¨ÏïàÎÇ¥.', unit: 'Ïãù', qty: '1', price: '25000000' },
                { div: 'Î∞©Ï∂©Îßù', name: 'ÎØ∏ÏÑ∏ Î∞©Ï∂©Îßù', spec: 'ÌÅ∞ Ï∞Ω', unit: 'ea', qty: '1', price: '70000' },
                { div: 'Î∞©Ï∂©Îßù', name: 'ÎØ∏ÏÑ∏ Î∞©Ï∂©Îßù', spec: 'ÏûëÏùÄ Ï∞Ω', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ÌÅ¨Î¶¨ÏÑºÌä∏', name: 'ÌÅ¨Î¶¨ÏÑºÌä∏ ÍµêÏ≤¥', spec: '', unit: 'ea', qty: '1', price: '10000' },
                { div: 'Ìè¥Îî©ÎèÑÏñ¥', name: 'Ìè¥Îî©ÎèÑÏñ¥(Ïßù)', spec: '', unit: 'ea', qty: '1', price: '470000' }
            ],
            '06': [
                { div: 'Î∞∞ÏÑ†', name: 'Ï†ÑÍ∏∞ Î∞∞ÏÑ† (Í∏∞Î≥∏)', spec: 'Ï†ÑÍ∏∞ Î∞∞ÏÑ† ÎπÑÏö©(2.5SQ-HIV)', unit: 'py', qty: '1', price: '60000' },
                { div: 'Î∞∞ÏÑ†', name: 'Îã®ÎèÖÎ∞∞ÏÑ†(Ï∞®Îã®Í∏∞Ìè¨Ìï®)', spec: 'Ïù∏ÎçïÏÖò (4SQ-HIV)', unit: 'ea', qty: '1', price: '300000' },
                { div: 'Î∞∞ÏÑ†', name: 'Îã®ÎèÖÎ∞∞ÏÑ†(Ï∞®Îã®Í∏∞Ìè¨Ìï®)', spec: 'Ï£ºÎ∞©(Î≥¥Ï°∞Ï£ºÎ∞©, Ï†ïÏàòÍ∏∞ Îì±)-Ï∞®Îã®Í∏∞ Í∞ÄÍµ¨Î°ú Ïà®ÍπÄ', unit: 'ea', qty: '1', price: '250000' },
                { div: 'Î∞∞ÏÑ†', name: 'ÏùºÍ¥ÑÏÜåÎì±', spec: 'ÏùºÍ¥Ñ ÏÜåÎì± Ìè¨Ìï® Í∏∞Í≥ÑÏãù(Ï†ÑÏûêÏãù Î≥ÑÎèÑ)', unit: 'ea', qty: '1', price: '300000' },
                { div: 'Î∞∞ÏÑ†', name: 'Ïä§ÏúÑÏπò Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä Í∞ÄÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '100000' },
                { div: 'Î∞∞ÏÑ†', name: '3Î°ú Ïä§ÏúÑÏπò Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä Í∞ÄÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '120000' },
                { div: 'Î∞∞ÏÑ†', name: 'Ïä§ÏúÑÏπò Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä ÏòπÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '170000' },
                { div: 'Î∞∞ÏÑ†', name: '3Î°ú Ïä§ÏúÑÏπò Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä ÏòπÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '190000' },
                { div: 'Î∞∞ÏÑ†', name: 'ÏΩòÏÑºÌä∏ Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä Í∞ÄÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '30000' },
                { div: 'Î∞∞ÏÑ†', name: 'ÏΩòÏÑºÌä∏ Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïã†ÏÑ§ ÏúÑÏπòÍ∞Ä ÏòπÎ≤ΩÏùò Í≤ΩÏö∞', unit: 'ea', qty: '1', price: '70000' },
                { div: 'Î∞∞ÏÑ†', name: 'ÏΩòÏÑºÌä∏ Î∞è Ïä§ÏúÑÏπò Ï¶ùÏÑ§/Ïù¥ÏÑ§', spec: 'Ïπ®ÎåÄ Ìó§Îçî Ï¢å/Ïö∞ Ïã†ÏÑ§ (ÏùºÍ¥ÑÏÜåÎì± ÏïàÎê®)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ÎπÑÎîîÏò§Ìè∞', name: 'ÎπÑÎîîÏò§ÏÑ† Î∞∞ÏÑ† Ïó∞Ïû•', spec: '1m Ïù¥ÎÇ¥', unit: 'Ïãù', qty: '1', price: '100000' },
                { div: 'ÎπÑÎîîÏò§Ìè∞', name: 'ÎπÑÎîîÏò§Ìè∞ Î∞∞ÏÑ† Ïó∞Ïû•', spec: '1m Ïù¥ÏÉÅ', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'Ïò®ÎèÑÏ°∞Ï†àÍ∏∞', name: 'Ïò®ÎèÑÏ°∞Ï†àÍ∏∞ Î∞∞ÏÑ† Ï∂îÍ∞Ä', spec: 'Í∞ÅÎ∞© Ïò®ÎèÑ Ï°∞Ï†àÍ∏∞ Î∞∞ÏÑ† Í∞ÅÏã§ Í∏∞Ï§Ä (Ìè≠Ïä§ÌÉÄÍ≥µ Î≥ÑÎèÑ)', unit: 'ea', qty: '1', price: '50000' },
                { div: 'Ï∞®Îã®Í∏∞', name: 'Ï∞®Îã®Í∏∞ ÍµêÏ≤¥', spec: 'Í∏∞Î≥∏ 6ÌöåÎ°ú Ï∞®Îã®Í∏∞Îßå ÍµêÏ≤¥', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'Ï∞®Îã®Í∏∞', name: 'Ï∞®Îã®Í∏∞ ÍµêÏ≤¥', spec: 'Ï∞®Îã®Í∏∞ Ï∂îÍ∞Ä (Î≤ΩÎ©¥ Ï≤†Í±∞+Ï∞®Îã®Í∏∞ Ï∂îÍ∞Ä)', unit: 'Ïãù', qty: '1', price: '500000' },
                { div: 'ÌòÑÍ¥Ä', name: 'ÌòÑÍ¥Ä Ï°∞Î™Ö', spec: 'ÌòÑÍ¥Ä 3Ïù∏Ïπò or 2Ïù∏Ïπò (ÌûàÎì†ÏÑºÏÑú+ÎùÑÏõÄ Ïã†Î∞úÏû• Í∞ÑÏ†ë T5)', unit: 'Ïãù', qty: '1', price: '250000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Î∞©Îì±', spec: 'led Ïó£ÏßÄÎì± (640*640) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '70000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Î∞©Îì±', spec: 'led Ïä§ÎßàÌä∏ Ïó£ÏßÄÎì± (640*640) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '150000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Ï£ºÎ∞©Îì±', spec: 'led Ïó£ÏßÄÎì± (640*220) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '50000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Ï£ºÎ∞©Îì±', spec: 'led Ïä§ÎßàÌä∏ Ïó£ÏßÄ (635*320) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '120000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Ï£ºÎ∞©Îì±', spec: 'led Ïó£ÏßÄÎì± (1280*320) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '110000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Ï£ºÎ∞©Îì±', spec: 'led Ïä§ÎßàÌä∏ Ïó£ÏßÄ (1280*320) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '130000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Îß§ÏûÖÎì±', spec: 'Ìò∏Î•∏ 2Ïù∏Ïπò led ÌôïÏÇ∞ COB(5w) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '17000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Îß§ÏûÖÎì±', spec: 'Ìò∏Î•∏ 3Ïù∏Ïπò led ÌôïÏÇ∞ COB(8w) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '17000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Îß§ÏûÖÎì±', spec: 'ÏõÄÌëπ 2Ïù∏Ïπò led (5w) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '5000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Îß§ÏûÖÎì±', spec: 'ÏõÄÌëπ 3Ïù∏Ïπò led (5w) - ÏãúÍ≥µÎπÑ Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '6000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Ìä∏Î¶ºÎ¶¨Ïä§', spec: 'Î†àÏùº 4m Ïù¥ÎÇ¥ 205Í∏∏Ïù¥ 6Í∞ú(Î™©Í≥µÎ≥ÑÎèÑ)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Í∞ÑÏ†ëÎì±', spec: 't3 led (27mm)', unit: 'm', qty: '1', price: '7000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Í∞ÑÏ†ëÎì±', spec: 't5 led (35mm)', unit: 'm', qty: '1', price: '7500' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-Í∞ÑÏ†ëÎì±', spec: 'led Î∞î - Ï£ºÎ¨∏Ï†úÏûë', unit: 'Ïãù', qty: '1', price: '0' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-ÏßÅÎ∂ÄÎì±', spec: '8Ïù∏Ïπò led (ÏõêÌòï/ÏÇ¨Í∞Å)', unit: 'ea', qty: '1', price: '12000' },
                { div: 'Ï°∞Î™Ö', name: 'Ï°∞Î™Ö-ÏÑºÏÑúÎì±', spec: '8Ïù∏Ïπò led (ÏõêÌòï/ÏÇ¨Í∞Å)', unit: 'ea', qty: '1', price: '12000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Í∏∞Î≥∏Ìòï', spec: 'Ï†úÏùº ÎîîÏïÑÌä∏ 20ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '400000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Í∏∞Î≥∏Ìòï', spec: 'Ï†úÏùº ÎîîÏïÑÌä∏ 30ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '550000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Í∏∞Î≥∏Ìòï', spec: 'Ï†úÏùº ÎîîÏïÑÌä∏ 40ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '700000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Î•¥Í∑∏Îûë', spec: 'ÏïÑÌÖåÏò§ 20ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '650000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Î•¥Í∑∏Îûë', spec: 'ÏïÑÌÖåÏò§ 30ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '850000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Î•¥Í∑∏Îûë', spec: 'ÏïÑÌÖåÏò§ 40ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '1000000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Ïú†ÎüΩÌòïÏúµ', spec: '20ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '800000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Ïú†ÎüΩÌòïÏúµ', spec: '30ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '1100000' },
                { div: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïä§ÏúÑÏπòÏΩòÏÑºÌä∏ - Ïú†ÎüΩÌòïÏúµ', spec: '40ÌèâÎåÄ', unit: 'Ïãù', qty: '1', price: '1600000' },
                { div: 'Í∞êÏßÄÍ∏∞', name: 'Í∞êÏßÄÍ∏∞', spec: 'Ï∞®ÎèôÏãù/Ï†ïÏò®Ïãù', unit: 'ea', qty: '1', price: '5000' },
                { div: 'Ïù∏Í±¥ÎπÑ', name: 'Ï†ÑÍ∏∞ Í∏∞Ïà†Ïûê 1Ìíà', spec: 'Í≤ΩÎπÑ/ÏãùÎåÄ/Ïû•ÎπÑ Ìè¨Ìï®.', unit: 'ea', qty: '1', price: '400000' },
                { div: 'Ïã§ÎßÅÌå¨', name: 'Ïã§ÎßÅÌå¨', spec: 'Î≥¥Í∞ïÎ∞è ÏãúÍ≥µÎπÑ Ìè¨Ìï®(ÏûêÏû¨ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÌôîÏù¥Ìä∏', spec: '1Íµ¨ Ïä§ÏúÑÏπò (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '1880' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÌôîÏù¥Ìä∏', spec: '2Íµ¨ Ïä§ÏúÑÏπò (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '2640' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÌôîÏù¥Ìä∏', spec: '3Íµ¨ Ïä§ÏúÑÏπò (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '3450' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÌôîÏù¥Ìä∏', spec: '4Íµ¨ Ïä§ÏúÑÏπò (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '4240' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÌôîÏù¥Ìä∏', spec: 'Î∞©Î∂à/Î∞©Îì± Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '5350' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÎßàÍ∑∏ÎÑ§Ìã±', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3100' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÎßàÍ∑∏ÎÑ§Ìã±', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3740' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÎßàÍ∑∏ÎÑ§Ìã±', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Î•¥Í∑∏Îûë ÏïÑÌãÄÎùºÏä§ ÎßàÍ∑∏ÎÑ§Ìã±', spec: 'Î∞©Î∂à/Î∞©Îì± Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4950' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 / LS ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ Ïä§ÏúÑÏπò (1Î™®Îìà, ÌôîÏù¥Ìä∏/ÏïÑÏù¥Î≥¥Î¶¨)', unit: 'ea', qty: '1', price: '10000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 / LS ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ Ïä§ÏúÑÏπò (2Î™®Îìà, ÌôîÏù¥Ìä∏/ÏïÑÏù¥Î≥¥Î¶¨)', unit: 'ea', qty: '1', price: '18000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 / LS ÏãúÎ¶¨Ï¶à', spec: '3Íµ¨ Ïä§ÏúÑÏπò (3Î™®Îìà, ÌôîÏù¥Ìä∏/ÏïÑÏù¥Î≥¥Î¶¨)', unit: 'ea', qty: '1', price: '43000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÏΩòÏÑºÌä∏Î•ò', spec: '1Íµ¨ ÏΩòÏÑºÌä∏ (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '5300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÏΩòÏÑºÌä∏Î•ò', spec: '2Íµ¨ ÏΩòÏÑºÌä∏ (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '11000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÏΩòÏÑºÌä∏Î•ò', spec: '3Íµ¨ ÏΩòÏÑºÌä∏ (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '16500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÏΩòÏÑºÌä∏Î•ò', spec: '4Íµ¨ ÏΩòÏÑºÌä∏ (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '27000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÏΩòÏÑºÌä∏Î•ò', spec: '5Íµ¨ ÏΩòÏÑºÌä∏ (Í∏∞Î≥∏)', unit: 'ea', qty: '1', price: '39000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÌîÑÎ†àÏûÑ', spec: '1Íµ¨ ÌîÑÎ†àÏûÑ (WHITE/BLACK Îì± Íµ¨ÏàòÎ≥Ñ)', unit: 'ea', qty: '1', price: '5200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÌîÑÎ†àÏûÑ', spec: '2Íµ¨ ÌîÑÎ†àÏûÑ (WHITE/BLACK Îì± Íµ¨ÏàòÎ≥Ñ)', unit: 'ea', qty: '1', price: '11000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÌîÑÎ†àÏûÑ', spec: '3Íµ¨ ÌîÑÎ†àÏûÑ (WHITE/BLACK Îì± Íµ¨ÏàòÎ≥Ñ)', unit: 'ea', qty: '1', price: '16000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÌîÑÎ†àÏûÑ', spec: '4Íµ¨ ÌîÑÎ†àÏûÑ (WHITE/BLACK Îì± Íµ¨ÏàòÎ≥Ñ)', unit: 'ea', qty: '1', price: '27000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'Ïúµ LS990 ÌîÑÎ†àÏûÑ', spec: '5Íµ¨ ÌîÑÎ†àÏûÑ (WHITE/BLACK Îì± Íµ¨ÏàòÎ≥Ñ)', unit: 'ea', qty: '1', price: '39000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3100' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4400' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '5400' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '4Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '6800' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '5Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '8200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '4650' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '7450' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: '3Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '10000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'VEKO Î≤†ÏΩîÎÖ∏ ÏãúÎ¶¨Ï¶à', spec: 'TV/ÌÜµÌï©', unit: 'ea', qty: '1', price: '8600' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T1 TRIICO', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3100' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T1 TRIICO', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T1 TRIICO', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '5000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T1 TRIICO', spec: '1Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '4000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T1 TRIICO', spec: '2Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '5500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T14 ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T14 ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '5300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T14 ÏãúÎ¶¨Ï¶à', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '6300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T14 ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '4200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'TILINS Ìã∞Î¶∞Ïä§ T14 ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '5300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'ÏßÑÌù•Ï†ÑÍ∏∞ J ÏãúÎ¶¨Ï¶à', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '2000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'ÏßÑÌù•Ï†ÑÍ∏∞ J ÏãúÎ¶¨Ï¶à', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3100' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'ÏßÑÌù•Ï†ÑÍ∏∞ J ÏãúÎ¶¨Ï¶à', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'ÏßÑÌù•Ï†ÑÍ∏∞ J ÏãúÎ¶¨Ï¶à', spec: '4Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '5000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'ÏßÑÌù•Ï†ÑÍ∏∞ J ÏãúÎ¶¨Ï¶à', spec: 'TV/Ï†ÑÌôî/ÌÜµÌï©', unit: 'ea', qty: '1', price: '8000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '1Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '2300' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '2Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '3500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '3Íµ¨ Ïä§ÏúÑÏπò', unit: 'ea', qty: '1', price: '4700' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '1Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '3600' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '2Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '4900' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏', name: 'NANO ÎÇòÎÖ∏Ï†ÑÍ∏∞ Ïò§ÎéÄÏÑ∏Ïù¥/ÏïÑÌä∏', spec: '3Íµ¨ ÏΩòÏÑºÌä∏', unit: 'ea', qty: '1', price: '6200' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '1Íµ¨ (2,000 ~ 4,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '3000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '2Íµ¨ (3,000 ~ 5,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '4000' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '3Íµ¨ (4,000 ~ 7,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '5500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '4Íµ¨ (6,000 ~ 9,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '7500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '5Íµ¨ (7,000 ~ 12,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '9500' },
                { div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Íµ≠ÎÇ¥ Î∏åÎûúÎìú Ïä§ÏúÑÏπò', spec: '6Íµ¨ (8,000 ~ 14,000ÏõêÎåÄ ÌèâÍ∑†)', unit: 'ea', qty: '1', price: '11000' },
                {
                    div: 'Í∞úÎ≥ÑÏä§ÏúÑÏπòÏΩòÏÑºÌä∏(ÌèâÍ∑†)', name: 'Î•¥Í∑∏Îûë/Ïúµ ÌîÑÎ¶¨ÎØ∏ÏóÑÍµ∞', spec: '1Íµ¨ Í∏∞Ï§Ä (8,000 ~ 12,000ÏõêÎ∂ÄÌÑ∞ ÏãúÏûë)', unit: 'ea', qty: '1', price:
                        '10000'
                }
            ],
            '07': [
                {
                    div: 'ÏóòÏßÄ ÏóêÏñ¥Ïª®', name: 'LG ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® 2ÎåÄ', spec: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏùºÎ∞òÌòï(Îã®Î∞∞Í¥Ä: 18/6) - Ïã§Ïô∏ÎπÑ 3ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '3900000'
                },
                {
                    div: 'ÏóòÏßÄ ÏóêÏñ¥Ïª®', name: 'LG ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® 3ÎåÄ', spec: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏùºÎ∞òÌòï(Îã®Î∞∞Í¥Ä: 18/6/5) - Ïã§Ïô∏ÎπÑ 4ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '5200000'
                },
                {
                    div: 'ÏóòÏßÄ ÏóêÏñ¥Ïª®', name: 'LG ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® 4ÎåÄ', spec: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏùºÎ∞òÌòï(Îã®Î∞∞Í¥Ä: 18/6/5/5) - Ïã§Ïô∏ÎπÑ 4ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '6200000'
                },
                {
                    div: 'ÏóòÏßÄ ÏóêÏñ¥Ïª®', name: 'LG ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® 5ÎåÄ', spec: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏùºÎ∞òÌòï(Îã®Î∞∞Í¥Ä: 18/6/5/5) - Ïã§Ïô∏ÎπÑ 4ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '7800000'
                },
                {
                    div: 'ÏóòÏßÄ ÏóêÏñ¥Ïª®', name: 'LG ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® 6ÎåÄ', spec: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏùºÎ∞òÌòï(Îã®Î∞∞Í¥Ä: 18/6/5/5/5) - Ïã§Ïô∏ÎπÑ 5ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '8900000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 2ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/6) - Ïã§Ïô∏Í∏∞ 3ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '3400000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 3ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/6/5) - Ïã§Ïô∏Í∏∞ 4ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1', price:
                        '4500000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 4ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/6/5/5) - Ïã§Ïô∏Í∏∞ 4ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1',
                    price: '5300000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 5ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/6/5/5) - Ïã§Ïô∏Í∏∞ 5ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1',
                    price: '6700000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 6ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/8/6/5/5/5) - Ïã§Ïô∏Í∏∞ 5ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1',
                    price: '7800000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 7ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 10/10/8/6/6/6/6) - Ïã§Ïô∏Í∏∞ 6ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty:
                        '1', price: '8200000'
                },
                {
                    div: 'ÏÇºÏÑ± ÏóêÏñ¥Ïª®', name: 'SAMSUNG ÏóêÏñ¥Ïª® 7ÎåÄ', spec: 'Î¨¥Ìíç ÏôÄÏù¥ÌååÏù¥ ÎÇ¥Ïû•Ìòï(Îã®Î∞∞Í¥Ä: 18/8/8/6/6/6/6) - Ïã§Ïô∏Í∏∞ 6ÎßàÎ†•/ÎÉâÎ∞©', unit: 'Ïãù', qty: '1',
                    price: '8500000'
                },
                { div: 'Í∏∞ÌÉÄ Ï∂îÍ∞Ä Ìï≠Î™©', name: 'Ïã§Ïô∏Í∏∞ ÏïµÍ∏Ä (1Îã®)', spec: 'ÏïåÎ£®ÎØ∏ÎäÑ Î∞îÎã•Ïö© 1Îã®', unit: 'Ïãù', qty: '1', price: '70000' },
                { div: 'Í∏∞ÌÉÄ Ï∂îÍ∞Ä Ìï≠Î™©', name: 'Ïã§Ïô∏Í∏∞ ÏïµÍ∏Ä (ÌñâÏñ¥Ïö©)', spec: 'ÏïåÎ£®ÎØ∏ÎäÑ 1050~1150', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'Í∏∞ÌÉÄ Ï∂îÍ∞Ä Ìï≠Î™©', name: 'Ïã§Ïô∏Í∏∞ Î∞õÏπ®ÎåÄ', spec: 'Î∞úÌÜµ (Ï£ºÍ±∞Ïö©)', unit: 'Ïãù', qty: '1', price: '30000' },
                { div: 'Í∏∞ÌÉÄ Ï∂îÍ∞Ä Ìï≠Î™©', name: 'Ïã§Ïô∏Í∏∞ ÏóêÏñ¥Í∞ÄÎìú', spec: 'Î∞îÎûåÎßâÏù¥ (ÏïåÎ£®ÎØ∏ÎäÑ)', unit: 'Ïãù', qty: '1', price: '50000' },
                { div: 'Í∏∞ÌÉÄ Ï∂îÍ∞Ä Ìï≠Î™©', name: 'Îã®ÏÉÅ Ï∞®Îã®Í∏∞', spec: 'ÎàÑÏ†Ñ 220V', unit: 'Ïãù', qty: '1', price: '50000' }
            ],
            '08': [
                { div: 'Î≤ΩÏ≤¥', name: 'Î≤ΩÎ©¥ ÏÑùÍ≥† ÏãúÍ≥µ', spec: 'Î≤ΩÎ©¥ ÏÑùÍ≥† Î©¥ÎßûÏ∂§ Îñ†Î∂ôÏûÑ 1p (h:2400)', unit: 'm', qty: '1', price: '70000' },
                { div: 'Í∞ÄÎ≤Ω', name: 'Ï£ºÎ∞© Í∞ÄÎ≤Ω Ïã†ÏÑ§', spec: 'Îã§Î£®ÎÅº Í∞ÄÎ≤Ω (ÎÉâÏû•Í≥†) - 1mÏù¥ÎÇ¥ ÎëêÍªò60mm', unit: 'ea', qty: '1', price: '150000' },
                { div: 'Í∞ÄÎ≤Ω', name: 'Ï§ëÎ¨∏ Í∞ÄÎ≤Ω Ïã†ÏÑ§', spec: 'Ìà¨Î∞îÏù¥ Í∞ÄÎ≤Ω (Ï§ëÎ¨∏) - 1mÏù¥ÎÇ¥ ÎëêÍªò90mm - Í≥µÌãÄ', unit: 'ea', qty: '1', price: '350000' },
                { div: 'Í∞ÄÎ≤Ω', name: 'ÏßÅÍ∞Å Í≤åÏù¥Ìä∏ Í≥µÌãÄ MD', spec: 'Ï∏°Î©¥ MD ÎßàÍ∞ê', unit: 'ÌãÄ', qty: '1', price: '100000' },
                { div: 'Í∞ÄÎ≤Ω', name: 'ÏïÑÏπò Í≤åÏù¥Ìä∏ Í≥µÌãÄ MD', spec: 'Ï∏°Î©¥ MD ÎßàÍ∞ê', unit: 'ÌãÄ', qty: '1', price: '150000' },
                { div: 'Í∞ÄÎ≤Ω', name: 'Í∞ÄÎ≤Ω Ïã†ÏÑ§', spec: 'Í≥µÍ∞Ñ Î∂ÑÎ¶¨Î•º ÏúÑÌïú Ìà¨Î∞îÏù¥ Í∞ÄÎ≤Ω Ïã†ÏÑ§', unit: 'Ïãù', qty: '1', price: '350000' },
                { div: 'Î™∞Îî©', name: 'Ï≤úÏû• Î™∞Îî©', spec: 'Í≥ÑÎã® Î™∞Îî© (25*15)', unit: 'py', qty: '1', price: '22000' },
                { div: 'Î™∞Îî©', name: 'Í±∏Î†à Î∞õÏù¥', spec: 'ÏßÅÍ∞Å Ìèâ Î™∞Îî© (30mm or 40mm)', unit: 'py', qty: '1', price: '20000' },
                { div: 'Ï≤úÏû•', name: 'Í∞ÄÍµ¨ÏûêÎ¶¨ ÏàòÌèâ ÎßûÏ∂§', spec: 'Í∞ÄÍµ¨ÏûêÎ¶¨ ÏàòÌèâ ÎßûÏ∂§ (Î∂ÄÎ∂Ñ Ï≤†Í±∞ ÌõÑ ÎßûÏ∂§)', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• ÌèâÏãúÍ≥µ', spec: 'Ï†ÑÏã§/ÌòÑÍ¥Ä (Í∏∞Î≥∏), (ÎåÄÌòï Ï∂îÍ∞Ä 10ÎßåÏõê)', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• ÌèâÏãúÍ≥µ', spec: 'Ï£ºÎ∞© (Í∏∞Î≥∏), (ÎåÄÌòï Ï∂îÍ∞Ä 10ÎßåÏõê)', unit: 'Ïãù', qty: '1', price: '250000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• ÌèâÏãúÍ≥µ', spec: 'Í±∞Ïã§ (Í∏∞Î≥∏), (ÎåÄÌòï Ï∂îÍ∞Ä 10ÎßåÏõê)', unit: 'Ïãù', qty: '1', price: '350000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• Î™∞Îî©', spec: '9mm Î™∞Îî© ÏãúÍ≥µ', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• Ïã†ÏÑ§', spec: 'Ï†ïÏÇ¨Í∞Å, ÏßÅÏÇ¨Í∞Å ÌòïÌÉú (Í∏∞Î≥∏), (ÎåÄÌòï Ï∂îÍ∞Ä 10ÎßåÏõê)', unit: 'Ïãù', qty: '1', price: '700000' },
                { div: 'Ï≤úÏû•', name: 'Ïö∞Î¨º Ï≤úÏû• Ïã†ÏÑ§', spec: 'ÎùºÏö¥Îìú ÌòïÌÉú (Í∏∞Î≥∏), (ÎåÄÌòï Ï∂îÍ∞Ä 10ÎßåÏõê)', unit: 'Ïãù', qty: '1', price: '800000' },
                { div: 'Ï≤úÏû•', name: 'Îß§Î¶Ω Îì±Î∞ïÏä§ Ïã†ÏÑ§ (ÎùºÏù∏Ï°∞Î™Ö)', spec: 'Ï≤†Í±∞+Ïû¨ÏãúÍ≥µ (ÎùºÏù∏ ÏùºÏûê Ï°∞Î™Ö) - Ï°∞Î™ÖÎ≥ÑÎèÑ', unit: 'm', qty: '1', price: '70000' },
                { div: 'Ï≤úÏû•', name: 'Îß§Î¶Ω Îì±Î∞ïÏä§ Ïã†ÏÑ§ (ÎùºÏù∏Ï°∞Î™Ö)', spec: 'Ï≤†Í±∞+Ïû¨ÏãúÍ≥µ (ÎùºÏù∏ ÏÇ¨Í∞Å Ï°∞Î™Ö) - Ï°∞Î™ÖÎ≥ÑÎèÑ', unit: 'Ïãù', qty: '1', price: '500000' },
                { div: 'Ï≤úÏû•', name: 'Î≥µÎèÑ Ï∏°Î©¥ ÏÉÅÎ∂Ä Í∞ÑÏ†ëÎì± Î∞ïÏä§', spec: 'Ï≤†Í±∞+Í∞ÑÏ†ëÎì±Î∞ïÏä§ - Ï°∞Î™ÖÎ≥ÑÎèÑ', unit: 'm', qty: '1', price: '100000' },
                {
                    div: 'Î≤ΩÏ≤¥', name: 'Î≥µÎèÑ ÎÅùÎ≤Ω Î≤Ω Í∞ÑÏ†ëÎì±', spec: 'Ï≤†Í±∞+Í∞ÑÏ†ëÎì±Î∞ïÏä§ (w:1200,h:2400 Í∏∞Ï§Ä) - Ï°∞Î™ÖÎ≥ÑÎèÑ', unit: 'Ïãù', qty: '1', price: '200000'
                },
                { div: 'Î≤ΩÏ≤¥', name: 'ÏïåÌåê - ÌÖúÎ∞îÎ≥¥Îìú', spec: 'Ìè¨Ïù∏Ìä∏ Î≤ΩÎ©¥ ÌÖúÎ∞îÎ≥¥Îìú', unit: 'Ïãù', qty: '1', price: '450000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ÏΩîÎÑà ÎùºÏö¥Îìú Î≤ΩÏ≤¥', spec: 'ÎÇ†Í∞úÎ≤Ω ÎòêÎäî ÏΩîÎÑà Î≤ΩÎ©¥ ÎùºÏö¥Îìú ÏãúÍ≥µ', unit: 'Ïãù', qty: '1', price: '400000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Í±∞Ïã§ TV Îß§Î¶ΩÌòï Í∞ÄÎ≤Ω', spec: 'TV Í≥†Ï†ï Î≤ΩÎ©¥ Ìï©Ìåê Î≥¥Í∞ï', unit: 'Ïãù', qty: '1', price: '600000' },
                { div: 'Î≤ΩÏ≤¥', name: 'ÌûàÎì†ÎèÑÏñ¥ Î≤ΩÎ©¥ ÎßàÍ∞ê', spec: 'ÌûàÎì†ÎèÑÏñ¥ ÏñëÏ™Ω Î≤ΩÎ©¥ ÏïåÌåê (ÏÑùÍ≥†+MD)', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Î≤ΩÏ≤¥ ÎßâÏùå (Í∏∞Ï°¥ ÎèÑÏñ¥ÏûêÎ¶¨)', spec: 'Í∏∞Ï°¥ ÎèÑÏñ¥ ÏûêÎ¶¨ Î≤ΩÏ≤¥ ÎßàÍ∞ê (ÎÇ¥Î∂Ä Îã®Ïó¥Ïû¨-Î∞©Ïùå)', unit: 'Ïãù', qty: '1', price: '250000' },
                { div: 'Î≤ΩÏ≤¥', name: 'Ï£ºÎ∞© ÌÉÄÏùº Ï≤†Í±∞ÏûêÎ¶¨ ÎßàÍ∞ê', spec: 'Í∏∞Ï°¥ Ï£ºÎ∞©ÏûêÎ¶¨ ÌÉÄÏùº Ï≤†Í±∞ ÌõÑ ÏÑùÍ≥† ÎßàÍ∞ê', unit: 'Ïãù', qty: '1', price: '250000' },
                { div: 'ÏïåÌåê', name: 'ÏïåÌåê - Î≤ΩÎ©¥ MD', spec: 'Î≤ΩÎ©¥ ÏïåÌåê (ÏÑùÍ≥†+MD) (1000*2400)', unit: 'm', qty: '1', price: '90000' },
                { div: 'ÏïåÌåê', name: 'ÏïåÌåê - Î≤ΩÎ©¥ MD', spec: 'Ï≤úÏû• ÏïåÌåê (ÏÑùÍ≥†+MD) (1000*2400)', unit: 'm', qty: '1', price: '120000' },
                { div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ìèâ - ÌòÑÍ¥Ä', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) ÌèâÎßàÍ∞ê', unit: 'Ïãù', qty: '1', price: '600000' },
                {
                    div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ïö∞Î¨º - ÌòÑÍ¥Ä', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) Ïö∞Î¨º ÎßàÍ∞ê (Í∞ÑÏ†ëÏãú-Ï°∞Î™ÖÎ≥ÑÎèÑ)', unit: 'Ïãù', qty: '1',
                    price: '700000'
                },
                { div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ìèâ - Í±∞Ïã§', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) ÌèâÎßàÍ∞ê', unit: 'Ïãù', qty: '1', price: '800000' },
                {
                    div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ïö∞Î¨º - Í±∞Ïã§', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) Ïö∞Î¨º ÎßàÍ∞ê (Í∞ÑÏ†ëÏãú-Ï°∞Î™ÖÎ≥ÑÎèÑ)', unit: 'Ïãù', qty: '1',
                    price: '900000'
                },
                {
                    div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ìèâ - Î∞©orÏ£ºÎ∞©', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) ÌèâÎßàÍ∞ê', unit: 'Ïãù', qty: '1', price: '700000'
                },
                {
                    div: 'Ï≤úÏû•', name: 'Ï≤†Í±∞ ÌõÑ ÎåÑÏ°∞ ÎßàÍ∞ê Ïö∞Î¨º - Í±∞Ïã§orÏ£ºÎ∞©', spec: 'Ï†ÑÏ≤¥ Ï≤†Í±∞ ÌõÑ Ï≤úÏû• ÎßàÍ∞ê (Îã§Î£®ÎÅº+ÏÑùÍ≥†) Ïö∞Î¨º ÎßàÍ∞ê (Í∞ÑÏ†ëÏãú-Ï°∞Î™ÖÎ≥ÑÎèÑ)', unit: 'Ïãù', qty: '1',
                    price: '800000'
                },
                {
                    div: 'ÏóêÏñ¥Ïª®', name: 'ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® Ï≤úÏû• Îã®ÎÇ¥Î¶º', spec: 'ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® ÏÑ§ÎπÑÏ∏µ ÌôïÎ≥¥Î•º ÏúÑÌïú Ï≤úÏû• Îã®ÎÇ¥Î¶º (h:190)', unit: 'Ïãù', qty: '1', price:
                        '300000'
                },
                {
                    div: 'ÏóêÏñ¥Ïª®', name: 'ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® Ï≤úÏû• ÎßàÍ∞ê', spec: 'ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® ÏÑ†Î∞∞Í¥Ä ÌõÑ Í∏∞Í≥ÑÏûêÎ¶¨ Î≥¥Í∞ï Î∞è Î∞∞Í¥Ä ÏûêÎ¶¨ ÌÉÄÍ≥µÎ∂ÄÎ∂Ñ ÎßâÏùå', unit: 'Ïãù', qty: '1', price:
                        '400000'
                },
                { div: 'Î≥¥Í∞ï', name: 'Ìï©Ìåê Î≥¥Í∞ï Î≤ΩÎ©¥ - Í±∞Ïö∏', spec: 'Í±∞Ïö∏/Ïï°Ïûê Îì± Î≤ΩÎ©¥ Î≥¥Í∞ï (1000*600 Í∏∞Ï§Ä)', unit: 'm', qty: '1', price: '70000' },
                {
                    div: 'Î≥¥Í∞ï', name: 'Ìï©Ìåê Î≥¥Í∞ï Ï≤úÏ†ï - Í∞ÄÍµ¨', spec: 'Ïò∑Î¥â or ÏÉÅÎ∂ÄÏû• or ÎùÑÏõÄ Ïû• Ìï©Ìåê Î≥¥Í∞ï (1000*600 Í∏∞Ï§Ä)', unit: 'm', qty: '1', price:
                        '90000'
                },
                { div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ Ïû¨ÏÇ¨Ïö© - ÌïÑÎ¶Ñ', spec: 'ÎèÑÏñ¥ Ïû¨ÏÇ¨Ïö©+ÌïÑÎ¶Ñ ÏãúÍ≥µÏùÑ ÏúÑÌïú ÎèÑÏñ¥ ÎåÄÌå® ÏûëÏóÖ.', unit: 'set', qty: '1', price: '20000' },
                {
                    div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ ÌïòÎìúÏõ®Ïñ¥Îßå ÍµêÏ≤¥Ïãú (Î¨∏Ïû¨ÏÇ¨Ïö©)', spec: 'Ï≤†Í±∞+Í≤ΩÏ≤©/ÎåêÌçºÌòï ÎèÑÏñ¥Ïä§ÌÜ†Ìçº/ÏÜêÏû°Ïù¥(30,000)', unit: 'set', qty: '1', price: '70000'
                },
                {
                    div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ ÌïòÎìúÏõ®Ïñ¥Îßå ÍµêÏ≤¥Ïãú (Î¨∏Ïû¨ÏÇ¨Ïö©)', spec: 'Ï≤†Í±∞+Í≤ΩÏ≤©/ÏûêÏÑùÌòï ÎèÑÏñ¥Ïä§ÌÜ†Ìçº/ÏÜêÏû°Ïù¥(30,000)', unit: 'set', qty: '1', price: '80000'
                },
                { div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ ÌïòÎìúÏõ®Ïñ¥ (Ïã†ÏÑ§)', spec: 'Í≤ΩÏ≤©/ÎåêÌçºÌòï ÎèÑÏñ¥Ïä§ÌÜ†Ìçº/ÏÜêÏû°Ïù¥(30,000)', unit: 'set', qty: '1', price: '60000' },
                { div: 'ÎèÑÏñ¥', name: 'ÎèÑÏñ¥ ÌïòÎìúÏõ®Ïñ¥ (Ïã†ÏÑ§)', spec: 'Í≤ΩÏ≤©/ÏûêÏÑùÌòï ÎèÑÏñ¥Ïä§ÌÜ†Ìçº/ÏÜêÏû°Ïù¥(30,000)', unit: 'set', qty: '1', price: '70000' },
                { div: 'ÎèÑÏñ¥', name: 'Ïó¨Îã´Ïù¥ ÎèÑÏñ¥', spec: 'ÏòÅÎ¶º ABS Ïó¨Îã´Ïù¥ ÎèÑÏñ¥ (Î¨∏ÏßùÎßå) - ÏÜêÏû°Ïù¥Î≥ÑÎèÑ', unit: 'ea', qty: '1', price: '220000' },
                { div: 'ÎèÑÏñ¥', name: 'Ïó¨Îã´Ïù¥ ÎèÑÏñ¥', spec: 'ÏòÅÎ¶º ABS Ïó¨Îã´Ïù¥ ÎèÑÏñ¥ (ÌãÄ/Î¨∏Ïßù/Í∞ÄÏä§Ïºì) - ÏÜêÏû°Ïù¥Î≥ÑÎèÑ', unit: 'set', qty: '1', price: '400000' },
                { div: 'ÎèÑÏñ¥', name: 'Ìè¨Ïºì ÎèÑÏñ¥', spec: 'Î™©Í≥µ+Ïä¨ÎùºÏù¥ÎìúÌòï ÎèÑÏñ¥ (ÏñëÎéÄÌçº) - ÏÜêÏû°Ïù¥Î≥ÑÎèÑ', unit: 'set', qty: '1', price: '500000' },
                { div: 'ÎèÑÏñ¥', name: 'Ïä§ÌÖù ÎèÑÏñ¥', spec: 'Î™©Í≥µ+ABS Ïó¨Îã´Ïù¥ ÎèÑÏñ¥(Ïñ¥Íπ®Í∞ÄÍ≥µ) - Ïù∏Î∞©Ï≤†Í±∞/ÏÜêÏû°Ïù¥Î≥ÑÎèÑ', unit: 'set', qty: '1', price: '500000' },
                {
                    div: 'ÎèÑÏñ¥', name: 'Ïä¨Î¶º ÏôÄÏù¥Îìú Ïó¨Îã´Ïù¥ ÎèÑÏñ¥', spec: '12mm Î¨∏ÏÑ† Ïä¨Î¶ºÌòï Ïó¨Îã´Ïù¥ ÎèÑÏñ¥ (Î≤ΩÎ©¥ ÏÑùÍ≥†/ÎèÑÏñ¥Îã§Î¶¨ ÌïÑÎ¶Ñ Î≥ÑÎèÑ)', unit: 'ea', qty: '1', price:
                        '420000'
                },
                { div: 'ÎèÑÏñ¥', name: 'ÌûàÎì†ÎèÑÏñ¥', spec: 'ÏïåÎ£®ÎØ∏ÎäÑÎ¨∏ÌãÄ/ABSÌûàÎì†ÎèÑÏñ¥/ÏÜêÏû°Ïù¥ (Î≤ΩÎ©¥ ÎßàÍ∞ê ÏÑùÍ≥†+MD Î≥ÑÎèÑ)', unit: 'ea', qty: '1', price: '950000' },
                { div: 'ÎèÑÏñ¥', name: 'ÌîºÎ¥áÎèÑÏñ¥ 45T', spec: '180ÎèÑ Ïó¨Îã´Ïù¥ (Î∂ÄÏÜçÌè¨Ìï®)', unit: 'ea', qty: '1', price: '1200000' },
                { div: 'ÌÑ∞ÎãùÎèÑÏñ¥', name: 'ÌÑ∞ÎãùÎèÑÏñ¥', spec: 'LX ÌÑ∞ÎãùÎèÑÏñ¥ (ÏÑ∏ÌÉÅÏã§orÍ±∞Ïã§Î∞úÏΩîÎãà)', unit: 'ea', qty: '1', price: '800000' },
                { div: 'Ïπ®ÎåÄÌó§Îìú', name: 'Ïπ®ÎåÄÌó§Îìú(ÏïåÌåê)', spec: 'Ïπ®ÎåÄ Ìó§Îìú ÏïåÌåê (ÏÑùÍ≥†+MD)', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'Ïπ®ÎåÄÌó§Îìú', name: 'Ïπ®ÎåÄÌó§Îìú(ÏïåÌåê)+Ï††Îã§Ïù¥(ÏïåÌåê)', spec: 'Ïπ®ÎåÄÌó§Îìú ÏÉÅÎ∂Ä ÏïåÌåê(Ìè¨Ïù∏Ìä∏)+ÌïòÎ∂ÄÏ††Îã§Ïù¥ ÏïåÌåê', unit: 'Ïãù', qty: '1', price: '500000' },
                {
                    div: 'Ïπ®ÎåÄÌó§Îìú', name: 'Ïπ®ÎåÄÌó§Îìú(ÏïåÌåê)+Ï††Îã§Ïù¥(ÏïåÌåê)+Ï°∞Î™Ö', spec: 'Ïπ®ÎåÄÌó§Îìú ÏÉÅÎ∂Ä ÏïåÌåê(Ìè¨Ïù∏Ìä∏)+ÌïòÎ∂ÄÏ††Îã§Ïù¥ ÏïåÌåê -Ï°∞Î™Ö Î≥ÑÎèÑ', unit: 'Ïãù', qty: '1', price:
                        '700000'
                },
                {
                    div: 'Ïπ®ÎåÄÌó§Îìú', name: 'Ïπ®ÎåÄÌó§Îìú(Î£®Î≤Ñ)+Ï††Îã§Ïù¥(ÏïåÌåê)+Ï°∞Î™Ö', spec: 'Ïπ®ÎåÄÌó§Îìú ÏÉÅÎ∂Ä Î£®Î≤Ñ(Ìè¨Ïù∏Ìä∏)+ÌïòÎ∂ÄÏ††Îã§Ïù¥ ÏïåÌåê -Ï°∞Î™Ö Î≥ÑÎèÑ', unit: 'Ïãù', qty: '1', price:
                        '900000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïó¨Îã´Ïù¥ Î™®ÎçòÏ†ÑÏ∞Ω', spec: 'Ïó¨ÎîõÏù¥ 180ÎèÑ Ìé∏Í∞ú ÎèÑÏñ¥ (Î™®Îçò) - Î¨∏ÌãÄ ÏóÜÏùå. (1000*2400)', unit: 'Ïãù', qty: '1', price:
                        '1500000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïó¨Îã´Ïù¥ Í∞ÑÏÇ¥ - ÎπÑÎåÄÏπ≠', spec: 'Ïó¨ÎîõÏù¥ 180ÎèÑ Ìé∏Í∞ú ÎèÑÏñ¥ (Ï†ÑÏ≤¥Í∞ÑÏÇ¥) - Î¨∏ÌãÄ ÏóÜÏùå. (1100*2400)', unit: 'Ïãù', qty: '1',
                    price: '1900000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïó¨Îã´Ïù¥ ÏñëÍ∞ú ÎπÑÎåÄÏπ≠-Î™®Îçò', spec: 'Ïó¨Îã´Ïù¥ ÎπÑÎåÄÏπ≠ ÏñëÍ∞ú 180ÎèÑ (Î™®Îçò) - Î¨∏ÌãÄ ÏóÜÏùå. (1200*2400)', unit: 'Ïãù', qty: '1',
                    price: '1400000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïó¨Îã´Ïù¥ ÏñëÍ∞ú ÎπÑÎåÄÏπ≠-Î∞±Ïú†Î¶¨', spec: 'Ïó¨Îã´Ïù¥ ÎπÑÎåÄÏπ≠ ÏñëÍ∞ú 180ÎèÑ(Ï†ÑÏ∞ΩÎ∞±Ïú†Î¶¨)-Î¨∏ÌãÄ ÏóÜÏùå.(1300*2400)', unit: 'Ïãù', qty: '1',
                    price: '1500000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïä¨ÎùºÏù¥Îìú(1ÎèÑÏñ¥)-Î∏åÎ°†Ï¶àÏÉ§Ìã¥', spec: 'Ïä¨ÎùºÏù¥ÎèÑ 1ÎèÑÏñ¥ (Î™®Îçò) - ÏÉÅÎ∂Ä/ÌïòÎ∂Ä Îß§Î¶ΩÌòï Î†àÏùº (900*2400)', unit: 'Ïãù', qty: '1',
                    price: '800000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïä¨ÎùºÏù¥Îìú (1ÎèÑÏñ¥)', spec: 'Ïä¨ÎùºÏù¥ÎèÑ 1ÎèÑÏñ¥ (Í∞ÑÏÇ¥6Í∞ú) - ÏÉÅÎ∂Ä/ÌïòÎ∂Ä Îß§Î¶ΩÌòï Î†àÏùº (1200*2400)', unit: 'Ïãù', qty: '1',
                    price: '1600000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïä¨ÎùºÏù¥Îî© (2ÎèÑÏñ¥)', spec: 'Ïä¨ÎùºÏù¥ÎèÑ 2ÎèÑÏñ¥ (Î™®Îçò) - ÏÉÅÎ∂Ä/ÌïòÎ∂Ä Îß§Î¶ΩÌòï Î†àÏùº (1800*2400)', unit: 'Ïãù', qty: '1', price:
                        '1400000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïä¨ÎùºÏù¥Îìú (Í∞úÎ≥Ñ 4ÎèÑÏñ¥)', spec: 'Ïä¨ÎùºÏù¥Îìú 4ÎèÑÏñ¥ (Í∞ÑÏÇ¥) - ÏÉÅÎ∂Ä/ÌïòÎ∂Ä Îß§Î¶ΩÌòï Î†àÏùº (3000*2200)', unit: 'Ïãù', qty: '1',
                    price: '5500000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ 3Ïó∞Îèô Ïä¨Î¶ºÌòï (4ÎèÑÏñ¥)', spec: 'ÏïåÎ£®ÎØ∏ÎäÑ 3Ïó∞Îèô 4ÎèÑÏñ¥ Ïä¨ÎùºÏù¥Îìú ÎèÑÏñ¥ (Î™®Îçò) (2000*2300)', unit: 'Ïãù', qty: '1', price:
                        '1600000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ 3Ïó∞Îèô Ïä¨Î¶ºÌòï (3ÎèÑÏñ¥)', spec: 'ÏïåÎ£®ÎØ∏ÎäÑ 3Ïó∞Îèô 4ÎèÑÏñ¥ Ïä¨ÎùºÏù¥Îìú ÎèÑÏñ¥ (Î™®Îçò) (2000*2300)', unit: 'Ïãù', qty: '1', price:
                        '1100000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïã†ÏÑ§ (Î∞©ÌôîÎèÑÏñ¥) ÏñëÍ∞úÎèÑÏñ¥', spec: 'ÌòÑÍ¥ÄÎ¨∏ Î∞©ÌôîÎ¨∏ Ïã†ÏÑ§ ÏñëÍ∞ú ÎèÑÏñ¥ (Ï≤†Í±∞ Î∞è ÎèÑÏñ¥ÎùΩ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '1500000'
                },
                {
                    div: 'ÌòÑÍ¥ÄÎ¨∏', name: 'ÌòÑÍ¥ÄÎ¨∏ Ïã†ÏÑ§ (Î∞©ÌôîÎèÑÏñ¥) Ìé∏Í∞úÎèÑÏñ¥', spec: 'ÌòÑÍ¥ÄÎ¨∏ Î∞©ÌôîÎ¨∏ Ïã†ÏÑ§ ÏñëÍ∞ú ÎèÑÏñ¥ (Ï≤†Í±∞ Î∞è ÎèÑÏñ¥ÎùΩ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '1200000'
                },
                { div: 'ÏÑ†Î∞ò', name: 'Î¨¥ÏßÄÏ£º ÏÑ†Î∞ò ÏãúÍ≥µ', spec: 'D:200 Ïù¥ÎÇ¥ ÏÑ†Î∞ò ÏãúÍ≥µ', unit: 'Ïãù', qty: '1', price: '150000' },
                { div: 'ÌôîÏû•Ïã§', name: 'ÌôîÏû•Ïã§ Ï∏°Î©¥ Í∞ÑÏ†ë', spec: 'ÏÑ∏Î©¥ÎåÄ ÏûêÎ¶¨ Ï∏°Î©¥ Í∞ÑÏ†ëÏùÑ ÏúÑÌïú Î™©Í≥µ (ÌïòÎ∂Ä Ï°∞Ï†Å)', unit: 'Ïãù', qty: '1', price: '300000' },
                { div: 'ÌôîÏû•Ïã§', name: 'ÌôîÏû•Ïã§ Î≤ΩÎ©¥ Í≥µÍ∞ÑÎ∞ïÏä§', spec: 'Ï∏°Î©¥ Í≥µÍ∞Ñ Î∞ïÏä§ Î∞è Í∞ÑÏ†ë', unit: 'Ïãù', qty: '1', price: '350000' },
                { div: 'Ïï°ÏûêÎ†àÏùº', name: 'Ïï°ÏûêÎ†àÏùº - Îß§Î¶Ω', spec: 'Ï≤†Í±∞ ÌõÑ Ïï°ÏûêÎ†àÏùº Îß§Î¶Ω ÌïúÎ©¥', unit: 'Ïãù', qty: '1', price: '200000' }
            ],
            '09': [
                { div: 'Í∏∞Î≥∏ (Îã®Ìíà)', name: 'Í∏∞Î≥∏ ÏãúÍ≥µÎπÑ (ÌòÑÍ¥ÄÎ¨∏/Í≥µÌãÄ)', spec: 'ÌòÑÍ¥ÄÎ¨∏ ÌãÄ/Î¨∏Ïßù(ÎÇ¥Î∂ÄÎßå), Í≥µÌãÄ1', unit: 'Ïãù', qty: '1', price: '500000' },
                {
                    div: 'Í∏∞Î≥∏ (Îã®Ìíà)', name: 'Í∏∞Î≥∏ ÏãúÍ≥µÎπÑ (Î∂ÄÎ∂ÑÏãúÍ≥µ)', spec: 'Î∂ÄÎ∂Ñ ÏãúÍ≥µÏùº Îïå 1Ìíà(35) - ÏûêÏû¨ 1m(Ï∂îÍ∞Ä:2ÎßåÏõê)', unit: 'Ïãù', qty: '1', price:
                        '350000'
                },
                { div: 'Ï∞ΩÌò∏ Îã®Ìíà', name: 'Ï∞ΩÌò∏ (Í±∞Ïã§) - Îã®Ìíà', spec: '30ÌèâÎåÄ Í∏∞Ï§Ä Í±∞Ïã§ Ï∞ΩÌò∏', unit: 'Ïãù', qty: '1', price: '1200000' },
                { div: 'Ï∞ΩÌò∏ Îã®Ìíà', name: 'Ï∞ΩÌò∏ (Í±∞Ïã§) - Îã®Ìíà', spec: '40ÌèâÎåÄ Í∏∞Ï§Ä Í±∞Ïã§ Ï∞ΩÌò∏', unit: 'Ïãù', qty: '1', price: '1500000' },
                { div: 'Ï∞ΩÌò∏ Îã®Ìíà', name: 'Ï∞ΩÌò∏ (ÎåÄ) - Îã®Ìíà', spec: 'Ïù¥Ï§ëÏ∞Ω Í∏∞Ï§Ä. Îã®Ï∞ΩÏùò Í≤ΩÏö∞ (90)', unit: 'ea', qty: '1', price: '1000000' },
                { div: 'Ï∞ΩÌò∏ Îã®Ìíà', name: 'Ï∞ΩÌò∏ (Ï§ë) - Îã®Ìíà', spec: 'Ïù¥Ï§ëÏ∞Ω Í∏∞Ï§Ä. Îã®Ï∞ΩÏùò Í≤ΩÏö∞ (80)', unit: 'ea', qty: '1', price: '800000' },
                { div: 'Ï∞ΩÌò∏ Îã®Ìíà', name: 'Ï∞ΩÌò∏ (ÏÜå) - Îã®Ìíà', spec: 'Ïù¥Ï§ëÏ∞Ω Í∏∞Ï§Ä. Îã®Ï∞ΩÏùò Í≤ΩÏö∞ (50)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'Í∞ÄÍµ¨/ÏàòÎÇ©Ïû•', name: 'Î∂ôÎ∞ïÏù¥Ïû•/Ïã†Î∞úÏû•', spec: 'Ïô∏Ï∏°(ÎààÏù¥ Î≥¥Ïù¥Îäî Í≥≥) ÌãÄ/Î¨∏Ïßù', unit: 'Ïûê', qty: '1', price: '100000' },
                { div: 'Í∞ÄÍµ¨/ÏàòÎÇ©Ïû•', name: 'ÌïòÌîÑÏû•', spec: 'h: 1200 Ïù¥ÎÇ¥', unit: 'Ïûê', qty: '1', price: '70000' },
                { div: 'Ï∞ΩÍ≥†Ïû•', name: 'Ï∞ΩÍ≥†Ïû•', spec: 'w: 1200 Ïù¥ÎÇ¥', unit: 'Ïãù', qty: '1', price: '200000' },
                { div: 'ÎèÑÏñ¥', name: 'ÌòÑÍ¥ÄÎ¨∏ or Î∞©ÌôîÎ¨∏ or ÌÑ∞ÎãùÎèÑÏñ¥', spec: 'ÎÇ¥Ï∏° Í∏∞Ï§Ä', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ÎèÑÏñ¥', name: 'Î∞©ÌôîÎ¨∏ or ÌÑ∞ÎãùÎèÑÏñ¥ ÏïûÎí§ Ï†ÑÏ≤¥', spec: 'ÏïûÎí§ Ï†ÑÏ≤¥ ÌïÑÎ¶Ñ.', unit: 'ea', qty: '1', price: '250000' },
                { div: 'ÎèÑÏñ¥(set)', name: 'Î¨∏ÌãÄ/Î¨∏Ïßù (Í∏∞Î≥∏)', spec: 'ÎØºÏûê ÎèÑÏñ¥/ÌãÄÏùò Í≤ΩÏö∞', unit: 'set', qty: '1', price: '280000' },
                {
                    div: 'ÎèÑÏñ¥(set)', name: 'Î¨∏ÌãÄ/Î¨∏Ïßù (Í≥®/ÌéòÏù∏Ìä∏/Î¨¥Îä¨Î™©)', spec: 'Î¨∏ÏßùÏóê Î¨¥Îä¨ ÎòêÎäî Í≥®, ÏÉåÎî© Î∞è Ìï∏Îîî(ÌéòÏù∏Ìä∏/Î¨¥Îä¨Î™©) ÌïÑÏöîÌïú Í≤ΩÏö∞', unit: 'set', qty: '1',
                    price: '310000'
                },
                { div: 'ÎèÑÏñ¥(Îã®Ìíà)', name: 'Î¨∏ÌãÄ/ÎèÑÏñ¥Îã§Î¶¨/Î¨∏ÏÑ†', spec: 'Î¨∏ÌãÄ Ï†ÑÏ≤¥ Ìï¥ÎãπÎ∂ÄÎ∂Ñ', unit: 'ea', qty: '1', price: '120000' },
                { div: 'ÎèÑÏñ¥(Îã®Ìíà)', name: 'Î¨∏Ïßù (ÎØºÏûêÎèÑÏñ¥)', spec: 'Î¨∏Ïßù Í∏∞Î≥∏ (ÎØºÏûêÎèÑÏñ¥)', unit: 'ea', qty: '1', price: '170000' },
                { div: 'ÎèÑÏñ¥(Îã®Ìíà)', name: 'Î¨∏Ïßù (Î¨∏ÏñëÎèÑÏñ¥)', spec: 'Î¨∏Ïßù Ìï∏ÎîîÏûëÏóÖ 2Ìöå', unit: 'ea', qty: '1', price: '200000' },
                { div: 'Í≥µÌãÄ', name: 'Í≥µÌãÄ ÏÇ¨Í∞Å Í≤åÏù¥Ìä∏', spec: '9mm or 12mm Í≥µÌãÄ MD', unit: 'ea', qty: '1', price: '120000' },
                { div: 'Í≥µÌãÄ', name: 'Í≥µÌãÄ ÏïÑÏπò Í≤åÏù¥Ìä∏', spec: 'Í≥µÌãÄ ÏïÑÏπò Í≤åÏù¥Ìä∏ (Ìï∏Îîî ÏûëÏóÖ 2Ìöå)', unit: 'ea', qty: '1', price: '150000' },
                {
                    div: 'Îì±Î∞ïÏä§ Î™∞Îî©', name: 'Îì±Î∞ïÏä§ Î™∞Îî©', spec: 'ÏÇ¨Í∞ÅÌòï Íµ¨Ï°∞ ÎùºÏö¥Îìú ÌòïÌÉú (ÎÅäÍπÄÏóÜÏù¥ 1ÌöåÏãú ÏãúÍ≥µÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä 1m 2ÎßåÏõê)', unit: 'ea', qty: '1', price:
                        '200000'
                },
                { div: 'ÏïåÌåê', name: 'ÌòÑÍ¥Ä or Ï†ÑÏã§ ÏïåÌåê', spec: '34Ìèâ Í∏∞Ï§Ä ÌòÑÍ¥ÄÎ¨∏ Ìè¨Ìï®, Ïã†Î∞úÏû• Î∞è Ï§ëÎ¨∏ Î≥Ñ', unit: 'ea', qty: '1', price: '500000' },
                { div: 'ÏïåÌåê', name: 'Ïπ®ÎåÄ Ìó§Îìú (ÎîîÏûêÏù∏)', spec: 'Ïπ®ÎåÄ Ìó§Îìú Î™©Í≥µ ÏûëÏóÖ Ïù¥ÌõÑ ÌïÑÎ¶ÑÏãúÍ≥µ', unit: 'Ïãù', qty: '1', price: '400000' },
                { div: 'ÏïåÌåê', name: 'Í±∞Ïã§/Ï£ºÎ∞© ÏïåÌåê', spec: 'ÎØºÏûê ÌòïÌÉú ÏïåÌåê MD', unit: 'm', qty: '1', price: '80000' },
                { div: 'Ï†ÑÏ≤¥ÌïÑÎ¶Ñ(Ï∞ΩÌò∏/ÎèÑÏñ¥)', name: 'Ï†ÑÏ≤¥ ÌïÑÎ¶Ñ', spec: 'Î∞©ÌôîÎ¨∏/Î¨∏ÌãÄÏßù/Ï§ëÎ¨∏/Í≥µÌãÄ/Ï∞ΩÌò∏', unit: 'py', qty: '1', price: '120000' },
                { div: 'Ï†ÑÏ≤¥ Ï∞ΩÌò∏ ÌïÑÎ¶Ñ', name: 'Ï†ÑÏ≤¥ Ï∞ΩÌò∏ ÌïÑÎ¶Ñ', spec: 'Ï†ÑÏ≤¥ Ï∞ΩÌò∏Îßå ÏãúÍ≥µ', unit: 'py', qty: '1', price: '80000' },
                { div: 'Ï†ÑÏ≤¥ Î¨∏ÌãÄÏßù ÌïÑÎ¶Ñ', name: 'Ï†ÑÏ≤¥ Î¨∏ÌãÄÏßù ÌïÑÎ¶Ñ', spec: 'Ï†ÑÏ≤¥ Î¨∏ÌãÄÏßù ÏãúÍ≥µ (30ÌèâÍ∏∞Ï§Ä)', unit: 'py', qty: '1', price: '40000' }
            ],
            '10': [
                { div: 'ÌòÑÍ¥Ä', name: 'ÌòÑÍ¥Ä Î∞îÎã• (ÎçßÎ∞©)', spec: 'ÌÉÄÏùº 600*600 ÎçßÎ∞© Í∏∞Ï§Ä : 34Ìèâ Ïù¥ÎÇ¥', unit: 'Ïãù', qty: '1', price: '350000' },
                {
                    div: 'ÌòÑÍ¥Ä', name: 'ÌòÑÍ¥Ä Î∞îÎã• Ï≤†Í±∞ ÌõÑ ÌÉÄÏùº', spec: 'ÌÉÄÏùº 600*600 (Ï≠àÍæ∏ÎØ∏+ÌÉÄÏùº) : 34Ìèâ Ïù¥ÎÇ¥ (Ï≤†Í±∞ Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '400000'
                },
                { div: 'ÌòÑÍ¥Ä/Ï†ÑÏã§', name: 'ÌòÑÍ¥Ä/Ï†ÑÏã§ Î∞îÎã• (ÎçßÎ∞©)', spec: 'ÌÉÄÏùº 600*600 ÎçßÎ∞© Í∏∞Ï§Ä : 34Ìèâ Í∏∞Ï§Ä', unit: 'Ïãù', qty: '1', price: '550000' },
                {
                    div: 'ÌòÑÍ¥Ä/Ï†ÑÏã§', name: 'ÌòÑÍ¥Ä/Ï†ÑÏã§ Ï≤†Í±∞ ÌõÑ ÌÉÄÏùº', spec: 'ÌÉÄÏùº 600*600 (Ï≠àÍæ∏ÎØ∏+ÌÉÄÏùº) : 34Ìèâ Í∏∞Ï§Ä (Ï≤†Í±∞/Î∞©Ïàò Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '650000'
                },
                { div: 'ÏÑ∏ÌÉÅÏã§', name: 'ÏÑ∏ÌÉÅÏã§ Î∞îÎã• (ÎçßÎ∞©)', spec: 'ÌÉÄÏùº 600*600 ÎçßÎ∞© Í∏∞Ï§Ä : 34Ìèâ Í∏∞Ï§Ä', unit: 'Ïãù', qty: '1', price: '300000' },
                {
                    div: 'ÏÑ∏ÌÉÅÏã§', name: 'ÏÑ∏ÌÉÅÏã§ Î∞îÎã• Ï≤†Í±∞ ÌõÑ ÏãúÍ≥µ', spec: 'ÌÉÄÏùº 600*600 (Ï≠àÍæ∏ÎØ∏+ÌÉÄÏùº) : 34Ìèâ Í∏∞Ï§Ä (Ï≤†Í±∞/Î∞©Ïàò Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '400000'
                },
                { div: 'Î∞úÏΩîÎãà', name: 'Î∞úÏΩîÎãà Î∞îÎã• (ÎçßÎ∞©)', spec: 'ÌÉÄÏùº 600*600 ÎçßÎ∞© Í∏∞Ï§Ä : 34Ìèâ Í∏∞Ï§Ä', unit: 'Ïãù', qty: '1', price: '700000' },
                {
                    div: 'Î∞úÏΩîÎãà', name: 'Î∞úÏΩîÎãà Î∞îÎã• Ï≤†Í±∞ ÌõÑ ÏãúÍ≥µ', spec: 'ÌÉÄÏùº 600*600 (Ï≠àÍæ∏ÎØ∏+ÌÉÄÏùº) : 34Ìèâ Í∏∞Ï§Ä (Ï≤†Í±∞/Î∞©Ïàò Î≥ÑÎèÑ)', unit: 'Ïãù', qty: '1', price:
                        '850000'
                },
                {
                    div: 'Í±∞Ïã§/Ï£ºÎ∞©/Î∞©', name: 'Ìè¨ÏÑ∏Î¶∞ ÌÉÄÏùº 600*600', spec: 'Í∏∞Î≥∏ Î∞îÎã• ÏàòÌèâ+ÏûêÏû¨ÎπÑ+ÏãúÍ≥µÎπÑ - 600*600 (Ï§ÑÎàà Î≥ÑÎèÑ)', unit: 'py', qty: '1', price:
                        '270000'
                },
                {
                    div: 'Í±∞Ïã§/Ï£ºÎ∞©/Î∞©', name: 'Ìè¨ÏÑ∏Î¶∞ ÌÉÄÏùº 800*800', spec: 'Í∏∞Î≥∏ Î∞îÎã• ÏàòÌèâ+ÏûêÏû¨ÎπÑ+ÏãúÍ≥µÎπÑ - 800*800 (Ï§ÑÎàà Î≥ÑÎèÑ)', unit: 'py', qty: '1', price:
                        '310000'
                },
                {
                    div: 'Í±∞Ïã§/Ï£ºÎ∞©/Î∞©', name: 'Ìè¥Î¶¨Ïã± ÌÉÄÏùº 600*600', spec: 'Í∏∞Î≥∏ Î∞îÎã• ÏàòÌèâ+ÏûêÏû¨ÎπÑ+ÏãúÍ≥µÎπÑ - 600*600 (Ï§ÑÎàà Î≥ÑÎèÑ)', unit: 'py', qty: '1', price:
                        '265000'
                },
                {
                    div: 'Í±∞Ïã§/Ï£ºÎ∞©/Î∞©', name: 'Ìè¥Î¶¨Ïã± ÌÉÄÏùº 800*800', spec: 'Í∏∞Î≥∏ Î∞îÎã• ÏàòÌèâ+ÏûêÏû¨ÎπÑ+ÏãúÍ≥µÎπÑ - 800*800 (Ï§ÑÎàà Î≥ÑÎèÑ)', unit: 'py', qty: '1', price:
                        '300000'
                }
            ],
            '11': [],
            '12': [
                {
                    div: 'ÎèÑÏû•', name: 'ÎøúÏπ† ÎèÑÏû• ÎßàÍ∞ê (Î≤Ω/Ï≤úÏ†ï)', spec: 'Ï§ÑÌçºÌã∞+Ïò¨ÌçºÌã∞+2ÌöåÏπ† (ÏÇºÌôî - ÏïÑÏù¥ÏÉùÍ∞Å 4L Îãπ 30Ìó§Î≤† 2.9) - Íµ≠ÏÇ∞', unit: 'm2', qty: '1',
                    price: '50000'
                },
                {
                    div: 'ÎèÑÏû•', name: 'ÎøúÏπ† ÎèÑÏû• ÎßàÍ∞ê (Î≤Ω/Ï≤úÏ†ï)', spec: 'Ï§ÑÌçºÌã∞+Ïò¨ÌçºÌã∞+2ÌöåÏπ† (KCC - Ïà≤ÏúºÎ°ú 4L Îãπ 30Ìó§Î≤† 4.9) - Íµ≠ÏÇ∞', unit: 'm2', qty: '1',
                    price: '55000'
                },
                {
                    div: 'ÎèÑÏû•', name: 'ÎøúÏπ† ÎèÑÏû• ÎßàÍ∞ê (Î≤Ω/Ï≤úÏ†ï)', spec: 'Ï§ÑÌçºÌã∞+Ïò¨ÌçºÌã∞+2ÌöåÏπ† (ÎÖ∏Î£® - ÏπúÌôòÍ≤Ω ÌîÑÎ¶¨ÎØ∏ÏóÑ Ìå¨ÌÜ§ 5.1) - Íµ≠ÏÇ∞', unit: 'm2', qty: '1', price:
                        '55000'
                },
                {
                    div: 'ÎèÑÏû•', name: 'ÎøúÏπ† ÎèÑÏû• ÎßàÍ∞ê (Î≤Ω/Ï≤úÏ†ï)', spec: 'Ï§ÑÌçºÌã∞+Ïò¨ÌçºÌã∞+2ÌöåÏπ† (Î≤§ÏûêÎØºÎ¨¥Ïñ¥ 4L Îãπ 30Ìó§Î≤† 12) - ÏàòÏûÖ', unit: 'm2', qty: '1', price:
                        '80000'
                },
                {
                    div: 'ÎèÑÏû•', name: 'ÎøúÏπ† ÎèÑÏû• ÎßàÍ∞ê (Î≤Ω/Ï≤úÏ†ï)', spec: 'Ï§ÑÌçºÌã∞+Ïò¨ÌçºÌã∞+2ÌöåÏπ† (ÎçòÏóêÎìúÏõåÎìú 4L Îãπ 30Ìó§Î≤† 12) - ÏàòÏûÖ', unit: 'm2', qty: '1', price:
                        '80000'
                },
                { div: 'ÌÉÑÏÑ±', name: 'ÏÑ∏ÎùºÎØπÏΩîÌä∏', spec: 'Í∏∞Îä•ÏÑ± ÎßàÍ∞ê ÎèÑÏû• (Ï†ÑÏã§ ÎòêÎäî ÌòÑÍ¥Ä Ï†ÅÌï©) Ïπ∏ Ï∂îÍ∞Ä 12ÎßåÏõê', unit: 'Ïπ∏', qty: '1', price: '300000' },
                { div: 'ÌÉÑÏÑ±', name: 'ÏõîÎìúÌÅ¥ÎûòÏä§', spec: 'Í≤∞Î°úÏóê Ï∑®ÏïΩÌïú Î∂ÄÎ∂Ñ (Î∞úÏΩîÎãàÏóê Ï†ÅÌï©) Ïπ∏ Ï∂îÍ∞Ä 17ÎßåÏõê', unit: 'Ïπ∏', qty: '1', price: '350000' },
                {
                    div: 'ÌÉÑÏÑ±', name: 'Ï†úÎ°úÏä§ÌÉë', spec: 'ÏäµÎèÑ Ï°∞Ï†à Î∞è Ïú†ÏßÄ ÎÉÑÏÉà Í≥µÍ∏∞Ï†ïÌôî Í∏∞Îä• (ÏÑ∏ÌÉÅÏÉêÏóê Ï†ÅÌï©) Ïπ∏ Ï∂îÍ∞Ä 22ÎßåÏõê', unit: 'Ïπ∏', qty: '1', price: '470000'
                },
                { div: 'Ï∞∏Í≥†', name: 'ÎèÑÏû• Ï∞∏Í≥†ÏÇ¨Ìï≠', spec: 'ÎèÑÏû• Í∏∞Î≥∏ ÌèâÎãπ 15ÎßåÏõê(ÏàòÏûÖÏÇ∞ÌéòÏù∏Ìä∏ Î≥ÑÎèÑ)', unit: 'py', qty: '1', price: '150000' }
            ],
            '13': [
                {
                    div: 'Ìï©ÏßÄÎèÑÎ∞∞', name: 'Ìï©ÏßÄÎèÑÎ∞∞', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1', price:
                        '100000'
                },
                {
                    div: 'Ïã§ÌÅ¨ÎèÑÎ∞∞ (Í∏∞Î≥∏)', name: 'Ïã§ÌÅ¨ÎèÑÎ∞∞', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1', price:
                        '120000'
                },
                {
                    div: 'Ïã§ÌÅ¨ÌîÑÎ¶¨ÎØ∏ÏóÑ (Í≥†Í∏â)', name: 'Ïã§ÌÅ¨ÌîÑÎ¶¨ÎØ∏ÏóÑ', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1',
                    price: '140000'
                },
                { div: 'Î¨¥Î™∞Îî©', name: 'Î¨¥Î™∞Îî© Î∞ëÏûëÏóÖ', spec: 'Î¨¥Î™∞Îî© Î∞ëÏûëÏóÖ', unit: 'Ïãù', qty: '1', price: '400000' },
                { div: 'Î¨¥Í±∏Î†àÎ∞õÏù¥', name: 'Î¨¥Í±∏Î†àÎ∞õÏù¥ Î∞ëÏûëÏóÖ', spec: 'Î¨¥Í±∏Î†àÎ∞õÏù¥ Î∞ëÏûëÏóÖ', unit: 'Ïãù', qty: '1', price: '400000' },
                {
                    div: 'Ìï©ÏßÄ(ÏùºÎ∞ò) - Ï∞∏Í≥†', name: 'Í∞úÎÇòÎ¶¨Î≤ΩÏßÄ (Ìï©ÏßÄ)', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1',
                    price: '100000'
                },
                {
                    div: 'Ìï©ÏßÄ(ÏùºÎ∞ò) - Ï∞∏Í≥†', name: 'Ïã†ÌôîÎ≤ΩÏßÄ (Ìï©ÏßÄ / ÏïÑÏù¥Î¶¨Ïä§ / ÌååÏù∏ÌïòÏûÑ)', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit:
                        'py', qty: '1', price: '100000'
                },
                {
                    div: 'Ìï©ÏßÄ(ÏùºÎ∞ò) - Ï∞∏Í≥†', name: 'Ï†úÏùºÎ≤ΩÏßÄ (Ìï¥ÌîºÎç∞Ïù¥ / ÏÑºÏä§)', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py',
                    qty: '1', price: '100000'
                },
                {
                    div: 'Ìï©ÏßÄ(ÏùºÎ∞ò) - Ï∞∏Í≥†', name: 'LX Z:IN (ÌúòÏïôÏÑ∏)', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty:
                        '1', price: '100000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í∏∞Î≥∏) - Ï∞∏Í≥†', name: 'Í∞úÎÇòÎ¶¨ Î°úÌïòÏä§+', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1',
                    price: '120000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í∏∞Î≥∏) - Ï∞∏Í≥†', name: 'Ï†úÏùº Î≤†Ïù¥ÏßÅÌîåÎü¨Ïä§', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty: '1',
                    price: '120000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í∏∞Î≥∏) - Ï∞∏Í≥†', name: 'LX Z:IN Î≤†Ïä§Îù†', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty:
                        '1', price: '120000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í≥†Í∏â) - Ï∞∏Í≥†', name: 'Í∞úÎÇòÎ¶¨ ÌîÑÎ¶¨ÎØ∏ÏóÑ / ÏïÑÌä∏Î∂Å / ÏóêÎπÑÎâ¥', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit:
                        'py', qty: '1', price: '140000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í≥†Í∏â) - Ï∞∏Í≥†', name: 'Ïã†Ìôî ÏóêÏÉÅÏä§ / ÌååÏÇ¨Îìú', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty:
                        '1', price: '140000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í≥†Í∏â) - Ï∞∏Í≥†', name: 'Ï†úÏùº ÎÇòÎ¨¥ÌîåÎü¨Ïä§ / Ï†úÏù¥ÌîåÎûòÌã∞ÎÑò', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py',
                    qty: '1', price: '140000'
                },
                {
                    div: 'Ïã§ÌÅ¨ (Í≥†Í∏â) - Ï∞∏Í≥†', name: 'LX Z:IN ÎîîÏïÑÎßù', spec: '(LX Z:IN,Í∞úÎÇòÎ¶¨,Ïã†Ìôî,Ï†úÏùº)ÌÉù 1. Î≤ΩÎ≤ΩÏßÄ/Ï≤úÏû•ÏßÄ ÌÜµÏùºÏãú ÏûêÏû¨ÎπÑ Ï∂îÍ∞Ä.', unit: 'py', qty:
                        '1', price: '140000'
                }
            ],
            '14': [
                { div: 'ÏõêÎ™©ÎßàÎ£®', name: 'ÏõêÎ™©ÎßàÎ£®', spec: '', unit: 'py', qty: '1', price: '280000' },
                { div: 'Í∞ïÎßàÎ£®', name: 'ÎèôÌôî Ìï©ÌåêÎßàÎ£®', spec: '10T 600*600', unit: 'py', qty: '1', price: '150000' },
                { div: 'ÎèôÌôî', name: 'ÎÇòÌà¨Ïä§ÏßÑ Í∑∏ÎûÄÎç∞ / Ïù¥Î™®ÏÖòÎ∏îÎûë(JG2012)', spec: '7T*325*810', unit: 'py', qty: '1', price: '110000' },
                { div: 'Í∞ïÎßàÎ£®', name: 'ÎÖ∏Î∞î ÌîåÎ°ú', spec: '', unit: 'py', qty: '1', price: '140000' },
                { div: 'ÎÖ∏Î∞∞', name: 'ÎÖ∏Î∞∞ Î∏îÎûôÎùºÎ≤®', spec: '7.5T*165*1200', unit: 'py', qty: '1', price: '120000' },
                { div: 'ÎèôÌôî', name: 'ÎπÑÏõÄ190', spec: '', unit: 'py', qty: '1', price: '260000' },
                { div: 'LX ÏßÄÏù∏ ÏóêÎîîÌÜ§', name: 'lx ÏóêÎîîÌÜ§ Ïä§ÌÜ§', spec: '5t*450*900 - ÏÜîÌã∞ÌÅ¨Î¶º(EDT7725)', unit: 'py', qty: '1', price: '99000' },
                { div: 'Îç∞ÏΩîÌÉÄÏùº', name: 'LX ÏßÄÏù∏ Îç∞ÏΩîÌÉÄÏùº', spec: 'LX ÏßÄÏù∏ Î≥¥ÌÉÄÎãâ ÏÇ¨Í∞Å 600Í∞Å (3T*600*600)', unit: 'py', qty: '1', price: '45000' },
                { div: 'Ïû•Ìåê', name: 'Ïû•Ìåê', spec: '2.2T', unit: 'py', qty: '1', price: '60000' },
                { div: 'Ïû•Ìåê', name: 'Ïû•Ìåê', spec: '2.2T', unit: 'py', qty: '1', price: '70000' },
                { div: 'Ïû•Ìåê', name: 'lx Ïª¥Ìè¨Ìä∏', spec: '', unit: 'py', qty: '1', price: '150000' }
            ],
            '15': [],
            '16': [
                { div: 'Ïã§Î¶¨ÏΩò', name: 'Ïã§Î¶¨ÏΩò ÎßàÍ∞ê', spec: 'ÏïÑÎç±Ïä§ Ïã§Î¶¨ÏΩò - ÏÉâÎßûÏ∂§ ÏãúÍ≥µ', unit: 'py', qty: '1', price: '13000' },
                { div: 'Îπ®ÎûòÍ±¥Ï°∞ÎåÄ', name: 'Îπ®ÎûòÍ±¥Ï°∞ÎåÄ - ÏàòÎèô', spec: 'Ïä§ÌÖåÏù∏Î†àÏä§ Î¥â - ÏàòÎèô', unit: 'ea', qty: '1', price: '110000' },
                { div: 'Îπ®ÎûòÍ±¥Ï°∞ÎåÄ', name: 'Îπ®ÎûòÍ±¥Ï°∞ÎåÄ - Ï†ÑÎèô', spec: 'Ïä§ÌÖåÏù∏Î†àÏä§ Î¥â - ÏàòÎèô', unit: 'ea', qty: '1', price: '300000' },
                { div: 'Ï§ÄÍ≥µÏ≤≠ÏÜå', name: 'Ï§ÄÍ≥µÏ≤≠ÏÜå', spec: '', unit: 'py', qty: '1', price: '20000' }
            ],
            '17': []
        };

        // Í∏∞Î≥∏ Î©îÎ™® Îç∞Ïù¥ÌÑ∞
        const defaultCostMemos = {
            '01': `1. ÌñâÏúÑÌóàÍ∞ÄÍ∞Ä ÌïÑÏöîÌïú Í≤ΩÏö∞Îäî Íµ¨Ï°∞ÎÇò Ïô∏Í¥Ä, ÏÑ§ÎπÑ Îì±Ïóê ÏòÅÌñ•ÏùÑ Ï£ºÎäî Í≥µÏÇ¨Î•º Ìï† Îïå ÏßÄÏûêÏ≤¥Ïóê ÏÇ¨Ï†Ñ ÌóàÍ∞ÄÎ•º Î∞õÏïÑÏïº Ìï©ÎãàÎã§.
2. ÌñâÏúÑÌóàÍ∞Ä Ï¶ùÎ™ÖÏÑú(ÌïÑÏ¶ù) Î∞úÍ∏âÏãú Î∞òÎìúÏãú ÏäπÏù∏Ïóê Îî∞Î•∏ Ï°∞Í±¥(Í∞ëÏ¢Ö Î∞©ÌôîÎ¨∏, Î∞©ÌôîÌåê Î∞è Î∞©ÌôîÏú†Î¶¨, Í∞êÏßÄÍ∏∞) ÏùÑ Ï∂©Ï°±Ìï¥Ïïº Ìï©ÎãàÎã§.
3. ÏûÖÏ£ºÎØº ÎèôÏùòÏÑúÎ•º Î∞õÎäî Ïù¥Ïú†Îäî Í≥µÏÇ¨Î°ú Ïù∏Ìï¥ Î∞úÏÉùÌï† Ïàò ÏûàÎäî ÏÜåÏùå¬∑ÏßÑÎèô¬∑Î®ºÏßÄ¬∑ÎèôÏÑ† Ï†úÌïú Îì±Ïùò Î∂àÌé∏ÏùÑ ÏÇ¨Ï†ÑÏóê ÏïåÎ¶¨Í≥†, Ï£ºÎ≥Ä Í±∞Ï£ºÏûêÏùò Í≥µÏãùÏ†ÅÏù∏ 'ÎèôÏùò'Î•º Î∞õÏïÑ Î∂ÑÏüÅÏùÑ ÏòàÎ∞©ÌïòÍ∏∞ ÏúÑÌï¥ÏûÖÎãàÎã§.
4. Í≥µÏÇ¨Î•º ÏúÑÌï¥ ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Ïù¥Ïö©Î£å(Î≥¥Ï¶ùÍ∏à) Î∞è Ï£ºÏ∞® ÏöîÍ∏àÏù¥ Î∂ÄÎã¥Ìï©ÎãàÎã§.
5. Í≥µÏÇ¨ Í≥ºÏ†ïÏóêÏÑú Î∞úÏÉùÌïòÎäî Ï†ÑÍ∏∞¬∑ÏàòÎèÑ Îì±Ïùò Í≥µÍ≥ºÍ∏àÏùÄ Í≥†Í∞ùÏù¥ Î∂ÄÎã¥Ìï©ÎãàÎã§.
6. ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Ïù¥Ïö©Ïù¥ Î∂àÍ∞Ä ÎòêÎäî ÏóÜÎäî ÏÑ∏ÎåÄÎäî Ï∂îÍ∞Ä ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï©ÎãàÎã§.
7. Ïú†ÏßÄ ÎêòÎäî Ìï≠Î™©(Í∞ÄÍµ¨, Î∞îÎã•Ïû¨ Îì±)ÏùÄ Î≥¥ÏñëÏù¥ ÌïÑÏàòÏù¥Î©∞ ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï©ÎãàÎã§.`,
            '02': `1. Ï≤†Í±∞ Ï†Ñ Ïû¨ÏÇ¨Ïö© Ìï≠Î™©Ïóê ÎåÄÌïòÏó¨ ÏÇ¨Ï†ÑÏóê Î¨∏Ï†ú(ÏûëÎèôÏïàÎê®, Ï∞çÌûò, Ïò§Ïóº Îì±) Î∂ÄÎ∂ÑÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.
2. Ï≤†Í±∞ Ìï≠Î™©Ïóê ÏóÜÎäî Î∂ÄÎ∂ÑÏùÄ ÏûÑÏùòÎ°ú Ï≤†Í±∞ÌïòÏßÄ ÏïäÏäµÎãàÎã§.Ï≤†Í±∞ Ï∂îÍ∞ÄÏãú ÎπÑÏö©Ïù¥ ÏÇ∞Ï∂úÎêòÏñ¥ Ï∂îÍ∞ÄÍ∏àÏù¥ Î∞úÏÉùÎê©ÎãàÎã§.
3. Íµ¨Ï°∞Ï≤¥(ÎÇ¥Î†•Î≤Ω, Î≥¥, Í∏∞Îë•)Îäî ÏûÑÏùò Ï≤†Í±∞Í∞Ä Î∂àÍ∞ÄÌïòÎ©∞, Íµ¨Ï°∞Í≤ÄÌÜ† ÏóÜÏù¥ Ï≤†Í±∞ Ïãú ÏïàÏ†ÑÏÇ¨Í≥† Î∞è Î≤ïÏ†Å Ï±ÖÏûÑÏù¥ Î∞úÏÉùÌï©ÎãàÎã§.
4. Ï≤†Í±∞ Ïãú Î∞úÏÉùÌïòÎäî ÌèêÍ∏∞Î¨ºÏùÄ Î≤ïÏ†Å Í∏∞Ï§ÄÏóê Îî∞Îùº Î∂ÑÎ¶¨¬∑Ï≤òÎ¶¨Ìï¥Ïïº ÌïòÎ©∞, ÌèêÍ∏∞Î¨º Ï≤òÎ¶¨ ÎπÑÏö©Ïù¥ Î≥ÑÎèÑÎ°ú Î∞úÏÉùÌï©ÎãàÎã§.
5. Ï∏µÍ∞Ñ ÏÜåÏùå Î∞è ÏßÑÎèôÏù¥ Ïã¨Ìïú ÏûëÏóÖÏùÄ Í¥ÄÎ¶¨ÏÇ¨Î¨¥ÏÜå ÏÇ¨Ï†ÑÏóê Í≥†ÏßÄÌïòÎ©∞ ÏßÄÏ†ï ÏãúÍ∞Ñ ÎÇ¥Ïóê ÏßÑÌñâÌï©ÎãàÎã§.`,
            '03': `1. Í∏∞Ï°¥ Î∞∞Í¥Ä ÏÇ¨Ïö©ÏùÑ ÏõêÏπôÏúºÎ°ú Ìï©ÎãàÎã§.
2. Î∞∞Í¥Ä(Ïò§Ïàò, ÌïòÏàò, ÏàòÎèÑ) ÏúÑÏπò Î≥ÄÍ≤Ω Ïãú Íµ¨Î∞∞Í∞Ä ÌôïÎ≥¥ ÎêòÏßÄ ÏïäÏúºÎ©¥ Ïã†Î∞úÏù¥ Î¨∏Ïóê Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.
3. Í∏∞Ï°¥ Î∞∞Í¥Ä ÏÉÅÌÉúÏóê Îî∞Îùº ÍµêÏ≤¥Í∞Ä Í∂åÏû•Îê† Ïàò ÏûàÏúºÎ©∞, Ïù¥Îïå Î∞òÎìúÏãú Í≥µÏ†ï Ï§ëÍ∞ÑÏóê ÎàÑÏàòÌÉêÏßÄÎ•º Ïã§ÏãúÌï©ÎãàÎã§.
4. Î∞©ÏàòÎäî Î∞îÎã•Îøê ÏïÑÎãàÎùº Î≤ΩÏ≤¥ ÏùºÏ†ï ÎÜíÏù¥(H: 1100Ïù¥ÏÉÅ)ÍπåÏßÄ ÏãúÍ≥µÌï¥Ïïº ÌïòÎ©∞, 3Ï∞® Î∞©ÏàòÍπåÏßÄ Í∂åÏû• ÎìúÎ¶ΩÎãàÎã§.
5. Î∞©Ïàò ÌõÑ Ï∂©Î∂ÑÌïú ÏñëÏÉù Í∏∞Í∞Ñ(ÏµúÏÜå 24~48ÏãúÍ∞Ñ)ÏùÑ ÌôïÎ≥¥ ÌõÑ ÌÉÄÏùº ÏãúÍ≥µÏùÑ ÏßÑÌñâ Ìï©ÎãàÎã§.
6. Ïô∏Î≤ΩÏù¥ ÎßûÎãøÎäî Î∂ÄÎ∂ÑÏóê ÏàòÎèÑ Î∞∞Í¥Ä Ïã†ÏÑ§ Ïãú ÎèôÌåå Î∞©ÏßÄ Î∞è Îã®Ïó¥ Ï≤òÎ¶¨Í∞Ä Î∞òÎìúÏãú ÌïÑÏöîÌï©ÎãàÎã§.
7. Í∞ÄÏä§ Ï≤†Í±∞ Î∞è Ïã†ÏÑ§ÏùÄ Î©¥Ìóà Î≥¥Ïú†ÏûêÍ∞Ä ÏßÑÌñâ Ìï¥Ïïº Ìï©ÎãàÎã§.`,
            '04': `1. Î∞úÏΩîÎãà ÌôïÏû•ÏùÄ ÌñâÏúÑÌóàÍ∞Ä ÎåÄÏÉÅÏù¥Î©∞, ÌóàÍ∞Ä Ï°∞Í±¥(Î∞©ÌôîÎ¨∏, Îã®Ïó¥ Í∏∞Ï§Ä Îì±)ÏùÑ Ï∂©Ï°±Ìï¥Ïïº Ìï©ÎãàÎã§.
2. ÌôïÏû• Ïãú Ïô∏Î∂Ä ÎÖ∏Ï∂úÎ©¥Ïóê ÎåÄÌïú Îã®Ïó¥ ÏãúÍ≥µÏù¥ ÌïÑÏàòÏù¥Î©∞, ÎØ∏Ìù° Ïãú Í≤∞Î°ú¬∑Í≥∞Ìå°Ïù¥ Î∞úÏÉùÏùò ÏõêÏù∏Ïù¥ Îê©ÎãàÎã§.
3. Îã®Ïó¥Ïû¨ Ï¢ÖÎ•ò Î∞è ÎëêÍªòÏóê Îî∞Îùº ÏãúÍ≥µÎπÑÍ∞Ä Îã¨ÎùºÏßÄÎ©∞, ÏóêÎÑàÏßÄ Ìö®Ïú®Í≥º ÏßÅÍ≤∞Îê©ÎãàÎã§.
4. Îã®Ïó¥ÏùÄ Í≤©Ïûê Î∞©ÏãùÏúºÎ°ú Ïó¥ÍµêÌòÑÏÉÅÏùÑ ÏµúÏÜåÌôî ÌïòÎ©∞ Ïù¥ÏùåÎ∂ÄÏúÑÎäî Î∞òÎìúÏãú ÌÖåÏù¥Ìïë Ï≤òÎ¶¨Î°ú ÎßàÍ∞êÌï©ÎãàÎã§.`,
            '05': `1. Ï∞ΩÌò∏ ÍµêÏ≤¥Îäî Ïô∏Í¥Ä Î≥ÄÍ≤ΩÏóê Ìï¥ÎãπÌïòÏó¨ ÏïÑÌååÌä∏Ïùò Í≤ΩÏö∞ Í¥ÄÎ¶¨Í∑úÏïΩ ÌôïÏù∏ Î∞è ÎèôÏùò Ï†àÏ∞®Í∞Ä ÌïÑÏöîÌï† Ïàò ÏûàÏäµÎãàÎã§.
2. Í∏∞Ï°¥ Ï∞ΩÌò∏ Í∑úÍ≤©Í≥º Ïã†Í∑ú Ï∞ΩÌò∏ Í∑úÍ≤©Ïù¥ Îã§Î•º Í≤ΩÏö∞ Ï∂îÍ∞Ä ÎßàÍ∞ê Í≥µÏÇ¨Í∞Ä Î∞úÏÉùÌï©ÎãàÎã§.
3. Ï∞ΩÌò∏ Ï†úÏûë Í∏∞Í∞Ñ(2~3Ï£º)ÏùÑ Í≥µÏ†ïÏóê Î∞òÏòÅÌï¥Ïïº ÌïòÎ©∞, ÌòÑÏû• Ïã§Ï∏° ÌõÑ Ï†úÏûë ÏßÑÌñâÌï©ÎãàÎã§.
4. ÌïòÏûê Î∞úÏÉù Ïãú Í∞Å Ï†úÏ°∞ÏÇ¨ A / S Í∏∞Ï§ÄÏù¥ Ï†ÅÏö©Îê©ÎãàÎã§.
5. Î™®Îì† Ï∞ΩÌò∏ ÏãúÍ≥µÏùÄ ÏãúÎ∞©ÏÑúÏóê Ï§ÄÌïòÏó¨ ÏãúÍ≥µÎê©ÎãàÎã§.`,
            '06': `1. Î∂ÑÏ†ÑÎ∞ò Ïö©Îüâ Î∞è Ï∞®Îã®Í∏∞ Íµ¨ÏÑ±ÏùÑ ÌôïÏù∏ÌïòÍ≥†, ÌïÑÏöîÏãú Ï¶ùÏÑ§ ÎòêÎäî ÍµêÏ≤¥Î•º ÏßÑÌñâÌï©ÎãàÎã§.
2. Ï†ÑÏÑ† Í∑úÍ≤©ÏùÄ ÏÇ¨Ïö© Ïö©ÎüâÏóê ÎßûÍ≤å ÏÑ†Ï†ïÌïòÎ©∞ ÎÖ∏ÌõÑ Ï†ÑÏÑ†ÏùÄ ÌôîÏû¨ ÏúÑÌóòÏù¥ ÏûàÏñ¥ ÍµêÏ≤¥Î•º Í∂åÏû•Ìï©ÎãàÎã§.
3. Ï°∞Î™Ö ÏúÑÏπò Î≥ÄÍ≤Ω Î∞è Ï∂îÍ∞Ä Ïãú Ï≤úÏû• Íµ¨Ï°∞(ÏΩòÌÅ¨Î¶¨Ìä∏ / ÏÑùÍ≥†Î≥¥Îìú)Ïóê Îî∞Îùº ÏãúÍ≥µ Î∞©Î≤ïÏù¥ Îã¨ÎùºÏßëÎãàÎã§.
4. Îß§Î¶Ω ÏΩòÏÑºÌä∏ Î∞è Ïä§ÏúÑÏπò ÏúÑÏπòÎäî ÎèÑÎ©¥ ÌôïÏ†ï ÌõÑ Î≥ÄÍ≤ΩÏù¥ Ïñ¥Î†§Ïö∞ÎØÄÎ°ú ÏÇ¨Ï†Ñ ÌôïÏ†ïÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.
5. ÏöïÏã§ Îì± ÏäµÍ∏∞ ÎÖ∏Ï∂ú Í≥µÍ∞ÑÏùÄ Î∞©ÏàòÌòï ÏΩòÏÑºÌä∏ Î∞è Ï†ëÏßÄ ÏãúÍ≥µÏùÑ ÌïÑÏàòÎ°ú ÏßÑÌñâÌï©ÎãàÎã§.`,
            '07': `1. ÏãúÏä§ÌÖú ÏóêÏñ¥Ïª® ÏÑ§Ïπò Ïãú Ï≤úÏû• ÎÇ¥Î∂Ä Í≥µÍ∞Ñ ÌôïÎ≥¥ Ïó¨Î∂ÄÎ•º ÏÇ¨Ï†ÑÏóê ÌôïÏù∏Ìï¥Ïïº Ìï©ÎãàÎã§.
2. Î∞∞Í¥Ä Í≤ΩÎ°úÏóê Îî∞Îùº ÏóêÏñ¥Ïª® Îã®ÎÇ¥Î¶º ÎòêÎäî Î∞∞Í¥Ä Í∏∏(Ï≤úÏû• Î∞ïÏä§ Î∞è Î™∞Îî©)Ïùò ÏãúÍ≥µÏóê Îî∞Î•∏ Ï∂îÍ∞Ä ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
3. Î∞∞Í¥Ä ÏãúÍ≥µÏóê Îî∞Î•∏ Ï≤†Í±∞ ÌõÑ ÎßàÍ∞ê Î∞è ÏóêÏñ¥Ïª® ÏûêÎ¶¨ Î≥¥Í∞ïÏóê Îî∞Î•∏ Ï∂îÍ∞Ä ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
4. Ïã§Ïô∏Í∏∞ ÏÑ§Ïπò ÏúÑÏπòÎäî ÏïÑÌååÌä∏ Í¥ÄÎ¶¨Í∑úÏïΩ Î∞è Íµ¨Ï°∞Ï†Å Ï†úÏïΩÏùÑ ÌôïÏù∏ ÌõÑ ÏãúÍ≥µ Ïó¨Î∂ÄÎ•º Í≤∞Ï†ïÌï©ÎãàÎã§.
5. Ïã§Ïô∏Í∏∞Ïã§ Ïã†ÏÑ§Ïãú Î≥ÑÎèÑ ÎπÑÏö©Ïù¥ Ï∂îÍ∞Ä Îê©ÎãàÎã§.(Î£®Î≤ÑÏ∞Ω, Ïπ∏ÎßâÏù¥: Îã®Ïó¥ - Ï∞®Ïùå)
            6. Ï†ÑÍ∏∞ Ïö©Îüâ ÌôïÏù∏ ÌõÑ Ï†ÑÏö© ÌöåÎ°ú Î∞∞ÏÑ†Ïù¥ ÌïÑÏöîÌï† Ïàò ÏûàÏúºÎ©∞ Ï∂îÍ∞Ä ÎπÑÏö©Ïù¥ Î∞úÏÉù Îê©ÎãàÎã§.
7. ÏóêÏñ¥Ïª® ÏãúÍ≥µÏãú Î∞∞Í¥ÄÏùÄ Î∞òÎìúÏãú Ï†ïÌíàÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§.`,
            '08': `1. Ï≤úÏû• Î∞è Î≤ΩÏ≤¥ Î™©Í≥µ ÏûëÏóÖÏùÄ ÌõÑÏÜç Í≥µÏ†ï(Ï†ÑÍ∏∞, Îã®Ïó¥, ÎèÑÏû•)Í≥º Ïó∞Í≥ÑÎêòÎØÄÎ°ú Ï†ïÌôïÌïú ÏàúÏÑú Í¥ÄÎ¶¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.
2. ÎèÑÏñ¥ Ï¢ÖÎ•òÏóê Îî∞Îùº Ï†úÏûë Í∏∞Í∞ÑÍ≥º ÎπÑÏö©Ïù¥ Îã¨ÎùºÏßëÎãàÎã§.
3. ÎèÑÏñ¥ Î∞©Ìñ•(Ïó¥Î¶º / Îã´Ìûò, Ï¢å / Ïö∞) Î∞è ÏÜêÏû°Ïù¥ ÏúÑÏπòÎäî ÏãúÍ≥µ Ï†Ñ ÌôïÏ†ïÌïòÎ©∞ ÎèÑÎ©¥ Í∏∞Ï§ÄÏúºÎ°ú ÏãúÍ≥µÌï©ÎãàÎã§.
4. ÏàòÏ∂ï, Îí§ÌãÄÎ¶º, Í∞àÎùºÏßêÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Î™©ÏûêÏû¨Îäî Ìï®ÏàòÏú® 8~12 % Í∏∞Ï§ÄÏùò ÏûêÏû¨Îßå ÏÇ¨Ïö©Ìï©ÎãàÎã§.
5. ÌòÑÏû• Ï†úÏûë Í∞ÄÍµ¨Ïùò Í≤ΩÏö∞ Ìï©Ìåê Î∞è ÎßàÍ∞êÏû¨ Ï¢ÖÎ•òÏóê Îî∞Îùº ÌíàÏßà Ï∞®Ïù¥Í∞Ä ÏûàÏäµÎãàÎã§.
6. Î™©ÏûêÏû¨Îäî Ï†àÎåÄ Ïû¨ÏÇ¨Ïö©ÌíàÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.`,
            '09': `1. Í∏∞Ï°¥ Í∞ÄÍµ¨ÎÇò ÎèÑÏñ¥Ïóê ÌïÑÎ¶Ñ ÏãúÍ≥µ Ïãú ÌëúÎ©¥ ÏÉÅÌÉú(Îì§Îú∏, ÏÜêÏÉÅ)Ïóê Îî∞Îùº Í≤∞Í≥ºÎ¨º ÌíàÏßàÏù¥ Îã¨ÎùºÏßëÎãàÎã§.
2. ÌëúÎ©¥ ÏÉÅÌÉúÍ∞Ä Ï¢ãÏßÄ ÏïäÏúºÎ©¥ ÌïÑÎ¶Ñ ÏãúÍ≥µÏù¥ Î∂àÍ∞ÄÌï©ÎãàÎã§.
3. ÌïÑÎ¶Ñ Ï¢ÖÎ•ò(Î¨¥Í¥ë, Ïú†Í¥ë, Ïö∞Îìú, Î©îÌÉà Îì±)Ïóê Îî∞Îùº ÎÇ¥Íµ¨ÏÑ± Î∞è Îã®Í∞ÄÍ∞Ä ÏÉÅÏù¥Ìï©ÎãàÎã§.
4. Î™®ÏÑúÎ¶¨, Í≥°Î©¥, Î™®Ïñë Î∂ÄÏúÑÎäî ÏãúÍ∞Ñ Í≤ΩÍ≥ºÏóê Îî∞Îùº Îì§Îú∏Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
5. ÎèÑÏñ¥Ïùò Í≤ΩÏö∞ Î¨∏Ïñë Î∂ÄÎ∂ÑÏùÑ ÏóÜÏï†Í≥† ÎØºÏûêÎ™®ÏñëÏùÑ ÎßåÎì§Í∏∞ ÏúÑÌï¥ Ìï∏ÎîîÏûëÏóÖÏùÄ ÌïÑÏàòÏù¥Î©∞ ÏÇ¨Ïö©ÏûêÏùò ÌôòÍ≤ΩÏóê Îî∞Îùº Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
6. Í∏∞Ï°¥ ÌïÑÎ¶Ñ ÏûêÎ¶¨Í∞Ä ÌéòÏù∏Ìä∏ÎÇò Î¨¥Îä¨Î™©Ïùò Í≤ΩÏö∞ Î∞ëÏûëÏóÖ ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï©ÎãàÎã§.
7. ÏÉÅÏóÖÍ≥µÍ∞ÑÏùò Í≤ΩÏö∞ Î∞òÎìúÏãú Î∞©ÌôîÌïÑÎ¶ÑÏùÑ ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.`,
            '10': `1. ÌÉÄÏùº Í∑úÍ≤© Î∞è Ìå®ÌÑ¥Ïóê Îî∞Îùº ÏãúÍ≥µ ÎÇúÏù¥ÎèÑÏôÄ ÎπÑÏö©Ïù¥ Îã¨ÎùºÏßÄÎ©∞, ÎåÄÌòï ÌÉÄÏùºÏùÄ Ìï†Ï¶ùÏù¥ Ï†ÅÏö©Îê©ÎãàÎã§.
2. Î∞îÎã• ÌÉÄÏùº ÏãúÍ≥µ Ïãú Íµ¨Î∞∞ Î∞©Ìñ•ÏùÑ ÌôïÏù∏ÌïòÍ≥†, Î∞∞ÏàòÍµ¨ Î∞©Ìñ•ÏúºÎ°ú Î¨º ÌùêÎ¶ÑÏù¥ ÏõêÌôúÌïòÎèÑÎ°ù ÏãúÍ≥µÌï©ÎãàÎã§.
3. Ï§ÑÎàà ÏÉâÏÉÅ ÌÉÄÏùºÍ≥º Ìï®Íªò ÏÑ†Ï†ïÌïòÎ©∞ ÏãúÎ©òÌä∏ Ï§ÑÎààÏùÑ Í∏∞Î≥∏ÏúºÎ°ú ÏÇ¨Ïö©ÌïòÎ©∞ Î∞±ÌôîÌòÑÏÉÅÏùÄ ÏûêÏó∞Ïä§Îü¨Ïö¥ ÌòÑÏÉÅÏûÖÎãàÎã§.
4. Ïö∞Î†àÌÉÑ ÎòêÎäî ÏºÄÎùºÌè≠Ïãú Ï§ÑÎààÏùÄ Î≥ÑÎèÑ ÎπÑÏö©Ïù¥ Î∞úÏÉùÎê©ÎãàÎã§.
5. Î≤ΩÌÉÄÏùºÍ≥º Î∞îÎã•ÌÉÄÏùº Ï†ëÌï©Î∂Ä, ÏΩîÎÑà Î∞©Ïãù(„Ñ±Ïûê, Î™∞Îî© Îì±) ÎòêÎäî Ï°∏Î¶¨Ïª∑ Î∞©Ïãù Ï§ë ÎßàÍ∞êÏùÑ ÏÇ¨Ï†ÑÏóê Í≤∞Ï†ï ÌõÑ ÏßÑÌñâÌï©ÎãàÎã§.
6. Î™®Îì† ÌÉÄÏùºÏùÄ ÌÅ¨Í∏∞Í∞Ä Í∑†ÏùºÌïòÏßÄ ÏïäÍ≥† Î∂àÍ∑†ÌòïÌïòÎ©∞ Ïò§Ï∞®Î≤îÏúÑÏóê Îî∞Î•∏ Î∂àÎüâ ÏûêÏû¨Í∞Ä ÏïÑÎãôÎãàÎã§.`,
            '11': '',
            '12': `1. ÎèÑÏû• Ï†Ñ ÌïòÏßÄ Ï≤òÎ¶¨(ÌçºÌã∞, ÏÉåÎî©)Í∞Ä ÌíàÏßàÏùÑ Ï¢åÏö∞ÌïòÎ©∞, ÌÅ¨Îûô Î∞è ÏöîÏ≤† Î∂ÄÏúÑÎäî Î≥¥Ïàò ÌõÑ ÏßÑÌñâÌï©ÎãàÎã§.
2. ÎèÑÏû• ÌöüÏàò(Ï¥àÎ≤å, Ï§ëÎ≤å, Ï†ïÎ≤å)Ïóê Îî∞Îùº ÎßàÍ∞ê ÌíàÏßàÏù¥ Îã¨ÎùºÏßÄÎ©∞, ÏµúÏÜå 2Ìöå Ïù¥ÏÉÅ ÏßÑÌñâÌï©ÎãàÎã§.
3. ÌéòÏù∏Ìä∏ Ï¢ÖÎ•ò(ÏàòÏÑ±, Ïú†ÏÑ±, ÏπúÌôòÍ≤Ω)Ïóê Îî∞Îùº Í±¥Ï°∞ ÏãúÍ∞Ñ, ÎÉÑÏÉà, ÎÇ¥Íµ¨ÏÑ±Ïù¥ ÏÉÅÏù¥Ìï©ÎãàÎã§.
4. ÎèÑÏû• ÏûëÏóÖ Ï§ëÏóêÎäî ÌôòÍ∏∞Î•º Ï∂©Î∂ÑÌûà ÌïòÍ≥†, ÌÉÄ Í≥µÏ†ï ÏûëÏóÖÏûê Î∞è Í≥†Í∞ùÏùò Ï∂úÏûÖÏùÑ Ï†úÌïúÌï©ÎãàÎã§.
5. Ï≤úÏû•, Î≤ΩÏ≤¥ Îì± Ï†ÅÌï©Ìïú ÎèÑÎ£åÎ•º ÏÑ†Ï†ï ÌïòÎ©∞, ÏÉâÏÉÅÏùÄ ÏÉòÌîå ÌôïÏù∏ ÌõÑ Í≤∞Ï†ï ÌõÑ ÎèÑÎ©¥Ïóê ÌëúÍ∏∞Ìï©ÎãàÎã§.`,
            '13': `1. ÎèÑÎ∞∞ Ï†Ñ Î≤ΩÎ©¥ ÏÉÅÌÉú(Í≥∞Ìå°Ïù¥, ÌÅ¨Îûô, ÏäµÍ∏∞)Î•º ÌôïÏù∏ÌïòÍ≥†, ÌïÑÏöîÏãú Î≥¥Ïàò Í≥∞Ìå°Ïù¥ Ï†úÍ±∞Ï†úÎ•º Ïã§ÌñâÌïòÎ©∞ ÏÉÅÌô©Ïóê Îî∞Îùº Ï∂îÍ∞ÄÎπÑÏö©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
2. Î≤ΩÏßÄ Ï¢ÖÎ•ò(Ïã§ÌÅ¨, Ìï©ÏßÄ, Ï≤úÏó∞)Ïóê Îî∞Îùº ÏãúÍ≥µ Î∞©Î≤ï Î∞è Îã®Í∞ÄÍ∞Ä Îã¨ÎùºÏßëÎãàÎã§.
3. ÎèÑÎ∞∞ ÌõÑ 24~48ÏãúÍ∞Ñ ÌôòÍ∏∞Î•º ÏûêÏ†úÌïòÍ≥† Í∏âÍ≤©Ìïú Ïò®ÎèÑ Î≥ÄÌôîÎ•º ÌîºÌï¥Ïïº Î≤ΩÏßÄ Îì§Îú∏ÏùÑ Î∞©ÏßÄÌï©ÎãàÎã§.Í≥†Í∞ùÎãò ÌòÑÏû•Î∞©Î¨∏ÏùÑ ÏûêÏ†ú Î∞îÎûçÎãàÎã§.
4. Í≥∞Ìå°Ïù¥ Ïù¥Î†•Ïù¥ ÏûàÎäî Î≤ΩÎ©¥ÏùÄ Îã®Ïàú ÎèÑÎ∞∞Î°ú Ìï¥Í≤∞ÎêòÏßÄ ÏïäÏúºÎ©∞, ÏõêÏù∏(Í≤∞Î°ú, ÎàÑÏàò) Ìï¥Í≤∞(Îã®Ïó¥)Ïù¥ ÏÑ†ÌñâÎêòÏñ¥Ïïº Ìï©ÎãàÎã§.
5. ÏóêÏñ¥Ïª®, Ï°∞Î™Ö ÏÑ§Ïπò Î∂ÄÏúÑÎäî ÎèÑÎ∞∞ Ï†Ñ ÌôïÏ†ïÌïòÏó¨ ÎßàÍ∞ê ÏÜêÏÉÅÏùÑ Î∞©ÏßÄÌï©ÎãàÎã§.`,
            '14': `1. Î∞îÎã•Ïû¨ Ï¢ÖÎ•ò(Í∞ïÎßàÎ£®, Í∞ïÌôîÎßàÎ£®, Ïò®ÎèåÎßàÎ£®, Îç∞ÏΩîÌÉÄÏùº, Ïû•Ìåê Îì±)Ïóê Îî∞Îùº ÏãúÍ≥µ Î∞©Î≤ïÍ≥º ÌïòÏßÄ Ï°∞Í±¥Ïù¥ Îã§Î¶ÖÎãàÎã§.
2. Í∏∞Ï°¥ Î∞îÎã•Ïû¨ ÏúÑ ÎçßÎ∞© ÏãúÍ≥µÏùÄ ÌïòÏßÄ ÏïäÏäµÎãàÎã§.Ïù¥Îäî Î†àÎ≤® ÏÉÅÏäπ Î∞è Î¨∏ÌÑ± Í∞ÑÏÑ≠ ÎòêÎäî ÌïòÏûêÎ•º Ïú†Î∞úÏãúÌÇµÎãàÎã§.
3. Î∞îÎã•Ïû¨ ÏãúÍ≥µ Ï†Ñ Î∞îÎã• Î†àÎ≤®(ÌèâÌôúÎèÑ)ÏùÑ ÌôïÏù∏ÌïòÍ≥†, Î∂àÎüâ Ïãú ÏÖÄÌîÑ Î†àÎ≤®ÎßÅ ÏûëÏóÖÏùÑ ÏßÑÌñâÌï¥ÏïºÌïòÎ©∞ Ïù¥Îïå Ï∂îÍ∞Ä ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
4. Í≥µÏö©Î∂Ä Î∞îÎã•Ïù¥Îûë ÎÇ¥Î∂Ä Î∞© Î∞îÎã• Î†àÎ≤® ÎÜíÏù¥Í∞Ä Îã§Î•º Í≤ΩÏö∞ ÏÉåÎî©ÏûëÏóÖÏúºÎ°ú Î©¥ ÎßûÏ∂§ÏúºÎ°ú ÏßÑÌñâÌïòÎ©∞ Ïù¥Îïå Ï∂îÍ∞ÄÍ∏à Ïù¥Î∞úÏÉù Îê©ÎãàÎã§.
5. Îç∞ÏΩîÌÉÄÏùº Î∞è Ïû•Ìåê ÏãúÍ≥µÏùò Í≤ΩÏö∞ Î¨¥Í±∞Ïö¥ Î¨ºÍ±¥Ïóê ÏùòÌïú ÎàåÎ¶º ÏûêÍµ≠ Î∞è Ï∞çÌûòÏúºÎ°ú Í∞ÄÍµ¨Í≥µÏÇ¨ Ïù¥ÌõÑÏóê ÏßÑÌñâ Ìï©ÎãàÎã§.`,
            '15': `1. Ï†úÏûë Í∞ÄÍµ¨ÏôÄ ÏãúÏä§ÌÖú Í∞ÄÍµ¨Ïùò ÌäπÏÑ±ÏùÑ Ïù¥Ìï¥ÌïòÍ≥†, Í≥µÍ∞Ñ Î∞è ÏòàÏÇ∞Ïóê ÎßûÍ≤å ÏÑ†ÌÉù ÏßÑÌñâÌï©ÎãàÎã§.
2. Í∞ÄÍµ¨ Ï†úÏûë Í∏∞Í∞ÑÏùÄ Î≥¥ÌÜµ 1~2Ï£º Ï†úÏûë Í∏∞Í∞ÑÏù¥ ÌïÑÏöîÌïòÎ©∞, Î¨¥Îä¨Î™© ÎòêÎäî ÎèÑÏû•Ïùò Í≤ΩÏö∞ 2~4Ï£º Í≥µÏ†ïÏóê Î∞òÏòÅÌï¥Ïïº Ìï©ÎãàÎã§.
3. Í∞ÄÍµ¨ÎèÑÎ©¥Ïù¥ ÏôÑÏÑ±ÎêòÍ≥† Ïã§Ï∏°Ïù¥ÌõÑ Ï†úÏûëÏù¥ Ïã§ÌñâÎêòÎ©¥ ÎèÑÎ©¥ Î≥ÄÍ≤ΩÏù¥ Î∂àÍ∞ÄÌïòÎ©¥ Í≥†Í∞ùÎãò ÏöîÏ≤≠Ïóê ÏùòÌïú Î≥ÄÍ≤ΩÏùÄ Ï∂îÍ∞ÄÍ∏àÏù¥ Î∞úÏÉùÎê† Ïàò ÏûàÏäµÎãàÎã§.
4. Î∂ôÎ∞ïÏù¥Ïû•, Ïã†Î∞úÏû• Îì± ÏÑ§Ïπò Ïãú Î≤ΩÏ≤¥ Î≥¥Í∞ï Ïó¨Î∂ÄÎ•º ÌôïÏù∏ÌïòÍ≥†, ÌïÑÏöîÏãú Ìï©Ìåê Î≥¥Í∞ïÏóê Îî∞Î•∏ ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.
5. Í∞ÄÍµ¨ ÎèÑÏñ¥ Ï¢ÖÎ•ò(Ïó¨Îã´Ïù¥, Ïä¨ÎùºÏù¥Îî©)Ïóê Îî∞Îùº Î†àÏùº Î∞è ÏÜêÏû°Ïù¥ Îì± Î∂ÄÏûêÏû¨Í∞Ä Ï¢ÖÎ•ò Îã¨ÎùºÏßÄÎ©∞ Î∂ÄÏûêÏû¨ Î∏åÎûúÎìúÏóê Îî∞Îùº ÎπÑÏö©Ïù¥ Î≥ÄÍ≤ΩÎê©ÎãàÎã§.
6. Ï£ºÎ∞© Í∞ÄÍµ¨Îäî Í∞ÄÏ†Ñ Í∑úÍ≤©(ÎÉâÏû•Í≥†, ÎπåÌä∏Ïù∏ Í∏∞Í∏∞)Í≥º ÏÑ§ÎπÑ ÏúÑÏπòÎ•º ÏÇ¨Ï†Ñ(Í≥µÏÇ¨ Ïù¥Ï†Ñ)Ïóê ÌôïÏ†ïÌï¥Ïïº Í≥µÏÇ¨Í∞Ä ÏõêÌôúÌïòÎ©∞ Î¨∏Ï†ú Î∞úÏÉùÏùÑ Ï∞®Îã®Îê©ÎãàÎã§.`,
            '16': `1. Ïù∏ÌÑ∞Ìè∞, ÏÜêÏû°Ïù¥, ÌòÑÍ¥Ä Ï§ëÎ¨∏, Î∞úÏΩîÎãà Îπ®ÎûòÍ±¥Ï°∞ÎåÄ Îì± Î∂ÄÏûêÏû¨ ÏÑ§ÏπòÎäî ÏµúÏ¢Ö ÎßàÍ∞ê Îã®Í≥ÑÏóêÏÑú ÏßÑÌñâÌï©ÎãàÎã§.
2. Ï†ÑÏ≤¥ Í≥µÍ∞Ñ Ï≤≠ÏÜå(ÏûÖÏ£º Ï≤≠ÏÜå)Îäî Í≥µÏÇ¨ ÏôÑÎ£å ÌõÑ ÏßÑÌñâÌïòÎ©∞, Î≥ÑÎèÑ ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï©ÎãàÎã§.
3. Ïã§Î¶¨ÏΩò ÎßàÍ∞ê Î∂ÄÏúÑ(ÏöïÏã§, Ï£ºÎ∞©, Ï∞ΩÌò∏ Ï£ºÎ≥Ä)Îäî Ï≤≠ÏÜå Ïù¥ÌõÑ ÏãúÌñâÎêòÎ©∞ ÏôÑÏ†ÑÌûà Í≤ΩÌôîÍ∞Ä ÏôÑÎ£åÎêú Ïù¥ÌõÑ ÏÇ¨Ïö©Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.
4. ÌïòÏûê Ï†êÍ≤ÄÏùÄ ÏûÖÏ£º Ï†Ñ ÏãúÌñâÌïòÎ©∞, Î∞úÍ≤¨Îêú ÌïòÏûêÎäî Î≥¥Ïàò ÏôÑÎ£å ÌõÑ Ïù∏ÏàòÏù∏Í≥ÑÎ•º ÏßÑÌñâÌï©ÎãàÎã§.`,
            '17': `1. Í≥µÏÇ¨ Ï§ë ÏòàÏÉÅÏπò Î™ªÌïú Ï∂îÍ∞Ä Í≥µÏÇ¨(Î∞∞Í¥Ä ÎàÑÏàò Î∞úÍ≤¨, ÎßàÍ∞êÏû¨ ÏÜêÏÉÅ Îì±)Í∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏúºÎ©∞, Î≥ÑÎèÑ ÌòëÏùò ÌõÑ ÏßÑÌñâÌï©ÎãàÎã§.
2. Í≥†Í∞ù ÏöîÏ≤≠Ïóê ÏùòÌïú ÏÑ§Í≥Ñ Î≥ÄÍ≤ΩÏùÄ Í≥µÏ†ï ÏßÄÏó∞ Î∞è Ï∂îÍ∞Ä ÎπÑÏö©Ïùò ÏõêÏù∏Ïù¥ Îê©ÎãàÎã§.
3. Í≥†Í∞ùÎãò Î≥ÑÎèÑ Í≥µÏÇ¨Î°ú Ïù∏ÌïòÏó¨ ÏûîÏû¨Î¨º Ï≤òÎ¶¨ Î∞è ÌèêÍ∏∞Î¨º Î∞úÏÉùÏãú Î∞òÏ∂úÏóê Îî∞Î•∏ ÎπÑÏö©Ïù¥ Î∞úÏÉùÌï©ÎãàÎã§.
4. Í≥µÏÇ¨ ÏôÑÎ£å ÌõÑ ÌïòÏûê Î≥¥Ïàò Í∏∞Í∞Ñ Î∞è Î≤îÏúÑÎäî Í≥ÑÏïΩÏÑúÏóê Î™ÖÏãúÎêú Ï°∞Í±¥Ïóê Îî∞Î¶ÖÎãàÎã§.
5. A / S Ï†ëÏàò Î∞è Ï≤òÎ¶¨ Ï†àÏ∞®Îäî Í≥ÑÏïΩ Ïãú ÏïàÎÇ¥ÎìúÎ¶¨Î©∞, ÌïòÏûêÏôÄ ÏÇ¨Ïö©Ïûê Í≥ºÏã§ÏùÑ Íµ¨Î∂ÑÌïòÏó¨ Ï≤òÎ¶¨Ìï©ÎãàÎã§.`
        };

        const statusLabels = {
            consulting: 'ÏÉÅÎã¥Ï§ë',
            estimate: 'Í≤¨Ï†ÅÏÑú',
            hold: 'Î≥¥Î•ò(Í≥†ÎØºÏ§ë)',
            budget_over: 'ÏòàÏÇ∞Ï¥àÍ≥º(ÎØ∏Í≥ÑÏïΩ)',
            other_company: 'ÌÉÄÏóÖÏ≤¥ÏÑ†Ï†ï(ÎØ∏Í≥ÑÏïΩ)',
            contracted: 'Í≥ÑÏïΩÏôÑÎ£å',
            in_progress: 'Í≥µÏÇ¨Ï§ë',
            completed: 'Í≥µÏÇ¨ÏôÑÎ£å',
            as_done: 'A/S'
        };

        let customers = []; // Phase 2: Îã®Ïùº Source of Truth (Google Sheets) Í∏∞Ï§Ä
        let globalCostData = {}; // Phase 2: ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ (Source of Truth: Google Sheets)
        let currentCustomerId = null;
        let currentData = {};
        let currentCustomer = null; // Ìò∏ÌôòÏÑ± Ïú†ÏßÄÏö© (exportToNotion Îì±)
        let currentStatusFilter = 'all';
        let cachedCloudCount = customers.length; // ÌÅ¥ÎùºÏö∞Îìú Í≥†Í∞ù Ïàò Ï∫êÏãú (ÎèôÍ∏∞Ìôî Ïãú ÏóÖÎç∞Ïù¥Ìä∏)

        // ÌéòÏù¥Ïßï Í¥ÄÎ†® Î≥ÄÏàò
        const PAGE_THRESHOLD = 500; // 500Î™Ö Ïù¥ÏÉÅÏù¥Î©¥ ÌéòÏù¥Ïßï ÌôúÏÑ±Ìôî
        const ITEMS_PER_PAGE = 50; // ÌéòÏù¥ÏßÄÎãπ ÌëúÏãú Í∞úÏàò
        let currentPage = 1;
        let filteredCustomers = []; // ÌïÑÌÑ∞ÎßÅÎêú Í≥†Í∞ù Î™©Î°ù Ï†ÄÏû•

        // ========== Îã§Ï§ë Í¥ÄÎ¶¨Ïûê ÏãúÏä§ÌÖú ==========
        // ========== Îã§Ï§ë Í¥ÄÎ¶¨Ïûê ÏãúÏä§ÌÖú ==========
        // ÏÑ§Ï†ïÍ∞íÏùÄ admin_config.js ÏóêÏÑú Î°úÎìúÎê®

        // ========== ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥¥Ïïà (SHA-256 Ìï¥Ïã±) ==========
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function verifyPassword(inputPassword, storedHash) {
            const inputHash = await hashPassword(inputPassword);
            return inputHash === storedHash;
        }


        // ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê Î™©Î°ù (Phase 2: In-memory Ï†ÑÏö©)
        let regularAdminsRows = [];
        let adminsSyncedOnce = false; // Í¥ÄÎ¶¨Ïûê ÎèôÍ∏∞Ìôî ÏôÑÎ£å Ïó¨Î∂Ä (performLogin Ï§ëÎ≥µ Ìò∏Ï∂ú Î∞©ÏßÄ)

        function getRegularAdmins() {

            return regularAdminsRows;
        }

        function saveRegularAdmins(admins) {

            regularAdminsRows = admins || [];
        }

        // Í¥ÄÎ¶¨Ïûê ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî - Î∂àÎü¨Ïò§Í∏∞
        async function syncAdminsFromCloud() {
            try {
                const params = new URLSearchParams({ sheet: 'Í¥ÄÎ¶¨Ïûê' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                if (!response.ok) {
                    console.error('Í¥ÄÎ¶¨Ïûê ÎèôÍ∏∞Ìôî Ïã§Ìå®: HTTP', response.status);
                    return false;
                }
                const cloudAdmins = await response.json();
                if (Array.isArray(cloudAdmins)) {
                    saveRegularAdmins(cloudAdmins);
                    adminsSyncedOnce = true; // ÎèôÍ∏∞Ìôî ÏôÑÎ£å ÌîåÎûòÍ∑∏
                    if (cloudAdmins.length > 0) {
                        console.log('‚úÖ [Admin Sync] Í¥ÄÎ¶¨Ïûê ÎèôÍ∏∞Ìôî ÏôÑÎ£å:', cloudAdmins.length + 'Î™Ö');
                    } else {
                        console.warn('‚ö†Ô∏è [Admin Sync] Í¥ÄÎ¶¨Ïûê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. (0Î™Ö)');
                    }
                    return true;
                } else {
                    console.error('Í¥ÄÎ¶¨Ïûê ÎèôÍ∏∞Ìôî Ïã§Ìå®: ÏûòÎ™ªÎêú ÏùëÎãµ ÌòïÏãù', cloudAdmins);
                    return false;
                }
            } catch (e) {
                console.warn('Í¥ÄÎ¶¨Ïûê ÎèôÍ∏∞Ìôî Ïã§Ìå®:', e);
                return false;
            }
        }

        // Í¥ÄÎ¶¨Ïûê ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî - Ï†ÄÏû•
        async function syncAdminToCloud(adminData) {
            try {
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // text/plain ÏÇ¨Ïö© (CORS ÌöåÌîº)
                    body: JSON.stringify({
                        action: 'admin',
                        data: adminData
                    })
                });
                const result = await response.json();
                console.log('‚úÖ [Admin Sync] Í¥ÄÎ¶¨Ïûê Ï†ÄÏû• ÏôÑÎ£å:', result);
                return result;
            } catch (e) {
                console.error('Í¥ÄÎ¶¨Ïûê Ï†ÄÏû• Ïã§Ìå®:', e);
                return null;
            }
        }

        // Í¥ÄÎ¶¨Ïûê ÌÅ¥ÎùºÏö∞Îìú ÏÇ≠Ï†ú
        async function deleteAdminFromCloud(adminId) {
            try {
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        action: 'deleteAdmin',
                        adminId: adminId
                    })
                });
                return await response.json();
            } catch (e) {
                console.error('Í¥ÄÎ¶¨Ïûê ÏÇ≠Ï†ú Ïã§Ìå®:', e);
                return null;
            }
        }

        // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Ìïú Í¥ÄÎ¶¨Ïûê
        let currentAdmin = null; // { id, role: 'main' | 'regular'}

        // Í∂åÌïú Ï≤¥ÌÅ¨ Ìï®Ïàò
        function isLoggedIn() {
            return currentAdmin !== null;
        }

        function isMainAdmin() {
            return currentAdmin && currentAdmin.role === 'main';
        }

        function isCreator(customer) {
            if (!currentAdmin) return false;
            // Legacy support: if no createdBy, default to Main Admin
            if (!customer.createdBy) return isMainAdmin();
            return String(customer.createdBy).trim().toLowerCase() === String(currentAdmin.id).trim().toLowerCase();
        }

        function canEdit(customer) {
            if (!customer) customer = currentData;
            if (!currentAdmin) return false;
            if (isMainAdmin()) return true;
            if (customer.isLocked && !customer.unlockedForSession) return false;
            return isCreator(customer);
        }

        function canDelete(customer) {
            return canEdit(customer);
        }

        function isCustomerLocked() {
            if (!currentData || !currentData.isLocked) return false;
            if (isMainAdmin()) return false;
            if (currentData.unlockedForSession) return false;
            return true;
        }

        async function unlockCustomerAccess() {
            const pw = document.getElementById('lockedPasswordInput').value;
            const pwHash = await hashPassword(pw);
            if (pwHash === DELETE_PASSWORD_HASH) {
                currentData.unlockedForSession = true;
                document.getElementById('accessDeniedOverlay').style.display = 'none';
                showToast('Ï†ëÍ∑ºÏù¥ ÌóàÏö©ÎêòÏóàÏäµÎãàÎã§', 'success');
                document.getElementById('lockedPasswordInput').value = '';
            } else {
                showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
            }
        }

        function showTrashModal() {
            if (!isMainAdmin()) {
                showToast('Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Ï†ëÍ∑º Í∞ÄÎä•Ìï©ÎãàÎã§', 'error');
                return;
            }
            const trashItems = customers.filter(c => c.status === 'trash');
            const listEl = document.getElementById('trashList');
            listEl.innerHTML = '';
            if (trashItems.length === 0) {
                listEl.innerHTML = '<div style="padding:20px; text-align:center; color:#86868b;">Ìú¥ÏßÄÌÜµÏù¥ ÎπÑÏóàÏäµÎãàÎã§</div>';
            } else {
                trashItems.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'trash-item';
                    div.innerHTML = `
                <div >
        <div style="font-weight:600;">${c.name || '(Ïù¥Î¶ÑÏóÜÏùå)'}</div>
        <div style="font-size:11px; color:#86868b;">
            ÏÇ≠Ï†ú: ${c.deletedAt?.split('T')[0] || '-'}(${c.deletedBy || '?'})
        </div>
    </div>
                <div class="trash-actions">
                    <button onclick="restoreCustomer('${c.customerId}')"
                        style="padding:4px 8px; border:1px solid #ddd; background:#fff; border-radius:4px; font-size:11px; cursor:pointer;">Î≥µÏõê</button>
                    <button onclick="permanentDeleteCustomer('${c.customerId}')"
                        style="padding:4px 8px; border:1px solid #ff3b30; background:#ff3b30; color:#fff; border-radius:4px; font-size:11px; cursor:pointer;">ÏòÅÍµ¨ÏÇ≠Ï†ú</button>
                </div>
            `;
                    listEl.appendChild(div);
                });
            }
            document.getElementById('trashModal').classList.add('show');
        }

        function closeTrashModal() {
            document.getElementById('trashModal').classList.remove('show');
        }

        function restoreCustomer(id) {
            const index = customers.findIndex(c => c.customerId === id);
            if (index !== -1) {
                customers[index].status = 'consulting';
                delete customers[index].deletedAt;
                delete customers[index].deletedBy;
                saveCustomers();
                showToast('Í≥†Í∞ùÏù¥ Î≥µÏõêÎêòÏóàÏäµÎãàÎã§', 'success');
                showTrashModal();
                updateCustomerList();
            }
        }

        function permanentDeleteCustomer(id) {
            if (!confirm('Ï†ïÎßêÎ°ú ÏòÅÍµ¨ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) return;
            const index = customers.findIndex(c => c.customerId === id);
            if (index !== -1) {
                customers.splice(index, 1);
                saveCustomers();
                showToast('ÏòÅÍµ¨ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§', 'success');
                showTrashModal();
            }
        }

        function canWrite() {
            return currentAdmin !== null;
        }

        function canManageAdmins() {
            return currentAdmin?.role === 'main';
        }

        // Google Sheets GAS URL


        // Í¥ÄÎ¶¨Ïûê Î™®Îã¨ ÌëúÏãú
        function showAdminModal() {
            document.getElementById('adminModal').classList.add('show');
            document.getElementById('adminId').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminId').focus();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').classList.remove('show');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
        }

        // ÏÇ≠Ï†ú ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ ÌëúÏãú
        function showDeletePasswordModal(callback) {
            window.pendingDeleteCallback = callback;
            document.getElementById('deletePasswordModal').classList.add('show');
            document.getElementById('deletePassword').value = '';
            document.getElementById('deletePassword').focus();
        }

        function closeDeletePasswordModal() {
            document.getElementById('deletePasswordModal').classList.remove('show');
            window.pendingDeleteCallback = null;
        }

        async function confirmDeletePassword() {
            const inputPw = document.getElementById('deletePassword').value;
            const pwHash = await hashPassword(inputPw);
            if (pwHash === DELETE_PASSWORD_HASH) {
                closeDeletePasswordModal();
                if (window.pendingDeleteCallback) {
                    window.pendingDeleteCallback();
                }
            } else {
                showToast('ÏÇ≠Ï†ú ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§', 'error');
                document.getElementById('deletePassword').value = '';
                document.getElementById('deletePassword').focus();
            }
        }

        // Í¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨ Î™®Îã¨
        function showAdminManagerModal() {
            if (!isMainAdmin()) {
                showToast('Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Ï†ëÍ∑º Í∞ÄÎä•Ìï©ÎãàÎã§', 'error');
                return;
            }
            document.getElementById('adminManagerModal').classList.add('show');
            renderRegularAdminList();
        }

        function closeAdminManagerModal() {
            document.getElementById('adminManagerModal').classList.remove('show');
        }

        function renderRegularAdminList() {
            const admins = getRegularAdmins();
            const container = document.getElementById('regularAdminList');
            if (admins.length === 0) {
                container.innerHTML = '<div style="color:#86868b;text-align:center;padding:20px;">Îì±Î°ùÎêú ÏùºÎ∞òÍ¥ÄÎ¶¨ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
            } else {
                container.innerHTML = admins.map((admin, i) => `
                <div
            style = "display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #e8e8ed;" >
        <span>üë§ ${admin.id}</span>
        <button class="btn btn-secondary btn-sm" onclick="removeRegularAdmin(${i})" style="color:#ff3b30;">ÏÇ≠Ï†ú</button>
    </div>
                `).join('');
            }
        }

        async function addRegularAdmin() {
            const id = document.getElementById('newAdminId').value.trim();
            const pw = document.getElementById('newAdminPw').value;

            if (!id || !pw) {
                showToast('ÏïÑÏù¥ÎîîÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            // Î©îÏù∏Í¥ÄÎ¶¨Ïûê ID Ï§ëÎ≥µ Ï≤¥ÌÅ¨ (Î≥µÏàò Í¥ÄÎ¶¨Ïûê ÏßÄÏõê)
            if (MAIN_ADMINS.some(admin => admin.id === id)) {
                showToast('Î©îÏù∏Í¥ÄÎ¶¨Ïûê IDÎäî ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }

            const admins = getRegularAdmins();
            if (admins.some(a => a.id === id)) {
                showToast('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÏïÑÏù¥ÎîîÏûÖÎãàÎã§', 'error');
                return;
            }

            // ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ìï¥ÏãúÎ°ú Î≥ÄÌôòÌïòÏó¨ Ï†ÄÏû•
            const pwHash = await hashPassword(pw);
            const newAdmin = {
                id,
                passwordHash: pwHash,  // Ìï¥ÏãúÍ∞í Ï†ÄÏû• (ÏõêÎ≥∏ ÎπÑÎ∞ÄÎ≤àÌò∏ Ï†ÄÏû• Ïïà Ìï®)
                name: id,
                createdAt: new Date().toISOString()
            };

            admins.push(newAdmin);
            saveRegularAdmins(admins);

            // ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî
            syncAdminToCloud(newAdmin);

            document.getElementById('newAdminId').value = '';
            document.getElementById('newAdminPw').value = '';
            renderRegularAdminList();
            showToast(`ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê '${id}' Ï∂îÍ∞ÄÎê®(ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî)`, 'success');
        }

        async function removeRegularAdmin(index) {
            if (!confirm('Ïù¥ Í¥ÄÎ¶¨ÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            const admins = getRegularAdmins();
            const removed = admins.splice(index, 1)[0];
            saveRegularAdmins(admins);

            // ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑúÎèÑ ÏÇ≠Ï†ú
            deleteAdminFromCloud(removed.id);

            renderRegularAdminList();
            showToast(`Í¥ÄÎ¶¨Ïûê '${removed.id}' ÏÇ≠Ï†úÎê®(ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî)`, 'success');
        }


        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
        async function loginAdmin() {
            const inputId = document.getElementById('adminId').value.trim();
            const inputPw = document.getElementById('adminPassword').value;
            const inputHash = await hashPassword(inputPw);

            // Î©îÏù∏Í¥ÄÎ¶¨Ïûê ÌôïÏù∏ (Ìï¥Ïãú ÎπÑÍµê) - Î≥µÏàò Í¥ÄÎ¶¨Ïûê ÏßÄÏõê
            const mainAdmin = MAIN_ADMINS.find(admin => admin.id === inputId && admin.passwordHash === inputHash);
            if (mainAdmin) {
                currentAdmin = { id: mainAdmin.id, role: 'main', name: mainAdmin.name };
                closeAdminModal();
                activateAdminMode();
                showToast(`${mainAdmin.name}Î°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§`, 'success');
                return;
            }

            // ÏùºÎ∞òÍ¥ÄÎ¶¨Ïûê ÌôïÏù∏ (Ìï¥Ïãú ÎπÑÍµê)
            const admins = getRegularAdmins();
            const found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);
            if (found) {
                currentAdmin = { id: found.id, role: 'regular' };
                closeAdminModal();
                activateAdminMode();
                showToast('Í¥ÄÎ¶¨ÏûêÎ°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§', 'success');
                return;
            }

            showToast('ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§', 'error');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').focus();
        }

        // Í¥ÄÎ¶¨Ïûê Î™®Îìú ÌôúÏÑ±Ìôî
        function activateAdminMode() {
            const roleLabel = isMainAdmin() ? 'üîë Î©îÏù∏Í¥ÄÎ¶¨Ïûê' : 'üë§ Í¥ÄÎ¶¨Ïûê';
            const adminId = currentAdmin?.id || '';

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('adminBadge').className = 'admin-badge admin';
            document.getElementById('adminBadge').innerHTML = `${roleLabel}: ${adminId} `;

            let statusHTML = `
                <span class="admin-badge admin" id = "adminBadge" > ${roleLabel}: ${adminId}</span>
                    <button class="admin-login-btn" onclick="logoutAdmin()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            `;

            // Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Í¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨ Î≤ÑÌäº ÌëúÏãú
            if (isMainAdmin()) {
                statusHTML += `<button class="admin-login-btn" onclick = "showAdminManagerModal()" style = "margin-left:5px;" >üë• Í¥ÄÎ¶¨Ïûê
        Í¥ÄÎ¶¨</button> `;
            }

            document.getElementById('adminStatus').innerHTML = statusHTML;

            // Ìú¥ÏßÄÌÜµ Î≤ÑÌäº (Î©îÏù∏Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
            const trashBtn = document.getElementById('trashBtn');
            if (trashBtn) {
                trashBtn.style.display = isMainAdmin() ? 'flex' : 'none';
            }

            // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïû†Í∏à Ìï¥Ï†ú
            document.getElementById('costLockOverlay').style.display = 'none';
            document.getElementById('costCategoriesWrapper').classList.remove('cost-locked');
            document.getElementById('adminSettings').style.display = 'block';

            // Ïó≠Ìï†Ïóê Îî∞Î•∏ ÌÉ≠ Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            updateTabVisibility();
        }

        // Ïó≠Ìï†Ïóê Îî∞Î•∏ ÌÉ≠ Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
        function updateTabVisibility() {
            const mainOnly = isMainAdmin();

            // Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Î≥º Ïàò ÏûàÎäî ÌÉ≠ Ï≤òÎ¶¨ (ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú, ÌÜµÍ≥Ñ)
            document.querySelectorAll('.customer-tab[data-main-only="true"]').forEach(tab => {
                tab.style.display = mainOnly ? '' : 'none';
            });

            // ÌÜµÍ≥Ñ Ìå®ÎÑêÎèÑ Ïà®Í∏∞Í∏∞
            const statsPanel = document.getElementById('panel-stats');
            if (statsPanel) {
                statsPanel.style.display = mainOnly ? '' : 'none';
            }

            // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ìå®ÎÑêÎèÑ Ïà®Í∏∞Í∏∞
            const costPanel = document.getElementById('panel-cost');
            if (costPanel) {
                costPanel.style.display = mainOnly ? '' : 'none';
            }

            // ÏùºÎ∞òÍ¥ÄÎ¶¨ÏûêÍ∞Ä Ïà®Í≤®ÏßÑ ÌÉ≠ÏùÑ Î≥¥Í≥† ÏûàÎã§Î©¥ Í≥†Í∞ùÏ†ïÎ≥¥ ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
            if (!mainOnly) {
                const activeTab = document.querySelector('.customer-tab.active');
                if (activeTab && activeTab.dataset.mainOnly === 'true') {
                    showCustomerTab('info');
                }
            }
        }

        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏ÏïÑÏõÉ
        function logoutAdmin() {
            currentAdmin = null;

            // Í∏∞Í∏∞ Ïã†Î¢∞ Ìï¥Ï†ú (Ï†ïÏ±Ö: Î°úÍ∑∏ÏïÑÏõÉ Ïãú Í∏∞Í∏∞ Ïã†Î¢∞ Ìï¥Ï†ú)
            localStorage.removeItem(DEVICE_TRUST_KEY);

            // Î°úÍ∑∏Ïù∏ Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú (ID/PW Î°úÍ∑∏Ïù∏ ÌôîÎ©¥)
            const overlay = document.getElementById('loginOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                showLoginView('idpw');
            }

            // UI Ï¥àÍ∏∞Ìôî (ÌïÑÏöîÏãú)
            document.getElementById('adminStatus').innerHTML = '';

            // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïû†Í∏à
            document.getElementById('costLockOverlay').style.display = 'flex';
            document.getElementById('costCategoriesWrapper').classList.add('cost-locked');
            document.getElementById('adminSettings').style.display = 'none';

            // ÌÉ≠ Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            updateTabVisibility();

            showToast('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§. Í∏∞Í∏∞ Ïã†Î¢∞Í∞Ä Ìï¥Ï†úÎê©ÎãàÎã§.', 'success');
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω (Í∏∞Îä• ÎπÑÌôúÏÑ±Ìôî)
        function changeAdminPassword() {
            showToast('ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤ΩÏùÄ Í¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨ Î©îÎâ¥ÏóêÏÑú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
        }

        // Í¥ÄÎ¶¨Ïûê Î™®Îìú Ï≤¥ÌÅ¨ (Ï†ÄÏû• Ïãú)
        function checkAdminForSave() {
            if (!isLoggedIn()) {
                // ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎäî Ï†ÄÏû•ÌïòÏßÄ ÏïäÏùå (Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Ïù¥ÎØÄÎ°ú)
                return false;
            }
            return true;
        }

        // Ïû†Í∏à ÏÉÅÌÉú Ï≤¥ÌÅ¨
        // Ïû†Í∏à UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateLockUI() {
            const lockBtn = document.getElementById('lockToggleBtn');
            const createdBySpan = document.getElementById('headerCreatedBy');

            if (lockBtn) {
                const isLocked = currentData && currentData.isLocked;
                lockBtn.className = 'lock-toggle-btn ' + (isLocked ? 'locked' : 'unlocked');
                lockBtn.innerHTML = isLocked ? 'üîí Ïû†Í∏à' : 'üîì Ïó¥Î¶º';
                lockBtn.title = isLocked ? 'Ïû†Í∏à Ìï¥Ï†ú' : 'Ïû†Í∏à ÏÑ§Ï†ï';
            }

            if (createdBySpan) {
                createdBySpan.textContent = `üìù ${currentData?.createdBy || '-'} `;
            }
        }

        // Ïû†Í∏à ÌÜ†Í∏Ä
        function toggleCustomerLock() {
            if (!currentCustomerId) return;

            // Only Main Admin can toggle
            if (!isMainAdmin()) {
                showToast('Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Ïû†Í∏à ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }

            currentData.isLocked = !currentData.isLocked;
            // Clear session unlock if re-locking
            if (currentData.isLocked) {
                delete currentData.unlockedForSession;
            }

            // Sync back to customers array
            const idx = customers.findIndex(c => c.customerId === currentCustomerId);
            if (idx !== -1) {
                customers[idx].isLocked = currentData.isLocked;
            }

            saveCustomers();
            updateLockUI();
            showToast(currentData.isLocked ? 'Í≥†Í∞ù Ï†ïÎ≥¥Í∞Ä Ïû†Í∏à Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§' : 'Ïû†Í∏àÏù¥ Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§', 'success');
        }


        // ÏÑ§Ï†ï Ìå®ÎÑê ÌÜ†Í∏Ä
        function toggleSettingsPanel(event) {
            if (event) event.stopPropagation();
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        // (ÏÑ§Ï†ï Ìå®ÎÑêÏùÄ ÌÜ±ÎãàÎ∞îÌÄ¥ ÌÅ¥Î¶≠ÏúºÎ°úÎßå Ïó¥Í≥† Îã´Ïùå - Ïô∏Î∂Ä ÌÅ¥Î¶≠ÏúºÎ°ú Îã´ÏßÄ ÏïäÏùå)

        // Í∏ÄÏî® ÌÅ¨Í∏∞ Ï°∞Ï†à
        function changeFontSize(size) {
            document.documentElement.style.setProperty('--font-size-base', size + 'px');
            document.getElementById('fontSizeValue').textContent = size + 'px';
            localStorage.setItem('DJ_fontsize', size);
            document.body.style.fontSize = size + 'px';
        }

        // ÏòÅÏó≠Î≥Ñ Í∏ÄÏî® ÌÅ¨Í∏∞ Ï°∞Ï†à (Î™®Îì† ÌÉ≠ Ï†ÅÏö©)
        function changePartFontSize(part, size) {
            const s = size + 'px';
            document.getElementById('fs' + part.charAt(0).toUpperCase() + part.slice(1) + 'Val').textContent = s;
            switch (part) {
                case 'catHeader':
                    // Í≤¨Ï†ÅÏÑú + ÏõêÍ∞ÄÍ¥ÄÎ¶¨ Ïπ¥ÌÖåÍ≥†Î¶¨ Ìó§Îçî (div + h3 Î™®Îëê)
                    document.querySelectorAll('.category-header').forEach(h => h.style.fontSize = s);
                    document.querySelectorAll('.category-header h3').forEach(h => h.style.fontSize = s);
                    document.querySelectorAll('.category-header .subtotal').forEach(h => h.style.fontSize = s);
                    // Î¨∏ÏÑú ÏÑπÏÖò ÌÉÄÏù¥ÌãÄ
                    document.querySelectorAll('.section-title').forEach(h => h.style.fontSize = s);
                    break;
                case 'colHeader':
                    // Î™®Îì† ÌÖåÏù¥Î∏î thead
                    document.querySelectorAll('.estimate-table thead th, .data-table thead th, .summary-table thead th').forEach(th => th.style.fontSize = s);
                    break;
                case 'content':
                    // Î™®Îì† ÌÖåÏù¥Î∏î tbody
                    document.querySelectorAll('.estimate-table tbody td, .data-table tbody td, .summary-table tbody td').forEach(td => td.style.fontSize = s);
                    document.querySelectorAll('.estimate-table tbody input, .estimate-table tbody select, .estimate-table tbody textarea, .data-table tbody input, .data-table tbody select').forEach(el => el.style.fontSize = s);
                    // Î¨∏ÏÑú ÎÇ¥ info-item, clause, sig-field Îì±
                    document.querySelectorAll('.info-item input, .info-item select, .info-item span, .clause-content, .sig-field input').forEach(el => el.style.fontSize = s);
                    break;
                case 'memo':
                    document.querySelectorAll('.estimate-memo, .estimate-memo textarea, .estimate-memo .memo-content, .category-memo, .category-memo textarea, .special-note textarea').forEach(el => el.style.fontSize = s);
                    break;
            }
            localStorage.setItem('DJ_fs_' + part, size);
        }

        function loadPartFontSizes() {
            ['catHeader', 'colHeader', 'content', 'memo'].forEach(part => {
                const defaults = { catHeader: '13', colHeader: '10', content: '11', memo: '11' };
                const saved = localStorage.getItem('DJ_fs_' + part) || defaults[part];
                const sliderId = 'fs' + part.charAt(0).toUpperCase() + part.slice(1);
                const slider = document.getElementById(sliderId);
                if (slider) {
                    slider.value = saved;
                    changePartFontSize(part, saved);
                }
            });
        }

        function loadFontSize() {
            const savedSize = localStorage.getItem('DJ_fontsize') || '12';
            document.getElementById('fontSizeSlider').value = savedSize;
            document.getElementById('fontSizeValue').textContent = savedSize + 'px';
            document.documentElement.style.setProperty('--font-size-base', savedSize + 'px');
        }

        // ===== ÌÖçÏä§Ìä∏ ÏÑúÏãù (ÎìúÎûòÍ∑∏ ÏÑ†ÌÉù ÌõÑ ÏÉâÏÉÅ/Î∞ëÏ§Ñ/Ï∑®ÏÜåÏÑ†) =====
        let savedSelection = null;

        function applyTextFormat(type, value) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (!savedSelection) { toolbar.classList.remove('show'); return; }

            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(savedSelection);

            try {
                if (type === 'clear' || type === 'removeFormat') {
                    // ÏÑúÏãù Ï†úÍ±∞: ÏÑ†ÌÉù ÏòÅÏó≠Ïùò format span ÌíÄÍ∏∞
                    const range = savedSelection;
                    const container = range.commonAncestorContainer;
                    const parent = container.nodeType === 3 ? container.parentElement : container;
                    // execCommand ÏãúÎèÑ (contenteditable ÎÇ¥ÏóêÏÑúÎßå ÏûëÎèô)
                    if (parent.closest('[contenteditable="true"]')) {
                        document.execCommand('removeFormat', false, null);

                        // ÏÑúÏãù Ï†úÍ±∞ ÌõÑÏóêÎèÑ ÏÑ†ÌÉù ÏòÅÏó≠ Ïú†ÏßÄ ÏãúÎèÑ
                        savedSelection = window.getSelection().getRangeAt(0).cloneRange();
                    } else {
                        // ÏàòÎèô ÏÑúÏãù Ï†úÍ±∞
                        const fragment = range.extractContents();
                        const tempDiv = document.createElement('div');
                        tempDiv.appendChild(fragment);
                        const plainText = tempDiv.textContent;
                        const textNode = document.createTextNode(plainText);
                        range.insertNode(textNode);

                        // ÏÑ†ÌÉù ÏòÅÏó≠ Ïû¨ÏÑ§Ï†ï (ÌÖçÏä§Ìä∏ ÎÖ∏Îìú Ï†ÑÏ≤¥ ÏÑ†ÌÉù)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(textNode);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    }
                } else {
                    // Ïä§ÌÉÄÏùº span Í∞êÏã∏Í∏∞ (execCommand ÏóÜÏù¥ ÏûëÎèô)
                    const range = savedSelection;
                    const span = document.createElement('span');
                    if (type === 'color') {
                        span.style.color = value;
                    } else if (type === 'underline') {
                        span.style.textDecoration = 'underline';
                    } else if (type === 'strikethrough') {
                        span.style.textDecoration = 'line-through';
                    } else if (type === 'bold') {
                        span.style.fontWeight = '700';
                    } else if (type === 'italic') {
                        span.style.fontStyle = 'italic';
                    }
                    try {
                        range.surroundContents(span);

                        // ÏÑúÏãù Ï†ÅÏö© ÌõÑ ÏÑ†ÌÉù ÏòÅÏó≠ Ïú†ÏßÄ (span ÎÇ¥Ïö© Îã§Ïãú ÏÑ†ÌÉù)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(span);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    } catch (e) {
                        // Îã§Ï§ë ÎÖ∏Îìú ÏÑ†ÌÉù Ïãú extractContents ÏÇ¨Ïö©
                        const fragment = range.extractContents();
                        span.appendChild(fragment);
                        range.insertNode(span);

                        // ÏÑ†ÌÉù ÏòÅÏó≠ Ïú†ÏßÄ (span ÎÇ¥Ïö© Îã§Ïãú ÏÑ†ÌÉù)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(span);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    }
                }
            } catch (e) { console.warn('ÌÖçÏä§Ìä∏ ÏÑúÏãù Ï†ÅÏö© Ïã§Ìå®:', e); }

            // Ìà¥Î∞î Ïà®ÍπÄ Î∞©ÏßÄ (Ïó∞ÏÜç ÏÑúÏãù Ï†ÅÏö©ÏùÑ ÏúÑÌï¥ Ïú†ÏßÄ)
            // toolbar.classList.remove('show'); 
            // savedSelection = null; 

            saveEstimateData();
        }

        // mouseup Ïãú ÏÑ†ÌÉù ÏòÅÏó≠ ÌôïÏù∏ ÌõÑ Ìà¥Î∞î ÌëúÏãú (Î™®Îì† ÌÉ≠ÏóêÏÑú ÏûëÎèô, Î™®Î∞îÏùº Ï†úÏô∏)
        document.addEventListener('mouseup', function (e) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (!toolbar) return;

            // Î™®Î∞îÏùº(ÌÑ∞Ïπò ÎîîÎ∞îÏù¥Ïä§)ÏóêÏÑúÎäî ÏÑúÏãù Ìà¥Î∞î ÎπÑÌôúÏÑ±Ìôî
            const isMobile = /android|ipad|iphone|ipod/i.test(navigator.userAgent) || window.innerWidth <= 768;
            if (isMobile) return;

            // Ìà¥Î∞î ÎòêÎäî ÏÑ§Ï†ï Ìå®ÎÑê ÌÅ¥Î¶≠ Ïãú Î¨¥Ïãú
            if (toolbar.contains(e.target)) return;
            if (e.target.closest('.settings-panel')) return;

            setTimeout(() => {
                const sel = window.getSelection();
                if (!sel || sel.isCollapsed || !sel.toString().trim()) {
                    toolbar.classList.remove('show');
                    savedSelection = null;
                    return;
                }

                // ÏÑ†ÌÉùÎêú ÌÖçÏä§Ìä∏Ïùò ÏúÑÏπò ÌôïÏù∏
                const anchorNode = sel.anchorNode;
                const parentEl = anchorNode?.nodeType === 3 ? anchorNode.parentElement : anchorNode;

                // text-formattable ÌÅ¥ÎûòÏä§Í∞Ä ÏûàÎäî ÏòÅÏó≠(ÏÇ¨Ïö©Ïûê Ìé∏Ïßë Í∞ÄÎä• ÏòÅÏó≠)ÏóêÏÑúÎßå ÏÑúÏãù Ï†ÅÏö© Í∞ÄÎä•
                const isFormattableArea = parentEl?.closest('.text-formattable');

                // ÏûÖÎ†• ÌïÑÎìú, Î™®Îã¨, Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ÏóêÏÑúÎäî ÏÑúÏãù Ï†ÅÏö© Î∂àÍ∞Ä
                const isFormElement = parentEl?.closest('input, select, textarea');
                const isModalArea = parentEl?.closest('.modal, .login-overlay, #loginOverlay, #initialSyncOverlay');

                // Ìé∏Ïßë Í∞ÄÎä• ÏòÅÏó≠Ïù¥ ÏïÑÎãàÍ±∞ÎÇò Ï†úÏô∏ ÏòÅÏó≠Ïù∏ Í≤ΩÏö∞ Ìà¥Î∞î Ïà®ÍπÄ
                if (!isFormattableArea || isFormElement || isModalArea) {
                    toolbar.classList.remove('show');
                    savedSelection = null;
                    return;
                }

                savedSelection = sel.getRangeAt(0).cloneRange();

                const rect = sel.getRangeAt(0).getBoundingClientRect();
                let left = rect.left + rect.width / 2 - 110;
                let top = rect.top - 44;
                if (top < 10) top = rect.bottom + 8;
                if (left < 5) left = 5;
                if (left + 240 > window.innerWidth) left = window.innerWidth - 250;

                toolbar.style.left = left + 'px';
                toolbar.style.top = top + 'px';
                toolbar.classList.add('show');
                console.log('ÏÑúÏãù Ìà¥Î∞î ÌëúÏãú:', sel.toString());
            }, 10);
        });

        // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú Ìà¥Î∞î Ïà®Í∏∞Í∏∞
        document.addEventListener('mousedown', function (e) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (toolbar && !toolbar.contains(e.target) && !e.target.closest('.settings-panel')) {
                toolbar.classList.remove('show');
            }
        });

        document.addEventListener('DOMContentLoaded', async function () {
            // UI Ï¥àÍ∏∞Ìôî
            initLoginScreen();
            loadFontSize();
            loadPartFontSizes();
            createCostCategories();
            createEstimateCategories();
            createCoverTable();
            initYearFilter();
            updateCustomerList();

            const statusEl = document.getElementById('initialSyncStatus');
            const overlay = document.getElementById('initialSyncOverlay');

            try {
                const syncStartTime = performance.now();
                statusEl.textContent = 'Í≥†Í∞ù Î∞è Í¥ÄÎ¶¨Ïûê Îç∞Ïù¥ÌÑ∞Î•º ÎèôÍ∏∞Ìôî Ï§ë...';

                // [Phase 1] ÌïÑÏàò Îç∞Ïù¥ÌÑ∞Îßå Î®ºÏ†Ä ÎèôÍ∏∞Ìôî (Í≥†Í∞ù + Í¥ÄÎ¶¨Ïûê)
                const criticalResults = await Promise.allSettled([
                    syncFromCloud(true),      // Í≥†Í∞ù
                    syncAdminsFromCloud()     // Í¥ÄÎ¶¨Ïûê
                ]);

                const criticalSuccess = (criticalResults[0].status === 'fulfilled' && criticalResults[0].value === true) &&
                    (criticalResults[1].status === 'fulfilled' && criticalResults[1].value === true);

                if (criticalSuccess) {
                    const phase1Time = Math.round(performance.now() - syncStartTime);
                    console.log(`‚úÖ [Phase 1] ÌïÑÏàò ÎèôÍ∏∞Ìôî ÏôÑÎ£å (${phase1Time}ms)`);

                    // ÎèôÍ∏∞Ìôî ÏÑ±Í≥µ Ïãú ÌÅ¥Î¶∞ÏóÖ Ïã§Ìñâ
                    runPhase2Cleanup();

                    // Ïò§Î≤ÑÎ†àÏù¥ Ï¶âÏãú Ï†úÍ±∞ (Îπ†Î•∏ Ï†ÑÌôò)
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 300);

                    // [Phase 2] ÎπÑÌïÑÏàò Îç∞Ïù¥ÌÑ∞Îäî Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî (UI Ï∞®Îã® ÏóÜÏùå)
                    Promise.allSettled([
                        syncCostFromCloud(),      // ÏõêÍ∞Ä
                        syncChecklistFromCloud(), // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                        syncExpensesFromCloud()   // Ïö¥ÏòÅÎπÑ
                    ]).then(bgResults => {
                        const phase2Time = Math.round(performance.now() - syncStartTime);
                        const bgLabels = ['ÏõêÍ∞Ä', 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', 'Ïö¥ÏòÅÎπÑ'];
                        bgResults.forEach((r, i) => {
                            if (r.status !== 'fulfilled' || r.value !== true) {
                                console.warn(`‚ö†Ô∏è [Phase 2] ${bgLabels[i]} Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî Ïã§Ìå® (Ïï± Ïã§Ìñâ Í≥ÑÏÜç)`);
                            }
                        });
                        console.log(`‚úÖ [Phase 2] Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî ÏôÑÎ£å (Ï¥ù ${phase2Time}ms)`);

                        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ (Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî ÌõÑ)
                        if (typeof renderChecklistItems === 'function') {
                            renderChecklistItems();
                            if (typeof updateChecklistFilters === 'function') updateChecklistFilters();
                        }
                    });

                } else {
                    // ÌïÑÏàò Îç∞Ïù¥ÌÑ∞ Ïã§Ìå® Ïãú ÏóêÎü¨ Ï≤òÎ¶¨
                    const failedLabels = [];
                    if (criticalResults[0].status !== 'fulfilled' || criticalResults[0].value !== true) failedLabels.push('Í≥†Í∞ù');
                    if (criticalResults[1].status !== 'fulfilled' || criticalResults[1].value !== true) failedLabels.push('Í¥ÄÎ¶¨Ïûê');
                    throw new Error(`${failedLabels.join(', ')} ÌïÑÏàò Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.`);
                }

                // Î∂ÄÍ∞Ä Î°úÏßÅ (Phase 1 ÏôÑÎ£å ÌõÑ Ï¶âÏãú Ïã§Ìñâ)
                fetchScheduleTemplate();
                fetchSettlementMaster();

            } catch (err) {
                console.error('‚ùå Ï¥àÍ∏∞ ÎèôÍ∏∞Ìôî Ïã§Ìå®:', err);
                // ÏóêÎü¨ ÌôîÎ©¥ ÌëúÏãú
                document.querySelector('.sync-loader').style.display = 'none';
                document.getElementById('syncErrorContent').style.display = 'block';
                document.getElementById('syncErrorMessage').textContent = err.message + ' ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ ÌôïÏù∏ ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.';
            }
        });

        // ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º
        let toastTimer = null;
        function showToast(message, type = 'success', duration = 2000) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');

            if (toastTimer) clearTimeout(toastTimer);

            toast.className = 'toast show ' + type;
            icon.textContent = type === 'success' ? '‚úì' : (type === 'info' ? '‚ÑπÔ∏è' : '‚úï');
            msg.innerHTML = message; // [Î≥ÄÍ≤Ω] Ï§ÑÎ∞îÍøà ÏßÄÏõêÏùÑ ÏúÑÌï¥ innerHTML ÏÇ¨Ïö©

            toastTimer = setTimeout(() => { toast.classList.remove('show'); }, duration);
        }

        // Ï†ÄÏû• ÌôïÏù∏ ÌÜ†Ïä§Ìä∏ (Ïö∞Ï∏°ÏÉÅÎã®, ÏßßÏùÄ ÌëúÏãú)
        let saveToastTimer = null;
        function showSaveConfirmToast(message) {
            let saveToast = document.getElementById('saveConfirmToast');
            if (!saveToast) {
                saveToast = document.createElement('div');
                saveToast.id = 'saveConfirmToast';
                saveToast.style.cssText = `
                    position: fixed; top: 20px; right: 20px;
                    background: linear-gradient(135deg, #34c759, #28a745);
                    color: #fff; padding: 12px 24px; border-radius: 12px;
                    font-size: 14px; font-weight: 600; z-index: 99999;
                    display: none; align-items: center; gap: 8px;
                    box-shadow: 0 8px 30px rgba(52, 199, 89, 0.4);
                    animation: slideInSaveToast 0.3s ease;
                    transition: opacity 0.3s ease;
                `;
                document.body.appendChild(saveToast);

                // Ïï†ÎãàÎ©îÏù¥ÏÖò ÌÇ§ÌîÑÎ†àÏûÑ Ï∂îÍ∞Ä
                if (!document.getElementById('saveToastKeyframes')) {
                    const style = document.createElement('style');
                    style.id = 'saveToastKeyframes';
                    style.textContent = `
                        @keyframes slideInSaveToast {
                            from { transform: translateX(100px); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            if (saveToastTimer) clearTimeout(saveToastTimer);
            saveToast.innerHTML = message;
            saveToast.style.display = 'flex';
            saveToast.style.opacity = '1';
            saveToastTimer = setTimeout(() => {
                saveToast.style.opacity = '0';
                setTimeout(() => { saveToast.style.display = 'none'; }, 300);
            }, 1500);
        }

        // ÏÉÅÌÉú ÌïÑÌÑ∞
        function setStatusFilter(status) {
            currentStatusFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.status === status);
            });
            updateCustomerList();
        }

        // Cost Tab Security
        const COST_ACCESS_PIN = '6454';
        let isCostUnlocked = false;

        function showCustomerTab(tabId) {
            // [SECURITY CHECK] Cost Management Tab
            // Î©îÏù∏Í¥ÄÎ¶¨Ïûê(isMainAdmin)Îäî Ìå®Ïä§; ÏùºÎ∞òÍ¥ÄÎ¶¨ÏûêÎßå ÎπÑÎ∞ÄÎ≤àÌò∏ Ï≤¥ÌÅ¨
            if (tabId === 'cost' && !isMainAdmin() && !isCostUnlocked) {
                // If not unlocked, show password modal and STOP.
                document.getElementById('costPasswordModal').classList.add('show');
                document.getElementById('costAccessPin').value = '';
                document.getElementById('costAccessPin').focus();
                return;
            }

            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.customer-tab').forEach(t => t.classList.remove('active'));

            const panel = document.getElementById('panel-' + tabId);
            if (panel) panel.classList.add('active');

            // Find the button and add active class
            const buttons = document.querySelectorAll('.customer-tab');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(`'${tabId}'`)) {
                    btn.classList.add('active');
                }
            });

            syncAllFields();
            if (tabId === 'estimate') updateEstimateFromCost();
            if (tabId === 'schedule') loadScheduleForCustomer();
            if (tabId === 'as_list') loadASList();
            if (tabId === 'settlement') {
                if (typeof renderSettlementTable === 'function') renderSettlementTable();
            }
            if (tabId === 'expenses') {
                if (typeof renderExpensesTable === 'function') renderExpensesTable();
            }
            if (tabId === 'stats') {
                if (typeof renderProfitAnalysis === 'function') renderProfitAnalysis();
            }
            if (tabId === 'dashboard') {
                if (typeof renderDashboard === 'function') renderDashboard();
            }
        }

        function renderDashboard() {
            // 1. Profile - ÌòÑÏû•Î™Ö
            document.getElementById('dashName').innerText = document.getElementById('headerCustomerName').innerText;
            const name = document.getElementById('headerCustomerName').innerText;
            document.getElementById('dashAvatar').innerText = name ? name.charAt(0) : '?';

            // Í≥†Í∞ù Ïó∞ÎùΩÏ≤ò ÌëúÏãú: ÏÑ±Î™Ö(Ïó∞ÎùΩÏ≤ò) | Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö(Î∞∞Ïö∞Ïûê Ïó∞ÎùΩÏ≤ò)
            const customerName = currentData.name || currentData.clientName || '';
            const customerPhone = currentData.phone || currentData.clientPhone || '';
            const spouseName = currentData.spouseName || '';
            const spousePhone = currentData.spousePhone || '';

            let contactDisplay = '';
            if (customerName) {
                contactDisplay = customerName;
                if (customerPhone) contactDisplay += `(${customerPhone})`;
            }
            if (spouseName) {
                if (contactDisplay) contactDisplay += ' | ';
                contactDisplay += spouseName;
                if (spousePhone) contactDisplay += `(${spousePhone})`;
            }
            document.getElementById('dashPhone').innerText = contactDisplay || '-';

            const fieldAddress = document.querySelector('.customer-field[data-field="siteAddress"]');
            if (fieldAddress) document.getElementById('dashAddress').innerText = fieldAddress.value || '-';

            const fieldArea = document.querySelector('.customer-field[data-field="area"]');
            const fieldType = document.querySelector('.customer-field[data-field="buildingType"]');
            let areaType = [];
            if (fieldArea && fieldArea.value) areaType.push(fieldArea.value);
            if (fieldType && fieldType.value) areaType.push(fieldType.value);
            document.getElementById('dashAreaType').innerText = areaType.length > 0 ? areaType.join(' / ') : '-';

            // Í≥ÑÏïΩÏùº
            const contractDate = currentData.contractDate || '';
            document.getElementById('dashContractDate').innerText = contractDate || '-';

            // Ï¥ù Í≥ÑÏïΩÍ∏àÏï° (VAT Ìè¨Ìï®)
            const totalAmountField = document.querySelector('.customer-field[data-field="totalAmount"]');
            const totalAmount = totalAmountField ? totalAmountField.value : (currentData.totalAmount || '');
            if (totalAmount) {
                const amountNum = parseInt(String(totalAmount).replace(/[^0-9]/g, '')) || 0;
                document.getElementById('dashContractAmount').innerText = amountNum.toLocaleString() + 'Ïõê';
            } else {
                document.getElementById('dashContractAmount').innerText = '-';
            }

            // 2. Status & Timeline
            const statusSelect = document.getElementById('customerStatus');
            const statusText = statusSelect.options[statusSelect.selectedIndex].text;
            const statusVal = statusSelect.value;
            // Remove emoji for badge
            let statusLabel = statusText.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2700}-\u{27BF}]|[\u{2600}-\u{26FF}]/gu, '').trim();

            // [New] A/S Period Check (ÏßÑÌñâÏÉÅÌô©Ïóê A/S Í∏∞Í∞Ñ ÌëúÏãú)
            if (statusVal === 'completed' || statusVal === 'as_done' || statusVal === 'contracted' || statusVal === 'in_progress') {
                const finalDateStr = currentData.finalPaymentDate || '';
                if (finalDateStr) {
                    const finalDate = new Date(finalDateStr);
                    const asEndDate = new Date(finalDate);
                    asEndDate.setFullYear(finalDate.getFullYear() + 1);
                    const today = new Date();
                    if (today >= finalDate && today <= asEndDate) {
                        statusLabel = "A/S Í∏∞Í∞Ñ Ï§ë";
                    }
                }
            }

            document.getElementById('dashStatusBadge').innerText = statusLabel;

            // Í≥µÏÇ¨ Í∏∞Í∞Ñ
            const start = document.getElementById('constructionStartInput').value;
            const end = document.getElementById('constructionEndInput').value;
            document.getElementById('dashPeriod').innerText = (start || '-') + ' ~ ' + (end || '-');

            // Ïù¥ÏÇ¨ÏòàÏ†ïÏùº
            const movingDate = currentData.movingDate || '';
            document.getElementById('dashMovingDate').innerText = movingDate || '-';

            // A/S Í∏∞Í∞Ñ (ÏûîÍ∏àÏùº + 12Í∞úÏõî)
            const finalDateStr = currentData.finalPaymentDate || '';
            if (finalDateStr) {
                const finalDate = new Date(finalDateStr);
                const asEndDate = new Date(finalDate);
                asEndDate.setFullYear(finalDate.getFullYear() + 1);
                const formattedStart = finalDate.toISOString().split('T')[0];
                const formattedEnd = asEndDate.toISOString().split('T')[0];
                document.getElementById('dashASPeriod').innerText = `${formattedStart} ~ ${formattedEnd}`;
            } else {
                document.getElementById('dashASPeriod').innerText = '-';
            }

            // ÌôîÏû•Ïã§ ÎàÑÏàò Î≥¥Ï¶ù Í∏∞Í∞Ñ (A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏ÏóêÏÑú Ïó∞Îèô)
            let bathroomWarranty = '-';
            if (typeof asListDB !== 'undefined' && asListDB.length > 0) {
                // A/S Î¶¨Ïä§Ìä∏ÏóêÏÑú 'ÌôîÏû•Ïã§' ÎòêÎäî 'ÎàÑÏàò' Í¥ÄÎ†® Ìï≠Î™© Ï∞æÍ∏∞
                const bathroomItem = asListDB.find(item =>
                    (item.category && (item.category.includes('ÌôîÏû•Ïã§') || item.category.includes('ÎàÑÏàò'))) ||
                    (item.name && (item.name.includes('ÌôîÏû•Ïã§') || item.name.includes('ÎàÑÏàò')))
                );
                if (bathroomItem && bathroomItem.warrantyPeriod) {
                    bathroomWarranty = bathroomItem.warrantyPeriod;
                } else if (bathroomItem && bathroomItem.asEndDate) {
                    bathroomWarranty = `~ ${bathroomItem.asEndDate}`;
                }
            }
            // Í∏∞Î≥∏Í∞í: ÏûîÍ∏àÏùº + 2ÎÖÑ (ÌôîÏû•Ïã§ ÎàÑÏàò Î≥¥Ï¶ù 24Í∞úÏõî)
            if (bathroomWarranty === '-' && finalDateStr) {
                const finalDate = new Date(finalDateStr);
                const warrantyEnd = new Date(finalDate);
                warrantyEnd.setFullYear(finalDate.getFullYear() + 2);
                bathroomWarranty = `~ ${warrantyEnd.toISOString().split('T')[0]} (2ÎÖÑ)`;
            }
            document.getElementById('dashBathroomWarranty').innerText = bathroomWarranty;

            // Update Timeline
            let progress = 0;
            document.querySelectorAll('.timeline-step').forEach(s => s.classList.remove('active'));
            let activeStepId = '';

            if (statusVal === 'consulting') { progress = 10; activeStepId = 'step-consulting'; }
            else if (statusVal === 'estimate') { progress = 25; activeStepId = 'step-consulting'; }
            else if (statusVal === 'contracted') { progress = 40; activeStepId = 'step-contract'; }
            else if (statusVal === 'in_progress') { progress = 70; activeStepId = 'step-construction'; }
            else if (statusVal === 'completed' || statusVal === 'as_done' || statusVal.includes('as_')) { progress = 100; activeStepId = 'step-completed'; }

            if (activeStepId) document.getElementById(activeStepId).classList.add('active');
            document.getElementById('dashProgressWidth').style.width = progress + '%';

            // 3. Cost Summary (Modified: Detail Breakdown & Per Pyeong)
            // Get Total Amount
            const totalAmtInput = document.querySelector('.customer-field[data-field="totalAmount"]');
            const totalAmtStr = totalAmtInput ? totalAmtInput.value.replace(/[^0-9]/g, '') : '0';
            const totalAmt = parseInt(totalAmtStr) || 0;

            // Area Calculation
            const areaStr = (currentData.area || '').toString().replace(/[^0-9.]/g, '');
            const area = parseFloat(areaStr) || 0;

            // 1. Total Amount Breakdown
            const totalSupply = Math.round(totalAmt / 1.1);
            const totalVat = totalAmt - totalSupply;

            document.getElementById('dashTotalAmount').innerText = totalAmt.toLocaleString() + 'Ïõê';
            if (document.getElementById('dashTotalSupply')) document.getElementById('dashTotalSupply').innerText = totalSupply.toLocaleString();
            if (document.getElementById('dashTotalVat')) document.getElementById('dashTotalVat').innerText = totalVat.toLocaleString();

            const totalPerPy = area > 0 ? Math.round(totalAmt / area) : 0;
            if (document.getElementById('dashTotalPerPy')) document.getElementById('dashTotalPerPy').innerText = totalPerPy.toLocaleString() + 'Ïõê';

            // 2. Total Expenditure (Cost)
            let totalCost = 0;
            if (currentData.settlementRows && currentData.settlementRows.length > 0) {
                currentData.settlementRows.forEach(row => {
                    const expense = parseInt((row.expense || '0').replace(/[^0-9]/g, '')) || 0;
                    totalCost += expense;
                });
            }
            document.getElementById('dashTotalCost').innerText = totalCost.toLocaleString() + 'Ïõê';

            const costPerPy = area > 0 ? Math.round(totalCost / area) : 0;
            if (document.getElementById('dashCostPerPy')) document.getElementById('dashCostPerPy').innerText = costPerPy.toLocaleString() + 'Ïõê';

            // 3. Estimated Net Profit (Design/Mgmt + Corp Profit)
            // Need to calculate Corporate Profit and Design Fee from estimateData
            let estCorpProfit = 0;
            let estDesignFee = 0;

            // Calculate mostly from currentData.estimateData if available, else 0
            // Re-use updateEstimateTotals logic if possible, or manual calc
            // Manual calc to be safe without affecting DOM
            let grandTotalSafe = 0;
            const savedEst = currentData.estimateData || {};

            Object.keys(savedEst).forEach(catNo => {
                const rows = savedEst[catNo] || [];
                let catTotal = 0;
                rows.forEach(r => {
                    const p = parseInt(r.price) || 0;
                    const q = parseInt(r.qty) || 0;
                    catTotal += p * q;

                    // Check if Design/Mgmt (Cat 02 or name check)
                    // Checking Cat 02
                    if (catNo === '02') {
                        estDesignFee += p * q; // This is supply price
                    }
                });
                grandTotalSafe += catTotal;
            });

            const profitRateVal = parseFloat(currentData.estimateProfitRate) || 15;
            estCorpProfit = Math.round(grandTotalSafe * profitRateVal / 100);

            // Supply: Design + Corp Profit
            const estProfitSupply = estDesignFee + estCorpProfit;
            const estProfitVat = Math.round(estProfitSupply * 0.1);
            const estNetProfit = estProfitSupply + estProfitVat;

            document.getElementById('dashNetProfit').innerText = estProfitSupply.toLocaleString() + 'Ïõê';

            // [New] Calc Est Profit Rate (VAT Excluded)
            let estRate = 0;
            // Use totalSupply (Contract Supply) as denominator
            if (totalSupply > 0) estRate = (estProfitSupply / totalSupply) * 100;

            if (document.getElementById('dashEstRate')) {
                document.getElementById('dashEstRate').innerText = estRate.toFixed(1) + '%';
            }

            // dashProfitSupply removed from HTML
            if (document.getElementById('dashProfitVat')) document.getElementById('dashProfitVat').innerText = estProfitVat.toLocaleString();

            const estProfitPerPy = area > 0 ? Math.round(estProfitSupply / area) : 0;
            if (document.getElementById('dashProfitPerPy')) document.getElementById('dashProfitPerPy').innerText = estProfitPerPy.toLocaleString() + 'Ïõê';

            // 4. Actual Net Profit
            const actualNetProfit = totalAmt - totalCost;
            let actualRate = 0;
            if (totalAmt > 0) actualRate = (actualNetProfit / totalAmt) * 100;

            if (document.getElementById('dashActualProfit')) {
                document.getElementById('dashActualProfit').innerText = actualNetProfit.toLocaleString() + 'Ïõê';
                document.getElementById('dashActualProfit').style.color = actualNetProfit >= 0 ? '#34c759' : '#ff3b30';
            }

            if (document.getElementById('dashActualRate')) document.getElementById('dashActualRate').innerText = actualRate.toFixed(1) + '%';

            const profitDiff = actualNetProfit - estNetProfit;
            if (document.getElementById('dashProfitDiff')) {
                const diffSign = profitDiff > 0 ? '+' : '';
                document.getElementById('dashProfitDiff').innerText = `${diffSign}${profitDiff.toLocaleString()}`;
                document.getElementById('dashProfitDiff').style.color = profitDiff >= 0 ? '#34c759' : '#ff3b30';
            }

            const actualPerPy = area > 0 ? Math.round(actualNetProfit / area) : 0;
            if (document.getElementById('dashActualPerPy')) {
                document.getElementById('dashActualPerPy').innerText = actualPerPy.toLocaleString() + 'Ïõê';
                document.getElementById('dashActualPerPy').style.color = actualNetProfit >= 0 ? '#0071e3' : '#ff3b30';
            }
        }

        // Helper to calc total cost from global data
        function calculateTotalConstructionCost() {
            let total = 0;
            if (typeof categories !== 'undefined' && typeof globalCostData !== 'undefined') {
                categories.forEach(cat => {
                    const items = globalCostData['cost_' + cat.no] || [];
                    items.forEach(item => {
                        const qty = parseNumber(item.qty) || 0;
                        // Price logic matches loadCostData
                        let price = 0;
                        if (item.price) {
                            price = parseNumber(item.price);
                        } else {
                            price = (parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) + (parseNumber(item.expense) || 0);
                        }
                        total += (qty * price);
                    });
                });
            }
            return total;
        }

        function closeCostPasswordModal() {
            document.getElementById('costPasswordModal').classList.remove('show');
        }

        function checkCostPassword() {
            const input = document.getElementById('costAccessPin').value;
            if (input === COST_ACCESS_PIN) {
                isCostUnlocked = true;
                closeCostPasswordModal();

                // Ïû†Í∏à Ìï¥Ï†ú Ïãú Ìå®ÎÑê Í∞ïÏ†ú ÌëúÏãú (Ï¥àÍ∏∞Ìôî Ïãú Ïà®Í≤®ÏßÑ ÏÉÅÌÉú Ìï¥Ï†ú)
                const costPanel = document.getElementById('panel-cost');
                if (costPanel) costPanel.style.display = '';

                showCustomerTab('cost'); // Retry opening the tab
                showToast('ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ï†ëÍ∑ºÏù¥ ÌóàÏö©ÎêòÏóàÏäµÎãàÎã§.', 'success');
            } else {
                showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.', 'error');
                document.getElementById('costAccessPin').value = '';
                document.getElementById('costAccessPin').focus();
            }
        }

        let scheduleRows = [];
        let defaultScheduleSteps = [];

        async function fetchScheduleTemplate() {
            try {
                // Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶ø Í∞ÄÏ†∏Ïò§Í∏∞ (Google Sheet: 'Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨')
                const params = new URLSearchParams({ sheet: 'schedule_template' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const data = await response.json();

                let steps = [];
                if (Array.isArray(data)) {
                    steps = data;
                } else if (data && data.steps && Array.isArray(data.steps)) {
                    steps = data.steps;
                }

                // [Fix] Merged cells handling: Fill down empty categories
                let lastCategory = '';
                steps.forEach(step => {
                    if (step.category && String(step.category).trim() !== '') {
                        lastCategory = step.category;
                    } else if (lastCategory) {
                        step.category = lastCategory;
                    }
                });

                if (steps.length > 0) {
                    defaultScheduleSteps = steps;
                    console.log('‚úÖ Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶ø Î°úÎìú ÏôÑÎ£å:', defaultScheduleSteps.length + 'Í∞ú Ìï≠Î™©');
                    console.log('üìã Ï≤´ Î≤àÏß∏ Ìï≠Î™© ÏÉòÌîå:', defaultScheduleSteps[0]);

                    // [Ïã†Í∑ú] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• ÏòµÏÖò ÎßàÏä§ÌÑ∞ Î°úÎìú
                    await fetchSettlementMaster();

                    // ÎßåÏïΩ Ïù¥ÎØ∏ Ïä§ÏºÄÏ§Ñ ÌÉ≠Ïù¥ÎÇò Ï†ïÏÇ∞ ÌÉ≠Ïù¥ Ïó¥Î†§ÏûàÍ≥† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎã§Î©¥ Í∞±Ïã†
                    if (document.getElementById('panel-schedule').classList.contains('active')) {
                        renderScheduleTable();
                    }
                    if (document.getElementById('panel-settlement').classList.contains('active')) {
                        renderSettlementTable();
                    }
                } else {
                    console.warn('‚ö†Ô∏è Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶øÏù¥ ÎπÑÏñ¥ÏûàÍ±∞ÎÇò Î°úÎìú Ïã§Ìå®. Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©.');
                    defaultScheduleSteps = [
                        { category: 'Í∏∞Ìöç¬∑ÌòÑÏû• ÏÇ¨Ï†Ñ Ï§ÄÎπÑ', name: 'ÎîîÏûêÏù∏ ÏÉÅÎã¥ Î∞è ÏÑ§Í≥Ñ', checkPoint: 'ÏÑ§Í≥Ñ ÎèÑÎ©¥ ÌôïÏ†ï Ïó¨Î∂Ä', inCharge: 'DESIGN JIG' }
                    ];
                }
            } catch (error) {
                console.error('‚ùå Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶ø Î°úÎìú Ïò§Î•ò:', error);
                defaultScheduleSteps = [];
            }
        }

        function loadScheduleForCustomer(targetId) {
            // [Guard] Async Race Protection
            if (targetId && targetId !== currentCustomerId) return;

            // Notion ÌÜµÌï© Ï†úÍ±∞Îê®

            if (currentData.schedules && currentData.schedules.length > 0) {
                scheduleRows = [...currentData.schedules];
            } else {
                // [ÏàòÏ†ï] Ïã†Í∑ú Í≥†Í∞ùÏùÄ Îπà Ïä§ÏºÄÏ§ÑÎ°ú ÏãúÏûë (ÌÖúÌîåÎ¶ø ÏûêÎèô Î°úÎìú X)
                scheduleRows = [];
            }

            // [Ï∂îÍ∞Ä] Ïä§ÏºÄÏ§Ñ ÏÉÅÎã® Ï†ïÎ≥¥ ÏûêÎèô Ï±ÑÏö∞Í∏∞
            if (document.getElementById('schPeriod')) {
                // 1. Static/Auto Fields
                document.getElementById('schPeriod').textContent = currentData.constructionPeriod || '';
                document.getElementById('schArea').textContent = currentData.area ? currentData.area + ' PY' : '';
                document.getElementById('schMoveDate').textContent = currentData.movingDate || '';

                // Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏ 1: Î©îÏù∏ Í≥†Í∞ù
                const clientInfo = currentData.clientName ? (currentData.clientName + ' Í≥†Í∞ùÎãò' + (currentData.clientPhone ? ' (' + currentData.clientPhone + ')' : '')) : '';
                document.getElementById('schClient1').textContent = clientInfo;

                // Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏ 2: Î∞∞Ïö∞Ïûê Ï†ïÎ≥¥ ÏûêÎèô Ï±ÑÏö∞Í∏∞
                const client2Input = document.querySelector('.sch-input[data-field="client2"]');
                if (client2Input && currentData.spouseName) {
                    const spouseInfo = currentData.spouseName + (currentData.spousePhone ? ' (' + currentData.spousePhone + ')' : '');
                    if (!currentData.sch_client2) {
                        client2Input.value = spouseInfo;
                        currentData.sch_client2 = spouseInfo;
                    }
                }

                document.getElementById('schSiteAddr').textContent = currentData.siteAddress || '';

                // 2. Manager Input (Special handling)
                const managerInput = document.getElementById('schManagerInput');
                if (managerInput) {
                    if (!currentData.manager || currentData.manager.trim() === '') {
                        currentData.manager = 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)';
                    }
                    managerInput.value = currentData.manager;

                    managerInput.oninput = function () {
                        updateCustomerField('manager', this.value);
                    };
                    managerInput.onchange = function () {
                        updateCustomerField('manager', this.value);
                        saveCustomers();
                    };
                }

                // 3. Text Inputs (sch_*)
                document.querySelectorAll('.sch-input').forEach(input => {
                    const field = input.dataset.field;
                    if (field === 'manager') return; // Skip manager

                    const key = 'sch_' + field;
                    input.value = currentData[key] || '';

                    if (field === 'client2') {
                        input.addEventListener('input', function () {
                            this.value = this.value.replace(/(010)(\d{4})(\d{4})(?!\d)/g, '$1-$2-$3');
                        });
                    }

                    input.onchange = function () {
                        currentData[key] = this.value;
                        saveCustomers();
                    };
                });

                // 4. Radio Buttons (sch_*)
                const radioFields = ['permit_status', 'consent_status'];
                radioFields.forEach(field => {
                    const key = 'sch_' + field;
                    const savedValue = currentData[key];
                    const radios = document.querySelectorAll(`input[name="${field}"]`);

                    radios.forEach(radio => {
                        radio.checked = (radio.value === savedValue);
                        radio.onchange = function () {
                            if (this.checked) {
                                currentData[key] = this.value;
                                saveCustomers();
                            }
                        };
                    });
                });
            }
            renderScheduleTable();
            syncAllFields();
        }

        // [New] Dropdown Toggle Helper (Portal Version)
        window.toggleScheduleDropdown = function (btn, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }

            // Close existing portal if any
            const existingPortal = document.querySelector('.custom-dropdown-portal');
            if (existingPortal) {
                existingPortal.remove();
                // If clicking the same button, just close it
                if (existingPortal.dataset.triggerId === btn.id) return;
            }

            // Generate unique ID for button if not exists
            if (!btn.id) btn.id = 'dropdown-btn-' + Date.now() + Math.random().toString(36).substr(2, 9);

            const hiddenList = btn.nextElementSibling;
            if (!hiddenList) {
                console.warn('Dropdown list source not found');
                return;
            }

            // Create Portal
            const portal = document.createElement('div');
            portal.className = 'custom-dropdown-portal';
            portal.dataset.triggerId = btn.id;
            portal.innerHTML = hiddenList.innerHTML;

            // Style Portal
            const rect = btn.getBoundingClientRect();
            Object.assign(portal.style, {
                top: (rect.bottom + 2) + 'px', // Add slight gap
                left: rect.left + 'px',
                minWidth: Math.max(rect.width, 140) + 'px', // Ensure minimum width
                display: 'block'
            });

            document.body.appendChild(portal);
        };

        // Global click handler to close dropdown portal
        document.addEventListener('mousedown', function (e) {
            if (!e.target.closest('.custom-dropdown-portal') && !e.target.closest('.dropdown-toggle-btn')) {
                const portal = document.querySelector('.custom-dropdown-portal');
                if (portal) portal.remove();
            }
        });

        // Close on scroll to prevent detachment, but allow scrolling inside the dropdown itself
        window.addEventListener('scroll', function (e) {
            const portal = document.querySelector('.custom-dropdown-portal');
            if (portal && e.target !== portal && !portal.contains(e.target)) {
                portal.remove();
            }
        }, true);

        // [New] Dropdown Selection Helper
        window.selectScheduleOption = function (index, field, value) {
            const portal = document.querySelector('.custom-dropdown-portal');
            if (portal) portal.remove();

            // Update the data model logic
            if (field === 'category') {
                onScheduleCategoryChange(index, value);
            } else if (field === 'name') {
                onScheduleProcessChange(index, value);
            } else if (field === 'inCharge') {
                updateScheduleRow(index, 'inCharge', value);
                renderScheduleTable(); // Re-render to update UI consistency
                saveScheduleToCustomer();
            } else {
                updateScheduleRow(index, field, value);
                renderScheduleTable();
            }
        };

        // [New] Direct Input Handler (ContentEditable)
        window.updateScheduleRowContent = function (el, index, field) {
            if (scheduleRows[index]) {
                // Save rich text content
                scheduleRows[index][field] = el.innerHTML;
            }
        };

        function renderScheduleTable() {
            const tbody = document.getElementById('scheduleTableBody');
            const empty = document.getElementById('scheduleEmptyState');
            if (!tbody) return;

            if (scheduleRows.length === 0) {
                tbody.innerHTML = '';
                if (empty) empty.style.display = 'block';
                return;
            }

            if (empty) empty.style.display = 'none';

            // Extract unique values for dropdowns
            const categories = [...new Set(defaultScheduleSteps.map(s => s.category).filter(Boolean))];

            // [ÏàòÏ†ï] Îã¥ÎãπÏûê Î™©Î°ù Ï∂îÏ∂ú (Ïú†ÎãàÌÅ¨)
            const managers = [...new Set(defaultScheduleSteps.map(s => s.inCharge).filter(Boolean))];

            // ÌòÑÏû¨ ÏÇ¨Ïö© Ï§ëÏù∏ Îã¥ÎãπÏûêÍ∞Ä Î™©Î°ùÏóê ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä (Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥Ïö©)
            scheduleRows.forEach(row => {
                if (row.inCharge && !managers.includes(row.inCharge)) {
                    managers.push(row.inCharge);
                }
            });

            tbody.innerHTML = scheduleRows.map((row, index) => {
                // ÌòÑÏû¨ ÌñâÏùò Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú Í≥µÏ†ïÎ™Ö ÌïÑÌÑ∞ÎßÅ
                const processes = defaultScheduleSteps.filter(s => s.category === row.category);

                // [ÏàòÏ†ï] Í≥µÏ†ïÎ™Ö Ï§ëÎ≥µ Ï†úÍ±∞ (ÏàúÏàò Ïù¥Î¶ÑÎßå ÌëúÏãú)
                const uniqueProcessNames = [...new Set(processes.map(p => p.name))];

                // [ÏàòÏ†ï] Îã¥ÎãπÏûê Î™©Î°ù ÎèôÏ†Å ÌïÑÌÑ∞ÎßÅ (Ïπ¥ÌÖåÍ≥†Î¶¨+Í≥µÏ†ïÎ™Ö Ï¢ÖÏÜç)
                let availableManagers = [];
                if (row.category && row.name) {
                    // Ïπ¥ÌÖåÍ≥†Î¶¨ÏôÄ Í≥µÏ†ïÎ™ÖÏù¥ ÏÑ†ÌÉùÎêú Í≤ΩÏö∞ -> Ìï¥Îãπ Ï°∞Ìï©Ïùò Îã¥ÎãπÏûêÎì§Îßå Ï∂îÏ∂ú
                    availableManagers = defaultScheduleSteps
                        .filter(s => s.category === row.category && s.name === row.name)
                        .map(s => s.inCharge)
                        .filter(Boolean);
                }

                // ÎßåÏïΩ ÌïÑÌÑ∞ÎßÅÎêú Îã¥ÎãπÏûêÍ∞Ä ÏóÜÎã§Î©¥(ÎòêÎäî Í≥µÏ†ïÎ™Ö ÎØ∏ÏÑ†ÌÉù), Ï†ÑÏ≤¥ Îã¥ÎãπÏûê ÌíÄÏùÑ Î≥¥Ïó¨Ï§ÑÏßÄ Í≤∞Ï†ïÌï¥Ïïº Ìï®
                // ÏÇ¨Ïö©Ïûê ÏöîÍµ¨ÏÇ¨Ìï≠: "3Í∞úÎßå Î≥¥Ïó¨ÏïºÏßÄ" -> Í≥µÏ†ïÎ™ÖÏù¥ ÏÑ†ÌÉùÎêòÏóàÎã§Î©¥ Ï¢ÅÌòÄÏÑú Î≥¥Ïó¨Ï£ºÎäî Í≤å ÌïµÏã¨
                // Í≥µÏ†ïÎ™ÖÏù¥ ÏïÑÏßÅ Ïïà Ï†ïÌï¥Ï°åÎã§Î©¥, Ï†ÑÏ≤¥ Î™©Î°ù ÎÖ∏Ï∂ú (Ïú†Ïó∞ÏÑ±)
                if (availableManagers.length === 0 && !row.name) {
                    availableManagers = defaultScheduleSteps.map(s => s.inCharge).filter(Boolean);
                }

                // Ï§ëÎ≥µ Ï†úÍ±∞
                availableManagers = [...new Set(availableManagers)];

                // ÌòÑÏû¨ ÏûÖÎ†•Îêú Îã¥ÎãπÏûêÍ∞Ä Î™©Î°ùÏóê ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥)
                if (row.inCharge && !availableManagers.includes(row.inCharge)) {
                    availableManagers.push(row.inCharge);
                }

                // Helper to render editable dropdown cell
                const renderEditableDropdown = (value, options, fieldName, index, placeholder = '') => {
                    const listHtml = options.map(opt =>
                        `<div class="custom-dropdown-item ${value === opt ? 'selected' : ''}" 
                              onmousedown="selectScheduleOption(${index}, '${fieldName}', '${opt}')">${opt}</div>`
                    ).join('');

                    return `
                        <div class="editable-cell-wrapper">
                            <div contenteditable="false" class="text-formattable editable-content" 
                                 style="text-align:center;"
                                 onmousedown="event.stopPropagation();"
                                 ondblclick="this.contentEditable=true;this.focus();"
                                 onkeydown="if(event.key==='Escape'){
                                     this.contentEditable=false;
                                     this.blur();
                                     toggleScheduleDropdown(this.nextElementSibling, event);
                                 }"
                                 oninput="updateScheduleRowContent(this, ${index}, '${fieldName}')"
                                 onblur="this.contentEditable=false;saveScheduleToCustomer()"
                                 placeholder="${placeholder}">${value || ''}</div>
                            <button class="dropdown-toggle-btn no-print" onmousedown="toggleScheduleDropdown(this, event)">‚ñº</button>
                            <div class="custom-dropdown-list-source" style="display:none;">
                                ${listHtml}
                            </div>
                        </div>
                    `;
                };

                // Helper for plain editable cell (Checkpoint, Memo)
                const renderEditableCell = (value, fieldName, index, placeholder = '', textAlign = 'left') => {
                    return `
                        <div contenteditable="false" class="text-formattable editable-content"
                             style="text-align:${textAlign};"
                             onmousedown="event.stopPropagation();"
                             ondblclick="this.contentEditable=true;this.focus();"
                             onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                             oninput="updateScheduleRowContent(this, ${index}, '${fieldName}')"
                             onblur="this.contentEditable=false;saveScheduleToCustomer()"
                             placeholder="${placeholder}">${value || ''}</div>
                    `;
                };

                return `
    <tr draggable="true" ondragstart="handleDragStart(event, ${index})" ondragover="handleDragOver(event)"
        ondrop="handleDrop(event, ${index})" ondragend="handleDragEnd(event)"
        style="cursor:move; transition: background 0.2s;">
        <td class="no-print" style="text-align:center; padding:5px; border:1px solid #d2d2d7;">
             <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                <button onclick="removeScheduleRow(${index})" class="no-print" 
                    style="width:22px; height:22px; background:#ff3b30; color:white; border:none; border-radius:50%; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; line-height:1;"
                    title="ÏÇ≠Ï†ú">‚àí</button>
                <span style="font-size:12px; color:#333;">${index + 1}</span>
             </div>
        </td>
        <!-- Print Index (displayed only when printing) -->
        <td class="print-only-cell" style="text-align:center; padding:10px; border:1px solid #d2d2d7; font-size:12px; display:none;">${index + 1}</td>

        <!-- Category -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.category, categories, 'category', index, 'ÏÑ†ÌÉù')}
        </td>

        <!-- Process Name -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.name, uniqueProcessNames, 'name', index, 'Í≥µÏ†ïÎ™Ö')}
        </td>

        <!-- Checkpoint -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableCell(row.checkPoint, 'checkPoint', index, 'Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏')}
        </td>

        <td style="padding:5px; border:1px solid #d2d2d7;">
            <input type="date" value="${(row.start || '').replace(/\./g, '-')}" class="customer-field"
                style="width:100%; border:none; background:transparent; font-size:12px; padding:5px; text-align:center;"
                onchange="handleStartDateChange(${index}, this.value)">
        </td>
        <td style="padding:5px; border:1px solid #d2d2d7;">
            <input type="date" value="${(row.end || '').replace(/\./g, '-')}" class="customer-field"
                style="width:100%; border:none; background:transparent; font-size:12px; padding:5px; text-align:center;"
                onchange="updateScheduleRow(${index}, 'end', this.value)">
        </td>
        
        <!-- Manager -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.inCharge, availableManagers, 'inCharge', index, 'Îã¥ÎãπÏûê')}
        </td>
        
        <!-- Memo -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableCell(row.memo, 'memo', index, 'ÎπÑÍ≥†', 'center')}
        </td>
    </tr>
                `;
            }).join('');
        }

        function addScheduleRow() {
            // Îπà Ìñâ Ï∂îÍ∞Ä (Í≤¨Ï†ÅÏÑú Î∞©Ïãù)
            scheduleRows.push({
                id: Date.now() + Math.random(),
                category: '',
                name: '',
                checkPoint: '',
                start: '',
                end: '',
                inCharge: '', // [ÏàòÏ†ï] Í∏∞Î≥∏Í∞í ÏóÜÏùå
                memo: ''
            });
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù Ïãú Í≥µÏ†ïÎ™Ö ÌïÑÌÑ∞ÎßÅ (Í≤¨Ï†ÅÏÑú Ìå®ÌÑ¥ Ï∞∏Ï°∞)
        function onScheduleCategoryChange(rowIndex, category) {
            if (!scheduleRows[rowIndex]) return;

            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≥ÄÍ≤Ω Ïãú Í≥µÏ†ïÎ™Ö, Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ Ï¥àÍ∏∞Ìôî
            scheduleRows[rowIndex].category = category;
            scheduleRows[rowIndex].name = '';
            scheduleRows[rowIndex].checkPoint = '';
            // [Ï∂îÍ∞Ä] Îã¥ÎãπÏûêÎèÑ Í∞ôÏù¥ Ï¥àÍ∏∞ÌôîÌïòÎäî Í≤ÉÏù¥ ÏûêÏó∞Ïä§Îü¨ÏõÄ
            scheduleRows[rowIndex].inCharge = '';

            // ÌÖåÏù¥Î∏î Îã§Ïãú Î†åÎçîÎßÅ (ÌïÑÌÑ∞ÎßÅÎêú Í≥µÏ†ïÎ™Ö ÎìúÎ°≠Îã§Ïö¥ ÌëúÏãú)
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // Í≥µÏ†ïÎ™Ö ÏÑ†ÌÉù Ïãú Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏/Îã¥ÎãπÏûê Ïó∞Îèô
        function onScheduleProcessChange(rowIndex, processName) {
            if (!scheduleRows[rowIndex]) return;

            scheduleRows[rowIndex].name = processName;

            // Í≥µÏ†ïÎ™ÖÏùÑ Î∞îÍø®ÏúºÎØÄÎ°ú Îã¥ÎãπÏûêÎèÑ Ï¥àÍ∏∞Ìôî (Îã§Ïãú ÏÑ†ÌÉù Ïú†ÎèÑ)
            scheduleRows[rowIndex].inCharge = '';

            if (!processName) {
                scheduleRows[rowIndex].checkPoint = '';
                renderScheduleTable();
                saveScheduleToCustomer();
                return;
            }

            // ÏÑ†ÌÉùÎêú Í≥µÏ†ïÎ™ÖÏóê Ìï¥ÎãπÌïòÎäî ÌõÑÎ≥¥Íµ∞ Ï∞æÍ∏∞
            const candidates = defaultScheduleSteps.filter(s =>
                s.category === scheduleRows[rowIndex].category && s.name === processName
            );

            if (candidates.length > 0) {
                // Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏Îäî Ï≤´ Î≤àÏß∏ ÌõÑÎ≥¥Ïùò Í≤ÉÏùÑ Îî∞Î¶Ñ (Î≥¥ÌÜµ ÎèôÏùºÌïòÎØÄÎ°ú)
                scheduleRows[rowIndex].checkPoint = candidates[0].checkPoint || '';

                // [ÏàòÏ†ï] ÎßåÏïΩ Í∞ÄÎä•Ìïú Îã¥ÎãπÏûêÍ∞Ä Îî± 1Î™ÖÏù¥ÎùºÎ©¥ ÏûêÎèô ÏÑ†ÌÉù
                // 2Î™Ö Ïù¥ÏÉÅÏù¥Î©¥ Îπà Í∞íÏúºÎ°ú ÎëêÏñ¥ ÏÇ¨Ïö©ÏûêÍ∞Ä ÎìúÎ°≠Îã§Ïö¥ÏóêÏÑú ÏÑ†ÌÉùÌïòÍ≤å Ìï® (B.R, S.T, T.W Ï§ë ÌÉù1)
                const distinctManagers = [...new Set(candidates.map(c => c.inCharge).filter(Boolean))];
                if (distinctManagers.length === 1) {
                    scheduleRows[rowIndex].inCharge = distinctManagers[0];
                }
            }

            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // Ïú†ÏùòÏÇ¨Ìï≠ ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ìï®Ïàò (ÎÖ∏ÏÖò Ïó∞ÎèôÏö©)
        function getScheduleGuidelinesText() {
            const list = document.getElementById('scheduleGuidelinesList');
            if (!list) return '';
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).join('\n');
        }

        function getASGuidelinesText() {
            const list = document.getElementById('asGuidelinesList');
            if (!list) return '';
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).join('\n');
        }

        // [Ï∂îÍ∞Ä] Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ Î∞∞Ïó¥Î°ú Î∞òÌôò (ÎÖ∏ÏÖò ÏΩúÏïÑÏõÉÏö©)
        function getScheduleGuidelinesArray() {
            const list = document.getElementById('scheduleGuidelinesList');
            if (!list) return [];
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).filter(t => t);
        }

        function getASGuidelinesArray() {
            const list = document.getElementById('asGuidelinesList');
            if (!list) return [];
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).filter(t => t);
        }

        // Ïä§ÏºÄÏ§Ñ Ïú†ÏùòÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞ (Íµ¨Í∏Ä ÏãúÌä∏ÏóêÏÑú)
        async function loadScheduleGuidelines() {
            try {
                const params = new URLSearchParams({
                    sheet: 'Í≥µÏÇ¨Ïä§ÏºÄÏ§ÑÍ¥ÄÎ¶¨', // Ïï±Ïä§Ïä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú ÎùÑÏñ¥Ïì∞Í∏∞ Ïú†Ïó∞ÌïòÍ≤å Ï≤òÎ¶¨Ìï®
                    action: 'getGuidelines'
                });

                // 3Ï¥à ÌÉÄÏûÑÏïÑÏõÉ ÏÑ§Ï†ï (Î°úÏª¨ ÌÖåÏä§Ìä∏ Ïãú ÎÑàÎ¨¥ Ïò§Îûò Í±∏Î¶¨ÏßÄ ÏïäÍ≤å)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);

                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`, { signal: controller.signal });
                clearTimeout(timeoutId);

                const result = await response.json();

                if (result.success && result.guidelines && result.guidelines.length > 0) {
                    const guidelinesList = document.getElementById('scheduleGuidelinesList');
                    if (guidelinesList) {
                        guidelinesList.innerHTML = result.guidelines.map(item => `<li>${item}</li>`).join('');
                        showPersistentAlert('Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ\nÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§.', 'success');
                    }
                } else {
                    throw new Error(result.error || 'No guidelines found');
                }
            } catch (error) {
                console.warn('‚ùå ÏÑúÎ≤Ñ Ïú†ÏùòÏÇ¨Ìï≠ Î°úÎìú Ïã§Ìå®, Î°úÏª¨ Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', error);

                // [Î°úÏª¨ ÌÖåÏä§Ìä∏Ïö© Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞]
                // Î∞∞Ìè¨ Î¨∏Ï†úÎ°ú ÏÑúÎ≤Ñ ÌÜµÏã†Ïù¥ Ïïà Îê† Í≤ΩÏö∞ Ïù¥ Îç∞Ïù¥ÌÑ∞Î•º Î≥¥Ïó¨Ï§çÎãàÎã§.
                const localBackupGuidelines = [
                    "Í≥µÏÇ¨ Í∏∞Í∞Ñ Ï§ëÏóêÎäî ÏïàÏ†ÑÏÇ¨Í≥† ÏòàÎ∞©ÏùÑ ÏúÑÌï¥ ÌòÑÏû• Ï∂úÏûÖÏù¥ Ï†úÌïúÎê† Ïàò ÏûàÏúºÎ©∞, ÏûëÏóÖ Íµ¨Í∞Ñ Ï∂úÏûÖÏùÄ ÏÇºÍ∞Ä Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.",
                    "Í≥µÏ†ï ÌäπÏÑ±ÏÉÅ ÏÜåÏùå, Î∂ÑÏßÑ, ÎÉÑÏÉàÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÍ≥†, ÏùºÏ†ï ÏãúÍ∞ÑÎåÄÏóêÎäî ÏûëÏóÖÏù¥ ÏßëÏ§ëÎê† Ïàò ÏûàÏäµÎãàÎã§.",
                    "Í≥µÏÇ¨ Ï§ë Ï∂îÍ∞Ä ÏöîÏ≤≠Ïù¥ÎÇò Î≥ÄÍ≤Ω ÏÇ¨Ìï≠Ïù¥ ÏûàÏùÑ Í≤ΩÏö∞, Í≥µÏ†ï Î∞è ÎπÑÏö©Ïóê ÏòÅÌñ•Ïù¥ ÏûàÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú Î∞òÎìúÏãú Îã¥ÎãπÏûêÏôÄ Î®ºÏ†Ä ÌòëÏùò Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.",
                    "Í≥µÏ†ï ÏôÑÎ£å ÌõÑÏóêÎäî Îã§Ïùå Í≥µÏ†ïÏùÑ ÏúÑÌï¥ ÌòÑÏû• Ï†ïÎ¶¨ Î∞è ÏñëÏÉù ÏãúÍ∞ÑÏù¥ ÌïÑÏöîÌï† Ïàò ÏûàÏúºÎ©∞, Ïù¥ Í∏∞Í∞Ñ ÎèôÏïà ÌòÑÏû• Ï∂úÏûÖÏù¥ Ï†úÌïúÎê† Ïàò ÏûàÏäµÎãàÎã§."
                ];

                const guidelinesList = document.getElementById('scheduleGuidelinesList');
                if (guidelinesList) {
                    guidelinesList.innerHTML = localBackupGuidelines.map(item => `<li>${item}</li>`).join('');
                    showPersistentAlert('ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïù¥ ÏõêÌôúÌïòÏßÄ ÏïäÏïÑ\nÍ∏∞Î≥∏ Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ ÌëúÏãúÌï©ÎãàÎã§.\n(Î°úÏª¨ Î™®Îìú)', 'warning');
                }
            }
        }

        // A/S Ïú†ÏùòÏÇ¨Ìï≠ Î∂àÎü¨Ïò§Í∏∞ (Íµ¨Í∏Ä ÏãúÌä∏ÏóêÏÑú)
        async function loadASGuidelines() {
            try {
                const params = new URLSearchParams({
                    sheet: 'ASÍ¥ÄÎ¶¨Î¶¨Ïä§Ìä∏',
                    action: 'getGuidelines'
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.success && result.guidelines && result.guidelines.length > 0) {
                    const guidelinesList = document.getElementById('asGuidelinesList');
                    if (guidelinesList) {
                        guidelinesList.innerHTML = result.guidelines.map(item => `<li>${item}</li>`).join('');
                        showPersistentAlert('A/S Í¥ÄÎ¶¨ Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ\nÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§.', 'success');
                    }
                } else if (result.success) {
                    showPersistentAlert('Î∂àÎü¨Ïò¨ Ïú†ÏùòÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                } else {
                    showPersistentAlert('Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.\n\n' + (result.error || ''), 'error');
                }
            } catch (error) {
                console.error('Error loading AS guidelines:', error);
                showPersistentAlert('Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.\n\n' + error.message, 'error');
            }
        }

        function showScheduleTemplateModal() {
            const modal = document.createElement('div');
            modal.id = 'scheduleTemplateModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 24px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            `;

            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù Ï∂îÏ∂ú
            const categories = [...new Set(defaultScheduleSteps.map(s => s.category).filter(Boolean))];
            const categoryOptions = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            modalContent.innerHTML = `
                <h3 style="margin: 0 0 16px 0; font-size: 18px; color: #333;">üìã Í≥µÏ†ï ÏÑ†ÌÉù</h3>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; color: #666; margin-bottom: 6px;">Ïπ¥ÌÖåÍ≥†Î¶¨ (ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù)</label>
                    <select id="categorySelect" onchange="updateProcessOptions()" size="14" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 6px; outline: none;">
                        <option value="__CUSTOM__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†• (Îπà Ìñâ Ï∂îÍ∞Ä)</option>
                        ${categoryOptions}
                    </select>
                </div>

                <div id="processSelectContainer" style="margin-bottom: 16px; display: none;">
                    <label style="display: block; font-size: 13px; color: #666; margin-bottom: 6px;">ÏÑ∏Î∂Ä Í≥µÏ†ïÎ™Ö (ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù)</label>
                    <select id="processSelect" size="10" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 6px; outline: none;">
                    </select>
                </div>

                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button onclick="closeScheduleTemplateModal()" style="padding: 8px 16px; background: #f0f0f0; border: none; border-radius: 6px; cursor: pointer;">Ï∑®ÏÜå</button>
                    <button id="addScheduleBtn" onclick="addScheduleFromTemplate()" style="padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer;" disabled>Ï∂îÍ∞Ä</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeScheduleTemplateModal();
                }
            });
        }

        function updateProcessOptions() {
            const categorySelect = document.getElementById('categorySelect');
            const processSelectContainer = document.getElementById('processSelectContainer');
            const processSelect = document.getElementById('processSelect');
            const addBtn = document.getElementById('addScheduleBtn');
            const selectedCategory = categorySelect.value;

            if (selectedCategory === '__CUSTOM__') {
                // ÏßÅÏ†ë ÏûÖÎ†• ÏÑ†ÌÉù Ïãú
                processSelectContainer.style.display = 'none';
                addBtn.disabled = false;
            } else if (selectedCategory) {
                // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù Ïãú Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Í≥µÏ†ïÎì§ ÌïÑÌÑ∞ÎßÅ
                const processes = defaultScheduleSteps.filter(s => s.category === selectedCategory);
                const processOptions = processes.map((proc, idx) =>
                    `<option value="${idx}" data-category="${selectedCategory}">${proc.name}</option>`
                ).join('');

                processSelect.innerHTML = processOptions;

                // size ÏÜçÏÑ± ÎèôÏ†Å Ï°∞Ï†ï (ÏµúÏÜå 3, ÏµúÎåÄ 10)
                const optionCount = processes.length;
                processSelect.setAttribute('size', Math.min(Math.max(optionCount, 3), 10));

                processSelectContainer.style.display = 'block';
                addBtn.disabled = true;

                // Í≥µÏ†ï ÏÑ†ÌÉù Ïãú Ï∂îÍ∞Ä Î≤ÑÌäº ÌôúÏÑ±Ìôî
                processSelect.onchange = function () {
                    addBtn.disabled = !this.value;
                };
            } else {
                // ÏÑ†ÌÉù ÏïàÌï®
                processSelectContainer.style.display = 'none';
                addBtn.disabled = true;
            }
        }

        function closeScheduleTemplateModal() {
            const modal = document.getElementById('scheduleTemplateModal');
            if (modal) {
                modal.remove();
            }
        }

        function addScheduleFromTemplate() {
            const categorySelect = document.getElementById('categorySelect');
            const processSelect = document.getElementById('processSelect');
            const selectedCategory = categorySelect.value;

            let newRow;

            if (selectedCategory === '__CUSTOM__') {
                // Îπà Ìñâ Ï∂îÍ∞Ä
                newRow = {
                    id: Date.now() + Math.random(),
                    category: '',
                    name: '',
                    checkPoint: '',
                    start: '',
                    end: '',
                    inCharge: currentData.manager || 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)',
                    memo: ''
                };
            } else {
                // ÏÑ†ÌÉùÌïú Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Í≥µÏ†ï Ï∞æÍ∏∞
                const processes = defaultScheduleSteps.filter(s => s.category === selectedCategory);
                const selectedIndex = parseInt(processSelect.value);
                const template = processes[selectedIndex];

                if (template) {
                    // Îã¥ÎãπÏûê Ïö∞ÏÑ†ÏàúÏúÑ: 1. ÌÖúÌîåÎ¶ø Îã¥ÎãπÏûê, 2. ÌòÑÏû¨ Í≥†Í∞ù Îã¥ÎãπÏûê, 3. Í∏∞Î≥∏Í∞í "ÏõêÌîÑÎ°ú ÏÜåÏû•"
                    let inChargeValue = 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)';
                    if (template.inCharge && template.inCharge.trim()) {
                        inChargeValue = template.inCharge;
                    } else if (currentData.manager && currentData.manager.trim()) {
                        inChargeValue = currentData.manager;
                    }

                    newRow = {
                        id: Date.now() + Math.random(),
                        category: template.category || '',
                        name: template.name || '',
                        checkPoint: template.checkPoint || '',
                        start: '',
                        end: '',
                        inCharge: inChargeValue,
                        memo: ''
                    };

                    console.log('üìå Í≥µÏ†ï Ï∂îÍ∞Ä:', newRow);
                }
            }

            if (newRow) {
                scheduleRows.push(newRow);
                renderScheduleTable();
                saveScheduleToCustomer();
                closeScheduleTemplateModal();
            }
        }

        function removeScheduleRow(index) {
            scheduleRows.splice(index, 1);
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        function updateScheduleRow(index, field, value) {
            scheduleRows[index][field] = value;
            saveScheduleToCustomer();
        }

        // ÏãúÏûëÏùº Î≥ÄÍ≤Ω Ïãú Ï¢ÖÎ£åÏùº ÏûêÎèô Ï±ÑÏö∞Í∏∞
        function handleStartDateChange(index, value) {
            scheduleRows[index]['start'] = value;

            // Ï¢ÖÎ£åÏùºÏù¥ ÎπÑÏñ¥ÏûàÏúºÎ©¥ ÏãúÏûëÏùºÍ≥º ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï
            if (!scheduleRows[index]['end'] && value) {
                scheduleRows[index]['end'] = value;
                renderScheduleTable(); // ÌÖåÏù¥Î∏î Îã§Ïãú Î†åÎçîÎßÅÌïòÏó¨ Ï¢ÖÎ£åÏùº ÌëúÏãú
            }

            saveScheduleToCustomer();
        }

        function moveScheduleRow(index, delta) {
            const newIndex = index + delta;
            if (newIndex < 0 || newIndex >= scheduleRows.length) return;
            const item = scheduleRows.splice(index, 1)[0];
            scheduleRows.splice(newIndex, 0, item);
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        function saveScheduleToCustomer() {
            currentData.schedules = [...scheduleRows];
            syncAllFields();
        }

        // [New] A/S List Logic
        let asListRows = [];

        function loadASList(targetId) {
            // [Guard] Async Race Protection
            if (targetId && targetId !== currentCustomerId) return;

            if (currentData && currentData.as_list) {
                asListRows = currentData.as_list;
            } else {
                asListRows = []; // Start empty for new selection
            }
            renderASListTable();
            updateASInfoHeaders();
        }

        function updateASInfoHeaders() {
            // Manually sync fields in A/S header (since syncAllFields might not target these specific IDs if they are refreshed or not caught)
            // But they use 'data-sync' class, so syncAllFields() handles them IF called.
            // Let's call syncAllFields() just in case OR just handle the specific ID for bathroom leak.
            // We'll rely on syncAllFields() for the standard ones, but calculate bathroom leak.

            // Calculate Bathroom Leak A/S (General A/S + 18 months)
            const leakEl = document.getElementById('bathroomLeakWarranty');
            if (leakEl) {
                let endDate = currentData.asEndDate || '';
                // If no asEndDate, try to parse from warrantyPeriod string if it ends with date
                if (!endDate && currentData.warrantyPeriod) {
                    // Try to match date pattern like "~YY.MM.DD" or "~YYYY.MM.DD" or "YYYY.MM.DD"
                    const matches = currentData.warrantyPeriod.match(/(\d{2,4})[-\.](\d{2})[-\.](\d{2})$/);
                    if (matches) {
                        // Reconstruct full date
                        let year = parseInt(matches[1]);
                        if (year < 100) year += 2000;
                        const month = matches[2];
                        const day = matches[3];
                        endDate = `${year}-${month}-${day}`;
                    }
                }

                if (endDate) {
                    try {
                        const date = new Date(endDate);
                        if (!isNaN(date.getTime())) {
                            // Add 18 months
                            date.setMonth(date.getMonth() + 18);

                            // Format
                            const yy = String(date.getFullYear()).slice(-2);
                            const mm = String(date.getMonth() + 1).padStart(2, '0');
                            const dd = String(date.getDate()).padStart(2, '0');
                            leakEl.textContent = `~${yy}.${mm}.${dd}`;
                        } else {
                            leakEl.textContent = '-';
                        }
                    } catch (e) {
                        leakEl.textContent = '-';
                    }
                } else {
                    leakEl.textContent = '-';
                }
            }
        }

        function addASListItem() {
            asListRows.push({
                category: '',
                brand: '',
                item: '',
                modelNum: '',
                size: '',
                price: '',
                service: '',
                warranty: '',
                note: ''
            });
            renderASListTable();
            saveASList();
        }

        // [New] A/S DB Mock Data (Initialize global)
        // Global A/S DB
        let AS_DB = [];

        function fetchASListDB() {
            if (AS_DB && AS_DB.length > 0) return; // Already loaded

            fetch(CUSTOMER_SYNC_URL + '?sheet=as_list')
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success' && Array.isArray(data.items)) {
                        AS_DB = data.items;
                        console.log('‚úÖ A/S DB Loaded:', AS_DB.length + ' items');
                        renderASListTable(); // Re-render if table is open
                    } else {
                        console.error('‚ùå Failed to load A/S DB or invalid format:', data);
                        AS_DB = []; // Ensure it remains an array
                    }
                })
                .catch(err => {
                    console.error('‚ùå Error fetching A/S DB:', err);
                    AS_DB = []; // Ensure it remains an array on error
                });
        }

        function renderASListTable() {
            const tbody = document.getElementById('asListTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            // Extract unique categories from AS_DB
            const categories = [...new Set(AS_DB.map(item => item.category).filter(Boolean))];

            asListRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.setAttribute('draggable', 'true');
                tr.ondragstart = (e) => handleASDragStart(e, index);
                tr.ondragover = (e) => handleASDragOver(e);
                tr.ondrop = (e) => handleASDrop(e, index);
                tr.ondragend = (e) => handleASDragEnd(e);
                tr.style.cursor = 'move';
                tr.style.transition = 'background 0.2s';

                // Category Options
                const categoryOptions = categories.map(c =>
                    `<option value="${c}" ${row.category === c ? 'selected' : ''}>${c}</option>`
                ).join('');

                // Brand Options (Filtered by Category)
                let brandOptions = '<option value="">ÏÑ†ÌÉù</option>';
                if (row.category) {
                    const brands = [...new Set(AS_DB.filter(d => d.category === row.category).map(d => d.brand).filter(Boolean))];
                    brandOptions += brands.map(b =>
                        `<option value="${b}" ${row.brand === b ? 'selected' : ''}>${b}</option>`
                    ).join('');
                } else {
                    brandOptions = '<option value="">Ïπ¥ÌÖåÍ≥†Î¶¨ Î®ºÏ†Ä ÏÑ†ÌÉù</option>';
                }

                // Item Options (Filtered by Category AND Brand)
                let itemOptions = '<option value="">ÏÑ†ÌÉù</option>';
                if (row.category && row.brand) {
                    const items = [...new Set(AS_DB.filter(d => d.category === row.category && d.brand === row.brand).map(d => d.item).filter(Boolean))];
                    itemOptions += items.map(i =>
                        `<option value="${i}" ${row.item === i ? 'selected' : ''}>${i}</option>`
                    ).join('');
                } else {
                    itemOptions = '<option value="">Î∏åÎûúÎìú Î®ºÏ†Ä ÏÑ†ÌÉù</option>';
                }

                tr.innerHTML = `
                    <td class="no-print" style="text-align:center; padding:5px; border:1px solid #d2d2d7;">
                        <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                            <button onclick="removeASListRow(${index})" class="no-print" 
                                style="width:22px; height:22px; background:#ff3b30; color:white; border:none; border-radius:50%; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; line-height:1;"
                                title="ÏÇ≠Ï†ú">‚àí</button>
                            <span style="font-size:12px; color:#333;">${index + 1}</span>
                        </div>
                    </td>
                    <!-- Print Index (displayed only when printing) -->
                    <td class="print-only-cell" style="text-align:center; padding:10px; border:1px solid #d2d2d7; font-size:12px; display:none;">${index + 1}</td>

                    <!-- Category (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <select class="mh-input" onchange="updateASCategory(${index}, this.value)"
                             style="width:100%; border:none; outline:none; text-align:center; background:transparent;">
                             <option value="">ÏÑ†ÌÉù</option>
                             ${categoryOptions}
                         </select>
                    </td>
                    <!-- Brand (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select class="mh-input" onchange="updateASBrand(${index}, this.value)"
                             style="width:100%; border:none; outline:none; text-align:center; background:transparent;">
                             ${brandOptions}
                         </select>
                    </td>
                    <!-- Item (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select class="mh-input" onchange="updateASItem(${index}, this.value)"
                            style="width:100%; border:none; outline:none; background:transparent;">
                            ${itemOptions}
                        </select>
                    </td>
                    <!-- ModelNum -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" class="mh-input" value="${row.modelNum || ''}" 
                            onchange="updateASListRow(${index}, 'modelNum', this.value)"
                            style="width:100%; border:none; outline:none;">
                    </td>
                     <!-- Size -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" class="mh-input" value="${row.size || ''}" 
                            onchange="updateASListRow(${index}, 'size', this.value)"
                            style="width:100%; border:none; outline:none; text-align:center;">
                    </td>
                     <!-- Service -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" class="mh-input" value="${row.service || ''}" 
                             onchange="updateASListRow(${index}, 'service', this.value)"
                             style="width:100%; border:none; outline:none; text-align:center;">
                    </td>
                    <!-- Warranty -->
                    <td style="padding:0; border:1px solid #d2d2d7; position: relative; height: 40px;">
                        <input type="text" class="mh-input" value="${row.warranty || ''}" 
                            id="warrantyInput_${index}"
                            onchange="updateASListRow(${index}, 'warranty', this.value)"
                            style="width:100%; height:100%; border:none; outline:none; text-align:center; font-weight:bold; background: transparent; padding-right: 25px;">
                        
                        <!-- Ïä§ÏºÄÏ§Ñ Ïó∞Îèô ÎìúÎ°≠Îã§Ïö¥ (ÏïÑÏù¥ÏΩòÏúºÎ°ú Ïà®ÍπÄ) -->
                        <div style="position: absolute; right: 4px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; overflow: hidden;" class="no-print">
                            <div style="font-size:14px; cursor:pointer; text-align:center; line-height:20px;">üìÖ</div>
                            <select onchange="applyScheduleToWarranty(${index}, this.value); this.value='';"
                                style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
                                <option value="">Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù</option>
                                ${getScheduleOptions()}
                            </select>
                        </div>
                    </td>
                    <!-- Note -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" class="mh-input" value="${row.note || ''}" 
                             onchange="updateASListRow(${index}, 'note', this.value)"
                             style="width:100%; border:none; outline:none;">
                    </td>
                 `;
                tbody.appendChild(tr);
            });
        }

        let draggedASIndex = null;
        function handleASDragStart(e, index) {
            draggedASIndex = index;
            e.target.style.opacity = '0.4';
        }
        function handleASDragEnd(e) {
            e.target.style.opacity = '1';
            draggedASIndex = null;
        }
        function handleASDragOver(e) {
            e.preventDefault();
        }
        function handleASDrop(e, index) {
            e.preventDefault();
            if (draggedASIndex === null || draggedASIndex === index) return;
            // Move item in array
            const item = asListRows.splice(draggedASIndex, 1)[0];
            asListRows.splice(index, 0, item);
            renderASListTable();
            saveASList();
        }

        function updateASCategory(index, category) {
            asListRows[index].category = category;
            asListRows[index].brand = ''; // Reset brand
            asListRows[index].item = ''; // Reset item
            asListRows[index].modelNum = '';
            asListRows[index].size = '';
            asListRows[index].price = '';
            asListRows[index].service = '';
            asListRows[index].warranty = '';
            // Note: Don't clear note if user typed one? Or reset? Usually reset if everything changes.
            asListRows[index].note = '';

            saveASList();
            renderASListTable();
        }

        function updateASBrand(index, brand) {
            asListRows[index].brand = brand;
            asListRows[index].item = ''; // Reset item
            asListRows[index].modelNum = '';
            asListRows[index].size = '';
            asListRows[index].price = '';
            asListRows[index].service = '';
            asListRows[index].warranty = '';
            asListRows[index].note = '';

            saveASList();
            renderASListTable();
        }

        function updateASItem(index, itemName) {
            if (!itemName) {
                asListRows[index].item = '';
                // Don't reset Brand/Category
                asListRows[index].modelNum = '';
                asListRows[index].size = '';
                asListRows[index].price = '';
                asListRows[index].service = '';
                asListRows[index].warranty = '';
                asListRows[index].note = '';
                saveASList();
                renderASListTable();
                return;
            }

            // Find selected item in DB (matching category and brand)
            const selectedData = AS_DB.find(d =>
                d.category === asListRows[index].category &&
                d.brand === asListRows[index].brand &&
                d.item === itemName
            );

            if (selectedData) {
                asListRows[index].item = selectedData.item;
                asListRows[index].modelNum = selectedData.modelNum;
                asListRows[index].size = selectedData.size;
                asListRows[index].price = selectedData.price;
                asListRows[index].service = selectedData.service;
                asListRows[index].warranty = selectedData.warranty;
                asListRows[index].note = selectedData.note;
            }
            saveASList();
            renderASListTable();
        }

        function getScheduleOptions() {
            // Use currentData.schedules if scheduleRows is empty
            const schedules = (scheduleRows && scheduleRows.length > 0) ? scheduleRows : (currentData.schedules || []);

            let options = '';
            // [Ï∂îÍ∞Ä] ÏûîÍ∏àÏùº ÏòµÏÖò
            if (currentData.finalPaymentDate) {
                options += `<option value="balanceDate" style="color:#0071e3; font-weight:bold;">ÏûîÍ∏àÏùº (${currentData.finalPaymentDate})</option>`;
            }

            options += schedules.map((sch, idx) => {
                const name = sch.name || 'Ïù¥Î¶Ñ ÏóÜÏùå';
                const end = sch.end || '';
                if (!end) return '';
                return `<option value="${end}">${name}</option>`;
            }).join('');

            return options;
        }

        function applyScheduleToWarranty(index, endDate) {
            if (!endDate) return;

            // [Ï∂îÍ∞Ä] ÏûîÍ∏àÏùº ÏÑ†ÌÉù Ïãú (ÏÜçÏÑ±Î™Ö ÏàòÏ†ï: balanceDate -> finalPaymentDate)
            if (endDate === 'balanceDate') {
                endDate = currentData.finalPaymentDate;
            }

            // 1. Find the original warranty duration from AS_DB
            const row = asListRows[index];
            const dbItem = AS_DB.find(d =>
                d.category === row.category &&
                d.brand === row.brand &&
                d.item === row.item
            );

            // Default to '1ÎÖÑ' if not found or empty
            const durationStr = (dbItem && dbItem.warranty) ? dbItem.warranty : '1ÎÖÑ';

            try {
                // endDate format: YYYY-MM-DD
                const date = new Date(endDate);

                // 2. Parse duration string (e.g., "1ÎÖÑ", "2ÎÖÑ", "6Í∞úÏõî")
                let addYears = 0;
                let addMonths = 0;

                const yearMatch = durationStr.match(/(\d+)\s*ÎÖÑ/);
                const monthMatch = durationStr.match(/(\d+)\s*Í∞úÏõî/);

                addYears = yearMatch ? parseInt(yearMatch[1]) : 0;
                addMonths = monthMatch ? parseInt(monthMatch[1]) : 0;

                // Fallback: If no recognized format, default to 1 year
                if (addYears === 0 && addMonths === 0) {
                    addYears = 1;
                }

                // 3. Calculate new date
                date.setFullYear(date.getFullYear() + addYears);
                date.setMonth(date.getMonth() + addMonths);

                // 4. Format: ~YY.MM.DD
                const yy = String(date.getFullYear()).slice(-2);
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                const warrantyText = `~${yy}.${mm}.${dd}`;

                // 5. Update state and UI
                asListRows[index].warranty = warrantyText;
                const inputEl = document.getElementById(`warrantyInput_${index}`);
                if (inputEl) inputEl.value = warrantyText;

                saveASList();
                showToast(`Î≥¥Ï¶ùÍ∏∞Í∞Ñ(${durationStr})Ïù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.`, 'success');

            } catch (e) {
                console.error("Invalid Date Calculation", e);
                showToast('ÎÇ†Ïßú Í≥ÑÏÇ∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        function updateASListRow(index, field, value) {
            asListRows[index][field] = value;
            saveASList();
        }

        function removeASListRow(index) {

            asListRows.splice(index, 1);
            renderASListTable();
            saveASList();
        }

        function saveASList() {
            if (!currentData) return;
            currentData.as_list = asListRows;
            saveCustomers();
        }

        async function syncASListFromCloud() {
            if (!confirm('Í≤ΩÍ≥†: ÌòÑÏû¨ Î™©Î°ùÏù¥ Ï¥àÍ∏∞ÌôîÎêòÍ≥† Google SheetÏùò Ï†ÑÏ≤¥ A/S Î¶¨Ïä§Ìä∏Î°ú ÍµêÏ≤¥Îê©ÎãàÎã§.\nÍ≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            const btn = document.querySelector('button[onclick="syncASListFromCloud()"]');
            const originalText = btn ? btn.innerHTML : '';
            if (btn) {
                btn.innerHTML = '‚è≥ Î∂àÎü¨Ïò§Îäî Ï§ë...';
                btn.disabled = true;
            }

            try {
                // Use 'as_list' to hit handleASListGet
                const params = new URLSearchParams({ sheet: 'as_list' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.result === 'success' && result.items) {
                    // Populate asListRows with ALL items from the DB
                    asListRows = result.items.map(item => ({
                        category: item.category || '',
                        brand: item.brand || '',
                        item: item.item || '',
                        modelNum: item.modelNum || '',
                        size: item.size || '',
                        price: item.price || '',
                        service: item.service || '',
                        warranty: item.warranty || '',
                        note: item.note || ''
                    }));

                    // Also update the global AS_DB for dropdowns
                    AS_DB = result.items;

                    renderASListTable();
                    saveASList();
                    showToast(`Ï†ÑÏ≤¥ ${asListRows.length}Í∞úÏùò Ìï≠Î™©ÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.`, 'success');
                } else {
                    throw new Error(result.message || 'Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }

            } catch (error) {
                console.error('Error syncing AS list:', error);
                showToast('Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            }
        }

        // ============================
        // [Ïã†Í∑ú] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• (Settlement Management)
        // ============================
        let settlementRows = [];
        let settlementDirty = false; // UX: Track unsaved changes
        let settlementOptionsData = []; // [Ïã†Í∑ú] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• ÏòµÏÖò ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞

        // [Ïã†Í∑ú] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• ÏòµÏÖò ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        async function fetchSettlementMaster() {
            try {
                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=settlement&action=getSettlementOptions`);
                const result = await response.json();
                if (result.result === 'success' && result.options) {
                    settlementOptionsData = result.options;
                    console.log('‚úÖ Ï†ïÏÇ∞ ÏòµÏÖò ÎßàÏä§ÌÑ∞ Î°úÎìú ÏôÑÎ£å:', settlementOptionsData.length + 'Í∞ú');

                    // Ï†ïÏÇ∞ ÌÉ≠Ïù¥ Ïó¥Î†§ÏûàÎã§Î©¥ Í∞±Ïã†
                    if (document.getElementById('panel-settlement').classList.contains('active')) {
                        renderSettlementTable();
                    }
                } else {
                    console.warn('‚ö†Ô∏è Ï†ïÏÇ∞ ÏòµÏÖò ÎßàÏä§ÌÑ∞ Î°úÎìú Ïã§Ìå® ÎòêÎäî ÎπÑÏñ¥ÏûàÏùå.');
                }
            } catch (error) {
                console.error('Ï†ïÏÇ∞ ÏòµÏÖò ÎßàÏä§ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•ò:', error);
            }
        }

        function formatNumberInput(input) {
            let value = input.value.replace(/,/g, '');
            if (!isNaN(value) && value !== '') {
                input.value = Number(value).toLocaleString();
            }
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù
        const SETTLEMENT_CATEGORIES = [
            'Í∞ÄÏÑ§Í≥µÏÇ¨', 'Ï≤†Í±∞Í≥µÏÇ¨', 'ÏÑ§ÎπÑ/Î∞©ÏàòÍ≥µÏÇ¨', 'Ï†ÑÍ∏∞/Ï°∞Î™ÖÍ≥µÏÇ¨', 'ÏóêÏñ¥Ïª®Í≥µÏÇ¨',
            'Ï∞ΩÌò∏Í≥µÏÇ¨', 'Î™©Í≥µ/ÎèÑÏñ¥Í≥µÏÇ¨', 'ÌÉÄÏùºÍ≥µÏÇ¨', 'ÏöïÏã§Í≥µÏÇ¨', 'ÌïÑÎ¶ÑÍ≥µÏÇ¨',
            'ÎèÑÏû•Í≥µÏÇ¨', 'Î∞îÎã•Ïû¨Í≥µÏÇ¨', 'ÎèÑÎ∞∞Í≥µÏÇ¨', 'Í∞ÄÍµ¨Í≥µÏÇ¨', 'Ï§ëÎ¨∏Í≥µÏÇ¨',
            'ÎßàÍ∞êÍ≥µÏÇ¨', 'Í∏∞ÌÉÄÍ≥µÏÇ¨'
        ];

        // Í±∞ÎûòÏ≤ò Ï†ïÎ≥¥ ÏûêÎèô ÏôÑÏÑ±ÏùÑ ÏúÑÌïú ÎèÑÏö∞ÎØ∏ Ìï®Ïàò
        function autoFillPartnerInfo(index, clientName) {
            if (!clientName) return;
            // ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêú Ï†ïÏÇ∞ ÌñâÎì§Ïù¥ÎÇò Í≥ºÍ±∞ Í∏∞Î°ùÏóêÏÑú Ìï¥Îãπ Í±∞ÎûòÏ≤òÏùò Ï†ïÎ≥¥Í∞Ä ÏûàÎäîÏßÄ Ï∞æÏùå
            const match = settlementRows.find((r, idx) => idx !== index && r.client === clientName && (r.bizId || r.bankInfo));
            if (match) {
                if (!settlementRows[index].bizId) settlementRows[index].bizId = match.bizId;
                if (!settlementRows[index].bankInfo) settlementRows[index].bankInfo = match.bankInfo;
                if (!settlementRows[index].payType) settlementRows[index].payType = match.payType;
                if (!settlementRows[index].costType) settlementRows[index].costType = match.costType;
            }
        }

        function onSettlementCategoryChange(index, value) {
            if (value === '__DIRECT_INPUT__') {
                const custom = prompt('Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                if (custom) {
                    settlementRows[index].category = custom;
                    settlementRows[index].process = '';
                    settlementRows[index].client = '';
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index].category = value;
                settlementRows[index].process = '';
                settlementRows[index].client = '';
            }
            renderSettlementTable();
            saveSettlementToLocal();
        }

        function onSettlementProcessChange(index, value) {
            if (value === '__DIRECT_INPUT__') {
                const custom = prompt('Í≥µÏ†ïÎ™ÖÏùÑ ÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                if (custom) {
                    settlementRows[index].process = custom;
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index].process = value;
            }

            // Í≥µÏ†ï ÏÑ†ÌÉù Ïãú Í∏∞Î≥∏ Îã¥ÎãπÏûê ÏûêÎèô ÏÑ∏ÌåÖ
            const row = settlementRows[index];
            if (row.process) {
                // 1. Îß§Ïπ≠ ÏÜåÏä§ Í≤∞Ï†ï (Ï†ïÏÇ∞ DB Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ Ïä§ÏºÄÏ§Ñ DB)
                // ÎßåÏïΩ Ï†ïÏÇ∞ ÏòµÏÖò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶ø ÏÇ¨Ïö© (Fallback)
                const sourceData = (settlementOptionsData && settlementOptionsData.length > 0) ? settlementOptionsData : defaultScheduleSteps;
                const isSettlementMaster = (sourceData === settlementOptionsData);

                // 2. DBÏóêÏÑú Îß§Ïπ≠ ÌôïÏù∏
                const matches = sourceData.filter(s => {
                    const cat1 = (row.category || '').replace(/\s/g, '').replace('Í≥µÏÇ¨', '');
                    const cat2 = (s.category || '').replace(/\s/g, '').replace('Í≥µÏÇ¨', '');
                    return (cat1 === cat2 || cat1.includes(cat2) || cat2.includes(cat1)) &&
                        (isSettlementMaster ? s.process : s.name) === row.process;
                });

                if (matches.length > 0 && !row.client) {
                    const matchedItem = matches[0];
                    const clientName = isSettlementMaster ? matchedItem.client : matchedItem.inCharge;

                    if (clientName) {
                        settlementRows[index].client = clientName;

                        // Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÏûêÎèô Í∏∞ÏûÖ (Ï†ïÏÇ∞ DBÏù∏ Í≤ΩÏö∞Îßå Í∞ÄÎä•)
                        if (isSettlementMaster) {
                            if (matchedItem.costType) settlementRows[index].costType = matchedItem.costType;
                            if (matchedItem.payType) settlementRows[index].payType = matchedItem.payType;
                            if (matchedItem.bizId) settlementRows[index].bizId = matchedItem.bizId;
                            if (matchedItem.bankInfo) settlementRows[index].bankInfo = matchedItem.bankInfo;
                        }

                        // Í≥ºÍ±∞ Í∏∞Î°ù Ï∞∏Ï°∞ (Fallback)
                        autoFillPartnerInfo(index, clientName);
                    }
                }
            }
            renderSettlementTable();
            saveSettlementToLocal();
        }

        function renderSettlementTable() {
            const tbody = document.getElementById('settlementTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            let totalPayAmount = 0; // Ï¥ù Í≤∞Ï†úÍ∏àÏï°

            settlementRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                const payAmount = parseInt(String(row.payAmount || '0').replace(/,/g, ''), 10) || 0;
                totalPayAmount += payAmount;

                // 1. Ïπ¥ÌÖåÍ≥†Î¶¨ ÏòµÏÖò ÏÉùÏÑ± (ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ DB Í∏∞Ï§Ä)
                // ÎßåÏïΩ Ï†ïÏÇ∞ ÏòµÏÖò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶ø ÏÇ¨Ïö© (Fallback)
                const sourceData = (settlementOptionsData && settlementOptionsData.length > 0) ? settlementOptionsData : defaultScheduleSteps;
                const isSettlementMaster = (sourceData === settlementOptionsData);

                const combinedCategories = [...new Set([
                    ...SETTLEMENT_CATEGORIES,
                    ...(sourceData.map(s => s.category).filter(Boolean))
                ])];

                let categoryOptions = '<option value="">ÏÑ†ÌÉù</option>';
                categoryOptions += '<option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option>';
                combinedCategories.forEach(cat => {
                    categoryOptions += `<option value="${cat}" ${row.category === cat ? 'selected' : ''}>${cat}</option>`;
                });
                if (row.category && !combinedCategories.includes(row.category)) {
                    categoryOptions = `<option value="">ÏÑ†ÌÉù</option><option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option><option value="${row.category}" selected>${row.category}</option>` +
                        combinedCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                }

                // 2. Í≥µÏ†ïÎ∂ÑÎ•ò ÏòµÏÖò ÏÉùÏÑ± (DB Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
                // [ÏàòÏ†ï] Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• DB(ÎòêÎäî Ïä§ÏºÄÏ§Ñ)Î•º Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠
                const filteredSteps = sourceData.filter(s => {
                    if (!row.category) return true;
                    // Comparison relaxed: 1. Remove "Í≥µÏÇ¨", 2. Remove spaces, 3. Remove leading numbers (e.g., "01.")
                    const normalize = (str) => (str || '').replace(/^\d+\.?\s*/, '').replace(/\s/g, '').replace('Í≥µÏÇ¨', '');
                    const cat1 = normalize(row.category);
                    const cat2 = normalize(s.category);

                    return cat1 === cat2 || cat1.includes(cat2) || cat2.includes(cat1);
                });

                // Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§Ïóê Îî∞Îùº ÌÇ§Í∞Ä Îã§Î¶Ñ (settlementOptionsData: process, defaultScheduleSteps: name)
                const uniqueProcesses = [...new Set(filteredSteps.map(s => isSettlementMaster ? s.process : s.name).filter(Boolean))];
                let processOptions = '<option value="">ÏÑ†ÌÉù</option>';
                processOptions += '<option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option>';
                uniqueProcesses.forEach(p => {
                    processOptions += `<option value="${p}" ${row.process === p ? 'selected' : ''}>${p}</option>`;
                });
                if (row.process && !uniqueProcesses.includes(row.process)) {
                    processOptions = `<option value="">ÏÑ†ÌÉù</option><option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option><option value="${row.process}" selected>${row.process}</option>` +
                        uniqueProcesses.map(p => `<option value="${p}">${p}</option>`).join('');
                }

                // 3. Í±∞ÎûòÏ≤ò/ÏûëÏóÖÏûê ÏòµÏÖò ÏÉùÏÑ± (Í≥µÏ†ïÎ™Ö Í∏∞Î∞ò ÌïÑÌÑ∞ÎßÅ + Í≥ºÍ±∞ Í∏∞Î°ù)
                let availableClients = [];
                if (row.process) {
                    availableClients = sourceData
                        .filter(s => (isSettlementMaster ? s.process : s.name) === row.process)
                        .map(s => isSettlementMaster ? s.client : s.inCharge)
                        .filter(Boolean);
                }
                const pastClients = settlementRows.map(r => r.client).filter(Boolean);
                const combinedClients = [...new Set([...availableClients, ...pastClients])];
                let clientOptions = '<option value="">ÏÑ†ÌÉù</option>';
                clientOptions += '<option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option>';
                combinedClients.forEach(c => {
                    clientOptions += `<option value="${c}" ${row.client === c ? 'selected' : ''}>${c}</option>`;
                });
                if (row.client && !combinedClients.includes(row.client)) {
                    clientOptions = `<option value="">ÏÑ†ÌÉù</option><option value="__DIRECT_INPUT__">üñäÔ∏è ÏßÅÏ†ë ÏûÖÎ†•</option><option value="${row.client}" selected>${row.client}</option>` +
                        combinedClients.map(c => `<option value="${c}">${c}</option>`).join('');
                }

                tr.setAttribute('draggable', 'true');
                tr.ondragstart = (e) => handleSettlementDragStart(e, index);
                tr.ondragover = handleSettlementDragOver;
                tr.ondrop = (e) => handleSettlementDrop(e, index);
                tr.ondragend = handleSettlementDragEnd;
                tr.style.cursor = 'move';

                tr.innerHTML = `
                    <td style="padding:5px; text-align:center; border:1px solid #d2d2d7; white-space:nowrap;">
                        <span style="cursor:grab; margin-right:4px; color:#999;">‚ò∞</span>
                        <button onclick="removeSettlementRow(${index})" style="background:none; border:none; color:#ff3b30; cursor:pointer; font-size:14px; margin-right:4px;" title="ÏÇ≠Ï†ú">üóëÔ∏è</button>
                        <span style="font-size:11px; color:#666;">${index + 1}</span>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="onSettlementCategoryChange(${index}, this.value)" style="width:100%; border:none; background:transparent; font-size:11px;">
                            ${categoryOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="onSettlementProcessChange(${index}, this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" ${row.category ? '' : 'disabled'}>
                            ${processOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="updateSettlementRow(${index}, 'client', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" ${row.process ? '' : 'disabled'}>
                            ${clientOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.costType || ''}" onchange="updateSettlementRow(${index}, 'costType', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ÎπÑÏö©Íµ¨Î∂Ñ">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" value="${row.payType || ''}" onchange="updateSettlementRow(${index}, 'payType', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ÎåÄÍ∏àÎ∞©Ïãù">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.bizId || ''}" onchange="updateSettlementRow(${index}, 'bizId', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ÏÇ¨ÏóÖÏûêÎ≤àÌò∏">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.bankInfo || ''}" onchange="updateSettlementRow(${index}, 'bankInfo', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ÏùÄÌñâ/Í≥ÑÏ¢å">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${Number(payAmount).toLocaleString()}" onkeyup="formatNumberInput(this); updateSettlementRow(${index}, 'payAmount', this.value.replace(/,/g,''))" style="width:100%; border:none; background:transparent; font-size:11px; text-align:right;">
                    </td>
                     <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="date" value="${row.payDate || ''}" onchange="updateSettlementRow(${index}, 'payDate', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="updateSettlementRow(${index}, 'payStatus', this.value)" style="width:100%; border:none; background:transparent; font-size:11px; color:${row.payStatus === 'ÏßÄÍ∏âÏôÑÎ£å' ? '#0071e3' : (row.payStatus === 'ÎØ∏ÏßÄÍ∏â' ? '#ff3b30' : '#333')}">
                            <option value="">ÏÑ†ÌÉù</option>
                            <option value="ÎØ∏ÏßÄÍ∏â" ${(row.payStatus || '').trim() === 'ÎØ∏ÏßÄÍ∏â' ? 'selected' : ''}>ÎØ∏ÏßÄÍ∏â</option>
                            <option value="ÏßÄÍ∏âÏôÑÎ£å" ${(row.payStatus || '').trim() === 'ÏßÄÍ∏âÏôÑÎ£å' ? 'selected' : ''}>ÏßÄÍ∏âÏôÑÎ£å</option>
                            <option value="Î∂ÄÎ∂ÑÏßÄÍ∏â" ${(row.payStatus || '').trim() === 'Î∂ÄÎ∂ÑÏßÄÍ∏â' ? 'selected' : ''}>Î∂ÄÎ∂ÑÏßÄÍ∏â</option>
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.note || ''}" onchange="updateSettlementRow(${index}, 'note', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ÎπÑÍ≥†">
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Ìï©Í≥Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            // Ìï©Í≥Ñ Í≥ÑÏÇ∞
            const totalIncome = currentData && currentData.totalAmount ? parseInt(String(currentData.totalAmount).replace(/,/g, '')) || 0 : 0;
            const totalExpense = totalPayAmount;
            const profit = totalIncome - totalExpense;
            const profitRate = totalIncome > 0 ? ((profit / totalIncome) * 100).toFixed(1) : 0;

            // Ìï©Í≥Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('settlementTotalIncome').innerText = totalIncome.toLocaleString();
            document.getElementById('settlementTotalExpense').innerText = totalExpense.toLocaleString();
            document.getElementById('settlementProfit').innerText = profit.toLocaleString();
            document.getElementById('settlementProfitRate').innerText = profitRate + '%';

            // ÏÉâÏÉÅ Ï≤òÎ¶¨
            document.getElementById('settlementProfit').style.color = profit >= 0 ? '#34c759' : '#ff3b30';
            document.getElementById('settlementProfitRate').style.color = profit >= 0 ? '#333' : '#ff3b30';
        }

        function addSettlementRow() {
            settlementRows.push({
                category: '',
                process: '',
                client: '',
                costType: '',
                payType: '',
                bizId: '',
                bankInfo: '',
                payAmount: 0,
                payDate: '',
                payStatus: 'ÎØ∏ÏßÄÍ∏â',
                note: ''
            });
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function removeSettlementRow(index) {
            settlementRows.splice(index, 1);
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function updateSettlementRow(index, field, value) {
            if (field === 'client' && value === '__DIRECT_INPUT__') {
                const custom = prompt('Í±∞ÎûòÏ≤òÎ™ÖÏùÑ ÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                if (custom) {
                    settlementRows[index].client = custom;
                    autoFillPartnerInfo(index, custom);
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index][field] = value;
                if (field === 'client') {
                    autoFillPartnerInfo(index, value);
                }
            }
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function saveSettlementToLocal() {
            if (currentData) {
                currentData.settlementRows = settlementRows;
                saveCustomers(); // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû•
            }
        }

        // UX: Set dirty state and update indicator
        function setSettlementDirty(dirty) {
            settlementDirty = dirty;
            const indicator = document.getElementById('settlementDirtyIndicator');
            const saveBtn = document.getElementById('btnSaveSettlement');

            if (indicator) {
                if (dirty) {
                    indicator.textContent = '‚ö†Ô∏è Ï†ÄÏû•ÎêòÏßÄ ÏïäÏùÄ Î≥ÄÍ≤ΩÏÇ¨Ìï≠';
                    indicator.style.color = '#ff9500';
                    indicator.style.display = 'inline-block';
                } else {
                    indicator.textContent = '‚úÖ Ï†ÄÏû•Îê®';
                    indicator.style.color = '#34c759';
                    indicator.style.display = 'inline-block';
                    setTimeout(() => { if (!settlementDirty) indicator.style.display = 'none'; }, 3000);
                }
            }

            if (saveBtn) {
                if (dirty) {
                    saveBtn.style.background = '#ff9500';
                    saveBtn.style.animation = 'pulse 1.5s infinite';
                    saveBtn.innerHTML = 'üíæ Ï†ÄÏû•ÌïòÍ∏∞ <span style="background:#fff;color:#ff9500;padding:1px 6px;border-radius:10px;font-size:10px;margin-left:4px;">!</span>';
                } else {
                    saveBtn.style.background = '#0071e3';
                    saveBtn.style.animation = 'none';
                    saveBtn.innerHTML = 'üíæ Ï†ÄÏû•ÌïòÍ∏∞';
                }
            }
        }

        // [Ï∂îÍ∞Ä] Ï†ïÏÇ∞ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî (Í∏∞Î≥∏ Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú)
        function initializeSettlementRows() {
            if (typeof SETTLEMENT_CATEGORIES === 'undefined') return;
            settlementRows = SETTLEMENT_CATEGORIES.map(cat => ({
                category: cat,
                process: '',
                client: '',
                costType: '',
                payType: '', // [ÏàòÏ†ï] payMethod -> payType
                bizId: '',
                bankInfo: '',
                payAmount: 0, // [ÏàòÏ†ï] amount -> payAmount
                payDate: '', // [ÏàòÏ†ï] date -> payDate
                payStatus: 'ÎØ∏ÏßÄÍ∏â', // [ÏàòÏ†ï] status -> payStatus
                note: '' // [ÏàòÏ†ï] memo -> note
            }));
            renderSettlementTable();
            saveSettlementToLocal();
        }

        // Íµ¨Í∏Ä ÏãúÌä∏ÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
        async function syncSettlementFromCloud() {
            // [ÏàòÏ†ï] ID Ï≤¥ÌÅ¨ Í∞ïÌôî (id ÎòêÎäî customerId)
            const custId = currentData ? (currentData.id || currentData.customerId) : null;
            if (!custId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            const btn = document.getElementById('btnLoadSettlement');
            const originalText = btn ? btn.innerText : '';
            if (btn) {
                btn.innerText = '‚è≥ Ïó∞ÎèôÏ§ë...';
                btn.disabled = true;
            }

            try {
                // ÏòµÏÖò ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ Î®ºÏ†Ä ÎèôÍ∏∞Ìôî
                await fetchSettlementMaster();

                const params = new URLSearchParams({
                    sheet: 'settlement',
                    customerId: custId
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.result === 'success') {
                    if (result.rows && result.rows.length > 0) {
                        settlementRows = result.rows;
                        showToast('Ï†ïÏÇ∞ ÎÇ¥Ïó≠ Î∞è ÏòµÏÖòÏùÑ ÎèôÍ∏∞ÌôîÌñàÏäµÎãàÎã§.', 'success');
                        logUserAction('Î∂àÎü¨Ïò§Í∏∞', (currentData.clientName || '') + ' Ï†ïÏÇ∞ ÎÇ¥Ïó≠ Î∂àÎü¨Ïò§Í∏∞');
                    } else {
                        // [Î≥ÄÍ≤Ω] Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±
                        initializeSettlementRows();
                        showToast('Ï†ÄÏû•Îêú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏñ¥ Í∏∞Î≥∏ Ìï≠Î™©ÏùÑ ÏÉùÏÑ±ÌñàÏäµÎãàÎã§.', 'info');
                    }
                    renderSettlementTable();
                    saveSettlementToLocal();
                } else {
                    throw new Error(result.error || 'Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®');
                }
            } catch (err) {
                console.error(err);
                showToast('Ïó∞Îèô Ïã§Ìå®: ' + err.message, 'error');
            } finally {
                if (btn) {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            }
        }

        // Íµ¨Í∏Ä ÏãúÌä∏Î°ú Ï†ÄÏû•ÌïòÍ∏∞
        async function syncSettlementToCloud() {
            // [ÏàòÏ†ï] ID Ï≤¥ÌÅ¨ Í∞ïÌôî
            const custId = currentData ? (currentData.id || currentData.customerId) : null;
            if (!custId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            if (!confirm('ÌòÑÏû¨ Ï†ïÏÇ∞ ÎÇ¥Ïó≠ÏùÑ Íµ¨Í∏Ä ÏãúÌä∏Ïóê Ï†ÄÏû•(ÎçÆÏñ¥Ïì∞Í∏∞)ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            const btn = document.getElementById('btnSaveSettlement');
            if (btn) {
                btn.innerHTML = '‚è≥ Ï†ÄÏû•Ï§ë...';
                btn.disabled = true;
                btn.style.animation = 'none';
            }

            try {
                // Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞ Íµ¨ÏÑ±
                const payload = {
                    action: 'updateSettlement',
                    customerId: custId,
                    customerName: currentData.clientName,
                    rows: settlementRows
                };

                // sendDataToAppsScript Ìï®Ïàò Ïû¨ÏÇ¨Ïö© (ÎòêÎäî ÏßÅÏ†ë fetch)
                // Ïó¨Í∏∞ÏÑúÎäî ÏßÅÏ†ë fetch Íµ¨ÌòÑ (post)
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload) // sendBeacon ÎåÄÏã† ÏùºÎ∞ò fetch ÏÇ¨Ïö© (Í≤∞Í≥º ÌôïÏù∏ ÌïÑÏöî)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    showToast('Ï†ïÏÇ∞ ÎÇ¥Ïó≠Ïù¥ Íµ¨Í∏Ä ÏãúÌä∏Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
                    setSettlementDirty(false); // UX: Clear dirty state on success
                    logUserAction('Ï†ÄÏû•', (currentData.clientName || '') + ' Ï†ïÏÇ∞ ÎÇ¥Ïó≠ Ï†ÄÏû•');
                } else {
                    throw new Error(result.error || 'Ï†ÄÏû• Ïã§Ìå®');
                }

            } catch (err) {
                console.error(err);
                showToast('Ï†ÄÏû• Ïã§Ìå®: ' + (err.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    // Button text/style will be set by setSettlementDirty if success
                    if (settlementDirty) {
                        btn.innerHTML = 'üíæ Ï†ÄÏû•ÌïòÍ∏∞ <span style="background:#fff;color:#ff9500;padding:1px 6px;border-radius:10px;font-size:10px;margin-left:4px;">!</span>';
                        btn.style.background = '#ff9500';
                        btn.style.animation = 'pulse 1.5s infinite';
                    }
                }
            }
        }

        // Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• Ïù∏ÏáÑ
        function printSettlement() {
            const panel = document.getElementById('panel-settlement');
            if (!panel) {
                showToast('Ïù∏ÏáÑÌï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            const customerName = currentData?.clientName || currentData?.projectName || 'Í≥†Í∞ùÎ™ÖÏóÜÏùå';
            const printContent = panel.innerHTML;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• - ${customerName}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; padding: 20px; }
                        .doc-header { padding: 20px; border-bottom: 2px solid #333; margin-bottom: 20px; }
                        .doc-header h1 { font-size: 24px; }
                        .subtitle { font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
                        th { background: #f5f5f5; font-weight: 600; }
                        select, input { border: none; background: transparent; font-size: 11px; }
                        button, .no-print { display: none !important; }
                        @media print {
                            body { padding: 0; }
                            @page { margin: 15mm; }
                        }
                    </style>
                </head>
                <body>
                    <div style="text-align:center; margin-bottom:20px;">
                        <h2>Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû•</h2>
                        <p style="color:#666; font-size:14px;">${customerName}</p>
                        <p style="color:#999; font-size:11px;">Ïù∏ÏáÑÏùº: ${new Date().toLocaleDateString('ko-KR')}</p>
                    </div>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);

            // Î°úÍ∑∏ Í∏∞Î°ù
            logUserAction('Ïù∏ÏáÑ', (currentData?.clientName || customerName) + ' Ï†ïÏÇ∞ Í¥ÄÎ¶¨ ÎåÄÏû• Ïù∏ÏáÑ');
        }

        // Settlement Drag & Drop Handlers
        let draggedSettlementIndex = null;

        function handleSettlementDragStart(e, index) {
            draggedSettlementIndex = index;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', index);
            setTimeout(() => e.target.style.opacity = '0.5', 0);
        }

        function handleSettlementDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleSettlementDrop(e, index) {
            e.stopPropagation();
            e.preventDefault();

            if (draggedSettlementIndex !== null && draggedSettlementIndex !== index) {
                // Î∞∞Ïó¥ ÏàúÏÑú Î≥ÄÍ≤Ω
                const item = settlementRows.splice(draggedSettlementIndex, 1)[0];
                settlementRows.splice(index, 0, item);

                renderSettlementTable();
                saveSettlementToLocal();
            }
            return false;
        }

        function handleSettlementDragEnd(e) {
            e.target.style.opacity = '1';
            draggedSettlementIndex = null;
        }

        // Existing Schedule Drag & Drop (Reference)
        let draggedIndex = null;
        function handleDragStart(e, index) {
            draggedIndex = index;
            e.target.style.opacity = '0.4';
        }
        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedIndex = null;
        }
        function handleDragOver(e) {
            e.preventDefault();
        }
        function handleDrop(e, index) {
            e.preventDefault();
            if (draggedIndex === null || draggedIndex === index) return;
            const item = scheduleRows.splice(draggedIndex, 1)[0];
            scheduleRows.splice(index, 0, item);
            renderScheduleTable();
            saveScheduleToCustomer();
        }


        function syncAllFields() {
            // [Auth Check]
            if (!currentData) return;

            // [Auto-Calc] ÏûîÍ∏àÏùº Í∏∞Î∞ò A/S Ï¢ÖÎ£åÏùº ÏûêÎèô Í≥ÑÏÇ∞ Î∞è Ï†ÄÏû• (Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ ÎïåÎßå)
            if (currentData.finalPaymentDate && !currentData.asEndDate) {
                const fDate = new Date(currentData.finalPaymentDate);
                if (!isNaN(fDate.getTime())) {
                    fDate.setMonth(fDate.getMonth() + 12);
                    currentData.asEndDate = fDate.toISOString().split('T')[0];
                }
            }

            // 1. Input Fields
            document.querySelectorAll('.synced-input').forEach(field => {
                field.value = currentData[field.dataset.sync] || '';
            });

            // 2. Display Fields (.synced-display)
            document.querySelectorAll('.synced-display').forEach(field => {
                let value = currentData[field.dataset.sync] || '-';

                // 1) A/S Í∏∞Í∞Ñ (warrantyPeriod) Í≥ÑÏÇ∞ Î°úÏßÅ
                if (field.dataset.sync === 'warrantyPeriod') {
                    if (currentData.asEndDate) {
                        // ÏûîÍ∏àÏùºÏù¥ ÏûàÏúºÎ©¥ "ÏûîÍ∏àÏùº ~ Ï¢ÖÎ£åÏùº" ÌëúÏãú
                        value = currentData.finalPaymentDate ? `${currentData.finalPaymentDate} ~ ${currentData.asEndDate}` : `~ ${currentData.asEndDate}`;
                    } else if (currentData.asWarrantyEnd) {
                        value = `~ ${currentData.asWarrantyEnd}`;
                    }
                }
                field.textContent = value;
            });

            // 3. A/S List Special Fields
            const asInfo1 = document.getElementById('asClientInfo1');
            const asInfo2 = document.getElementById('asClientInfo2');
            if (asInfo1 && asInfo2) {
                // ÎùºÏù∏ 1: Î≥∏Ïù∏ ÏÑ±Î™Ö (Ïó∞ÎùΩÏ≤ò)
                let name1 = currentData.clientName || '';
                const phone1 = currentData.clientPhone || '';
                if (name1 && phone1) name1 += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(phone1) : phone1})`;
                asInfo1.textContent = name1;

                // ÎùºÏù∏ 2: Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö (Ïó∞ÎùΩÏ≤ò)
                let name2 = currentData.spouseName || '';
                const phone2 = currentData.spousePhone || '';
                if (name2) {
                    if (phone2) name2 += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(phone2) : phone2})`;
                    asInfo2.textContent = name2;
                } else {
                    asInfo2.textContent = '';
                }
            }

            const leakEl = document.getElementById('bathroomLeakWarranty');
            if (leakEl) {
                leakEl.textContent = currentData.leakWarrantyEnd ? `~ ${currentData.leakWarrantyEnd}` : '-';
            }

            // 4. [FIX] Schedule Tab Fields Force Sync
            // Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ ÌÉ≠Ïùò ID ÏöîÏÜåÎì§Ïù¥ synced-display ÌÅ¥ÎûòÏä§Í∞Ä ÏóÜÏñ¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏßÄ ÏïäÎäî Î¨∏Ï†ú Ìï¥Í≤∞
            if (document.getElementById('schPeriod')) {
                document.getElementById('schPeriod').textContent = currentData.constructionPeriod || '';

                let areaText = (currentData.area || '').toString().replace(' PY', '');
                if (areaText) areaText += ' PY';
                document.getElementById('schArea').textContent = areaText;

                document.getElementById('schMoveDate').textContent = currentData.movingDate || '';

                // Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏ (Î≥∏Ïù∏) - ÏÑ±Î™Ö (Ïó∞ÎùΩÏ≤ò)
                let clientInfo = '';
                if (currentData.clientName) {
                    clientInfo = currentData.clientName + ' Í≥†Í∞ùÎãò';
                    if (currentData.clientPhone) clientInfo += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(currentData.clientPhone) : currentData.clientPhone})`;
                }
                document.getElementById('schClient1').textContent = clientInfo;

                // Í≥µÏÇ¨ ÏùòÎ¢∞Ïù∏ (Î∞∞Ïö∞Ïûê) - ÏÑ±Î™Ö (Ïó∞ÎùΩÏ≤ò) -> Schedule ÌÉ≠Ïùò input ÌïÑÎìúÏóê Ìï†Îãπ
                const client2Input = document.querySelector('.sch-input[data-field="client2"]');
                if (client2Input) {
                    let spouseInfo = currentData.spouseName || '';
                    if (spouseInfo && currentData.spousePhone) {
                        spouseInfo += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(currentData.spousePhone) : currentData.spousePhone})`;
                    }
                    client2Input.value = spouseInfo;
                }

                document.getElementById('schSiteAddr').textContent = currentData.siteAddress || '';
            }

            const rep = document.getElementById('companyRep');
            if (rep) {
                document.querySelectorAll('.company-sync').forEach(f => f.value = rep.value);
            }
        }

        async function exportASListToNotion() {
            if (!currentData.clientName) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            // [UI ÌÜµÏùº] confirm Ï∞Ω Ï†úÍ±∞ÌïòÍ≥† ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄÎ°ú ÎåÄÏ≤¥
            showToast('ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞Î•º ÏãúÏûëÌï©ÎãàÎã§...', 'info');

            const btn = document.querySelector('button[title="ÎÖ∏ÏÖòÏúºÎ°ú A/S Î¶¨Ïä§Ìä∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞"]');

            if (btn) {
                btn.innerHTML = '‚è≥ ÎÇ¥Î≥¥ÎÇ¥Îäî Ï§ë...';
                btn.disabled = true;
            }

            try {
                const exportData = {
                    manager: currentData.manager || '',
                    period: currentData.warrantyPeriod || '',
                    balanceDate: currentData.balanceDate || '',
                    clientName: currentData.clientName || '',
                    clientPhone: currentData.clientPhone || '',
                    spouseName: currentData.spouseName || '',
                    spousePhone: currentData.spousePhone || '',
                    siteAddress: currentData.siteAddress || '',
                    leakWarranty: currentData.leakWarrantyEnd || '',
                    guidelines: getASGuidelinesArray(), // [Ï∂îÍ∞Ä] A/S Ïú†ÏùòÏÇ¨Ìï≠ Î∞∞Ïó¥
                    items: typeof asListRows !== 'undefined' ? asListRows : []
                };

                const payload = {
                    action: 'exportToNotion',
                    type: 'asList',
                    customerId: currentData.customerId,
                    data: JSON.stringify(exportData)
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('‚úÖ ÎÖ∏ÏÖòÏúºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏôÑÎ£å!', 'success');
                } else {
                    throw new Error(result.message || 'ÎèôÍ∏∞Ìôî Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Notion Sync Error:', error);
                showToast('ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = 'üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞';
                    btn.disabled = false;
                }
            }
        }

        async function saveCustomers() {
            // Phase 2: ÌÅ¥ÎùºÏö∞ÎìúÎ°ú Ï†ÄÏû• (Source of Truth: Google Sheets)
            if (!currentData || !currentData.customerId) {
                console.log('‚ùå [Web Save] No customer selected, skipping save');
                return;
            }

            console.log('üì§ [Web Save] ========== SAVE START ==========');
            console.log('üìã [Web Save] Customer ID:', currentData.customerId);
            console.log('üìã [Web Save] Checklist Items Count:', Object.keys(currentData.checklistData || {}).length);

            try {
                const payload = {
                    sheetName: 'Í≥†Í∞ùÍ¥ÄÎ¶¨_Í≤¨Ï†ÅÏÑú',
                    data: {
                        customerId: currentData.customerId || '',
                        clientName: currentData.clientName || '',
                        clientPhone: currentData.clientPhone || '',
                        clientEmail: currentData.clientEmail || '',
                        status: currentData.status || '',
                        createdAt: currentData.createdAt || new Date().toISOString(),
                        clientAddress: currentData.clientAddress || '',
                        projectName: currentData.projectName || '',
                        siteAddress: currentData.siteAddress || '',
                        constructionPeriod: currentData.constructionPeriod || '',
                        movingDate: currentData.movingDate || '',
                        finalPaymentDate: currentData.finalPaymentDate || '',
                        contractDate: currentData.contractDate || '',
                        warrantyPeriod: currentData.asEndDate || '',
                        asEndDate: currentData.asEndDate || '',
                        pyeong: currentData.area || '',
                        inflowPath: currentData.clientSource || '',
                        buildingType: currentData.buildingType || '',
                        totalAmount: currentData.totalAmount || '',
                        estimateProfitRate: currentData.profitRate || '15%',
                        manager: currentData.manager || '',
                        updatedAt: new Date().toISOString().split('T')[0],
                        jsonData: JSON.stringify(currentData)
                    }
                };

                console.log('üì¶ [Web Save] jsonData contains checklistData?', payload.data.jsonData.includes('checklistData'));

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                console.log('üì° [Web Save] Response status:', response.status);

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('‚úÖ [Web Save] Save successful:', result);
                } catch (e) {
                    console.warn('‚ö†Ô∏è [Web Save] Response is not JSON:', responseText);
                    result = { success: true, message: responseText };
                }

                // Google Apps Script returns {result: 'success'} or {success: true}
                if (result.success || result.result === 'success') {
                    console.log('‚úÖ [Web Save] ========== SAVE COMPLETE ==========');
                } else {
                    console.error('‚ùå [Web Save] Save failed:', result.message || 'Unknown error');
                    showToast('Ï†ÄÏû• Ïã§Ìå®: ' + (result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }

                return result;

            } catch (error) {
                console.error('‚ùå [Web Save] Error:', error);
                showToast('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                throw error;
            }
        }

        async function newCustomer() {
            if (!isLoggedIn()) {
                showToast('Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                showAdminModal();
                return;
            }
            if (isAppBusy) return;

            const name = prompt('Í≥†Í∞ùÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (!name) {
                showToast('Í≥†Í∞ùÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            setAppBusy(true, 'ÏµúÏã† Ï†ïÎ≥¥ ÌôïÏù∏ Ï§ë...');
            // [Task 3] Stabilization: Ensure fresh state before creation
            try {
                // 1. Sync to get latest ID/Count
                const syncSuccess = await syncFromCloud(true);
                if (!syncSuccess) {
                    setAppBusy(false);
                    if (!confirm('Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Í∑∏ÎûòÎèÑ ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå? (ID Ï§ëÎ≥µ ÏúÑÌóò)')) return;
                    setAppBusy(true, 'Ïã†Í∑ú Í≥†Í∞ù ÏÉùÏÑ± Ï§ë...');
                } else {
                    setAppBusy(true, 'Ïã†Í∑ú Í≥†Í∞ù ÏÉùÏÑ± Ï§ë...');
                }

                // 2. Generate ID using fresh count
                const cloudCount = cachedCloudCount;
                const now = new Date();
                const yy = now.getFullYear().toString().slice(-2);
                const mm = String(now.getMonth() + 1).padStart(2, '0');
                const dd = String(now.getDate()).padStart(2, '0');
                const seq = String(cloudCount + 1).padStart(3, '0');
                currentCustomerId = `${yy}${mm}${dd} -${seq} `;

                // Double check collision locally
                if (customers.some(c => c.customerId === currentCustomerId)) {
                    const seq2 = String(cloudCount + 2).padStart(3, '0');
                    currentCustomerId = `${yy}${mm}${dd} -${seq2} `;
                }

                currentData = {
                    customerId: currentCustomerId,
                    clientName: name,
                    projectName: '',
                    status: 'consulting',
                    createdAt: new Date().toISOString().split('T')[0],
                    profitRate: '15%',
                    createdBy: currentAdmin?.id || 'unknown',
                    isLocked: false,
                    manager: 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)'
                };

                // 3. Save to Cloud Immediately (Source of Truth)
                const payload = {
                    action: 'update_customer',
                    ...currentData
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                const res = await response.json();
                if (res.result !== 'success') {
                    throw new Error(res.message || 'Server Error');
                }

                // 4. Update Local State
                customers.push({ ...currentData });
                cachedCloudCount++;

                document.querySelectorAll('.customer-field').forEach(f => {
                    f.value = f.dataset.field === 'profitRate' ? '15%' : '';
                });
                document.getElementById('customerStatus').value = 'consulting';
                document.getElementById('asEndDateDisplay').style.display = 'none';
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('customerView').style.display = 'block';
                document.getElementById('headerCustomerName').textContent = 'Ïã†Í∑ú Í≥†Í∞ù';
                document.getElementById('headerCustomerId').textContent = currentCustomerId;

                const clientNameField = document.querySelector('.customer-field[data-field="clientName"]');
                if (clientNameField) clientNameField.value = name;
                const projectNameField = document.querySelector('.customer-field[data-field="projectName"]');
                if (projectNameField) projectNameField.value = '';
                document.getElementById('headerCustomerName').textContent = name;

                clearCostData();
                currentData.estimateData = {};
                currentData.estimateProfitRate = 15;
                categories.forEach(cat => {
                    delete currentData[`estMemo_${cat.no}`];
                });

                scheduleRows = [];
                asListRows = [];
                settlementRows = [];
                currentData.schedules = [];
                currentData.as_list = [];
                currentData.settlementRows = [];
                currentData.checklistData = {};
                currentData.checklistFilters = {
                    checklistStageFilter: ['all'],
                    checklistCategoryFilter: ['all']
                };

                loadEstimateData();
                if (typeof renderScheduleTable === 'function') renderScheduleTable();
                if (typeof renderASListTable === 'function') renderASListTable();
                if (typeof renderSettlementTable === 'function') renderSettlementTable();
                if (typeof renderChecklistItems === 'function') renderChecklistItems();
                if (typeof loadSavedChecklistState === 'function') loadSavedChecklistState(true);

                initYearFilter();
                updateCustomerList();
                syncAllFields();

                showToast('Ïã†Í∑ú Í≥†Í∞ùÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.', 'success');

            } catch (e) {
                console.error('New Customer Error:', e);
                showPersistentAlert(`Ïã†Í∑ú Í≥†Í∞ù ÏÉùÏÑ± Ïã§Ìå®: ${e.message}`, 'error');
            } finally {
                setAppBusy(false);
            }
        }

        function selectCustomer(customerId) {
            if (typeof showMainView === 'function') showMainView('customer');
            fetchASListDB(); // Load A/S DB if not already loaded
            const customer = customers.find(c => c.customerId === customerId);
            if (!customer) return;

            // [Performance Optimization] Lazy Parsing
            // Only parse the heavy checklistData when the customer is actually selected.
            if (!customer.checklistData && customer.jsonData && typeof customer.jsonData === 'string' && customer.jsonData.trim().startsWith('{')) {
                try {
                    const parsed = JSON.parse(customer.jsonData);

                    // Normalize checklistData logic from syncFromCloud
                    let normalizedData = {};
                    if (parsed.checklistData) {
                        if (typeof parsed.checklistData === 'object') {
                            Object.entries(parsed.checklistData).forEach(([key, value]) => {
                                // Handle nested object {checked: true} or simple boolean
                                if (value && typeof value === 'object' && 'checked' in value) {
                                    normalizedData[key] = value.checked;
                                } else if (typeof value === 'boolean') {
                                    normalizedData[key] = value;
                                } else {
                                    normalizedData[key] = !!value; // Fallback
                                }
                            });
                        }
                    }
                    customer.checklistData = normalizedData;
                    console.log('‚úÖ [Lazy Parse] Parsed checklistData for', customer.clientName);
                } catch (e) {
                    console.warn('‚ö†Ô∏è Lazy parse failed for', customer.clientName, e);
                    customer.checklistData = {};
                }
            }

            currentCustomerId = customerId;

            // Legacy Data Compatibility (Cloud Compatibility Fix)
            // Ensure old keys (pyeong, inflowPath) map to new inputs (area, clientSource)
            customer.clientSource = customer.clientSource || customer.inflowPath || '';
            customer.area = customer.area || customer.pyeong || '';

            // 'py' ÌëúÍ∏∞Î•º 'Ìèâ'ÏúºÎ°ú ÏûêÎèô Î≥ÄÌôò (Í∏∞Ï°¥ Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Ìò∏Ìôò)
            if (customer.area && /^\d+py$/i.test(String(customer.area).trim())) {
                customer.area = customer.area.replace(/py$/i, 'Ìèâ');
            }

            if (!customer.profitRate && customer.estimateProfitRate) {
                // Format estimateProfitRate if it's just a number
                let rate = String(customer.estimateProfitRate);
                if (/^\d+$/.test(rate)) rate += '%';
                customer.profitRate = rate;
            }


            if (!customer.manager || customer.manager.trim() === '') {
                customer.manager = 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)';
            }


            currentData = { ...customer };

            // Ï†ëÍ∑º Ï†úÌïú ÌôïÏù∏
            if (document.getElementById('accessDeniedOverlay')) {
                const isLocked = isCustomerLocked();
                document.getElementById('accessDeniedOverlay').style.display = isLocked ? 'flex' : 'none';
                if (isLocked) {
                    document.getElementById('lockedPasswordInput').value = '';
                }
            }

            // Í∂åÌïúÏóê Îî∞Î•∏ ÏûÖÎ†• ÎπÑÌôúÏÑ±Ìôî (Î≥∏Ïù∏ ÏûëÏÑ± Í±¥Îßå ÏàòÏ†ï Í∞ÄÎä•)
            const editable = canEdit();
            document.querySelectorAll('.customer-field, #customerStatus').forEach(el => {
                el.disabled = !editable;
            });
            const delBtn = document.querySelector('.delete-btn');
            if (delBtn) delBtn.style.visibility = (editable && !isCustomerLocked()) ? 'visible' : 'hidden';

            document.querySelectorAll('.customer-field').forEach(f => {
                f.value = currentData[f.dataset.field] || '';
            });
            document.getElementById('customerStatus').value = currentData.status || 'consulting';

            // A/S Í∏∞Í∞Ñ ÌëúÏãú
            const asDisplay = document.getElementById('asEndDateDisplay');
            if (currentData.status === 'as_done' && currentData.asEndDate) {
                asDisplay.textContent = `A / S ~${currentData.asEndDate} `;
                asDisplay.style.display = 'block';
            } else {
                asDisplay.style.display = 'none';
            }

            const emptyStateEl = document.getElementById('emptyState');
            if (emptyStateEl) emptyStateEl.style.display = 'none';
            const customerViewEl = document.getElementById('customerView');
            if (customerViewEl) customerViewEl.style.display = 'block';
            const headerNameEl = document.getElementById('headerCustomerName');
            if (headerNameEl) headerNameEl.textContent = currentData.projectName || currentData.clientName || 'Í≥†Í∞ùÎ™Ö ÏóÜÏùå';
            const headerIdEl = document.getElementById('headerCustomerId');
            if (headerIdEl) headerIdEl.textContent = currentCustomerId;
            loadCostData();
            loadEstimateData();

            // [Data Consistency] Atomic switch for all modular datasets
            if (typeof loadScheduleForCustomer === 'function') loadScheduleForCustomer(currentCustomerId);
            if (typeof loadASList === 'function') loadASList(currentCustomerId);

            settlementRows = currentData.settlementRows || [];
            if (typeof renderSettlementTable === 'function') renderSettlementTable();

            if (typeof renderChecklistItems === 'function') renderChecklistItems();
            if (typeof loadSavedChecklistState === 'function') loadSavedChecklistState(true);

            // [PERFORMANCE FIX] Direct DOM update for selection state
            // updateCustomerList(false); // Removed full re-render

            // Remove active class from previous selection
            document.querySelectorAll('.customer-item.active').forEach(el => el.classList.remove('active'));

            // Add active class to new selection
            // Use robust data attribute selector
            const activeItem = document.querySelector(`.customer-item[data-customer-id="${currentCustomerId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            syncAllFields();
            updateLockUI(); // Ïû†Í∏à ÏÉÅÌÉú Î∞è ÏûëÏÑ±Ïûê ÌëúÏãú

            // [DATE FIX] input[type="date"] requires YYYY-MM-DD format.
            // Convert any stored dots (YYYY.MM.DD) to dashes.
            ['movingDate', 'contractDate', 'finalPaymentDate'].forEach(field => {
                const el = document.querySelector(`.customer-field[data-field="${field}"]`);
                if (el && currentData[field]) {
                    el.value = currentData[field].replace(/\./g, '-');
                }
            });

            // [CONSTRUCTION PERIOD FIX] Split string into two date inputs
            if (currentData.constructionPeriod) {
                // Îã§ÏñëÌïú ÌòïÏãù ÏßÄÏõê: "2025.01.01 ~ 2025.03.01" ÎòêÎäî "2025-01-01 ~ 2025-03-01"
                const periodStr = currentData.constructionPeriod.replace(/\s+/g, ''); // Î™®Îì† Í≥µÎ∞± Ï†úÍ±∞
                const parts = periodStr.split('~');
                if (parts.length > 0 && parts[0]) {
                    // Ï†êÏùÑ ÎåÄÏãúÎ°ú Î≥ÄÌôòÌïòÏó¨ date inputÏóê ÏÑ§Ï†ï
                    document.getElementById('constructionStartInput').value = parts[0].replace(/\./g, '-').trim();
                }
                if (parts.length > 1 && parts[1]) {
                    document.getElementById('constructionEndInput').value = parts[1].replace(/\./g, '-').trim();
                }
            } else {
                document.getElementById('constructionStartInput').value = '';
                document.getElementById('constructionEndInput').value = '';
            }

            // Main Dashboard Renewal: Default to Dashboard
            showCustomerTab('dashboard');
            if (typeof renderDashboard === 'function') renderDashboard();
        }

        function updateConstructionPeriod() {
            const start = document.getElementById('constructionStartInput').value;
            const end = document.getElementById('constructionEndInput').value;
            const hiddenInput = document.getElementById('hiddenConstructionPeriod');

            if (start && end) {
                // ÏùºÍ¥ÄÎêú ÌòïÏãùÏúºÎ°ú Ï†ÄÏû•: "YYYY.MM.DD ~ YYYY.MM.DD"
                hiddenInput.value = `${start.replace(/-/g, '.')} ~ ${end.replace(/-/g, '.')}`;
            } else if (start) {
                hiddenInput.value = `${start.replace(/-/g, '.')}`;
            } else {
                hiddenInput.value = '';
            }
            // Trigger standard update
            updateCustomerField(hiddenInput);
        }

        // Phone Number Auto-format (Same logic as quote.html)
        function autoFormatPhone(el) {
            let value = el.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);

            if (value.length <= 3) { el.value = value; } else if (value.length <= 7) {
                el.value = value.slice(0, 3) + '-' +
                    value.slice(3);
            } else { el.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7); }
        }

        // Area Auto-format (Ïà´ÏûêÎßå ÏûÖÎ†• Ïãú 'Ìèâ' Ï∂îÍ∞Ä)
        function autoFormatArea(el) {
            let value = el.value.trim();
            if (!value) return;
            // Ïà´ÏûêÎßå ÏûÖÎ†•Îêú Í≤ΩÏö∞ 'Ìèâ' Î∂ôÏù¥Í∏∞
            if (/^\d+$/.test(value)) {
                el.value = value + 'Ìèâ';
            }
            // 'py'Í∞Ä Ìè¨Ìï®Îêú Í≤ΩÏö∞ 'Ìèâ'ÏúºÎ°ú Î≥ÄÌôò
            else if (/^\d+py$/i.test(value)) {
                el.value = value.replace(/py$/i, 'Ìèâ');
            }
        }

        // Profit Rate Auto-format (add '%')
        function autoFormatProfit(el) {
            let value = el.value.trim();
            if (!value) return;
            if (/^\d+$/.test(value)) { el.value = value + ' % '; }
        }

        function updateCustomerField(el) {
            const fieldName = el.dataset.field;
            const oldValue = currentData[fieldName] || '';
            const newValue = el.value;

            // Î≥ÄÍ≤ΩÏù¥ ÏóÜÏúºÎ©¥ Î°úÍ∑∏ ÏïàÎÇ®ÍπÄ
            if (oldValue === newValue) {
                return;
            }

            currentData[fieldName] = newValue;

            // customers Î∞∞Ïó¥ÏóêÎèÑ Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï¶âÏãú Î∞òÏòÅ
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1) {
                customers[customerIndex][fieldName] = newValue;
            }

            if (fieldName === 'clientName' || fieldName === 'projectName') {
                const displayName = currentData.projectName || currentData.clientName || 'Í≥†Í∞ùÎ™Ö ÏóÜÏùå';
                document.getElementById('headerCustomerName').textContent = displayName;
            }

            // [Ï∂îÍ∞Ä] ÏûëÏóÖ Í∏∞Î°ù Î°úÍ∑∏
            const fieldLabels = {
                clientName: 'Í≥†Í∞ùÎ™Ö',
                projectName: 'ÌòÑÏû•Î™Ö',
                phone: 'Ïó∞ÎùΩÏ≤ò',
                email: 'Ïù¥Î©îÏùº',
                address: 'Ï£ºÏÜå',
                area: 'ÌèâÏàò',
                buildingType: 'Í±¥Î¨ºÏú†Ìòï',
                clientSource: 'Ïú†ÏûÖÍ≤ΩÎ°ú',
                movingDate: 'ÏûÖÏ£ºÏòàÏ†ïÏùº',
                contractDate: 'Í≥ÑÏïΩÏùº',
                constructionPeriod: 'Í≥µÏÇ¨Í∏∞Í∞Ñ',
                totalAmount: 'Ï¥ù Í≥ÑÏïΩÍ∏àÏï°',
                finalPaymentDate: 'ÏûîÍ∏àÏùº',
                manager: 'Í≥µÏÇ¨Îã¥ÎãπÏûê',
                memo: 'Î©îÎ™®',
                profitRate: 'Ïù¥ÏùµÎ•†'
            };
            const label = fieldLabels[fieldName] || fieldName;
            logUserAction(`${label} ÏàòÏ†ï`, `"${newValue}"`);

            syncAllFields();
        }
        function updateStatus() {
            const status = document.getElementById('customerStatus').value;
            const oldStatus = currentData.status;
            currentData.status = status;

            // [Ï∂îÍ∞Ä] ÏÉÅÌÉú Î≥ÄÍ≤Ω Î°úÍ∑∏
            const statusLabelsKo = {
                consulting: 'ÏÉÅÎã¥Ï§ë',
                hold: 'Î≥¥Î•ò',
                budget_over: 'ÏòàÏÇ∞Ï¥àÍ≥º',
                other_company: 'ÌÉÄÏÇ¨Í≥ÑÏïΩ',
                contracted: 'Í≥ÑÏïΩÏôÑÎ£å',
                in_progress: 'Í≥µÏÇ¨Ï§ë',
                completed: 'Í≥µÏÇ¨ÏôÑÎ£å',
                as_done: 'A/SÏôÑÎ£å',
                trash: 'Ìú¥ÏßÄÌÜµ'
            };
            logUserAction('ÏÉÅÌÉú Î≥ÄÍ≤Ω', `${statusLabelsKo[oldStatus] || oldStatus} ‚Üí ${statusLabelsKo[status] || status}`);

            // Auto-fill Contract Date if status is 'contracted'
            if (status === 'contracted' && !currentData.contractDate) {
                const today = new Date().toISOString().split('T')[0];
                currentData.contractDate = today;
                const contractField = document.querySelector('.customer-field[data-field="contractDate"]');
                if (contractField) contractField.value = today;
                showToast('Í≥ÑÏïΩÏùºÏù¥ Ïò§Îäò ÎÇ†ÏßúÎ°ú ÏûêÎèô ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§');
            }
            // Auto-calculate A/S End Date if status is 'as_done'
            if (status === 'as_done') {
                calculateAsEndDate();
            }
            const asDisplay = document.getElementById('asEndDateDisplay');
            if (status === 'as_done' && currentData.asEndDate) {
                asDisplay.textContent = `A/S ~${currentData.asEndDate}`;
                asDisplay.style.display = 'block';
            } else {
                asDisplay.style.display = 'none';
            }
            updateCustomerList();

            // Auto-sync to Google Sheets on status change
            saveCustomers(); // Save locally first
            syncToGoogleSheets({ ...currentData }); // Sync to cloud
            showToast(`ÏÉÅÌÉúÍ∞Ä '${statusLabelsKo[status] || status}'(Ïúº)Î°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§`, 'success');
        }
        function updateAsDate() {
            // A/S ÎÇ†ÏßúÎäî ÏûîÍ∏àÏùº Í∏∞Ï§Ä ÏûêÎèô Í≥ÑÏÇ∞ÏúºÎ°ú Î≥ÄÍ≤ΩÎê®
        }
        function calculateAsEndDate() {
            const finalPaymentDate = currentData.finalPaymentDate;
            if (finalPaymentDate) {
                const date = new Date(finalPaymentDate);
                date.setMonth(date.getMonth() + 12);
                const endDate = date.toISOString().split('T')[0];
                currentData.asEndDate = endDate;
                const asEndField = document.querySelector('.customer-field[data-field="asEndDate"]');
                if (asEndField) asEndField.value = endDate;
                syncAllFields();
            }
        }
        function deleteCurrentCustomer() {
            if (!currentCustomerId) return;

            // 1. Permission check
            if (!canDelete()) {
                showToast('ÏÇ≠Ï†ú Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§ (Î≥∏Ïù∏ ÏûëÏÑ± Í±¥Îßå ÏÇ≠Ï†ú Í∞ÄÎä•)', 'error');
                return;
            }

            // 2. Lock check
            if (isCustomerLocked()) {
                showToast('Ïû†Í∏à ÏÑ§Ï†ïÎêú Í≥†Í∞ùÏûÖÎãàÎã§. Î©îÏù∏Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.', 'error');
                return;
            }

            // 3. Confirm Soft Delete
            if (!confirm('Ìú¥ÏßÄÌÜµÏúºÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Î≥µÍµ¨Îäî Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Í∞ÄÎä•Ìï©ÎãàÎã§)')) return;

            // 4. Perform Soft Delete (Trash)
            const index = customers.findIndex(c => c.customerId === currentCustomerId);
            if (index !== -1) {
                const deletedName = customers[index].clientName || customers[index].projectName || currentCustomerId;
                customers[index].status = 'trash';
                customers[index].deletedAt = new Date().toISOString();
                customers[index].deletedBy = currentAdmin.id;

                // [Ï∂îÍ∞Ä] ÏÇ≠Ï†ú Î°úÍ∑∏
                logUserAction('Ìú¥ÏßÄÌÜµÏúºÎ°ú Ïù¥Îèô', deletedName);

                saveCustomers();
                showToast('Ìú¥ÏßÄÌÜµÏúºÎ°ú Ïù¥ÎèôÎêòÏóàÏäµÎãàÎã§', 'success');

                // Reset View
                currentCustomerId = null;
                currentData = {};
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('customerView').style.display = 'none';
                updateCustomerList();
            }
        }

        // [New] Global Main Board Rendering
        function renderMainBoard() {
            const grid = document.getElementById('mainBoardGrid');
            if (!grid) return;

            // [NEW] Filters
            const yearFilter = document.getElementById('mbYearFilter')?.value;
            const statusFilter = document.getElementById('mbStatusFilter')?.value;

            // Filter Logic
            let filtered = customers.filter(c => {
                // Year Check
                let date = c.contractDate || c.consultDate || '';
                let year = date.split('-')[0];
                if (yearFilter && year !== yearFilter) return false;

                // Status Check
                if (statusFilter && c.status !== statusFilter) return false;

                return true;
            });

            // Stats Logic (Update based on filtered view)
            const total = filtered.length;
            const inProgress = filtered.filter(c => c.status === 'in_progress').length;

            const statsTotalEl = document.getElementById('statsTotal');
            const statsProgressEl = document.getElementById('statsProgress');

            if (statsTotalEl) statsTotalEl.innerText = total;
            if (statsProgressEl) statsProgressEl.innerText = inProgress;

            // Sort
            const sorted = [...filtered].sort((a, b) => {
                const dateA = a.contractDate || '0000-00-00';
                const dateB = b.contractDate || '0000-00-00';
                return dateB.localeCompare(dateA);
            });

            grid.innerHTML = sorted.map(c => {
                let statusClass = 'status-consulting';
                if (c.status === 'estimate') statusClass = 'status-estimate';
                else if (c.status === 'contracted') statusClass = 'status-contracted';
                else if (c.status === 'in_progress') statusClass = 'status-in_progress';
                else if (c.status === 'completed' || c.status === 'as_done') statusClass = 'status-completed';

                const statusMap = {
                    'consulting': 'ÏÉÅÎã¥Ï§ë', 'estimate': 'Í≤¨Ï†Å', 'contracted': 'Í≥ÑÏïΩÏôÑÎ£å',
                    'in_progress': 'Í≥µÏÇ¨Ï§ë', 'completed': 'ÏôÑÎ£å', 'as_done': 'A/S',
                    'hold': 'Î≥¥Î•ò', 'budget_over': 'ÏòàÏÇ∞Ï¥àÍ≥º', 'other_company': 'ÌÉÄÏóÖÏ≤¥'
                };
                const statusText = statusMap[c.status] || c.status;

                return `
                    <div class="project-card" onclick="selectCustomer('${c.customerId}')">
                        <div class="project-card-header">
                            <div class="project-card-title">${c.clientName || 'Í≥†Í∞ùÎ™Ö ÏóÜÏùå'}</div>
                            <div class="project-card-client">${c.projectName || ''}</div>
                            <div class="project-card-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="project-card-footer">
                             <div>${c.siteAddress || '-'}</div>
                             <div>${c.manager ? c.manager.split(' ')[0] : 'ÎØ∏ÏßÄÏ†ï'}</div>
                        </div>
                    </div>
                 `;
            }).join('');
        }

        function updateCustomerList(resetPage = true) {
            const container = document.getElementById('customerList');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;

            // ÌïÑÌÑ∞ÎßÅ
            filteredCustomers = customers.filter(c => {
                // customerIdÍ∞Ä ÏóÜÎäî Ìï≠Î™© Ï†úÏô∏
                if (!c.customerId) return false;

                // Ìú¥ÏßÄÌÜµ Ìï≠Î™© Ï†úÏô∏
                if (c.status === 'trash') return false;

                const matchSearch = [c.name, c.phone, c.siteAddress, c.projectName].join(' ').toLowerCase().includes(searchTerm);
                const matchStatus = currentStatusFilter === 'all' || c.status === currentStatusFilter;

                // ÎÖÑ/Ïõî ÌïÑÌÑ∞ (customerId Í∏∞Ï§Ä: YYMMDD-XXX)
                let matchDate = true;
                if (yearFilter || monthFilter) {
                    const idParts = (c.customerId || '').split('-')[0];
                    if (idParts && idParts.length >= 4) {
                        const year = '20' + idParts.substring(0, 2);
                        const month = idParts.substring(2, 4);
                        if (yearFilter && year !== yearFilter) matchDate = false;
                        if (monthFilter && month !== monthFilter) matchDate = false;
                    }
                }

                return matchSearch && matchStatus && matchDate;
            });

            // ÏµúÏã†Ïàú Ï†ïÎ†¨ (customerId Í∏∞Ï§Ä: YYMMDD-XXX)
            filteredCustomers.sort((a, b) => {
                // createdAtÏù¥ ÏûàÏúºÎ©¥ Ïö∞ÏÑ† ÏÇ¨Ïö©
                if (a.createdAt && b.createdAt) {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                // customerIdÎ°ú Ï†ïÎ†¨ (ÎÇ¥Î¶ºÏ∞®Ïàú) - YYMMDD-NNN ÌòïÏãù
                const aId = a.customerId || '';
                const bId = b.customerId || '';
                const [aDate, aNum] = aId.split('-');
                const [bDate, bNum] = bId.split('-');
                // ÎÇ†Ïßú ÎπÑÍµê (ÎÇ¥Î¶ºÏ∞®Ïàú)
                if (aDate !== bDate) {
                    return bDate.localeCompare(aDate);
                }
                // Í∞ôÏùÄ ÎÇ†ÏßúÎ©¥ Î≤àÌò∏ ÎπÑÍµê (ÎÇ¥Î¶ºÏ∞®Ïàú)
                return parseInt(bNum || 0) - parseInt(aNum || 0);
            });

            // ÌéòÏù¥ÏßÄ Î¶¨ÏÖã (ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïãú)
            if (resetPage) {
                currentPage = 1;
            }

            // ÌéòÏù¥Ïßï Ï†ÅÏö© Ïó¨Î∂Ä Í≤∞Ï†ï
            const paginationContainer = document.getElementById('paginationContainer');
            const usePaging = filteredCustomers.length >= PAGE_THRESHOLD;

            if (usePaging) {
                // ÌéòÏù¥Ïßï UI ÌëúÏãú
                paginationContainer.style.display = 'block';

                const totalPages = Math.ceil(filteredCustomers.length / ITEMS_PER_PAGE);
                const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, filteredCustomers.length);
                const pageItems = filteredCustomers.slice(startIdx, endIdx);

                // ÌéòÏù¥Ïßï Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                document.getElementById('paginationInfo').textContent =
                    `Ï†ÑÏ≤¥ ${filteredCustomers.length}Î™Ö Ï§ë ${startIdx + 1}-${endIdx}Î™Ö ÌëúÏãú`;
                document.getElementById('currentPageSpan').textContent =
                    `${currentPage} / ${totalPages}`;
                document.getElementById('prevPageBtn').disabled = currentPage <= 1;
                document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;

                // ÌéòÏù¥ÏßïÎêú Î™©Î°ù Î†åÎçîÎßÅ
                renderCustomerItems(container, pageItems);
            } else {
                // ÌéòÏù¥Ïßï UI Ïà®ÍπÄ
                paginationContainer.style.display = 'none';

                // Ï†ÑÏ≤¥ Î™©Î°ù Î†åÎçîÎßÅ
                renderCustomerItems(container, filteredCustomers);
            }
            // [NEW] Update Main Board if visible
            const mainBoard = document.getElementById('mainBoardView');
            if (mainBoard && mainBoard.style.display !== 'none') {
                if (typeof renderMainBoard === 'function') renderMainBoard();
            }
        }

        // [NEW] Î©îÏù∏ Î≥¥Îìú Î≥¥Í∏∞ (Ìôà Î≤ÑÌäº)
        function showMainBoardView() {
            // 1. Í≥†Í∞ù ÏÉÅÏÑ∏ Î∑∞ Ïà®Í∏∞Í∏∞
            const customerView = document.getElementById('customerView');
            if (customerView) customerView.style.display = 'none';

            // 2. Î©îÏù∏ Î≥¥Îìú Î≥¥Ïù¥Í∏∞
            const mainBoard = document.getElementById('mainBoardView');
            if (mainBoard) {
                mainBoard.style.display = 'block';
                renderMainBoard(); // Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†
            }

            // 3. ÏÇ¨Ïù¥ÎìúÎ∞î ÏÑ†ÌÉù Ìï¥Ï†ú
            const activeItems = document.querySelectorAll('.customer-item.active');
            activeItems.forEach(el => el.classList.remove('active'));

            // 4. ÏÉÅÌÉú Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
            currentCustomerId = null;
        }

        // Í≥†Í∞ù Î™©Î°ù ÏïÑÏù¥ÌÖú Î†åÎçîÎßÅ (Í≥µÌÜµ)
        function renderCustomerItems(container, items) {
            if (items.length === 0) {
                container.innerHTML = '<div style="padding:30px 16px;text-align:center;color:#86868b;font-size:12px;">Ìï¥Îãπ Ï°∞Í±¥Ïùò Í≥†Í∞ùÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
            } else {
                container.innerHTML = items.map(c => {
                    let statusKey = (c.status || '').trim();
                    if (!statusLabels[statusKey] && statusLabels[statusKey.toLowerCase()]) {
                        statusKey = statusKey.toLowerCase();
                    }
                    let statusText = statusLabels[statusKey] || c.status;
                    if (c.status === 'as_done' && c.asEndDate) {
                        statusText = `A/S ~${c.asEndDate}`;
                    }
                    // [MOD] Format: Name | Spouse | Project
                    let displayParts = [];
                    if (c.clientName || c.name) displayParts.push(c.clientName || c.name);
                    if (c.spouseName) displayParts.push(c.spouseName);
                    displayParts.push(c.projectName || 'ÌòÑÏû•Î™Ö ÎØ∏ÏßÄÏ†ï');
                    const displayName = displayParts.join(' | ');

                    // Sub info: Site Address only
                    let subInfo = c.siteAddress || 'Ï£ºÏÜå ÎØ∏ÏûÖÎ†•';
                    const lockIcon = c.isLocked ? 'üîí' : '';
                    const creatorInfo = c.createdBy ? ` / <span style="color:#ff9500; font-weight:600;">${c.createdBy}</span>` : '';
                    // [ÏàòÏ†ï] ÎÇ†Ïßú(updatedAt) Ï†úÍ±∞ - Í≥†Í∞ùÎ™©Î°ùÏóêÏÑú ÎÇ†Ïßú ÌëúÏãú ÏïàÌï®

                    return `
                <div class="customer-item ${c.customerId === currentCustomerId ? 'active' : ''}"
                    data-customer-id="${c.customerId}"
                    onclick="selectCustomer('${c.customerId}')">
                    <div class="customer-item-header">
                        <span class="customer-item-id">${lockIcon}${c.customerId}${creatorInfo}</span>
                        <span class="status-badge ${statusKey}">${statusText}</span>
                    </div>
                    <div class="customer-item-name" style="font-weight: 700;">${displayName}</div>
                    <div class="customer-item-info">${subInfo}</div>
                </div>`;
                }).join('');
            }
        }

        // ÌéòÏù¥Ïßï Ìï®Ïàò
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateCustomerList(false);
            }
        }

        function goToNextPage() {
            const totalPages = Math.ceil(filteredCustomers.length / ITEMS_PER_PAGE);
            if (currentPage < totalPages) {
                currentPage++;
                updateCustomerList(false);
            }
        }

        // ÎÖÑÎèÑ ÌïÑÌÑ∞ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
        function initYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const years = new Set();

            customers.forEach(c => {
                if (!c.customerId) return; // customerIdÍ∞Ä ÏóÜÏúºÎ©¥ Í±¥ÎÑàÎõ∞Í∏∞
                const idParts = (c.customerId || '').split('-')[0];
                if (idParts && idParts.length >= 2) {
                    years.add('20' + idParts.substring(0, 2));
                }
            });

            // ÌòÑÏû¨ ÎÖÑÎèÑÎèÑ Ï∂îÍ∞Ä
            const currentYear = new Date().getFullYear().toString();
            years.add(currentYear);

            // Ï†ïÎ†¨ ÌõÑ ÏòµÏÖò Ï∂îÍ∞Ä
            const sortedYears = [...years].sort().reverse();
            yearFilter.innerHTML = '<option value="">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>' +
                sortedYears.map(y => `<option value = "${y}" > ${y}ÎÖÑ</option> `).join('');
        }

        function filterCustomers() { updateCustomerList(); }


        // ==========================================
        // [ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú DB Î≥µÍµ¨]
        // ==========================================
        async function restoreCostDB() {
            if (!isMainAdmin()) {
                showToast('Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå Ïã§ÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }

            if (!confirm('ÌòÑÏû¨ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî Îç∞Ïù¥ÌÑ∞Î°ú\nÍµ¨Í∏Ä ÏãúÌä∏Ïùò [ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§]Î•º ÏóÖÎç∞Ïù¥Ìä∏(Ï†ÄÏû•)Ìï©ÎãàÎã§.\n\nÍµ¨Í∏Ä ÏãúÌä∏Ïùò Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥Îê©ÎãàÎã§.\nÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            showToast('DB Ï†ÄÏû•(ÎèôÍ∏∞Ìôî) Ï§ë...', 'info');

            // DOMÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
            const rows = [];
            const categoryDivs = document.querySelectorAll('#costCategories .category-section');
            let totalItems = 0;

            categoryDivs.forEach(div => {
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö Ï∂îÏ∂ú (Ïòà: "01 Í∞ÄÏÑ§Í≥µÏÇ¨")
                const catText = div.querySelector('h3')?.innerText || '';
                // "01 " Ï†úÍ±∞ (ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥ÎÇò ÍπîÎÅîÌïòÍ≤å)
                const catName = catText.replace(/^[0-9]+\s*/, '').trim();

                const trs = div.querySelectorAll('tbody tr');

                trs.forEach(tr => {
                    const inputs = tr.querySelectorAll('input');
                    const select = tr.querySelector('select');

                    // inputs: 0=Íµ¨Î∂Ñ, 1=ÌíàÎ™Ö, 2=ÏÉÅÏÑ∏, 3=ÏàòÎüâ, 4=Îã®Í∞Ä
                    // (addCostRow Íµ¨Ï°∞ Í∏∞Ï§Ä)

                    const noVal = tr.querySelector('.col-no')?.textContent.trim() || '';
                    const name = inputs[1]?.value.trim() || '';
                    const spec = inputs[2]?.value.trim() || '';
                    const unit = select?.value || '';
                    const price = inputs[4]?.value.replace(/,/g, '') || '0';

                    // ÌíàÎ™ÖÏù¥ ÏûàÎäî Í≤ΩÏö∞Îßå Ï†ÄÏû•
                    if (name) {
                        // ['Ïπ¥ÌÖåÍ≥†Î¶¨', 'No', 'ÌíàÎ™Ö', 'ÏÉÅÏÑ∏ÎÇ¥Ïö©', 'Îã®ÏúÑ', 'Îã®Í∞Ä']
                        rows.push([catName, noVal, name, spec, unit, price]);
                        totalItems++;
                    }
                });
            });

            if (rows.length === 0) {
                showToast('Ï†ÄÏû•Ìï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }

            console.log(`Saving ${rows.length} items to DB...`, rows);

            try {
                // CORS Î™®Îìú: no-cors Ï†úÍ±∞
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'restoreCostDatabase',
                        data: rows
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`DB Ï†ÄÏû• ÏôÑÎ£å! (${result.message})`, 'success');
                } else {
                    // ÏóêÎü¨ Î©îÏãúÏßÄÍ∞Ä message ÌòπÏùÄ error ÌîÑÎ°úÌçºÌã∞Ïóê ÏûàÏùÑ Ïàò ÏûàÏùå
                    const errMsg = result.message || result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò';
                    showToast('Ï†ÄÏû• Ïã§Ìå®: ' + errMsg, 'error');
                }

            } catch (error) {
                console.error('DB Restore Error:', error);
                showToast('Ï†ÑÏÜ° Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ==========================================
        // [Ïª§Ïä§ÌÖÄ ÏïåÎ¶º Ìï®Ïàò] - ÏÇ¨ÎùºÏßÄÏßÄ ÏïäÎäî ÏïåÎ¶ºÏ∞Ω
        // ==========================================
        function showPersistentAlert(message, type = 'success') {
            showToast(message, type);
        }

        // ==========================================
        // [ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî] Google SheetsÏóêÏÑú Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        // ==========================================
        // [Helper] Normalize status for UI compatibility
        function normalizeCustomerStatus(customerList) {
            const statusMapNormalizer = {
                'ÏÉÅÎã¥Ï§ë': 'consulting',
                'Í≤¨Ï†Å': 'estimate', 'Í≤¨Ï†ÅÏÑú': 'estimate',
                'Í≥ÑÏïΩÏôÑÎ£å': 'contracted',
                'Í≥µÏÇ¨Ï§ë': 'in_progress',
                'ÏôÑÎ£å': 'completed',
                'Í≥µÏÇ¨ÏôÑÎ£å': 'completed',
                'ASÏôÑÎ£å': 'as_done', 'A/S': 'as_done', 'A/SÏôÑÎ£å': 'as_done',
                'Î≥¥Î•ò': 'hold',
                'ÏòàÏÇ∞Ï¥àÍ≥º': 'budget_over',
                'ÌÉÄÏóÖÏ≤¥': 'other_company', 'ÌÉÄÏÇ¨Í≥ÑÏïΩ': 'other_company'
            };

            customerList.forEach(c => {
                if (c.status && statusMapNormalizer[c.status]) {
                    c.status = statusMapNormalizer[c.status];
                }
                // Flatten key fields if needed (compatibility)
                if (!c.clientName && c.name) c.clientName = c.name;
            });
        }

        async function syncFromCloud(silent = false) {
            // [Task 3] Stabilization: Block UI during sync
            if (!silent) setAppBusy(true, 'ÏµúÏã† ÌòÑÏû• Î∂àÎü¨Ïò§Îäî Ï§ë...');

            try {
                // [Phase 1] Load recent items first for speed (Pagination)
                const INITIAL_LOAD_LIMIT = 50;
                // Add sorting param if supported, but relying on backend "Recent First" logic for page=1
                const params = new URLSearchParams({
                    sheet: 'Í≥†Í∞ùÍ¥ÄÎ¶¨_Í≤¨Ï†ÅÏÑú',
                    page: '1',
                    limit: INITIAL_LOAD_LIMIT.toString(),
                    t: new Date().getTime()
                });

                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                let initialData = await response.json();

                // Handle various response types (Array or {data: [], meta: {}})
                if (!Array.isArray(initialData) && initialData.data) {
                    initialData = initialData.data;
                } else if (!Array.isArray(initialData)) {
                    // If error object or unknown
                    if (initialData.error) throw new Error(initialData.error);
                    initialData = [];
                }

                if (initialData.length === 0) {
                    if (!silent) showToast('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                    customers = [];
                    updateCustomerList();
                    return true;
                }

                // 1. Normalize & Update UI immediately
                normalizeCustomerStatus(initialData);

                // Replace local data with cloud data
                cloudCustomers = initialData;
                customers = cloudCustomers;

                // Render List
                updateCustomerList(true);
                initYearFilter();

                // Unblock UI immediately
                if (!silent) {
                    setAppBusy(false);
                    // showToast(`ÏµúÏã† ${initialData.length}Í±¥ Î°úÎìú ÏôÑÎ£å`, 'success');
                }

                // [Phase 2] Load remaining data in background if needed
                // If we received a full page (limit reached), assume there is more.
                // If backend ignored 'limit' and sent 1000 items, length > limit.
                if (initialData.length >= INITIAL_LOAD_LIMIT) {
                    console.log('üîÑ [Background Sync] Fetching remaining data...');

                    const restParams = new URLSearchParams({
                        sheet: 'Í≥†Í∞ùÍ¥ÄÎ¶¨_Í≤¨Ï†ÅÏÑú',
                        page: '2',          // Get the rest
                        limit: '10000',     // Large limit
                        t: new Date().getTime()
                    });

                    // Background fetch - do not await
                    fetch(`${CUSTOMER_SYNC_URL}?${restParams}`)
                        .then(res => res.json())
                        .then(restData => {
                            let restList = restData;
                            if (!Array.isArray(restList) && restList.data) restList = restList.data;

                            if (Array.isArray(restList) && restList.length > 0) {
                                console.log(`üîÑ [Background Sync] Received ${restList.length} more records.`);
                                normalizeCustomerStatus(restList);

                                // Merge: We append restList to cloudCustomers
                                // (Assuming 'page=2' returns OLDER items if page=1 was recent)

                                // Use Map to ensure no duplicates in case of overlap or ID collision
                                const currentMap = new Map();
                                cloudCustomers.forEach(c => currentMap.set(c.customerId, c));
                                restList.forEach(c => currentMap.set(c.customerId, c));

                                // Update global list
                                cloudCustomers = Array.from(currentMap.values());
                                customers = cloudCustomers;

                                // Silent update (maintain scroll/page)
                                updateCustomerList(false);
                                initYearFilter();

                                console.log('‚úÖ [Background Sync] Complete. Total:', cloudCustomers.length);
                                if (!silent) showToast(`Ï†ÑÏ≤¥ ÎèôÍ∏∞Ìôî ÏôÑÎ£å (Ï¥ù ${cloudCustomers.length}Î™Ö)`, 'success');
                            }
                        })
                        .catch(err => console.error('Background fetch failed:', err));
                } else {
                    if (!silent) showToast(`ÎèôÍ∏∞Ìôî ÏôÑÎ£å (Ï¥ù ${cloudCustomers.length}Î™Ö)`, 'success');
                }

                return true;

            } catch (error) {
                console.error('‚ùå [Cloud Sync] Error:', error);
                if (!silent) showPersistentAlert(`ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî Ïã§Ìå®\n\n${error.message}`, 'error');
                return false;
            } finally {
                // Safety: Ensure busy is off
                if (!silent) setAppBusy(false);
            }
        }

        async function syncToGoogleSheets(data) {
            console.log('üì§ [Google Sheets Sync] Starting sync process...');
            console.log('üìã [Google Sheets Sync] Customer Data:', data);

            try {
                const statusKey = (data.status || '').trim();
                let koreanStatus = statusLabels[statusKey] || statusLabels[statusKey.toLowerCase()] || data.status;

                const payload = {
                    sheetName: 'Í≥†Í∞ùÍ¥ÄÎ¶¨_Í≤¨Ï†ÅÏÑú',
                    data: {
                        customerId: data.customerId || '',
                        clientName: data.clientName || '',
                        clientPhone: data.clientPhone || '',
                        clientEmail: data.clientEmail || '',
                        status: koreanStatus, // Send Korean status
                        createdAt: data.createdAt || new Date().toISOString(),
                        clientAddress: data.clientAddress || '',
                        projectName: data.projectName || '',
                        siteAddress: data.siteAddress || '',
                        constructionPeriod: data.constructionPeriod || '',
                        movingDate: data.movingDate || '',           // Ïù¥ÏÇ¨ÏòàÏ†ïÏùº Ï∂îÍ∞Ä
                        finalPaymentDate: data.finalPaymentDate || '', // ÏûîÍ∏àÏùº
                        contractDate: data.contractDate || '', // Í≥ÑÏïΩÏùº
                        warrantyPeriod: data.asEndDate ? (data.asEndDate) : '', // A/S Í∏∞Í∞Ñ
                        asEndDate: data.asEndDate || '',             // A/S Ï¢ÖÎ£åÏùº Ï∂îÍ∞Ä

                        pyeong: data.area || '',
                        inflowPath: data.clientSource || '',      // Ïú†ÏûÖÍ≤ΩÎ°ú
                        buildingType: data.buildingType || '',    // Í±¥Î¨ºÏú†Ìòï
                        totalAmount: data.totalAmount || '',
                        estimateProfitRate: data.profitRate || (data.estimateProfitRate ? data.estimateProfitRate + '%' : '15%'),
                        manager: data.manager || '',              // Îã¥ÎãπÏûê Ï∂îÍ∞Ä
                        updatedAt: data.updatedAt || '',          // ÏµúÏ¢ÖÏàòÏ†ïÏùº Ï∂îÍ∞Ä
                        jsonData: JSON.stringify(data)
                    }
                };


                console.log('üì¶ [Web Save] Payload:', payload);
                console.log('üì¶ [Web Save] Payload (full):', JSON.stringify(payload, null, 2));
                console.log('üì¶ [Web Save] jsonData field length:', payload.data.jsonData.length);
                console.log('üì¶ [Web Save] jsonData contains checklistData?', payload.data.jsonData.includes('checklistData'));

                // Parse jsonData to verify checklistData is included
                try {
                    const parsedJsonData = JSON.parse(payload.data.jsonData);
                    console.log('üì¶ [Web Save] Verified - checklistData in jsonData:', Object.keys(parsedJsonData.checklistData || {}).length, 'items');
                    if (parsedJsonData.checklistData && Object.keys(parsedJsonData.checklistData).length > 0) {
                        console.log('üì¶ [Web Save] Sample checklist items:', Object.entries(parsedJsonData.checklistData).slice(0, 3).map(([k, v]) => `${k}: ${v}`));
                    }
                } catch (e) {
                    console.error('‚ùå [Web Save] Failed to verify jsonData:', e);
                }

                console.log('üåê [Google Sheets Sync] Target URL:', CUSTOMER_SYNC_URL);

                // no-cors Î™®Îìú Ï†úÍ±∞ÌïòÏó¨ Ïã§Ï†ú ÏùëÎãµ ÌôïÏù∏ Í∞ÄÎä•
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                console.log('üì° [Google Sheets Sync] Response status:', response.status);
                console.log('üì° [Google Sheets Sync] Response headers:', [...response.headers.entries()]);

                // ÏùëÎãµ Î≥∏Î¨∏ ÌôïÏù∏
                const responseText = await response.text();
                console.log('üìÑ [Google Sheets Sync] Response text:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('‚úÖ [Google Sheets Sync] Parsed response:', result);
                } catch (e) {
                    console.warn('‚ö†Ô∏è [Google Sheets Sync] Response is not JSON:', responseText);
                }

                if (response.ok || response.status === 200) {
                    console.log('‚úÖ [Google Sheets Sync] Request completed successfully');
                    showToast('Íµ¨Í∏Ä ÏãúÌä∏ ÎèôÍ∏∞Ìôî ÏôÑÎ£å!', 'success');
                } else {
                    throw new Error(`HTTP${response.status}: ${responseText} `);
                }

            } catch (error) {
                console.error('‚ùå [Google Sheets Sync] Error:', error);
                console.error('‚ùå [Google Sheets Sync] Error name:', error.name);
                console.error('‚ùå [Google Sheets Sync] Error message:', error.message);
                console.error('‚ùå [Google Sheets Sync] Error stack:', error.stack);

                // CORS ÏóêÎü¨Ïù∏ Í≤ΩÏö∞ ÌäπÎ≥Ñ Ï≤òÎ¶¨
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showToast('Íµ¨Í∏Ä ÏãúÌä∏ ÎèôÍ∏∞Ìôî: CORS ÏóêÎü¨. GAS Î∞∞Ìè¨Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.', 'error');
                    console.error('üí° [Google Sheets Sync] Hint: Apps ScriptÍ∞Ä "Î™®Îì† ÏÇ¨Ïö©Ïûê(ÏùµÎ™Ö ÏÇ¨Ïö©Ïûê Ìè¨Ìï®)" Í∂åÌïúÏúºÎ°ú Î∞∞Ìè¨ÎêòÏóàÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                } else {
                    showToast('Íµ¨Í∏Ä ÏãúÌä∏ ÎèôÍ∏∞Ìôî Ïã§Ìå®: ' + error.message, 'error');
                }
            }
        }

        async function saveData() {
            if (!currentCustomerId) return showToast('Î®ºÏ†Ä Í≥†Í∞ùÏùÑ Îì±Î°ùÌïòÏÑ∏Ïöî', 'error');

            if (!isLoggedIn()) {
                showToast('Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§ (Ïó¥Îûå Î™®ÎìúÏóêÏÑúÎäî Ï†ÄÏû•Ìï† Ïàò ÏóÜÏäµÎãàÎã§)', 'error');
                showAdminModal();
                return;
            }

            // Ïû†Í∏àÎêú Í≥†Í∞ùÏùÄ ÎπÑÎ∞ÄÎ≤àÌò∏ ÌïÑÏöî
            if (isCustomerLocked()) {
                showDeletePasswordModal(() => {
                    performSaveData();
                });
                return;
            }

            performSaveData();
        }

        function performSaveData() {
            // [ÏàòÏ†ï] ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú(CostData)Îäî Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞(Quote)Î•º ÏúÑÌï¥ Ï†ÄÏû•Ìï©ÎãàÎã§.
            // Îã®, Í∏ÄÎ°úÎ≤å DB(Master Spec)ÏóêÎäî ÏòÅÌñ•ÏùÑ Ï£ºÏßÄ ÏïäÏäµÎãàÎã§. (Read-Only Policy)
            if (isLoggedIn()) {
                saveCostData();
            }

            // Í≥†Í∞ùÎ≥Ñ Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞Îäî Ìï≠ÏÉÅ Ï†ÄÏû•
            saveEstimateData();

            // [Ï∂îÍ∞Ä] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌïÑÌÑ∞ ÏÉÅÌÉú Ï†ÄÏû•
            if (typeof multiSelectState !== 'undefined') {
                currentData.checklistFilters = JSON.parse(JSON.stringify(multiSelectState));
            }
            const idx = customers.findIndex(c => c.customerId === currentCustomerId);

            // FUNDAMENTAL LOCK CHECK
            if (idx >= 0) {
                const original = customers[idx];

                // If it was locked, BLOCK save operations (except for main admin)
                if (original.isLocked && !isMainAdmin()) {
                    showToast('Ïû†Í∏à ÏÉÅÌÉúÏóêÏÑúÎäî Ï†ÄÏû•Ìï† Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                    return;
                }

                // ÏûëÏÑ±Ïûê Í∂åÌïú Ï≤¥ÌÅ¨: ÏûëÏÑ±Ïûê ÎòêÎäî Î©îÏù∏Í¥ÄÎ¶¨ÏûêÎßå ÏàòÏ†ï Í∞ÄÎä•
                if (original.createdBy && String(original.createdBy).trim().toLowerCase() !== String(currentAdmin?.id).trim().toLowerCase() && !isMainAdmin()) {
                    showToast(`ÏàòÏ†ï Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. (ÏûëÏÑ±Ïûê: ${original.createdBy})`, 'error');
                    return;
                }

                // Ï≤´ Ï†ÄÏû• Ïãú ÏûëÏÑ±Ïûê Ìï†Îãπ (createdByÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞)
                if (!original.createdBy && currentAdmin) {
                    currentData.createdBy = currentAdmin.id;
                }

                // ÏàòÏ†ïÏùº ÏóÖÎç∞Ïù¥Ìä∏
                currentData.updatedAt = new Date().toISOString().split('T')[0];

                customers[idx] = { ...currentData };
            } else {
                // ÏÉà Í≥†Í∞ù: ÏûëÏÑ±Ïûê Ìï†Îãπ
                if (!currentData.createdBy && currentAdmin) {
                    currentData.createdBy = currentAdmin.id;
                }
                customers.push({ ...currentData });
            }
            // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ


            // Î¶¨Ïä§Ìä∏ UI Ï¶âÏãú Í∞±Ïã† (ÏµúÏ¢ÖÏàòÏ†ïÏùº Îì± Î∞òÏòÅ)
            updateCustomerList();

            if (isLoggedIn()) {
                showSaveConfirmToast('‚úÖ Ï†ÄÏû• ÏôÑÎ£å! (ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ï†úÏô∏)');
            } else {
                showSaveConfirmToast('‚úÖ Ï†ÄÏû• ÏôÑÎ£å!');
            }

            // Google Sheets ÎèôÍ∏∞Ìôî (Î∞±Í∑∏ÎùºÏö¥Îìú)
            syncToGoogleSheets({ ...currentData });

            // Ï†ÄÏû• ÌõÑ ÌôîÎ©¥ Ïú†ÏßÄ (Í≥†Í∞ù Î™©Î°ùÎßå Í∞±Ïã†)
            updateCustomerList();
        }

        function createCoverTable() {
            const tbody = document.getElementById('coverTableBody');
            let html = categories.map((cat, i) => `
                <tr >
                <td class="no">${i + 1}</td>
                <td>${cat.name}</td>
                <td class="amount" id="coverCat${cat.no}"><div class="money-align"><span class="currency">‚Ç©</span><span class="value">0</span></div></td>
            </tr>
                `).join('');
            html += `
                <tr class="subtotal" >
                <td></td>
                <td>ÏÜåÍ≥Ñ (Í≥µÍ∏âÍ∞ÄÏï°)</td>
                <td class="amount" id="coverSubtotal"><div class="money-align"><span class="currency">‚Ç©</span><span class="value">0</span></div></td>
            </tr>
            <tr style="background:#f0f7ff;">
                <td></td>
                <td>Í∏∞ÏóÖÏù¥Ïú§ (<span id="coverProfitRate">0</span>%)</td>
                <td class="amount" id="coverProfit"><div class="money-align"><span class="currency">‚Ç©</span><span class="value">0</span></div></td>
            </tr>
            <tr class="vat">
                <td></td>
                <td>Î∂ÄÍ∞ÄÍ∞ÄÏπòÏÑ∏ (VAT 10%)</td>
                <td class="amount" id="coverVat"><div class="money-align"><span class="currency">‚Ç©</span><span class="value">0</span></div></td>
            </tr>
            <tr class="total">
                <td></td>
                <td>Ï¥ù Í≥ÑÏïΩÍ∏àÏï°</td>
                <td class="amount" id="coverTotal"><div class="money-align"><span class="currency">‚Ç©</span><span class="value">0</span></div></td>
            </tr>
            `;
            tbody.innerHTML = html;
        }


        function createCostCategories() {
            const container = document.getElementById('costCategories');
            container.innerHTML = categories.map(cat => `
                <div class="category-section" >
                <div class="category-header">
                    <h3><span class="cat-no">${cat.no}</span> ${cat.name}</h3>
                    <div class="subtotal">‚Ç© <span id="costSubtotal${cat.no}">0</span></div>
                </div>
                <table class="data-table">
                    <colgroup>
                        <col style="width:35px;"><!-- No-->
                        <col style="width:50px;"><!-- Íµ¨Î∂Ñ -->
                        <col style="width:160px;"><!-- ÌíàÎ™Ö -->
                        <col style="width:auto;"><!-- ÏÉÅÏÑ∏ÎÇ¥Ïö© (ÎÇòÎ®∏ÏßÄ Í≥µÍ∞Ñ) -->
                        <col style="width:55px;"><!-- Îã®ÏúÑ -->
                        <col style="width:65px;"><!-- ÏàòÎüâ -->
                        <col style="width:70px;"><!-- Îã®Í∞Ä -->
                        <col style="width:80px;"><!-- Ìï©Í≥Ñ -->
                    </colgroup>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Íµ¨Î∂Ñ</th>
                            <th>ÌíàÎ™Ö</th>
                            <th>ÏÉÅÏÑ∏ÎÇ¥Ïö©</th>
                            <th>Îã®ÏúÑ</th>
                            <th>ÏàòÎüâ</th>
                            <th>Îã®Í∞Ä</th>
                            <th>Ìï©Í≥Ñ</th>
                        </tr>
                    </thead>
                    <tbody id="costBody${cat.no}">
                        <tr>
                            <td class="col-no">1</td>
                            <td class="col-div"><input type="text" placeholder="Íµ¨Î∂Ñ" readonly></td>
                            <td class="col-name"><input type="text" placeholder="ÌíàÎ™Ö" readonly></td>
                            <td class="col-spec"><input type="text" placeholder="ÏÉÅÏÑ∏" readonly></td>
                            <td class="col-unit">${getUnitSelectHTML()}</td>
                            <td class="col-qty"><input type="text" placeholder="ÏàòÎüâ" oninput="calcCostRow(this)" readonly></td>
                            <td class="col-price"><input type="text" placeholder="Îã®Í∞Ä" oninput="calcCostRow(this)" readonly></td>
                            <td class="col-total">0</td>
                        </tr>
                    </tbody>
                </table>
                <div class="category-memo"><label>MEMO</label><textarea id="costMemo${cat.no}" placeholder="Master Data (Read Only)" readonly
                        oninput="autoResizeTextarea(this);"></textarea></div>
                <!-- Master DB Î≥¥Ìò∏Î•º ÏúÑÌï¥ Ìï≠Î™© Ï∂îÍ∞Ä Î≤ÑÌäº Ï†úÍ±∞ -->
            </div>
            `).join('');
        }

        function addCostRow(catNo) {
            const tbody = document.getElementById(`costBody${catNo}`);
            const n = tbody.querySelectorAll('tr').length + 1;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="col-no">${n}</td>
            <td class="col-div"><input type="text"></td>
            <td class="col-name"><input type="text"></td>
            <td class="col-spec"><input type="text"></td>
            <td class="col-unit">${getUnitSelectHTML()}</td>
            <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
            <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
            <td class="col-total">0</td>`;
            tbody.appendChild(tr);
        }

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎäî Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Î°ú Í¥ÄÎ¶¨ (Î™®Îì† Í≥†Í∞ùÏóêÍ≤å ÎèôÏùº)
        // Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑúÎäî Í≥†Í∞ùÎ≥ÑÎ°ú ÎèÖÎ¶Ω Í¥ÄÎ¶¨

        // Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑúÏóêÏÑú ÏÉÅÏÑ∏ÎÇ¥Ïö© ÎìúÎ°≠Îã§Ïö¥ ÏÑ†ÌÉù Ïãú


        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú ÌñâÎ≥Ñ Ìï©Í≥Ñ Í≥ÑÏÇ∞
        function calcCostRow(input) {
            const row = input.closest('tr');
            const inputs = row.querySelectorAll('input');
            const qty = parseNumber(inputs[3]?.value) || 0;
            const price = parseNumber(inputs[4]?.value) || 0;
            const total = qty * price;

            const totalCell = row.querySelector('.col-total');
            if (totalCell) {
                totalCell.textContent = formatNumber(total);
            }

            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÜåÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            const tbody = row.closest('tbody');
            if (tbody && tbody.id) {
                const catNo = tbody.id.replace('costBody', '');
                updateCostCategorySubtotal(catNo);
            }
        }

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÜåÍ≥Ñ Í≥ÑÏÇ∞
        function updateCostCategorySubtotal(catNo) {
            const tbody = document.getElementById(`costBody${catNo}`);
            const subtotalSpan = document.getElementById(`costSubtotal${catNo}`);
            if (!tbody || !subtotalSpan) return;

            let subtotal = 0;
            tbody.querySelectorAll('tr').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const qty = parseNumber(inputs[3]?.value) || 0;
                const price = parseNumber(inputs[4]?.value) || 0;
                subtotal += qty * price;
            });

            subtotalSpan.textContent = formatNumber(subtotal);
        }

        function createEstimateCategories() {
            const container = document.getElementById('estimateCategories');
            container.innerHTML = categories.map(cat => `
            <div class="category-section">
                <div class="category-header">
                    <h3><span class="cat-no">${cat.no}</span> ${cat.name}</h3>
                    <div class="subtotal">‚Ç© <span id="estSubtotal${cat.no}">0</span></div>
                </div>
                <table class="estimate-table">
                    <colgroup>
                        <col><!-- No-->
                        <col class="col-div"><!-- Íµ¨Î∂Ñ (Ïù∏ÏáÑÏãú Ïà®ÍπÄ) -->
                        <col><!-- ÌíàÎ™Ö -->
                        <col><!-- ÏÉÅÏÑ∏ÎÇ¥Ïö© -->
                        <col><!-- Îã®ÏúÑ -->
                        <col><!-- ÏàòÎüâ -->
                        <col><!-- Îã®Í∞Ä -->
                        <col><!-- Í∏àÏï° -->
                        <col><!-- ÎπÑÍ≥† -->

                    </colgroup>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th class="col-div">Íµ¨Î∂Ñ</th>
                            <th>ÌíàÎ™Ö</th>
                            <th>ÏÉÅÏÑ∏ÎÇ¥Ïö©</th>
                            <th>Îã®ÏúÑ</th>
                            <th>ÏàòÎüâ</th>
                            <th>Îã®Í∞Ä</th>
                            <th>Í∏àÏï°</th>
                            <th>ÎπÑÍ≥†</th>

                        </tr>
                    </thead>
                    <tbody id="estBody${cat.no}">
                        <tr class="draggable-row" draggable="true" ondragstart="onEstRowDragStart(event)" ondragover="onEstRowDragOver(event)" ondragend="onEstRowDragEnd(event)">
                            <td class="drag-handle" style="position: relative;">
                                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${cat.no}')" title="ÏÇ≠Ï†ú">
                                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                                </button>
                                1
                            </td>
                            <td class="col-div"><select class="div-select" onchange="onEstDivChange(this, '${cat.no}')">
                                    <option value="">ÏÑ†ÌÉù</option>
                                </select></td>
                            <td><select class="name-select" onchange="onEstNameChange(this, '${cat.no}')" disabled>
                                    <option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>
                                </select></td>
                            <td class="spec-cell">-</td>
                            <td class="unit-cell">-</td>
                            <td><input type="number" class="qty-input" value="1" min="0"
                                    onchange="onEstQtyChange(this, '${cat.no}')"></td>
                            <td class="price-cell" data-price="0"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
                            <td class="amount-cell"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
                            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()"></div></td>
                        </tr>
                    </tbody>
                </table>
                <div class="estimate-memo" id="estMemo${cat.no}">
                    <div style="color:#0071e3; font-weight:600; margin-bottom:6px;">üìù Î©îÎ™®</div>
                    <div class="memo-editable text-formattable" id="estMemoText${cat.no}" contenteditable="true"
                        data-placeholder="Î©îÎ™® ÏûÖÎ†•..." oninput="saveEstimateData()"></div>
                </div>
                <button class="add-row-btn no-print" onclick="addEstimateRowTo('${cat.no}')">+ Ìï≠Î™© Ï∂îÍ∞Ä</button>
            </div>
            `).join('');

            // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Íµ¨Î∂Ñ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
            categories.forEach(cat => {
                updateDivOptions(cat.no);
            });

            // ÏÖÄ ÌÅ¥Î¶≠ Ìé∏Ïßë Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ (spec-cell, unit-cell, price-cell)
            container.addEventListener('click', function (e) {
                const specCell = e.target.closest('.spec-cell');
                const unitCell = e.target.closest('.unit-cell');
                const priceCell = e.target.closest('.price-cell');

                if (specCell && !specCell.querySelector('input')) {
                    // ÎìúÎ°≠Îã§Ïö¥(select)Ïù¥ ÏïÑÎãå ÌÖçÏä§Ìä∏ ÏòÅÏó≠ÏùÑ ÌÅ¥Î¶≠Ìïú Í≤ΩÏö∞ Ìé∏Ïßë Î™®Îìú Ï†ÑÌôò
                    if (!specCell.querySelector('select')) {
                        const row = specCell.closest('tr');
                        const catNo = row.closest('tbody').id.replace('estBody', '');
                        makeSpecEditable(specCell, catNo);
                        return;
                    }
                }
                if (unitCell && !unitCell.querySelector('input')) {
                    const row = unitCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    makeUnitEditable(unitCell, catNo);
                    return;
                }
                if (priceCell && !priceCell.querySelector('input')) {
                    const row = priceCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    makePriceEditable(priceCell, catNo);
                    return;
                }
            });

            // ÎçîÎ∏îÌÅ¥Î¶≠: ÎìúÎ°≠Îã§Ïö¥Ïù¥ ÏûàÎäî spec-cellÎèÑ ÏßÅÏ†ë Ìé∏Ïßë Î™®ÎìúÎ°ú Ï†ÑÌôò
            container.addEventListener('dblclick', function (e) {
                const specCell = e.target.closest('.spec-cell');
                if (specCell && specCell.querySelector('select') && !specCell.querySelector('input')) {
                    const row = specCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    convertSpecSelectToInput(specCell, catNo);
                    return;
                }
            });

            // ÏóîÌÑ∞ ÌÇ§Î°ú Î™®Îì† ÏûÖÎ†• ÌïÑÎìú Ìè¨Ïª§Ïä§ Ìï¥Ï†ú (Ï†ÑÏó≠ Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ)
            container.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    const target = e.target;
                    // input, textareaÏóêÏÑú ÏóîÌÑ∞ Ïãú blur (textareaÎäî shift+enterÎ°ú Ï§ÑÎ∞îÍøà ÌóàÏö©)
                    if (target.tagName === 'INPUT' || (target.tagName === 'TEXTAREA' && !e.shiftKey)) {
                        e.preventDefault();
                        target.blur();
                    }
                }
            });

            // select ÎçîÎ∏îÌÅ¥Î¶≠ Í∞êÏßÄ (selectÎäî Î∏åÎùºÏö∞Ï†ÄÍ∞Ä dblclickÏùÑ Î®πÏúºÎØÄÎ°ú mousedown ÌÉÄÏù¥Î∞çÏúºÎ°ú Ï≤òÎ¶¨)
            let lastSelectClick = { time: 0, target: null };
            container.addEventListener('mousedown', function (e) {
                const selectEl = e.target.closest('select.div-select, select.name-select, select.spec-select');
                if (!selectEl) { lastSelectClick = { time: 0, target: null }; return; }

                const now = Date.now();
                if (lastSelectClick.target === selectEl && (now - lastSelectClick.time) < 400) {
                    // ÎçîÎ∏îÌÅ¥Î¶≠ Í∞êÏßÄ
                    e.preventDefault();
                    e.stopPropagation();
                    const row = selectEl.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');

                    if (selectEl.classList.contains('div-select')) {
                        convertDivSelectToInput(selectEl, row, catNo);
                    } else if (selectEl.classList.contains('name-select')) {
                        convertNameSelectToInput(selectEl, row, catNo);
                    } else if (selectEl.classList.contains('spec-select')) {
                        convertSpecSelectToInput(selectEl.closest('.spec-cell'), catNo);
                    }
                    lastSelectClick = { time: 0, target: null };
                } else {
                    lastSelectClick = { time: now, target: selectEl };
                }
            });

            // selectÏùò Ïù¥Ï†Ñ Í∞í Ï∂îÏ†Å (focus Ïãú Ï†ÄÏû•) - ÎÇ¥Ïö©ÏàòÏ†ïÏö©
            container.addEventListener('focus', function (e) {
                const sel = e.target;
                if (sel.tagName === 'SELECT' && (sel.classList.contains('div-select') || sel.classList.contains('name-select') || sel.classList.contains('spec-select'))) {
                    sel._prevValue = sel.value;
                    const opt = sel.selectedOptions[0];
                    // spec-selectÏùò Í≤ΩÏö∞ data-spec Ïö∞ÏÑ†, Í∑∏ Ïô∏Îäî textContent
                    sel._prevText = opt?.dataset?.spec || opt?.textContent?.trim() || '';
                }
            }, true);

            // Ïª¨Îüº Î¶¨ÏÇ¨Ïù¥Ï¶à Ìï∏Îì§ Ï¥àÍ∏∞Ìôî
            initColumnResize();
        }

        // Íµ¨Î∂Ñ select ‚Üí input Ï†ÑÌôò (ÎçîÎ∏îÌÅ¥Î¶≠Ïö©)
        function convertDivSelectToInput(selectEl, row, catNo) {
            const td = selectEl.closest('td');
            const currentVal = selectEl.value || '';
            const currentText = selectEl.selectedOptions[0]?.textContent?.trim() || '';
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
            const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');

            td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${currentVal && currentVal !== '__custom_div__' ? currentVal : ''}" placeholder="Íµ¨Î∂Ñ ÏûÖÎ†•"
                onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
            const inp = td.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                        <option value="">ÏÑ†ÌÉù</option>${divOpts}<option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option></select>`;
                    if (currentVal && currentVal !== '__custom_div__') {
                        td.querySelector('.div-select').value = currentVal;
                    }
                    saveEstimateData();
                }
            });
            inp.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
        }

        // ÌíàÎ™Ö select ‚Üí input Ï†ÑÌôò (ÎçîÎ∏îÌÅ¥Î¶≠Ïö©)
        function convertNameSelectToInput(selectEl, row, catNo) {
            const td = selectEl.closest('td');
            const currentVal = selectEl.value || '';
            const currentText = selectEl.selectedOptions[0]?.textContent?.trim() || '';
            const divSelect = row.querySelector('.div-select');
            const divCustom = row.querySelector('.div-custom-input');
            const curDiv = divCustom ? divCustom.value : (divSelect ? divSelect.value : '');
            const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
            const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
            const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');

            const displayVal = currentVal && currentVal !== '__custom_name__' && currentText !== 'ÌíàÎ™Ö ÏÑ†ÌÉù' && currentText !== 'Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù' ? currentText : '';
            td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${displayVal}" placeholder="ÌíàÎ™Ö ÏûÖÎ†•"
                onchange="saveEstimateData()">`;
            const inp = td.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                        ${curDiv ? '<option value="">ÌíàÎ™Ö ÏÑ†ÌÉù</option>' + nameOpts + '<option value="__edit_name__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_name__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>' : '<option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>'}</select>`;
                    if (currentVal && currentVal !== '__custom_name__') {
                        const ns = td.querySelector('.name-select');
                        for (let opt of ns.options) {
                            if (opt.value === currentVal) { opt.selected = true; break; }
                        }
                    }
                    saveEstimateData();
                }
            });
            inp.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
        }

        // ÏÉÅÏÑ∏ÎÇ¥Ïö© select ‚Üí input Ï†ÑÌôò (ÎçîÎ∏îÌÅ¥Î¶≠Ïö©)
        function convertSpecSelectToInput(specCell, catNo) {
            const specSelect = specCell.querySelector('select');
            const selectedOpt = specSelect?.selectedOptions[0];
            const currentSpec = selectedOpt?.dataset?.spec || selectedOpt?.textContent?.trim() || '';
            const savedHTML = specCell.innerHTML;

            specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${currentSpec && currentSpec !== 'ÏÉÅÏÑ∏ ÏÑ†ÌÉù' ? currentSpec : ''}"
                placeholder="ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏûÖÎ†•" onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            const inp = specCell.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    specCell.innerHTML = savedHTML;
                    saveEstimateData();
                }
            });

        }

        // Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Íµ¨Î∂Ñ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        function updateDivOptions(catNo) {
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();

            const tbody = document.getElementById(`estBody${catNo}`);
            if (!tbody) return;

            tbody.querySelectorAll('.div-select').forEach(select => {
                const currentVal = select.value;
                select.innerHTML = '<option value="">ÏÑ†ÌÉù</option>' + divs.map(d =>
                    `<option value="${d}" ${d === currentVal ? 'selected' : ''}>${d}</option>`
                ).join('') + '<option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>';
            });
        }

        // ÌäπÏ†ï Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÏõêÍ∞Ä Ìï≠Î™© Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†ÑÏó≠ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
        function getCostItemsByCategory(catNo) {
            // Ï†ÑÏó≠ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞ (Phase 2: In-memory ÏÇ¨Ïö©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');
            let data = globalCostData[`cost_${catNo}`] || [];

            // Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
            if (data.length === 0 && defaultCostData[catNo]) {
                data = defaultCostData[catNo];
            }

            const items = [];
            data.forEach(item => {
                if (item.name) {
                    // price ÌïÑÎìú Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ material+labor+expense Ìï©ÏÇ∞ (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ìò∏Ìôò)
                    const unitPrice = parseNumber(item.price) || ((parseNumber(item.material) || 0) + (parseNumber(item.labor)
                        || 0) + (parseNumber(item.expense) || 0));
                    items.push({
                        div: item.div || '',
                        name: item.name,
                        spec: item.spec || '',
                        unit: item.unit || '',
                        unitPrice: unitPrice
                    });
                }
            });
            return items;
        }

        // Íµ¨Î∂ÑÎ≥Ñ ÌíàÎ™Ö Î™©Î°ù
        function getItemsByDivInCat(catNo, div) {
            const items = getCostItemsByCategory(catNo);
            return items.filter(i => i.div === div);
        }

        // Í≤¨Ï†Å Ìñâ Ï∂îÍ∞Ä
        function addEstimateRowTo(catNo) {
            const tbody = document.getElementById(`estBody${catNo}`);
            const rowCount = tbody.querySelectorAll('tr').length + 1;
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
            const divOptions = divs.map(d => `<option value="${d}">${d}</option>`).join('');

            const tr = document.createElement('tr');
            tr.className = 'draggable-row';
            tr.draggable = true;
            tr.ondragstart = onEstRowDragStart;
            tr.ondragover = onEstRowDragOver;
            tr.ondragend = onEstRowDragEnd;
            tr.innerHTML = `
            <td class="drag-handle" style="position: relative;">
                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${catNo}')" title="ÏÇ≠Ï†ú">
                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                </button>
                ${rowCount}
            </td>
            <td class="col-div"><select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                    <option value="">ÏÑ†ÌÉù</option>${divOptions}
                    <option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option>
                    <option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>
                </select></td>
            <td><select class="name-select" onchange="onEstNameChange(this, '${catNo}')" disabled>
                    <option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>
                </select></td>
            <td class="spec-cell">-</td>
            <td class="unit-cell">-</td>
            <td><input type="number" class="qty-input" value="1" min="0" onchange="onEstQtyChange(this, '${catNo}')">
            </td>
            <td class="price-cell" data-price="0"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
            <td class="amount-cell"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()"></div></td>
            `;
            tbody.appendChild(tr);
        }

        // Í≤¨Ï†Å Ìñâ ÏÇ≠Ï†ú
        function deleteEstimateRow(btn, catNo) {
            const row = btn.closest('tr');
            const tbody = row.closest('tbody');
            row.remove();

            // Î≤àÌò∏ Ïû¨Ï†ïÎ†¨ Î∞è ÏÇ≠Ï†ú Î≤ÑÌäº Ïú†ÏßÄ
            renumberEstimateRows(tbody, catNo);

            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // Íµ¨Î∂Ñ ÏÑ†ÌÉù Î≥ÄÍ≤Ω
        function onEstDivChange(select, catNo) {
            const row = select.closest('tr');
            const nameSelect = row.querySelector('.name-select');
            const div = select.value;

            // _prevValueÎäî focus Ïù¥Î≤§Ìä∏ÏóêÏÑú Ï†ÄÏû• (ÏïÑÎûò initSelectPrevTracking Ï∞∏Ï°∞)
            if (div === '__edit_div__') {
                // ÎÇ¥Ïö©ÏàòÏ†ï: Ïù¥Ï†ÑÏóê ÏÑ†ÌÉùÎêú Í∞íÏùÑ Ïú†ÏßÄÌïú Ï±Ñ inputÏúºÎ°ú Ï†ÑÌôò
                const td = select.closest('td');
                const prevSelected = select._prevValue || '';
                const items = getCostItemsByCategory(catNo);
                const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${prevSelected}" placeholder="Íµ¨Î∂Ñ ÏàòÏ†ï"
                    onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                const editInput = td.querySelector('input');
                editInput.focus();
                editInput.select();
                editInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); editInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                            <option value="">ÏÑ†ÌÉù</option>${divOpts}<option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option></select>`;
                        if (prevSelected) td.querySelector('.div-select').value = prevSelected;
                        saveEstimateData();
                    }
                });
                editInput.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                return;
            }

            if (div === '__custom_div__') {
                // ÏßÅÏ†ëÏûÖÎ†•: selectÎ•º inputÏúºÎ°ú ÍµêÏ≤¥ (ESCÎ°ú Î≥µÏõê Í∞ÄÎä•)
                const td = select.closest('td');
                const items = getCostItemsByCategory(catNo);
                const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input div-custom-input" placeholder="Íµ¨Î∂Ñ ÏûÖÎ†•"
                    onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                const divInput = td.querySelector('input');
                divInput.focus();
                divInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); divInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                            <option value="">ÏÑ†ÌÉù</option>${divOpts}<option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option></select>`;
                        // ÌíàÎ™ÖÎèÑ Îã§Ïãú selectÎ°ú
                        const nameTd = row.children[2];
                        nameTd.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" disabled>
                            <option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option></select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                divInput.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                // ÌíàÎ™ÖÎèÑ ÏßÅÏ†ëÏûÖÎ†• Î™®ÎìúÎ°ú
                const nameTd = nameSelect.closest('td');
                nameTd.innerHTML = `<input type="text" class="editable-input name-custom-input" placeholder="ÌíàÎ™Ö ÏûÖÎ†•"
                    onchange="saveEstimateData()">`;
                const nameInput = nameTd.querySelector('input');
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        const divSel = row.querySelector('.div-select');
                        const curDiv = divSel ? divSel.value : '';
                        nameTd.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            <option value="">${curDiv ? 'ÌíàÎ™Ö ÏÑ†ÌÉù' : 'Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù'}</option></select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                resetEstRowValues(row);
                enableDirectEditCells(row, catNo);
                return;
            }

            if (!div) {
                nameSelect.innerHTML = '<option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>';
                nameSelect.disabled = true;
                resetEstRowValues(row);
                return;
            }

            const items = getItemsByDivInCat(catNo, div);

            // Í≥†Ïú†Ìïú ÌíàÎ™ÖÎßå Ï∂îÏ∂ú (Ï§ëÎ≥µ Ï†úÍ±∞)
            const uniqueNames = [...new Set(items.map(item => item.name).filter(n => n))];

            nameSelect.innerHTML = '<option value="">ÌíàÎ™Ö ÏÑ†ÌÉù</option>' + uniqueNames.map(name =>
                `<option value="${name}">${name}</option>`
            ).join('') + '<option value="__edit_name__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_name__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>';
            nameSelect.disabled = false;
            resetEstRowValues(row);
        }

        // ÌíàÎ™Ö ÏÑ†ÌÉù Î≥ÄÍ≤Ω
        function onEstNameChange(select, catNo) {
            const row = select.closest('tr');
            const option = select.selectedOptions[0];

            if (select.value === '__edit_name__') {
                // ÎÇ¥Ïö©ÏàòÏ†ï: Ïù¥Ï†ÑÏóê ÏÑ†ÌÉùÎêú Í∞íÏùÑ Ïú†ÏßÄÌïú Ï±Ñ inputÏúºÎ°ú Ï†ÑÌôò
                const td = select.closest('td');
                const prevText = select._prevText || '';
                const prevVal = select._prevValue || '';
                const divSelect = row.querySelector('.div-select');
                const curDiv = divSelect ? divSelect.value : '';
                const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
                const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
                const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${prevText && prevText !== 'ÌíàÎ™Ö ÏÑ†ÌÉù' && prevText !== 'Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù' ? prevText : ''}" placeholder="ÌíàÎ™Ö ÏàòÏ†ï"
                    onchange="saveEstimateData()">`;
                const nameInput = td.querySelector('input');
                nameInput.focus();
                nameInput.select();
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            ${curDiv ? '<option value="">ÌíàÎ™Ö ÏÑ†ÌÉù</option>' + nameOpts + '<option value="__edit_name__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_name__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>' : '<option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>'}</select>`;
                        if (prevVal) {
                            const ns = td.querySelector('.name-select');
                            for (let opt of ns.options) { if (opt.value === prevVal) { opt.selected = true; break; } }
                        }
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                return;
            }

            if (select.value === '__custom_name__') {
                // ÏßÅÏ†ëÏûÖÎ†•: selectÎ•º inputÏúºÎ°ú ÍµêÏ≤¥ (ESCÎ°ú Î≥µÏõê Í∞ÄÎä•)
                const td = select.closest('td');
                const divSelect = row.querySelector('.div-select');
                const curDiv = divSelect ? divSelect.value : '';
                const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
                const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
                const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input name-custom-input" placeholder="ÌíàÎ™Ö ÏûÖÎ†•"
                    onchange="saveEstimateData()">`;
                const nameInput = td.querySelector('input');
                nameInput.focus();
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            ${curDiv ? '<option value="">ÌíàÎ™Ö ÏÑ†ÌÉù</option>' + nameOpts + '<option value="__edit_name__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_name__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>' : '<option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>'}</select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                resetEstRowValues(row);
                enableDirectEditCells(row, catNo);
                return;
            }

            if (!option || !option.value) {
                resetEstRowValues(row);
                return;
            }

            const selectedName = option.value.trim(); // ÏÑ†ÌÉùÎêú ÌíàÎ™Ö (valueÍ∞Ä ÌíàÎ™Ö Ïù¥Î¶Ñ)
            const divSelect = row.querySelector('.div-select');
            const div = divSelect ? divSelect.value : '';

            // Í∞ôÏùÄ Íµ¨Î∂Ñ ÎÇ¥ÏóêÏÑú Í∞ôÏùÄ ÌíàÎ™ÖÏùÑ Í∞ÄÏßÑ Ìï≠Î™©Îì§ Ï∞æÍ∏∞
            const items = getItemsByDivInCat(catNo, div);
            const sameNameItems = items.filter(item => item.name && item.name.trim() === selectedName);

            if (sameNameItems.length > 1) {
                // Í∞ôÏùÄ ÌíàÎ™ÖÏù¥ Ïó¨Îü¨ Í∞ú ÏûàÏúºÎ©¥ ÏÉÅÏÑ∏ÎÇ¥Ïö© ÎìúÎ°≠Îã§Ïö¥ ÌëúÏãú
                const specCell = row.querySelector('.spec-cell');
                const specOptions = sameNameItems.map((item, i) =>
                    `<option value="${i}" data-spec="${item.spec || ''}" data-unit="${item.unit || ''}" data-price="${item.unitPrice || 0}">
                ${item.spec || '(ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏóÜÏùå)'}</option>`
                ).join('');

                specCell.innerHTML = `
            <select class="spec-select" onchange="onEstSpecSelect(this, '${catNo}')"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;">
                <option value="">ÏÉÅÏÑ∏ ÏÑ†ÌÉù</option>
                ${specOptions}
                <option value="__edit_spec__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option>
                <option value="__custom__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>
            </select>
            `;

                // Îã®ÏúÑ/Îã®Í∞Ä/Í∏àÏï°ÏùÄ ÏïÑÏßÅ ÏÑ†ÌÉù Ïïà Îê®
                row.querySelector('.unit-cell').textContent = '-';
                row.querySelector('.price-cell').innerHTML = '<span style="margin:auto">-</span>';
                row.querySelector('.price-cell').dataset.price = '0';
                row.querySelector('.amount-cell').innerHTML = '<span style="margin:auto">-</span>';
            } else if (sameNameItems.length === 1) {
                // Í∞ôÏùÄ ÌíàÎ™ÖÏù¥ ÌïòÎÇòÎßå ÏûàÏúºÎ©¥ ÏûêÎèô ÏûÖÎ†•
                const item = sameNameItems[0];
                const spec = item.spec || '-';
                const unit = item.unit || '-';
                const price = parseInt(item.unitPrice) || 0;

                // Îã®ÏúÑÍ∞Ä "Ìèâ"Ïù¥Î©¥ Í≥†Í∞ù Ï†ïÎ≥¥Ïùò ÌèâÏàòÎ•º ÏûêÎèô ÏûÖÎ†•
                let qty = parseInt(row.querySelector('.qty-input').value) || 1;
                if (unit === 'Ìèâ' || unit === 'py') {
                    const customerArea = getCustomerArea();
                    if (customerArea > 0) {
                        qty = customerArea;
                        row.querySelector('.qty-input').value = qty;
                    }
                }

                const amount = price * qty;

                row.querySelector('.spec-cell').textContent = spec;
                row.querySelector('.unit-cell').textContent = unit;
                row.querySelector('.price-cell').innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>‚Ç©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                row.querySelector('.price-cell').dataset.price = price;
                row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            } else {
                // Ìï≠Î™©ÏùÑ Ï∞æÏßÄ Î™ªÌïú Í≤ΩÏö∞
                resetEstRowValues(row);
            }

            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // Í≥†Í∞ù ÌèâÏàò Í∞ÄÏ†∏Ïò§Í∏∞
        function getCustomerArea() {
            if (!currentCustomerId) return 0;
            const customer = customers.find(c => c.customerId === currentCustomerId);
            if (!customer) return 0;

            // ÌèâÏàò ÌååÏã± (Ïà´ÏûêÎßå Ï∂îÏ∂ú)
            const areaStr = customer.area || customer.pyeong || '';
            const match = areaStr.toString().match(/[\d.]+/);
            return match ? parseFloat(match[0]) : 0;
        }

        // Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú ÏÉÅÏÑ∏ÎÇ¥Ïö© ÎìúÎ°≠Îã§Ïö¥ ÏÑ†ÌÉù Ïãú
        function onEstSpecSelect(select, catNo) {
            const row = select.closest('tr');
            const option = select.selectedOptions[0];

            if (select.value === '__edit_spec__') {
                // ÎÇ¥Ïö©ÏàòÏ†ï: Ïù¥Ï†ÑÏóê ÏÑ†ÌÉùÎêú ÏÉÅÏÑ∏ÎÇ¥Ïö©ÏùÑ Ïú†ÏßÄÌïú Ï±Ñ inputÏúºÎ°ú Ï†ÑÌôò
                const specCell = row.querySelector('.spec-cell');
                const prevSpec = select._prevText || '';
                const savedHTML = specCell.innerHTML;
                specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${prevSpec && prevSpec !== 'ÏÉÅÏÑ∏ ÏÑ†ÌÉù' ? prevSpec : ''}" placeholder="ÏÉÅÏÑ∏ ÏàòÏ†ï"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;"
                onchange="saveEstimateData()">`;
                const inp = specCell.querySelector('input');
                inp.focus();
                inp.select();
                inp.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); inp.blur(); }
                    if (e.key === 'Escape') {
                        specCell.innerHTML = savedHTML;
                        const restoredSelect = specCell.querySelector('select');
                        if (restoredSelect && select._prevValue) restoredSelect.value = select._prevValue;
                        saveEstimateData();
                    }
                });
                inp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                return;
            }

            if (select.value === '__custom__') {
                const specCell = row.querySelector('.spec-cell');
                // Í∏∞Ï°¥ ÎìúÎ°≠Îã§Ïö¥ ÏòµÏÖò Ï†ÄÏû• (ESC Î≥µÏõêÏö©)
                const savedHTML = specCell.innerHTML;
                specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ÏÉÅÏÑ∏ ÏûÖÎ†•"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;"
                onchange="saveEstimateData()">`;
                const inp = specCell.querySelector('input');
                inp.focus();
                inp.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); inp.blur(); }
                    if (e.key === 'Escape') {
                        specCell.innerHTML = savedHTML;
                        // ÎìúÎ°≠Îã§Ïö¥ Î≥µÏõê ÌõÑ Ï≤´ Î≤àÏß∏ ÏòµÏÖò ÏÑ†ÌÉù
                        const restoredSelect = specCell.querySelector('select');
                        if (restoredSelect) restoredSelect.value = '';
                        saveEstimateData();
                    }
                });
                inp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                return;
            }

            if (!option || !option.value) {
                row.querySelector('.unit-cell').textContent = '-';
                row.querySelector('.price-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                row.querySelector('.price-cell').dataset.price = '0';
                row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                return;
            }

            // ÏÑ†ÌÉùÎêú ÏÉÅÏÑ∏ÎÇ¥Ïö©Ïùò Îã®ÏúÑ, Îã®Í∞Ä Ï†ÅÏö©
            const unit = option.dataset.unit || '-';
            const price = parseInt(option.dataset.price) || 0;

            // Îã®ÏúÑÍ∞Ä "Ìèâ"Ïù¥Î©¥ Í≥†Í∞ù Ï†ïÎ≥¥Ïùò ÌèâÏàòÎ•º ÏûêÎèô ÏûÖÎ†•
            let qty = parseInt(row.querySelector('.qty-input').value) || 1;
            if (unit === 'Ìèâ' || unit === 'py') {
                const customerArea = getCustomerArea();
                if (customerArea > 0) {
                    qty = customerArea;
                    row.querySelector('.qty-input').value = qty;
                }
            }

            const amount = price * qty;

            row.querySelector('.unit-cell').textContent = unit;
            row.querySelector('.price-cell').innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>‚Ç©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            row.querySelector('.price-cell').dataset.price = price;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;

            // ÏÜåÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            const effectiveCatNo = catNo || row.closest('tbody').id.replace('estBody', '');
            updateCategorySubtotal(effectiveCatNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú Ìñâ Í≥ÑÏÇ∞
        function calcEstimateRow(row) {
            const priceCell = row.querySelector('.price-cell');
            const priceInput = priceCell?.querySelector('input');
            const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell?.dataset.price) || 0);
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 1;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
        }

        // ÏàòÎüâ Î≥ÄÍ≤Ω
        function onEstQtyChange(input, catNo) {
            const row = input.closest('tr');
            const priceCell = row.querySelector('.price-cell');
            const priceInput = priceCell.querySelector('input');
            const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell.dataset.price) || 0);
            const qty = parseInt(input.value) || 0;
            const amount = price * qty;

            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // Ìñâ Í∞í Ï¥àÍ∏∞Ìôî
        function resetEstRowValues(row) {
            row.querySelector('.spec-cell').textContent = '-';
            row.querySelector('.unit-cell').textContent = '-';
            row.querySelector('.price-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
            row.querySelector('.price-cell').dataset.price = '0';
            row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
        }

        // ===== Í≤¨Ï†ÅÏÑú ÌÖåÏù¥Î∏î Ïª¨Îüº ÏàòÎèô ÎÑàÎπÑ Ï°∞Ï†à =====
        function initColumnResize() {
            document.querySelectorAll('.estimate-table').forEach(table => {
                const ths = table.querySelectorAll('thead th');
                // Í∏∞Ï°¥ Ìï∏Îì§ Ï†úÍ±∞
                table.querySelectorAll('.col-resize-handle').forEach(h => h.remove());

                ths.forEach((th, idx) => {
                    // col-div(Íµ¨Î∂Ñ)Îäî Ïù∏ÏáÑÏãú Ïà®Í≤®ÏßÄÎØÄÎ°ú Ï†úÏô∏ Í∞ÄÎä•ÌïòÎÇò, ÌôîÎ©¥ÏóêÏÑ† Ìè¨Ìï®
                    const handle = document.createElement('div');
                    handle.className = 'col-resize-handle no-print';
                    th.appendChild(handle);

                    let startX, startWidth, colIndex;

                    handle.addEventListener('mousedown', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        startX = e.pageX;
                        startWidth = th.offsetWidth;
                        colIndex = idx;
                        handle.classList.add('resizing');
                        document.body.style.cursor = 'col-resize';
                        document.body.style.userSelect = 'none';

                        function onMouseMove(e2) {
                            const diff = e2.pageX - startX;
                            const newWidth = Math.max(20, startWidth + diff);
                            // colgroupÏùò col ÎòêÎäî th ÏßÅÏ†ë ÏÑ§Ï†ï
                            const cols = table.querySelectorAll('colgroup col');
                            if (cols[colIndex]) {
                                cols[colIndex].style.width = newWidth + 'px';
                            }
                            th.style.width = newWidth + 'px';
                            th.style.minWidth = newWidth + 'px';
                            th.style.maxWidth = newWidth + 'px';
                        }

                        function onMouseUp() {
                            handle.classList.remove('resizing');
                            document.body.style.cursor = '';
                            document.body.style.userSelect = '';
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                        }

                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                });
            });
        }

        // ÏßÅÏ†ëÏûÖÎ†• Î™®Îìú: ÏÉÅÏÑ∏ÎÇ¥Ïö©, Îã®ÏúÑ, Îã®Í∞ÄÎ•º ÏûÖÎ†• ÌïÑÎìúÎ°ú Ï†ÑÌôò
        function enableDirectEditCells(row, catNo) {
            const specCell = row.querySelector('.spec-cell');
            const unitCell = row.querySelector('.unit-cell');
            const priceCell = row.querySelector('.price-cell');

            specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏûÖÎ†•"
                onchange="saveEstimateData()">`;
            specCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                else if (e.key === 'Escape') { specCell.textContent = '-'; saveEstimateData(); }
            });
            specCell.querySelector('input').addEventListener('blur', function () { finalizeDirectSpecEdit(this); });

            unitCell.innerHTML = `<input type="text" class="editable-input" placeholder="Îã®ÏúÑ" style="width:100%; text-align:center;"
                onchange="saveEstimateData()">`;
            unitCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                else if (e.key === 'Escape') { unitCell.textContent = '-'; saveEstimateData(); }
            });
            unitCell.querySelector('input').addEventListener('blur', function () { finalizeDirectUnitEdit(this); });

            priceCell.innerHTML = `<input type="text" class="editable-price-input" placeholder="Îã®Í∞Ä" value=""
                oninput="onEstDirectPriceInput(this, '${catNo}')" onblur="finalizePriceEdit(this, '${catNo}')" onchange="saveEstimateData()">`;
            priceCell.dataset.price = '0';
            priceCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.blur();
                } else if (e.key === 'Escape') {
                    priceCell.innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                    priceCell.dataset.price = '0';
                    row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                    updateCategorySubtotal(catNo);
                    updateEstimateTotals();
                    saveEstimateData();
                }
            });
        }

        // ÏßÅÏ†ëÏûÖÎ†• Î™®Îìú Ìï¥Ï†ú: ÏÉÅÏÑ∏ÎÇ¥Ïö©, Îã®ÏúÑ, Îã®Í∞ÄÎ•º ÏùΩÍ∏∞ Ï†ÑÏö©ÏúºÎ°ú ÎêòÎèåÎ¶¨Í∏∞
        function revertEditCellsToReadonly(row) {
            const specCell = row.querySelector('.spec-cell');
            const unitCell = row.querySelector('.unit-cell');
            const priceCell = row.querySelector('.price-cell');

            if (specCell && specCell.querySelector('.spec-custom-input')) {
                specCell.textContent = '-';
            }
            if (unitCell && unitCell.querySelector('input')) {
                unitCell.textContent = '-';
            }
            if (priceCell && priceCell.querySelector('input')) {
                priceCell.innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                priceCell.dataset.price = '0';
            }
            row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
        }

        // ÏßÅÏ†ëÏûÖÎ†• Îã®Í∞Ä Î≥ÄÍ≤Ω Ïãú Í∏àÏï° Í≥ÑÏÇ∞
        function onEstDirectPriceInput(input, catNo) {
            const row = input.closest('tr');
            const price = parseNumber(input.value) || 0;
            row.querySelector('.price-cell').dataset.price = price;
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            input.value = formatNumber(price);
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
        }

        // ÏÖÄ ÌÅ¥Î¶≠ÏúºÎ°ú Ìé∏Ïßë Î™®Îìú Ï†ÑÌôò (spec-cell)
        function makeSpecEditable(cell, catNo) {
            const currentText = cell.textContent?.trim() || '';
            const originalText = currentText;
            if (currentText === '-') {
                cell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏûÖÎ†•"
                    onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            } else {
                cell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${currentText}"
                    onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            }
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    inp.blur();
                } else if (e.key === 'Escape') {
                    cell.textContent = originalText || '-';
                    saveEstimateData();
                }
            });
        }

        function finalizeSpecEdit(input, catNo) {
            const val = input.value.trim();
            const cell = input.closest('.spec-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
            }
            saveEstimateData();
        }

        // ÏÖÄ ÌÅ¥Î¶≠ÏúºÎ°ú Ìé∏Ïßë Î™®Îìú Ï†ÑÌôò (unit-cell)
        function makeUnitEditable(cell, catNo) {
            const currentText = cell.textContent?.trim() || '';
            const originalText = currentText;
            if (cell.querySelector('input')) return;
            cell.innerHTML = `<input type="text" class="editable-input" value="${currentText === '-' ? '' : currentText}"
                placeholder="Îã®ÏúÑ" style="width:100%; text-align:center;"
                onchange="saveEstimateData()" onblur="finalizeUnitEdit(this)">`;
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    inp.blur();
                } else if (e.key === 'Escape') {
                    cell.textContent = originalText || '-';
                    saveEstimateData();
                }
            });
        }

        function finalizeUnitEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.unit-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
            }
            saveEstimateData();
        }

        // ÏÖÄ ÌÅ¥Î¶≠ÏúºÎ°ú Ìé∏Ïßë Î™®Îìú Ï†ÑÌôò (price-cell)
        function makePriceEditable(cell, catNo) {
            if (cell.querySelector('input')) return;
            const currentPrice = parseInt(cell.dataset.price) || 0;
            const originalPrice = currentPrice;
            cell.innerHTML = `<input type="text" class="editable-price-input" value="${currentPrice > 0 ? formatNumber(currentPrice) : ''}"
                placeholder="Îã®Í∞Ä ÏûÖÎ†•" oninput="onEstDirectPriceInput(this, '${catNo}')"
                onblur="finalizePriceEdit(this, '${catNo}')" onchange="saveEstimateData()">`;
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    // ÏóîÌÑ∞ ÌÇ§: Ìé∏Ïßë ÏôÑÎ£å, ‚Ç© ÌëúÏãú, blur Ï≤òÎ¶¨
                    e.preventDefault();
                    inp.blur(); // blur Ïù¥Î≤§Ìä∏Í∞Ä finalizePriceEdit Ìò∏Ï∂ú
                } else if (e.key === 'Escape') {
                    cell.dataset.price = originalPrice;
                    cell.innerHTML = `<div class="money-wrapper">${originalPrice > 0 ? `<span>‚Ç©</span><span>${formatNumber(originalPrice)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                    const row = cell.closest('tr');
                    const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
                    const amount = originalPrice * qty;
                    row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                    updateCategorySubtotal(catNo);
                    updateEstimateTotals();
                    saveEstimateData();
                }
            });
        }


        function finalizePriceEdit(input, catNo) {
            const price = parseNumber(input.value) || 0;
            const cell = input.closest('.price-cell');
            cell.dataset.price = price;
            cell.style.border = '';
            cell.style.boxShadow = '';
            cell.style.background = '';
            cell.innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>‚Ç©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            const row = cell.closest('tr');
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // ÏßÅÏ†ëÏûÖÎ†• Íµ¨Î∂Ñ blur Ïãú ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÌååÎûÄ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞)
        function finalizeDirectDivEdit(input, catNo) {
            const val = input.value.trim();
            const td = input.closest('td');
            if (td) {
                td.style.border = '';
                td.style.boxShadow = '';
                td.style.background = '';
                td.innerHTML = `<span class="div-custom-text" style="cursor:pointer; display:block; text-align:center;">${val || '-'}</span>`;
                td.dataset.customDiv = val || '';
                // ÌÅ¥Î¶≠ Ïãú Îã§Ïãú Ìé∏Ïßë Í∞ÄÎä•
                td.querySelector('.div-custom-text').addEventListener('click', function () {
                    td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${val}" placeholder="Íµ¨Î∂Ñ ÏûÖÎ†•"
                        onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                    const newInp = td.querySelector('input');
                    newInp.focus();
                    newInp.select();
                    newInp.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') { e.preventDefault(); newInp.blur(); }
                    });
                    newInp.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                });
            }
            saveEstimateData();
        }

        // ÏßÅÏ†ëÏûÖÎ†• ÌíàÎ™Ö blur Ïãú ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÌååÎûÄ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞)
        function finalizeDirectNameEdit(input, catNo) {
            const val = input.value.trim();
            const td = input.closest('td');
            if (td) {
                td.style.border = '';
                td.style.boxShadow = '';
                td.style.background = '';
                td.innerHTML = `<span class="name-custom-text" style="cursor:pointer; display:block;">${val || '-'}</span>`;
                td.dataset.customName = val || '';
                // ÌÅ¥Î¶≠ Ïãú Îã§Ïãú Ìé∏Ïßë Í∞ÄÎä•
                td.querySelector('.name-custom-text').addEventListener('click', function () {
                    td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${val}" placeholder="ÌíàÎ™Ö ÏûÖÎ†•"
                        onchange="saveEstimateData()">`;
                    const newInp = td.querySelector('input');
                    newInp.focus();
                    newInp.select();
                    newInp.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') { e.preventDefault(); newInp.blur(); }
                    });
                    newInp.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                });
            }
            saveEstimateData();
        }

        // ÏßÅÏ†ëÏûÖÎ†• ÏÉÅÏÑ∏ÎÇ¥Ïö© blur Ïãú ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÌååÎûÄ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞)
        function finalizeDirectSpecEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.spec-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
                cell.dataset.customSpec = val || '';
            }
            saveEstimateData();
        }

        // ÏßÅÏ†ëÏûÖÎ†• Îã®ÏúÑ blur Ïãú ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÌååÎûÄ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞)
        function finalizeDirectUnitEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.unit-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
                cell.dataset.customUnit = val || '';
            }
            saveEstimateData();
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÜåÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCategorySubtotal(catNo) {
            const tbody = document.getElementById(`estBody${catNo}`);
            let subtotal = 0;

            tbody.querySelectorAll('tr').forEach(row => {
                const priceCell = row.querySelector('.price-cell');
                const priceInput = priceCell?.querySelector('input');
                const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell?.dataset.price) || 0);
                const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
                subtotal += price * qty;
            });

            document.getElementById(`estSubtotal${catNo}`).textContent = formatNumber(subtotal);
            return subtotal;
        }

        // Ï†ÑÏ≤¥ Ìï©Í≥Ñ Í≥ÑÏÇ∞
        function updateEstimateTotals() {
            let grandTotal = 0;
            const categoryTotals = {};

            categories.forEach(cat => {
                const catTotal = updateCategorySubtotal(cat.no);
                categoryTotals[cat.no] = catTotal;
                grandTotal += catTotal;
            });

            const profitRate = parseFloat(document.getElementById('estimateProfitRate')?.value) || 0;
            const profit = Math.round(grandTotal * profitRate / 100);
            const subtotalWithProfit = grandTotal + profit;
            const vat = Math.round(subtotalWithProfit * 0.1);
            const total = subtotalWithProfit + vat;

            document.getElementById('estimateSubtotal').textContent = '‚Ç© ' + formatNumber(grandTotal);
            document.getElementById('estimateProfit').textContent = '‚Ç© ' + formatNumber(profit);
            document.getElementById('estimateVat').textContent = '‚Ç© ' + formatNumber(vat);
            document.getElementById('estimateTotal').textContent = '‚Ç© ' + formatNumber(total);

            // Í≥†Í∞ùÏ†ïÎ≥¥Ïóê Ï¥ù Í≥ÑÏïΩÍ∏àÏï° Î∞òÏòÅ
            const totalAmountField = document.querySelector('.customer-field[data-field="totalAmount"]');
            if (totalAmountField) {
                totalAmountField.value = '‚Ç© ' + formatNumber(total);
                currentData.totalAmount = '‚Ç© ' + formatNumber(total);
            }

            currentData.estimateProfitRate = profitRate;

            // ÌëúÏßÄÍ≥ÑÏïΩÏÑú Ïó∞Îèô
            updateCoverFromEstimate(categoryTotals, grandTotal, profitRate, profit, vat, total);

            // ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú ÎåÄÍ∏àÏßÄÍ∏â Ïó∞Îèô
            updateContractPayments(total);
        }

        // ÌëúÏßÄÍ≥ÑÏïΩÏÑú Í∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏
        function updateCoverFromEstimate(categoryTotals, subtotal, profitRate, profit, vat, total) {
            // Í∏àÏï°ÏùÑ Ï†ïÎ†¨Îêú HTMLÎ°ú Î≥ÄÌôòÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
            function formatAmountHtml(amount) {
                if (amount > 0) {
                    return `<div class="money-align"><span class="currency">‚Ç©</span><span class="value">${formatNumber(amount)}</span></div>`;
                }
                return '<div class="money-align"><span class="currency"></span><span class="value">-</span></div>';
            }

            // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Í∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏
            categories.forEach(cat => {
                const el = document.getElementById(`coverCat${cat.no}`);
                if (el) {
                    const amount = categoryTotals[cat.no] || 0;
                    el.innerHTML = formatAmountHtml(amount);
                }
            });

            // ÏÜåÍ≥Ñ, Í∏∞ÏóÖÏù¥Ïú§, VAT, Ï¥ùÏï° ÏóÖÎç∞Ïù¥Ìä∏
            const coverSubtotal = document.getElementById('coverSubtotal');
            const coverProfitRate = document.getElementById('coverProfitRate');
            const coverProfit = document.getElementById('coverProfit');
            const coverVat = document.getElementById('coverVat');
            const coverTotal = document.getElementById('coverTotal');

            if (coverSubtotal) coverSubtotal.innerHTML = formatAmountHtml(subtotal);
            if (coverProfitRate) coverProfitRate.textContent = profitRate;
            if (coverProfit) coverProfit.innerHTML = formatAmountHtml(profit);
            if (coverVat) coverVat.innerHTML = formatAmountHtml(vat);
            if (coverTotal) coverTotal.innerHTML = formatAmountHtml(total);
        }


        // ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú ÎåÄÍ∏àÏßÄÍ∏â ÏûêÎèô Í≥ÑÏÇ∞
        function updateContractPayments(total) {
            // ÎåÄÍ∏à ÏßÄÍ∏â ÎπÑÏú®: 1Ï∞® 27%, 2Ï∞® 23%, 3Ï∞® 23%, 4Ï∞® 23%, ÏûîÍ∏à 4%
            const payment1 = Math.round(total * 0.27);
            const payment2 = Math.round(total * 0.23);
            const payment3 = Math.round(total * 0.23);
            const payment4 = Math.round(total * 0.23);
            const payment5 = total - payment1 - payment2 - payment3 - payment4; // ÎÇòÎ®∏ÏßÄ ÏûîÍ∏à

            // currentDataÏóê Ï†ÄÏû•
            currentData.payment1 = '‚Ç© ' + formatNumber(payment1) + ' (27%)';
            currentData.payment2 = '‚Ç© ' + formatNumber(payment2) + ' (23%)';
            currentData.payment3 = '‚Ç© ' + formatNumber(payment3) + ' (23%)';
            currentData.payment4 = '‚Ç© ' + formatNumber(payment4) + ' (23%)';
            currentData.payment5 = '‚Ç© ' + formatNumber(payment5) + ' (4%)';

            // synced-input ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.synced-input[data-sync="payment1"]').forEach(el => el.value =
                currentData.payment1);
            document.querySelectorAll('.synced-input[data-sync="payment2"]').forEach(el => el.value =
                currentData.payment2);
            document.querySelectorAll('.synced-input[data-sync="payment3"]').forEach(el => el.value =
                currentData.payment3);
            document.querySelectorAll('.synced-input[data-sync="payment4"]').forEach(el => el.value =
                currentData.payment4);
            document.querySelectorAll('.synced-input[data-sync="payment5"]').forEach(el => el.value =
                currentData.payment5);

            // ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú Ï¥ù Í≥ÑÏïΩÍ∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.synced-input[data-sync="totalAmount"]').forEach(el => {
                el.value = '‚Ç© ' + formatNumber(total);
            });
        }

        // Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveEstimateData() {
            const estimateData = {};
            const estimateMemos = {};

            categories.forEach(cat => {
                const tbody = document.getElementById(`estBody${cat.no}`);
                const memoTextarea = document.getElementById(`estMemoText${cat.no}`);
                if (!tbody) return;

                const rows = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const divSelect = row.querySelector('.div-select');
                    const divCustomInput = row.querySelector('.div-custom-input');
                    const nameSelect = row.querySelector('.name-select');
                    const nameCustomInput = row.querySelector('.name-custom-input');
                    const qtyInput = row.querySelector('.qty-input');
                    const specCell = row.querySelector('.spec-cell');

                    // Íµ¨Î∂Ñ Í∞í: select ÎòêÎäî ÏßÅÏ†ëÏûÖÎ†• ÎòêÎäî ÌÖçÏä§Ìä∏ Î≥ÄÌôò ÌõÑ
                    let divValue = '';
                    let isCustomDiv = false;
                    const divCustomText = row.querySelector('.div-custom-text');
                    if (divCustomInput) {
                        divValue = divCustomInput.value || '';
                        isCustomDiv = true;
                    } else if (divCustomText) {
                        divValue = divCustomText.textContent?.trim() || '';
                        if (divValue === '-') divValue = '';
                        isCustomDiv = true;
                    } else if (divSelect) {
                        divValue = divSelect.value || '';
                    }

                    // ÌíàÎ™Ö Í∞í: select ÎòêÎäî ÏßÅÏ†ëÏûÖÎ†• ÎòêÎäî ÌÖçÏä§Ìä∏ Î≥ÄÌôò ÌõÑ
                    let nameValue = '';
                    let nameIndexValue = '';
                    let isCustomName = false;
                    const nameCustomText = row.querySelector('.name-custom-text');
                    if (nameCustomInput) {
                        nameValue = nameCustomInput.value || '';
                        nameIndexValue = '';
                        isCustomName = true;
                    } else if (nameCustomText) {
                        nameValue = nameCustomText.textContent?.trim() || '';
                        if (nameValue === '-') nameValue = '';
                        nameIndexValue = '';
                        isCustomName = true;
                    } else if (nameSelect) {
                        nameIndexValue = nameSelect.value || '';
                        nameValue = nameSelect.selectedOptions[0]?.textContent || '';
                    }

                    // spec-cellÏù¥ selectÎÇò inputÏù∏ Í≤ΩÏö∞ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
                    let specValue = '-';
                    if (specCell) {
                        const specSelect = specCell.querySelector('select');
                        const specInput = specCell.querySelector('input');
                        if (specSelect) {
                            const selectedOpt = specSelect.selectedOptions[0];
                            specValue = selectedOpt?.dataset?.spec || selectedOpt?.textContent || '-';
                        } else if (specInput) {
                            specValue = specInput.value || '-';
                        } else {
                            specValue = specCell.textContent || '-';
                        }
                    }

                    // Îã®ÏúÑ: input ÎòêÎäî ÌÖçÏä§Ìä∏
                    const unitCell = row.querySelector('.unit-cell');
                    let unitValue = '-';
                    if (unitCell) {
                        const unitInput = unitCell.querySelector('input');
                        unitValue = unitInput ? (unitInput.value || '-') : (unitCell.textContent || '-');
                    }

                    // ÎπÑÍ≥† ÏûÖÎ†•Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ (contenteditable div)
                    const remarkDiv = row.querySelector('.remark-editable');
                    const remarkValue = remarkDiv?.innerHTML || '';

                    // Îã®Í∞Ä: input ÎòêÎäî dataset
                    const priceCell = row.querySelector('.price-cell');
                    const priceInput = priceCell?.querySelector('input');
                    let priceValue = '0';
                    if (priceInput) {
                        priceValue = String(parseNumber(priceInput.value) || 0);
                    } else {
                        priceValue = priceCell?.dataset.price || '0';
                    }

                    rows.push({
                        div: divValue,
                        nameIndex: nameIndexValue,
                        name: nameValue,
                        spec: specValue,
                        unit: unitValue,
                        qty: qtyInput?.value || '1',
                        price: priceValue,
                        remark: remarkValue,
                        isCustomDiv: isCustomDiv,
                        isCustomName: isCustomName
                    });
                });

                estimateData[cat.no] = rows;

                // Î©îÎ™® Ï†ÄÏû• (contenteditable div)
                const memoDiv = document.getElementById(`estMemoText${cat.no}`);
                if (memoDiv) {
                    currentData[`estMemo_${cat.no}`] = memoDiv.innerHTML;
                }
            });

            currentData.estimateData = estimateData;
            currentData.estimateProfitRate = document.getElementById('estimateProfitRate')?.value || 15;
        }

        // Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        // [New] Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò (00Î≤à ÏÑ§Í≥Ñ -> 02Î≤à ÏÑ§Í≥Ñ Îì± ÏàúÏÑú Î≥ÄÍ≤Ω ÎåÄÏùë)
        function migrateEstimateData(data) {
            if (!data || !data.estimateData) return;

            if (data.estimateData['00']) {
                console.log('Migrating estimate data from old order to new order...');
                const newData = {};
                const newMemos = {};
                const pad = (n) => n.toString().padStart(2, '0');

                Object.keys(data.estimateData).forEach(oldKey => {
                    let newKey = oldKey;
                    const n = parseInt(oldKey, 10);

                    if (oldKey === '00') {
                        newKey = '02';
                    } else if (oldKey === '01') {
                        newKey = '01';
                    } else if (n >= 2 && n <= 17) {
                        newKey = pad(n + 1);
                    }

                    newData[newKey] = data.estimateData[oldKey];

                    if (data[`estMemo_${oldKey}`]) {
                        newMemos[`estMemo_${newKey}`] = data[`estMemo_${oldKey}`];
                        delete data[`estMemo_${oldKey}`];
                    }
                });

                data.estimateData = newData;
                Object.assign(data, newMemos);
                showToast('Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÉàÎ°úÏö¥ ÏàúÏÑúÎ°ú ÏûêÎèô Î≥ÄÌôòÎêòÏóàÏäµÎãàÎã§. ÌôïÏù∏ ÌõÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.', 'info');
            }
        }

        function loadEstimateData() {
            migrateEstimateData(currentData);
            const profitRateInput = document.getElementById('estimateProfitRate');

            // Í∏∞ÏóÖÏù¥Ïú§Ïú® Î°úÎìú
            if (currentData.estimateProfitRate !== undefined) {
                profitRateInput.value = currentData.estimateProfitRate;
            } else {
                profitRateInput.value = 15;
            }

            // Ï†ÄÏû•Îêú Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Î°úÎìú
            if (currentData.estimateData) {
                categories.forEach(cat => {
                    const tbody = document.getElementById(`estBody${cat.no}`);
                    if (!tbody) return;

                    const savedRows = currentData.estimateData[cat.no];
                    if (!savedRows || savedRows.length === 0) {
                        // Í∏∞Î≥∏ Îπà Ìñâ Ïú†ÏßÄ
                        updateDivOptions(cat.no);
                        return;
                    }

                    tbody.innerHTML = '';
                    const items = getCostItemsByCategory(cat.no);
                    const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                    const divOptions = divs.map(d => `<option value="${d}">${d}</option>`).join('');


                    savedRows.forEach((item, i) => {
                        const isCustomDiv = item.isCustomDiv || false;
                        const isCustomName = item.isCustomName || false;
                        const nameItems = (!isCustomDiv && item.div) ? getItemsByDivInCat(cat.no, item.div) : [];

                        // Í≥†Ïú†Ìïú ÌíàÎ™ÖÎßå Ï∂îÏ∂ú (Ï§ëÎ≥µ Ï†úÍ±∞)
                        const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];

                        const currentName = item.name || '';

                        const nameOptions = uniqueNames.map(name =>
                            `<option value="${name}" ${name === currentName ? 'selected' : ''}>${name}</option>`
                        ).join('');

                        const price = parseInt(item.price) || 0;
                        const qty = parseInt(item.qty) || 0;
                        const amount = price * qty;

                        // Íµ¨Î∂Ñ ÏÖÄ Ï≤òÎ¶¨
                        let divCellContent;
                        if (isCustomDiv) {
                            divCellContent = `<input type="text" class="editable-input div-custom-input" value="${item.div || ''}" placeholder="Íµ¨Î∂Ñ ÏûÖÎ†•"
                                onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                        } else {
                            divCellContent = `<select class="div-select" onchange="onEstDivChange(this, '${cat.no}')">
                                <option value="">ÏÑ†ÌÉù</option>${divOptions.replace(`"${item.div}"`, `"${item.div}" selected`)}
                                <option value="__edit_div__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option>
                                <option value="__custom_div__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>
                            </select>`;
                        }

                        // ÌíàÎ™Ö ÏÖÄ Ï≤òÎ¶¨
                        let nameCellContent;
                        if (isCustomName) {
                            nameCellContent = `<input type="text" class="editable-input name-custom-input" value="${currentName}" placeholder="ÌíàÎ™Ö ÏûÖÎ†•"
                                onchange="saveEstimateData()">`;
                        } else {
                            nameCellContent = `<select class="name-select" onchange="onEstNameChange(this, '${cat.no}')" ${item.div ? '' : 'disabled'
                                }>${item.div ? '<option value="">ÌíàÎ™Ö ÏÑ†ÌÉù</option>' + nameOptions + '<option value="__edit_name__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option><option value="__custom_name__">‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>' : '<option value="">Íµ¨Î∂Ñ Î®ºÏ†Ä ÏÑ†ÌÉù</option>'}</select>`;
                        }

                        // ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏÖÄ Ï≤òÎ¶¨
                        let specCellContent = item.spec || '-';
                        const sameNameItems = nameItems.filter(it => it.name === currentName);

                        if (isCustomDiv || isCustomName) {
                            // ÏßÅÏ†ëÏûÖÎ†• Î™®ÎìúÎ©¥ ÏÉÅÏÑ∏ÎÇ¥Ïö©ÎèÑ ÏûÖÎ†• ÌïÑÎìú
                            specCellContent = `<input type="text" class="editable-input spec-custom-input" value="${item.spec && item.spec !== '-' ? item.spec : ''}" placeholder="ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏûÖÎ†•"
                                onchange="saveEstimateData()">`;
                        } else if (sameNameItems.length > 1) {
                            const specOptions = sameNameItems.map((it, idx) => {
                                const isSelected = (it.spec || '') === item.spec || (it.spec === null && item.spec === '-');
                                return `<option value="${idx}" data-spec="${it.spec || ''}" data-unit="${it.unit || ''}" data-price="${it.unitPrice || 0}" ${isSelected ? 'selected' : ''}>
                                ${it.spec || '(ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏóÜÏùå)'}</option>`;
                            }).join('');

                            specCellContent = `
                            <select class="spec-select" onchange="onEstSpecSelect(this, '${cat.no}')"
                                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;">
                                <option value="">ÏÉÅÏÑ∏ ÏÑ†ÌÉù</option>
                                ${specOptions}
                                <option value="__edit_spec__">üìù ÎÇ¥Ïö©ÏàòÏ†ï</option>
                                <option value="__custom__" ${item.spec && !sameNameItems.find(it => it.spec === item.spec) ? 'selected' : ''}>‚úèÔ∏è ÏßÅÏ†ëÏûÖÎ†•</option>
                            </select>`;
                        }

                        // Îã®ÏúÑ ÏÖÄ Ï≤òÎ¶¨
                        let unitCellContent;
                        if (isCustomDiv || isCustomName) {
                            unitCellContent = `<input type="text" class="editable-input" value="${item.unit && item.unit !== '-' ? item.unit : ''}" placeholder="Îã®ÏúÑ" style="width:100%; text-align:center;"
                                onchange="saveEstimateData()">`;
                        } else {
                            unitCellContent = item.unit || '-';
                        }

                        // Îã®Í∞Ä ÏÖÄ Ï≤òÎ¶¨ (ÏßÅÏ†ëÏûÖÎ†•/ÏùºÎ∞ò Î™®Îëê ÎèôÏùºÌïú ÏôÑÏÑ± ÌÖçÏä§Ìä∏Î°ú ÌëúÏãú)
                        const priceCellContent = `<div class="money-wrapper">${price > 0 ? `<span>‚Ç©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;

                        const tr = document.createElement('tr');
                        tr.className = 'draggable-row';
                        tr.draggable = true;
                        tr.ondragstart = onEstRowDragStart;
                        tr.ondragover = onEstRowDragOver;
                        tr.ondragend = onEstRowDragEnd;
                        tr.innerHTML = `
            <td class="drag-handle" style="position: relative;">
                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${cat.no}')" title="ÏÇ≠Ï†ú">
                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                </button>
                ${i + 1}
            </td>
            <td class="col-div">${divCellContent}</td>
            <td>${nameCellContent}</td>
            <td class="spec-cell">${specCellContent}</td>
            <td class="unit-cell">${unitCellContent}</td>
            <td><input type="number" class="qty-input" value="${item.qty || 1}" min="0"
                    onchange="onEstQtyChange(this, '${cat.no}')"></td>
            <td class="price-cell" data-price="${price}">${priceCellContent}</td>
            <td class="amount-cell"><div class="money-wrapper">${amount > 0 ? `<span>‚Ç©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div></td>
            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()">${item.remark || ''}</div></td>
                        `;
                        tbody.appendChild(tr);

                        // Î°úÎìúÎêú ÏßÅÏ†ëÏûÖÎ†• ÌïÑÎìúÏóê EnterÌÇ§/blur Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
                        if (isCustomDiv || isCustomName) {
                            const divInp = tr.querySelector('.div-custom-input');
                            if (divInp) {
                                divInp.addEventListener('blur', function () { finalizeDirectDivEdit(this, cat.no); });
                                divInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const nameInp = tr.querySelector('.name-custom-input');
                            if (nameInp) {
                                nameInp.addEventListener('blur', function () { finalizeDirectNameEdit(this, cat.no); });
                                nameInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const priceInp = tr.querySelector('.editable-price-input');
                            if (priceInp) {
                                priceInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const specInp = tr.querySelector('.spec-cell .editable-input');
                            if (specInp) {
                                specInp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                                specInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const unitInp = tr.querySelector('.unit-cell .editable-input');
                            if (unitInp) {
                                unitInp.addEventListener('blur', function () { finalizeDirectUnitEdit(this); });
                                unitInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                        }
                    });
                });
            } else {
                // Íµ¨Î∂Ñ ÏòµÏÖòÎßå Ï¥àÍ∏∞Ìôî
                categories.forEach(cat => {
                    updateDivOptions(cat.no);
                });
            }

            // Î©îÎ™® Î°úÎìú (contenteditable div)
            categories.forEach(cat => {
                const memoDiv = document.getElementById(`estMemoText${cat.no}`);
                if (memoDiv && currentData[`estMemo_${cat.no}`] !== undefined) {
                    memoDiv.innerHTML = currentData[`estMemo_${cat.no}`];
                }
            });

            updateEstimateTotals();

            syncCostMemoToEstimate(); // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î©îÎ™®Î•º Í≤¨Ï†ÅÏÑúÏóê ÎèôÍ∏∞Ìôî

            // ÏûëÏÑ±Ïûê ÌëúÏãú
            const authorSpan = document.getElementById('estimateAuthor');
            if (authorSpan) {
                authorSpan.textContent = currentData?.createdBy || '-';
            }

            // Ïª¨Îüº Î¶¨ÏÇ¨Ïù¥Ï¶à Ìï∏Îì§ Ï¥àÍ∏∞Ìôî
            initColumnResize();
        }

        // textarea ÏûêÎèô ÎÜíÏù¥ Ï°∞Ï†à
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î©îÎ™®Î•º Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑúÏóê ÎèôÍ∏∞Ìôî
        function syncCostMemoToEstimate() {
            // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î©îÎ™®Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÇ¨Ïö© (Ìï≠ÏÉÅ ÌëúÏãú) (Phase 2: In-memory ÏÇ¨Ïö©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const estMemoTextarea = document.getElementById(`estMemoText${cat.no}`);
                const costMemoTextarea = document.getElementById(`costMemo${cat.no}`);

                if (estMemoTextarea) {
                    // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î©îÎ™® (Í∏∞Î≥∏Í∞íÏúºÎ°ú Ìï≠ÏÉÅ ÌëúÏãú)
                    const costMemo = globalCostData[`costMemo_${cat.no}`] ||
                        (costMemoTextarea ? costMemoTextarea.value : '') || '';

                    // Ìï≠ÏÉÅ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î©îÎ™® ÌëúÏãú
                    estMemoTextarea.value = costMemo;
                    autoResizeTextarea(estMemoTextarea);
                }
            });
        }

        // ------------------------------------------------------------------------------------------------
        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ìñâ ÏàúÏÑú Î≥ÄÍ≤Ω (Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú)
        // ------------------------------------------------------------------------------------------------

        let estDragSrcEl = null;
        let isEstDragHandleClicked = false;

        // ÎìúÎûòÍ∑∏ Ìï∏Îì§(NO Ïª¨Îüº) ÌÅ¥Î¶≠ Ïó¨Î∂Ä ÌôïÏù∏
        document.addEventListener('mousedown', function (e) {
            isEstDragHandleClicked = !!e.target.closest('.drag-handle');
        });

        function onEstRowDragStart(e) {
            // Ìï∏Îì§ÏùÑ ÌÅ¥Î¶≠Ìïú Í≤ΩÏö∞ÏóêÎßå ÎìúÎûòÍ∑∏ ÏãúÏûë
            if (!isEstDragHandleClicked) {
                e.preventDefault();
                return;
            }

            estDragSrcEl = e.target.closest('tr');
            if (estDragSrcEl) {
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', estDragSrcEl.innerHTML);
                estDragSrcEl.classList.add('dragging');
            }
        }

        function onEstRowDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';

            const targetRow = e.target.closest('tr');
            if (targetRow && targetRow !== estDragSrcEl && estDragSrcEl && targetRow.parentElement === estDragSrcEl.parentElement) {
                const bounding = targetRow.getBoundingClientRect();
                const offset = bounding.y + (bounding.height / 2);
                if (e.clientY - offset > 0) {
                    targetRow.after(estDragSrcEl);
                } else {
                    targetRow.before(estDragSrcEl);
                }
            }
            return false;
        }

        function onEstRowDragEnd(e) {
            if (estDragSrcEl) {
                estDragSrcEl.classList.remove('dragging');

                const tbody = estDragSrcEl.parentElement;
                if (tbody) {
                    const catNo = tbody.id.replace('estBody', '');
                    renumberEstimateRows(tbody, catNo);
                    saveEstimateData();
                }
            }
            estDragSrcEl = null;
        }

        function renumberEstimateRows(tbody, catNo) {
            tbody.querySelectorAll('tr').forEach((row, index) => {
                const td = row.querySelector('td:first-child');
                // Í∏∞Ï°¥ Î≤ÑÌäº HTML Î≥¥Ï°¥ÌïòÎ©∞ Î≤àÌò∏Îßå Î≥ÄÍ≤Ω
                td.innerHTML = `
                    <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${catNo}')" title="ÏÇ≠Ï†ú">
                         <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                    </button>
                    ${index + 1}
                `;
                td.classList.add('drag-handle');
                td.style.position = 'relative';
            });
        }

        // Í∏∞Ï°¥ Ìï®ÏàòÎì§ Ï†úÍ±∞/ÍµêÏ≤¥
        function updateEstimateFromCost() { }
        function getAllCostItems() { return []; }
        function loadAllCostItems() { }
        function clearEstimateRows() { }
        function onCheckChange() { }
        function onQtyChange() { }

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ï†ÄÏû• (Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Î°ú Ï†ÄÏû• - Î™®Îì† Í≥†Í∞ùÏóêÍ≤å ÎèôÏùºÌïòÍ≤å Ï†ÅÏö©)
        function saveCostData() {
            const globalCostData = {};

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);
                if (!tbody) return;
                globalCostData[`cost_${cat.no}`] = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const inputs = row.querySelectorAll('.col-div input, .col-name input');
                    const specCell = row.querySelector('.col-spec');
                    const unitCell = row.querySelector('.col-unit');
                    const qtyInput = row.querySelector('.col-qty input');
                    const priceInput = row.querySelector('.col-price input');

                    // ÏÉÅÏÑ∏ÎÇ¥Ïö©: select ÎòêÎäî inputÏóêÏÑú Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
                    let specValue = '';
                    if (specCell) {
                        const specSelect = specCell.querySelector('select');
                        const specInput = specCell.querySelector('input');
                        specValue = specSelect ? specSelect.value : (specInput ? specInput.value : '');
                    }

                    // Îã®ÏúÑ: select ÎòêÎäî inputÏóêÏÑú Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
                    let unitValue = '';
                    if (unitCell) {
                        const unitSelect = unitCell.querySelector('.unit-select');
                        const unitInput = unitCell.querySelector('.unit-input');
                        unitValue = unitSelect ? unitSelect.value : (unitInput ? unitInput.value : '');
                    }

                    if (inputs.length >= 2 && inputs[1].value) {
                        globalCostData[`cost_${cat.no}`].push({
                            div: inputs[0].value,
                            name: inputs[1].value,
                            spec: specValue,
                            unit: unitValue,
                            qty: qtyInput ? qtyInput.value : '',
                            price: priceInput ? priceInput.value : ''
                        });
                    }
                });
                // MEMO Ï†ÄÏû•
                if (memo) {
                    globalCostData[`costMemo_${cat.no}`] = memo.value;
                }
            });

            // Master DBÎäî Ïù¥ ÌôîÎ©¥ÏóêÏÑú Ï†ÄÏû•Ìï† Ïàò ÏóÜÏäµÎãàÎã§. (Read-Only)
            // if (currentAdmin && currentAdmin.role === 'main') { syncCostToCloud(globalCostData); }
        }

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ï†ÄÏû• ÏöîÏ≤≠ (ÎπÑÌôúÏÑ±Ìôî - Read Only)
        async function requestCostSave() {
            showToast('ÎßàÏä§ÌÑ∞ ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎäî ÏãúÌä∏ÏóêÏÑú ÏßÅÏ†ë ÏàòÏ†ïÌï¥Ïïº Ìï©ÎãàÎã§.', 'info');
        }

        // ==========================================
        // [ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî]
        // ==========================================

        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨ÌëúÎ•º Google SheetsÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
        async function syncCostFromCloud() {
            try {
                showToast('ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î∂àÎü¨Ïò§Îäî Ï§ë...', 'info');

                const params = new URLSearchParams({
                    sheet: 'ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú',
                    t: new Date().getTime()
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error('ÏÑúÎ≤Ñ ÏùëÎãµ Ïò§Î•ò: ' + response.status);
                }

                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                if (result.data && Array.isArray(result.data)) {
                    // Îç∞Ïù¥ÌÑ∞Î•º Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ï†ïÎ¶¨
                    let cloudCostData = {};
                    let loadCount = 0;
                    let unmappedCount = 0;

                    result.data.forEach(item => {
                        // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤àÌò∏ Îß§Ìïë (Ìó§ÎçîÍ∞í Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ Íµ¨Î∂ÑÍ∞í ÏÇ¨Ïö©)
                        // item.categoryÍ∞Ä ÏÉÅÏúÑ Ìó§Îçî(Ïòà: 'ÏöïÏã§Í≥µÏÇ¨')Ïùº Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏúºÎØÄÎ°ú Ïù¥Í≤ÉÎ∂ÄÌÑ∞ Îß§Ìïë ÏãúÎèÑ
                        let catNo = mapCategoryToNo(item.category);
                        if (!catNo) catNo = mapCategoryToNo(item.div);

                        if (!catNo) {
                            unmappedCount++;
                            // console.warn('Î∂ÑÎ•ò Ïã§Ìå®:', item.category, item.div, item.name); // ÎîîÎ≤ÑÍπÖÏö©
                            return;
                        }

                        if (!cloudCostData[`cost_${catNo}`]) {
                            cloudCostData[`cost_${catNo}`] = [];
                        }

                        cloudCostData[`cost_${catNo}`].push({
                            div: item.div || '',
                            name: item.name || '',
                            spec: item.spec || '',
                            unit: item.unit || '',
                            qty: item.qty || '',
                            price: item.price || ''
                        });
                        loadCount++;
                    });

                    // Î©îÎ™® Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
                    if (result.memos && typeof result.memos === 'object') {
                        Object.keys(result.memos).forEach(categoryName => {
                            const catNo = mapCategoryToNo(categoryName);
                            if (catNo && result.memos[categoryName] && result.memos[categoryName].length > 0) {
                                // Î©îÎ™® Î∞∞Ïó¥ÏùÑ Ï§Ñ Îã®ÏúÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÏïûÏóê ÎèôÍ∑∏ÎùºÎØ∏ Ï∂îÍ∞Ä)
                                const memoLines = result.memos[categoryName]
                                    .map(m => m.content || '')
                                    .filter(line => line.trim())
                                    .map(line => '‚Ä¢ ' + line)
                                    .join('\n');
                                cloudCostData[`costMemo_${catNo}`] = memoLines;
                            }
                        });
                    }

                    // In-memory Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                    globalCostData = cloudCostData;
                    // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ


                    // UI Î¶¨Î°úÎìú
                    createCostCategories();
                    loadCostData();

                    let msg = `ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú ${loadCount}Í∞ú Ìï≠Î™©ÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.`;
                    if (unmappedCount > 0) {
                        msg += ` (Î∂ÑÎ•ò Ïã§Ìå®: ${unmappedCount}Í±¥)`;
                        console.warn(`Ï¥ù ${unmappedCount}Í∞ú Ìï≠Î™©ÏùÑ Î∂ÑÎ•òÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§. Íµ¨Í∏Ä ÏãúÌä∏Ïùò [Íµ¨Î∂Ñ] ÎòêÎäî [Ïπ¥ÌÖåÍ≥†Î¶¨] Î™ÖÏπ≠ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.`);
                        showToast(`ÏùºÎ∂Ä Ìï≠Î™©(${unmappedCount}Í∞ú)ÏùÑ Î∂ÑÎ•òÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§. Íµ¨Í∏Ä ÏãúÌä∏ ÏñëÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.`, 'warning');
                    } else {
                        showToast(msg, 'success');
                    }
                } else {
                    showToast('ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                }

                return true;

            } catch (error) {
                console.error('ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                showToast('ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
                return false;
            }
        }


        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶ÑÏùÑ Î≤àÌò∏Î°ú Îß§Ìïë
        function mapCategoryToNo(categoryName) {
            if (!categoryName) return null;
            const name = categoryName.trim();

            const categoryMap = {
                'Í∞ÄÏÑ§Í≥µÏÇ¨': '01', 'Í∞ÄÏÑ§': '01',
                'ÏÑ§Í≥Ñ Î∞è Í¥ÄÎ¶¨ÎπÑ': '02', 'ÏÑ§Í≥Ñ': '02', 'Í¥ÄÎ¶¨ÎπÑ': '02', 'ÏÑ§Í≥ÑÎπÑ': '02',
                'Ï≤†Í±∞Í≥µÏÇ¨': '03', 'Ï≤†Í±∞': '03',
                'ÏÑ§ÎπÑ/Î∞©ÏàòÍ≥µÏÇ¨': '04', 'ÏÑ§ÎπÑ': '04', 'Î∞©Ïàò': '04',
                'ÌôïÏû•/Îã®Ïó¥Í≥µÏÇ¨': '05', 'ÌôïÏû•': '05', 'Îã®Ïó¥': '05',
                'Ï∞ΩÌò∏Í≥µÏÇ¨': '06', 'Ï∞ΩÌò∏': '06', 'ÏÉ§Ïãú': '06', 'ÏÉ∑Ïãú': '06',
                'Ï†ÑÍ∏∞/Ï°∞Î™ÖÍ≥µÏÇ¨': '07', 'Ï†ÑÍ∏∞': '07', 'Ï°∞Î™Ö': '07', 'ÏΩòÏÑºÌä∏': '07',
                'ÏóêÏñ¥Ïª®Í≥µÏÇ¨': '08', 'ÏóêÏñ¥Ïª® Í≥µÏÇ¨': '08', 'ÏóêÏñ¥Ïª®': '08',
                'Î™©Í≥µ/ÎèÑÏñ¥Í≥µÏÇ¨': '09', 'Î™©Í≥µ': '09', 'ÎèÑÏñ¥': '09', 'Î™∞Îî©': '09', 'Í±∏Î†àÎ∞õÏù¥': '09',
                'ÌïÑÎ¶ÑÍ≥µÏÇ¨': '10', 'ÌïÑÎ¶Ñ': '10', 'Ïù∏ÌÖåÎ¶¨Ïñ¥ÌïÑÎ¶Ñ': '10',
                'ÌÉÄÏùºÍ≥µÏÇ¨': '11', 'ÌÉÄÏùº': '11',
                'ÏöïÏã§Í≥µÏÇ¨': '12', 'ÏöïÏã§': '12', 'ÎèÑÍ∏∞': '12', 'ÏàòÏ†Ñ': '12', 'ÏÑ∏Î©¥': '12', 'ÏñëÎ≥ÄÍ∏∞': '12', 'ÏöïÏ°∞': '12', 'Ï††Îã§Ïù¥': '12', 'ÌååÌã∞ÏÖò': '12',
                'ÎèÑÏû•Í≥µÏÇ¨': '13', 'ÎèÑÏû•': '13', 'ÌéòÏù∏Ìä∏': '13', 'ÌÉÑÏÑ±': '13',
                'ÎèÑÎ∞∞Í≥µÏÇ¨': '14', 'ÎèÑÎ∞∞': '14', 'Î≤ΩÏßÄ': '14',
                'Î∞îÎã•Ïû¨Í≥µÏÇ¨': '15', 'Î∞îÎã•': '15', 'Î∞îÎã•Ïû¨': '15', 'ÎßàÎ£®': '15', 'Ïû•Ìåê': '15', 'Îç∞ÏΩîÌÉÄÏùº': '15',
                'Í∞ÄÍµ¨Í≥µÏÇ¨': '16', 'Í∞ÄÍµ¨': '16', 'Ïã±ÌÅ¨ÎåÄ': '16', 'Ïã†Î∞úÏû•': '16', 'Î∂ôÎ∞ïÏù¥Ïû•': '16',
                'ÎßàÍ∞êÍ≥µÏÇ¨': '17', 'ÎßàÍ∞ê': '17', 'ÏûÖÏ£ºÏ≤≠ÏÜå': '17', 'Ï§ÄÍ≥µÏ≤≠ÏÜå': '17',
                'Í∏∞ÌÉÄÍ≥µÏÇ¨': '18', 'Í∏∞ÌÉÄ': '18'
            };

            // 1. ÏôÑÏ†Ñ ÏùºÏπò ÎòêÎäî Îß§Ìïë ÌÖåÏù¥Î∏î Í≤ÄÏÉâ
            if (categoryMap[name]) return categoryMap[name];

            // 2. ÌÇ§ÏõåÎìú Î∂ÄÎ∂Ñ ÏùºÏπò Í≤ÄÏÉâ (Ïö∞ÏÑ†ÏàúÏúÑÏóê Ï£ºÏùò)
            // ÏÑ§Í≥Ñ Î∞è Í¥ÄÎ¶¨ÎπÑ ÌÇ§ÏõåÎìú Ï≤¥ÌÅ¨
            if (name.includes('ÏÑ§Í≥Ñ') || name.includes('Í¥ÄÎ¶¨ÎπÑ')) return '02';
            // ÏöïÏã§ Í¥ÄÎ†® ÌÇ§ÏõåÎìúÎ•º Í∞ÄÏû• Î®ºÏ†Ä Ï≤¥ÌÅ¨ (ÏöïÏã§Í≥µÏÇ¨Ïóê Îã§ÏñëÌïú ÏÑ∏Î∂Ä Í≥µÏ†ïÏù¥ Ìè¨Ìï®Îê®)
            if (name.includes('ÏöïÏã§') || name.includes('UBR') || name.includes('ÏàòÎèÑ') ||
                name.includes('Ï°∞Ï†Å') || name.includes('Ï∞∏Í≥†') || name.includes('ÏïÖÏÑ∏') ||
                name.includes('Ïï°ÏÑ∏') || name.includes('ÎùºÎîîÏóêÏù¥ÌÑ∞') || name.includes('Îèî') ||
                name.includes('Ï≤úÏû•') || name.includes('ÌôòÌíç') || name.includes('Î≥ÄÍ∏∞') ||
                name.includes('ÏÑ∏Î©¥') || name.includes('ÏÉ§Ïõå') || name.includes('ÏöïÏ°∞')) return '12';
            if (name.includes('ÌÉÄÏùº')) return '11';
            if (name.includes('Î™©Í≥µ') || name.includes('ÎèÑÏñ¥') || name.includes('Î¨∏')) return '09';
            if (name.includes('ÌïÑÎ¶Ñ')) return '10';
            if (name.includes('ÎèÑÎ∞∞')) return '14';
            if (name.includes('Î∞îÎã•') || name.includes('ÎßàÎ£®') || name.includes('Ïû•Ìåê')) return '15';
            if (name.includes('Í∞ÄÍµ¨') || name.includes('Ïã±ÌÅ¨')) return '16';
            if (name.includes('Ï†ÑÍ∏∞') || name.includes('Ï°∞Î™Ö') || name.includes('Ïä§ÏúÑÏπò')) return '07';
            if (name.includes('ÏÑ§ÎπÑ') || name.includes('Î∞©Ïàò') || name.includes('Î≥¥ÏùºÎü¨')) return '04';
            if (name.includes('Ï≤†Í±∞')) return '03';
            if (name.includes('Ï∞ΩÌò∏') || name.includes('ÏÉ§Ïãú') || name.includes('ÏÉ∑Ïãú')) return '06';
            if (name.includes('ÏóêÏñ¥Ïª®')) return '07';
            if (name.includes('ÎèÑÏû•') || name.includes('ÌéòÏù∏Ìä∏')) return '12';
            if (name.includes('ÎßàÍ∞ê') || name.includes('Ï≤≠ÏÜå')) return '16';

            return null;
        }



        // ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞)
        function loadCostData() {
            // Ï†ÑÏó≠ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Phase 2: In-memory ÏÇ¨Ïö©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);
                if (!tbody) return;

                // Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
                let data = globalCostData[`cost_${cat.no}`] || [];
                if (data.length === 0 && defaultCostData[cat.no]) {
                    data = defaultCostData[cat.no];
                }

                if (data.length === 0) {
                    tbody.innerHTML = `<tr>
                <td class="col-no">1</td>
                <td class="col-div"><input type="text"></td>
                <td class="col-name"><input type="text"></td>
                <td class="col-spec"><input type="text"></td>
                <td class="col-unit">${getUnitSelectHTML()}</td>
                <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-total">0</td>
            </tr>`;
                } else {
                    tbody.innerHTML = data.map((item, i) => {
                        const price = item.price || ((parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) +
                            (parseNumber(item.expense) || 0)) || '';
                        const qty = parseNumber(item.qty) || 0;
                        const priceNum = parseNumber(price) || 0;
                        const total = qty * priceNum;
                        return `<tr>
                <td class="col-no">${i + 1}</td>
                <td class="col-div"><input type="text" value="${item.div || ''}"></td>
                <td class="col-name"><input type="text" value="${item.name || ''}"></td>
                <td class="col-spec"><input type="text" value="${item.spec || ''}"></td>
                <td class="col-unit">${getUnitSelectHTML(item.unit || 'Ïãù')}</td>
                <td class="col-qty"><input type="text" value="${item.qty || ''}" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" value="${price}" oninput="calcCostRow(this)"></td>
                <td class="col-total">${formatNumber(total)}</td>
            </tr>`;
                    }).join('');
                }
                // MEMO Î°úÎìú (Ï†ÄÏû•Îêú Î©îÎ™®Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Î©îÎ™® ÏÇ¨Ïö©)
                if (memo) {
                    memo.value = globalCostData[`costMemo_${cat.no}`] || defaultCostMemos[cat.no] || '';
                    autoResizeTextarea(memo);
                }
                // ÏÜåÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                updateCostCategorySubtotal(cat.no);
            });
            // Î©îÎ™®Î•º Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑúÏóê ÎèôÍ∏∞Ìôî
            syncCostMemoToEstimate();
        }

        function clearCostData() {
            // Ï†ÑÏó≠ ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Phase 2: In-memory ÏÇ¨Ïö©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);

                // Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞
                let data = globalCostData[`cost_${cat.no}`] || [];
                if (data.length === 0) {
                    data = defaultCostData[cat.no] || [];
                }

                if (tbody) {
                    if (data.length > 0) {
                        tbody.innerHTML = data.map((item, i) => {
                            const price = item.price || ((parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) +
                                (parseNumber(item.expense) || 0)) || '';
                            const qty = parseNumber(item.qty) || 0;
                            const priceNum = parseNumber(price) || 0;
                            const total = qty * priceNum;
                            return `<tr>
                <td class="col-no">${i + 1}</td>
                <td class="col-div"><input type="text" value="${item.div || ''}"></td>
                <td class="col-name"><input type="text" value="${item.name || ''}"></td>
                <td class="col-spec"><input type="text" value="${item.spec || ''}"></td>
                <td class="col-unit">${getUnitSelectHTML(item.unit || 'Ïãù')}</td>
                <td class="col-qty"><input type="text" value="${item.qty || ''}" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" value="${price}" oninput="calcCostRow(this)"></td>
                <td class="col-total">${formatNumber(total)}</td>
            </tr>`;
                        }).join('');
                    } else {
                        tbody.innerHTML = `<tr>
                <td class="col-no">1</td>
                <td class="col-div"><input type="text"></td>
                <td class="col-name"><input type="text"></td>
                <td class="col-spec"><input type="text"></td>
                <td class="col-unit">${getUnitSelectHTML()}</td>
                <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-total">0</td>
            </tr>`;
                    }
                }
                if (memo) {
                    memo.value = globalCostData[`costMemo_${cat.no}`] || defaultCostMemos[cat.no] || '';
                    autoResizeTextarea(memo);
                }
                // ÏÜåÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                updateCostCategorySubtotal(cat.no);
            });
        }

        function downloadPDF(elementId, filename) {
            const element = document.getElementById(elementId);
            if (!element) {
                showToast('Î¨∏ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }

            const customerName = currentData.clientName || 'Í≥†Í∞ù';
            const today = new Date().toISOString().split('T')[0];
            const pdfFilename = ` ${customerName}_${filename}_${today} `;

            // ÏÉà Ï∞ΩÏóêÏÑú Ïù∏ÏáÑ
            const printWindow = window.open('', '_blank');

            if (!printWindow) {
                showToast('ÌåùÏóÖÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§. ÌåùÏóÖÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            // Ïä§ÌÉÄÏùº Î≥µÏÇ¨
            const styles = document.querySelectorAll('style, link[rel="stylesheet"]');
            let styleHTML = '';
            styles.forEach(s => styleHTML += s.outerHTML);

            // element Î≥µÏ†ú
            const clonedElement = element.cloneNode(true);

            // ÏàòÎèô Ï°∞Ï†àÎêú Ïª¨Îüº ÎÑàÎπÑÎ•º colgroup colÏóê Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùºÎ°ú ÎèôÍ∏∞Ìôî
            element.querySelectorAll('.estimate-table').forEach((origTable, tableIdx) => {
                const clonedTable = clonedElement.querySelectorAll('.estimate-table')[tableIdx];
                if (!clonedTable) return;
                const origThs = origTable.querySelectorAll('thead th');
                const clonedCols = clonedTable.querySelectorAll('colgroup col');
                origThs.forEach((th, i) => {
                    if (clonedCols[i]) {
                        clonedCols[i].style.width = th.offsetWidth + 'px';
                    }
                });
            });

            // Ïù∏ÏáÑÏóê Î∂àÌïÑÏöîÌïú ÏöîÏÜå Ï†úÍ±∞ (ÎÖ∏ÏÖò Î≤ÑÌäº, ÏïÑÏù¥ÏΩò Îì±)
            clonedElement.querySelectorAll('.no-print, .btn, .pdf-btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // [Fix] Clone does not copy dynamic values! Sync manually.
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');
            originalInputs.forEach((inp, i) => {
                if (clonedInputs[i]) {
                    if (inp.type === 'checkbox' || inp.type === 'radio') {
                        clonedInputs[i].checked = inp.checked;
                    } else {
                        clonedInputs[i].value = inp.value;
                    }
                }
            });

            // Î™®Îì† inputÏùÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò
            clonedElement.querySelectorAll('input').forEach(input => {
                // Radio/Checkbox handling
                if (input.type === 'radio' || input.type === 'checkbox') {
                    const span = document.createElement('span');
                    span.textContent = input.checked ? '‚òë' : '‚òê';
                    span.style.cssText = 'display:inline-block; margin-right:4px; font-weight:bold;';
                    input.parentNode.replaceChild(span, input);
                    return;
                }

                const span = document.createElement('span');
                span.textContent = input.value || '-';
                span.style.cssText = 'display:inline-block; padding:3px 0; font-size:inherit;';
                input.parentNode.replaceChild(span, input);
            });

            // Î™®Îì† textareaÎ•º ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (Ïä§ÌÅ¨Î°§ ÏóÜÏù¥ Ï†ÑÏ≤¥ ÌëúÏãú)
            clonedElement.querySelectorAll('textarea').forEach(textarea => {
                const div = document.createElement('div');
                div.textContent = textarea.value || '';
                div.style.cssText = 'white-space:pre-wrap; padding:6px 0; font-size:inherit; line-height:1.5;';
                textarea.parentNode.replaceChild(div, textarea);
            });

            // Î™®Îì† selectÎ•º ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò
            clonedElement.querySelectorAll('select').forEach(select => {
                const span = document.createElement('span');
                const selectedOption = select.options[select.selectedIndex];
                span.textContent = selectedOption ? selectedOption.text : '-';
                span.style.cssText = 'display:inline-block; padding:3px 0; font-size:inherit;';
                select.parentNode.replaceChild(span, select);
            });

            // Í≤¨Ï†ÅÏÑúÏù∏ Í≤ΩÏö∞ Ï∂îÍ∞Ä Ï≤òÎ¶¨
            if (elementId === 'estimateDoc') {
                // ÌíàÎ™ÖÏù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùÄ Ìñâ Ï†úÍ±∞ (Í∏àÏï°Ïù¥ '-'Ïù∏ Ìñâ)
                clonedElement.querySelectorAll('.estimate-table tbody tr').forEach(tr => {
                    const amountCell = tr.querySelector('.amount-cell');
                    if (amountCell && (amountCell.textContent === '-' || amountCell.textContent === '0')) {
                        tr.remove();
                    }
                });

                // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î≤àÌò∏ Ïû¨Ï†ïÎ†¨
                clonedElement.querySelectorAll('.estimate-table tbody').forEach(tbody => {
                    tbody.querySelectorAll('tr').forEach((tr, i) => {
                        const cells = tr.querySelectorAll('td');
                        if (cells[0]) cells[0].textContent = i + 1;
                    });
                });

                // Îπà Ïπ¥ÌÖåÍ≥†Î¶¨ Ïà®Í∏∞Í∏∞ (Ìï≠Î™©Ïù¥ ÏóÜÎäî Ïπ¥ÌÖåÍ≥†Î¶¨)
                clonedElement.querySelectorAll('.category-section').forEach(section => {
                    const tbody = section.querySelector('.estimate-table tbody');
                    if (tbody && tbody.querySelectorAll('tr').length === 0) {
                        section.style.display = 'none';
                    }
                });


            }

            // Ïù∏ÏáÑÏö© HTML ÏÉùÏÑ±
            printWindow.document.write(`
                            <!DOCTYPE html>
                                <html>

                                    <head>
                                        <meta charset="UTF-8">
                                            <title>${pdfFilename}</title>
                                            ${styleHTML}                                            <style>
                                                @page {
                                                    size: A4;
                                                margin: 8mm 5mm 10mm 5mm;
                        /* Ï¢åÏö∞ ÏµúÏÜåÌôî */
                   }

                                                * {
                                                    -webkit-print - color-adjust: exact !important;
                                                print-color-adjust: exact !important;
                   }

                                                html,
                                                body {
                                                    margin: 0 !important;
                                                padding: 0 !important;
                                                width: 100% !important;
                                                background: white !important;
                   }

                                                .document-wrapper {
                                                    box-shadow: none !important;
                                                border: none !important;
                                                margin: 0 !important;
                                                padding: 10px !important;
                                                width: 100% !important;
                                                max-width: none !important;
                   }

                                                .doc-content {
                                                    padding: 0 !important;
                   }

                                                .pdf-btn,
                                                .no-print,
                                                .add-row-btn,
                                                .estimate-actions {
                                                    display: none !important;
                   }

                                                /* ÌÖåÏù¥Î∏î Ï†ÑÏ≤¥ ÎÑàÎπÑ */
                                                .data-table,
                                                .estimate-table,
                                                .summary-table,
                                                .estimate-select-table {
                                                    width: 100% !important;
                                                table-layout: fixed !important;
                                                font-size: 10px !important;
                   }

                                                /* ÌÖåÏù¥Î∏î Ìó§Îçî */
                                                .data-table th,
                                                .estimate-table th,
                                                .summary-table th {
                                                    padding: 5px 3px !important;
                                                font-size: 9px !important;
                                                white-space: nowrap !important;
                   }

                                                /* ÌÖåÏù¥Î∏î ÏÖÄ */
                                                .data-table td,
                                                .estimate-table td,
                                                .summary-table td {
                                                    padding: 4px 3px !important;
                                                font-size: 10px !important;
                   }

                                                /* ===== Í≤¨Ï†ÅÏÑú ÌÖåÏù¥Î∏î Ïª¨ÎüºÎ≥Ñ ÏÑ§Ï†ï ===== */
                                                /* Ìó§Îçî Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */
                                                .estimate-table th {
                                                    text-align: center !important;
                   }
                                                /* No (1Î≤àÏß∏) */
                                                .estimate-table th:nth-child(1),
                                                .estimate-table td:nth-child(1) {
                                                    width: 20px !important;
                                                text-align: center !important;
                   }

                                                /* Íµ¨Î∂Ñ (2Î≤àÏß∏) - Ïù∏ÏáÑ Ïãú Ï¢ÅÍ≤å */
                                                .estimate-table th:nth-child(2),
                                                .estimate-table td:nth-child(2) {
                                                    width: 50px !important;
                                                text-align: left !important;
                   }

                                                /* ÌíàÎ™Ö (3Î≤àÏß∏) - Ï¢åÏ∏°Ï†ïÎ†¨ */
                                                .estimate-table th:nth-child(3),
                                                .estimate-table td:nth-child(3) {
                                                    width: 15% !important;
                                                text-align: left !important;
                   }

                                                /* ÏÉÅÏÑ∏ÎÇ¥Ïö© (4Î≤àÏß∏) - Ï¢åÏ∏°Ï†ïÎ†¨, Í∞ÄÏû• ÎÑìÍ≤å */
                                                .estimate-table th:nth-child(4),
                                                .estimate-table td:nth-child(4) {
                                                    width: 25% !important;
                                                text-align: left !important;
                   }

                                                /* Îã®ÏúÑ (5Î≤àÏß∏) - Ï§ëÏïô, Í≥†Ï†ï */
                                                .estimate-table th:nth-child(5),
                                                .estimate-table td:nth-child(5) {
                                                    width: 30px !important;
                                                text-align: center !important;
                   }

                                                /* ÏàòÎüâ (6Î≤àÏß∏) - Ï§ëÏïô, Í≥†Ï†ï */
                                                .estimate-table th:nth-child(6),
                                                .estimate-table td:nth-child(6) {
                                                    width: 35px !important;
                                                text-align: center !important;
                   }

                                                /* Îã®Í∞Ä (7Î≤àÏß∏) - ÎÑàÎπÑ Ï∂ïÏÜå, Ï§ëÏïô Ï†ïÎ†¨ */
                                                .estimate-table th:nth-child(7),
                                                .estimate-table td:nth-child(7) {
                                                    width: 75px !important;
                                                text-align: center !important;
                   }
                                                .estimate-table td:nth-child(7) .won-amount {
                                                    display: flex !important;
                                                justify-content: center !important;
                                                gap: 4px !important;
                   }

                                                /* Í∏àÏï° (8Î≤àÏß∏) - ÎÑàÎπÑ Ï∂ïÏÜå, Ï§ëÏïô Ï†ïÎ†¨ */
                                                .estimate-table th:nth-child(8),
                                                .estimate-table td:nth-child(8) {
                                                    width: 80px !important;
                                                text-align: center !important;
                   }
                                                .estimate-table td:nth-child(8) .won-amount {
                                                    display: flex !important;
                                                justify-content: center !important;
                                                gap: 4px !important;
                   }

                                                /* ÎπÑÍ≥† (9Î≤àÏß∏) - ÎÇòÎ®∏ÏßÄ Í≥µÍ∞Ñ */
                                                .estimate-table th:nth-child(9),
                                                .estimate-table td:nth-child(9) {
                                                    width: auto !important;
                                                text-align: left !important;
                   }

                                                /* ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú Ïª¨Îüº ÎÑàÎπÑ */
                                                .data-table colgroup col:nth-child(1) {
                                                    width: 18px;
                   }

                                                /* No */
                                                .data-table colgroup col:nth-child(2) {
                                                    width: 32px;
                   }

                                                /* Íµ¨Î∂Ñ */
                                                .data-table colgroup col:nth-child(3) {
                                                    width: auto;
                   }

                                                /* ÌíàÎ™Ö */
                                                .data-table colgroup col:nth-child(4) {
                                                    width: 70px;
                   }

                                                /* Í∑úÍ≤© */
                                                .data-table colgroup col:nth-child(5) {
                                                    width: 28px;
                   }

                                                /* Îã®ÏúÑ */
                                                .data-table colgroup col:nth-child(6) {
                                                    width: 28px;
                   }

                                                /* ÏàòÎüâ */
                                                .data-table colgroup col:nth-child(7) {
                                                    width: 65px;
                   }

                                                /* Îã®Í∞Ä */
                                                .data-table colgroup col:nth-child(8) {
                                                    width: 60px;
                   }

                                                /* Í∏àÏï° */
                                                .data-table colgroup col:nth-child(9) {
                                                    width: 45px;
                   }

                                                /* ÎπÑÍ≥† */

                                                /* Í≤¨Ï†ÅÏÑú Ïª¨Îüº - Í≥†Ï†ï ÎÑàÎπÑ */
                                                .estimate-table colgroup col {
                                                    width: auto !important;
                   }

                                                /* Íµ¨Î∂Ñ Ïó¥ Ïà®Í∏∞Í∏∞ */
                                                .col-div,
                                                th.col-div {
                                                    display: none !important;
                   }

                                                /* Ï≤¥ÌÅ¨Î∞ïÏä§ Ïà®Í∏∞Í∏∞ */
                                                input[type="checkbox"] {
                                                    display: none !important;
                   }

                                                /* Ìñâ Ïä§ÌÉÄÏùº Ï†ïÎ¶¨ */
                                                tr {
                                                    opacity: 1 !important;
                                                text-decoration: none !important;
                   }

                                                /* Ïπ¥ÌÖåÍ≥†Î¶¨ Ìó§Îçî */
                                                .category-header {
                                                    padding: 5px 8px !important;
                   }

                                                .category-header h3 {
                                                    font-size: 10px !important;
                   }

                                                .category-header .subtotal {
                                                    font-size: 10px !important;
                   }

                                                /* Ï¥ùÌï©Í≥Ñ */
                                                .grand-total {
                                                    padding: 8px !important;
                                                margin-top: 6px !important;
                   }

                                                .total-row {
                                                    padding: 3px 0 !important;
                   }

                                                .total-row label {
                                                    font-size: 9px !important;
                   }

                                                .total-row .amount {
                                                    font-size: 10px !important;
                   }

                                                .total-row.main .amount {
                                                    font-size: 12px !important;
                   }

                                                /* Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú */
                                                .info-grid {
                                                    gap: 5px !important;
                   }

                                                .info-item {
                                                    padding: 5px 6px !important;
                   }

                                                .info-item label {
                                                    font-size: 7px !important;
                   }

                                                .info-item input,
                                                .info-item select,
                                                .info-item span {
                                                    font-size: 9px !important;
                   }

                                                /* Î©îÎ™® Ï†ÑÏ≤¥ ÌëúÏãú */
                                                .estimate-memo,
                                                .category-memo {
                                                    overflow: visible !important;
                                                max-height: none !important;
                   }

                                                .estimate-memo .memo-content,
                                                .category-memo textarea {
                                                    white-space: pre-wrap !important;
                                                word-break: break-word !important;
                                                font-size: 8px !important;
                   }

                                                /* ÏÑúÎ™Ö ÏòÅÏó≠ */
                                                .signature-grid {
                                                    display: grid !important;
                                                    grid-template-columns: repeat(2, 1fr) !important;
                                                    gap: 12px !important;
                   }

                                                .signature-card {
                                                    background: #fbfbfd !important;
                                                    border-radius: 8px !important;
                                                    padding: 14px !important;
                                                    border: 1px solid #e8e8ed !important;
                   }

                                                .signature-card h4 {
                                                    font-size: 11px !important;
                                                    text-align: center !important;
                                                    font-weight: 700 !important;
                                                    margin-bottom: 10px !important;
                                                    padding-bottom: 6px !important;
                                                    border-bottom: 1px solid #e8e8ed !important;
                   }

                                                .sig-row {
                                                    display: grid !important;
                                                    grid-template-columns: repeat(2, 1fr) !important;
                                                    gap: 8px !important;
                                                    margin-bottom: 6px !important;
                   }

                                                .sig-field {
                                                    margin-bottom: 4px !important;
                   }

                                                .sig-field label {
                                                    font-size: 8px !important;
                                                    display: block !important;
                                                    color: #86868b !important;
                                                    font-weight: 600 !important;
                                                    margin-bottom: 2px !important;
                   }

                                                .sig-field input,
                                                .sig-field span {
                                                    font-size: 10px !important;
                                                    border: none !important;
                                                    border-bottom: 1px solid #d2d2d7 !important;
                                                    padding: 3px 0 !important;
                                                    font-weight: 500 !important;
                   }

                                                .signature-box {
                                                    margin-top: 8px !important;
                                                    padding: 14px !important;
                                                    background: #fff !important;
                                                    border: 2px dashed #d2d2d7 !important;
                                                    border-radius: 6px !important;
                                                    text-align: center !important;
                                                    color: #86868b !important;
                                                    font-size: 10px !important;
                   }

                                                .stamp-warning {
                                                    margin-top: 6px !important;
                                                    background: #fff9e6 !important;
                                                    border: 2px solid #ffcc00 !important;
                                                    border-radius: 4px !important;
                                                    padding: 5px !important;
                                                    text-align: center !important;
                                                    font-size: 10px !important;
                                                    color: #1d1d1f !important;
                                                    font-weight: 500 !important;
                   }

                                                .date-box {
                                                    text-align: center !important;
                                                    padding: 16px !important;
                                                    background: #fbfbfd !important;
                                                    border-radius: 8px !important;
                                                    margin: 16px 0 !important;
                                                    border: 1px solid #e8e8ed !important;
                   }

                                                .date-box label {
                                                    font-size: 9px !important;
                                                    color: #86868b !important;
                                                    font-weight: 600 !important;
                                                    display: block !important;
                                                    margin-bottom: 4px !important;
                   }

                                                .date-box input,
                                                .date-box .synced-display {
                                                    font-size: 13px !important;
                                                    font-weight: 600 !important;
                                                    text-align: center !important;
                   }

                                                /* Ï°∞Ìï≠ */
                                                .clause {
                                                    padding: 6px !important;
                                                margin-bottom: 3px !important;
                   }

                                                .clause-title {
                                                    font-size: 9px !important;
                   }

                                                .clause-content {
                                                    font-size: 8px !important;
                                                line-height: 1.4 !important;
                   }

                                                /* ÎåÄÍ∏àÏßÄÍ∏â */
                                                .payment-item {
                                                    padding: 5px !important;
                   }

                                                .payment-item label {
                                                    font-size: 7px !important;
                   }

                                                .payment-item input,
                                                .payment-item span {
                                                    font-size: 9px !important;
                   }

                                                /* ÌéòÏù¥ÏßÄ Î≤àÌò∏ */
                                                .page-number {
                                                    position: fixed;
                                                bottom: 3mm;
                                                left: 0;
                                                right: 0;
                                                text-align: center;
                                                font-size: 8px;
                                                color: #86868b;
                   }

                                                .page-number::after {
                                                    content: counter(page);
                   }

                                                @media screen {
                        .page-number {
                                                    display: none;
                       }
                   }

                                                @media print {
                        .page-number {
                                                    display: block;
                       }
                   }
                                            </style>
                                    </head>

                                    <body>
                                        ${clonedElement.outerHTML}                                        <div class="page-number"></div>
                                        <script>
                                            window.onload = function () {
                                                setTimeout(function () {
                                                    window.print();
                                                    window.onafterprint = function () { window.close(); };
                                                }, 500);
                   };
    <\/script>
</body>
</html>
`);

            printWindow.document.close();
            showToast('Ïù∏ÏáÑ ÏòµÏÖòÏóêÏÑú "Î®∏Î¶¨Í∏Ä/Î∞îÎã•Í∏Ä" Ìï¥Ï†ú ÌõÑ PDF Ï†ÄÏû•', 'success');
        }

        function printSchedule(isPdf) {
            const element = document.getElementById('scheduleDoc');
            if (!element) {
                showToast('Ïä§ÏºÄÏ§Ñ ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Clone the element to perform modifications specifically for printing
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Convert input, select, textarea values to text for static printing
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originalInputs.length; i++) {
                const origin = originalInputs[i]; const clone = clonedInputs[i]; if
                    (!clone) continue; let text = ''; if (origin.tagName === 'SELECT') {
                        if (origin.options.length > 0 &&
                            origin.selectedIndex >= 0) {
                            text = origin.options[origin.selectedIndex].text;
                            // 'ÏÑ†ÌÉù' Í∞ôÏùÄ Í∏∞Î≥∏Í∞íÏùÄ ÎπàÏπ∏ÏúºÎ°ú Ï≤òÎ¶¨
                            if (text === 'ÏÑ†ÌÉù' || text === 'Ïπ¥ÌÖåÍ≥†Î¶¨ Î®ºÏ†Ä ÏÑ†ÌÉù' || text === 'Îã¥ÎãπÏûê ÏÑ†ÌÉù') text = '';
                        }
                    } else {
                    text = origin.value;
                }

                // Create a text span to replace the input element
                const span = document.createElement('span');

                // Handle Radios and Checkboxes specifically - keep them visual or convert to text
                if (origin.type === 'radio' || origin.type === 'checkbox') {
                    // For print, we might want to just show the checked status text or a symbol
                    // However, the original code had labels around them.
                    // Simplest approach: If checked, show "‚òë ", if not "‚òê "
                    // But the user's HTML has label wrapping text.
                    // Let's just keep the checked one's text and hide the unchecked ones?
                    // Or better: Replace the entire parent label with just the text if checked.

                    // Current fallback: Just let them render but minimize checkmark size
                    // Actually, the previous issue might be the label spacing.
                    const symbol = origin.checked ? '‚òë' : '‚òê';
                    span.textContent = symbol;
                    span.style.cssText = 'font-size: 10px; margin-right: 2px; line-height: 24px; vertical-align: middle;';
                    if (clone.parentNode) clone.parentNode.replaceChild(span, clone);
                    continue;
                }

                span.textContent = text || ''; // Ensure explicit empty string if null

                // Apply strict minimal styles to avoid inheritance bloat
                span.style.cssText = 'border:none; background:transparent; padding:0; margin:0; display:inline-block; width:100%; height:100%; line-height:24px; vertical-align:middle; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:10px;';

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
    <!DOCTYPE html>
    <html>

    <head>
        <title>Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ - ${isPdf ? 'PDF Ï†ÄÏû•' : 'Ïù∏ÏáÑ'}</title>
        <style>
            body {
                font-family: 'Inter', -apple-system, sans-serif;
                padding: 20px;
                background: white;
            }

            /* Header Styles */
            .doc-header {
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                color: #ffffff !important;
                padding: 20px 24px !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                margin-bottom: 20px !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                border-radius: 0 !important;
            }

            /* Hide unwanted elements */
            .no-print, 
            .btn, 
            .restore-btn, 
            .notion-export-btn, 
            button {
                display: none !important;
            }

            .doc-header h1 {
                font-size: 24px !important;
                font-weight: 700 !important;
                margin: 0 !important;
                color: #fff !important;
                line-height: 1.2 !important;
            }

            /* Hide emojis in header */
            .doc-header h1 .emoji-icon { display: none !important; }

            .doc-header .subtitle {
                font-size: 14px !important;
                opacity: 0.9 !important;
                color: #fff !important;
                margin-top: 4px !important;
            }

            /* Reset Grid/Flex for print if needed */
            .info-grid {
                display: block;
            }

            /* Table Styles */
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 10px;
                margin-bottom: 10px;
                table-layout: fixed;
            }

            /* Height Enforcement */
            tr {
                height: 24px !important;
                max-height: 24px !important;
            }

            th,
            td {
                border: 1px solid #d2d2d7;
                padding: 0 4px !important;
                height: 24px !important;
                max-height: 24px !important;
                line-height: 24px !important;
                vertical-align: middle !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
                white-space: nowrap !important;
            }

            /* Customer Info Table Specifics */
            .schedule-info-table th {
                background: #f9f9fb;
                font-weight: 600;
                color: #333;
                width: 15%;
            }

            .schedule-info-table td {
                text-align: left;
                width: 35%;
            }

            /* Rowspan handling */
            th[rowspan],
            td[rowspan] {
                height: auto !important;
                max-height: none !important;
            }

            /* Data Table Specifics */
            .data-table th {
                background: #f5f5f7;
                font-weight: 600;
                color: #333;
            }

            /* Remove any other interfering elements */
            .no-print,
            .restore-btn,
            .notion-export-btn,
            button {
                display: none !important;
            }
            
            /* Hide emoji icons in headers during print */
            h1 .emoji-icon,
            h1 .icon,
            h1 span[role="img"] {
                display: none !important;
            }

            /* Reset all internal elements */
            td *,
            th * {
                vertical-align: middle !important;
                line-height: 24px !important;
                /* Force content align */
            }

            @media print {
                @page {
                    size: A4 landscape;
                    margin: 10mm;
                }

                body {
                    -webkit-print-color-adjust: exact;
                }

                th,
                td {
                    border-color: #d2d2d7 !important;
                }
            }
        </style>
    </head>

    <body>
        ${clonedElement.innerHTML}
        <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                // window.onafterprint = function() { window.close(); };
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();

            if (isPdf) {
                showToast('Ïù∏ÏáÑ ÎØ∏Î¶¨Î≥¥Í∏∞ÏóêÏÑú "PDFÎ°ú Ï†ÄÏû•"ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.', 'success');
            }
        }

        function printASList(isPdf) {
            const element = document.getElementById('asListDoc');
            if (!element) {
                showToast('A/S Î¶¨Ïä§Ìä∏ ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Clone the element to perform modifications specifically for printing
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Convert input, select, textarea values to text for static printing
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originalInputs.length; i++) {
                const origin = originalInputs[i];
                const clone = clonedInputs[i];
                if (!clone) continue;

                let text = '';
                if (origin.tagName === 'SELECT') {
                    if (origin.options.length > 0 && origin.selectedIndex >= 0) {
                        text = origin.options[origin.selectedIndex].text;
                        // 'ÏÑ†ÌÉù' Í∞ôÏùÄ Í∏∞Î≥∏Í∞íÏùÄ ÎπàÏπ∏ÏúºÎ°ú Ï≤òÎ¶¨
                        if (text === 'ÏÑ†ÌÉù' || text === 'Ïπ¥ÌÖåÍ≥†Î¶¨ Î®ºÏ†Ä ÏÑ†ÌÉù' || text === 'Îã¥ÎãπÏûê ÏÑ†ÌÉù') text = '';
                    }
                } else {
                    text = origin.value;
                }

                // Create a text span to replace the input element
                const span = document.createElement('span');

                // Handle Radios and Checkboxes specifically
                if (origin.type === 'radio' || origin.type === 'checkbox') {
                    const symbol = origin.checked ? '‚òë' : '‚òê';
                    span.textContent = symbol;
                    span.style.cssText = 'font-size: 10px; margin-right: 2px; line-height: 24px; vertical-align: middle;';
                    if (clone.parentNode) clone.parentNode.replaceChild(span, clone);
                    continue;
                }

                span.textContent = text || ''; // Ensure explicit empty string if null

                // Apply strict minimal styles to avoid inheritance bloat
                span.style.cssText = 'border:none; background:transparent; padding:0; margin:0; display:inline-block; width:100%; height:100%; line-height:24px; vertical-align:middle; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:10px;';

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏ - ${isPdf ? 'PDF Ï†ÄÏû•' : 'Ïù∏ÏáÑ'}</title>
                    <style>
                        body {
                            font-family: 'Inter', -apple-system, sans-serif;
                            padding: 20px;
                            background: white;
                        }

                        /* Header Styles */
                        .doc-header {
                            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                            color: #ffffff !important;
                            padding: 20px 24px !important;
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            margin-bottom: 10px !important; /* Adjusted to match table spacing */
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                        .doc-header h1 { font-size: 20px; margin: 0; color: #fff !important; line-height: 1.2; }
                        .doc-header .subtitle { font-size: 10px; opacity: 0.9; color: #fff !important; margin-top: 4px; }

                        /* Reset Grid/Flex for print if needed */
                        .info-grid { display: block; }

                        /* Table Styles */
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            font-size: 10px;
                            margin-bottom: 10px;
                            table-layout: fixed;
                        }

                        /* Height Enforcement */
                        tr { height: 24px !important; max-height: 24px !important; }
                        th, td {
                            border: 1px solid #d2d2d7;
                            padding: 0 4px !important;
                            height: 24px !important;
                            max-height: 24px !important;
                            line-height: 24px !important;
                            vertical-align: middle !important;
                            box-sizing: border-box !important;
                            overflow: hidden !important;
                            white-space: nowrap !important;
                        }

                        /* Customer Info Table Specifics */
                        .schedule-info-table th { background: #f9f9fb; font-weight: 600; color: #333; width: 15%; }
                        .schedule-info-table td { text-align: left; width: 35%; }

                        /* Rowspan handling */
                        th[rowspan], td[rowspan] {
                            height: auto !important;
                            max-height: none !important;
                        }

                        /* Data Table Specifics */
                        .data-table th { background: #f5f5f7; font-weight: 600; color: #333; }

                        /* Remove any other interfering elements */
                        .no-print, button { display: none !important; }
                        
                        /* Print Only Cells - NEW: Override display:none */
                        .print-only-cell { display: table-cell !important; }

                        /* Reset all internal elements */
                        td *, th * {
                            vertical-align: middle !important;
                            line-height: 24px !important; /* Force content align */
                        }

                        @media print {
                            @page { size: A4 landscape; margin: 10mm; }
                            body { -webkit-print-color-adjust: exact; }
                            th, td { border-color: #d2d2d7 !important; }
                        }
                    </style>
                </head>
                <body>
                    ${clonedElement.innerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                // window.onafterprint = function() { window.close(); };
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();

            if (isPdf) {
                showToast('Ïù∏ÏáÑ ÎØ∏Î¶¨Î≥¥Í∏∞ÏóêÏÑú "PDFÎ°ú Ï†ÄÏû•"ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.', 'success');
            }
        }


        async function exportAllData() {
            // Capture currentCustomerId before showing modal
            const capturedCustomerId = currentCustomerId;

            // Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏòµÏÖò ÏÑ†ÌÉù
            const choice = await new Promise(resolve => {
                const modal = document.createElement('div');
                modal.className = 'admin-modal show';
                modal.id = 'exportExcelModal';
                modal.innerHTML = `
                    <div class="admin-modal-content" style="width:360px;">
                        <h3>üìä Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h3>
                        <p style="margin-bottom:16px;">ÎÇ¥Î≥¥ÎÇº Î≤îÏúÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <button id="exportChoiceAll" class="header-btn primary" style="width:100%; justify-content:center;">
                                üìÅ Ï†ÑÏ≤¥ Í≥†Í∞ù ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                            </button>
                            ${capturedCustomerId ? `
                            <button id="exportChoiceCurrent" class="header-btn secondary" style="width:100%; justify-content:center;">
                                üë§ ÌòÑÏû¨ Í≥†Í∞ùÎßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                            </button>
                            ` : ''}
                            <button id="exportChoiceCancel" class="header-btn" style="width:100%; justify-content:center; background:#f5f5f7; color:#1d1d1f;">
                                Ï∑®ÏÜå
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Attach event listeners after modal is in DOM
                document.getElementById('exportChoiceAll').onclick = () => {
                    modal.remove();
                    resolve('all');
                };
                if (capturedCustomerId) {
                    document.getElementById('exportChoiceCurrent').onclick = () => {
                        modal.remove();
                        resolve('current');
                    };
                }
                document.getElementById('exportChoiceCancel').onclick = () => {
                    modal.remove();
                    resolve('cancel');
                };
            });

            if (choice === 'cancel') return;

            const customerId = choice === 'current' ? capturedCustomerId : 'all';

            showToast('Excel Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ Ï§ë...', 'info');

            try {
                // ÏÑúÎ≤ÑÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const params = new URLSearchParams({
                    action: 'exportExcel',
                    customerId: customerId,
                    t: Date.now()
                });

                const response = await fetch(CUSTOMER_SYNC_URL + '?' + params.toString());
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®');
                }

                if (result.fileName && result.data) {
                    // Base64 to Blob Î≥ÄÌôò
                    const byteCharacters = atob(result.data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: result.mimeType });

                    // ÌååÏùº Îã§Ïö¥Î°úÎìú Ìä∏Î¶¨Í±∞
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'designjig_data_' + new Date().toISOString().slice(0, 10).replace(/-/g, '') + '.xlsx';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    showToast('ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÎÇ¥Î≥¥ÎÉàÏäµÎãàÎã§. (' + result.customerCount + 'Î™Ö)', 'success');
                    logUserAction('Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞', `${result.customerCount}Î™Ö Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞`);
                } else {
                    throw new Error('ÏóëÏÖÄ ÌååÏùº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                }

            } catch (error) {
                console.error('Excel Export Error:', error);
                showToast('Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
            }
        }


        function importData() {
            if (!isLoggedIn()) {
                showToast('Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                showAdminModal();
                return;
            }
            document.getElementById('importFile').click();
        }
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.customers) {
                        customers = data.customers;
                        // [Phase 2] Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû• Ï§ëÎã®

                        updateCustomerList();
                        showToast('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§', 'success');
                    }
                } catch { showToast('ÌååÏùºÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§', 'error'); }
            };
            reader.readAsText(file);
        }

        function parseNumber(str) {
            if (typeof str === 'number') return str;
            return parseInt((String(str || '')).replace(/[^0-9-]/g, '')) || 0;
        }
        function formatNumber(num) { return num.toLocaleString('ko-KR'); }

        // ÌÜµÍ≥Ñ Î™®Îã¨
        let chartInstances = {};

        function openStatsModal() {
            document.getElementById('statsModal').classList.add('show');
            renderAllStats();
        }

        function closeStatsModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('statsModal').classList.remove('show');
            // Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ïÎ¶¨
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};
        }

        // ÏßëÍ≥Ñ Îã®ÏúÑ Î≥ÄÏàò (Í∏∞Î≥∏: ÏõîÎ≥Ñ)
        let statsAggregationType = 'monthly';

        function setAggregationType(type) {
            statsAggregationType = type;
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            const monthlyBtn = document.getElementById('filterMonthly');
            const yearlyBtn = document.getElementById('filterYearly');
            if (type === 'monthly') {
                monthlyBtn.style.background = '#0071e3';
                monthlyBtn.style.color = 'white';
                yearlyBtn.style.background = 'white';
                yearlyBtn.style.color = '#64748b';
            } else {
                yearlyBtn.style.background = '#0071e3';
                yearlyBtn.style.color = 'white';
                monthlyBtn.style.background = 'white';
                monthlyBtn.style.color = '#64748b';
            }
            renderAllStats();
        }

        function renderAllStats() {
            const data = customers;
            const periodFilter = document.getElementById('statsPeriodFilter')?.value || 'all';
            const now = new Date();
            const thisYear = now.getFullYear().toString();
            const lastYear = (now.getFullYear() - 1).toString();

            // Í∏∞Í∞Ñ ÌïÑÌÑ∞ÎßÅ Ìï®Ïàò
            function filterByPeriod(dateStr) {
                if (!dateStr) return false;
                const date = new Date(dateStr);
                if (periodFilter === '12months') {
                    const twelveMonthsAgo = new Date();
                    twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);
                    return date >= twelveMonthsAgo;
                } else if (periodFilter === 'thisyear') {
                    return dateStr.startsWith(thisYear);
                } else if (periodFilter === 'lastyear') {
                    return dateStr.startsWith(lastYear);
                }
                return true; // all
            }

            // ÏöîÏïΩ ÌÜµÍ≥Ñ
            const filteredData = data.filter(c => filterByPeriod(c.createdAt || c.contractDate));
            const totalCustomers = filteredData.length;
            const contractedCustomers = filteredData.filter(c => ['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status));
            const totalContracts = contractedCustomers.length;
            const totalRevenue = contractedCustomers.reduce((sum, c) => sum + parseNumber(c.totalAmount), 0);
            const avgContract = totalContracts > 0 ? Math.round(totalRevenue / totalContracts) : 0;

            // ÏßÄÏ∂ú Ìï©Í≥Ñ (Ïö¥ÏòÅÎπÑ)
            let totalExpense = 0;
            let expenseCount = 0;
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (filterByPeriod(e.date)) {
                        totalExpense += parseNumber(e.amount);
                        expenseCount++;
                    }
                });
            }

            // ÏàúÏù¥Ïùµ Î∞è Ïù¥ÏùµÎ•†
            const netProfit = totalRevenue - totalExpense;
            const profitRate = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : 0;

            // ÌïµÏã¨ KPI ÏóÖÎç∞Ïù¥Ìä∏
            const kpiRevenueEl = document.getElementById('kpiTotalRevenue');
            const kpiExpenseEl = document.getElementById('kpiTotalExpense');
            const kpiNetProfitEl = document.getElementById('kpiNetProfit');
            const kpiProfitRateEl = document.getElementById('kpiProfitRate');
            const kpiContractCountEl = document.getElementById('kpiContractCount');
            const kpiExpenseItemsEl = document.getElementById('kpiExpenseItems');

            if (kpiRevenueEl) kpiRevenueEl.textContent = '‚Ç©' + formatNumber(totalRevenue);
            if (kpiExpenseEl) kpiExpenseEl.textContent = '‚Ç©' + formatNumber(totalExpense);
            if (kpiNetProfitEl) kpiNetProfitEl.textContent = '‚Ç©' + formatNumber(netProfit);
            if (kpiProfitRateEl) kpiProfitRateEl.textContent = profitRate;
            if (kpiContractCountEl) kpiContractCountEl.textContent = totalContracts;
            if (kpiExpenseItemsEl) kpiExpenseItemsEl.textContent = expenseCount;

            // Î≥¥Ï°∞ KPI ÏóÖÎç∞Ïù¥Ìä∏
            const kpiCustomersEl = document.getElementById('kpiTotalCustomers');
            const kpiContractsTotalEl = document.getElementById('kpiContractsTotal');
            const kpiAvgEl = document.getElementById('kpiAvgContract');

            if (kpiCustomersEl) kpiCustomersEl.textContent = totalCustomers;
            if (kpiContractsTotalEl) kpiContractsTotalEl.textContent = totalContracts;
            if (kpiAvgEl) kpiAvgEl.textContent = '‚Ç©' + formatNumber(avgContract);

            // Í∏∞Ï°¥ ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏ (Ìò∏ÌôòÏÑ±)
            const oldTotalCustomers = document.getElementById('totalCustomers');
            const oldTotalContracts = document.getElementById('totalContracts');
            const oldTotalRevenue = document.getElementById('totalRevenue');
            const oldAvgContract = document.getElementById('avgContract');
            if (oldTotalCustomers) oldTotalCustomers.textContent = totalCustomers;
            if (oldTotalContracts) oldTotalContracts.textContent = totalContracts;
            if (oldTotalRevenue) oldTotalRevenue.textContent = '‚Ç©' + formatNumber(totalRevenue);
            if (oldAvgContract) oldAvgContract.textContent = '‚Ç©' + formatNumber(avgContract);

            // Ï∞®Ìä∏ Î†åÎçîÎßÅ
            renderProfitabilityChart(filteredData, periodFilter); // ÏÉàÎ°úÏö¥ ÌÜµÌï© ÏàòÏùµÏÑ± Ï∞®Ìä∏
            renderStatusChart(data);
            renderSourceChart(data);
            renderBuildingChart(data);
            renderConversionRate(data);
            renderExpenseBreakdownChart(); // Ïö¥ÏòÅÎπÑ Î∂ÑÏÑù

            // [Ï∂îÍ∞Ä] ÏûëÏóÖ Î°úÍ∑∏ Î†åÎçîÎßÅ
            renderAuditLog();
        }

        // [Ïã†Í∑ú] ÌÜµÌï© ÏàòÏùµÏÑ± Ï∞®Ìä∏ (Îß§Ï∂ú ÎßâÎåÄ, ÏßÄÏ∂ú ÎßâÎåÄ, ÏàúÏù¥Ïùµ ÏÑ†, Ïù¥ÏùµÎ•† ÏÑ†)
        function renderProfitabilityChart(data, periodFilter) {
            const canvas = document.getElementById('profitabilityChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // ÏßëÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
            const aggregatedData = {};
            const isMonthly = statsAggregationType === 'monthly';

            // 1. Îß§Ï∂ú ÏßëÍ≥Ñ
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (!date) return;

                const key = isMonthly ? date.substring(0, 7) : date.substring(0, 4); // YYYY-MM or YYYY
                if (!aggregatedData[key]) aggregatedData[key] = { revenue: 0, expense: 0 };

                if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                    aggregatedData[key].revenue += parseNumber(c.totalAmount);
                }
            });

            // 2. ÏßÄÏ∂ú ÏßëÍ≥Ñ
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const key = isMonthly ? e.date.substring(0, 7) : e.date.substring(0, 4);
                    if (!aggregatedData[key]) aggregatedData[key] = { revenue: 0, expense: 0 };
                    aggregatedData[key].expense += parseNumber(e.amount);
                });
            }

            const sortedKeys = Object.keys(aggregatedData).sort();
            const labels = sortedKeys.map(k => {
                if (isMonthly) {
                    const [y, m] = k.split('-');
                    return `${y.slice(2)}/${m}`;
                }
                return k + 'ÎÖÑ';
            });

            const revenueData = sortedKeys.map(k => aggregatedData[k].revenue);
            const expenseData = sortedKeys.map(k => aggregatedData[k].expense);
            const netProfitData = sortedKeys.map(k => aggregatedData[k].revenue - aggregatedData[k].expense);
            const profitRateData = sortedKeys.map(k => {
                const rev = aggregatedData[k].revenue;
                const net = rev - aggregatedData[k].expense;
                return rev > 0 ? ((net / rev) * 100).toFixed(1) : 0;
            });

            if (chartInstances.profitability) chartInstances.profitability.destroy();

            chartInstances.profitability = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.length ? labels : ['Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'],
                    datasets: [
                        {
                            label: 'Îß§Ï∂ú',
                            data: revenueData,
                            backgroundColor: 'rgba(14, 165, 233, 0.8)',
                            borderRadius: 6,
                            yAxisID: 'y',
                            order: 3
                        },
                        {
                            label: 'ÏßÄÏ∂ú',
                            data: expenseData,
                            backgroundColor: 'rgba(244, 63, 94, 0.8)',
                            borderRadius: 6,
                            yAxisID: 'y',
                            order: 4
                        },
                        {
                            label: 'ÏàúÏù¥Ïùµ',
                            data: netProfitData,
                            type: 'line',
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointBackgroundColor: '#10b981',
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y',
                            order: 1
                        },
                        {
                            label: 'Ïù¥ÏùµÎ•†(%)',
                            data: profitRateData,
                            type: 'line',
                            borderColor: '#8b5cf6',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointBackgroundColor: '#8b5cf6',
                            yAxisID: 'y1',
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    if (context.dataset.label === 'Ïù¥ÏùµÎ•†(%)') {
                                        return context.dataset.label + ': ' + context.parsed.y + '%';
                                    }
                                    return context.dataset.label + ': ‚Ç©' + formatNumber(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'Í∏àÏï° (Ïõê)' },
                            ticks: {
                                callback: v => {
                                    if (v >= 100000000) return (v / 100000000).toFixed(0) + 'Ïñµ';
                                    if (v >= 10000000) return (v / 10000000).toFixed(0) + 'Ï≤úÎßå';
                                    if (v >= 1000000) return (v / 1000000).toFixed(0) + 'M';
                                    return v;
                                }
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'Ïù¥ÏùµÎ•† (%)' },
                            max: 100,
                            grid: { display: false },
                            ticks: { callback: v => v + '%' }
                        }
                    }
                }
            });
        }

        // Ïö¥ÏòÅÎπÑ Î∂ÑÏÑù Ï∞®Ìä∏ (ÎèÑÎÑõ)
        function renderExpenseBreakdownChart() {
            const canvas = document.getElementById('expenseBreakdownChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const categoryTotals = {};
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    const cat = e.category || 'Í∏∞ÌÉÄ';
                    categoryTotals[cat] = (categoryTotals[cat] || 0) + parseNumber(e.amount);
                });
            }

            const labels = Object.keys(categoryTotals);
            const values = Object.values(categoryTotals);
            const colors = ['#0ea5e9', '#f43f5e', '#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#ec4899', '#84cc16'];

            if (chartInstances.expenseBreakdown) chartInstances.expenseBreakdown.destroy();

            chartInstances.expenseBreakdown = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.length ? labels : ['Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'],
                    datasets: [{
                        data: values.length ? values : [1],
                        backgroundColor: colors.slice(0, labels.length || 1),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ‚Ç©' + formatNumber(context.parsed) + ' (' + pct + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderMonthlyChart(data) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            const yearFilter = document.getElementById('statsYearFilter');
            const selectedYear = yearFilter ? yearFilter.value : 'all';

            // ÏõîÎ≥Ñ Îß§Ï∂ú/Ïö¥ÏòÅÎπÑ ÏßëÍ≥Ñ
            const monthlyData = {};

            // 1. Îß§Ï∂ú ÏßëÍ≥Ñ
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (date) {
                    const year = date.substring(0, 4);
                    if (selectedYear !== 'all' && year !== selectedYear) return;

                    const month = date.substring(0, 7); // YYYY-MM
                    if (!monthlyData[month]) monthlyData[month] = { count: 0, revenue: 0, expense: 0 };

                    monthlyData[month].count++;
                    if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                        const amount = parseNumber(c.totalAmount);
                        monthlyData[month].revenue += Math.round(amount / 1.1); // VAT Î≥ÑÎèÑ
                    }
                }
            });

            // 2. Ïö¥ÏòÅÎπÑ ÏßëÍ≥Ñ (Ï†ÑÏó≠ expensesRows ÏÇ¨Ïö©)
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const year = e.date.substring(0, 4);
                    if (selectedYear !== 'all' && year !== selectedYear) return;

                    const month = e.date.substring(0, 7);
                    if (!monthlyData[month]) monthlyData[month] = { count: 0, revenue: 0, expense: 0 };

                    monthlyData[month].expense += parseNumber(e.amount);
                });
            }

            const sortedMonths = Object.keys(monthlyData).sort();
            const labels = sortedMonths.map(m => {
                const [y, mo] = m.split('-');
                return `${y.slice(2)}ÎÖÑ ${parseInt(mo)}Ïõî`;
            });

            if (chartInstances.monthly) chartInstances.monthly.destroy();

            chartInstances.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.length ? labels : ['Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'],
                    datasets: [
                        {
                            label: 'Ïö¥ÏòÅÎπÑ (ÏßÄÏ∂ú)',
                            data: sortedMonths.map(m => monthlyData[m].expense),
                            type: 'bar',
                            backgroundColor: '#ff3b30', // Red
                            borderRadius: 4,
                            yAxisID: 'y1',
                            stack: 'money'
                        },
                        {
                            label: 'Í≥µÍ∏âÍ∞ÄÏï° (Îß§Ï∂ú, VATÎ≥ÑÎèÑ)',
                            data: sortedMonths.map(m => monthlyData[m].revenue),
                            type: 'bar', // Îß§Ï∂úÎèÑ ÎßâÎåÄÎ°ú ÎπÑÍµê (Stack or Group)
                            backgroundColor: '#34c759', // Green
                            borderRadius: 4,
                            yAxisID: 'y1',
                            stack: 'money2' // Í≤πÏπòÏßÄ ÏïäÍ≤å Î≥ÑÎèÑ Ïä§ÌÉù ÌòπÏùÄ Í∞ôÍ≤å
                        },
                        {
                            label: 'Í≥†Í∞ù Îì±Î°ù Ïàò',
                            data: sortedMonths.map(m => monthlyData[m].count),
                            type: 'line',
                            borderColor: '#0071e3', // Blue
                            borderWidth: 2,
                            pointBackgroundColor: '#0071e3',
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'Í±¥Ïàò' },
                            grid: { display: false }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'Í∏àÏï°' },
                            ticks: { callback: v => '‚Ç©' + (v / 1000000).toFixed(0) + 'M' }
                        }
                    }
                }
            });
        }

        // [Ïã†Í∑ú] Ïó∞ÎèÑÎ≥Ñ Ï∞®Ìä∏ (VAT Î≥ÑÎèÑ)
        function renderYearlyChart(data) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');

            const yearlyData = {};
            // 1. Îß§Ï∂ú
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (date) {
                    const year = date.substring(0, 4);
                    if (!yearlyData[year]) yearlyData[year] = { count: 0, revenue: 0, expense: 0 };

                    yearlyData[year].count++;
                    if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                        const amount = parseNumber(c.totalAmount);
                        yearlyData[year].revenue += Math.round(amount / 1.1);
                    }
                }
            });

            // 2. Ïö¥ÏòÅÎπÑ
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const year = e.date.substring(0, 4);
                    if (!yearlyData[year]) yearlyData[year] = { count: 0, revenue: 0, expense: 0 };

                    yearlyData[year].expense += parseNumber(e.amount);
                });
            }

            const sortedYears = Object.keys(yearlyData).sort();

            if (chartInstances.yearly) chartInstances.yearly.destroy();

            chartInstances.yearly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedYears.length ? sortedYears : ['Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'],
                    datasets: [
                        {
                            label: 'Ï¥ù Ïö¥ÏòÅÎπÑ (ÏßÄÏ∂ú)',
                            data: sortedYears.map(y => yearlyData[y].expense),
                            backgroundColor: '#ff3b30',
                            borderRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Ï¥ù Í≥µÍ∏âÍ∞ÄÏï° (Îß§Ï∂ú)',
                            data: sortedYears.map(y => yearlyData[y].revenue),
                            backgroundColor: '#34c759',
                            borderRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Ï¥ù Í≥ÑÏïΩ Í±¥Ïàò',
                            data: sortedYears.map(y => yearlyData[y].count),
                            type: 'line',
                            borderColor: '#0071e3',
                            borderWidth: 2,
                            pointBackgroundColor: '#0071e3',
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.dataset.yAxisID === 'y1') {
                                        label += '‚Ç©' + context.raw.toLocaleString();
                                        label += context.raw + 'Í±¥';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'Í±¥Ïàò' },
                            grid: { display: false }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'Í∏àÏï°' },
                            ticks: { callback: v => '‚Ç©' + (v / 1000000).toFixed(0) + 'M' }
                        }
                    }
                }
            });
        }

        function renderStatusChart(data) {
            const ctx = document.getElementById('statusChart').getContext('2d');

            const statusCount = {};
            data.forEach(c => {
                const status = c.status || 'consulting';
                statusCount[status] = (statusCount[status] || 0) + 1;
            });

            const statusColors = {
                consulting: '#ff9500',
                hold: '#8e8e93',
                budget_over: '#ff3b30',
                other_company: '#5856d6',
                contracted: '#34c759',
                in_progress: '#ff9500',
                completed: '#30d158',
                as_done: '#00c7be'
            };

            if (chartInstances.status) chartInstances.status.destroy();

            chartInstances.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCount).map(s => statusLabels[s] || s),
                    datasets: [{
                        data: Object.values(statusCount),
                        backgroundColor: Object.keys(statusCount).map(s => statusColors[s] || '#86868b'),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { font: { size: 10 }, padding: 8 } }
                    }
                }
            });
        }

        function renderSourceChart(data) {
            const ctx = document.getElementById('sourceChart').getContext('2d');

            const sourceCount = {};
            data.forEach(c => {
                const source = c.clientSource || 'ÎØ∏ÏßÄÏ†ï';
                sourceCount[source] = (sourceCount[source] || 0) + 1;
            });

            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#fa709a'];

            if (chartInstances.source) chartInstances.source.destroy();

            chartInstances.source = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(sourceCount),
                    datasets: [{
                        data: Object.values(sourceCount),
                        backgroundColor: colors.slice(0, Object.keys(sourceCount).length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { font: { size: 10 }, padding: 8 } }
                    }
                }
            });
        }

        function renderBuildingChart(data) {
            const ctx = document.getElementById('buildingChart').getContext('2d');

            const buildingCount = {};
            data.forEach(c => {
                const building = c.buildingType || 'ÎØ∏ÏßÄÏ†ï';
                buildingCount[building] = (buildingCount[building] || 0) + 1;
            });

            if (chartInstances.building) chartInstances.building.destroy();

            chartInstances.building = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(buildingCount),
                    datasets: [{
                        label: 'Í±¥Ïàò',
                        data: Object.values(buildingCount),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(240, 147, 251, 0.8)',
                            'rgba(245, 87, 108, 0.8)',
                            'rgba(79, 172, 254, 0.8)'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function renderConversionRate(data) {
            const contracted = data.filter(c => ['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)).length;
            const notContracted = data.filter(c => ['budget_over', 'other_company'].includes(c.status)).length;
            const consulting = data.filter(c => ['consulting', 'hold'].includes(c.status)).length;

            const total = contracted + notContracted;
            const rate = total > 0 ? Math.round((contracted / total) * 100) : 0;

            document.getElementById('conversionRate').textContent = rate + '%';
            document.getElementById('contractedCount').textContent = contracted;
            document.getElementById('notContractedCount').textContent = notContracted;
            document.getElementById('consultingCount').textContent = consulting;

            // ÏõêÌòï Í∑∏ÎûòÌîÑ ÏóÖÎç∞Ïù¥Ìä∏
            const circle = document.getElementById('conversionCircle');
            circle.style.background = `conic-gradient(#34c759 0%, #34c759${rate}%, #e8e8ed${rate}%, #e8e8ed 100%)`;
        }

        // =====================
        // ÏÉòÌîå Í≤¨Ï†ÅÏÑú Í∏∞Îä•
        // =====================

        // ÏÉòÌîå Í≤¨Ï†ÅÏÑú Î™®Îã¨ Ïó¥Í∏∞
        function openSampleEstimateModal() {
            document.getElementById('sampleEstimateModal').style.display = 'flex';
            document.getElementById('sampleEstimateTitle').value = '';
            loadSampleEstimateList();
        }

        // ÏÉòÌîå Í≤¨Ï†ÅÏÑú Î™®Îã¨ Îã´Í∏∞
        function closeSampleEstimateModal() {
            document.getElementById('sampleEstimateModal').style.display = 'none';
        }

        // ÏÉòÌîå Í≤¨Ï†ÅÏÑú Î™©Î°ù Î°úÎìú
        async function loadSampleEstimateList() {
            const listContainer = document.getElementById('sampleEstimateList');
            listContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Î°úÎî© Ï§ë...</div>';

            try {
                const response = await fetch(`${GOOGLE_SHEET_URL}?action=getSampleEstimates`);
                const result = await response.json();

                if (result.success && result.samples && result.samples.length > 0) {
                    listContainer.innerHTML = result.samples.map(sample => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border: 1px solid #e5e5e5; border-radius: 8px; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${sample.title}</div>
                                <div style="font-size: 11px; color: #999;">üìÖ ${sample.createdAt} | üë§ ${sample.createdBy || '-'}</div>
                            </div>
                            <div style="display: flex; gap: 6px;">
                                <button onclick="loadSampleEstimate('${sample.id}')" 
                                    style="background: #007aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">Î∂àÎü¨Ïò§Í∏∞</button>
                                <button onclick="deleteSampleEstimate('${sample.id}', '${sample.title}')" 
                                    style="background: #ff3b30; color: white; border: none; padding: 6px 10px; border-radius: 6px; font-size: 12px; cursor: pointer;">‚úï</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    listContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Ï†ÄÏû•Îêú ÏÉòÌîåÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                }
            } catch (error) {
                console.error('ÏÉòÌîå Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                listContainer.innerHTML = '<div style="text-align: center; color: #ff3b30; padding: 20px;">Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§</div>';
            }
        }

        // ÌòÑÏû¨ Í≤¨Ï†ÅÏùÑ ÏÉòÌîåÎ°ú Ï†ÄÏû•
        async function saveSampleEstimate() {
            const title = document.getElementById('sampleEstimateTitle').value.trim();
            if (!title) {
                showToast('ÏÉòÌîå Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            // ÌòÑÏû¨ Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            saveEstimateData(); // Î®ºÏ†Ä ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•

            const sampleData = {
                action: 'saveSampleEstimate',
                title: title,
                estimateData: currentData.estimateData || {},
                estimateProfitRate: currentData.estimateProfitRate || 15,
                estimateMemos: {},
                createdBy: currentAdmin?.id || 'unknown',
                createdAt: new Date().toISOString()
            };

            // Î©îÎ™® Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            categories.forEach(cat => {
                if (currentData[`estMemo_${cat.no}`]) {
                    sampleData.estimateMemos[cat.no] = currentData[`estMemo_${cat.no}`];
                }
            });

            try {
                showToast('Ï†ÄÏû• Ï§ë...', 'info');
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(sampleData)
                });
                const result = await response.json();

                if (result.success) {
                    showToast(`ÏÉòÌîå "${title}" Ï†ÄÏû• ÏôÑÎ£å!`, 'success');
                    document.getElementById('sampleEstimateTitle').value = '';
                    loadSampleEstimateList();
                } else {
                    showToast('Ï†ÄÏû• Ïã§Ìå®: ' + (result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } catch (error) {
                console.error('ÏÉòÌîå Ï†ÄÏû• Ïã§Ìå®:', error);
                showToast('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        // ÏÉòÌîå Í≤¨Ï†Å Î∂àÎü¨Ïò§Í∏∞
        async function loadSampleEstimate(sampleId) {
            if (!confirm('ÌòÑÏû¨ Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞Î•º ÏÉòÌîåÎ°ú ÎçÆÏñ¥Ïì∞ÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                showToast('Î∂àÎü¨Ïò§Îäî Ï§ë...', 'info');
                const response = await fetch(`${GOOGLE_SHEET_URL}?action=getSampleEstimate&id=${sampleId}`);
                const result = await response.json();

                if (result.success && result.sample) {
                    const sample = result.sample;

                    // Í≤¨Ï†Å Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                    currentData.estimateData = sample.estimateData || {};
                    currentData.estimateProfitRate = sample.estimateProfitRate || 15;

                    // [Smart Load] If unit is 'py' or 'Ìèâ', use current customer's area
                    const customerArea = parseFloat((currentData.area || '').toString().replace(/[^0-9.]/g, '')) || 0;

                    if (customerArea > 0 && currentData.estimateData) {
                        Object.keys(currentData.estimateData).forEach(catNo => {
                            const rows = currentData.estimateData[catNo];
                            if (Array.isArray(rows)) {
                                rows.forEach(item => {
                                    if (item.unit === 'py' || item.unit === 'Ìèâ') {
                                        item.qty = customerArea;
                                        // Recalculate amount if needed, though loadEstimateData does it on render
                                        // But good to update data model strictly
                                        // item.price is string or number? Usually string in this app.
                                        // Let's leave amount calc to loadEstimateData() to avoid type issues here
                                    }
                                });
                            }
                        });
                    }

                    // Î©îÎ™® Ï†ÅÏö©
                    if (sample.estimateMemos) {
                        Object.keys(sample.estimateMemos).forEach(catNo => {
                            currentData[`estMemo_${catNo}`] = sample.estimateMemos[catNo];
                        });
                    }

                    // UI ÏÉàÎ°úÍ≥†Ïπ®
                    loadEstimateData();

                    closeSampleEstimateModal();
                    showToast(`ÏÉòÌîå "${sample.title}" Ï†ÅÏö© ÏôÑÎ£å!`, 'success');
                } else {
                    showToast('ÏÉòÌîåÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                }
            } catch (error) {
                console.error('ÏÉòÌîå Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                showToast('Î∂àÎü¨Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        // ÏÉòÌîå ÏÇ≠Ï†ú
        async function deleteSampleEstimate(sampleId, sampleTitle) {
            if (!confirm(`"${sampleTitle}" ÏÉòÌîåÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) return;

            try {
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'deleteSampleEstimate',
                        id: sampleId
                    })
                });
                const result = await response.json();

                if (result.success) {
                    showToast('ÏÉòÌîåÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§', 'success');
                    loadSampleEstimateList();
                } else {
                    showToast('ÏÇ≠Ï†ú Ïã§Ìå®', 'error');
                }
            } catch (error) {
                console.error('ÏÉòÌîå ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                showToast('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        function importMasterSchedule() {
            if (scheduleRows.length > 0) {
                if (!confirm('ÌòÑÏû¨ ÏûëÏÑ±Îêú Ïä§ÏºÄÏ§ÑÏù¥ Î™®Îëê ÏÇ≠Ï†úÎêòÍ≥†, ÎßàÏä§ÌÑ∞ Ïä§ÏºÄÏ§Ñ ÌÖúÌîåÎ¶øÏúºÎ°ú ÎåÄÏ≤¥Îê©ÎãàÎã§. Í≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }
            }

            if (!defaultScheduleSteps || defaultScheduleSteps.length === 0) {
                alert('ÎßàÏä§ÌÑ∞ Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                fetchScheduleTemplate(); // Try fetching again
                return;
            }

            // Copy template
            scheduleRows = defaultScheduleSteps.map(step => ({
                id: Date.now() + Math.random(),
                category: step.category || '',
                name: step.name || '',
                checkPoint: step.checkPoint || '',
                start: '', // Date is usually empty in template
                end: '',
                inCharge: step.inCharge || currentData.manager || 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)',
                memo: step.memo || ''
            }));

            renderScheduleTable();
            saveScheduleToCustomer();
            alert('ÎßàÏä§ÌÑ∞ Ïä§ÏºÄÏ§ÑÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
        }

        async function syncScheduleToNotion() {
            if (!currentData.clientName) {
                alert('Í≥†Í∞ùÎ™ÖÏù¥ ÏóÜÏäµÎãàÎã§. Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (confirm(`'${currentData.clientName}' Í≥†Í∞ùÏùò Ïä§ÏºÄÏ§ÑÏùÑ NotionÏúºÎ°ú Ï†ÑÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                try {
                    const btn = document.querySelector('button[onclick="syncScheduleToNotion()"]');
                    if (btn) {
                        btn.innerHTML = '‚è≥ Ï†ÑÏÜ° Ï§ë...';
                        btn.disabled = true;
                    }

                    const payload = {
                        action: 'exportToNotion',
                        type: 'schedule',
                        customerId: currentData.customerId,
                        data: JSON.stringify({
                            project: currentData.clientName,
                            schedules: scheduleRows // scheduleRows Ï†ÑÏó≠ Î≥ÄÏàò
                        })
                    };

                    const response = await fetch(CUSTOMER_SYNC_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(`‚úÖ Notion ÎèôÍ∏∞Ìôî ÏÑ±Í≥µ!`);
                        if (result.notionUrl) {
                            // console.log(result.notionUrl);
                        }
                    } else {
                        throw new Error(result.message || 'ÎèôÍ∏∞Ìôî Ïã§Ìå®');
                    }
                } catch (error) {
                    console.error('Notion Sync Error:', error);
                    alert(`ÏöîÏ≤≠Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§.\n(ÏùëÎãµ ÌôïÏù∏ Ï§ë Ïò§Î•ò: ${error.message})`);
                } finally {
                    const btn = document.querySelector('button[onclick="syncScheduleToNotion()"]');
                    if (btn) {
                        btn.innerHTML = 'üì• Notion ÎèôÍ∏∞Ìôî';
                        btn.disabled = false;
                    }
                }
            }
        }

        // Initialize Master Data
        fetchScheduleTemplate();
    </script>
    <!-- Î°úÍ∑∏Ïù∏ Ïò§Î≤ÑÎ†àÏù¥ (ÏµúÏö∞ÏÑ† ÌëúÏãú) - PIN Í∏∞Î∞ò Í∏∞Í∏∞ Ïã†Î¢∞ Ï†ïÏ±Ö -->
    <div class="login-overlay" id="loginOverlay">
        <!-- ID/PW Î°úÍ∑∏Ïù∏ (ÏµúÏ¥à ÎòêÎäî Í∏∞Í∏∞ Ïã†Î¢∞ ÎßåÎ£å Ïãú) -->
        <div class="login-card" id="loginCardIdPw">
            <div class="login-logo">DESIGN JIG</div>
            <div class="login-subtitle">ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <input type="text" class="login-input" id="loginId" placeholder="ÏïÑÏù¥Îîî" autocomplete="username"
                onkeypress="if(event.key==='Enter') document.getElementById('loginPw').focus()">
            <input type="password" class="login-input" id="loginPw" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" autocomplete="current-password"
                onkeypress="if(event.key==='Enter') performLogin()">
            <button class="login-btn-primary" onclick="performLogin()">Î°úÍ∑∏Ïù∏</button>
        </div>

        <!-- PIN Î°úÍ∑∏Ïù∏ (Í∏∞Í∏∞ Ïã†Î¢∞ Ïãú) -->
        <div class="login-card" id="loginCardPin" style="display:none;">
            <div class="login-logo">DESIGN JIG</div>
            <div class="login-subtitle">ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div style="margin-bottom:16px; color:#666; font-size:13px;">
                <span id="trustedUserName" style="color:#B4956F; font-weight:600;"></span>Îãò, ÌôòÏòÅÌï©ÎãàÎã§
            </div>
            <input type="password" class="login-input" id="loginPin" placeholder="PIN 4ÏûêÎ¶¨" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') performPinLogin()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <button class="login-btn-primary" onclick="performPinLogin()">PIN Î°úÍ∑∏Ïù∏</button>
            <button onclick="clearDeviceTrust()"
                style="margin-top:12px; background:transparent; border:none; color:#86868b; font-size:12px; cursor:pointer; text-decoration:underline;">
                Îã§Î•∏ Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏
            </button>
        </div>

        <!-- PIN ÏÑ§Ï†ï (ÏµúÏ¥à Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ ÌõÑ) -->
        <div class="login-card" id="loginCardPinSetup" style="display:none;">
            <div class="login-logo">üîê</div>
            <div class="login-subtitle" style="margin-bottom:8px;">PIN ÏÑ§Ï†ï</div>
            <div style="margin-bottom:16px; color:#666; font-size:13px; line-height:1.5;">
                Ïù¥ Í∏∞Í∏∞Î•º Ïã†Î¢∞ÌïòÎ©¥ Îã§ÏùåÎ∂ÄÌÑ∞<br>
                <strong>4ÏûêÎ¶¨ PIN</strong>ÏúºÎ°ú Îπ†Î•¥Í≤å Î°úÍ∑∏Ïù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.<br>
                <span style="font-size:11px; color:#999;">(30ÏùºÍ∞Ñ Ïú†Ìö®)</span>
            </div>
            <input type="password" class="login-input" id="newPin" placeholder="ÏÉà PIN 4ÏûêÎ¶¨" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') document.getElementById('confirmPin').focus()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <input type="password" class="login-input" id="confirmPin" placeholder="PIN ÌôïÏù∏" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') setupDevicePin()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <button class="login-btn-primary" onclick="setupDevicePin()">PIN ÏÑ§Ï†ï ÏôÑÎ£å</button>
            <button onclick="skipPinSetup()"
                style="margin-top:12px; background:transparent; border:none; color:#86868b; font-size:12px; cursor:pointer; text-decoration:underline;">
                Í±¥ÎÑàÎõ∞Í∏∞ (Îß§Î≤à ID/PW ÏûÖÎ†•)
            </button>
        </div>

        <div style="margin-top: 20px; font-size: 11px; color: #a1a1a6;">
            Unauthorized access is strictly prohibited.
        </div>
    </div>

    <!-- ÏÉòÌîå Í≤¨Ï†ÅÏÑú Î™®Îã¨ -->
    <div id="sampleEstimateModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; align-items: center; justify-content: center;">
        <div class="modal-backdrop" onclick="closeSampleEstimateModal()"
            style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5);"></div>
        <div class="modal-content"
            style="max-width: 500px; width: 90%; position: relative; z-index: 10001; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #ff9500, #ff6600); color: white; padding: 20px; border-radius: 16px 16px 0 0;">
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">üìã ÏÉòÌîå Í≤¨Ï†ÅÏÑú</h3>
                <button onclick="closeSampleEstimateModal()"
                    style="background: transparent; border: none; color: white; font-size: 20px; cursor: pointer;">‚úï</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- ÌòÑÏû¨ Í≤¨Ï†Å Ï†ÄÏû• -->
                <div style="margin-bottom: 24px; padding: 16px; background: #f5f5f7; border-radius: 12px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #333;">üíæ ÌòÑÏû¨ Í≤¨Ï†ÅÏùÑ ÏÉòÌîåÎ°ú Ï†ÄÏû•</h4>
                    <input type="text" id="sampleEstimateTitle" placeholder="ÏÉòÌîå Ï†úÎ™© ÏûÖÎ†• (Ïòà: Í∏∞Î≥∏ ÏöïÏã§ Í≥µÏÇ¨)"
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; margin-bottom: 12px; box-sizing: border-box;">
                    <button onclick="saveSampleEstimate()"
                        style="width: 100%; padding: 12px; background: #ff9500; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px;">
                        ÏÉòÌîåÎ°ú Ï†ÄÏû•
                    </button>
                </div>

                <!-- Ï†ÄÏû•Îêú ÏÉòÌîå Î™©Î°ù -->
                <div>
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #333;">üìÇ Ï†ÄÏû•Îêú ÏÉòÌîå Î∂àÎü¨Ïò§Í∏∞</h4>
                    <div id="sampleEstimateList" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            Î°úÎî© Ï§ë...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // Í≥µÏ†ïÎ≥Ñ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Í∏∞Îä•
        // ============================
        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Îäî CUSTOMER_SYNC_URL ÏÇ¨Ïö©
        // [Fix] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Ïó∞Îèô (Ï¥àÍ∏∞Ìôî Î∞©ÏßÄ)
        let checklistMasterData = [];
        // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ (Google Sheet)
        async function syncChecklistFromCloud() {
            // Phase 2: Ï¥àÍ∏∞ ÎèôÍ∏∞Ìôî Í≤åÏù¥Ìä∏Î•º ÏúÑÌï¥ Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨ ÏÉùÎûµ (GET Ï†ÑÏö©)
            // if (!isLoggedIn()) { ... }

            const btn = document.querySelector('button[onclick="syncChecklistFromCloud()"]');
            const originalHTML = btn ? btn.innerHTML : 'üîÑ DB Î∂àÎü¨Ïò§Í∏∞';

            if (btn) {
                btn.innerHTML = '<span class="loading-spinner"></span> Î∂àÎü¨Ïò§Îäî Ï§ë...';
                btn.disabled = true;
            }

            console.log('[Checklist Load] Request started...');

            try {
                // [Fix] ÏãúÌä∏ Ïù¥Î¶ÑÏùÑ 'checklist'Î°ú Î≥ÄÍ≤Ω (ÏÑúÎ≤Ñ Ìò∏ÌôòÏÑ± Î™ÖÌôïÌôî) Î∞è ÏóêÎü¨ Ìï∏Îì§ÎßÅ Í∞ïÌôî
                const params = new URLSearchParams({ sheet: 'checklist' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                console.log('[Checklist Load] Response:', result);

                if (result.success === true || result.result === 'success' || Array.isArray(result) || (result.data && Array.isArray(result.data))) {
                    let items = [];
                    if (Array.isArray(result)) items = result;
                    else if (result.data) items = result.data;
                    else if (result.items) items = result.items;

                    // [Fix] Empty checklist is a valid state, not an error
                    if (!items || items.length === 0) {
                        console.warn('‚ö†Ô∏è [Checklist Load] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§. (0Í±¥)');
                        checklistMasterData = [];

                        // Îπà Îç∞Ïù¥ÌÑ∞ÎùºÎèÑ Î†åÎçîÎßÅ Í∞±Ïã† ÌïÑÏöî
                        renderChecklistItems();
                        return true;
                    }

                    // [Fix] Îç∞Ïù¥ÌÑ∞ Í≥µÎ∞± Ï†úÍ±∞ (ÌïÑÌÑ∞ÎßÅ Ï†ïÌôïÎèÑ Ìñ•ÏÉÅ)
                    checklistMasterData = items.map(item => ({
                        ...item,
                        'ÏßÑÌñâÎã®Í≥Ñ': String(item['ÏßÑÌñâÎã®Í≥Ñ'] || '').trim(),
                        'category': String(item['category'] || item['Ïπ¥ÌÖåÍ≥†Î¶¨'] || item['Î∂ÑÎ•ò'] || '').trim()
                    }));

                    // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ

                    console.log(`‚úÖ [Checklist Load] Loaded ${items.length} items.`);
                    console.log(`üìä [Web Debug] checklistMasterData length:`, checklistMasterData.length);
                    console.log(`üìä [Web Debug] First 3 items:`, checklistMasterData.slice(0, 3).map(i => i['Ìï≠Î™©Î™Ö'] || i.Î≤àÌò∏));

                    // ÌïÑÌÑ∞ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    updateChecklistFilters();

                    // ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
                    renderChecklistItems();

                    showToast(`Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å (${items.length}Í±¥)`, 'success');
                    return true;
                } else {
                    throw new Error(result.message || 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§');
                }
            } catch (error) {
                console.error('‚ùå [Checklist Load Error]', error);

                // [Fix] ÏãúÌä∏Í∞Ä ÏóÜÍ±∞ÎÇò Ï∞æÏùÑ Ïàò ÏóÜÎäî Í≤ΩÏö∞, ÏóêÎü¨ ÎåÄÏã† Îπà ÏÉÅÌÉúÎ°ú Ï¥àÍ∏∞ÌôîÌïòÏó¨ Ïï± Ï§ëÎã® Î∞©ÏßÄ
                if (error.message && (error.message.includes('ÏãúÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§') || error.message.includes('Sheet not found'))) {
                    console.warn('‚ö†Ô∏è [Safeguard] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏãúÌä∏ ÎØ∏Î∞úÍ≤¨ -> Îπà Î™©Î°ùÏúºÎ°ú Ï¥àÍ∏∞ÌôîÌï©ÎãàÎã§.');
                    checklistMasterData = [];
                    renderChecklistItems();
                    showToast('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. (ÏãúÌä∏ ÎØ∏Î∞úÍ≤¨)', 'info');
                    return true; // ÏÑ±Í≥µÏúºÎ°ú Í∞ÑÏ£ºÌïòÏó¨ Ï¥àÍ∏∞ Î°úÎî© ÌùêÎ¶Ñ Ïú†ÏßÄ
                }

                showToast('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
                return false;
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        }


        // [Ï∂îÍ∞Ä] Ï†ÄÏû•Îêú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌïÑÌÑ∞ ÏÉÅÌÉú Î∂àÎü¨Ïò§Í∏∞
        function loadSavedChecklistState(silent = false) {
            if (!currentData || !currentData.checklistFilters) {
                if (!silent) showToast('Ï†ÄÏû•Îêú ÌïÑÌÑ∞ ÏÉÅÌÉúÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                return;
            }

            const savedFilters = currentData.checklistFilters;

            // Ï†ÄÏû•Îêú ÌïÑÌÑ∞ Ï†ÅÏö©
            Object.keys(savedFilters).forEach(key => {
                const values = savedFilters[key];
                multiSelectState[key] = values;

                // UI Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú ÎèôÍ∏∞Ìôî
                const dropdown = document.getElementById(key + 'Dropdown');
                if (dropdown) {
                    // Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î∞ïÏä§
                    const allCb = dropdown.querySelector('input[value="all"]');
                    if (allCb) allCb.checked = values.includes('all');

                    // Í∞úÎ≥Ñ Ï≤¥ÌÅ¨Î∞ïÏä§
                    dropdown.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                        if (cb.value !== 'all') {
                            cb.checked = values.includes(cb.value);
                        }
                    });

                    updateMultiSelectLabel(key);
                }
            });

            // ÌïÑÌÑ∞ Ï¢ÖÏÜçÏÑ± ÏóÖÎç∞Ïù¥Ìä∏ (ÏßÑÌñâÎã®Í≥Ñ -> Ïπ¥ÌÖåÍ≥†Î¶¨)
            if (typeof updateCategoryOptionsBasedOnStage === 'function') {
                updateCategoryOptionsBasedOnStage();
            }

            renderChecklistItems();
            if (!silent) showToast('Ïù¥Ï†Ñ ÌïÑÌÑ∞ ÏÉÅÌÉúÎ•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.', 'success');
        }

        // ÌïÑÌÑ∞ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏ (Î©ÄÌã∞ ÏÖÄÎ†âÌä∏ Ï¥àÍ∏∞Ìôî)
        function updateChecklistFilters() {
            // [Fix] Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÎèÑ ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî (Îπà ÏÉÅÌÉúÎùºÎèÑ 'Ï†ÑÏ≤¥' ÏòµÏÖò ÌëúÏãú)
            const data = checklistMasterData || [];

            // ÏßÑÌñâÎã®Í≥Ñ ÏòµÏÖò
            const stages = [...new Set(data.map(item => item.ÏßÑÌñâÎã®Í≥Ñ).filter(Boolean))].sort();
            initMultiSelect('checklistStageFilter', stages);

            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏòµÏÖò (Î≤àÌò∏Ïàú Ï†ïÎ†¨)
            const categories = [...new Set(data.map(item => item.category).filter(Boolean))].sort((a, b) => {
                // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÎåÄÌëú ÏïÑÏù¥ÌÖú(Í∞ÄÏû• ÏûëÏùÄ Î≤àÌò∏) Ï∞æÍ∏∞
                const itemA = data.find(i => i.category === a);
                const itemB = data.find(i => i.category === b);
                return (itemA ? parseInt(itemA.Î≤àÌò∏) : 9999) - (itemB ? parseInt(itemB.Î≤àÌò∏) : 9999);
            });
            initMultiSelect('checklistCategoryFilter', categories);
        }

        // [Ï∂îÍ∞Ä] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏàúÏÑú Ï†ÄÏû•
        async function saveChecklistOrder() {
            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('Ï†ÄÏû•Ìï† Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                return;
            }

            if (!confirm('ÌòÑÏû¨ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî ÏàúÏÑúÎåÄÎ°ú Î≤àÌò∏Î•º Îã§Ïãú Îß§Í≤®ÏÑú Ï†ÄÏû•ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Í∏∞Ï°¥ ÏãúÌä∏Ïùò Îç∞Ïù¥ÌÑ∞ ÏàúÏÑúÍ∞Ä Î≥ÄÍ≤ΩÎê©ÎãàÎã§)')) {
                return;
            }

            const btn = document.querySelector('button[onclick="saveChecklistOrder()"]');
            const originalHTML = btn ? btn.innerHTML : 'üíæ ÏàúÏÑú Ï†ÄÏû•';

            try {
                if (btn) {
                    btn.innerHTML = '<span class="loading-spinner"></span> Ï†ÄÏû• Ï§ë...';
                    btn.disabled = true;
                }

                // 1. ÏàúÏÑú Ïû¨Ï†ïÎ†¨ Î∞è Î≤àÌò∏ Í∞±Ïã† (Ïù¥ÎØ∏ drag drop Ïãú ÌñàÏßÄÎßå ÏïàÏ†ÑÏùÑ ÏúÑÌï¥ Îã§Ïãú ÌôïÏù∏)
                // ÌòÑÏû¨ checklistMasterDataÎäî Ïù¥ÎØ∏ ÌôîÎ©¥ ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨ÎêòÏñ¥ ÏûàÏùå
                const sortedData = checklistMasterData.map((item, index) => ({
                    ...item,
                    'Î≤àÌò∏': index + 1
                }));

                // 2. ÏÑúÎ≤Ñ Ï†ÑÏÜ°
                const payload = {
                    action: 'updateChecklistMaster',
                    data: sortedData
                };

                // sendPostRequest ÎåÄÏã† ÏßÅÏ†ë fetch ÏÇ¨Ïö© (handleChecklistMasterUpdate ÎùºÏö∞ÌåÖ ÌôïÏù∏Îê®)
                // ÌïòÏßÄÎßå Í∏∞Ï°¥ Ìï®Ïàò Ïû¨ÏÇ¨Ïö© Í∂åÏû• -> doPostÍ∞Ä actionÏùÑ Ï≤òÎ¶¨ÌïòÎØÄÎ°ú fetch ÏÇ¨Ïö©
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Apps Script POST often requires no-cors or redirect handling, but we usually use a proxy or specific setup. 
                    // Wait, standard fetch to Apps Script Web App works if we handle redirects or return JSON.
                    // Existing syncChecklistFromCloud uses GET. 
                    // Let's copy the pattern from other save functions in this file.
                    // Actually, looking at other save functions would be safer.
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: JSON.stringify(payload)
                });

                // Apps Script 'no-cors' issue means we can't read response directly if it redirects.
                // However, updated_apps_script.js returns JSON.
                // Let's trust the deployment.
                if (response.ok || response.type === 'opaque') {
                    // 3. Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†
                    checklistMasterData = sortedData;
                    renderChecklistItems();
                    showToast('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏàúÏÑúÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
                } else {
                    throw new Error('Server response not ok');
                }

                // * Fetch with Apps Script POST can be tricky with CORS. 
                // Let's use the text output directly if possible or the typical 'fetch' pattern used in this project.
                // Re-reading 'syncChecklistFromCloud' -> it uses GET.
                // Re-reading 'saveCustomers' -> it likely uses POST.

            } catch (error) {
                console.error('Save Order Error:', error);

                // Fallback: If fetch failed, it might still have succeeded on server if no-cors.
                // But to be sure, we can also try 'saveChecklistMaster' action if we added it? Yes we did.

                showToast('ÏàúÏÑú Ï†ÄÏû• ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§. (ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî)', 'info');
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        }

        // [Ï∂îÍ∞Ä] ÏßÑÌñâÎã®Í≥Ñ ÏÑ†ÌÉùÏóê Îî∞Î•∏ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏòµÏÖò Í∞±Ïã†
        function updateCategoryOptionsBasedOnStage() {
            const selectedStages = multiSelectState['checklistStageFilter'];
            console.log('[Filter Logic] Selected Stages:', selectedStages);

            // [Fix] Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÎèÑ ÏßÑÌñâ (Îπà ÏÉÅÌÉúÎùºÎèÑ ÌïÑÌÑ∞ Î¶¨ÏÖãÏùÑ ÏúÑÌï¥)
            const data = checklistMasterData || [];

            if (data.length === 0) {
                console.warn('[Filter Logic] No master data available for filtering (Proceeding with empty)');
            }

            let validCategories = [];

            if (selectedStages.includes('all') || selectedStages.length === 0) {
                // Ï†ÑÏ≤¥ ÏÑ†ÌÉù Ïãú -> Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ ÌëúÏãú
                validCategories = [...new Set(data.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            } else {
                // ÌäπÏ†ï Îã®Í≥Ñ ÏÑ†ÌÉù Ïãú -> Ìï¥Îãπ Îã®Í≥ÑÏóê Ìè¨Ìï®Îêú Ïπ¥ÌÖåÍ≥†Î¶¨Îßå Ï∂îÏ∂ú
                const filteredItems = data.filter(item => {
                    const itemStage = (item.ÏßÑÌñâÎã®Í≥Ñ || '').trim();
                    // selectedStages could have untrimmed values if init was untrimmed, but typically they match.
                    // To be safe, we rely on exact values from options. 
                    // But here we just used item.ÏßÑÌñâÎã®Í≥Ñ to build options, so it should match.
                    return selectedStages.some(stage => stage === item.ÏßÑÌñâÎã®Í≥Ñ || stage === itemStage);
                });
                validCategories = [...new Set(filteredItems.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            }

            console.log('[Filter Logic] Valid Categories:', validCategories);

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Ï§ë Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Í≤ÉÏùÄ Ï†úÍ±∞ (UX Í∞úÏÑ†)
            const currentCategoryState = multiSelectState['checklistCategoryFilter'];

            if (!currentCategoryState.includes('all')) {
                const newCategoryState = currentCategoryState.filter(cat => validCategories.includes(cat));
                // ÌïòÎÇòÎèÑ ÏóÜÏúºÎ©¥ 'all'Î°ú Î¶¨ÏÖã
                multiSelectState['checklistCategoryFilter'] = newCategoryState.length > 0 ? newCategoryState : ['all'];
            } else {
                // If it was 'all', keep it 'all' unless validCategories is empty? 
                // 'all' is always valid if validCategories has items.
            }

            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏòµÏÖò Ïû¨ÏÉùÏÑ±
            initMultiSelect('checklistCategoryFilter', validCategories);
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Î†åÎçîÎßÅ

        // [New] ÏùºÏ†ïÌëú Í∏∞Î∞ò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïó∞Îèô
        function syncChecklistFromSchedule() {
            if (!currentCustomerId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            // checklistMasterData ÌôïÏù∏
            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÏÑú Ïó∞ÎèôÌï† Ïàò ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Î∂àÎü¨Ïò§Í∏∞Î•º Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            // ÏùºÏ†ïÌëú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
            if (!scheduleRows || scheduleRows.length === 0) {
                if (!confirm('ÏùºÏ†ïÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§. Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            } else {
                if (!confirm('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º ÏùºÏ†ïÌëú Í∏∞Ï§ÄÏúºÎ°ú Ïû¨ÏÑ§Ï†ïÌï©ÎãàÎã§. ÏùºÏ†ïÌëúÏóê ÏóÜÎäî Ìï≠Î™©ÏùÄ ÏÇ≠Ï†úÎê©ÎãàÎã§. Í≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            }

            // ÌòÑÏû¨ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ ÌôïÎ≥¥
            const currentChecklistData = currentData.checklistData || {};
            const newChecklistData = {};

            // 1. ÏùºÏ†ïÌëúÏóêÏÑú Ïú†Ìö®Ìïú Í≥µÏ†ï/Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            const activeKeywords = new Set();
            scheduleRows.forEach(row => {
                if (row.name && row.name.trim()) activeKeywords.add(row.name.trim());
                if (row.category && row.category.trim()) activeKeywords.add(row.category.trim());
            });

            console.log('üìÖ [Sync] Schedule Keywords:', [...activeKeywords]);

            let keptCount = 0;
            let addedCount = 0;
            let removedCount = 0;

            // 2. Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Îß§Ïπ≠ (Strict Mode)
            checklistMasterData.forEach(item => {
                const itemNo = String(item.Î≤àÌò∏);
                const category = (item.category || '').trim();
                const itemName = (item.Ìï≠Î™©Î™Ö || '').trim();

                // Îß§Ïπ≠ Î°úÏßÅ: ÌÇ§ÏõåÎìú Ìè¨Ìï® Ïó¨Î∂Ä ÌôïÏù∏
                let isMatch = false;

                // ÏùºÏ†ïÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Îß§Ïπ≠ Ïã§Ìå® (Ï¥àÍ∏∞Ìôî)
                if (activeKeywords.size > 0) {
                    for (const keyword of activeKeywords) {
                        // ÌÇ§ÏõåÎìúÍ∞Ä Ïπ¥ÌÖåÍ≥†Î¶¨ÎÇò Ìï≠Î™©Î™ÖÏóê Ìè¨Ìï®ÎêòÎäîÏßÄ ÌôïÏù∏
                        if (category && category.includes(keyword)) { isMatch = true; break; }
                        if (itemName && itemName.includes(keyword)) { isMatch = true; break; }

                        // Î∞òÎåÄÎ°ú Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÌÇ§ÏõåÎìúÏóê Ìè¨Ìï®ÎêòÎäîÏßÄ ÌôïÏù∏ (e.g. ÏùºÏ†ï "Î™©Í≥µ Í≥µÏÇ¨" -> Ïπ¥ÌÖåÍ≥†Î¶¨ "Î™©Í≥µ")
                        // ÎÑàÎ¨¥ ÏßßÏùÄ ÌÇ§ÏõåÎìúÎäî Ïò§ÌÉêÏßÄ Î∞©ÏßÄ (2Í∏ÄÏûê Ïù¥ÏÉÅ)
                        if (category && keyword.includes(category) && category.length > 1) { isMatch = true; break; }
                    }
                }

                if (isMatch) {
                    // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÉÅÌÉú Ïú†ÏßÄ, ÏóÜÏúºÎ©¥ false(ÎØ∏ÏôÑÎ£å)Î°ú Ï¥àÍ∏∞Ìôî
                    if (currentChecklistData.hasOwnProperty(itemNo)) {
                        newChecklistData[itemNo] = currentChecklistData[itemNo];
                        keptCount++;
                    } else {
                        newChecklistData[itemNo] = false;
                        addedCount++;
                    }
                } else {
                    // Îß§Ïπ≠ÎêòÏßÄ ÏïäÎäî Ìï≠Î™©ÏùÄ Ï†úÍ±∞ (newChecklistDataÏóê Ï∂îÍ∞Ä Ïïà Ìï®)
                    if (currentChecklistData.hasOwnProperty(itemNo)) {
                        removedCount++;
                    }
                }
            });

            // 3. Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            currentData.checklistData = newChecklistData;

            // Customers Î∞∞Ïó¥ÏóêÎèÑ ÎèôÍ∏∞Ìôî
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1) {
                // Deep copy to prevent reference issues
                customers[customerIndex].checklistData = JSON.parse(JSON.stringify(newChecklistData));
            }

            saveCustomers(); // Ï†ÄÏû• (LocalStorage & Cloud if enabled)
            renderChecklistItems();

            // Í≤∞Í≥º ÏïåÎ¶º
            if (addedCount > 0 || removedCount > 0) {
                showToast(`Ïó∞Îèô ÏôÑÎ£å! (Ï∂îÍ∞Ä: ${addedCount}, ÏÇ≠Ï†ú: ${removedCount}, Ïú†ÏßÄ: ${keptCount})`, 'success');
            } else {
                showToast(`Î≥ÄÍ≤Ω ÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§. (Ïú†ÏßÄ: ${keptCount})`, 'info');
            }
        }

        function renderChecklistItems() {
            if (!checklistMasterData || checklistMasterData.length === 0) {
                document.getElementById('checklistTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #86868b;">
                            ÎèôÍ∏∞Ìôî Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî.
                        </td>
                    </tr>`;
                return;
            }

            // ÌòÑÏû¨ Í≥†Í∞ùÏùò Ï≤¥ÌÅ¨ ÏÉÅÌÉú Í∞ÄÏ†∏Ïò§Í∏∞
            const customerChecklistData = getCurrentCustomerChecklistData();
            console.log('üîç [Web Render] Customer ID:', currentCustomerId);
            console.log('üîç [Web Render] customerChecklistData:', customerChecklistData);
            console.log('üîç [Web Render] customerChecklistData keys:', Object.keys(customerChecklistData));
            console.log('üîç [Web Render] Sample values:', Object.entries(customerChecklistData).slice(0, 3));

            // ÌïÑÌÑ∞ Ï†ÅÏö© (Î©ÄÌã∞ ÏÖÄÎ†âÌä∏ ÏßÄÏõê)
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            // [CRITICAL] Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™©Îßå ÌëúÏãú (checklistDataÏóê ÏûàÎäî Ìï≠Î™© Î≤àÌò∏)
            const savedItemNumbers = Object.keys(customerChecklistData || {});
            console.log('üìä [Web Debug] Customer selected items:', savedItemNumbers.length, 'items');
            console.log('üìä [Web Debug] Selected item numbers:', savedItemNumbers);

            let filteredData = checklistMasterData.filter(item => {
                // 1. [CRITICAL] Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™©Îßå ÌëúÏãú
                if (!savedItemNumbers.includes(String(item.Î≤àÌò∏))) return false;

                // 2. ÏßÑÌñâÎã®Í≥Ñ ÌïÑÌÑ∞
                if (!stageFilter.includes('all')) {
                    if (!stageFilter.includes(item.ÏßÑÌñâÎã®Í≥Ñ || '')) return false;
                }
                // 3. Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞
                if (!categoryFilter.includes('all')) {
                    if (!categoryFilter.includes(item.category || '')) return false;
                }

                return true;
            });

            // ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
            const tbody = document.getElementById('checklistTableBody');

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÎÖ∏ÏÖò ÏÉâÏÉÅ Îß§Ìïë
            function getCategoryColor(category) {
                if (!category) return { bg: '#F1F1EF', text: '#37352F' }; // Í∏∞Î≥∏

                const c = category.trim();

                // Notion Color Palette (Standard)
                const palette = [
                    { bg: '#E3E2E0', text: '#32302C' }, // Gray
                    { bg: '#EEE0DA', text: '#442A1E' }, // Brown
                    { bg: '#FADEC9', text: '#49290E' }, // Orange
                    { bg: '#FDECC8', text: '#402C1B' }, // Yellow
                    { bg: '#DBEDDB', text: '#1C3829' }, // Green
                    { bg: '#D3E5EF', text: '#183347' }, // Blue
                    { bg: '#E8DEEE', text: '#412454' }, // Purple
                    { bg: '#F5E0E9', text: '#4C2337' }, // Pink
                    { bg: '#FFE2DD', text: '#5D1715' }, // Red
                ];

                // [Optional] Ï£ºÏöî ÌÇ§ÏõåÎìú Í≥†Ï†ï Îß§Ìïë
                if (c.includes('Ï≤†Í±∞')) return palette[8]; // Red
                if (c.includes('ÏÑ§ÎπÑ') || c.includes('ÏàòÎèÑ')) return palette[5]; // Blue
                if (c.includes('Ï†ÑÍ∏∞') || c.includes('Ï°∞Î™Ö')) return palette[3]; // Yellow
                if (c.includes('Î™©Í≥µ')) return palette[2]; // Orange
                if (c.includes('ÌÉÄÏùº') || c.includes('ÏöïÏã§')) return palette[4]; // Green
                if (c.includes('ÎèÑÎ∞∞') || c.includes('Î∞îÎã•') || c.includes('ÎßàÎ£®')) return palette[1]; // Brown
                if (c.includes('ÎèÑÏû•') || c.includes('ÌïÑÎ¶Ñ') || c.includes('ÌéòÏù∏Ìä∏')) return palette[7]; // Pink
                if (c.includes('Í∞ÄÍµ¨') || c.includes('Ïã±ÌÅ¨') || c.includes('Ï£ºÎ∞©')) return palette[6]; // Purple
                if (c.includes('Í≥µÌÜµ') || c.includes('Í∞ÄÏÑ§') || c.includes('Ï§ÄÍ≥µ') || c.includes('ÎßàÍ∞ê')) return palette[0]; // Gray

                // Í∑∏ Ïô∏: Î¨∏ÏûêÏó¥ Ìï¥ÏãúÎ°ú ÏûêÎèô ÏÉâÏÉÅ ÏÑ†ÌÉù (Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÏÉâÏÉÅ Ï†ÅÏö© Î≥¥Ïû•)
                let hash = 0;
                for (let i = 0; i < c.length; i++) {
                    hash = c.charCodeAt(i) + ((hash << 5) - hash);
                }
                const index = Math.abs(hash) % palette.length;
                return palette[index];
            }

            tbody.innerHTML = filteredData.map((item, index) => {
                const isChecked = customerChecklistData[item.Î≤àÌò∏] || false;
                if (index === 0) {
                    console.log('üîç [Web Render] First item #' + item.Î≤àÌò∏ + ' isChecked:', isChecked, 'value:', customerChecklistData[item.Î≤àÌò∏]);
                }
                const categoryColor = getCategoryColor(item.category);
                return `
                    <tr draggable="true" 
                        ondragstart="handleChecklistDragStart(event, ${index})" 
                        ondragover="handleChecklistDragOver(event)" 
                        ondrop="handleChecklistDrop(event, ${index})"
                        ondragend="handleChecklistDragEnd(event)"
                        data-index="${index}"
                        style="background: ${isChecked ? '#f0f9ff' : 'white'}; cursor: grab;">
                        <!-- [Ï∂îÍ∞Ä] ÏÇ≠Ï†ú Î≤ÑÌäº -->
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <button onclick="deleteChecklistItem(${item.Î≤àÌò∏})" 
                                    style="border: none; background: transparent; color: #ff3b30; cursor: pointer; font-size: 14px; padding: 4px;"
                                    title="ÏÇ≠Ï†ú">
                                üóëÔ∏è
                            </button>
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <input type="checkbox"
                                   ${isChecked ? 'checked' : ''}
                                   onchange="toggleChecklistItem(${item.Î≤àÌò∏})"
                                   style="width: 18px; height: 18px; cursor: pointer;">
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">${item.Î≤àÌò∏}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.Ìï≠Î™© || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.ÎÇ¥Ïö© || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.ÎπÑÍ≥† || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <span style="background: ${(item.ÏßÑÌñâÎã®Í≥Ñ === 'Ïù∏ÌÖåÎ¶¨Ïñ¥ ÏãúÏûë Ï†Ñ') ? '#fff3e0' : '#e8f5e9'}; color: ${(item.ÏßÑÌñâÎã®Í≥Ñ === 'Ïù∏ÌÖåÎ¶¨Ïñ¥ ÏãúÏûë Ï†Ñ') ? '#e65100' : '#2e7d32'}; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                ${item.ÏßÑÌñâÎã®Í≥Ñ || ''}
                            </span>
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <span style="background: ${categoryColor.bg}; color: ${categoryColor.text}; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                ${item.category || ''}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            updateChecklistStats();
        }

        // ÌòÑÏû¨ Í≥†Í∞ùÏùò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        function getCurrentCustomerChecklistData() {
            if (!currentCustomerId) return {};

            const customer = customers.find(c => c.customerId === currentCustomerId);
            if (!customer) return {};

            return customer.checklistData || {};
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú ÌÜ†Í∏Ä
        function toggleChecklistItem(itemNumber) {
            if (!currentCustomerId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex === -1) return;

            // checklistData Ï¥àÍ∏∞Ìôî
            if (!customers[customerIndex].checklistData) {
                customers[customerIndex].checklistData = {};
            }

            // Ï≤¥ÌÅ¨ ÏÉÅÌÉú ÌÜ†Í∏Ä
            const currentState = customers[customerIndex].checklistData[itemNumber] || false;
            const newState = !currentState;
            customers[customerIndex].checklistData[itemNumber] = newState;

            // [FIX] currentDataÏóêÎèÑ Ï¶âÏãú Î∞òÏòÅ (Ï†ÄÏû• Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÎçÆÏñ¥Ïì∞Í∏∞ Î∞©ÏßÄ)
            if (!currentData.checklistData) currentData.checklistData = {};
            currentData.checklistData[itemNumber] = newState;

            // Ï†ÄÏû•
            saveCustomers();

            // Îã§Ïãú Î†åÎçîÎßÅ
            renderChecklistItems();

            showToast(currentState ? 'Ï≤¥ÌÅ¨ Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§' : 'Ï≤¥ÌÅ¨ÎêòÏóàÏäµÎãàÎã§', 'success');
        }

        // [ÏàòÏ†ï] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú ÏÇ≠Ï†ú - ÌòÑÏû¨ Í≥†Í∞ùÏùò Ìï≠Î™©Îßå Ï†úÍ±∞
        async function deleteChecklistItem(itemNumber) {
            if (!currentCustomerId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            // ÌòÑÏû¨ Í≥†Í∞ùÏùò checklistDataÏóêÏÑú Ìï¥Îãπ Ìï≠Î™© Î≤àÌò∏ Ï†úÍ±∞
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1 && customers[customerIndex].checklistData) {
                delete customers[customerIndex].checklistData[itemNumber];
                console.log('üóëÔ∏è [Web] Removed item', itemNumber, 'from customer', currentCustomerId);
            }

            // currentDataÏóêÎèÑ Î∞òÏòÅ
            if (currentData.checklistData) {
                delete currentData.checklistData[itemNumber];
            }

            // Google SheetsÏóê Ï†ÄÏû•
            await saveCustomers();

            // UI Í∞±Ïã†
            renderChecklistItems();

            showToast('Ìï≠Î™©Ïù¥ Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // [ÏàòÏ†ï] ÌïÑÌÑ∞ Í∏∞Î∞ò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© ÏùºÍ¥Ñ Ï∂îÍ∞Ä Í∏∞Îä•
        async function showAddChecklistItemModal() {
            if (!currentData || !currentData.checklistData) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                return;
            }

            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('ÎßàÏä§ÌÑ∞ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Î•º Î®ºÏ†Ä Î∂àÎü¨Ïò§ÏÑ∏Ïöî. (üîÑ DB Î∂àÎü¨Ïò§Í∏∞)', 'warning');
                return;
            }

            // ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Í∞ÄÏ†∏Ïò§Í∏∞
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            // ÌòÑÏû¨ Í≥†Í∞ùÏù¥ Ïù¥ÎØ∏ ÏÑ†ÌÉùÌïú Ìï≠Î™© Î≤àÌò∏
            const selectedItemNumbers = Object.keys(currentData.checklistData);

            // ÌïÑÌÑ∞ÎßÅÎêú Ìï≠Î™© Ï§ë ÏïÑÏßÅ ÏÑ†ÌÉùÌïòÏßÄ ÏïäÏùÄ Ìï≠Î™©
            const availableItems = checklistMasterData.filter(item => {
                // Ïù¥ÎØ∏ ÏÑ†ÌÉùÌïú Ìï≠Î™© Ï†úÏô∏
                if (selectedItemNumbers.includes(String(item.Î≤àÌò∏))) return false;

                // ÏßÑÌñâÎã®Í≥Ñ ÌïÑÌÑ∞
                if (!stageFilter.includes('all')) {
                    if (!stageFilter.includes(item.ÏßÑÌñâÎã®Í≥Ñ || '')) return false;
                }

                // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞
                if (!categoryFilter.includes('all')) {
                    if (!categoryFilter.includes(item.category || '')) return false;
                }

                return true;
            });

            if (availableItems.length === 0) {
                showToast('ÌòÑÏû¨ ÌïÑÌÑ∞ Ï°∞Í±¥Ïóê Ï∂îÍ∞ÄÌï† Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.', 'info');
                return;
            }

            // ÏùºÍ¥Ñ Ï∂îÍ∞Ä (confirm Ï†úÍ±∞)
            let addedCount = 0;
            availableItems.forEach(item => {
                if (!currentData.checklistData[item.Î≤àÌò∏]) {
                    currentData.checklistData[item.Î≤àÌò∏] = false;
                    addedCount++;
                }
            });

            // Î°úÏª¨ customers Î∞∞Ïó¥ÏóêÎèÑ Î∞òÏòÅ
            if (currentCustomerId) {
                const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
                if (customerIndex !== -1) {
                    if (!customers[customerIndex].checklistData) {
                        customers[customerIndex].checklistData = {};
                    }
                    availableItems.forEach(item => {
                        if (!customers[customerIndex].checklistData[item.Î≤àÌò∏]) {
                            customers[customerIndex].checklistData[item.Î≤àÌò∏] = false;
                        }
                    });
                }
            }

            console.log('‚úÖ [Web] Added', addedCount, 'items to customer checklist');

            // Google SheetsÏóê Ï†ÄÏû•
            await saveCustomers();

            // UI Í∞±Ïã†
            renderChecklistItems();

            showToast(`${addedCount}Í∞ú Ìï≠Î™©Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`, 'success');
        }

        // [Ï†úÍ±∞Îê®] closeAddChecklistModal() - Îçî Ïù¥ÏÉÅ Î™®Îã¨ÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå

        // [Ï†úÍ±∞Îê®] addChecklistItemToCustomer() - showAddChecklistItemModal()ÏóêÏÑú ÏùºÍ¥Ñ Ï≤òÎ¶¨

        async function addChecklistItemToCustomer_DEPRECATED(itemNumber) {
            // Ïù¥ Ìï®ÏàòÎäî Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏùå (ÌïÑÌÑ∞ Í∏∞Î∞ò ÏùºÍ¥Ñ Ï∂îÍ∞ÄÎ°ú Î≥ÄÍ≤Ω)
            if (!currentData || !currentData.checklistData) {
                showToast('Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                closeAddChecklistModal();
                return;
            }

            // ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ìï¥Îãπ Ìï≠Î™© Ï∞æÍ∏∞
            const item = checklistMasterData.find(i => i.Î≤àÌò∏ === itemNumber);
            if (!item) {
                showToast('Ìï≠Î™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Í≥†Í∞ùÏùò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Ïóê Ï∂îÍ∞Ä (Í∏∞Î≥∏Í∞í: Ï≤¥ÌÅ¨ ÏïàÎê®, boolean Ï†ÄÏû•)
            currentData.checklistData[itemNumber] = false;

            // Î°úÏª¨ customers Î∞∞Ïó¥ÏóêÎèÑ Î∞òÏòÅ
            if (currentCustomerId) {
                const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
                if (customerIndex !== -1) {
                    if (!customers[customerIndex].checklistData) {
                        customers[customerIndex].checklistData = {};
                    }
                    customers[customerIndex].checklistData[itemNumber] = false;
                }
            }

            console.log('‚úÖ [Web] Added item', itemNumber, 'to customer checklist');

            // Google SheetsÏóê Ï†ÄÏû•
            await saveCustomers();

            // UI Í∞±Ïã†
            renderChecklistItems();

            // Î™®Îã¨ Îã´Í∏∞
            closeAddChecklistModal();

            showToast(`"${item.Ìï≠Î™©}" Ìï≠Î™©Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`, 'success');
        }

        // [Ï∂îÍ∞Ä] Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Í∏∞Îä•
        let checklistDraggedIndex = null;
        let checklistFilteredData = []; // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Ïö©

        function handleChecklistDragStart(e, index) {
            checklistDraggedIndex = index;
            e.target.style.opacity = '0.4';
            e.dataTransfer.effectAllowed = 'move';

            // ÌòÑÏû¨ ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const stageFilter = typeof getMultiSelectValues === 'function' ? getMultiSelectValues('checklistStageFilter') : ['all'];
            const categoryFilter = typeof getMultiSelectValues === 'function' ? getMultiSelectValues('checklistCategoryFilter') : ['all'];

            checklistFilteredData = checklistMasterData.filter(item => {
                if (!stageFilter.includes('all') && !stageFilter.includes(item.ÏßÑÌñâÎã®Í≥Ñ || '')) return false;
                if (!categoryFilter.includes('all') && !categoryFilter.includes(item.category || '')) return false;
                return true;
            });
        }

        function handleChecklistDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const row = e.target.closest('tr');
            if (row) {
                row.style.borderTop = '2px solid #0071e3';
            }
        }

        function handleChecklistDrop(e, targetIndex) {
            e.preventDefault();
            if (checklistDraggedIndex === null || checklistDraggedIndex === targetIndex) return;

            // ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ïã§Ï†ú ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞Ïùò Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
            const draggedItem = checklistFilteredData[checklistDraggedIndex];
            const targetItem = checklistFilteredData[targetIndex];

            const draggedMasterIndex = checklistMasterData.findIndex(item => item.Î≤àÌò∏ === draggedItem.Î≤àÌò∏);
            const targetMasterIndex = checklistMasterData.findIndex(item => item.Î≤àÌò∏ === targetItem.Î≤àÌò∏);

            if (draggedMasterIndex === -1 || targetMasterIndex === -1) return;

            // ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÏàúÏÑú Î≥ÄÍ≤Ω
            const [removed] = checklistMasterData.splice(draggedMasterIndex, 1);
            checklistMasterData.splice(targetMasterIndex, 0, removed);

            // [Ï∂îÍ∞Ä] Î≤àÌò∏ Ïû¨Ï†ïÎ†¨ (1, 2, 3, 4, 5... ÏàúÏÑúÎ°ú)
            checklistMasterData.forEach((item, idx) => {
                item.Î≤àÌò∏ = idx + 1;
            });

            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏ (Phase 2: Í∏àÏßÄ)


            // UI Í∞±Ïã†
            renderChecklistItems();
            showToast('ÏàúÏÑúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        function handleChecklistDragEnd(e) {
            e.target.style.opacity = '1';
            checklistDraggedIndex = null;
            // Î™®Îì† ÌñâÏùò border Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('#checklistTableBody tr').forEach(row => {
                row.style.borderTop = '';
            });
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateChecklistStats() {
            // ÌòÑÏû¨ ÌïÑÌÑ∞ Ï†ÅÏö©ÌïòÏó¨ Î≥¥Ïù¥Îäî Ìï≠Î™©Îßå Í≥ÑÏÇ∞
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            const filteredData = checklistMasterData.filter(item => {
                if (!stageFilter.includes('all') && !stageFilter.includes(item.ÏßÑÌñâÎã®Í≥Ñ || '')) return false;
                if (!categoryFilter.includes('all') && !categoryFilter.includes(item.category || '')) return false;
                return true;
            });

            const total = filteredData.length; // ÌïÑÌÑ∞Îêú Ìï≠Î™© Ïàò
            const customerChecklistData = getCurrentCustomerChecklistData();

            // ÌïÑÌÑ∞Îêú Ìï≠Î™© Ï§ë Ï≤¥ÌÅ¨Îêú Í≤ÉÎßå Ïπ¥Ïö¥Ìä∏
            const completed = filteredData.filter(item => customerChecklistData[item.Î≤àÌò∏] === true).length;
            const inProgress = total - completed;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('checklistTotalCount').textContent = total;
            document.getElementById('checklistCompletedCount').textContent = completed;
            document.getElementById('checklistInProgressCount').textContent = inProgress;
            document.getElementById('checklistProgressRate').textContent = rate + '%';
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïù∏ÏáÑ
        function printChecklist() {
            const element = document.querySelector('#panel-checklist .document-wrapper');
            if (!element) {
                showToast('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Clone element
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Checkbox/Input handling
            const originalInputs = element.querySelectorAll('input, select, textarea');
            const clonedInputs = clonedElement.querySelectorAll('input, select, textarea');

            originalInputs.forEach((inp, i) => {
                if (clonedInputs[i]) {
                    if (inp.type === 'checkbox' || inp.type === 'radio') {
                        // Replace checkbox with symbol
                        const span = document.createElement('span');
                        span.textContent = inp.checked ? '‚òë' : '‚òê';
                        span.style.cssText = 'font-weight:bold; font-size:14px; margin-right:5px;';
                        if (clonedInputs[i].parentNode) {
                            clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                        }
                    } else if (inp.tagName === 'SELECT') {
                        const span = document.createElement('span');
                        span.textContent = inp.options[inp.selectedIndex]?.text || '';
                        if (clonedInputs[i].parentNode) clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                    } else {
                        const span = document.createElement('span');
                        span.textContent = inp.value;
                        if (clonedInputs[i].parentNode) clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                    }
                }
            });

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Í≥µÏ†ï Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ - Ïù∏ÏáÑ</title>
                    <style>
                        body {
                            font-family: 'Inter', -apple-system, sans-serif;
                            padding: 20px;
                            background: white;
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        /* Header Styles - Matches Cover Contract exactly */
                        .doc-header {
                            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                            color: #ffffff !important;
                            padding: 20px 24px !important;
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            margin-bottom: 30px !important;
                            border-radius: 0 !important;
                        }
                        .doc-header h1 {
                            font-size: 24px !important;
                            font-weight: 700 !important;
                            margin: 0 !important;
                            color: #fff !important;
                        }
                        .doc-header .subtitle {
                            font-size: 14px !important;
                            opacity: 0.9 !important;
                            color: #fff !important;
                            margin-top: 4px !important;
                        }

                        /* Content Styles */
                        table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            font-size: 11px !important;
                        }
                        th, td {
                            border: 1px solid #d2d2d7 !important;
                            padding: 8px !important;
                            text-align: left;
                        }
                        th { background: #f5f5f7 !important; font-weight: 600; text-align: center; }
                        
                        /* Layout Tweaks */
                        .checklist-table { margin-top: 20px; }
                        
                        /* Hide unwanted */
                        .no-print, button, .restore-btn, .notion-export-btn { display: none !important; }
                    </style>
                </head>
                <body>
                    ${clonedElement.innerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌÉ≠ Ïó¥Î¶¥ Îïå ÏûêÎèôÏúºÎ°ú Î†åÎçîÎßÅ
        const originalShowCustomerTab = showCustomerTab;
        showCustomerTab = function (tabId) {
            originalShowCustomerTab(tabId);

            if (tabId === 'checklist') {
                // ÎßàÏä§ÌÑ∞ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î∂àÎü¨Ïò§Í∏∞
                if (checklistMasterData.length === 0) {
                    // ÏûêÎèôÏúºÎ°ú Î∂àÎü¨Ïò§ÏßÄ ÏïäÍ≥† ÏÇ¨Ïö©ÏûêÍ∞Ä Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎèÑÎ°ù Ïú†ÎèÑ
                    updateChecklistStats();
                } else {
                    renderChecklistItems();
                }
            }

            // ÌÜµÍ≥Ñ ÌÉ≠ ÌôúÏÑ±Ìôî Ïãú Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            if (tabId === 'stats') {
                updateSettlementStats();
                updateProfitStats();
                updateEditHistory();
            }
        };

        // ============================================
        // ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í¥ÄÎ†® Ìï®ÏàòÎì§
        // ============================================


        /**
         * ÎÖ∏ÏÖòÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
         * @param {string} type - 'customer', 'schedule', 'checklist'
         */
        window.exportToNotion = async function (type, event) {
            console.log('üöÄ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏãúÏûë - ÌÉÄÏûÖ:', type);

            // Ïù¥Î≤§Ìä∏ Í∞ùÏ≤¥ ÌôïÎ≥¥ & Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄ (Ìèº Ï†úÏ∂ú Î∞©ÏßÄ Îì±)
            const evt = event || window.event;
            if (evt) {
                evt.preventDefault();
                evt.stopPropagation();
            }

            // currentCustomer ÎåÄÏã† currentData ÏÇ¨Ïö© (Ìò∏ÌôòÏÑ±)
            const targetData = currentData || currentCustomer;

            if (!targetData || !currentCustomerId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }

            // ÏãúÏûë ÏïåÎ¶º (ÌÜ†Ïä§Ìä∏)
            showToast('ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞Î•º ÏãúÏûëÌï©ÎãàÎã§...', 'info');

            let btn = null;
            let originalHTML = '';

            if (evt && evt.target) {
                btn = evt.target.closest('button');
                if (btn) {
                    originalHTML = btn.innerHTML;
                    btn.innerHTML = '‚è≥ ÎÇ¥Î≥¥ÎÇ¥Îäî Ï§ë...';
                    btn.disabled = true;
                }
            }

            try {
                let requestData = {
                    action: 'exportToNotion',
                    type: type,
                    customerId: currentCustomerId // currentCustomer.id -> currentCustomerId
                };

                // ÎÇ†Ïßú Î∞è Í∏∞Í∞Ñ Ï†ïÎ≥¥ Ï∂îÏ∂ú (yyyy.MM.dd -> yyyy-MM-dd Ï†ïÍ∑úÌôî)
                const normalizeDate = (d) => d ? d.replace(/\./g, '-') : '';
                const startDateVal = normalizeDate(document.getElementById('constructionStartInput')?.value || targetData.startDate || '');
                const endDateVal = normalizeDate(document.getElementById('constructionEndInput')?.value || targetData.endDate || '');
                const periodVal = document.getElementById('hiddenConstructionPeriod')?.value || targetData.constructionPeriod || '';

                // ÌÉÄÏûÖÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ (Backend update_apps_script.jsÏôÄ ÌÇ§ ÏùºÏπòÏãúÌÇ¥)
                if (type === 'customer') {
                    // Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
                    const scheduleData = targetData.schedules || [];
                    const scheduleRows = scheduleData.map((item, idx) => ({
                        category: item.category || '',
                        process: item.name || '',
                        startDate: normalizeDate(item.start || ''),
                        endDate: normalizeDate(item.end || ''),
                        status: item.checkPoint || '',
                        manager: item.inCharge || ''
                    }));

                    requestData.data = {
                        'ÏÑ±Î™Ö': targetData.clientName || '',
                        'Ïó∞ÎùΩÏ≤ò': targetData.clientPhone || '',
                        'Ïù¥Î©îÏùº': targetData.clientEmail || '',
                        'Ï£ºÏÜå': targetData.clientAddress || '',
                        'ÌòÑÏû•Ï£ºÏÜå': targetData.siteAddress || '',

                        'Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö': targetData.spouseName || '',
                        'Î∞∞Ïö∞Ïûê Ïó∞ÎùΩÏ≤ò': targetData.spousePhone || '',

                        'ÌèâÏàò': targetData.area || '',
                        'Í±¥Î¨ºÏú†Ìòï': targetData.buildingType || '',
                        'Ïú†ÏûÖÍ≤ΩÎ°ú': targetData.clientSource || '',

                        'Í≥µÏÇ¨Í∏∞Í∞Ñ': periodVal,
                        'Ï∞©Í≥µÏùº': startDateVal,
                        'Ï§ÄÍ≥µÏùº': endDateVal,
                        'Ïù¥ÏÇ¨ÎÇ†Ïßú': targetData.movingDate || '',
                        'ÏûîÍ∏àÏùº': targetData.finalPaymentDate || '',
                        'Í≥ÑÏïΩÏùº': targetData.contractDate || '',
                        'Í≥µÏÇ¨Î™Ö': targetData.projectName || '',

                        'Í≥µÏÇ¨ Îã¥ÎãπÏûê': targetData.manager || '',
                        'Ï¥ùÍ≥ÑÏïΩÍ∏àÏï°': targetData.totalAmount || '',

                        'Í≥†Í∞ù ÏöîÏ≤≠ÏÇ¨Ìï≠': targetData.customerRequest || '',
                        'ÎÇ¥Î∂Ä Î©îÎ™®': targetData.internalMemo || '',
                        'ÌäπÏïΩÏÇ¨Ìï≠': targetData.specialNote || '',
                        'A/S Í∏∞Í∞Ñ': targetData.asEndDate || '', // A/S Ï¢ÖÎ£åÏùº

                        // Ïú†ÏùòÏÇ¨Ìï≠ (Ïä§ÏºÄÏ§Ñ/A/S)
                        'Í≥µÏÇ¨ Ïú†ÏùòÏÇ¨Ìï≠': getScheduleGuidelinesText(),
                        'A/S Ïú†ÏùòÏÇ¨Ìï≠': getASGuidelinesText(),

                        // Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®
                        scheduleRows: scheduleRows
                    };

                } else if (type === 'all') {
                    // [ÌÜµÌï©] Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞

                    // 1. Customer (Í∏∞Ï°¥ customer Î°úÏßÅ Ïû¨ÏÇ¨Ïö©)
                    const customerData = {
                        'ÏÑ±Î™Ö': targetData.clientName || '',
                        'Ïó∞ÎùΩÏ≤ò': targetData.clientPhone || '',
                        'Ïù¥Î©îÏùº': targetData.clientEmail || '',
                        'Ï£ºÏÜå': targetData.clientAddress || '',
                        'ÌòÑÏû•Ï£ºÏÜå': targetData.siteAddress || '',
                        'Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö': targetData.spouseName || '',
                        'Î∞∞Ïö∞Ïûê Ïó∞ÎùΩÏ≤ò': targetData.spousePhone || '',
                        'Í≥†Í∞ù ÏöîÏ≤≠ÏÇ¨Ìï≠': targetData.clientNeeds || '',
                        'ÎÇ¥Î∂Ä Î©îÎ™®': targetData.internalNote || '',
                        'ÌäπÏïΩÏÇ¨Ìï≠': targetData.specialContract || '',
                        'Í≥µÏÇ¨ Îã¥ÎãπÏûê': targetData.constructionManager || '',
                        'Í±¥Î¨ºÏú†Ìòï': targetData.buildingType || '',
                        'Ïú†ÏûÖÍ≤ΩÎ°ú': targetData.funnel || '',
                        'Ï¥ù Í≥ÑÏïΩÍ∏àÏï° (VAT Ìè¨Ìï®)': typeof calculateTotalAmount === 'function' ? calculateTotalAmount() : 0,
                        'ÌèâÏàò': document.getElementById('pyeongInput')?.value || targetData.area || 0,
                        'Ïù¥ÏÇ¨ÎÇ†Ïßú': targetData.moveDate || '',
                        'Í≥ÑÏïΩÏùº': targetData.contractDate || '',
                        'Ï∞©Í≥µÏùº': startDateVal,
                        'Ï§ÄÍ≥µÏùº': endDateVal,
                        'ÏûîÍ∏àÏùº': targetData.balanceDate || '',
                        'A/S Í∏∞Í∞Ñ': targetData.asEndDate || '',
                        'Í≥µÏÇ¨ Ïú†ÏùòÏÇ¨Ìï≠': getScheduleGuidelinesText(),
                        'A/S Ïú†ÏùòÏÇ¨Ìï≠': getASGuidelinesText()
                    };

                    // 2. Schedule
                    // Ï†ÑÏó≠ scheduleRows Ïö∞ÏÑ† ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ fallback
                    const sData = (typeof scheduleRows !== 'undefined' && scheduleRows.length > 0) ? scheduleRows : (targetData.schedules || []);
                    let scheduleData = null;
                    if (sData.length > 0) {
                        scheduleData = {
                            'guidelines': getScheduleGuidelinesArray(),
                            'Í≥µÏ†ïÎ™©Î°ù': sData.map(item => ({
                                Í≥µÏ†ï: (item.category ? item.category + ' - ' : '') + (item.name || ''),
                                ÏãúÏûëÏùº: item.start || '',
                                Ï¢ÖÎ£åÏùº: item.end || '',
                                Îã¥ÎãπÏûê: item.inCharge || '',
                                ÏÉÅÌÉú: item.checkPoint || '',
                                ÎπÑÍ≥†: item.memo || ''
                            }))
                        };
                    }

                    // 3. Checklist
                    let checklistData = null;
                    if (checklistMasterData && checklistMasterData.length > 0) {
                        const customerChecklistData = getCurrentCustomerChecklistData();

                        // Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™© Î≤àÌò∏
                        const selectedItemNumbers = Object.keys(customerChecklistData);

                        // Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™©Îßå ÌïÑÌÑ∞ÎßÅ
                        const customerItems = checklistMasterData.filter(item =>
                            selectedItemNumbers.includes(String(item.Î≤àÌò∏))
                        );

                        checklistData = {
                            'ÏôÑÎ£åÌï≠Î™©Ïàò': Object.values(customerChecklistData).filter(v => v).length,
                            'Ï†ÑÏ≤¥Ìï≠Î™©Ïàò': customerItems.length,
                            'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏': customerItems.map(item => {
                                const isChecked = !!customerChecklistData[item.Î≤àÌò∏];
                                return {
                                    Î≤àÌò∏: item.Î≤àÌò∏,
                                    Ìï≠Î™©: item.Ìï≠Î™© || '',
                                    ÎÇ¥Ïö©: item.ÎÇ¥Ïö© || '',
                                    ÏßÑÌñâÎã®Í≥Ñ: item.ÏßÑÌñâÎã®Í≥Ñ || '',
                                    Ïπ¥ÌÖåÍ≥†Î¶¨: item.category || '',
                                    ÎπÑÍ≥†: (isChecked ? '[ÏôÑÎ£å] ' : '') + (item.ÎπÑÍ≥† || ''),
                                    isChecked: isChecked
                                };
                            })
                        };
                    }

                    // 4. A/S List
                    let asListData = null;
                    const aData = (typeof asListRows !== 'undefined' && asListRows.length > 0) ? asListRows : [];
                    if (aData.length > 0) {
                        asListData = {
                            manager: targetData.manager || '',
                            period: targetData.warrantyPeriod || '',
                            guidelines: getASGuidelinesArray(),
                            items: aData
                        };
                    }

                    requestData.data = {
                        customer: customerData,
                        schedule: scheduleData,
                        checklist: checklistData,
                        asList: asListData
                    };

                } else if (type === 'schedule') {
                    const scheduleData = targetData.schedules || [];

                    requestData.data = {
                        'ÏÑ±Î™Ö': targetData.clientName || '',
                        'ÌòÑÏû•Ï£ºÏÜå': targetData.siteAddress || '',
                        'Ï∞©Í≥µÏùº': startDateVal,
                        'Ï§ÄÍ≥µÏùº': endDateVal,
                        'guidelines': getScheduleGuidelinesArray(), // [Ï∂îÍ∞Ä] Ïú†ÏùòÏÇ¨Ìï≠ Î∞∞Ïó¥
                        'Í≥µÏ†ïÎ™©Î°ù': scheduleData.map(item => ({
                            Í≥µÏ†ï: (item.category ? item.category + ' - ' : '') + (item.name || ''),
                            ÏãúÏûëÏùº: normalizeDate(item.start || ''),
                            Ï¢ÖÎ£åÏùº: normalizeDate(item.end || ''),
                            Îã¥ÎãπÏûê: item.inCharge || '',
                            ÏÉÅÌÉú: item.checkPoint || '',
                            ÎπÑÍ≥†: item.memo || ''
                        }))
                    };
                } else if (type === 'checklist') {
                    const customerChecklistData = getCurrentCustomerChecklistData();

                    // Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™© Î≤àÌò∏
                    const selectedItemNumbers = Object.keys(customerChecklistData);

                    // Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™©Îßå ÌïÑÌÑ∞ÎßÅ
                    const customerItems = checklistMasterData.filter(item =>
                        selectedItemNumbers.includes(String(item.Î≤àÌò∏))
                    );

                    // [Î≥ÄÍ≤Ω] Í≥†Í∞ùÏù¥ ÏÑ†ÌÉùÌïú Ìï≠Î™©Îßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (Ï≤¥ÌÅ¨ Ïó¨Î∂Ä Ìè¨Ìï®)
                    requestData.data = {
                        'ÏÑ±Î™Ö': targetData.clientName || '',
                        'ÌòÑÏû•Ï£ºÏÜå': targetData.siteAddress || '',
                        'ÏôÑÎ£åÌï≠Î™©Ïàò': Object.values(customerChecklistData).filter(v => v).length,
                        'Ï†ÑÏ≤¥Ìï≠Î™©Ïàò': customerItems.length,
                        'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏': customerItems.map(item => {
                            const isChecked = !!customerChecklistData[item.Î≤àÌò∏];
                            return {
                                Î≤àÌò∏: item.Î≤àÌò∏,
                                Ìï≠Î™©: item.Ìï≠Î™© || '',
                                ÎÇ¥Ïö©: item.ÎÇ¥Ïö© || '',
                                ÏßÑÌñâÎã®Í≥Ñ: item.ÏßÑÌñâÎã®Í≥Ñ || '',
                                Ïπ¥ÌÖåÍ≥†Î¶¨: item.category || '',
                                // Ï≤¥ÌÅ¨Îêú Ìï≠Î™©ÏùÄ ÎπÑÍ≥† ÏïûÏóê [ÏôÑÎ£å] ÌëúÏãú
                                ÎπÑÍ≥†: (isChecked ? '[ÏôÑÎ£å] ' : '') + (item.ÎπÑÍ≥† || ''),
                                isChecked: isChecked
                            };
                        })
                    };

                    // [Validation] ÎÇ¥Î≥¥ÎÇº Ìï≠Î™©Ïù¥ ÏóÜÏúºÎ©¥ Ï§ëÎã®
                    if (requestData.data.Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏.length === 0) {
                        showToast('ÏÑ†ÌÉùÎêú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.\nÎ®ºÏ†Ä Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ÏóêÏÑú Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                        if (btn) {
                            btn.innerHTML = originalHTML;
                            btn.disabled = false;
                        }
                        return;
                    }
                }

                console.log('üì§ ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏöîÏ≤≠:', requestData);

                // data Í∞ùÏ≤¥Î•º JSON Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
                const formData = new URLSearchParams();
                formData.append('action', requestData.action);
                formData.append('type', requestData.type);
                formData.append('customerId', requestData.customerId);
                formData.append('data', JSON.stringify(requestData.data));

                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ÏÑúÎ≤Ñ ÏùëÎãµ Ïò§Î•ò: ' + response.status + ' ' + response.statusText);
                }

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    throw new Error('ÏùëÎãµ ÌååÏã± Ïã§Ìå®: ' + e.message);
                }

                if (result.success) {
                    if (type === 'all' && result.details) {
                        let lines = [];
                        lines.push('<b>[ÎÖ∏ÏÖò ÌÜµÌï© ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í≤∞Í≥º]</b>');
                        const map = { customer: 'Í≥†Í∞ùÏ†ïÎ≥¥', schedule: 'Í≥µÏÇ¨Ïä§ÏºÄÏ§Ñ', checklist: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', asList: 'A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏' };

                        ['customer', 'schedule', 'checklist', 'asList'].forEach(k => {
                            const d = result.details[k];
                            if (d) {
                                if (d.message === 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå') {
                                    lines.push(`${map[k]}: <span style="opacity:0.7">‚ö™Ô∏è Îπà ÏÉÅÌÉú</span>`);
                                } else if (d.success) {
                                    lines.push(`${map[k]}: <b>‚úÖ ÏÑ±Í≥µ</b>`);
                                } else {
                                    lines.push(`${map[k]}: ‚ùå Ïã§Ìå® (${d.message})`);
                                }
                            }
                        });
                        showToast(lines.join('<br>'), 'info', 5000);
                    } else {
                        showToast('‚úÖ ÎÖ∏ÏÖòÏúºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏôÑÎ£å!', 'success');
                    }
                    // ÏÑ±Í≥µ Î°úÍ∑∏ (ÌÉÄÏûÖÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïö©)
                    const typeNameMap = { 'customer': 'Í≥†Í∞ù Ï†ïÎ≥¥', 'schedule': 'Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ', 'checklist': 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', 'all': 'Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞' };
                    const tName = typeNameMap[type] || type;
                    logUserAction('ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞', (targetData.clientName || targetData.projectName || 'Í≥†Í∞ù') + ' ' + tName + ' ÎÇ¥Î≥¥ÎÇ¥Í∏∞');
                } else {
                    throw new Error(result.message || 'ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®');
                }
            } catch (error) {
                console.error('‚ùå ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®:', error);
                let errMsg = 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò';
                if (typeof error === 'string') errMsg = error;
                else if (error.message) errMsg = error.message;
                else if (error.toString) errMsg = error.toString();

                showToast('ÎÖ∏ÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®: ' + errMsg, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        };

        // ============================================
        // ÌÜµÍ≥Ñ ÌÉ≠ Í¥ÄÎ†® Ìï®ÏàòÎì§
        // ============================================

        let processChartInstance = null; // Chart.js Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ÄÏû•

        // Ï†ïÏÇ∞ ÌòÑÌô© ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSettlementStats() {
            if (!currentCustomer) return;

            const settlementData = currentCustomer.settlementData || [];
            const totalContract = parseFloat(currentCustomer.totalAmount) || 0;

            // Ï†ïÏÇ∞ ÏôÑÎ£å Í∏àÏï° Í≥ÑÏÇ∞ (ÏûÖÍ∏àÏôÑÎ£å Ìï≠Î™©Îì§Ïùò Ìï©)
            let settled = 0;
            settlementData.forEach(item => {
                if (item['ÏûÖÍ∏àÏó¨Î∂Ä'] === 'ÏôÑÎ£å' || item['ÏûÖÍ∏àÏó¨Î∂Ä'] === 'ÏûÖÍ∏àÏôÑÎ£å') {
                    settled += parseFloat(item['Í∏àÏï°']) || 0;
                }
            });

            const outstanding = totalContract - settled;
            const rate = totalContract > 0 ? ((settled / totalContract) * 100).toFixed(1) : 0;

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('stats-total-contract').textContent = formatCurrency(totalContract);
            document.getElementById('stats-settled').textContent = formatCurrency(settled);
            document.getElementById('stats-outstanding').textContent = formatCurrency(outstanding);
            document.getElementById('stats-settlement-rate').textContent = rate + '%';
        }

        // ÏàòÏùµÏÑ± ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ï∞®Ìä∏ ÏÉùÏÑ±
        function updateProfitStats() {
            if (!currentCustomer) return;

            const costData = currentCustomer.costData || [];
            let totalEstimate = 0;
            let totalCost = 0;
            const processData = {};

            // Í≥µÏ†ïÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏßëÍ≥Ñ
            costData.forEach(item => {
                const process = item['Í≥µÏ†ï'] || 'Í∏∞ÌÉÄ';
                const estimate = parseFloat(item['Í≤¨Ï†ÅÍ∏àÏï°']) || 0;
                const cost = parseFloat(item['ÏõêÍ∞Ä']) || 0;

                totalEstimate += estimate;
                totalCost += cost;

                if (!processData[process]) {
                    processData[process] = { estimate: 0, cost: 0 };
                }
                processData[process].estimate += estimate;
                processData[process].cost += cost;
            });

            const totalProfit = totalEstimate - totalCost;
            const profitRate = totalEstimate > 0 ? ((totalProfit / totalEstimate) * 100).toFixed(1) : 0;

            // ÏàòÏùµÏÑ± ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('stats-total-estimate').textContent = formatCurrency(totalEstimate);
            document.getElementById('stats-total-cost').textContent = formatCurrency(totalCost);
            document.getElementById('stats-total-profit').textContent = formatCurrency(totalProfit);
            document.getElementById('stats-profit-rate').textContent = profitRate + '%';

            // Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞
            drawProcessChart(processData);
        }

        // Í≥µÏ†ïÎ≥Ñ Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞ (Chart.js)
        function drawProcessChart(processData) {
            const canvas = document.getElementById('processChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // Í∏∞Ï°¥ Ï∞®Ìä∏ ÏÇ≠Ï†ú
            if (processChartInstance) {
                processChartInstance.destroy();
            }

            const processes = Object.keys(processData);
            const estimates = processes.map(p => processData[p].estimate);
            const costs = processes.map(p => processData[p].cost);
            const profits = processes.map((p, i) => estimates[i] - costs[i]);

            processChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processes,
                    datasets: [
                        {
                            label: 'Í≤¨Ï†ÅÍ∏àÏï°',
                            data: estimates,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ÏõêÍ∞Ä',
                            data: costs,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Ïù¥Ïùµ',
                            data: profits,
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return '‚Ç©' + (value / 10000).toFixed(0) + 'Îßå';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Ìé∏Ïßë Ïù¥Î†• Í¥ÄÎ¶¨ (Phase 2: In-memory Ï†ÑÏö©)
        let editHistoryRows = [];

        // Ìé∏Ïßë Ïù¥Î†• ÏóÖÎç∞Ïù¥Ìä∏
        function updateEditHistory() {
            const timeline = document.getElementById('edit-history-timeline');
            if (!timeline) return;

            // In-memoryÏóêÏÑú Ìé∏Ïßë Ïù¥Î†• Í∞ÄÏ†∏Ïò§Í∏∞
            const history = editHistoryRows;

            if (history.length === 0) {
                timeline.innerHTML = '<div style="text-align: center; color: #8e8e93; padding: 40px;">Ìé∏Ïßë Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }

            // ÏµúÏã†ÏàúÏúºÎ°ú Ï†ïÎ†¨
            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // ÌÉÄÏûÑÎùºÏù∏ HTML ÏÉùÏÑ±
            let html = '';
            history.slice(0, 50).forEach(item => {
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleString('ko-KR');

                html += `
                    <div style="border-left: 3px solid #007aff; padding-left: 16px; margin-bottom: 20px; position: relative;">
                        <div style="position: absolute; left: -7px; top: 5px; width: 10px; height: 10px; background: #007aff; border-radius: 50%;"></div>
                        <div style="font-size: 12px; color: #8e8e93; margin-bottom: 4px;">${dateStr}</div>
                        <div style="font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 4px;">
                            üë§ ${item.userName || item.userId} (${item.userId})
                        </div>
                        <div style="font-size: 13px; color: #1d1d1f; margin-bottom: 4px;">
                            üìÑ ${item.menu} ${item.item ? '> ' + item.item : ''}
                        </div>
                        <div style="font-size: 13px; color: #636366;">
                            ÏàòÏ†ï: ${item.field}
                            <span style="color: #ff3b30;">[${item.oldValue || '-'}]</span> ‚Üí
                            <span style="color: #34c759;">[${item.newValue || '-'}]</span>
                        </div>
                    </div>
                `;
            });

            timeline.innerHTML = html;
        }

        // Ìé∏Ïßë Ïù¥Î†• Ï†ÄÏû• Ìï®Ïàò (Îã§Î•∏ Í≥≥ÏóêÏÑú Ìò∏Ï∂ú)
        function saveEditHistory(menu, item, field, oldValue, newValue) {
            const history = editHistoryRows;

            const entry = {
                timestamp: new Date().toISOString(),
                userId: currentUser?.id || 'unknown',
                userName: currentUser?.name || 'Ïïå Ïàò ÏóÜÏùå',
                menu: menu,
                item: item,
                field: field,
                oldValue: oldValue,
                newValue: newValue
            };

            history.unshift(entry);
            if (history.length > 100) history.splice(100);
            editHistoryRows = history;
            // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ

        }
        // ==========================================
        // ÏÉà Í∏∞Îä•: ÌòÑÏû¨ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Î∞è ÌÜµÌï© Ïù∏ÏáÑ
        // ==========================================

        function exportCurrentCustomerData() {
            if (!currentData || !currentData.customerId) {
                showToast('ÏÑ†ÌÉùÎêú Í≥†Í∞ùÏù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // ÌòÑÏû¨ Í≥†Í∞ù Í∞ùÏ≤¥Îßå Ï∂îÏ∂ú
            const dataToExport = {
                customer: currentData,
                exportDate: new Date().toISOString(),
                type: 'single_customer_export'
            };

            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ÎîîÏûêÏù∏ÏßÄÍ∑∏_${currentData.customerName || 'Í≥†Í∞ù'}_Îç∞Ïù¥ÌÑ∞.json`;
            a.click();
            showToast('ÌòÑÏû¨ Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        function printCurrentCustomerAll() {
            if (!currentData || !currentData.customerId) {
                showToast('ÏÑ†ÌÉùÎêú Í≥†Í∞ùÏù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Ïù∏ÏáÑÌï† ÏÑπÏÖò Ï†ïÏùò (ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ Ìï≠Î™©)
            const sections = [
                { id: 'customerInfoDoc', title: 'Í≥†Í∞ù Ï†ïÎ≥¥' },
                { id: 'contractDoc', title: 'ÎèÑÍ∏âÍ≥ÑÏïΩÏÑú' },
                { id: 'coverDoc', title: 'ÌëúÏßÄÍ≥ÑÏïΩÏÑú' },
                { id: 'estimateDoc', title: 'Í≥ÑÏïΩÍ≤¨Ï†ÅÏÑú' },
                { id: 'costDoc', title: 'ÏõêÍ∞ÄÍ¥ÄÎ¶¨Ìëú' },
                { id: 'scheduleDoc', title: 'Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ' },
                { id: 'asListDoc', title: 'A/S Í¥ÄÎ¶¨ Î¶¨Ïä§Ìä∏' }
            ];

            const printContainer = document.createElement('div');
            let hasContent = false;

            sections.forEach((section, index) => {
                const originalEl = document.getElementById(section.id);
                if (!originalEl) return;

                hasContent = true;
                const wrapper = document.createElement('div');
                wrapper.className = 'print-section';
                // ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãàÎ©¥ ÌéòÏù¥ÏßÄ ÎÑòÍπÄ
                if (index < sections.length - 1) {
                    wrapper.style.pageBreakAfter = 'always';
                }
                wrapper.style.marginBottom = '40px'; // ÏÑπÏÖò Í∞Ñ Í∞ÑÍ≤© (ÌôîÎ©¥ÏÉÅÏóêÏÑú Ïûò Î≥¥Ïù¥Í≤å)

                const clonedEl = originalEl.cloneNode(true);

                // ÏûÖÎ†• ÌïÑÎìúÍ∞íÏùÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò (ÏõêÎ≥∏ ÏóòÎ¶¨Î®ºÌä∏ Ï∞∏Ï°∞ÌïòÏó¨ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞)
                convertInputsToTextForPrint(originalEl, clonedEl);

                // Î∂àÌïÑÏöîÌïú ÏöîÏÜå Ï†úÍ±∞ (Î≤ÑÌäº, no-print ÌÅ¥ÎûòÏä§)
                clonedEl.querySelectorAll('button, .no-print').forEach(el => el.remove());

                wrapper.appendChild(clonedEl);
                printContainer.appendChild(wrapper);
            });

            if (!hasContent) {
                showToast('Ïù∏ÏáÑÌï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            const printWindow = window.open('', '_blank');


            // Í∏∞Î≥∏ HTML Íµ¨Ï°∞ ÏûëÏÑ± (Ïä§ÌÉÄÏùº Ï†úÏô∏)
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${currentData.customerName || 'Í≥†Í∞ù'} - ÌÜµÌï© Î¨∏ÏÑú</title>
                    <style>
                        @media print {
                            @page { size: A4; margin: 10mm; }
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white; }
                            .print-section { page-break-after: always; display: block !important; }
                            .print-section:last-child { page-break-after: auto; }
                            
                            /* Ïà®Í≤®ÏßÑ ÌÉ≠ Ìå®ÎÑê Í∞ïÏ†ú ÌëúÏãú */
                            .tab-panel, .document-wrapper { 
                                display: block !important; 
                                opacity: 1 !important; 
                                visibility: visible !important;
                                height: auto !important;
                                overflow: visible !important;
                            }
                        }
                        
                        body { background: white; padding: 20px; font-family: 'Inter', sans-serif; }
                        
                        /* Ïù∏ÏáÑÏö© ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº */
                        .print-text-val { 
                            font-weight: 500; 
                            color: #000; 
                            display: inline-block;
                        }
                        
                        /* Î¨∏ÏÑú Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº Î¶¨ÏÖã (Ïó¨Î∞± Îì±) */
                        .document-wrapper {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                            max-width: 100% !important;
                            width: 100% !important;
                        }
                    </style>
                </head>
                <body>
                    ${printContainer.innerHTML}
                </body>
                </html>
            `);

            // Ïä§ÌÉÄÏùº ÌÉúÍ∑∏ Î≥µÏÇ¨ (Ïä§ÌÅ¨Î¶ΩÌä∏ ÏóêÎü¨ Î∞©ÏßÄÏö©)
            // document.head.innerHTMLÏùÑ ÌÖúÌîåÎ¶ø Î¶¨ÌÑ∞Îü¥Ïóê ÎÑ£ÏúºÎ©¥ Î∞±Ìã± Î¨∏Ï†úÎ°ú ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏùå
            const styles = document.querySelectorAll('style, link[rel="stylesheet"]');
            styles.forEach(style => {
                printWindow.document.head.appendChild(style.cloneNode(true));
            });

            // Ïä§ÌÅ¨Î¶ΩÌä∏ Ïã§Ìñâ (Ïù∏ÏáÑ)
            const script = printWindow.document.createElement('script');
            script.textContent = `
                window.onload = function() {
                    setTimeout(function() {
                        window.print();
                    }, 1000);
                };
            `;
            printWindow.document.body.appendChild(script);

            printWindow.document.close();
        }

        // ÏûÖÎ†• ÌïÑÎìúÎ•º ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôòÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
        function convertInputsToTextForPrint(originParent, clonedParent) {
            const originInputs = originParent.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedParent.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originInputs.length; i++) {
                const origin = originInputs[i];
                const clone = clonedInputs[i];
                if (!clone) continue;

                let val = '';
                if (origin.tagName === 'SELECT') {
                    if (origin.selectedIndex >= 0) val = origin.options[origin.selectedIndex].text;
                    // 'ÏÑ†ÌÉù' Í∞ôÏùÄ Í±¥ ÎπàÏπ∏ Ï≤òÎ¶¨
                    if (val.includes('ÏÑ†ÌÉù')) val = '';
                } else if (origin.type === 'checkbox' || origin.type === 'radio') {
                    val = origin.checked ? '‚òë' : '‚òê';
                } else {
                    val = origin.value;
                }

                const span = document.createElement('span');
                span.className = 'print-text-val';
                span.textContent = val;

                if (origin.type !== 'checkbox' && origin.type !== 'radio') {
                    span.style.whiteSpace = 'pre-wrap';
                } else {
                    span.style.fontSize = '14px';
                    span.style.marginRight = '4px';
                }

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }
        }

        // ==========================================
        // Î©ÄÌã∞ ÏÖÄÎ†âÌä∏ (Multi-Select) Ìó¨Ìçº Ìï®ÏàòÎì§
        // ==========================================
        const multiSelectState = {
            checklistStageFilter: ['all'],
            checklistCategoryFilter: ['all']
        };

        // ÎìúÎ°≠Îã§Ïö¥ Ï¥àÍ∏∞Ìôî
        function initMultiSelect(elementId, options) {
            const dropdown = document.getElementById(elementId + 'Dropdown');
            if (!dropdown) return;

            // Í∏∞Ï°¥ ÏÉÅÌÉú Ïú†ÏßÄÌïòÎ©¥ÏÑú ÏòµÏÖò Ïû¨ÏÉùÏÑ±
            const currentState = multiSelectState[elementId];

            let html = '';
            // Ï†ÑÏ≤¥ Î≥¥Í∏∞ Ìï≠Î™©
            const isAllChecked = currentState.includes('all');
            html += `<div class="multi-select-option">
                        <label>
                            <input type="checkbox" value="all" ${isAllChecked ? 'checked' : ''} onchange="handleMultiSelectChange('${elementId}', this)">
                            Ï†ÑÏ≤¥ Î≥¥Í∏∞
                        </label>
                     </div>`;

            // Í∞úÎ≥Ñ Ìï≠Î™©Îì§
            options.forEach(opt => {
                const isChecked = currentState.includes(opt);
                html += `<div class="multi-select-option">
                            <label>
                                <input type="checkbox" value="${opt}" ${isChecked ? 'checked' : ''} onchange="handleMultiSelectChange('${elementId}', this)">
                                ${opt}
                            </label>
                         </div>`;
            });

            dropdown.innerHTML = html;
            updateMultiSelectLabel(elementId);
        }

        // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
        function handleMultiSelectChange(elementId, input) {
            const value = input.value;
            const isChecked = input.checked;
            const checkboxes = document.querySelectorAll(`#${elementId}Dropdown input[type="checkbox"]`);

            if (value === 'all') {
                if (isChecked) {
                    // Ï†ÑÏ≤¥ ÏÑ†ÌÉù Ïãú -> ÎÇòÎ®∏ÏßÄ Ìï¥Ï†ú
                    checkboxes.forEach(cb => {
                        if (cb.value !== 'all') cb.checked = false;
                    });
                    multiSelectState[elementId] = ['all'];
                } else {
                    // Ï†ÑÏ≤¥ Ìï¥Ï†ú Ïãú -> Îπà ÏÉÅÌÉú (ÌóàÏö©)
                    multiSelectState[elementId] = [];
                }
            } else {
                // Í∞úÎ≥Ñ ÏÑ†ÌÉù Ïãú
                if (isChecked) {
                    // Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î∞ïÏä§ Ìï¥Ï†ú
                    const allCb = document.querySelector(`#${elementId}Dropdown input[value="all"]`);
                    if (allCb) allCb.checked = false;
                }

                // Ï≤¥ÌÅ¨Îêú Ìï≠Î™©Îì§ ÏàòÏßë
                const selected = [];
                checkboxes.forEach(cb => {
                    if (cb.value !== 'all' && cb.checked) {
                        selected.push(cb.value);
                    }
                });

                if (selected.length === 0) {
                    // Î™®Îëê Ìï¥Ï†úÎêòÎ©¥ ÏûêÎèôÏúºÎ°ú 'Ï†ÑÏ≤¥'Î°ú Î≥µÍ∑Ä
                    const allCb = document.querySelector(`#${elementId}Dropdown input[value="all"]`);
                    if (allCb) allCb.checked = true;
                    multiSelectState[elementId] = ['all'];
                } else {
                    multiSelectState[elementId] = selected;
                }
            }

            updateMultiSelectLabel(elementId);

            // [Ï∂îÍ∞Ä] ÏßÑÌñâÎã®Í≥Ñ ÌïÑÌÑ∞Í∞Ä Î≥ÄÍ≤ΩÎêòÎ©¥ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏòµÏÖòÏùÑ Í∞±Ïã† (Dependent Dropdown)
            if (elementId === 'checklistStageFilter') {
                updateCategoryOptionsBasedOnStage();
            }

            renderChecklistItems();
        }

        // [Ï∂îÍ∞Ä] ÏßÑÌñâÎã®Í≥Ñ ÏÑ†ÌÉùÏóê Îî∞Î•∏ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏòµÏÖò Í∞±Ïã†
        function updateCategoryOptionsBasedOnStage() {
            const selectedStages = multiSelectState['checklistStageFilter'];
            console.log('[Filter Logic] Selected Stages:', selectedStages);

            if (!checklistMasterData || checklistMasterData.length === 0) {
                console.warn('[Filter Logic] No master data available for filtering');
                return;
            }

            let validCategories = [];

            if (selectedStages.includes('all') || selectedStages.length === 0) {
                // Ï†ÑÏ≤¥ ÏÑ†ÌÉù Ïãú -> Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ ÌëúÏãú
                validCategories = [...new Set(checklistMasterData.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            } else {
                // ÌäπÏ†ï Îã®Í≥Ñ ÏÑ†ÌÉù Ïãú -> Ìï¥Îãπ Îã®Í≥ÑÏóê Ìè¨Ìï®Îêú Ïπ¥ÌÖåÍ≥†Î¶¨Îßå Ï∂îÏ∂ú
                const filteredItems = checklistMasterData.filter(item => {
                    const itemStage = (item.ÏßÑÌñâÎã®Í≥Ñ || '').trim();
                    // selectedStages could have untrimmed values if init was untrimmed, but typically they match.
                    // To be safe, we rely on exact values from options. 
                    // But here we just used item.ÏßÑÌñâÎã®Í≥Ñ to build options, so it should match.
                    return selectedStages.some(stage => stage === item.ÏßÑÌñâÎã®Í≥Ñ || stage === itemStage);
                });
                validCategories = [...new Set(filteredItems.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            }

            console.log('[Filter Logic] Valid Categories:', validCategories);

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Ï§ë Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Í≤ÉÏùÄ Ï†úÍ±∞ (UX Í∞úÏÑ†)
            const currentCategoryState = multiSelectState['checklistCategoryFilter'];

            if (!currentCategoryState.includes('all')) {
                const newCategoryState = currentCategoryState.filter(cat => validCategories.includes(cat));
                // ÌïòÎÇòÎèÑ ÏóÜÏúºÎ©¥ 'all'Î°ú Î¶¨ÏÖã
                multiSelectState['checklistCategoryFilter'] = newCategoryState.length > 0 ? newCategoryState : ['all'];
            } else {
                // If it was 'all', keep it 'all' unless validCategories is empty? 
                // 'all' is always valid if validCategories has items.
            }

            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏòµÏÖò Ïû¨ÏÉùÏÑ±
            initMultiSelect('checklistCategoryFilter', validCategories);
        }

        // ÎùºÎ≤® ÏóÖÎç∞Ïù¥Ìä∏
        function updateMultiSelectLabel(elementId) {
            const label = document.getElementById(elementId + 'Label');
            if (!label) return;

            const state = multiSelectState[elementId];
            if (state.includes('all') || state.length === 0) {
                label.innerText = 'Ï†ÑÏ≤¥ Î≥¥Í∏∞';
                label.style.fontWeight = 'normal';
                label.style.color = 'inherit';
            } else {
                // ÏÑ†ÌÉùÎêú Ìï≠Î™© Ïù¥Î¶Ñ ÌëúÏãú (ÎÑàÎ¨¥ Í∏∏Î©¥ Ï§ÑÏûÑ)
                let text = state.join(', ');
                if (text.length > 20) {
                    text = state[0] + (state.length > 1 ? ` Ïô∏ ${state.length - 1}Í∞ú` : '');
                }
                label.innerText = text;
                label.style.fontWeight = '600';
                label.style.color = '#0071e3';
            }
        }

        // ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
        function toggleMultiSelect(elementId, event) {
            // [Fix] ÎìúÎ°≠Îã§Ïö¥ ÎÇ¥Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´ÌûàÏßÄ ÏïäÎèÑÎ°ù Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Î∞©ÏßÄ
            if (event && event.target.closest('.multi-select-dropdown')) return;

            const dropdown = document.getElementById(elementId + 'Dropdown');
            if (!dropdown) return;

            const isVisible = dropdown.style.display === 'block';

            // Îã§Î•∏ ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            document.querySelectorAll('.multi-select-dropdown').forEach(d => {
                if (d.id !== elementId + 'Dropdown') d.style.display = 'none';
            });

            dropdown.style.display = isVisible ? 'none' : 'block';

            // [Fix] Ïù¥Î≤§Ìä∏ Î≤ÑÎ∏îÎßÅ Î∞©ÏßÄ (ÌïÑÏöî Ïãú)
            if (event) event.stopPropagation();
        }

        function getMultiSelectValues(elementId) {
            const val = multiSelectState[elementId];
            if (!val || val.length === 0) return ['all'];
            return val;
        }

        // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.multi-select-wrapper')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(d => {
                    d.style.display = 'none';
                });
            }
        });

        // ============================
        // [Ïã†Í∑ú] Í≥µÏ†ïÎ≥Ñ ÏàòÏùµÍ∏à Î∂ÑÏÑù (Profit by Process)
        // ============================
        function renderProfitAnalysis() {
            const tbody = document.getElementById('profitAnalysisBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            const estData = currentData.estimateData || {};
            const settRows = currentData.settlementRows || settlementRows || [];

            // Ï†ïÏÇ∞ Îç∞Ïù¥ÌÑ∞Î•º Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ìï©ÏÇ∞
            const settlementByCategory = {};
            settRows.forEach(row => {
                const cat = (row.category || '').trim();
                if (!cat) return;
                const amount = parseInt(String(row.payAmount || 0).replace(/[^0-9-]/g, '')) || 0;
                if (!settlementByCategory[cat]) settlementByCategory[cat] = 0;
                settlementByCategory[cat] += amount;
            });

            let grandEstimate = 0;
            let grandExpense = 0;
            let rowNum = 0;
            const chartData = []; // Ï∞®Ìä∏Ïö© Ïπ¥ÌÖåÍ≥†Î¶¨ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë

            categories.forEach(cat => {
                const catRows = estData[cat.no] || [];
                if (catRows.length === 0) return; // Îπà Ïπ¥ÌÖåÍ≥†Î¶¨ Í±¥ÎÑàÎúÄ

                // Í≤¨Ï†Å Ìï≠Î™©Ïù¥ Ïã§Ï†úÎ°ú Í∏àÏï°Ïù¥ ÏûàÎäîÏßÄ Ï≤¥ÌÅ¨
                let catEstTotal = 0;
                const validRows = [];
                catRows.forEach(r => {
                    const qty = parseFloat(r.qty) || 0;
                    const price = parseInt(String(r.price || 0).replace(/[^0-9-]/g, '')) || 0;
                    const amount = qty * price;
                    if (r.name || price > 0) {
                        validRows.push({ ...r, qty, price, amount });
                        catEstTotal += amount;
                    }
                });

                if (validRows.length === 0) return;

                // Ï†ïÏÇ∞ Ìï©Í≥Ñ (Ïπ¥ÌÖåÍ≥†Î¶¨Î™ÖÏúºÎ°ú Îß§Ïπ≠)
                const catExpense = settlementByCategory[cat.name] || 0;
                const catDiff = catEstTotal - catExpense;
                const catRate = catEstTotal > 0 ? ((catDiff / catEstTotal) * 100).toFixed(1) : '-';

                // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                chartData.push({ name: cat.name, estimate: catEstTotal, expense: catExpense, profit: catDiff });

                // Ïπ¥ÌÖåÍ≥†Î¶¨ Ìó§Îçî
                const headerTr = document.createElement('tr');
                headerTr.className = 'profit-cat-header';
                headerTr.innerHTML = `
                    <td colspan="10" style="text-align:left; padding-left:12px;">
                        üìÅ ${cat.no}. ${cat.name}
                    </td>
                `;
                tbody.appendChild(headerTr);

                // Í∞úÎ≥Ñ Ìï≠Î™©
                validRows.forEach(r => {
                    rowNum++;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${rowNum}</td>
                        <td>${r.div || '-'}</td>
                        <td style="text-align:left; padding-left:8px;">${r.name || '-'}</td>
                        <td>${r.qty || '-'}</td>
                        <td>${r.unit || '-'}</td>
                        <td>${r.price ? r.price.toLocaleString() : '-'}</td>
                        <td>${r.amount ? r.amount.toLocaleString() : '-'}</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                    `;
                    tbody.appendChild(tr);
                });

                // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÜåÍ≥Ñ
                const subtotalTr = document.createElement('tr');
                subtotalTr.className = 'profit-cat-subtotal';
                const diffClass = catDiff > 0 ? 'profit-positive' : catDiff < 0 ? 'profit-negative' : 'profit-zero';
                const rateClass = parseFloat(catRate) > 0 ? 'profit-positive' : parseFloat(catRate) < 0 ? 'profit-negative' : 'profit-zero';
                subtotalTr.innerHTML = `
                    <td></td>
                    <td colspan="5" style="text-align:left; padding-left:12px;">üìä ${cat.name} ÏÜåÍ≥Ñ</td>
                    <td style="font-weight:700;">${catEstTotal.toLocaleString()}</td>
                    <td style="font-weight:700; color:#ff9500;">${catExpense.toLocaleString()}</td>
                    <td class="${diffClass}" style="font-weight:700;">${catDiff.toLocaleString()}</td>
                    <td class="${rateClass}" style="font-weight:700;">${catRate}%</td>
                `;
                tbody.appendChild(subtotalTr);

                grandEstimate += catEstTotal;
                grandExpense += catExpense;
            });

            // Ï†ïÏÇ∞ÏóêÎßå ÏûàÍ≥† Í≤¨Ï†ÅÏóê ÏóÜÎäî Ïπ¥ÌÖåÍ≥†Î¶¨ ÌëúÏãú
            Object.keys(settlementByCategory).forEach(cat => {
                const matched = categories.some(c => c.name === cat);
                if (!matched && settlementByCategory[cat] > 0) {
                    const amt = settlementByCategory[cat];
                    const headerTr = document.createElement('tr');
                    headerTr.className = 'profit-cat-header';
                    headerTr.innerHTML = `<td colspan="10" style="text-align:left; padding-left:12px;">üìÅ ${cat} (Ï†ïÏÇ∞Îßå Ï°¥Ïû¨)</td>`;
                    tbody.appendChild(headerTr);

                    const subtotalTr = document.createElement('tr');
                    subtotalTr.className = 'profit-cat-subtotal';
                    subtotalTr.innerHTML = `
                        <td></td>
                        <td colspan="5" style="text-align:left; padding-left:12px;">üìä ${cat} ÏÜåÍ≥Ñ</td>
                        <td>0</td>
                        <td style="font-weight:700; color:#ff9500;">${amt.toLocaleString()}</td>
                        <td class="profit-negative" style="font-weight:700;">${(-amt).toLocaleString()}</td>
                        <td class="profit-negative" style="font-weight:700;">-</td>
                    `;
                    tbody.appendChild(subtotalTr);
                    grandExpense += amt;
                    chartData.push({ name: cat, estimate: 0, expense: amt, profit: -amt });
                }
            });

            // ÏµúÏ¢Ö Ìï©Í≥Ñ
            const grandDiff = grandEstimate - grandExpense;
            const grandRate = grandEstimate > 0 ? ((grandDiff / grandEstimate) * 100).toFixed(1) : '0.0';
            const finalTr = document.createElement('tr');
            finalTr.className = 'profit-final-row';
            finalTr.innerHTML = `
                <td></td>
                <td colspan="5" style="text-align:left; padding-left:12px;">üèÅ ÏµúÏ¢Ö Ìï©Í≥Ñ</td>
                <td>${grandEstimate.toLocaleString()}</td>
                <td>${grandExpense.toLocaleString()}</td>
                <td>${grandDiff.toLocaleString()}</td>
                <td>${grandRate}%</td>
            `;
            tbody.appendChild(finalTr);

            // ÏÉÅÎã® ÏöîÏïΩ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            const elEst = document.getElementById('profitTotalEstimate');
            const elExp = document.getElementById('profitTotalExpense');
            const elProfit = document.getElementById('profitTotalProfit');
            const elRate = document.getElementById('profitTotalRate');

            if (elEst) elEst.innerText = grandEstimate.toLocaleString() + 'Ïõê';
            if (elExp) {
                elExp.innerText = grandExpense.toLocaleString() + 'Ïõê';
                elExp.style.color = '#ff9500';
            }
            if (elProfit) {
                elProfit.innerText = grandDiff.toLocaleString() + 'Ïõê';
                elProfit.style.color = grandDiff >= 0 ? '#34c759' : '#ff3b30';
            }
            if (elRate) {
                elRate.innerText = grandRate + '%';
                elRate.style.color = parseFloat(grandRate) >= 0 ? '#007aff' : '#ff3b30';
            }

            // ===== Ï∞®Ìä∏ Î†åÎçîÎßÅ =====
            renderProfitCharts(chartData);
        }

        // Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ÄÏû•
        let profitBarChartInstance = null;
        let profitDoughnutChartInstance = null;

        function renderProfitCharts(chartData) {
            if (!chartData || chartData.length === 0) return;
            if (typeof Chart === 'undefined') return;

            const labels = chartData.map(d => d.name.length > 6 ? d.name.substring(0, 6) + '‚Ä¶' : d.name);
            const estimateValues = chartData.map(d => d.estimate);
            const expenseValues = chartData.map(d => d.expense);
            const profitValues = chartData.map(d => d.profit);

            // ÏÉâÏÉÅ ÌåîÎ†àÌä∏
            const colors = [
                '#0071e3', '#34c759', '#ff9500', '#ff3b30', '#5856d6',
                '#af52de', '#007aff', '#ff2d55', '#5ac8fa', '#ffcc00',
                '#4cd964', '#8e8e93', '#ff6b6b', '#48dbfb', '#feca57'
            ];

            // ===== 1. Î∞î Ï∞®Ìä∏: Í≤¨Ï†Å vs Ïã§Ìñâ ÎπÑÍµê =====
            const barCtx = document.getElementById('profitBarChart');
            if (barCtx) {
                if (profitBarChartInstance) profitBarChartInstance.destroy();
                profitBarChartInstance = new Chart(barCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Í≤¨Ï†ÅÍ∏àÏï°',
                                data: estimateValues,
                                backgroundColor: 'rgba(0, 113, 227, 0.7)',
                                borderColor: '#0071e3',
                                borderWidth: 1,
                                borderRadius: 6,
                                barPercentage: 0.7,
                                categoryPercentage: 0.8
                            },
                            {
                                label: 'Ïã§ÌñâÍ∏àÏï°',
                                data: expenseValues,
                                backgroundColor: 'rgba(255, 149, 0, 0.7)',
                                borderColor: '#ff9500',
                                borderWidth: 1,
                                borderRadius: 6,
                                barPercentage: 0.7,
                                categoryPercentage: 0.8
                            },
                            {
                                label: 'ÏàòÏùµÍ∏à',
                                data: profitValues,
                                backgroundColor: profitValues.map(v => v >= 0 ? 'rgba(52, 199, 89, 0.7)' : 'rgba(255, 59, 48, 0.7)'),
                                borderColor: profitValues.map(v => v >= 0 ? '#34c759' : '#ff3b30'),
                                borderWidth: 1,
                                borderRadius: 6,
                                barPercentage: 0.7,
                                categoryPercentage: 0.8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { font: { size: 11, family: "'SF Pro Display', sans-serif" }, padding: 16, usePointStyle: true, pointStyleWidth: 10 }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                titleFont: { size: 12 },
                                bodyFont: { size: 11 },
                                padding: 10,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function (ctx) {
                                        return ctx.dataset.label + ': ' + ctx.parsed.y.toLocaleString() + 'Ïõê';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { font: { size: 10 }, maxRotation: 45 }
                            },
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' },
                                ticks: {
                                    font: { size: 10 },
                                    callback: function (v) {
                                        if (v >= 10000000) return (v / 10000000).toFixed(0) + 'Ï≤úÎßå';
                                        if (v >= 10000) return (v / 10000).toFixed(0) + 'Îßå';
                                        return v.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ===== 2. ÎèÑÎÑõ Ï∞®Ìä∏: Í≤¨Ï†Å ÎπÑÏ§ë =====
            const doughnutCtx = document.getElementById('profitDoughnutChart');
            if (doughnutCtx) {
                if (profitDoughnutChartInstance) profitDoughnutChartInstance.destroy();
                const bgColors = chartData.map((_, i) => colors[i % colors.length]);
                profitDoughnutChartInstance = new Chart(doughnutCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: chartData.map(d => d.name),
                        datasets: [{
                            data: estimateValues,
                            backgroundColor: bgColors,
                            borderColor: '#fff',
                            borderWidth: 2,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '55%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { font: { size: 10, family: "'SF Pro Display', sans-serif" }, padding: 10, usePointStyle: true, pointStyleWidth: 8 }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                padding: 10,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function (ctx) {
                                        const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                        const pct = total > 0 ? ((ctx.parsed / total) * 100).toFixed(1) : 0;
                                        return ctx.label + ': ' + ctx.parsed.toLocaleString() + 'Ïõê (' + pct + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // ============================
        // [Ïã†Í∑ú] ÌòÑÌô© Î∞è ÏûëÏóÖÍ∏∞Î°ù (System Action Log)
        // ============================
        // ÏÑúÎ≤Ñ Ïó∞Îèô Î∞©ÏãùÏúºÎ°ú Î≥ÄÍ≤ΩÎê®

        // Î°úÍ∑∏ Í∏∞Î°ù Ìï®Ïàò (ÏÑúÎ≤Ñ Ï†ÑÏÜ°)
        async function logUserAction(actionType, detailText) {
            const adminId = (currentAdmin && currentAdmin.id) ? currentAdmin.id : 'unknown';

            // UIÏóê Ï¶âÏãú Î∞òÏòÅÏùÑ ÏúÑÌï¥ Î°úÏª¨ Ìò∏Ï∂ú (ÏÑ†ÌÉùÏ†Å)
            // renderAuditLog(); // ÏÑúÎ≤ÑÏóêÏÑú Îã§Ïãú Î∂àÎü¨Ïò§Îäî Í≤ÉÏù¥ Ï†ïÌôïÌï®

            try {
                // ÎπÑÎèôÍ∏∞ Ï†ÑÏÜ° (Í≤∞Í≥º Í∏∞Îã§Î¶¨ÏßÄ ÏïäÏùå)
                fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'logUserAction',
                        adminId: adminId,
                        actionType: actionType,
                        detail: detailText
                    })
                }).then(res => res.json())
                    .then(data => {
                        console.log('Log saved:', data);
                        // Î°úÍ∑∏ Ï†ÄÏû• ÏôÑÎ£å ÏïåÎ¶º
                        console.log('Action log saved successfully');
                    })
                    .catch(err => console.error('Log save error:', err));
            } catch (e) {
                console.error('Log error:', e);
            }
        }

        // [Ïã†Í∑ú] Î°úÍ∑∏ ÏÉÅÏÑ∏ÎÇ¥Ïö© Ìè¨Îß∑ÌÑ∞
        function formatLogDetail(detail) {
            if (!detail) return '';
            let parsed = null;
            let isJson = false;

            if (typeof detail === 'string' && detail.trim().startsWith('{')) {
                try {
                    parsed = JSON.parse(detail);
                    isJson = true;
                } catch (e) { }
            }

            if (isJson && parsed) {
                // {type:"ExcelExport", scope:"single", customerName:"..."}
                if (parsed.type === 'ExcelExport') {
                    const scope = (parsed.scope === 'single' || parsed.scope === 'current') ? '1Î™Ö Í≥†Í∞ù' : 'Ï†ÑÏ≤¥ Í≥†Í∞ù';
                    const name = parsed.customerName ? ` ¬∑ ${parsed.customerName}` : '';
                    return `Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ¬∑ ${scope}${name}`;
                }
                // {module:"expenses", action:"load"}
                if (parsed.module) {
                    const modName = parsed.module === 'expenses' ? 'Ïö¥ÏòÅÎπÑ ÏãúÌä∏' : (parsed.module === 'fixed' ? 'Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï' : parsed.module);
                    const actName = parsed.action === 'load' ? 'Î∂àÎü¨Ïò§Í∏∞' : (parsed.action === 'save' ? 'Ï†ÄÏû•' : parsed.action);
                    return `${modName} ${actName}`;
                }
                // Fallback
                return Object.entries(parsed).map(([k, v]) => `${k}:${v}`).join(' ¬∑ ');
            }

            // Plain text (Truncate)
            let str = String(detail);
            return str.length > 200 ? str.slice(0, 200) + '...' : str;
        }

        // Î°úÍ∑∏ Î†åÎçîÎßÅ Ìï®Ïàò (ÏÑúÎ≤Ñ Ï°∞Ìöå)
        async function renderActionLog(targetId) {
            const reqId = targetId || currentCustomerId;
            let tbody = document.getElementById('auditLogTableBody');
            // panel-statsÎäî Ïù¥Ï†ú Í≥µÏ†ïÎ≥Ñ ÏàòÏùµÍ∏à ÌÉ≠Ïù¥ÎØÄÎ°ú fallback Ï†úÍ±∞

            if (!tbody) return;

            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">Î°úÎî© Ï§ë...</td></tr>';

            try {
                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=action_log&action=getLogs`);
                const result = await response.json();

                // [Guard] Check if customer changed during fetch
                if (reqId && reqId !== currentCustomerId) return;

                if (result.success && result.logs) {
                    if (result.logs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">Ìé∏Ïßë Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                        return;
                    }

                    // ÏµúÍ∑º 200Í±¥ Ï†úÌïú
                    const displayLogs = result.logs.slice(0, 200);

                    let html = '';
                    displayLogs.forEach(log => {
                        const formattedDetail = formatLogDetail(log.detail);
                        html += `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 8px 10px; color:#666; font-size:12px; white-space:nowrap;">${log.timestamp}</td>
                                <td style="padding: 8px 10px; font-weight:600; font-size:12px; color:#0071e3;">${log.adminId}</td>
                                <td style="padding: 8px 10px; color:#333; font-size:12px;">
                                    <span style="font-weight:600; color:#1d1d1f; margin-right:4px;">[${log.actionType}]</span>
                                    ${formattedDetail}
                                </td>
                            </tr>
                        `;
                    });
                    tbody.innerHTML = html;

                    // ÏöîÏïΩ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                    const countEl = document.getElementById('logEditCount');
                    if (countEl) countEl.textContent = result.logs.length + 'Í±¥';

                    const nameEl = document.getElementById('logCustomerName');
                    if (nameEl) nameEl.textContent = 'Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú';

                    const statusEl = document.getElementById('logCustomerStatus');
                    if (statusEl) statusEl.textContent = 'Active';

                    const amountEl = document.getElementById('logCustomerAmount');
                    if (amountEl) amountEl.textContent = '-';

                } else {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:red;">Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®</td></tr>';
                }
            } catch (e) {
                console.error('Log fetch error:', e);
                // ÏóêÎü¨ Î∞úÏÉù ÏãúÏóêÎèÑ ÏïàÏ†ÑÌïòÍ≤å Î©îÏãúÏßÄ Ï∂úÎ†•
                if (tbody) tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">Ïò§Î•ò Î∞úÏÉù</td></tr>';
            }
        }

        // renderAuditLog (Íµ¨Î≤ÑÏ†Ñ Ìò∏Ìôò)
        const renderAuditLog = renderActionLog;


        // ============================
        // [Ïã†Í∑ú] Ïö¥ÏòÅÎπÑ Í¥ÄÎ¶¨ (Operating Expenses) & Î∑∞ Ïä§ÏúÑÏπ≠
        // ============================
        let expensesRows = [];
        let fixedExpenseItems = []; // Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Ìï≠Î™©
        const EXPENSE_CATEGORIES = ['Ïù∏Í±¥ÎπÑ', 'Ï∞®ÎüâÏö¥ÏòÅÎπÑ', 'ÏûÑÎåÄÎ£å', 'Ïö¥ÏòÅÎπÑ', 'ÎßàÏºÄÌåÖ/ÏòÅÏóÖ', 'ÏÑ∏Í∏à/Í∏àÏúµ', 'Í∏∞ÌÉÄ'];

        // Phase 2: Ï¥àÍ∏∞ Î°úÎìú (Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö© Í∏àÏßÄ)

        // ÌòÑÏû¨ Ïõî ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', () => {
            const monthFilter = document.getElementById('expenseMonthFilter');
            if (monthFilter) {
                const now = new Date();
                monthFilter.value = now.toISOString().slice(0, 7); // YYYY-MM
            }
        });

        // Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Ìå®ÎÑê ÌÜ†Í∏Ä
        function toggleFixedExpenseSettings() {
            const panel = document.getElementById('fixedExpenseSettingsPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                if (panel.style.display === 'block') {
                    renderFixedExpenseTable();
                }
            }
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™© Ï∂îÍ∞Ä
        function addFixedExpenseItem() {
            fixedExpenseItems.push({
                category: '',
                detail: '', // Ìï≠Î™©Î™Ö -> ÏÉÅÏÑ∏ÎÇ¥Ïó≠
                amount: 0,
                payMethod: '',
                receipt: '', // Ï¶ùÎπôÏûêÎ£å Ï∂îÍ∞Ä
                active: true
            });
            renderFixedExpenseTable();
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™© ÏÇ≠Ï†ú
        function removeFixedExpenseItem(index) {
            fixedExpenseItems.splice(index, 1);
            renderFixedExpenseTable();
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™© ÏàòÏ†ï
        function updateFixedExpenseItem(index, field, value) {
            if (field === 'active') {
                fixedExpenseItems[index][field] = value;
            } else if (field === 'amount') {
                fixedExpenseItems[index][field] = parseNumber(value);
            } else {
                fixedExpenseItems[index][field] = value;
            }
        }

        // Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
        function renderFixedExpenseTable() {
            const tbody = document.getElementById('fixedExpenseTableBody');
            if (!tbody) return;

            tbody.innerHTML = fixedExpenseItems.map((item, index) => `
                <tr>
                    <td style="text-align:center; padding:8px;">
                        <button onclick="removeFixedExpenseItem(${index})" style="color:#dc2626; border:none; background:none; cursor:pointer; font-size:14px;">üóëÔ∏è</button>
                    </td>
                    <td style="padding:4px;">
                        <select onchange="updateFixedExpenseItem(${index}, 'category', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;">
                            <option value="">ÏÑ†ÌÉù</option>
                            ${EXPENSE_CATEGORIES.map(c => `<option value="${c}" ${c === item.category ? 'selected' : ''}>${c}</option>`).join('')}
                        </select>
                    </td>
                    <td style="padding:4px;"><input type="text" value="${item.detail || item.itemName || ''}" onchange="updateFixedExpenseItem(${index}, 'detail', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px;"><input type="text" value="${formatNumber(item.amount)}" onchange="updateFixedExpenseItem(${index}, 'amount', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px; text-align:right;"></td>
                    <td style="padding:4px;"><input type="text" value="${item.payMethod || ''}" onchange="updateFixedExpenseItem(${index}, 'payMethod', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px;"><input type="text" value="${item.receipt || ''}" onchange="updateFixedExpenseItem(${index}, 'receipt', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px; text-align:center;">
                        <input type="checkbox" ${item.active ? 'checked' : ''} onchange="updateFixedExpenseItem(${index}, 'active', this.checked)" style="width:18px; height:18px; cursor:pointer;">
                    </td>
                </tr>
            `).join('');
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ï†ÄÏû• (ÌÅ¥ÎùºÏö∞Îìú)
        async function saveFixedExpensesToCloud() {
            const btn = document.getElementById('btnSaveFixed');
            const originalText = btn?.innerText || 'üíæ Ï†ÄÏû•';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Ï†ÄÏû• Ï§ë...';
                }

                const payload = {
                    action: 'updateExpenses',
                    fixedExpenses: fixedExpenseItems.map(item => ({
                        category: item.category || '',
                        detail: item.detail || item.itemName || '',
                        amount: parseNumber(item.amount),
                        payMethod: item.payMethod || '',
                        receipt: item.receipt || '',
                        active: item.active !== false
                    }))
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    // Î°úÏª¨ÏóêÎèÑ Ï†ÄÏû•
                    // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    showToast(`Ï†ÄÏû• ÏôÑÎ£å ${timeStr}`, 'success');
                    renderExpensesTable();
                    logUserAction('Ï†ÄÏû•', 'Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Ï†ÄÏû•');
                } else {
                    throw new Error(result.error || 'Ï†ÄÏû• Ïã§Ìå®');
                }
            } catch (err) {
                console.error('Í≥†Ï†ïÏßÄÏ∂ú Ï†ÄÏû• Ïò§Î•ò:', err);
                showToast('Ï†ÄÏû• Ïã§Ìå®: ' + (err.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Î∂àÎü¨Ïò§Í∏∞ (ÌÅ¥ÎùºÏö∞Îìú)
        async function loadFixedExpensesFromCloud() {
            const btn = document.getElementById('btnLoadFixed');
            const originalText = btn?.innerText || 'üîÑ Î∂àÎü¨Ïò§Í∏∞';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Î∂àÎü¨Ïò§Îäî Ï§ë...';
                }

                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=expenses`);
                const result = await response.json();

                if (result.result === 'success') {
                    // Í≥†Ï†ïÏßÄÏ∂ú Îç∞Ïù¥ÌÑ∞Îßå Î∂àÎü¨Ïò§Í∏∞
                    if (result.fixedExpenses && result.fixedExpenses.length > 0) {
                        fixedExpenseItems = result.fixedExpenses.map(f => ({
                            category: f.category || '',
                            detail: f.detail || f.itemName || '',
                            amount: f.amount || 0,
                            payMethod: f.payMethod || '',
                            receipt: f.receipt || '',
                            active: f.active !== false
                        }));
                        // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ

                        renderFixedExpenseTable();
                        renderExpensesTable();
                        showToast(`Í≥†Ï†ïÏßÄÏ∂ú ${result.fixedExpenses.length}Í±¥ Î∂àÎü¨Ïò¥`, 'success');
                        logUserAction('Î∂àÎü¨Ïò§Í∏∞', 'Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞');
                    } else {
                        showToast('Ï†ÄÏû•Îêú Í≥†Ï†ïÏßÄÏ∂úÏù¥ ÏóÜÏäµÎãàÎã§.', 'info');
                    }
                } else {
                    throw new Error(result.error || 'Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®');
                }
            } catch (err) {
                console.error('Í≥†Ï†ïÏßÄÏ∂ú Î∂àÎü¨Ïò§Í∏∞ Ïò§Î•ò:', err);
                showToast('Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + err.message, 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        function showMainView(viewName) {
            const mainContent = document.getElementById('mainContent');
            const mainBoardView = document.getElementById('mainBoardView');
            const customerView = document.getElementById('customerView');
            const expensesView = document.getElementById('view-expenses');

            // Ï¥àÍ∏∞Ìôî - Î™®Îì† Î∑∞ Ïà®Í∏∞Í∏∞
            if (mainBoardView) mainBoardView.style.display = 'none';
            if (customerView) customerView.style.display = 'none';
            if (expensesView) expensesView.style.display = 'none';

            if (viewName === 'expenses') {
                if (expensesView) expensesView.style.display = 'block';
                // ÏÇ¨Ïù¥ÎìúÎ∞î ÏÑ†ÌÉù Ìï¥Ï†ú
                document.querySelectorAll('.customer-item').forEach(el => el.classList.remove('active'));
                renderExpensesTable();
            } else if (viewName === 'customer') {
                if (customerView) customerView.style.display = 'block';
            } else {
                // Default: Main Board
                if (mainBoardView) {
                    mainBoardView.style.display = 'block';
                    if (typeof renderMainBoard === 'function') renderMainBoard();
                }
            }
        }

        function renderExpensesTable() {
            const tbody = document.getElementById('expensesTableBody');
            if (!tbody) return;

            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Ïõî Í∞ÄÏ†∏Ïò§Í∏∞
            const monthFilter = document.getElementById('expenseMonthFilter');
            const selectedMonth = monthFilter?.value || new Date().toISOString().slice(0, 7);

            let fixedTotal = 0;
            let variableTotal = 0;
            let rows = [];

            // 1. ÌôúÏÑ±ÌôîÎêú Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™©ÏùÑ ÌñâÏúºÎ°ú Ï∂îÍ∞Ä (ÏùΩÍ∏∞ Ï†ÑÏö©)
            const activeFixed = fixedExpenseItems.filter(f => f.active);
            activeFixed.forEach((item, idx) => {
                const amt = parseNumber(item.amount);
                fixedTotal += amt;
                const detailText = item.detail || item.itemName || '-';
                rows.push(`
                    <tr style="border-bottom:1px solid #fcd34d; background:linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);">
                        <td style="text-align:center; padding:10px; color:#92400e; font-weight:600;">
                            ${idx + 1}
                        </td>
                        <td style="padding:8px;">
                            <span style="color:#92400e; font-size:12px;">${selectedMonth}-01</span>
                        </td>
                        <td style="padding:8px;">
                            <span style="background:#f59e0b; color:white; padding:2px 8px; border-radius:4px; font-size:11px; font-weight:600;">${item.category || '-'}</span>
                        </td>
                        <td style="padding:8px;">
                            <span style="color:#92400e; font-weight:600;">${detailText}</span>
                            <span style="font-size:10px; color:#d97706; margin-left:6px; background:#fef3c7; padding:2px 6px; border-radius:10px;">Í≥†Ï†ïÏßÄÏ∂ú</span>
                        </td>
                        <td style="padding:8px; text-align:right; font-weight:700; color:#92400e;">${formatNumber(amt)}</td>
                        <td style="padding:8px; color:#92400e;">${item.payMethod || '-'}</td>
                        <td style="padding:8px; color:#92400e;">${item.receipt || '-'}</td>
                        <td style="padding:8px; color:#92400e; font-size:11px;">Îß§Ïõî ÏûêÎèô Î∞òÏòÅ</td>
                    </tr>
                `);
            });

            // 2. Î≥ÄÎèôÏßÄÏ∂ú Ìï≠Î™© (ÏÑ†ÌÉùÎêú ÏõîÍ≥º ÏùºÏπòÌïòÎäî Í≤ÉÎßå)
            expensesRows.forEach((row, index) => {
                const rowMonth = (row.date || '').substring(0, 7);
                if (rowMonth !== selectedMonth && selectedMonth !== 'all') return;

                const amt = parseNumber(row.amount);
                variableTotal += amt;
                rows.push(`
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="text-align:center; padding:10px;">
                            <button onclick="removeExpenseRow(${index})" style="color:#ff3b30;border:none;background:none;cursor:pointer;">üóëÔ∏è</button>
                            ${activeFixed.length + index + 1}
                        </td>
                        <td style="padding:4px;"><input type="date" value="${row.date || ''}" onchange="updateExpenseRow(${index}, 'date', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;">
                            <select onchange="updateExpenseRow(${index}, 'category', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;">
                                <option value="">ÏÑ†ÌÉù</option>
                                ${EXPENSE_CATEGORIES.map(c => `<option value="${c}" ${c === row.category ? 'selected' : ''}>${c}</option>`).join('')}
                            </select>
                        </td>
                        <td style="padding:4px;"><input type="text" value="${row.detail || ''}" onchange="updateExpenseRow(${index}, 'detail', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${formatNumber(row.amount)}" onchange="updateExpenseRow(${index}, 'amount', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px; text-align:right;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.method || row.payMethod || ''}" onchange="updateExpenseRow(${index}, 'method', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.proof || row.receipt || ''}" onchange="updateExpenseRow(${index}, 'proof', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.note || row.memo || ''}" onchange="updateExpenseRow(${index}, 'note', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                    </tr>
                `);
            });

            tbody.innerHTML = rows.join('');

            // Ìï©Í≥Ñ ÌëúÏãú (Í≥†Ï†ï + Î≥ÄÎèô)
            const totalAmount = fixedTotal + variableTotal;
            const footer = document.getElementById('totalExpenseFooter');
            if (footer) {
                footer.innerHTML = `
                    <span style="font-size:12px; color:#64748b; margin-right:12px;">
                        Í≥†Ï†ï: ‚Ç©${formatNumber(fixedTotal)} / Î≥ÄÎèô: ‚Ç©${formatNumber(variableTotal)}
                    </span>
                    <span style="color:#dc2626; font-weight:700; font-size:16px;">‚Ç©${formatNumber(totalAmount)}</span>
                `;
            }
        }

        function addExpenseRow() {
            expensesRows.push({
                date: new Date().toISOString().split('T')[0],
                category: '',
                detail: '',
                amount: 0,
                method: '',
                proof: '',
                note: ''
            });
            renderExpensesTable();
            saveExpensesLocal();
        }

        function removeExpenseRow(index) {
            if (!confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            expensesRows.splice(index, 1);
            renderExpensesTable();
            saveExpensesLocal();
        }

        function updateExpenseRow(index, field, value) {
            if (field === 'amount') {
                // ÏΩ§Îßà Ï†úÍ±∞ ÌõÑ Ïà´Ïûê Ï†ÄÏû•
                value = parseNumber(value);
            }
            expensesRows[index][field] = value;
            if (field === 'amount') renderExpensesTable();
            saveExpensesLocal();
        }

        function saveExpensesLocal() {
            // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ
        }

        async function saveExpensesToCloud() {
            const btn = document.getElementById('btnSaveExpenses') || event?.target;
            const originalText = btn?.innerText || '‚òÅÔ∏è Ï†ÄÏû•ÌïòÍ∏∞';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Ï†ÄÏû• Ï§ë...';
                }

                const payload = {
                    action: 'updateExpenses',
                    expenses: expensesRows.map((row, idx) => ({
                        no: idx + 1,
                        date: row.date || '',
                        category: row.category || '',
                        detail: row.detail || '',
                        amount: parseNumber(row.amount),
                        payMethod: row.payMethod || row.method || '',
                        receipt: row.receipt || row.proof || '',
                        memo: row.memo || row.note || ''
                    }))
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    saveExpensesLocal(); // Î°úÏª¨ÏóêÎèÑ Ï†ÄÏû•
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    showToast(`Ï†ÄÏû• ÏôÑÎ£å ${timeStr}`, 'success');
                    logUserAction('Ï†ÄÏû•', 'Ïö¥ÏòÅÎπÑ ÏãúÌä∏ Ï†ÄÏû•');
                } else {
                    throw new Error(result.error || 'Ï†ÄÏû• Ïã§Ìå®');
                }
            } catch (err) {
                console.error('Ïö¥ÏòÅÎπÑ Ï†ÄÏû• Ïò§Î•ò:', err);
                showToast('Ï†ÄÏû• Ïã§Ìå®: ' + (err.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                saveExpensesLocal(); // Ïã§Ìå®Ìï¥ÎèÑ Î°úÏª¨ÏóêÎäî Ï†ÄÏû•
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        async function syncExpensesFromCloud() {
            const btn = document.getElementById('btnLoadExpenses') || event?.target;
            const originalText = btn?.innerText || 'üîÑ Î∂àÎü¨Ïò§Í∏∞';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Î∂àÎü¨Ïò§Îäî Ï§ë...';
                }

                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=expenses`);
                const result = await response.json();

                console.log('[Ïö¥ÏòÅÎπÑ Î∂àÎü¨Ïò§Í∏∞] API ÏùëÎãµ:', result);

                if (result.result === 'success') {
                    let loadedCount = 0;

                    // Î≥ÄÎèô Ïö¥ÏòÅÎπÑ Î∂àÎü¨Ïò§Í∏∞
                    if (result.expenses && result.expenses.length > 0) {
                        expensesRows = result.expenses.map(exp => ({
                            date: exp.date || '',
                            category: exp.category || '',
                            detail: exp.detail || '',
                            amount: exp.amount || 0,
                            method: exp.payMethod || '',
                            proof: exp.receipt || '',
                            note: exp.memo || ''
                        }));
                        saveExpensesLocal();
                        loadedCount = result.expenses.length;
                    }

                    // Í≥†Ï†ïÏßÄÏ∂ú ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
                    if (result.fixedExpenses && result.fixedExpenses.length > 0) {
                        fixedExpenseItems = result.fixedExpenses.map(f => ({
                            category: f.category || '',
                            detail: f.detail || f.itemName || '',
                            amount: f.amount || 0,
                            payMethod: f.payMethod || '',
                            receipt: f.receipt || '',
                            active: f.active !== false
                        }));
                        // Phase 2: ÏóÖÎ¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÏª¨ Ï†ÄÏû• Í∏àÏßÄ

                    }

                    renderExpensesTable();
                    renderFixedExpenseTable();

                    const fixedCount = result.fixedExpenses?.length || 0;
                    if (loadedCount > 0 || fixedCount > 0) {
                        showToast(`Ïö¥ÏòÅÎπÑ ${loadedCount}Í±¥, Í≥†Ï†ïÏßÄÏ∂ú ${fixedCount}Í±¥ Î∂àÎü¨Ïò¥`, 'success');
                        logUserAction('Î∂àÎü¨Ïò§Í∏∞', 'Ïö¥ÏòÅÎπÑ ÏãúÌä∏ Î∂àÎü¨Ïò§Í∏∞');
                    } else {
                        showToast('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                    }
                    return true;
                } else {
                    throw new Error(result.error || 'Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®');
                }
            } catch (err) {
                console.error('Ïö¥ÏòÅÎπÑ Î∂àÎü¨Ïò§Í∏∞ Ïò§Î•ò:', err);
                console.error('API URL:', `${CUSTOMER_SYNC_URL}?sheet=expenses`);
                showToast('Ïö¥ÏòÅÎπÑ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + err.message, 'error');
                return false;
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }


        function switchStatsTab(tabName) {
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.stats-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'white';
                btn.style.color = '#888';
            });
            const activeBtn = document.getElementById('tab-' + tabName);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = '#f5f5f7';
                activeBtn.style.color = '#333';
            }

            // Î∑∞ Ï†ÑÌôò
            document.querySelectorAll('.stats-view-content').forEach(view => view.style.display = 'none');
            const targetView = document.getElementById('view-stats-' + tabName);
            if (targetView) {
                targetView.style.display = 'block';
            }

            // Ï∞®Ìä∏ ÌÅ¨Í∏∞ Í∞ïÏ†ú Ïû¨Ï°∞Ï†ï
            if (typeof Chart !== 'undefined') {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') chart.resize();
                });
            }
        }

    </script>
    <script>
        // [Ï∂îÍ∞Ä] ÌÉ≠ Ï†ÑÌôò Í∞êÏßÄ Î∞è ÏûëÏóÖÍ∏∞Î°ù Í∞±Ïã† (MutationObserver)
        document.addEventListener('DOMContentLoaded', () => {
            const statsPanel = document.getElementById('panel-stats');
            if (statsPanel) {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'class') {
                            if (statsPanel.classList.contains('active')) {
                                renderActionLog();
                            }
                        }
                        if (mutation.attributeName === 'style') {
                            if (statsPanel.style.display === 'block' && statsPanel.style.display !== 'none') {
                                renderActionLog();
                            }
                        }
                    });
                });
                observer.observe(statsPanel, { attributes: true });
            }
        });
    </script>



    <script>


        // [Task 3] Stability Logic
        let isAppBusy = false;
        function setAppBusy(busy, message = 'Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë...') {
            isAppBusy = busy;
            let overlay = document.getElementById('globalLoadingOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'globalLoadingOverlay';
                overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:99999; flex-direction:column; justify-content:center; align-items:center;';
                overlay.innerHTML = '<div style="width:50px; height:50px; border:5px solid #f3f3f3; border-top:5px solid #3498db; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:15px;"></div><div id="loadingMessage" style="font-size:18px; font-weight:600; color:#333;">Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë...</div><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>';
                document.body.appendChild(overlay);
            }
            const msgEl = overlay.querySelector('#loadingMessage');
            if (msgEl) msgEl.textContent = message;
            overlay.style.display = busy ? 'flex' : 'none';
            document.body.style.pointerEvents = busy ? 'none' : 'auto';
            if (overlay) overlay.style.pointerEvents = 'auto';
        }
    </script>
    <script>
        // PWA Service Worker Îì±Î°ù
        // PWA Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // ==========================================
        // [New] ÎÖ∏ÏÖò Í≥†Í∞ù Í≥µÏú† URL ÏÉùÏÑ±
        // ==========================================
        function openNotionShareModal() {
            if (!currentData || !currentData.customerId) {
                showToast('Í≥†Í∞ùÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            // Modal HTML Injection (Lazy Load)
            if (!document.getElementById('notionShareModal')) {
                const modalHtml = `
                <div id="notionShareModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center;">
                    <div class="modal-content" style="background:#fff; border-radius:16px; width:90%; max-width:500px; max-height:80vh; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.2);">
                        <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:18px; font-weight:700;">üìã ÎÖ∏ÏÖò Í≥†Í∞ù Í≥µÏú†</h3>
                            <button onclick="document.getElementById('notionShareModal').style.display='none'" style="background:#f0f0f0; border:none; width:32px; height:32px; border-radius:50%; font-size:20px; cursor:pointer;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <label style="font-weight:600; font-size:14px; display:block; margin-bottom:8px;">ÎÖ∏ÏÖò Í≥µÏú† URL</label>
                            <input type="text" id="notionShareUrlInput" placeholder="https://notion.site/..." style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;">
                            <p style="font-size:12px; color:#666; margin-top:8px;">ÎÖ∏ÏÖò ÌéòÏù¥ÏßÄÏùò Í≥µÏú† URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
                        </div>
                        <div style="padding:20px; border-top:1px solid #eee; display:flex; gap:10px; justify-content:flex-end;">
                            <button onclick="document.getElementById('notionShareModal').style.display='none'" style="padding:10px 20px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;">Ï∑®ÏÜå</button>
                            <button onclick="generateNotionShareMessage()" style="padding:10px 20px; border:none; background:linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color:#fff; border-radius:8px; cursor:pointer; font-weight:600;">ÏÉùÏÑ±ÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
                <div id="notionShareResultModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10001; justify-content:center; align-items:center;">
                    <div class="modal-content" style="background:#fff; border-radius:16px; width:90%; max-width:600px; max-height:80vh; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.2);">
                        <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:18px; font-weight:700;">üìã Ïπ¥Ïπ¥Ïò§ÌÜ° Í≥µÏú† Î©îÏãúÏßÄ</h3>
                            <button onclick="document.getElementById('notionShareResultModal').style.display='none'" style="background:#f0f0f0; border:none; width:32px; height:32px; border-radius:50%; font-size:20px; cursor:pointer;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <textarea id="notionShareResultText" readonly style="width:100%; height:300px; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:13px; line-height:1.6; resize:none; box-sizing:border-box; font-family:'Noto Sans KR', sans-serif;"></textarea>
                        </div>
                        <div style="padding:20px; border-top:1px solid #eee; display:flex; gap:10px; justify-content:flex-end;">
                            <button onclick="document.getElementById('notionShareResultModal').style.display='none'" style="padding:10px 20px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;">Îã´Í∏∞</button>
                            <button onclick="copyNotionShareMessage()" style="padding:10px 20px; border:none; background:linear-gradient(135deg, #34c759 0%, #2da44e 100%); color:#fff; border-radius:8px; cursor:pointer; font-weight:600;">üìã Î≥µÏÇ¨ÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>`;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            document.getElementById('notionShareUrlInput').value = '';
            document.getElementById('notionShareModal').style.display = 'flex';
        }

        function generateNotionShareMessage() {
            const notionUrl = document.getElementById('notionShareUrlInput').value.trim();
            if (!notionUrl) {
                showToast('ÎÖ∏ÏÖò URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }

            // Í≥†Í∞ù Ï†ïÎ≥¥ ÏàòÏßë
            const customerName = currentData.customerName || '';
            const customerPhone = currentData.phone || '';
            const spouseName = currentData.spouseName || '';
            const spousePhone = currentData.spousePhone || '';
            const siteAddress = currentData.siteAddress || '';
            const constructionStart = currentData.constructionStart || '';
            const constructionEnd = currentData.constructionEnd || '';
            const movingDate = currentData.movingDate || '';
            const gatePw = currentData.gatePw || '';
            const doorPw = currentData.doorPw || '';

            // Í≥†Í∞ùÎ™Ö ÌëúÏãú ÌòïÏãù: ÏÑ±Î™Ö(Ïó∞ÎùΩÏ≤ò) | Î∞∞Ïö∞Ïûê ÏÑ±Î™Ö(Î∞∞Ïö∞Ïûê Ïó∞ÎùΩÏ≤ò)
            let customerDisplayStr = customerName;
            if (customerPhone) customerDisplayStr += `(${customerPhone})`;
            if (spouseName) {
                customerDisplayStr += ` | ${spouseName}`;
                if (spousePhone) customerDisplayStr += `(${spousePhone})`;
            }

            // Í≥µÏÇ¨Í∏∞Í∞Ñ ÌëúÏãú
            let periodStr = '';
            if (constructionStart && constructionEnd) {
                periodStr = `${constructionStart} ~ ${constructionEnd}`;
            } else if (constructionStart) {
                periodStr = constructionStart;
            }

            // ÌîÑÎ°ùÏãú URL ÏÉùÏÑ±
            const encodedName = encodeURIComponent(customerName);
            const encodedUrl = encodeURIComponent(notionUrl);
            const proxyUrl = `https://www.designjig.com/api/notion?name=${encodedName}&url=${encodedUrl}`;

            // ÌòÑÏû• Îã¥ÎãπÏûê Ï†ïÎ≥¥
            const managerInput = document.querySelector('input[data-field="manager"]');
            const projectManager = managerInput ? managerInput.value : (currentData.manager || 'ÏõêÌîÑÎ°ú ÏÜåÏû• (010-7653-5386)');

            // Î©îÏãúÏßÄ ÏÉùÏÑ±
            let message = `ÏïàÎÖïÌïòÏÑ∏Ïöî. ÎîîÏûêÏù∏ÏßÄÍ∑∏ÏûÖÎãàÎã§.\n\n`;
            message += `Í≥µÏÇ¨ ÏßÑÌñâÍ≥º Í¥ÄÎ†®ÌïòÏó¨ ÏïÑÎûò ÎÇ¥Ïö© ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.\n`;
            message += `Í≥µÏÇ¨ Í∏∞Í∞Ñ Ï§ë ÌïÑÏöîÌïòÏã§ Îïå Ïñ∏Ï†úÎì† Îã§Ïãú ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `üìå Í∏∞Î≥∏ ÌòÑÏû• Ï†ïÎ≥¥\n\n`;
            message += `‚Ä¢ Í≥†Í∞ùÎ™Ö : ${customerDisplayStr}\n`;
            message += `‚Ä¢ ÌòÑÏû•Ï£ºÏÜå : ${siteAddress}\n`;
            message += `‚Ä¢ Í≥µÏÇ¨Í∏∞Í∞Ñ : ${periodStr}\n`;
            message += `‚Ä¢ ÎπÑÎ∞ÄÎ≤àÌò∏\n`;
            message += `  - Í≥µÎèôÌòÑÍ¥Ä : ${gatePw || 'ÏóÜÏùå'}\n`;
            message += `  - ÏÑ∏ÎåÄÌòÑÍ¥Ä : ${doorPw || 'ÏóÜÏùå'}\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `üë∑ ÌòÑÏû• Îã¥ÎãπÏûê\n\n`;
            message += `‚Ä¢ ÌòÑÏû•ÏÜåÏû• : ${projectManager}\n`;
            message += `‚Ä¢ Ïó∞ÎùΩÍ∞ÄÎä• : ÌèâÏùº 09:00~17:00\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `üìã Í≥µÏÇ¨ ÏïàÎÇ¥Î¨∏ (ÎÖ∏ÏÖò)\n\n`;
            message += `Í≥µÏÇ¨ Ïä§ÏºÄÏ§Ñ / Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ / ÏûêÏû¨ Ï†ïÎ≥¥ / A/S / FAQ ÏïàÎÇ¥Î•º\n`;
            message += `Ìïú Î≤àÏóê ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.\n\n`;
            message += `üëâ Î∞îÎ°úÍ∞ÄÍ∏∞\n${proxyUrl}\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `üè† ÎîîÏûêÏù∏ÏßÄÍ∑∏ Í≥µÏãù Ï±ÑÎÑê\n\n`;
            message += `‚Ä¢ ÌôàÌéòÏù¥ÏßÄ\nhttps://www.designjig.com\n\n`;
            message += `‚Ä¢ Î∏îÎ°úÍ∑∏\nhttps://blog.naver.com/sweet00700\n\n`;
            message += `‚Ä¢ Ïπ¥Ìéò\nhttps://cafe.naver.com/supermanhome\n\n`;
            message += `‚Ä¢ Ïù∏Ïä§ÌÉÄÍ∑∏Îû®\nhttps://www.instagram.com/design__jig\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `Î¨∏ÏùòÏÇ¨Ìï≠ÏùÄ Ïñ∏Ï†úÎì† Ìé∏ÌïòÍ≤å Ïó∞ÎùΩ Ï£ºÏÑ∏Ïöî.\n`;
            message += `Í≥µÏÇ¨ ÏßÑÌñâ Ï§ëÏóêÎèÑ ÏßÄÏÜçÏ†ÅÏúºÎ°ú ÏïàÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.\n`;
            message += `Í∞êÏÇ¨Ìï©ÎãàÎã§.\n\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `ÎîîÏûêÏù∏ÏßÄÍ∑∏\n`;
            message += `ÌôîÎ†§Ìï®Î≥¥Îã§ Î≥∏ÏßàÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.\n`;
            message += `Pro. Beyond.`;

            document.getElementById('notionShareResultText').value = message;
            document.getElementById('notionShareModal').style.display = 'none';
            document.getElementById('notionShareResultModal').style.display = 'flex';
        }

        function copyNotionShareMessage() {
            const text = document.getElementById('notionShareResultText').value;
            navigator.clipboard.writeText(text).then(() => {
                showToast('üìã Î©îÏãúÏßÄÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success');
            }).catch(err => {
                showToast('Î≥µÏÇ¨ Ïã§Ìå®: ' + err.message, 'error');
            });
        }

        // ==========================================
        // [New] Schedule Message Generation
        // ==========================================
        function openScheduleMessageModal() {
            if (!scheduleRows || scheduleRows.length === 0) {
                showToast('ÏÉùÏÑ±Ìï† Ïä§ÏºÄÏ§Ñ Î©îÏãúÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }

            // Modal HTML Injection (Lazy Load)
            if (!document.getElementById('messageModal')) {
                const modalHtml = `
            <div id="messageModal" class="modal-overlay" style="display:none; z-index: 10000; justify-content: center; align-items: center;">
                <div class="modal-content" style="width: 95%; max-width: 1600px; height: 85vh; display: flex; flex-direction: column; padding: 0; overflow: hidden; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff;">
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 700;">Ïä§ÏºÄÏ§Ñ Î¨∏Ïûê Î≥¥ÎÇ¥Í∏∞</h3>
                            <span style="font-size: 13px; color: #666; margin-top: 4px; display:block;">Ï¥ù <span id="msgTotalCount" style="color:#000; font-weight:600;">0</span>Î™ÖÏùò Îã¥ÎãπÏûêÏóêÍ≤å Î≥¥ÎÇº Î©îÏãúÏßÄÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.</span>
                        </div>
                        <button onclick="document.getElementById('messageModal').style.display='none'" style="background: #f0f0f0; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer; display:flex; align-items:center; justify-content:center;">&times;</button>
                    </div>
                    <div id="messageList" style="padding: 24px; overflow-y: auto; background: #f5f5f7; flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; align-content: start;">
                        <!-- Message Cards will be injected here -->
                    </div>
                    <div style="padding: 14px; font-size: 13px; color: #666; text-align: center; background: #fff; border-top: 1px solid #eee; display:flex; justify-content:center; align-items:center; gap:6px;">
                        <span>üí° Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÎÇ¥Ïö©Ïù¥ Î≥µÏÇ¨Îê©ÎãàÎã§.</span>
                    </div>
                </div>
            </div>
        `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            const messageList = document.getElementById('messageList');
            const messages = generateScheduleMessages();

            // Update Total Count
            const countEl = document.getElementById('msgTotalCount');
            if (countEl) countEl.textContent = messages.length;

            if (messages.length === 0) {
                messageList.innerHTML = '<div style="grid-column: 1 / -1; width:100%; display:flex; justify-content:center; align-items:center; color:#999; flex-direction:column; padding: 40px;"><span style="font-size:48px; margin-bottom:16px;">üì≠</span><span>Îã¥ÎãπÏûêÍ∞Ä ÏßÄÏ†ïÎêú Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§.</span></div>';
            } else {
                messageList.innerHTML = messages.map(msg => {
                    const isSent = msg.isSent;
                    const cardClass = isSent ? 'message-card copied-card' : 'message-card';
                    const cardStyle = isSent
                        ? 'display: flex; flex-direction: column; background: #f1f8e9; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; outline: 2px solid #4cd964; position: relative; overflow: hidden; height: 100%;'
                        : 'display: flex; flex-direction: column; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; outline: 1px solid transparent; position: relative; overflow: hidden; height: 100%;';
                    const badgeStyle = isSent
                        ? 'font-size: 11px; background: #4cd964; color: #fff; padding: 4px 10px; border-radius: 20px; font-weight: 600; flex-shrink: 0;'
                        : 'font-size: 11px; background: #e8f5e9; color: #2e7d32; padding: 4px 10px; border-radius: 20px; font-weight: 600; flex-shrink: 0;';
                    const badgeText = isSent ? 'Î≥µÏÇ¨ÏôÑÎ£å' : 'Î≥µÏÇ¨ÌïòÍ∏∞';

                    return `
            <div class="${cardClass}" onclick="copyMessageToClipboard(this)" 
                data-copytext="${msg.fullText.replace(/"/g, '&quot;')}" 
                data-manager="${msg.manager.replace(/"/g, '&quot;')}"
                style="${cardStyle}">
                
                <div style="padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; background: #fff;">
                    <span style="font-weight: 700; font-size: 16px; color:#1d1d1f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%;">${msg.cardTitle} <span style="font-size:13px; color:#86868b; font-weight:400;">(${msg.count}Í±¥)</span></span>
                    <span class="copy-badge" style="${badgeStyle}">${badgeText}</span>
                </div>
                
                <div style="flex: 1; padding: 0; overflow-y: auto; background: #fafafa; min-height: 300px;">
                    <div style="font-size: 13px; color: #333; line-height: 1.6; white-space: pre-wrap; padding: 20px; font-family: 'Menlo', 'Monaco', 'Courier New', monospace;">${msg.previewText}</div>
                </div>

                <div class="hover-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.02); opacity: 0; transition: opacity 0.2s; pointer-events: none;"></div>
            </div>
        `;
                }).join('');
            }

            // Modal Styling Fix (ensure flex display)
            const modal = document.getElementById('messageModal');
            modal.style.display = 'flex';
        }

        function generateScheduleMessages() {
            const grouped = {};

            scheduleRows.forEach(row => {
                if (!row.inCharge || !row.start) return;
                const manager = row.inCharge.trim();
                if (!grouped[manager]) {
                    grouped[manager] = {
                        rows: [],
                        startDates: [],
                        endDates: []
                    };
                }
                grouped[manager].rows.push(row);
                grouped[manager].startDates.push(new Date(row.start));
                if (row.end) grouped[manager].endDates.push(new Date(row.end));
                else grouped[manager].endDates.push(new Date(row.start));
            });

            const results = [];
            const siteAddress = currentData.siteAddress || 'Ï£ºÏÜå ÎØ∏ÏûÖÎ†•';

            const gatePwInput = document.querySelector('input[data-field="gatePw"]');
            const doorPwInput = document.querySelector('input[data-field="doorPw"]');
            const gatePw = gatePwInput ? gatePwInput.value : (currentData.gatePw || '');
            const doorPw = doorPwInput ? doorPwInput.value : (currentData.doorPw || '');

            const managerInput = document.querySelector('input[data-field="manager"]');
            const projectManager = managerInput ? managerInput.value : (currentData.manager || 'ÏõêÌîÑÎ°ú (010-7653-5386)');

            Object.keys(grouped).forEach(manager => {
                const data = grouped[manager];

                // Sort rows by start date to find the earliest process
                data.rows.sort((a, b) => new Date(a.start) - new Date(b.start));

                // Determine Title
                const earliestProcessName = data.rows[0].name;
                const managerNameOnly = manager.split('(')[0].trim();
                const cardTitle = `${earliestProcessName} - ${managerNameOnly}`;

                // Calculate Overall Range
                const minStart = new Date(Math.min(...data.startDates)).toISOString().split('T')[0];
                const maxEnd = new Date(Math.max(...data.endDates)).toISOString().split('T')[0];

                // Date Logic
                const dateRangeDisplay = (minStart === maxEnd) ? minStart : `${minStart} ~ ${maxEnd}`;

                // Build Process List
                let processSection = "";
                if (data.rows.length > 1) {
                    const processList = data.rows.map(r => {
                        const rStart = r.start;
                        const rEnd = r.end || r.start;
                        const rRange = (rStart === rEnd) ? rStart : `${rStart} ~ ${rEnd}`;
                        return `- ${r.name} : ${rRange}`;
                    }).join('\n');
                    processSection = `\n‚ñ† Í≥µÏ†ï ÏùºÏ†ï\n${processList}\n`;
                }

                const managerName = managerNameOnly;

                // Determine 'sent' status
                const isSent = data.rows.some(r => r.messageSent === true);

                const fullText = `ÏïàÎÖïÌïòÏÑ∏Ïöî.
ÎîîÏûêÏù∏ÏßÄÍ∑∏ÏûÖÎãàÎã§.
ÌòÑÏû• ÏùºÏ†ï Î∞è ÎÇ¥Ïö©ÏùÑ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.
**ÏùºÏ†ï ÌôïÏù∏ ÌõÑ Î∞òÎìúÏãú ÌöåÏã† Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.**

‚ñ† ÏùºÏ†ï
- ${dateRangeDisplay}
${processSection}
‚ñ† ÌòÑÏû• Ï£ºÏÜå
- ${siteAddress}

‚ñ† Ï∂úÏûÖ ÎπÑÎ∞ÄÎ≤àÌò∏
- Í≥µÎèô Ï∂úÏûÖÎ¨∏ : ${gatePw}
- ÏÑ∏ÎåÄ ÎπÑÎ∞ÄÎ≤àÌò∏ : ${doorPw}

‚ñ† Í≥µÏÇ¨ Îã¥ÎãπÏûê
- ${projectManager}

‚ñ† ÌòÑÏû• ÏïàÎÇ¥ÏÇ¨Ìï≠
1. ÏÑ∏ÎåÄ ÎÇ¥ Ìù°Ïó∞ Í∏àÏßÄ
2. ÏûëÏóÖÏãúÍ∞Ñ Ï§ÄÏàò
3. ÏûëÏóÖ ÌõÑ Ï†ïÎ¶¨Ï†ïÎèà
4. Ï∞ΩÎ¨∏¬∑Ï∂úÏûÖÎ¨∏ Î¨∏Îã®ÏÜç ÌïÑÏàò

Í∞êÏÇ¨Ìï©ÎãàÎã§.
ÎîîÏûêÏù∏ÏßÄÍ∑∏ ÎìúÎ¶º.

ÎîîÏûêÏù∏ÏßÄÍ∑∏Îäî ÌôîÎ†§Ìï®Î≥¥Îã§ Î≥∏ÏßàÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.
ÌòÑÏû•Ïù¥ Ìé∏Ìï¥Ïïº Í≤∞Í≥ºÎèÑ Ï¢ãÏïÑÏßÑÎã§Í≥† ÎØøÏäµÎãàÎã§.
ÎîîÏûêÏù∏ÏßÄÍ∑∏Îäî Í∞êÏù¥ ÏïÑÎãå Í∏∞Ï§ÄÏúºÎ°ú ÏùºÌï©ÎãàÎã§.`;

                results.push({
                    cardTitle: cardTitle,
                    manager: manager,
                    fullText: fullText,
                    previewText: fullText,
                    count: data.rows.length,
                    isSent: isSent // [New] Pass sent status to UI
                });
            });

            return results;
        }

        function copyMessageToClipboard(element) {
            // Toggle Logic
            if (element.classList.contains('copied-card')) {
                // If already copied/active, revert to normal
                element.classList.remove('copied-card');
                element.style.backgroundColor = '#fff';
                element.style.outline = '1px solid transparent';

                const badge = element.querySelector('.copy-badge');
                if (badge) {
                    badge.style.backgroundColor = '#e8f5e9';
                    badge.style.color = '#2e7d32';
                    badge.textContent = 'Î≥µÏÇ¨ÌïòÍ∏∞';
                }
                return; // Stop here, do not copy again
            }

            // Normal State -> Copy & Activate
            const text = element.getAttribute('data-copytext');
            navigator.clipboard.writeText(text).then(() => {
                showToast('Î¨∏ÏûêÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.', 'success');

                // Visual Feedback: Active State (Green)
                element.classList.add('copied-card');
                element.style.backgroundColor = '#f1f8e9'; // Light Green Background
                element.style.outline = '2px solid #4cd964'; // Green Outline

                const badge = element.querySelector('.copy-badge');
                if (badge) {
                    badge.style.backgroundColor = '#4cd964';
                    badge.style.color = '#fff';
                    badge.textContent = 'Î≥µÏÇ¨ÏôÑÎ£å';
                }

                // [New] Update Schedule Rows marked as sent
                const manager = element.getAttribute('data-manager');
                if (manager) {
                    let updateCount = 0;
                    scheduleRows.forEach(row => {
                        if (row.inCharge && row.inCharge.trim() === manager) {
                            row.messageSent = true;
                            row.messageSentAt = new Date().toISOString();
                            updateCount++;
                        }
                    });
                    if (updateCount > 0) {
                        saveScheduleToCustomer(); // Persist to currentData in memory
                        console.log(`[Schedule] Marked ${updateCount} rows as sent for manager: ${manager}`);
                    }

                    // [New] Log to Notion Share Sheet (Backend)
                    // Î©îÏãúÏßÄ Î≥µÏÇ¨ Ïãú ÏûêÎèôÏúºÎ°ú ÏãúÌä∏Ïóê Ï†ÄÏû•
                    fetch(CUSTOMER_SYNC_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'logNotionShare',
                            customerId: currentData.customerId,
                            message: text,
                            manager: manager
                        })
                    }).then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                console.log('Message logged to sheet:', data);
                                showToast('Î©îÏãúÏßÄÍ∞Ä ÏãúÌä∏Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
                            } else {
                                console.error('Failed to log message:', data.error);
                            }
                        })
                        .catch(err => console.error('Error logging message:', err));
                }

            }).catch(err => {
                console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                showToast('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            });
        }
    </script>
    <script>
        // ÎîîÎ≤ÑÍπÖÏö© Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä
        const originalShowToast = window.showToast;
        window.showToast = function (message, type, duration) {
            console.log('showToast Ìò∏Ï∂ú:', { message, type, duration });
            if (originalShowToast) originalShowToast(message, type, duration);
        };

        document.addEventListener('submit', function (e) {
            console.log('Ìèº Ï†úÏ∂ú Í∞êÏßÄ:', e.target);
            // e.preventDefault(); // ÎîîÎ≤ÑÍπÖÏö©: Ï†úÏ∂ú ÎßâÍ∏∞ (ÌïÑÏöîÏãú Ï£ºÏÑù Ìï¥Ï†ú)
        });
    </script>
</body>

</html>