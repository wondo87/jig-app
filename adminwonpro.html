<!DOCTYPE html>
<!-- Deployed: 2026-02-07 17:55 - Fix specific deployment issue -->
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ìì¸ì§€ê·¸ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png?v=final_orig_file">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png?v=final_orig_file">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png?v=final_orig_file">
    <meta name="theme-color" content="#1d1d1f">
    <!-- Cache Version: dz-admin-v1.2.0 (2026-02-10) -->
    <script>
        console.log('ğŸš€ [System] Version: v1.2.0 (2026-02-10)');
        // CORS mitigation for file:// protocol
        if (window.location.protocol === 'file:') {
            console.warn('âš ï¸ [System] Local file protocol detected. Some features (Manifest, SW) are disabled to prevent CORS errors.');
        } else {
            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = 'manifest.json?v=final_orig_file';
            document.head.appendChild(link);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"
        onerror="console.warn('Cloudinary widget failed to load')"></script>
    <!-- í™˜ê²½ ì„¤ì • íŒŒì¼ ë¡œë“œ (ë¹„ë°€ë²ˆí˜¸ ë“±) -->
    <script src="admin_config.js?v=20260130"></script>

    <script>
        (function () {
            // í˜ì´ì§€ëŠ” ì—´ëŒ ëª¨ë“œë¡œ ë³¼ ìˆ˜ ìˆìŒ
            // ê´€ë¦¬ì ë¡œê·¸ì¸ì€ í—¤ë”ì˜ ë¡œê·¸ì¸ ë²„íŠ¼ í†µí•´ ì§„í–‰
            sessionStorage.setItem('DJ_admin_page_auth', 'true');

            // [Mobile Redirect]
            // ëª¨ë°”ì¼ ê¸°ê¸°ë¡œ ì ‘ì† ì‹œ ëª¨ë°”ì¼ ì „ìš© í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë‹¨, ?desktop=true íŒŒë¼ë¯¸í„°ê°€ ì—†ì„ ê²½ìš°)
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const urlParams = new URLSearchParams(window.location.search);
            const isDesktopMode = urlParams.get('desktop') === 'true';

            if (isMobile && !isDesktopMode && window.innerWidth <= 768) {
                const currentPath = window.location.pathname;
                // Vercelì—ì„œ /adminwonpro ê²½ë¡œë¡œ ì ‘ê·¼ ì‹œì—ë„ ë¦¬ë‹¤ì´ë ‰íŠ¸
                if (currentPath.endsWith('adminwonpro.html') || currentPath.endsWith('adminwonpro') || currentPath === '/') {
                    // ë£¨íŠ¸ ê²½ë¡œì¸ ê²½ìš°, ë©”ì¸ í˜ì´ì§€ê°€ adminwonproë¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ìƒí™©ì— ë”°ë¼ ë‹¤ë¦„)
                    // ì—¬ê¸°ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ adminwonpro ê´€ë ¨ ì ‘ê·¼ë§Œ ì²˜ë¦¬
                }

                // ë” ê°•ë ¥í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¡°ê±´: í˜„ì¬ íŒŒì¼ì´ ë°ìŠ¤í¬íƒ‘ ë·°ì¸ë° ëª¨ë°”ì¼ í™˜ê²½ì´ë©´ ë¬´ì¡°ê±´ ì´ë™
                window.location.href = 'adminwonpro_mobile.html' + window.location.search;
            }
        })();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --font-size-base: 12px;
            --font-size-xs: calc(var(--font-size-base) * 0.75);
            --font-size-sm: calc(var(--font-size-base) * 0.85);
            --font-size-md: var(--font-size-base);
            --font-size-lg: calc(var(--font-size-base) * 1.15);
            --font-size-xl: calc(var(--font-size-base) * 1.35);
            --font-size-2xl: calc(var(--font-size-base) * 1.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            /* ê³ ì • í—¤ë” ë†’ì´ë§Œí¼ ìƒë‹¨ ì—¬ë°± ì¶”ê°€. í—¤ë” ë†’ì´(ì•½ 56px) + ì—¬ìœ  */
            padding-top: 56px;
        }

        /* Vercel Toolbar ìˆ¨ê¹€ */
        #__next-build-watcher,
        [data-vercel-toolbar],
        [class*="vercel-toolbar"],
        [id*="vercel-toolbar"] {
            display: none !important;
        }

        /* âš™ï¸ ì„¤ì • ë“œë¡­ë‹¤ìš´ íŒ¨ë„ */
        .settings-toggle-btn {
            background: rgba(255, 255, 255, 0.12);
            border: none;
            color: #fff;
            font-size: 16px;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .settings-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.22);
        }

        .settings-panel {
            display: none !important;
            visibility: hidden;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 6px;
            background: #1d1d1f;
            border-radius: 12px;
            padding: 14px 16px;
            min-width: 260px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 9999;
        }

        .settings-panel.show {
            display: block !important;
            visibility: visible;
        }

        .settings-panel .sp-title {
            color: #86868b;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .settings-panel .sp-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .settings-panel .sp-row label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            min-width: 36px;
            white-space: nowrap;
        }

        .settings-panel .sp-row input[type="range"] {
            flex: 1;
            height: 3px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .settings-panel .sp-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #0071e3;
            border-radius: 50%;
            cursor: pointer;
        }

        .settings-panel .sp-val {
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            min-width: 28px;
            text-align: right;
        }

        .settings-panel .sp-divider {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 10px 0;
        }

        .settings-panel .sp-format-row {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .settings-panel .sp-format-row button {
            border: none;
            background: rgba(255, 255, 255, 0.08);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            line-height: 1;
            transition: background 0.15s;
        }

        .settings-panel .sp-format-row button:hover {
            background: rgba(255, 255, 255, 0.18);
        }

        .fmt-bold {
            color: #fff !important;
            font-weight: 900 !important;
        }

        .fmt-red {
            color: #ff3b30 !important;
        }

        .fmt-blue {
            color: #007aff !important;
        }

        .fmt-orange {
            color: #ff9500 !important;
        }

        .fmt-underline {
            color: #fff !important;
            text-decoration: underline !important;
        }

        .fmt-strike {
            color: #fff !important;
            text-decoration: line-through !important;
        }

        .fmt-italic {
            color: #fff !important;
            font-style: italic !important;
        }

        .fmt-black {
            color: #000 !important;
            background: #fff !important;
            border: 1px solid #999 !important;
        }

        .fmt-clear {
            color: #ff3b30 !important;
            font-weight: bold;
        }

        /* í…ìŠ¤íŠ¸ ì„œì‹ í”Œë¡œíŒ… íˆ´ë°” (ë“œë˜ê·¸ ì„ íƒ ì‹œ) */
        .text-format-toolbar {
            display: none;
            visibility: hidden;
            position: fixed;
            background: #1d1d1f;
            border-radius: 8px;
            padding: 4px 6px;
            gap: 2px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            align-items: center;
        }

        .text-format-toolbar.show {
            display: flex;
            visibility: visible;
        }

        .text-format-toolbar button {
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 700;
            line-height: 1;
            transition: background 0.15s;
        }

        .text-format-toolbar button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1d1d1f;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            z-index: 9999;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: #34c759;
        }

        .toast.error {
            background: #ff3b30;
        }

        .toast.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.85;
                transform: scale(1.02);
            }
        }

        /* í—¤ë” */
        .main-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
            padding: 12px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 12px;
        }

        .logo-text {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }

        .logo-text span {
            color: #86868b;
            font-weight: 400;
            font-size: 11px;
            margin-left: 6px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 7px 14px;
            border-radius: 6px;
            border: none;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-btn.primary {
            background: #0071e3;
            color: #fff;
        }

        .header-btn.primary:hover {
            background: #0077ed;
        }

        .header-btn.warning {
            background: #ff9500;
            color: #fff;
        }

        .header-btn.warning:hover {
            background: #ffaa33;
        }

        .header-btn.secondary {
            background: #424245;
            color: #fff;
        }

        .header-btn.secondary:hover {
            background: #525255;
        }

        /* ê´€ë¦¬ì ëª¨ë“œ */
        .admin-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 12px;
        }

        .admin-badge.admin {
            background: linear-gradient(135deg, #ff9500, #ff6b00);
            color: #fff;
        }

        .admin-badge.viewer {
            background: #e8e8ed;
            color: #86868b;
        }

        .admin-login-btn {
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-login-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* ëª¨ë°”ì¼ PWA ìµœì í™” */
        @media (max-width: 768px) {
            body {
                padding-top: calc(56px + env(safe-area-inset-top));
                padding-bottom: env(safe-area-inset-bottom);
            }

            .main-header {
                padding: 12px 16px;
                padding-top: calc(12px + env(safe-area-inset-top));
            }

            /* ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ 44px ì´ìƒ í™•ë³´ */
            button,
            .header-btn,
            .tab-btn {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
            }

            /* í…Œì´ë¸” ê°€ë¡œ ìŠ¤í¬ë¡¤ */
            .tab-content,
            .table-container,
            .data-table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
            }

            table {
                min-width: 800px;
            }

            /* Toast ìœ„ì¹˜ ì¡°ì • (Safe Area) */
            .toast {
                top: calc(20px + env(safe-area-inset-top));
                left: 20px;
                right: 20px;
                width: auto;
                justify-content: center;
            }
        }

        /* ê´€ë¦¬ì ëª¨ë‹¬ */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .admin-modal.show {
            display: flex;
        }

        /* íœ´ì§€í†µ ëª¨ë‹¬ */
        .trash-modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 14px;
            width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .trash-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #e8e8ed;
            border-radius: 8px;
            margin: 16px 0;
        }

        .trash-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f5f5f7;
        }

        .trash-item:last-child {
            border-bottom: none;
        }

        .trash-actions {
            display: flex;
            gap: 8px;
        }

        /* ì ‘ê·¼ ì œí•œ ì˜¤ë²„ë ˆì´ (ê³ ê°ë³„) */
        .access-denied-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 500;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .admin-modal-content {
            background: #fff;
            border-radius: 16px;
            padding: 32px;
            width: 320px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .admin-modal-content h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #1d1d1f;
        }

        .admin-modal-content p {
            font-size: 12px;
            color: #86868b;
            margin-bottom: 20px;
        }

        .admin-modal-content input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            margin-bottom: 16px;
        }

        .admin-modal-content input:focus {
            outline: none;
            border-color: #0071e3;
        }

        .admin-modal-btns {
            display: flex;
            gap: 8px;
        }

        .admin-modal-btns button {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .admin-modal-btns .cancel-btn {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .admin-modal-btns .confirm-btn {
            background: #0071e3;
            color: #fff;
        }

        /* ì›ê°€ê´€ë¦¬í‘œ ì ê¸ˆ ìƒíƒœ */
        .cost-locked .data-table input,
        .cost-locked .data-table select,
        .cost-locked .data-table textarea,
        .cost-locked .category-memo textarea {
            pointer-events: none;
            background: #f5f5f7 !important;
            color: #86868b;
        }

        .cost-locked .add-row-btn {
            display: none;
        }

        .cost-lock-overlay {
            background: linear-gradient(135deg, #fff5e6, #fff);
            border: 1px solid #ffcc80;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .cost-lock-overlay .lock-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #e65100;
        }

        /* =========================================
           ë¸”ë¡ í˜•íƒœ ëŒ€ì‹œë³´ë“œ (Dashboard) ìŠ¤íƒ€ì¼
           ========================================= */
        /* ------------------------------------------------------------------
         * MAIN BOARD (LANDING PAGE)
         * ------------------------------------------------------------------ */
        .main-board-wrapper {
            padding: 40px;
            background: #fbfbfd;
            height: 100%;
            overflow-y: auto;
        }

        .main-board-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 20px;
        }

        .main-board-header h1 {
            font-size: 26px;
            font-weight: 800;
            color: #1d1d1f;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .main-board-stats {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .board-filter-select {
            padding: 10px 14px;
            border: 1px solid #e2e2e7;
            border-radius: 12px;
            font-size: 13px;
            color: #1d1d1f;
            background: #fff;
            outline: none;
            cursor: pointer;
            transition: all 0.2s;
            height: 48px;
            font-weight: 500;
        }

        .board-filter-select:hover {
            border-color: #d2d2d7;
            background: #fdfdfd;
        }

        .board-stat-item {
            background: #fff;
            padding: 0 20px;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 110px;
            height: 48px;
            border: 1px solid rgba(0, 0, 0, 0.02);
            transition: transform 0.2s;
        }

        .board-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .board-stat-label {
            font-size: 10px;
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 2px;
        }

        .board-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1d1d1f;
            line-height: 1;
        }

        .main-board-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .project-card {
            background: #fff;
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.02);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
        }

        .project-card-header {
            margin-bottom: 12px;
        }

        .project-card-title {
            font-size: 18px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .project-card-client {
            font-size: 14px;
            color: #86868b;
            font-weight: 500;
        }

        .project-card-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 12px;
        }

        /* Status Colors */
        .status-consulting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-estimate {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-contracted {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status-in_progress {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .status-completed {
            background: #f5f5f7;
            color: #424245;
        }

        .project-card-footer {
            margin-top: 20px;
            border-top: 1px solid #f5f5f7;
            padding-top: 12px;
            font-size: 12px;
            color: #86868b;
            display: flex;
            justify-content: space-between;
        }

        .dashboard-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .dashboard-card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            position: relative;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .dashboard-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 1. í”„ë¡œí•„ ì¹´ë“œ */
        .card-profile {
            grid-column: span 5;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #0071e3, #42a5f5);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
        }

        .profile-info h2 {
            font-size: 20px;
            margin-bottom: 4px;
            color: #1d1d1f;
        }

        .profile-info p {
            font-size: 12px;
            color: #86868b;
        }

        .profile-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 13px;
        }

        .profile-detail-item {
            background: #f5f5f7;
            padding: 10px 12px;
            border-radius: 8px;
        }

        .profile-detail-label {
            font-size: 11px;
            color: #86868b;
            margin-bottom: 4px;
        }

        .profile-detail-value {
            font-weight: 600;
            color: #1d1d1f;
        }

        /* 2. ìƒíƒœ/ì¼ì • ì¹´ë“œ */
        .card-status {
            grid-column: span 7;
        }

        .status-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            position: relative;
        }

        /* íƒ€ì„ë¼ì¸ ë°” */
        .timeline-bar {
            position: absolute;
            top: 24px;
            /* dot center */
            left: 0;
            right: 0;
            height: 4px;
            background: #e5e5e5;
            z-index: 1;
        }

        .timeline-progress {
            position: absolute;
            top: 24px;
            left: 0;
            height: 4px;
            background: #0071e3;
            z-index: 2;
            width: 0%;
            /* JSë¡œ ì œì–´ */
        }

        .timeline-step {
            position: relative;
            z-index: 3;
            text-align: center;
            flex: 1;
        }

        .timeline-dot {
            width: 12px;
            height: 12px;
            background: #fff;
            border: 3px solid #e5e5e5;
            border-radius: 50%;
            margin: 18px auto 8px;
            /* ë°” ìœ„ì¹˜ ë³´ì • */
            transition: all 0.3s;
        }

        .timeline-step.active .timeline-dot {
            border-color: #0071e3;
            background: #0071e3;
            transform: scale(1.2);
        }

        .timeline-label {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        .timeline-step.active .timeline-label {
            color: #0071e3;
            font-weight: 700;
        }

        .d-day-badge {
            display: inline-block;
            background: #ff3b30;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-left: auto;
        }

        /* 3. ì›ê°€/ì •ì‚° ìš”ì•½ (í•µì‹¬) -> í´ë¦­ ì‹œ ì›ê°€ ìƒì„¸ë¡œ ì´ë™ */
        .card-cost-summary {
            grid-column: span 12;
            background: linear-gradient(135deg, #1d1d1f 0%, #2c2c2e 100%);
            color: white;
            cursor: pointer;
            border: none;
        }

        .card-cost-summary h3 {
            color: white;
        }

        .cost-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 10px;
        }

        .cost-stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .cost-stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .cost-stat-value {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .cost-stat-item.profit .cost-stat-value {
            color: #34c759;
        }

        /* 4. í€µ ë©”ë‰´ ê·¸ë¦¬ë“œ (Navigation) */
        .card-nav {
            grid-column: span 12;
            padding: 0;
            /* ë‚´ë¶€ ê·¸ë¦¬ë“œ íŒ¨ë”© ì‚¬ìš© */
            background: transparent;
            box-shadow: none;
            border: none;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
        }

        .nav-btn {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
            border-color: #0071e3;
        }

        .nav-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .nav-sub {
            font-size: 10px;
            color: #86868b;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 900px) {
            .card-profile {
                grid-column: span 12;
            }

            .card-status {
                grid-column: span 12;
            }

            .cost-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .cost-lock-overlay .unlock-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            background: #ff9500;
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
        }

        .cost-lock-overlay .unlock-btn:hover {
            background: #e68600;
        }

        /* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ */
        .settings-section {
            margin-top: 16px;
            padding: 16px;
            background: #f9f9fb;
            border-radius: 8px;
        }

        .settings-section h4 {
            font-size: 12px;
            color: #1d1d1f;
            margin-bottom: 12px;
        }

        .settings-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .settings-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 12px;
        }

        .settings-row button {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            background: #0071e3;
            color: #fff;
            font-size: 11px;
            cursor: pointer;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-layout {
            display: flex;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e8e8ed;
            /* [New] Fixed height and scrollable content */
            height: 100vh;
            position: sticky;
            top: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Prevent sidebar itself from scrolling */
        }

        .sidebar-header {
            padding: 14px 16px;
            border-bottom: 1px solid #e8e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            /* Header stays fixed */
        }

        .sidebar-header h3 {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .sidebar-search {
            padding: 10px 14px;
            border-bottom: 1px solid #e8e8ed;
            flex-shrink: 0;
        }

        .sidebar-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e8e8ed;
            border-radius: 6px;
            font-size: 12px;
        }

        .sidebar-search input:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ë…„/ì›” í•„í„° */
        .date-filter {
            padding: 10px 14px;
            border-bottom: 1px solid #e8e8ed;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .date-filter select {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 11px;
            background: #fff;
            cursor: pointer;
        }

        .date-filter select:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ìƒíƒœ í•„í„° */
        .status-filter {
            padding: 8px 14px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            flex-shrink: 0;
        }

        .filter-btn {
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid #e8e8ed;
            background: #fff;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: #f5f5f7;
        }

        .filter-btn.active {
            background: #0071e3;
            color: #fff;
            border-color: #0071e3;
        }

        /* [New] Scrollable Customer List */
        .customer-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            /* Important for firefox/flex */
        }

        .customer-item {
            padding: 12px 14px;
            margin: 8px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .customer-item:hover {
            background: #f9f9fb;
            border-color: #d2d2d7;
        }

        .customer-item.active {
            background: #e6f9ed !important;
            /* Green tint */
            border: 2px solid #34c759 !important;
            /* Green border */
        }

        .customer-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .customer-item-id {
            font-size: 10px;
            font-weight: 600;
            color: #0071e3;
        }

        .customer-item-name {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .customer-item-info {
            font-size: 10px;
            color: #86868b;
            line-height: 1.35;
            word-break: keep-all;
            /* í•œê¸€ ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
            overflow-wrap: anywhere;
            /* ê¸´ ì£¼ì†Œ ê°•ì œ ì¤„ë°”ê¿ˆ */
        }

        .customer-item-creator {
            font-size: 9px;
            color: #a0a0a5;
            margin-top: 4px;
        }

        /* ìƒíƒœ ë±ƒì§€ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
        }

        .status-badge.consulting {
            background: #fff3e0;
            color: #ff9500;
        }

        .status-badge.estimate {
            background: #e3f2fd;
            color: #2196f3;
        }

        .status-badge.hold {
            background: #f5f5f7;
            color: #8e8e93;
        }

        .status-badge.budget_over {
            background: #ffebee;
            color: #ff3b30;
        }

        .status-badge.other_company {
            background: #f3e5f5;
            color: #5856d6;
        }

        .status-badge.contracted {
            background: #e8f5e9;
            color: #34c759;
        }

        .status-badge.in_progress {
            background: #fff3e0;
            color: #ff9500;
        }

        .status-badge.completed {
            background: #e8f5e9;
            color: #30d158;
        }

        .status-badge.as_done {
            background: #e0f7fa;
            color: #00c7be;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            overflow: visible !important;
            /* Sticky ë™ì‘ì„ ìœ„í•´ í•„ìˆ˜ */
            background: #f5f5f7;
        }

        #mainContent {
            overflow: visible !important;
        }

        /* ê³ ê° ìƒì„¸ í—¤ë” */
        .customer-header-bar {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            padding: 10px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* í—¤ë” ê³ ì • (Sticky) */
            position: sticky;
            top: 56px;
            /* ë©”ì¸ í—¤ë” ë†’ì´ë§Œí¼ ë„ì›€. ì¡°ê¸ˆ ê²¹ì³ ë³´ì´ê±°ë‚˜ ê°„ê²© ì¡°ì • í•„ìš”ì‹œ ìˆ«ì ë³€ê²½ */
            z-index: 99;
        }

        .customer-header-left h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .customer-header-left .customer-id-display {
            font-size: 11px;
            opacity: 0.8;
        }

        .customer-header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .status-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
        }

        .status-select option {
            color: #1d1d1f;
        }

        .as-date-input {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 11px;
            width: 120px;
        }

        .as-date-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .delete-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 59, 48, 0.8);
            color: #fff;
            font-size: 11px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #ff3b30;
        }

        /* ê³ ê° ë‚´ë¶€ íƒ­ */
        .customer-tabs {
            background: #fff;
            border-bottom: 1px solid #e8e8ed;
            padding: 0 28px;
            display: flex;
            gap: 2px;
        }

        .customer-tab {
            padding: 12px 16px;
            background: transparent;
            border: none;
            color: #86868b;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .customer-tab:hover {
            color: #1d1d1f;
        }

        .customer-tab.active {
            color: #0071e3;
            border-bottom-color: #0071e3;
        }

        /* íƒ­ íŒ¨ë„ */
        .tab-panel {
            display: none;
            padding: 24px 28px;
        }

        .tab-panel.active {
            display: block;
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #86868b;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #1d1d1f;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 13px;
            margin-bottom: 20px;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-primary {
            background: #0071e3;
            color: #fff;
        }

        .btn-primary:hover {
            background: #0077ed;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 11px;
        }

        /* ì„¹ì…˜ */
        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f5f5f7;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-number {
            background: #0071e3;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* ì •ë³´ ê·¸ë¦¬ë“œ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .info-grid.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .info-grid.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .info-item {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid #e8e8ed;
        }

        .info-item.full {
            grid-column: 1 / -1;
        }

        .info-item.span-2 {
            grid-column: span 2;
        }

        .info-item label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: block;
            margin-bottom: 4px;
        }

        .info-item input,
        .info-item textarea,
        .info-item select {
            width: 100%;
            font-size: var(--font-size-lg);
            color: #1d1d1f;
            font-weight: 500;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 3px 0;
            background: transparent;
        }

        .info-item input:focus,
        .info-item textarea:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        .info-item input::placeholder {
            color: #c7c7cc;
            font-weight: 400;
        }

        /* ë¬¸ì„œ ë˜í¼ */
        .document-wrapper {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .doc-header {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #ffffff;
            padding: 24px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .doc-header h1 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .doc-header .subtitle {
            font-size: 11px;
            opacity: 0.7;
        }

        .pdf-btn {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }

        .pdf-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .doc-content {
            padding: 28px 28px;
        }

        .doc-content>p:first-child,
        .doc-content>.category-section:first-child {
            margin-top: 8px;
        }

        /* ëŒ€ê¸ˆ ì§€ê¸‰ */
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .payment-item {
            background: #fff;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #e8e8ed;
            text-align: center;
        }

        .payment-item label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .payment-item input {
            width: 100%;
            text-align: center;
            border: none;
            border-bottom: 2px solid #f5f5f7;
            padding: 3px 0;
            font-size: var(--font-size-lg);
            font-weight: 500;
            color: #1d1d1f;
            background: transparent;
        }

        .payment-item input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        /* ì¡°í•­ */
        .clause {
            background: #fff;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 6px;
            border: 1px solid #e8e8ed;
        }

        .clause-title {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
            font-size: var(--font-size-lg);
        }

        .clause-content {
            color: #424245;
            line-height: 1.5;
            font-size: var(--font-size-md);
        }

        .important-clause {
            background: #fff5f5;
            border: 2px solid #ff3b30;
        }

        .important-clause .clause-title {
            color: #ff3b30;
        }

        /* íŠ¹ì•½ì‚¬í•­ */
        .special-note {
            background: #fbfbfd;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #e8e8ed;
            margin-top: 16px;
        }

        .special-note-title {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 8px;
            font-size: var(--font-size-md);
        }

        .special-note textarea {
            width: 100%;
            min-height: 50px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            border-radius: 4px;
            font-size: var(--font-size-md);
            color: #424245;
            line-height: 1.4;
            resize: vertical;
        }

        .special-note textarea:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ë‚ ì§œ ë°•ìŠ¤ */
        .date-box {
            text-align: center;
            padding: 16px;
            background: #fbfbfd;
            border-radius: 8px;
            margin: 16px 0;
            border: 1px solid #e8e8ed;
        }

        .date-box label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .date-box input {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #1d1d1f;
            border: none;
            border-bottom: 2px solid #d2d2d7;
            padding: 4px 12px;
            background: transparent;
            text-align: center;
        }

        .date-box input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        /* ì„œëª… ê·¸ë¦¬ë“œ */
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .signature-card {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 14px;
            border: 1px solid #e8e8ed;
        }

        .signature-card h4 {
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e8e8ed;
        }

        .sig-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 6px;
        }

        .sig-field {
            margin-bottom: 4px;
        }

        .sig-field label {
            display: block;
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .sig-field input {
            width: 100%;
            padding: 3px 0;
            border: none;
            border-bottom: 1px solid #d2d2d7;
            font-size: var(--font-size-md);
            color: #1d1d1f;
            font-weight: 500;
            background: transparent;
        }

        .sig-field input:focus {
            outline: none;
            border-bottom-color: #0071e3;
        }

        .signature-box {
            margin-top: 8px;
            padding: 14px;
            background: #fff;
            border: 2px dashed #d2d2d7;
            border-radius: 6px;
            text-align: center;
            color: #86868b;
            font-size: var(--font-size-sm);
        }

        .stamp-warning {
            margin-top: 6px;
            background: #fff9e6;
            border: 2px solid #ffcc00;
            border-radius: 4px;
            padding: 5px;
            text-align: center;
            font-size: var(--font-size-sm);
            color: #1d1d1f;
            font-weight: 500;
        }

        /* ìš”ì•½ í…Œì´ë¸” */
        .summary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 14px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e8e8ed;
            font-size: var(--font-size-md);
        }

        .summary-table thead th {
            background: #f5f5f7;
            padding: 8px 10px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #1d1d1f;
            text-align: left;
            border-bottom: 2px solid #e8e8ed;
        }

        .summary-table thead th:last-child {
            text-align: right;
        }

        .summary-table tbody td {
            padding: 8px 10px;
            color: #1d1d1f;
            border-bottom: 1px solid #f5f5f7;
        }

        .summary-table tbody tr:hover {
            background: #fbfbfd;
        }

        .summary-table .no {
            width: 30px;
            text-align: center;
            color: #86868b;
        }

        .summary-table .amount {
            text-align: right;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
            min-width: 120px;
        }

        /* í‘œì§€ê³„ì•½ì„œ ê¸ˆì•¡ ì •ë ¬ - â‚© ì™¼ìª½ ê³ ì •, ê¸ˆì•¡ ìš°ì¸¡ ì •ë ¬ */
        .summary-table .amount .money-align {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .summary-table .amount .money-align .currency {
            flex-shrink: 0;
            margin-right: 4px;
        }

        .summary-table .amount .money-align .value {
            flex-grow: 1;
            text-align: right;
        }

        .summary-table .amount input {
            width: 100%;
            text-align: right;
            border: none;
            background: transparent;
            font-size: var(--font-size-md);
            font-weight: 600;
            color: #1d1d1f;
        }

        .summary-table .amount input:focus {
            outline: none;
        }

        .summary-table .subtotal td {
            background: #f5f5f7;
            font-weight: 600;
        }

        .summary-table .vat td {
            background: #e8f4fd;
            color: #0071e3;
        }

        .summary-table .total td {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            font-weight: 700;
        }

        /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ */
        .category-section {
            margin-bottom: 20px;
        }

        .category-section:first-child {
            margin-top: 12px;
        }

        .category-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #424245 100%);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-header h3 {
            font-size: var(--font-size-md);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-header .cat-no {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: var(--font-size-sm);
        }

        .category-header .subtotal {
            font-size: var(--font-size-lg);
            font-weight: 700;
        }

        /* ë°ì´í„° í…Œì´ë¸” */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            border: 1px solid #e8e8ed;
            border-top: none;
            font-size: var(--font-size-md);
        }

        .data-table thead {
            background: #f5f5f7;
        }

        .data-table th {
            padding: 6px 4px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #1d1d1f;
            text-align: center;
            border-bottom: 2px solid #e8e8ed;
            white-space: nowrap;
        }

        .data-table td {
            padding: 6px 4px;
            color: #1d1d1f;
            border-bottom: 1px solid #f5f5f7;
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .data-table tbody tr:hover {
            background: #fbfbfd;
        }

        .data-table input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: var(--font-size-md);
            color: #1d1d1f;
            padding: 3px;
        }

        .data-table input:focus {
            outline: none;
            background: #fff;
        }

        .data-table .col-no {
            text-align: center;
            color: #86868b;
            font-size: var(--font-size-sm);
        }

        .data-table .col-unit {
            text-align: center;
        }

        .data-table .col-unit .unit-select {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
            text-align: center;
        }

        .data-table .col-unit .unit-wrapper {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .data-table .col-unit .unit-input {
            flex: 1;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
            background: #f0f7ff;
        }

        .data-table .col-unit .unit-toggle-btn {
            padding: 2px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 3px;
            background: #f5f5f7;
            cursor: pointer;
            font-size: 8px;
            color: #86868b;
        }

        .data-table .col-unit .unit-toggle-btn:hover {
            background: #e8e8ed;
        }

        .data-table .col-spec .spec-wrapper {
            width: 100%;
        }

        .data-table .col-spec .spec-select {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #f0f7ff;
            cursor: pointer;
        }

        .data-table .col-spec .spec-input {
            width: 100%;
            padding: 4px 2px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #f0f7ff;
        }

        .data-table .col-qty {
            text-align: center;
        }

        .data-table .col-price {
            text-align: right;
        }

        .data-table .col-price input {
            text-align: right;
        }

        .data-table .col-total {
            text-align: right;
            font-weight: 600;
            font-size: var(--font-size-md);
            white-space: nowrap;
            padding-right: 6px;
        }



        .data-table .col-price {
            width: 85px;
            text-align: right;
        }

        .data-table th.material {
            background: #e8f9ec;
            color: #34c759;
        }

        .data-table th.labor {
            background: #fff3e0;
            color: #ff9500;
        }

        .data-table th.expense {
            background: #f3e5f5;
            color: #af52de;
        }

        .div-badge {
            display: inline-block;
            padding: 2px 5px;
            background: #e8f4fd;
            color: #0071e3;
            border-radius: 3px;
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .div-badge.direct {
            background: #fff9e6;
            color: #ff9500;
            cursor: pointer;
        }

        .div-badge.direct:hover {
            background: #ff9500;
            color: #fff;
        }

        .add-row-btn {
            width: 100%;
            padding: 5px;
            background: #fbfbfd;
            border: 1px dashed #d2d2d7;
            border-top: none;
            border-radius: 0 0 6px 6px;
            color: #86868b;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-row-btn:hover {
            background: #f5f5f7;
            color: #0071e3;
        }

        .category-memo {
            background: #fbfbfd;
            border: 1px solid #e8e8ed;
            border-top: none;
            padding: 8px 12px;
        }

        .category-memo label {
            font-size: var(--font-size-sm);
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
        }

        .category-memo textarea {
            width: 100%;
            min-height: 40px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e8e8ed;
            border-radius: 4px;
            font-size: var(--font-size-md);
            color: #424245;
            line-height: 1.6;
            resize: none;
            overflow: hidden;
        }

        .category-memo textarea:focus {
            outline: none;
            border-color: #0071e3;
        }

        /* ì´í•©ê³„ */
        .grand-total {
            background: #fbfbfd;
            border-radius: 8px;
            padding: 14px;
            margin-top: 16px;
            border: 1px solid #e8e8ed;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #e8e8ed;
        }

        .total-row:last-child {
            border-bottom: none;
        }

        .total-row.main {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: #fff;
            margin: 8px -14px -14px;
            padding: 12px 14px;
            border-radius: 0 0 8px 8px;
        }

        .total-row label {
            font-size: var(--font-size-md);
            color: #424245;
            font-weight: 500;
        }

        .total-row.main label {
            color: #fff;
        }

        .total-row .amount {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: #1d1d1f;
        }

        .total-row.main .amount {
            color: #fff;
            font-size: var(--font-size-xl);
        }

        /* ê³„ì•½ê²¬ì ì„œ ì„ íƒ í…Œì´ë¸” */
        .estimate-table-wrapper {
            margin-bottom: 16px;
        }

        .estimate-select-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-md);
        }

        .estimate-select-table th {
            background: #f5f5f7;
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #e8e8ed;
        }

        .estimate-select-table td {
            padding: 4px;
            border: 1px solid #e8e8ed;
            text-align: center;
            vertical-align: middle;
        }

        .estimate-select-table select {
            width: 100%;
            padding: 6px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
        }

        .estimate-select-table input[type="number"] {
            width: 100%;
            padding: 6px 4px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
        }

        .estimate-select-table .readonly-cell {
            background: #f9f9fb;
            color: #424245;
            font-size: var(--font-size-md);
        }

        .estimate-select-table .delete-btn {
            background: #ff3b30;
            color: #fff;
            border: none;
            border-radius: 4px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            line-height: 1;
        }

        .estimate-select-table .delete-btn:hover {
            background: #d70015;
        }

        .profit-rate-row {
            background: #f0f7ff;
            border-radius: 6px;
            margin: 8px 0;
        }

        .profit-rate-input {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .profit-rate-input input {
            width: 60px;
            padding: 6px 8px;
            border: 1px solid #0071e3;
            border-radius: 6px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            text-align: right;
            color: #0071e3;
        }

        .profit-rate-input span {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #0071e3;
        }

        @media print {
            .estimate-select-table .delete-btn {
                display: none;
            }
        }

        @media print {
            .estimate-select-table .col-div {
                display: none;
            }

            .estimate-select-table th.col-div {
                display: none;
            }
        }

        @media print {
            .estimate-select-table tr {
                opacity: 1 !important;
                text-decoration: none !important;
            }
        }

        @media print {
            .estimate-select-table input[type="checkbox"] {
                display: none;
            }
        }

        .estimate-select-table input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .estimate-actions .add-row-btn {
            padding: 8px 14px;
            font-size: var(--font-size-sm);
        }

        /* ê²¬ì ì„œ ì¹´í…Œê³ ë¦¬ë³„ í…Œì´ë¸” */
        .estimate-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            font-size: var(--font-size-md);
            margin-bottom: 8px;
        }

        .estimate-table th {
            background: #f5f5f7;
            padding: 8px 4px;
            text-align: center !important;
            font-weight: 600;
            border: 1px solid #e8e8ed;
            font-size: var(--font-size-sm);
            white-space: nowrap;
            overflow: visible;
        }

        .estimate-table td {
            padding: 8px 4px;
            border: 1px solid #e8e8ed;
            text-align: center;
            vertical-align: middle;
            overflow: visible;
            line-height: 1.3;
        }

        /* No ì…€ (1ë²ˆì§¸) */
        .estimate-table th:nth-child(1),
        .estimate-table td:nth-child(1) {
            width: 28px;
        }

        /* êµ¬ë¶„ ì…€ (2ë²ˆì§¸) - ë„‰ë„‰í•˜ê²Œ */
        .estimate-table th:nth-child(2),
        .estimate-table td:nth-child(2) {
            width: 75px;
        }

        /* í’ˆëª… ì…€ (3ë²ˆì§¸) - ìë™í™•ì¥, ì¢Œì¸¡ì •ë ¬ */
        .estimate-table th:nth-child(3),
        .estimate-table td:nth-child(3) {
            text-align: left;
            width: auto;
            min-width: 150px;
        }

        /* ìƒì„¸ë‚´ìš© ì…€ (4ë²ˆì§¸) - ì¢Œì¸¡ì •ë ¬, ë„“ê²Œ */
        .estimate-table th:nth-child(4),
        .estimate-table td:nth-child(4) {
            text-align: left;
            width: auto;
            min-width: 250px;
        }

        .estimate-table .spec-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: left;
            cursor: pointer;
        }

        .estimate-table .editable-input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: 11px;
            background: #f0f7ff;
            box-sizing: border-box;
        }

        .estimate-table .editable-input:focus {
            outline: none;
            border-color: #0051a8;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        .estimate-table .editable-price-input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #0071e3;
            border-radius: 4px;
            font-size: 11px;
            background: #f0f7ff;
            text-align: right;
            box-sizing: border-box;
        }

        .estimate-table .editable-price-input:focus {
            outline: none;
            border-color: #0051a8;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        /* ë‹¨ìœ„ ì…€ (5ë²ˆì§¸) */
        .estimate-table th:nth-child(5),
        .estimate-table td:nth-child(5) {
            width: 35px;
        }

        .estimate-table .unit-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: center;
            cursor: pointer;
        }

        /* ìˆ˜ëŸ‰ ì…€ (6ë²ˆì§¸) - ì¤‘ì•™ì •ë ¬ */
        .estimate-table th:nth-child(6),
        .estimate-table td:nth-child(6) {
            width: 50px;
            text-align: center;
        }

        /* ë‹¨ê°€ ì…€ (7ë²ˆì§¸) - ë„ˆë¹„ ì¶•ì†Œ, ì¤‘ì•™ì •ë ¬ */
        .estimate-table th:nth-child(7),
        .estimate-table td:nth-child(7) {
            width: 80px;
        }

        .estimate-table .price-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            background: #fafafa;
            font-size: var(--font-size-md);
            padding: 0 !important;
            /* ë‚´ë¶€ divê°€ íŒ¨ë”© ì²˜ë¦¬ */
            vertical-align: middle;
        }

        .money-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            white-space: nowrap;
        }

        /* ê¸ˆì•¡ ì…€ (8ë²ˆì§¸) - ë„ˆë¹„ ì¶•ì†Œ, ì¤‘ì•™ì •ë ¬ */
        .estimate-table th:nth-child(8),
        .estimate-table td:nth-child(8) {
            width: 100px;
            /* ê¸ˆì•¡ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ ë„ˆë¹„ í™•ë³´ */
        }



        .estimate-table .amount-cell {
            background: #fafafa;
            font-size: var(--font-size-md);
            text-align: center;
        }



        /* ë¹„ê³  ì…€ (9ë²ˆì§¸) */
        .estimate-table th:nth-child(9) {
            text-align: center !important;
        }

        .estimate-table td:nth-child(9) {
            text-align: left;
            white-space: pre-wrap;
            word-break: keep-all;
            overflow: visible;
        }



        /* ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ */
        .estimate-table th {
            position: relative;
        }

        .estimate-table th .col-resize-handle {
            position: absolute;
            right: -3px;
            top: 0;
            bottom: 0;
            width: 6px;
            cursor: col-resize;
            z-index: 10;
            background: transparent;
        }

        .estimate-table th .col-resize-handle:hover,
        .estimate-table th .col-resize-handle.resizing {
            background: rgba(0, 113, 227, 0.3);
        }

        .estimate-table select {
            width: 100%;
            padding: 5px 3px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            background: #fff;
            cursor: pointer;
        }

        .estimate-table .qty-input {
            width: 45px;
            padding: 2px 3px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: var(--font-size-md);
            text-align: center;
        }

        /* ì‚­ì œ ë²„íŠ¼ (í…Œì´ë¸” ì™¼ìª½ ì—¬ë°±ì— ë„ìš°ê¸°) */
        .del-btn-floating {
            position: absolute;
            left: -22px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            /* ì¡°ê¸ˆ ë” í¬ê²Œ */
            height: 18px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            opacity: 1;
            /* í•­ìƒ í‘œì‹œ */
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .del-btn-floating:hover {
            background: #d70015;
            transform: translateY(-50%) scale(1.1);
        }

        @media print {
            .del-btn-floating {
                display: none !important;
            }
        }

        /* ë¹„ê³  ì…ë ¥ì¹¸ ìŠ¤íƒ€ì¼ */
        .estimate-table .remark-input {
            width: 100%;
            min-width: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 11px;
            resize: none;
            overflow-y: hidden;
            box-sizing: border-box;
            line-height: 1.3;
        }

        .estimate-table .remark-editable {
            width: 100%;
            min-width: 60px;
            min-height: 24px;
            padding: 4px 6px;
            font-size: 11px;
            outline: none;
            white-space: pre-wrap;
            word-break: keep-all;
            line-height: 1.4;
            box-sizing: border-box;
        }

        .estimate-table .remark-editable:focus {
            background: #f8f9fa;
            border-radius: 4px;
        }

        .estimate-table .remark-editable:empty:before {
            content: '';
            color: #999;
        }



        .estimate-table .del-btn {
            background: none;
            border: none;
            color: #ff3b30;
            cursor: pointer;
            font-size: 12px;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .estimate-table .del-btn:hover {
            background: #ffebeb;
        }

        .estimate-memo {
            background: #f9f9fb;
            padding: 10px 12px;
            margin-top: 8px;
            border-radius: 6px;
            font-size: 11px;
            color: #424245;
            border-left: 3px solid #0071e3;
        }

        .estimate-memo .memo-textarea {
            width: 100%;
            min-height: 50px;
            padding: 8px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: 11px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        /* contenteditable ë©”ëª¨ ì˜ì—­ (ì„œì‹ ì ìš© ê°€ëŠ¥) */
        .estimate-memo .memo-editable {
            width: 100%;
            min-height: 50px;
            max-height: 150px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #d2d2d7;
            border-radius: 4px;
            font-size: 11px;
            font-family: inherit;
            line-height: 1.6;
            outline: none;
            white-space: pre-wrap;
            word-break: break-word;
            display: block;
            box-sizing: border-box;
            text-align: left;
        }

        .estimate-memo .memo-editable:focus {
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.15);
        }

        .estimate-memo .memo-editable:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }

        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ í–‰ ìŠ¤íƒ€ì¼ */
        .draggable-row.dragging {
            opacity: 0.5;
            background-color: #f0f0f0;
        }

        .estimate-table .drag-handle {
            cursor: grab;
        }

        .estimate-table .drag-handle:active {
            cursor: grabbing;
        }

        @media print {

            .estimate-table .col-div,
            .estimate-table th.col-div,
            .estimate-table col.col-div {
                display: none !important;
            }

            /* ì¸ì‡„ ì‹œ ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • (1: No, 2: Div, 3: Name, 4: Spec, 5: Unit, 6: Qty, 7: Price, 8: Amount, 9: Remark) */
            /* ì°¸ê³ : 2ë²ˆ êµ¬ë¶„ ì»¬ëŸ¼ì€ ì¸ì‡„ ì‹œ ìˆ¨ê²¨ì§ */
            .estimate-table col:nth-child(1) {
                width: 4% !important;
            }

            .estimate-table col:nth-child(3) {
                width: 18% !important;
            }

            .estimate-table col:nth-child(4) {
                width: 20% !important;
            }

            /* ìƒì„¸ë‚´ìš© */
            .estimate-table col:nth-child(5) {
                width: 8% !important;
            }

            /* ë‹¨ìœ„ (í™•ëŒ€) */
            .estimate-table col:nth-child(6) {
                width: 8% !important;
            }

            /* ìˆ˜ëŸ‰ (í™•ëŒ€) */
            .estimate-table col:nth-child(7) {
                width: 11% !important;
            }

            /* ë‹¨ê°€ (í™•ëŒ€) */
            .estimate-table col:nth-child(8) {
                width: 11% !important;
            }

            /* ê¸ˆì•¡ (í™•ëŒ€) */
            .estimate-table col:nth-child(9) {
                width: 20% !important;
            }

            /* ë¹„ê³  (ìƒì„¸ë‚´ìš©ê³¼ 1:1) */

            /* ì¸ì‡„ ì‹œ ë©”ëª¨ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ í™•ì¸ (ëŒ€ê´„í˜¸ ê°™ì€ íŒŒë€ ì„  ë³µêµ¬: ë‘¥ê·¼ ëª¨ì„œë¦¬) */
            .estimate-memo {
                border: 3px solid transparent !important;
                border-left-color: #0071e3 !important;
                border-radius: 12px !important;
                /* ë‘¥ê¸€ê²Œ êº¾ì´ë„ë¡ */

                padding-left: 12px !important;
                margin-top: 10px !important;
                display: block !important;
            }

            /* ì¸ì‡„ ì‹œ ë©”ëª¨ë€ ìŠ¤íƒ€ì¼ ê°œì„ : íšŒìƒ‰ ë°•ìŠ¤ë§Œ í‘œì‹œ (íŒŒë€ì„ ì€ ë¶€ëª¨ê°€ ë‹´ë‹¹ -> ì‚­ì œë¨) */
            .estimate-memo .memo-editable {
                display: block !important;
                height: auto !important;
                min-height: 50px !important;
                max-height: none !important;
                overflow: visible !important;
                white-space: pre-wrap !important;

                /* ìŠ¤íƒ€ì¼ë§: íšŒìƒ‰ ë°°ê²½, í…Œë‘ë¦¬ ì—†ìŒ */
                border: none !important;
                background-color: #f9f9fb !important;
                border-radius: 4px !important;
                /* 4ë©´ ëª¨ë‘ ë‘¥ê¸€ê²Œ */
                padding: 12px 16px !important;
                margin-top: 5px !important;

                width: 100% !important;
                box-sizing: border-box !important;

                /* í°íŠ¸ ë° ì—¬ë°± ì¡°ì • */
                font-size: 11px !important;
                line-height: 1.6 !important;
                color: #333 !important;

                /* ìŠ¤í¬ë¡¤ë°” ê°•ì œ ìˆ¨ê¹€ */
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;

                /* í˜ì´ì§€ ë„˜ê¹€ ë°©ì§€ */
                page-break-inside: avoid !important;
            }

            /* ì›¹í‚·(Chrome/Safari) ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
            .estimate-memo .memo-editable::-webkit-scrollbar {
                display: none !important;
                width: 0 !important;
                height: 0 !important;
            }
        }

        /* ìˆ˜ìµ ë¶„ì„ */
        .profit-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .profit-item {
            background: #fff;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #e8e8ed;
            text-align: center;
        }

        .profit-item.profit {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            border: none;
            color: #fff;
        }

        .profit-item label {
            font-size: 9px;
            color: #86868b;
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
        }

        .profit-item.profit label {
            color: rgba(255, 255, 255, 0.7);
        }

        .profit-item .value {
            font-size: 13px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .profit-item.profit .value {
            color: #fff;
        }

        /* ê¸°ì—…ì´ìœ¨ ë°•ìŠ¤ */
        .rate-box {
            background: #fbfbfd;
            border: 1px solid #e8e8ed;
            border-radius: 6px;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .rate-box label {
            font-size: 10px;
            color: #86868b;
            font-weight: 600;
        }

        .rate-box input {
            font-size: 14px;
            font-weight: 700;
            color: #0071e3;
            border: none;
            background: transparent;
            text-align: right;
            width: 60px;
        }

        .rate-box input:focus {
            outline: none;
        }

        /* í†µê³„ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 16px;
            border: 1px solid #e8e8ed;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            border: none;
            color: #fff;
        }

        .stat-card label {
            font-size: 9px;
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            display: block;
            margin-bottom: 4px;
        }

        .stat-card.highlight label {
            color: rgba(255, 255, 255, 0.7);
        }

        .stat-card .value {
            font-size: 22px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .stat-card.highlight .value {
            color: #fff;
        }

        .stat-card .sub {
            font-size: 10px;
            color: #86868b;
            margin-top: 2px;
        }

        .stat-card.highlight .sub {
            color: rgba(255, 255, 255, 0.7);
        }

        .no-print {
            display: block;
        }

        /* ì‚¬ì´ë“œë°” í†µê³„ ë²„íŠ¼ */
        .sidebar-stats-btn {
            padding: 14px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 600;
        }

        .sidebar-stats-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .sidebar-stats-btn .stats-arrow {
            margin-left: auto;
            transition: transform 0.2s ease;
        }

        .sidebar-stats-btn:hover .stats-arrow {
            transform: translateX(3px);
        }

        /* í˜ì´ì§• ìŠ¤íƒ€ì¼ */
        .pagination-container {
            padding: 10px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e5e5e5;
            text-align: center;
        }

        .pagination-info {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .pagination-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }

        .pagination-btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .pagination-btn:hover {
            background: #005bb5;
        }

        .pagination-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .pagination-current {
            font-size: 12px;
            font-weight: 700;
            color: #333;
            min-width: 60px;
        }

        /* í†µê³„ ëª¨ë‹¬ */
        .stats-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .stats-modal-overlay.show {
            display: flex;
        }

        .stats-modal {
            background: #f5f5f7;
            border-radius: 16px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stats-modal-header {
            background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
            color: #fff;
            padding: 18px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-modal-header h2 {
            font-size: 16px;
            font-weight: 700;
        }

        .stats-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
        }

        .stats-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-modal-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 70px);
        }

        /* ìš”ì•½ ì¹´ë“œ */
        .stats-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stats-summary-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e8e8ed;
        }

        .stats-summary-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ed 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stats-summary-card.blue .stats-summary-icon {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .stats-summary-card.green .stats-summary-icon {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .stats-summary-card.purple .stats-summary-icon {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .stats-summary-value {
            font-size: 22px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .stats-summary-label {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜•: KPI ê·¸ë¦¬ë“œ */
        @media (max-width: 768px) {
            .stats-kpi-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }

            .stats-kpi-grid .kpi-card.highlight {
                grid-column: span 2;
            }

            .stats-secondary-kpi {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .stats-filter-bar {
                flex-direction: column;
                gap: 10px !important;
            }

            .stats-main-chart {
                padding: 16px !important;
            }

            .stats-main-chart h3 {
                font-size: 15px !important;
            }

            .stats-main-chart>div:first-child {
                flex-direction: column;
                gap: 12px;
            }

            .stats-content-area .stats-chart-card {
                grid-column: span 2;
            }

            #view-stats-others>div {
                grid-template-columns: 1fr !important;
            }
        }

        /* ì°¨íŠ¸ ê·¸ë¦¬ë“œ */
        .stats-chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stats-chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e8e8ed;
        }

        .stats-chart-card.wide {
            grid-column: span 2;
        }

        .stats-chart-card h3 {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f5f5f7;
        }

        .stats-chart-card canvas {
            max-height: 220px;
        }

        /* ì „í™˜ìœ¨ í‘œì‹œ */
        .conversion-rate-display {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 10px 0;
        }

        .conversion-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#34c759 0%, #34c759 0%, #e8e8ed 0%, #e8e8ed 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .conversion-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: #fff;
            border-radius: 50%;
        }

        .conversion-circle span {
            position: relative;
            font-size: 24px;
            font-weight: 700;
            color: #34c759;
        }

        .conversion-details {
            flex: 1;
        }

        .conversion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 12px;
            color: #424245;
        }

        .conversion-item .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .conversion-item .dot.green {
            background: #34c759;
        }

        .conversion-item .dot.red {
            background: #ff3b30;
        }

        .conversion-item .dot.gray {
            background: #86868b;
        }

        @media (max-width: 900px) {
            .stats-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-chart-grid {
                grid-template-columns: 1fr;
            }

            .stats-chart-card.wide {
                grid-column: span 1;
            }
        }

        /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ (ê°•ì œ ë¡œê·¸ì¸) */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f5f7;
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .login-card {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            width: 360px;
            text-align: center;
        }

        .login-logo {
            font-size: 24px;
            font-weight: 700;
            color: #0071e3;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .login-subtitle {
            font-size: 14px;
            color: #86868b;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 14px;
            background: #fbfbfd;
            transition: all 0.2s;
        }

        .login-input:focus {
            background: #fff;
            border-color: #0071e3;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .login-btn-primary {
            width: 100%;
            padding: 14px;
            background: #0071e3;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }

        .login-btn-primary:hover {
            background: #0077ed;
        }

        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                size: A4;
                margin: 8mm 5mm 8mm 5mm;
                /* ìƒ ìš° í•˜ ì¢Œ - ì¢Œìš° ìµœì†Œí™” */
            }

            html,
            body {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .main-header,
            .sidebar,
            .customer-tabs,
            .add-row-btn,
            .pdf-btn,
            .no-print,
            .font-size-control,
            .header-actions {
                display: none !important;
            }

            body {
                background: white;
                font-size: 11px !important;
                zoom: 0.75;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .main-layout {
                display: block;
                width: 100% !important;
            }

            .main-content {
                overflow: visible;
                padding: 0 !important;
                width: 100% !important;
            }

            .customer-panel {
                padding: 0 !important;
            }

            .document-wrapper {
                box-shadow: none !important;
                border-radius: 0 !important;
                page-break-after: auto !important;
                margin: 0 !important;
                padding: 24px !important;
                /* ë‚´ë¶€ ì—¬ë°± ì¦ê°€ */
                width: 100% !important;
                max-width: none !important;
                min-height: 0 !important;
            }

            /* í—¤ë” ìŠ¤íƒ€ì¼ ì¸ì‡„ìš© ì¡°ì • */
            .doc-header {
                padding: 24px !important;
                margin: -24px -24px 24px -24px !important;
                background-color: #0071e3 !important;
                /* ë°°ê²½ìƒ‰ ê°•ì œ ì ìš© */
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: white !important;
            }

            .doc-header h1 {
                margin-bottom: 4px !important;
            }

            /* í…Œì´ë¸” ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
            .data-table,
            .estimate-table,
            .summary-table,
            .estimate-select-table {
                width: 100% !important;
                table-layout: fixed !important;
            }

            /* ì›ê°€ê´€ë¦¬í‘œ ì»¬ëŸ¼ ë„ˆë¹„ (ì¸ì‡„ìš©) */
            .data-table .col-no {
                width: 20px !important;
            }

            .data-table .col-div {
                width: 35px !important;
            }

            .data-table .col-name {
                width: auto !important;
            }

            /* ì¸ì‡„ ì‹œ ìˆ¨ê¹€ */
            .no-print {
                display: none !important;
            }

            /* ìŠ¤ì¼€ì¤„ ê´€ë¦¬ íŒ¨ë„ ì¸ì‡„ ì„¤ì • */
            #panel-schedule .data-table th:last-child,
            #panel-schedule .data-table td:last-child {
                display: none !important;
            }

            /* ìŠ¤ì¼€ì¤„ í…Œì´ë¸” ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • (ì¸ì‡„ìš©) */
            #panel-schedule .data-table th:nth-child(1),
            #panel-schedule .data-table td:nth-child(1) {
                width: 5% !important;
            }

            /* No */
            #panel-schedule .data-table th:nth-child(2),
            #panel-schedule .data-table td:nth-child(2) {
                width: 30% !important;
            }

            /* ê³µì •ëª… */
            #panel-schedule .data-table th:nth-child(3),
            #panel-schedule .data-table td:nth-child(3) {
                width: 15% !important;
            }

            /* ì‹œì‘ì¼ */
            #panel-schedule .data-table th:nth-child(4),
            #panel-schedule .data-table td:nth-child(4) {
                width: 15% !important;
            }

            /* ì¢…ë£Œì¼ */
            #panel-schedule .data-table th:nth-child(5),
            #panel-schedule .data-table td:nth-child(5) {
                width: 10% !important;
            }

            /* ë‹´ë‹¹ì */
            #panel-schedule .data-table th:nth-child(6),
            #panel-schedule .data-table td:nth-child(6) {
                width: 25% !important;
            }

            /* ë¹„ê³  */

            /* í’ˆëª… - ë‚˜ë¨¸ì§€ ê³µê°„ ì°¨ì§€ */
            .data-table .col-spec {
                width: 80px !important;
            }

            .data-table .col-unit {
                width: 30px !important;
            }

            .data-table .col-qty {
                width: 30px !important;
            }

            .data-table .col-price {
                width: 55px !important;
            }

            .data-table .col-total {
                width: 65px !important;
            }

            .data-table .col-note {
                width: 50px !important;
            }

            /* ê³„ì•½ê²¬ì ì„œ ì»¬ëŸ¼ ë„ˆë¹„ (ì¸ì‡„ìš©) */
            .estimate-table th:nth-child(1) {
                width: 20px !important;
            }

            /* No */
            .estimate-table th:nth-child(2) {
                width: auto !important;
            }

            /* í’ˆëª… - ë‚˜ë¨¸ì§€ ê³µê°„ */
            .estimate-table th:nth-child(3) {
                width: 80px !important;
            }

            /* ê·œê²© */
            .estimate-table th:nth-child(4) {
                width: 30px !important;
            }

            /* ë‹¨ìœ„ */
            .estimate-table th:nth-child(5) {
                width: 30px !important;
            }

            /* ìˆ˜ëŸ‰ */
            .estimate-table th:nth-child(6) {
                width: 65px !important;
            }

            /* ë‹¨ê°€ */
            .estimate-table th:nth-child(7) {
                width: 65px !important;
            }

            /* ê¸ˆì•¡ */

            /* ê²¬ì ì„œ í—¤ë” ê°€ìš´ë° ì •ë ¬ (ì¸ì‡„) */
            .estimate-table th {
                text-align: center !important;
            }

            /* ì…€ ë‚´ìš© ì¤„ë°”ê¿ˆ ë°©ì§€ */
            .data-table td,
            .estimate-table td,
            .summary-table td {
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                padding: 4px 3px !important;
                font-size: 10px !important;
            }

            /* í’ˆëª…/ê·œê²© ì—´ì€ ì¤„ë°”ê¿ˆ í—ˆìš© */
            .data-table .col-name,
            .data-table .col-spec,
            .estimate-table td:nth-child(2),
            .estimate-table td:nth-child(3) {
                white-space: normal !important;
                word-break: keep-all !important;
            }

            .data-table th,
            .estimate-table th,
            .summary-table th {
                padding: 4px 3px !important;
                font-size: 9px !important;
                white-space: nowrap !important;
            }

            /* ì¹´í…Œê³ ë¦¬ í—¤ë” */
            .category-header {
                padding: 6px 8px !important;
            }

            .category-header h3 {
                font-size: 11px !important;
            }

            .category-header .subtotal {
                font-size: 11px !important;
            }

            /* ì´í•©ê³„ */
            .grand-total {
                padding: 8px !important;
                margin-top: 8px !important;
            }

            .total-row {
                padding: 4px 0 !important;
            }

            .total-row label {
                font-size: 10px !important;
            }

            .total-row .amount {
                font-size: 11px !important;
            }

            .total-row.main .amount {
                font-size: 13px !important;
            }

            /* ì •ë³´ ê·¸ë¦¬ë“œ */
            .info-grid {
                gap: 12px !important;
                /* ê°„ê²© ë„“í˜ */
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                width: 100% !important;
            }

            /* ì„¹ì…˜ ê°„ê²© ë„“í˜ */
            .section {
                margin-bottom: 24px !important;
            }

            .section-title {
                margin-bottom: 12px !important;
            }

            .info-grid.cols-3 {
                grid-template-columns: repeat(3, 1fr) !important;
            }

            .info-grid.cols-4 {
                grid-template-columns: repeat(4, 1fr) !important;
            }

            .info-item.full {
                grid-column: span 2 !important;
            }

            .info-item {
                padding: 6px 8px !important;
            }

            .info-item label {
                font-size: 8px !important;
            }

            .info-item input,
            .info-item select {
                font-size: 10px !important;
            }

            /* ë©”ëª¨ ì˜ì—­ */
            .category-memo,
            .estimate-memo {
                overflow: visible !important;
                max-height: none !important;
            }

            .category-memo textarea {
                font-size: 9px !important;
            }

            .estimate-memo .memo-content {
                font-size: 9px !important;
            }

            /* ì„œëª… ì˜ì—­ */
            .signature-card h4 {
                font-size: 10px !important;
            }

            .sig-field label {
                font-size: 7px !important;
            }

            .sig-field input {
                font-size: 9px !important;
            }

            /* í˜ì´ì§€ ë§¤ê¹€ ë°©ì§€: ë‚´ìš©ì´ ì˜ë¦¬ì§€ ì•Šê³  ë‹¤ìŒ í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ë„ë¡ ì„¤ì • */
            .section,
            .info-grid,
            .signature-card,
            .clause,
            .contract-article,
            .category-box,
            tr,
            .estimate-row,
            .category-memo,
            .estimate-memo {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            /* ì¡°í•­ */
            .clause {
                padding: 8px !important;
                margin-bottom: 4px !important;
            }

            .clause-title {
                font-size: 10px !important;
            }

            /* ëŒ€ê¸ˆ ì§€ê¸‰ í•œ ì¤„ë¡œ í‘œì‹œ */
            .payment-grid {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr) !important;
                gap: 8px !important;
                width: 100% !important;
            }

            .clause-content {
                font-size: 9px !important;
            }

            /* ì„œëª… ê·¸ë¦¬ë“œ 2ì—´ ìœ ì§€ (ì¸ì‡„) */
            .signature-grid {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }

            .signature-card {
                background: #fbfbfd !important;
                border-radius: 8px !important;
                padding: 14px !important;
                border: 1px solid #e8e8ed !important;
            }

            .signature-card h4 {
                text-align: center !important;
                font-size: 11px !important;
                font-weight: 700 !important;
                margin-bottom: 10px !important;
                padding-bottom: 6px !important;
                border-bottom: 1px solid #e8e8ed !important;
            }

            .sig-row {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }

            .signature-box {
                margin-top: 8px !important;
                padding: 14px !important;
                border: 2px dashed #d2d2d7 !important;
                border-radius: 6px !important;
                text-align: center !important;
            }

            .stamp-warning {
                margin-top: 6px !important;
                background: #fff9e6 !important;
                border: 2px solid #ffcc00 !important;
                border-radius: 4px !important;
                padding: 5px !important;
                text-align: center !important;
                font-weight: 500 !important;
            }

            .date-box {
                text-align: center !important;
                padding: 16px !important;
                background: #fbfbfd !important;
                border-radius: 8px !important;
                margin: 16px 0 !important;
                border: 1px solid #e8e8ed !important;
            }
        }

        /* ë©€í‹° ì…€ë ‰íŠ¸ UI ìŠ¤íƒ€ì¼ */
        .multi-select-wrapper {
            position: relative;
            width: 100%;
        }

        .multi-select-box {
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            margin-top: 4px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
            padding: 4px;
        }

        .multi-select-dropdown.show {
            display: block;
        }

        .multi-select-option {
            display: block;
            padding: 0;
            border-radius: 4px;
        }

        .multi-select-option:hover {
            background: #f5f5f7;
        }

        .multi-select-option label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
            padding: 6px 8px !important;
            margin: 0 !important;
            font-size: 11px;
        }

        .multi-select-option input {
            cursor: pointer;
            margin: 0;
            accent-color: #0071e3;
        }

        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 300px;
            }

            .profit-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 10px 16px;
            }

            .info-grid,
            .signature-grid {
                grid-template-columns: 1fr;
            }

            .payment-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .customer-tabs {
                overflow-x: auto;
            }

            .customer-tab {
                white-space: nowrap;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì„¤ì • ë²„íŠ¼/íŒ¨ë„/ì„œì‹ íˆ´ë°” ìˆ¨ê¸°ê¸° */
            .settings-toggle-btn,
            .settings-panel,
            .text-format-toolbar,
            .col-resize-handle {
                display: none !important;
            }
        }

        /* ì ê¸ˆ í† ê¸€ ë²„íŠ¼ */
        .lock-toggle-btn {
            border: none;
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .lock-toggle-btn.unlocked {
            background-color: #e5f9e7;
            color: #34c759;
        }

        .lock-toggle-btn.locked {
            background-color: #ffe5e5;
            color: #ff3b30;
        }
    </style>
    <style>
        /* Editable Dropdown & Rich Text Input Styles */
        .editable-cell-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            width: 100%;
        }

        .editable-content {
            flex: 1;
            min-height: 24px;
            padding: 4px;
            border: 1px solid transparent;
            outline: none;
            transition: border-color 0.2s;
            white-space: pre-wrap;
            word-break: break-all;
            cursor: text;
            font-size: 12px;
        }

        .editable-content:focus {
            border-bottom: 2px solid #0071e3;
            background: rgba(0, 113, 227, 0.05);
        }

        .editable-content:empty::before {
            content: attr(placeholder);
            color: #c7c7cc;
            pointer-events: none;
        }

        .dropdown-toggle-btn {
            width: 20px;
            height: 100%;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #86868b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            padding: 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .editable-cell-wrapper:hover .dropdown-toggle-btn {
            opacity: 1;
        }

        .dropdown-toggle-btn:hover {
            color: #0071e3;
            background: #f5f5f7;
            border-radius: 3px;
        }

        .custom-dropdown-portal {
            position: fixed;
            z-index: 9999;
            background: #fff;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .custom-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            color: #1d1d1f;
            transition: background 0.1s;
            border-bottom: 1px solid #f5f5f7;
        }

        .custom-dropdown-item:last-child {
            border-bottom: none;
        }

        .custom-dropdown-item:hover {
            background: #f5f5f7;
            color: #0071e3;
        }

        .custom-dropdown-item.selected {
            background: #e8f4fd;
            color: #0071e3;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- [Phase 2] ì´ˆê¸° ë°ì´í„° ë™ê¸°í™” ì˜¤ë²„ë ˆì´ -->
    <div id="initialSyncOverlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:24px; transition: opacity 0.5s ease;">
        <div class="sync-loader"
            style="width:50px; height:50px; border:4px solid #f3f3f3; border-top:4px solid #0071e3; border-radius:50%; animation: sync-spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;">
        </div>
        <div style="text-align:center;">
            <div style="font-size:18px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">ìµœì‹  ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤</div>
            <div id="initialSyncStatus" style="font-size:14px; color:#86868b;">ì„œë²„ì—ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
        <div id="syncErrorContent"
            style="display:none; text-align:center; max-width:400px; padding:20px; background:#fff1f0; border:1px solid #ffa39e; border-radius:12px;">
            <div style="color:#cf1322; font-weight:600; margin-bottom:12px;">ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨</div>
            <div id="syncErrorMessage" style="font-size:13px; color:#5c0011; margin-bottom:16px;">ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.
            </div>
            <button onclick="location.reload()"
                style="padding:10px 20px; background:#cf1322; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">ë‹¤ì‹œ
                ì‹œë„</button>
        </div>
        <style>
            @keyframes sync-spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </div>
    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div class="toast" id="toast" style="display:none; align-items:flex-start;">
        <span id="toastIcon" style="font-size:18px; margin-top:2px;">âœ“</span>
        <span id="toastMessage" style="flex:1; word-break:break-all; line-height:1.4;">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</span>
    </div>

    <!-- ë©”ì¸ í—¤ë” -->
    <header class="main-header">
        <div class="logo">
            <a href="javascript:void(0)" onclick="location.reload();"
                style="display:flex;align-items:center;gap:10px;text-decoration:none;cursor:pointer;">
                <div class="logo-icon">DJ</div>
                <div class="logo-text">ë””ìì¸ì§€ê·¸ <span>í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</span></div>
            </a>
        </div>
        <div class="header-actions">

            <a href="index.html" class="header-btn secondary" style="text-decoration:none;">ğŸ  í™ˆí˜ì´ì§€</a>
            <!-- ê´€ë¦¬ì ìƒíƒœ í‘œì‹œ -->
            <div id="adminStatus">
                <span class="admin-badge viewer" id="adminBadge">ğŸ‘ ì—´ëŒ ëª¨ë“œ</span>
                <button class="admin-login-btn" onclick="showAdminModal()">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</button>
            </div>
            <div style="position:relative;">
                <button class="settings-toggle-btn no-print" onclick="toggleSettingsPanel(event)"
                    title="ê¸€ì”¨ í¬ê¸° Â· ì„œì‹ ì„¤ì •">âš™ï¸</button>
                <div class="settings-panel no-print" id="settingsPanel">
                    <div class="sp-title">ê¸€ì”¨ í¬ê¸°</div>
                    <div class="sp-row">
                        <label>ì „ì²´</label>
                        <input type="range" id="fontSizeSlider" min="8" max="18" value="12"
                            oninput="changeFontSize(this.value)">
                        <span class="sp-val" id="fontSizeValue">12px</span>
                    </div>
                    <div class="sp-row">
                        <label>í—¤ë”</label>
                        <input type="range" id="fsCatHeader" min="8" max="18" value="13"
                            oninput="changePartFontSize('catHeader', this.value)">
                        <span class="sp-val" id="fsCatHeaderVal">13px</span>
                    </div>
                    <div class="sp-row">
                        <label>í–‰í—¤ë”</label>
                        <input type="range" id="fsColHeader" min="8" max="18" value="10"
                            oninput="changePartFontSize('colHeader', this.value)">
                        <span class="sp-val" id="fsColHeaderVal">10px</span>
                    </div>
                    <div class="sp-row">
                        <label>ë‚´ìš©</label>
                        <input type="range" id="fsContent" min="8" max="18" value="11"
                            oninput="changePartFontSize('content', this.value)">
                        <span class="sp-val" id="fsContentVal">11px</span>
                    </div>
                    <div class="sp-row">
                        <label>ë©”ëª¨</label>
                        <input type="range" id="fsMemo" min="8" max="18" value="11"
                            oninput="changePartFontSize('memo', this.value)">
                        <span class="sp-val" id="fsMemoVal">11px</span>
                    </div>
                    <hr class="sp-divider">
                    <div class="sp-title">í…ìŠ¤íŠ¸ ì„œì‹ (ë“œë˜ê·¸ í›„ ì ìš©)</div>
                    <div class="sp-format-row">
                        <button class="fmt-bold" onclick="applyTextFormat('bold')" title="êµµê²Œ">B</button>
                        <button class="fmt-red" onclick="applyTextFormat('color','#ff3b30')" title="ë¹¨ê°„ìƒ‰">A</button>
                        <button class="fmt-blue" onclick="applyTextFormat('color','#007aff')" title="íŒŒë€ìƒ‰">A</button>
                        <button class="fmt-orange" onclick="applyTextFormat('color','#ff9500')" title="ì£¼í™©ìƒ‰">A</button>
                        <button class="fmt-underline" onclick="applyTextFormat('underline')" title="ë°‘ì¤„">U</button>
                        <button class="fmt-strike" onclick="applyTextFormat('strikethrough')" title="ì·¨ì†Œì„ ">S</button>
                        <button class="fmt-italic" onclick="applyTextFormat('italic')" title="ê¸°ìš¸ì„">I</button>
                    </div>
                </div>
            </div>
            <button class="header-btn secondary" onclick="exportAllData()">ğŸ“Š Excel ë‚´ë³´ë‚´ê¸°</button>
            <button class="header-btn secondary" onclick="importData()">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="header-btn secondary" onclick="exportCurrentCustomerData()">ğŸ’¾ ê³ ê°ì €ì¥(JSON)</button>
        </div>
    </header>

    <!-- í…ìŠ¤íŠ¸ ì„œì‹ í”Œë¡œíŒ… íˆ´ë°” -->
    <div class="text-format-toolbar no-print" id="textFormatToolbar">
        <button class="fmt-bold" onclick="applyTextFormat('bold')" title="êµµê²Œ">B</button>
        <button class="fmt-black" onclick="applyTextFormat('color','#000000')" title="ê²€ì •ìƒ‰">A</button>
        <button class="fmt-red" onclick="applyTextFormat('color','#ff3b30')" title="ë¹¨ê°„ìƒ‰">A</button>
        <button class="fmt-blue" onclick="applyTextFormat('color','#007aff')" title="íŒŒë€ìƒ‰">A</button>
        <button class="fmt-orange" onclick="applyTextFormat('color','#ff9500')" title="ì£¼í™©ìƒ‰">A</button>
        <button class="fmt-underline" onclick="applyTextFormat('underline')" title="ë°‘ì¤„">U</button>
        <button class="fmt-strike" onclick="applyTextFormat('strikethrough')" title="ì·¨ì†Œì„ ">S</button>
        <button class="fmt-italic" onclick="applyTextFormat('italic')" title="ê¸°ìš¸ì„">I</button>
        <button class="fmt-clear" onclick="applyTextFormat('removeFormat')" title="ì„œì‹ ì œê±°">âœ•</button>
    </div>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <h3>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
            <p>ê´€ë¦¬ì ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="text" id="adminId" placeholder="ì•„ì´ë””" style="margin-bottom:8px;"
                onkeypress="if(event.key==='Enter')document.getElementById('adminPassword').focus()">
            <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸"
                onkeypress="if(event.key==='Enter')loginAdmin()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeAdminModal()">ì·¨ì†Œ</button>
                <button class="confirm-btn" onclick="loginAdmin()">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>

    <!-- ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
    <div class="admin-modal" id="deletePasswordModal">
        <div class="admin-modal-content">
            <h3>ğŸ—‘ï¸ ì‚­ì œ í™•ì¸</h3>
            <p>ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" id="deletePassword" placeholder="ì‚­ì œ ë¹„ë°€ë²ˆí˜¸"
                onkeypress="if(event.key==='Enter')confirmDeletePassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeDeletePasswordModal()">ì·¨ì†Œ</button>
                <button class="confirm-btn" onclick="confirmDeletePassword()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ê´€ë¦¬ ëª¨ë‹¬ (ë©”ì¸ê´€ë¦¬ì ì „ìš©) -->
    <div class="admin-modal" id="adminManagerModal">
        <div class="admin-modal-content" style="max-width:400px;">
            <h3>ğŸ‘¥ ì¼ë°˜ê´€ë¦¬ì ê´€ë¦¬</h3>
            <p style="font-size:11px;color:#86868b;">ë©”ì¸ê´€ë¦¬ìë§Œ ê´€ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>

            <!-- ì¼ë°˜ê´€ë¦¬ì ëª©ë¡ -->
            <div id="regularAdminList"
                style="max-height:200px;overflow-y:auto;border:1px solid #e8e8ed;border-radius:6px;margin-bottom:15px;">
            </div>

            <!-- ìƒˆ ê´€ë¦¬ì ì¶”ê°€ -->
            <div style="background:#f5f5f7;padding:12px;border-radius:6px;margin-bottom:15px;">
                <div style="font-weight:600;margin-bottom:8px;font-size:12px;">â• ìƒˆ ì¼ë°˜ê´€ë¦¬ì ì¶”ê°€</div>
                <input type="text" id="newAdminId" placeholder="ì•„ì´ë””" style="margin-bottom:6px;">
                <input type="password" id="newAdminPw" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin-bottom:8px;">
                <button class="btn btn-primary btn-sm" onclick="addRegularAdmin()" style="width:100%;">ì¶”ê°€</button>
            </div>

            <div class="admin-modal-btns">
                <button class="confirm-btn" onclick="closeAdminManagerModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ëª¨ë‹¬ (ë¯¸ì‚¬ìš©) -->
    <div class="admin-modal" id="passwordModal">
        <div class="admin-modal-content">
            <h3>ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h3>
            <p>ì›ê°€ê´€ë¦¬í‘œ ë³´í˜¸ë¥¼ ìœ„í•œ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”</p>
            <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬ ì´ìƒ)">
            <input type="password" id="confirmPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="margin-top:-8px;"
                onkeypress="if(event.key==='Enter')setAdminPassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closePasswordModal()">ì·¨ì†Œ</button>
                <button class="confirm-btn" onclick="setAdminPassword()">ì„¤ì •</button>
            </div>
        </div>
    </div>

    <!-- íœ´ì§€í†µ ëª¨ë‹¬ -->
    <div class="admin-modal" id="trashModal">
        <div class="trash-modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h3 style="margin:0;">ğŸ—‘ï¸ íœ´ì§€í†µ</h3>
                <button onclick="closeTrashModal()"
                    style="border:none; background:none; cursor:pointer; font-size:18px;">âœ•</button>
            </div>
            <div id="trashList" class="trash-list">
                <!-- ì‚­ì œëœ í•­ëª© í‘œì‹œ -->
            </div>
            <div style="font-size:12px; color:#86868b; margin-top:10px;">
                * ì˜êµ¬ ì‚­ì œ ì‹œ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- ì›ê°€ê´€ë¦¬í‘œ ë³´ì•ˆ ì ‘ê·¼ ëª¨ë‹¬ -->
    <div class="admin-modal" id="costPasswordModal">
        <div class="admin-modal-content">
            <h3>ğŸ”’ ë³´ì•ˆ ì ‘ê·¼</h3>
            <p>ì›ê°€ê´€ë¦¬í‘œ ì ‘ê·¼ì„ ìœ„í•´<br>ë³´ì•ˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="password" id="costAccessPin" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                onkeypress="if(event.key==='Enter')checkCostPassword()">
            <div class="admin-modal-btns">
                <button class="cancel-btn" onclick="closeCostPasswordModal()">ì·¨ì†Œ</button>
                <button class="confirm-btn" onclick="checkCostPassword()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
    <div class="main-layout">
        <!-- ì‚¬ì´ë“œë°”: ê³ ê° ëª©ë¡ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>ê³ ê° ëª©ë¡</h3>
                <div style="display:flex;gap:6px;">
                    <!-- [NEW] ë©”ì¸ ë³´ë“œ ì´ë™ ë²„íŠ¼ -->
                    <button class="btn btn-sm" onclick="showMainBoardView()" title="í™ˆìœ¼ë¡œ (ë©”ì¸ ë³´ë“œ)"
                        style="background:#8e8e93; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">ğŸ </button>
                    <!-- íœ´ì§€í†µ (ë©”ì¸ ê´€ë¦¬ììš©) - ìƒë‹¨ ì´ë™ -->
                    <button class="btn btn-sm" id="trashBtnHeader" onclick="showTrashModal()" title="íœ´ì§€í†µ"
                        style="background:#ff3b30; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">ğŸ—‘ï¸</button>
                    <button class="btn btn-sm" onclick="syncFromCloud();" title="í´ë¼ìš°ë“œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°"
                        style="background:#34c759; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">â˜ï¸â†“</button>
                    <button class="btn btn-primary btn-sm" onclick="newCustomer()">+ ì‹ ê·œ</button>
                </div>
            </div>
            <div class="sidebar-search">
                <input type="text" placeholder="ì´ë¦„, ì—°ë½ì²˜ ê²€ìƒ‰..." id="searchInput" oninput="filterCustomers()">
            </div>
            <!-- ë…„/ì›” í•„í„° -->
            <div class="date-filter">
                <select id="yearFilter" onchange="filterCustomers()">
                    <option value="">ì „ì²´ ë…„ë„</option>
                </select>
                <select id="monthFilter" onchange="filterCustomers()">
                    <option value="">ì „ì²´ ì›”</option>
                    <option value="01">1ì›”</option>
                    <option value="02">2ì›”</option>
                    <option value="03">3ì›”</option>
                    <option value="04">4ì›”</option>
                    <option value="05">5ì›”</option>
                    <option value="06">6ì›”</option>
                    <option value="07">7ì›”</option>
                    <option value="08">8ì›”</option>
                    <option value="09">9ì›”</option>
                    <option value="10">10ì›”</option>
                    <option value="11">11ì›”</option>
                    <option value="12">12ì›”</option>
                </select>
            </div>
            <!-- ìƒíƒœ í•„í„° -->
            <div class="status-filter">
                <button class="filter-btn active" data-status="all" onclick="setStatusFilter('all')">ì „ì²´</button>
                <button class="filter-btn" data-status="consulting" onclick="setStatusFilter('consulting')">ìƒë‹´ì¤‘</button>
                <button class="filter-btn" data-status="estimate" onclick="setStatusFilter('estimate')">ê²¬ì ì„œ</button>
                <button class="filter-btn" data-status="hold" onclick="setStatusFilter('hold')">ë³´ë¥˜</button>
                <button class="filter-btn" data-status="budget_over"
                    onclick="setStatusFilter('budget_over')">ì˜ˆì‚°ì´ˆê³¼</button>
                <button class="filter-btn" data-status="other_company"
                    onclick="setStatusFilter('other_company')">íƒ€ì—…ì²´</button>
                <button class="filter-btn" data-status="contracted"
                    onclick="setStatusFilter('contracted')">ê³„ì•½ì™„ë£Œ</button>
                <button class="filter-btn" data-status="in_progress"
                    onclick="setStatusFilter('in_progress')">ê³µì‚¬ì¤‘</button>
                <button class="filter-btn" data-status="completed" onclick="setStatusFilter('completed')">ê³µì‚¬ì™„ë£Œ</button>
                <button class="filter-btn" data-status="as_done" onclick="setStatusFilter('as_done')">A/S</button>
            </div>
            <div class="customer-list" id="customerList"></div>
            <!-- í˜ì´ì§• UI (500ëª… ì´ìƒì‹œ ìë™ í‘œì‹œ) -->
            <div class="pagination-container" id="paginationContainer" style="display:none;">
                <div class="pagination-info" id="paginationInfo"></div>
                <div class="pagination-buttons">
                    <button class="pagination-btn" id="prevPageBtn" onclick="goToPrevPage()">â—€ ì´ì „</button>
                    <span class="pagination-current" id="currentPageSpan">1</span>
                    <button class="pagination-btn" id="nextPageBtn" onclick="goToNextPage()">ë‹¤ìŒ â–¶</button>
                </div>
            </div>
            <!-- í†µê³„ ë²„íŠ¼ -->
            <div class="sidebar-stats-btn" onclick="openStatsModal()">
                <span>ğŸ“Š</span>
                <span>ì „ì²´ í†µê³„ ëŒ€ì‹œë³´ë“œ</span>
                <span class="stats-arrow">â†’</span>
            </div>
            <!-- ìš´ì˜ë¹„ ê´€ë¦¬ ë²„íŠ¼ -->
            <div class="sidebar-stats-btn" onclick="showMainView('expenses')"
                style="margin-top:10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                <span style="font-size:18px;">ğŸ’¸</span>
                <span style="font-weight:600;">ìš´ì˜ë¹„ ê´€ë¦¬</span>
                <span class="stats-arrow">â†’</span>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content" id="mainContent">
            <!-- [ì‹ ê·œ] ìš´ì˜ë¹„ ê´€ë¦¬ ë·° (ì „ì—­) -->
            <div id="view-expenses"
                style="display:none; padding:40px; height:100%; overflow-y:auto; background:linear-gradient(180deg, #f0fdf4 0%, #f5f5f7 100%);">
                <div class="document-wrapper"
                    style="min-height: 500px; max-width:1200px; margin:0 auto; background:white; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,0.1);">
                    <div class="doc-header"
                        style="padding:24px 30px; border-bottom:1px solid #e5e7eb; background:linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius:16px 16px 0 0;">
                        <div>
                            <div
                                style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color:#059669;">
                                DESIGN JIG ADMIN</div>
                            <h2 style="margin:0; font-size:26px; color:#064e3b; font-weight:700;">ğŸ’° ìš´ì˜ë¹„ ë° ê³ ì •ì§€ì¶œ ê´€ë¦¬ ëŒ€ì¥
                            </h2>

                            <!-- ì•ˆë‚´ ë¬¸êµ¬ ë°•ìŠ¤ -->
                            <div
                                style="margin-top:16px; padding:16px; background:rgba(255,255,255,0.6); border:1px solid rgba(16,185,129,0.2); border-radius:8px; font-size:13px; color:#065f46; line-height:1.6;">
                                <ul style="margin:0; padding-left:20px; list-style-type:disc;">
                                    <li>ë³¸ í™”ë©´ì€ í˜„ì¥ ê³µì‚¬ ì •ì‚°ì´ ì•„ë‹Œ, <b>ì„ëŒ€ë£ŒÂ·ê¸‰ì—¬Â·ì°¨ëŸ‰ë¹„Â·ì„¸ê¸ˆ</b> ë“± ì‚¬ì—…ì²´ ìš´ì˜ì„ ìœ„í•œ ë¹„ìš©ì„ ê´€ë¦¬í•˜ëŠ” ì‹œíŠ¸ì…ë‹ˆë‹¤.</li>
                                    <li>ìƒë‹¨ <b>'ì¡°íšŒ ì›”'</b>ì„ ê¸°ì¤€ìœ¼ë¡œ ê³ ì •ì§€ì¶œê³¼ ì›”ë³„ ìš´ì˜ë¹„ë¥¼ í•¨ê»˜ ê´€ë¦¬í•©ë‹ˆë‹¤.</li>
                                    <li><b>ê³ ì •ì§€ì¶œ í•­ëª©</b>ì€ í•œ ë²ˆ ì„¤ì •í•˜ë©´ ë§¤ë‹¬ ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤. (í•­ëª©ëª…, ê¸ˆì•¡ ìë™ ê³„ì‚°)</li>
                                    <li>í•˜ë‹¨ í‘œì—ëŠ” í•´ë‹¹ ì›”ì— ì‹¤ì œ ë°œìƒí•œ <b>ë³€ë™ ìš´ì˜ë¹„</b>ë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.</li>
                                    <li>ì´ ìš´ì˜ë¹„ í•©ê³„ëŠ” ì†ìµÂ·í†µê³„Â·ì„¸ë¬´ ì •ë¦¬ì˜ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <button onclick="saveExpensesToCloud()" id="btnSaveExpenses"
                                style="padding:10px 16px; background:linear-gradient(135deg, #3b82f6, #2563eb); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(59,130,246,0.3); transition:all 0.2s;">
                                â˜ï¸ ì €ì¥í•˜ê¸°
                            </button>
                            <button onclick="syncExpensesFromCloud()" id="btnLoadExpenses"
                                style="padding:10px 16px; background:white; color:#059669; border:2px solid #10b981; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.2s;">
                                ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>
                        </div>
                    </div>

                    <div style="padding:30px;">
                        <!-- ì›” ì„ íƒ ë° ê³ ì •ì§€ì¶œ ì„¤ì • ì˜ì—­ -->
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:12px;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <label style="font-weight:600; color:#374151; font-size:14px;">ğŸ“… ì¡°íšŒ ì›”:</label>
                                <input type="month" id="expenseMonthFilter" onchange="renderExpensesTable()"
                                    style="padding:8px 14px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; cursor:pointer;">
                            </div>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button onclick="addExpenseRow()"
                                    style="padding:10px 16px; background:linear-gradient(135deg, #10b981, #059669); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(16,185,129,0.3); transition:all 0.2s;">
                                    â• í–‰ ì¶”ê°€
                                </button>
                                <button onclick="toggleFixedExpenseSettings()"
                                    style="padding:10px 16px; background:linear-gradient(135deg, #f59e0b, #d97706); color:white; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px;">
                                    âš™ï¸ ê³ ì •ì§€ì¶œ ì„¤ì •
                                </button>
                            </div>
                        </div>

                        <!-- ê³ ì •ì§€ì¶œ ì„¤ì • íŒ¨ë„ (ì ‘ì´ì‹) -->
                        <div id="fixedExpenseSettingsPanel"
                            style="display:none; margin-bottom:24px; background:linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border:2px solid #f59e0b; border-radius:12px; padding:20px;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                                <h4 style="margin:0; color:#92400e; font-size:16px;">ğŸ”’ ê³ ì •ì§€ì¶œ í•­ëª© ì„¤ì •</h4>
                                <div style="display:flex; gap:8px;">
                                    <button onclick="addFixedExpenseItem()"
                                        style="padding:8px 14px; background:#d97706; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        â• í•­ëª© ì¶”ê°€
                                    </button>
                                    <button onclick="saveFixedExpensesToCloud()" id="btnSaveFixed"
                                        style="padding:8px 14px; background:#059669; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        ğŸ’¾ ì €ì¥
                                    </button>
                                    <button onclick="loadFixedExpensesFromCloud()" id="btnLoadFixed"
                                        style="padding:8px 14px; background:#3b82f6; color:white; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer;">
                                        ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°
                                    </button>
                                </div>
                            </div>
                            <p style="margin:0 0 12px 0; font-size:12px; color:#92400e;">ë§¤ì›” ìë™ìœ¼ë¡œ ë°˜ì˜ë˜ëŠ” ê³ ì • ë¹„ìš©ì…ë‹ˆë‹¤. (ì˜ˆ: ì„ëŒ€ë£Œ,
                                ì¸ê±´ë¹„, ì°¨ëŸ‰ìš´ì˜ë¹„ ë“±)</p>
                            <table
                                style="width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden;">
                                <thead>
                                    <tr style="background:#fef3c7;">
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:40px;">
                                        </th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:120px;">
                                            ëŒ€ë¶„ë¥˜</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e;">
                                            ìƒì„¸ë‚´ì—­</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:120px;">
                                            ì›” ê³ ì •ê¸ˆì•¡</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:100px;">
                                            ê²°ì œìˆ˜ë‹¨</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:100px;">
                                            ì¦ë¹™ìë£Œ</th>
                                        <th
                                            style="padding:10px 8px; border:1px solid #fcd34d; font-size:12px; color:#92400e; width:60px;">
                                            í™œì„±í™”</th>
                                    </tr>
                                </thead>
                                <tbody id="fixedExpenseTableBody">
                                    <!-- JSë¡œ ë Œë”ë§ -->
                                </tbody>
                            </table>
                        </div>

                        <table class="data-table" style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:linear-gradient(135deg, #f0fdf4, #ecfdf5);">
                                    <th
                                        style="width:50px; padding:12px 8px; border:1px solid #d1fae5; text-align:center; font-size:12px; color:#059669;">
                                        No</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ë‚ ì§œ</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ëŒ€ë¶„ë¥˜</th>
                                    <th
                                        style="width:200px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ìƒì„¸ë‚´ì—­</th>
                                    <th
                                        style="width:120px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ê¸ˆì•¡</th>
                                    <th
                                        style="width:100px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ê²°ì œìˆ˜ë‹¨</th>
                                    <th
                                        style="width:100px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ì¦ë¹™ìë£Œ</th>
                                    <th
                                        style="width:200px; padding:12px 8px; border:1px solid #d1fae5; font-size:12px; color:#059669;">
                                        ë¹„ê³ </th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <!-- JSë¡œ ë Œë”ë§ -->
                            </tbody>
                            <tfoot>
                                <tr style="background:linear-gradient(135deg, #fef3c7, #fde68a);">
                                    <td colspan="4"
                                        style="padding:14px 10px; text-align:center; font-weight:700; color:#92400e; font-size:14px;">
                                        ğŸ’µ ì´ ìš´ì˜ë¹„ í•©ê³„</td>
                                    <td style="padding:14px 10px; text-align:right; color:#dc2626; font-weight:700; font-size:16px;"
                                        id="totalExpenseFooter">â‚©0</td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Empty State -> Global Main Board -->
            <div id="mainBoardView" class="main-board-wrapper">
                <div class="main-board-header">
                    <div>
                        <h1>Project Overview</h1>
                        <p style="color:#86868b; font-size:13px; margin-top:4px; opacity:0.8;">ì „ì²´ í”„ë¡œì íŠ¸ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                    <div class="main-board-stats">
                        <select class="board-filter-select" id="mbYearFilter" onchange="renderMainBoard()">
                            <option value="">ì „ì²´ ë…„ë„</option>
                            <option value="2026">2026ë…„</option>
                            <option value="2025">2025ë…„</option>
                            <option value="2024">2024ë…„</option>
                        </select>
                        <select class="board-filter-select" id="mbStatusFilter" onchange="renderMainBoard()">
                            <option value="">ì „ì²´ ìƒíƒœ</option>
                            <option value="consulting">ìƒë‹´ì¤‘</option>
                            <option value="estimate">ê²¬ì </option>
                            <option value="contracted">ê³„ì•½ì™„ë£Œ</option>
                            <option value="in_progress">ê³µì‚¬ì¤‘</option>
                            <option value="completed">ì™„ë£Œ</option>
                            <option value="as_done">A/S</option>
                        </select>

                        <div class="board-stat-item">
                            <div class="board-stat-label">Total Projects</div>
                            <div class="board-stat-value" id="statsTotal">0</div>
                        </div>
                        <div class="board-stat-item">
                            <div class="board-stat-label">In Progress</div>
                            <div class="board-stat-value" id="statsProgress" style="color:#0071e3;">0</div>
                        </div>
                    </div>
                </div>

                <div id="mainBoardGrid" class="main-board-grid">
                    <!-- Project Cards will be rendered here via JS -->
                </div>

                <button onclick="newCustomer()" style="
                    position: fixed;
                    bottom: 40px;
                    right: 40px;
                    width: 60px;
                    height: 60px;
                    border-radius: 30px;
                    background: #0071e3;
                    color: white;
                    border: none;
                    text-align: center;
                    font-size: 24px;
                    box-shadow: 0 4px 12px rgba(0,113,227,0.3);
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    +
                </button>
            </div>

            <!-- ê³ ê° ìƒì„¸ ë·° -->
            <div id="customerView" style="display:none; position:relative;">
                <!-- ì ‘ê·¼ ì œí•œ ì˜¤ë²„ë ˆì´ -->
                <div id="accessDeniedOverlay" class="access-denied-overlay">
                    <div style="font-size:48px; margin-bottom:16px;">ğŸ”’</div>
                    <h3 style="margin-bottom:10px;">ì ‘ê·¼ì´ ì œí•œëœ ê³ ê°ì…ë‹ˆë‹¤</h3>
                    <p style="color:#86868b; margin-bottom:24px;">ì´ ê³ ê° ì •ë³´ì— ì ‘ê·¼í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
                    <div style="display:flex; gap:8px;">
                        <input type="password" id="lockedPasswordInput" class="login-input"
                            style="width:200px; margin:0;" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                            onkeypress="if(event.key==='Enter')unlockCustomerAccess()">
                        <button class="btn btn-primary" onclick="unlockCustomerAccess()">í™•ì¸</button>
                    </div>
                </div>
                <!-- ê³ ê° í—¤ë” -->
                <div class="customer-header-bar">
                    <div class="customer-header-left">
                        <h2 id="headerCustomerName">ê³ ê°ëª…</h2>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <div class="customer-id-display" id="headerCustomerId">DJ-000000</div>
                            <button id="lockToggleBtn" onclick="toggleCustomerLock()"
                                class="lock-toggle-btn unlocked">ğŸ”“ ì—´ë¦¼</button>
                            <span id="headerCreatedBy" style="font-size:10px;color:#86868b;">ğŸ“ -</span>
                        </div>
                    </div>
                    <div class="customer-header-right">
                        <select id="customerStatus" onchange="updateStatus()">
                            <option value="consulting">ğŸŸ¡ ìƒë‹´ì¤‘</option>
                            <option value="estimate">ğŸ“‹ ê²¬ì ì„œ</option>
                            <option value="hold">âšª ë³´ë¥˜(ê³ ë¯¼ì¤‘)</option>
                            <option value="budget_over">ğŸ”´ ì˜ˆì‚°ì´ˆê³¼(ë¯¸ê³„ì•½)</option>
                            <option value="other_company">ğŸŸ£ íƒ€ì—…ì²´ì„ ì •(ë¯¸ê³„ì•½)</option>
                            <option value="contracted">ğŸŸ¢ ê³„ì•½ì™„ë£Œ</option>
                            <option value="in_progress">ğŸŸ£ ê³µì‚¬ì¤‘</option>
                            <option value="completed">ğŸŸ¢ ê³µì‚¬ì™„ë£Œ</option>
                            <option value="as_done">ğŸ©µ A/S</option>
                        </select>
                        <span id="asEndDateDisplay"
                            style="display:none; padding:8px 12px; background:rgba(255,255,255,0.2); border-radius:6px; font-size:11px;">A/S
                            ~</span>
                        <button onclick="saveData()"
                            style="padding: 6px 12px; margin-left: 8px; border: 1px solid #ffcfd6; background: #fff0f5; border-radius: 6px; font-size: 12px; cursor: pointer; color: #d63384; font-weight: 600;">ğŸ’¾
                            ì €ì¥</button>
                        <button onclick="exportToNotion('all', event);"
                            style="padding: 6px 12px; margin-left: 8px; border: none; background: #37352f; border-radius: 6px; font-size: 12px; cursor: pointer; color: white; display: inline-flex; align-items: center; gap: 4px; font-weight: 500;"
                            title="ê³ ê°ì •ë³´, ìŠ¤ì¼€ì¤„, ì²´í¬ë¦¬ìŠ¤íŠ¸, A/S ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë…¸ì…˜ìœ¼ë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤">
                            ğŸ“¤ í†µí•© ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°</button>
                        <button onclick="printCurrentCustomerAll()"
                            style="padding: 6px 12px; margin-left: 8px; border: 1px solid #d2d2d7; background: white; border-radius: 6px; font-size: 12px; cursor: pointer; color: #1d1d1f;">ğŸ–¨ï¸
                            í†µí•©ì¸ì‡„</button>
                        <button class="delete-btn" onclick="deleteCurrentCustomer()">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <div class="customer-tabs">
                    <button class="customer-tab active" onclick="showCustomerTab('dashboard')" data-tab="dashboard">ğŸ 
                        ë©”ì¸ ëŒ€ì‹œë³´ë“œ</button>
                    <button class="customer-tab" onclick="showCustomerTab('info')" data-tab="info">ğŸ‘¤
                        ê³ ê°ì •ë³´</button>
                    <button class="customer-tab" onclick="showCustomerTab('contract')" data-tab="contract">ğŸ“‹
                        ë„ê¸‰ê³„ì•½ì„œ</button>
                    <button class="customer-tab" onclick="showCustomerTab('cover')" data-tab="cover">ğŸ“Š í‘œì§€ê³„ì•½ì„œ</button>
                    <button class="customer-tab" onclick="showCustomerTab('estimate')" data-tab="estimate">ğŸ“
                        ê³„ì•½ê²¬ì ì„œ</button>
                    <button class="customer-tab" onclick="showCustomerTab('cost')" data-tab="cost">ğŸ’° ì›ê°€ê´€ë¦¬í‘œ</button>
                    <button class="customer-tab" onclick="showCustomerTab('schedule')" data-tab="schedule">ğŸ“…
                        ê³µì‚¬ ìŠ¤ì¼€ì¤„</button>
                    <button class="customer-tab" onclick="showCustomerTab('checklist')" data-tab="checklist">âœ…
                        ê³µì • ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
                    <button class="customer-tab" onclick="showCustomerTab('as_list')" data-tab="as_list">ğŸ› ï¸
                        A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸</button>
                    <button class="customer-tab" onclick="showCustomerTab('settlement')" data-tab="settlement">ğŸ’°
                        ì •ì‚° ê´€ë¦¬ ëŒ€ì¥</button>
                    <button class="customer-tab" onclick="showCustomerTab('stats')" data-tab="stats">ğŸ“‹ í˜„í™© ë°
                        ì‘ì—…ê¸°ë¡</button>
                </div>

                <!-- ëŒ€ì‹œë³´ë“œ íŒ¨ë„ (New) -->
                <div class="tab-panel active" id="panel-dashboard">
                    <div class="dashboard-container">
                        <div class="dashboard-grid">
                            <!-- 1. í”„ë¡œí•„ ì¹´ë“œ -->
                            <div class="dashboard-card card-profile">
                                <div class="profile-header">
                                    <div class="profile-avatar" id="dashAvatar">?</div>
                                    <div class="profile-info">
                                        <h2 id="dashName">ê³ ê°ëª…</h2>
                                        <p id="dashPhone">ì„±ëª…(ì—°ë½ì²˜) | ë°°ìš°ì(ì—°ë½ì²˜)</p>
                                    </div>
                                </div>
                                <div class="profile-details">
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">í˜„ì¥ì£¼ì†Œ</div>
                                        <div class="profile-detail-value" id="dashAddress">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">í‰ìˆ˜/ìœ í˜•</div>
                                        <div class="profile-detail-value" id="dashAreaType">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">ê³„ì•½ì¼</div>
                                        <div class="profile-detail-value" id="dashContractDate">-</div>
                                    </div>
                                    <div class="profile-detail-item">
                                        <div class="profile-detail-label">ì´ ê³„ì•½ê¸ˆì•¡ (VAT í¬í•¨)</div>
                                        <div class="profile-detail-value" id="dashContractAmount">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. ìƒíƒœ/ì¼ì • ì¹´ë“œ -->
                            <div class="dashboard-card card-status">
                                <h3>ğŸš€ ì§„í–‰ í˜„í™©</h3>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                                    <span id="dashStatusBadge" class="status-badge"
                                        style="font-size:14px; padding:6px 12px; background:#f5f5f7; color:#86868b;">ìƒë‹´ì¤‘</span>
                                    <span id="dashDDay" class="d-day-badge" style="display:none;">D-Day</span>
                                </div>
                                <!-- ê¸°ê°„ ì •ë³´ ê·¸ë¦¬ë“œ -->
                                <div
                                    style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px; font-size:13px;">
                                    <div style="background:#f5f5f7; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#86868b; font-size:11px; margin-bottom:4px;">ê³µì‚¬ ê¸°ê°„</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashPeriod">- ~ -</div>
                                    </div>
                                    <div style="background:#f5f5f7; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#86868b; font-size:11px; margin-bottom:4px;">ì´ì‚¬ì˜ˆì •ì¼</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashMovingDate">-</div>
                                    </div>
                                    <div style="background:#e8f5e9; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#2e7d32; font-size:11px; margin-bottom:4px;">A/S ê¸°ê°„ (ì”ê¸ˆì¼+12ê°œì›”)
                                        </div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashASPeriod">-</div>
                                    </div>
                                    <div style="background:#e3f2fd; padding:10px 12px; border-radius:8px;">
                                        <div style="color:#1565c0; font-size:11px; margin-bottom:4px;">í™”ì¥ì‹¤ ëˆ„ìˆ˜ ë³´ì¦</div>
                                        <div style="color:#1d1d1f; font-weight:600;" id="dashBathroomWarranty">-</div>
                                    </div>
                                </div>
                                <!-- ìƒíƒœ íƒ€ì„ë¼ì¸ -->
                                <div class="status-timeline">
                                    <div class="timeline-bar"></div>
                                    <div class="timeline-progress" id="dashProgressWidth" style="width: 0%;"></div>
                                    <!-- Steps -->
                                    <div class="timeline-step active" id="step-consulting">
                                        <div class="timeline-label">ìƒë‹´</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-contract">
                                        <div class="timeline-label">ê³„ì•½</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-construction">
                                        <div class="timeline-label">ê³µì‚¬ì¤‘</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                    <div class="timeline-step" id="step-completed">
                                        <div class="timeline-label">ì™„ë£Œ</div>
                                        <div class="timeline-dot"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. ì›ê°€/ì •ì‚° ìš”ì•½ (í´ë¦­ ì‹œ ì›ê°€ê´€ë¦¬í‘œë¡œ ì´ë™) -->
                            <button class="dashboard-card card-cost-summary" onclick="showCustomerTab('cost')">
                                <h3>ğŸ’° ìš´ì˜ ì›ê°€ ìš”ì•½ <span
                                        style="font-size:12px; font-weight:400; opacity:0.7; margin-left:auto;">í´ë¦­í•˜ì—¬ ìƒì„¸
                                        ë³´ê¸° â†’</span></h3>
                                <div class="cost-summary-grid">
                                    <div class="cost-stat-item">
                                        <div class="cost-stat-label">ì´ ê³„ì•½ê¸ˆì•¡</div>
                                        <div class="cost-stat-value" id="dashTotalAmount">0</div>
                                    </div>
                                    <div class="cost-stat-item">
                                        <div class="cost-stat-label">ì´ ì§€ì¶œ(ì›ê°€)</div>
                                        <div class="cost-stat-value" id="dashTotalCost">0</div>
                                    </div>
                                    <div class="cost-stat-item profit">
                                        <div class="cost-stat-label">ì˜ˆìƒ ìˆœì´ìµ</div>
                                        <div class="cost-stat-value" id="dashNetProfit">0</div>
                                    </div>
                                    <div class="cost-stat-item">
                                        <div class="cost-stat-label">ìˆ˜ìµë¥ </div>
                                        <div class="cost-stat-value" id="dashProfitRate">0%</div>
                                    </div>
                                </div>
                            </button>

                            <!-- 4. ë„¤ë¹„ê²Œì´ì…˜ ê·¸ë¦¬ë“œ -->
                            <!-- 4. ë„¤ë¹„ê²Œì´ì…˜ ê·¸ë¦¬ë“œ (ì‚­ì œë¨) -->
                        </div>
                    </div>
                </div>

                <!-- ê³ ê°ì •ë³´ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-info">
                    <div class="document-wrapper" id="customerInfoDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>ê³ ê° ì •ë³´</h1>
                                <div class="subtitle">Customer Information</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('customer', event);"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;"
                                    title="ë…¸ì…˜ìœ¼ë¡œ ê³ ê° ì •ë³´ë§Œ ë‚´ë³´ë‚´ê¸°">
                                    ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°
                                </button>
                                <button class="pdf-btn" onclick="downloadPDF('customerInfoDoc', 'ê³ ê°ì •ë³´')">ğŸ–¨ï¸
                                    ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <div class="section">
                                <div class="section-title"><span class="section-number">01</span> ì¸ì ì‚¬í•­</div>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>ì„±ëª…</label>
                                        <input type="text" class="customer-field" data-field="clientName"
                                            placeholder="ê³ ê° ì„±í•¨" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ì—°ë½ì²˜</label>
                                        <input type="text" class="customer-field" data-field="clientPhone"
                                            placeholder="010-0000-0000"
                                            oninput="autoFormatPhone(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ë°°ìš°ì ì„±ëª…</label>
                                        <input type="text" class="customer-field" data-field="spouseName"
                                            placeholder="ë°°ìš°ì ì„±í•¨" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ë°°ìš°ì ì—°ë½ì²˜</label>
                                        <input type="text" class="customer-field" data-field="spousePhone"
                                            placeholder="010-0000-0000"
                                            oninput="autoFormatPhone(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item full">
                                        <label>ì£¼ì†Œ</label>
                                        <input type="text" class="customer-field" data-field="clientAddress"
                                            placeholder="ê³ ê° ì£¼ì†Œ" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ì´ë©”ì¼</label>
                                        <input type="email" class="customer-field" data-field="clientEmail"
                                            placeholder="email@example.com" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ìœ ì…ê²½ë¡œ</label>
                                        <input type="text" class="customer-field" data-field="clientSource"
                                            placeholder="ë¸”ë¡œê·¸, ì†Œê°œ ë“±" oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">02</span> ê³µì‚¬ì •ë³´</div>
                                <div class="info-grid">
                                    <div class="info-item full">
                                        <label>ê³µì‚¬ëª…</label>
                                        <input type="text" class="customer-field synced-input" data-field="projectName"
                                            data-sync="projectName" onchange="updateCustomerField(this)"
                                            placeholder="ê³µì‚¬ëª… ì…ë ¥">
                                    </div>
                                    <div class="info-item full">
                                        <label>í˜„ì¥ì£¼ì†Œ</label>
                                        <input type="text" class="customer-field" data-field="siteAddress"
                                            placeholder="í˜„ì¥ ì£¼ì†Œ" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>í‰ìˆ˜</label>
                                        <input type="text" class="customer-field" data-field="area" placeholder="00í‰"
                                            oninput="updateCustomerField(this)"
                                            onblur="autoFormatArea(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ê±´ë¬¼ìœ í˜•</label>
                                        <input type="text" class="customer-field" data-field="buildingType"
                                            placeholder="ì•„íŒŒíŠ¸, ë¹Œë¼ ë“±" oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ê³µì‚¬ê¸°ê°„ (ì‹œì‘ ~ ì¢…ë£Œ)</label>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="date" id="constructionStartInput" class="customer-field"
                                                style="flex: 1; padding: 8px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;"
                                                oninput="updateConstructionPeriod()">
                                            <span>~</span>
                                            <input type="date" id="constructionEndInput" class="customer-field"
                                                style="flex: 1; padding: 8px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;"
                                                oninput="updateConstructionPeriod()">
                                        </div>
                                        <input type="hidden" class="customer-field" data-field="constructionPeriod"
                                            id="hiddenConstructionPeriod">
                                    </div>
                                    <div class="info-item">
                                        <label>ì´ì‚¬ì˜ˆì •ì¼</label>
                                        <input type="date" class="customer-field" data-field="movingDate"
                                            placeholder="ì—°ë„. ì›”. ì¼." oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ì”ê¸ˆì¼</label>
                                        <input type="date" class="customer-field" data-field="finalPaymentDate"
                                            oninput="updateCustomerField(this); calculateAsEndDate();">
                                    </div>
                                    <div class="info-item">
                                        <label>A/S ê¸°ê°„ (ì”ê¸ˆì¼ +12ê°œì›”)</label>
                                        <input type="text" class="customer-field" data-field="asEndDate"
                                            placeholder="ìë™ ê³„ì‚°" readonly
                                            style="background:#f0f7ff; color:#0071e3; font-weight:600;">
                                    </div>
                                    <div class="info-item">
                                        <label>ê¸°ì—…ì´ìœ¨</label>
                                        <input type="text" class="customer-field" data-field="profitRate"
                                            placeholder="15%" value="15%" oninput="updateCustomerField(this)"
                                            onblur="autoFormatProfit(this); updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ê³µì‚¬ ë‹´ë‹¹ì</label>
                                        <input type="text" class="customer-field" data-field="manager"
                                            placeholder="ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)" value="ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ê³„ì•½ì¼</label>
                                        <input type="date" class="customer-field" data-field="contractDate"
                                            placeholder="ì—°ë„. ì›”. ì¼." oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="info-item">
                                        <label>ì´ ê³„ì•½ê¸ˆì•¡ (VAT í¬í•¨)</label>
                                        <input type="text" class="customer-field" data-field="totalAmount"
                                            placeholder="â‚© 0,000,000" oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">03</span> ëŒ€ê¸ˆ ì§€ê¸‰</div>
                                <div class="payment-grid">
                                    <div class="payment-item">
                                        <label>1ì°¨ ê³„ì•½ê¸ˆ</label>
                                        <input type="text" class="customer-field" data-field="payment1" placeholder="â‚©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>2ì°¨ ì¤‘ë„ê¸ˆ</label>
                                        <input type="text" class="customer-field" data-field="payment2" placeholder="â‚©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>3ì°¨ ì¤‘ë„ê¸ˆ</label>
                                        <input type="text" class="customer-field" data-field="payment3" placeholder="â‚©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>4ì°¨ ì¤‘ë„ê¸ˆ</label>
                                        <input type="text" class="customer-field" data-field="payment4" placeholder="â‚©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                    <div class="payment-item">
                                        <label>ì”ê¸ˆ</label>
                                        <input type="text" class="customer-field" data-field="payment5" placeholder="â‚©"
                                            oninput="updateCustomerField(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">04</span> ë©”ëª¨</div>
                                <div class="info-grid">
                                    <div class="info-item full">
                                        <label>ê³ ê° ìš”ì²­ì‚¬í•­</label>
                                        <textarea class="customer-field" data-field="customerRequest" rows="3"
                                            placeholder="ê³ ê°ì´ ìš”ì²­í•œ ì‚¬í•­ì„ ê¸°ë¡í•˜ì„¸ìš”..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                    <div class="info-item full">
                                        <label>íŠ¹ì•½ì‚¬í•­</label>
                                        <textarea class="customer-field" data-field="specialNote" rows="3"
                                            placeholder="íŠ¹ì•½ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                    <div class="info-item full">
                                        <label>ë‚´ë¶€ ë©”ëª¨</label>
                                        <textarea class="customer-field" data-field="internalMemo" rows="3"
                                            placeholder="ë‚´ë¶€ ì°¸ê³ ìš© ë©”ëª¨..." oninput="updateCustomerField(this)"
                                            style="width:100%;resize:vertical;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë„ê¸‰ê³„ì•½ì„œ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-contract">
                    <div class="document-wrapper" id="contractDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>ì¸í…Œë¦¬ì–´ ê³µì‚¬ ë„ê¸‰ê³„ì•½ì„œ</h1>
                                <div class="subtitle">Interior Construction Contract</div>
                            </div>
                            <button class="pdf-btn" onclick="downloadPDF('contractDoc', 'ë„ê¸‰ê³„ì•½ì„œ')">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
                        </div>
                        <div class="doc-content">
                            <p
                                style="background:#f5f5f7; padding:12px; border-radius:6px; margin-bottom:16px; line-height:1.5; font-size:11px; color:#424245;">
                                ë°œì£¼ì(ì´í•˜ "ê°‘")ì™€ ìˆ˜ê¸‰ì¸(ì´í•˜ "ì„")ì€ ì•„ë˜ì˜ ì¸í…Œë¦¬ì–´ ê³µì‚¬ì— ê´€í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ë„ê¸‰ê³„ì•½ì„ ì²´ê²°í•˜ê³ , ì‹ ì˜ì„±ì‹¤ì˜ ì›ì¹™ì— ë”°ë¼ ì´ë¥¼ ì´í–‰í•  ê²ƒì„
                                í™•ì•½í•©ë‹ˆë‹¤.
                            </p>

                            <div class="section">
                                <div class="section-title"><span class="section-number">01</span> ê³µì‚¬ ê°œìš”</div>
                                <div class="info-grid">
                                    <div class="info-item full"><label>ê³µì‚¬ëª…</label><input type="text"
                                            class="synced-input" data-sync="projectName" readonly></div>
                                    <div class="info-item full"><label>í˜„ì¥ì£¼ì†Œ</label><input type="text"
                                            class="synced-input" data-sync="siteAddress" readonly></div>
                                    <div class="info-item"><label>ê³µì‚¬ê¸°ê°„</label><input type="text" class="synced-input"
                                            data-sync="constructionPeriod" readonly></div>
                                    <div class="info-item"><label>ì´ì‚¬ì˜ˆì •ì¼</label><input type="text" class="synced-input"
                                            data-sync="movingDate" readonly></div>
                                    <div class="info-item full"><label>ì´ ê³„ì•½ê¸ˆì•¡ (VAT í¬í•¨)</label><input type="text"
                                            class="synced-input" data-sync="totalAmount" readonly></div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">02</span> ëŒ€ê¸ˆ ì§€ê¸‰ ì¼ì •</div>
                                <div class="payment-grid">
                                    <div class="payment-item"><label>1ì°¨ ê³„ì•½ê¸ˆ</label><input type="text"
                                            class="synced-input" data-sync="payment1" readonly></div>
                                    <div class="payment-item"><label>2ì°¨ ì¤‘ë„ê¸ˆ</label><input type="text"
                                            class="synced-input" data-sync="payment2" readonly></div>
                                    <div class="payment-item"><label>3ì°¨ ì¤‘ë„ê¸ˆ</label><input type="text"
                                            class="synced-input" data-sync="payment3" readonly></div>
                                    <div class="payment-item"><label>4ì°¨ ì¤‘ë„ê¸ˆ</label><input type="text"
                                            class="synced-input" data-sync="payment4" readonly></div>
                                    <div class="payment-item"><label>ì”ê¸ˆ</label><input type="text" class="synced-input"
                                            data-sync="payment5" readonly></div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title"><span class="section-number">03</span> ê³„ì•½ ì¡°ê±´</div>
                                <div class="clause">
                                    <div class="clause-title">ì œ1ì¡° (ê³„ì•½ì˜ ëª©ì )</div>
                                    <div class="clause-content">ë³¸ ê³„ì•½ì€ ê°‘ì´ ì„ì—ê²Œ ìƒê¸° í˜„ì¥ì˜ ì¸í…Œë¦¬ì–´ ê³µì‚¬ë¥¼ ë„ê¸‰í•˜ê³ , ì„ì€ ì´ë¥¼ ì„±ì‹¤íˆ ì‹œê³µí•˜ì—¬ ì™„ê³µí•¨ì„
                                        ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause important-clause">
                                    <div class="clause-title">âš  ì œ2ì¡° (ê³„ì•½ì„œ ë° ê²¬ì ì„œì˜ íš¨ë ¥)</div>
                                    <div class="clause-content">â‘  ëª¨ë“  ê³„ì•½ì„œ ë° ê²¬ì ì„œì—ëŠ” ë°˜ë“œì‹œ ê°‘ê³¼ ì„ ìŒë°©ì˜ ì§€ì¥(ì§ì¸)ì„ ë‚ ì¸í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.<br>â‘¡
                                        ì§€ì¥ì´ ë‚ ì¸ë˜ì§€ ì•Šì€ ë¬¸ì„œëŠ” ë²•ì  íš¨ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ3ì¡° (ê³µì‚¬ ë²”ìœ„ ë° ë‚´ìš©)</div>
                                    <div class="clause-content">ê³µì‚¬ ë²”ìœ„ ë° ì„¸ë¶€ ë‚´ìš©ì€ ë³„ë„ ì²¨ë¶€ëœ ê²¬ì ì„œ ë° ë„ë©´ì— ë”°ë¦…ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ4ì¡° (ëŒ€ê¸ˆ ì§€ê¸‰)</div>
                                    <div class="clause-content">ê³„ì•½ê¸ˆì•¡ì€ ìœ„ í‘œì— ëª…ì‹œëœ ì§€ê¸‰ ì¼ì •ì— ë”°ë¼ ì§€ê¸‰í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ5ì¡° (ê³µì‚¬ ê¸°ê°„)</div>
                                    <div class="clause-content">ì„ì€ ê³„ì•½ì„œì— ëª…ì‹œëœ ê³µì‚¬ ê¸°í•œ ë‚´ì— ê³µì‚¬ë¥¼ ì™„ë£Œí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ6ì¡° (ì§€ì²´ìƒê¸ˆ)</div>
                                    <div class="clause-content">ì •ë‹¹í•œ ì‚¬ìœ  ì—†ì´ ê³µê¸° ì§€ì²´ ì‹œ ê³„ì•½ê¸ˆì•¡ì˜ 1/1000 ì§€ì²´ìƒê¸ˆì„ ë¶€ë‹´í•©ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ7ì¡° (í•˜ìë³´ìˆ˜)</div>
                                    <div class="clause-content">ì„ì€ ê³µì‚¬ ì™„ë£Œì¼ë¡œë¶€í„° 1ë…„ê°„ í•˜ìì— ëŒ€í•´ ë¬´ìƒ ë³´ìˆ˜ ì±…ì„ì„ ì§‘ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ8ì¡° (ì•ˆì „ ê´€ë¦¬)</div>
                                    <div class="clause-content">ì„ì€ ê³µì‚¬ ê¸°ê°„ ì¤‘ í˜„ì¥ì˜ ì•ˆì „ ê´€ë¦¬ ì±…ì„ì„ ì§‘ë‹ˆë‹¤.</div>
                                </div>
                                <div class="clause">
                                    <div class="clause-title">ì œ9ì¡° (ë¶„ìŸ í•´ê²°)</div>
                                    <div class="clause-content">ë¶„ìŸì€ ì„ì˜ ì£¼ì†Œì§€ ê´€í•  ë²•ì›ì„ ì „ì† ê´€í• ë¡œ í•©ë‹ˆë‹¤.</div>
                                </div>
                            </div>

                            <div class="special-note">
                                <div class="special-note-title">ğŸ“ íŠ¹ì•½ì‚¬í•­</div>
                                <textarea class="synced-input" data-sync="specialNote" readonly
                                    style="min-height:40px;"></textarea>
                            </div>

                            <div class="date-box">
                                <label>ê³„ì•½ ì²´ê²°ì¼</label>
                                <input type="text" class="synced-input" data-sync="contractDate" readonly>
                            </div>

                            <div class="signature-grid">
                                <div class="signature-card">
                                    <h4>ë°œì£¼ì (ê°‘)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ì„±ëª…</label><input type="text" class="synced-input"
                                                data-sync="clientName" readonly></div>
                                        <div class="sig-field"><label>ì—°ë½ì²˜</label><input type="text" class="synced-input"
                                                data-sync="clientPhone" readonly></div>
                                    </div>
                                    <div class="sig-field"><label>ì£¼ì†Œ</label><input type="text" class="synced-input"
                                            data-sync="clientAddress" readonly></div>
                                    <div class="signature-box">ì„œëª… ë˜ëŠ” ë‚ ì¸</div>
                                    <div class="stamp-warning">âš  ì§€ì¥(ì§ì¸) í•„ìˆ˜ ë‚ ì¸</div>
                                </div>
                                <div class="signature-card">
                                    <h4>ìˆ˜ê¸‰ì¸ (ì„)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ìƒí˜¸</label><input type="text" value="ë””ìì¸ì§€ê·¸"
                                                readonly></div>
                                        <div class="sig-field"><label>ëŒ€í‘œì</label><input type="text" id="companyRep"
                                                placeholder="ëŒ€í‘œìëª…"></div>
                                    </div>
                                    <div class="sig-field"><label>ì‚¬ì—…ì¥ ì£¼ì†Œ</label><input type="text" value="ê²½ê¸°ë„ ìš©ì¸ì‹œ ë³´ì •ë™"
                                            readonly></div>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label><input type="text"
                                                id="companyRegNo" placeholder="000-00-00000"></div>
                                        <div class="sig-field"><label>ì—°ë½ì²˜</label><input type="text" id="companyPhone"
                                                placeholder="ì—°ë½ì²˜"></div>
                                    </div>
                                    <div class="signature-box">ì„œëª… ë˜ëŠ” ë‚ ì¸</div>
                                    <div class="stamp-warning">âš  ì§€ì¥(ì§ì¸) í•„ìˆ˜ ë‚ ì¸</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í‘œì§€ê³„ì•½ì„œ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-cover">
                    <div class="document-wrapper" id="coverDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>ê³µì‚¬ë„ê¸‰ í‘œì§€ê³„ì•½ì„œ</h1>
                                <div class="subtitle">Construction Contract Summary</div>
                            </div>
                            <button class="pdf-btn" onclick="downloadPDF('coverDoc', 'í‘œì§€ê³„ì•½ì„œ')">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
                        </div>
                        <div class="doc-content">
                            <div class="info-grid" style="margin-bottom:16px;">
                                <div class="info-item full"><label>ê³µì‚¬ëª…</label>
                                    <div class="synced-display" data-sync="projectName"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item full"><label>í˜„ì¥ì£¼ì†Œ</label>
                                    <div class="synced-display" data-sync="siteAddress"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item"><label>ê³ ê°ëª…</label>
                                    <div class="synced-display" data-sync="clientName"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                                <div class="info-item"><label>ê³µì‚¬ê¸°ê°„</label>
                                    <div class="synced-display" data-sync="constructionPeriod"
                                        style="font-size:12px;font-weight:500;padding:3px 0;">-</div>
                                </div>
                            </div>

                            <div class="section-title"><span class="section-number">01</span> ê³µì‚¬ í•­ëª©ë³„ ê³„ì•½ê¸ˆì•¡</div>
                            <table class="summary-table">
                                <thead>
                                    <tr>
                                        <th style="width:30px;">No</th>
                                        <th>ê³µì‚¬ í•­ëª©</th>
                                        <th style="width:130px;text-align:right;">ê³„ì•½ ê¸ˆì•¡</th>
                                    </tr>
                                </thead>
                                <tbody id="coverTableBody"></tbody>
                            </table>

                            <div class="date-box">
                                <label>ê³„ì•½ ì²´ê²°ì¼</label>
                                <div class="synced-display" data-sync="contractDate"
                                    style="font-size:13px;font-weight:600;">-</div>
                            </div>

                            <div class="signature-grid">
                                <div class="signature-card">
                                    <h4>ë°œì£¼ì (ê°‘)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ì„±ëª…</label><input type="text" class="synced-input"
                                                data-sync="clientName" readonly></div>
                                        <div class="sig-field"><label>ì—°ë½ì²˜</label><input type="text" class="synced-input"
                                                data-sync="clientPhone" readonly></div>
                                    </div>
                                    <div class="signature-box">ì„œëª… ë˜ëŠ” ë‚ ì¸</div>
                                    <div class="stamp-warning">âš  ì§€ì¥(ì§ì¸) í•„ìˆ˜</div>
                                </div>
                                <div class="signature-card">
                                    <h4>ìˆ˜ê¸‰ì¸ (ì„)</h4>
                                    <div class="sig-row">
                                        <div class="sig-field"><label>ìƒí˜¸</label><input type="text" value="ë””ìì¸ì§€ê·¸"
                                                readonly></div>
                                        <div class="sig-field"><label>ëŒ€í‘œì</label><input type="text" class="company-sync"
                                                data-sync="companyRep" readonly></div>
                                    </div>
                                    <div class="signature-box">ì„œëª… ë˜ëŠ” ë‚ ì¸</div>
                                    <div class="stamp-warning">âš  ì§€ì¥(ì§ì¸) í•„ìˆ˜</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê³„ì•½ê²¬ì ì„œ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-estimate">
                    <div class="document-wrapper" id="estimateDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>ê³„ì•½ ê²¬ì ì„œ</h1>
                                <div class="subtitle">Contract Estimate</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sample-btn no-print" onclick="openSampleEstimateModal()"
                                    style="background: #ff9500; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ìƒ˜í”Œ ê²¬ì ì„œ">ğŸ“‹ ìƒ˜í”Œ</button>
                                <button class="pdf-btn" onclick="downloadPDF('estimateDoc', 'ê³„ì•½ê²¬ì ì„œ')">ğŸ–¨ï¸
                                    ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <p class="no-print"
                                style="background:#e8f4fd; padding:10px 14px; border-radius:6px; margin-bottom:16px; font-size:11px; color:#0071e3;">
                                â„¹ï¸ êµ¬ë¶„/í’ˆëª… ì„ íƒ ì‹œ ë‹¨ê°€ ìë™ ì…ë ¥. ëª¨ë“  ë“œë¡­ë‹¤ìš´(êµ¬ë¶„Â·í’ˆëª…Â·ìƒì„¸)ì„ ë”ë¸”í´ë¦­í•˜ë©´ ì§ì ‘ í¸ì§‘ ê°€ëŠ¥. ë‹¨ìœ„/ë‹¨ê°€ëŠ” í´ë¦­ìœ¼ë¡œ ìˆ˜ì •. ESCë¡œ ë“œë¡­ë‹¤ìš´
                                ë³µê·€.
                            </p>
                            <div id="estimateCategories"></div>
                            <div class="grand-total">
                                <div class="total-row"><label>ê³µê¸‰ê°€ì•¡ í•©ê³„</label>
                                    <div class="amount" id="estimateSubtotal">â‚© 0</div>
                                </div>
                                <div class="total-row profit-rate-row">
                                    <label>ê¸°ì—…ì´ìœ¤ìœ¨</label>
                                    <div class="profit-rate-input">
                                        <input type="number" id="estimateProfitRate" value="15" min="0" max="100"
                                            onchange="updateEstimateTotals()">
                                        <span>%</span>
                                    </div>
                                </div>
                                <div class="total-row"><label>ê¸°ì—…ì´ìœ¤</label>
                                    <div class="amount" id="estimateProfit">â‚© 0</div>
                                </div>
                                <div class="total-row"><label>ë¶€ê°€ê°€ì¹˜ì„¸ (VAT 10%)</label>
                                    <div class="amount" id="estimateVat">â‚© 0</div>
                                </div>
                                <div class="total-row main"><label>ì´ ê²¬ì ê¸ˆì•¡</label>
                                    <div class="amount" id="estimateTotal">â‚© 0</div>
                                </div>
                            </div>
                            <!-- ì‘ì„±ì í‘œì‹œ -->
                            <div class="estimate-author no-print"
                                style="text-align:right; margin-top:16px; padding:12px 16px; background:#f5f5f7; border-radius:8px; font-size:12px; color:#666;">
                                ğŸ“ ì‘ì„±ì: <span id="estimateAuthor">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì›ê°€ê´€ë¦¬í‘œ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-cost">
                    <div class="document-wrapper" id="costDoc">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1>ê³µì‚¬ ì›ê°€ê´€ë¦¬í‘œ</h1>
                                <div class="subtitle">Construction Cost Management</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sync-btn no-print" onclick="syncCostFromCloud()"
                                    style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="Google Sheetsì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°">â˜ï¸â†“ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                                <span class="no-print"
                                    style="font-size: 11px; color: #ff3b30; font-weight: 600;">(Master Read-Only)</span>

                                <button class="pdf-btn" onclick="downloadPDF('costDoc', 'ì›ê°€ê´€ë¦¬í‘œ')">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content">
                            <!-- ì ê¸ˆ ìƒíƒœ í‘œì‹œ -->
                            <div class="cost-lock-overlay" id="costLockOverlay">
                                <div class="lock-info">
                                    <span>ğŸ”’</span>
                                    <span>ì›ê°€ê´€ë¦¬í‘œëŠ” ê´€ë¦¬ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</span>
                                </div>
                                <button class="unlock-btn" onclick="showAdminModal()">ğŸ”“ ì ê¸ˆ í•´ì œ</button>
                            </div>
                            <!-- ê´€ë¦¬ì ì„¤ì • (ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ) -->
                            <div class="settings-section" id="adminSettings" style="display:none;">
                                <h4>âš™ï¸ ê´€ë¦¬ì ì„¤ì •</h4>
                                <div class="settings-row" style="display: none;">
                                    <input type="password" id="changePassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
                                    <button onclick="changeAdminPassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                                </div>
                                <button onclick="logoutAdmin()"
                                    style="width:100%; margin-top:8px; padding:12px; border-radius:12px; border:1px solid #ff3b30; background:#fff; color:#ff3b30; font-size:12px; font-weight:600; cursor:pointer;">ğŸ”’
                                    ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ</button>
                            </div>
                            <div id="costCategoriesWrapper" class="cost-locked">
                                <div id="costCategories"></div>
                            </div>
                            <div
                                style="background:#fbfbfd; border-radius:8px; padding:14px; margin-top:16px; border:1px solid #e8e8ed;">
                                <div class="section-title"
                                    style="margin-bottom:8px; border:none; padding:0; font-size:12px;">ğŸ“Š ìˆ˜ìµ ë¶„ì„</div>
                                <div class="profit-grid">
                                    <div class="profit-item"><label>ì´ ì›ê°€</label>
                                        <div class="value" id="profitCost">â‚© 0</div>
                                    </div>
                                    <div class="profit-item"><label>ê³„ì•½ê¸ˆì•¡</label>
                                        <div class="value synced-display" data-sync="totalAmount">-</div>
                                    </div>
                                    <div class="profit-item"><label>ì´ìµë¥ </label>
                                        <div class="value" id="profitRateCalc">0%</div>
                                    </div>
                                    <div class="profit-item profit"><label>ì˜ˆìƒ ìˆ˜ìµ</label>
                                        <div class="value" id="profitAmountCalc">â‚© 0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í†µê³„ë¶„ì„ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-stats">
                    <div class="stats-container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">

                        <!-- 1. ì •ì‚° í˜„í™© ì„¹ì…˜ -->
                        <section class="settlement-stats-section" style="margin-bottom: 40px;">
                            <h2
                                style="font-size: 20px; font-weight: 700; color: #1d1d1f; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ’°</span> ì •ì‚° í˜„í™©
                            </h2>

                            <!-- ë¯¸ìˆ˜ê¸ˆ í˜„í™© ì¹´ë“œ -->
                            <div class="settlement-overview"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 30px;">
                                <div class="stat-card"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ì´ ê³„ì•½ê¸ˆì•¡</div>
                                    <div class="value" id="stats-total-contract"
                                        style="font-size: 28px; font-weight: 700;">â‚©0</div>
                                </div>
                                <div class="stat-card"
                                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);">
                                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ì •ì‚° ì™„ë£Œ</div>
                                    <div class="value" id="stats-settled" style="font-size: 28px; font-weight: 700;">â‚©0
                                    </div>
                                </div>
                                <div class="stat-card"
                                    style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3);">
                                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ë¯¸ìˆ˜ê¸ˆ</div>
                                    <div class="value" id="stats-outstanding"
                                        style="font-size: 28px; font-weight: 700;">â‚©0</div>
                                </div>
                                <div class="stat-card"
                                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);">
                                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ì •ì‚° ì§„í–‰ë¥ </div>
                                    <div class="value" id="stats-settlement-rate"
                                        style="font-size: 28px; font-weight: 700;">0%</div>
                                </div>
                            </div>

                            <!-- ê³µì •ë³„ ì´ìœ¤ ì°¨íŠ¸ -->
                            <div
                                style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 20px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 20px;">ğŸ“Š
                                    ê³µì •ë³„ ì›ê°€ vs ì´ìœ¤ ë¶„ì„</h3>
                                <canvas id="processChart" style="max-height: 400px;"></canvas>
                            </div>

                            <!-- ì „ì²´ ìˆ˜ìµì„± ìš”ì•½ -->
                            <div
                                style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                                <h3 style="font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 16px;">ğŸ’¼
                                    ì „ì²´ ìˆ˜ìµì„± ë¶„ì„</h3>
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <div>
                                        <div style="font-size: 13px; color: #8e8e93; margin-bottom: 4px;">ì´ ê²¬ì ê¸ˆì•¡</div>
                                        <div id="stats-total-estimate"
                                            style="font-size: 20px; font-weight: 600; color: #1d1d1f;">â‚©0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #8e8e93; margin-bottom: 4px;">ì´ ì›ê°€</div>
                                        <div id="stats-total-cost"
                                            style="font-size: 20px; font-weight: 600; color: #1d1d1f;">â‚©0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #8e8e93; margin-bottom: 4px;">ì´ ì´ìµê¸ˆ</div>
                                        <div id="stats-total-profit"
                                            style="font-size: 20px; font-weight: 600; color: #34c759;">â‚©0</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #8e8e93; margin-bottom: 4px;">ì´ìµë¥ </div>
                                        <div id="stats-profit-rate"
                                            style="font-size: 20px; font-weight: 600; color: #007aff;">0%</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 2. í¸ì§‘ ì •ë³´ ì„¹ì…˜ -->
                        <section class="edit-history-section">
                            <h2
                                style="font-size: 20px; font-weight: 700; color: #1d1d1f; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“</span> í¸ì§‘ ì •ë³´
                            </h2>
                            <div id="edit-history-timeline"
                                style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                                <div style="text-align: center; color: #8e8e93; padding: 40px;">
                                    í¸ì§‘ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.
                                </div>
                            </div>
                        </section>

                    </div>
                </div>

                <!-- ê³µì • ì²´í¬ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-checklist">
                    <div class="document-wrapper"
                        style="width:100%; max-width:1200px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header"
                            style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color: #ffffff; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color: #fff;">
                                    DESIGN JIG</div>
                                <h1 style="color: #fff; margin: 0; font-size: 24px;"><span class="emoji-icon">âœ…</span>
                                    ê³µì • ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
                                <div class="subtitle" style="color: #fff; font-size: 14px; opacity: 0.9;">Process
                                    Checklist
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <!-- [ìˆ˜ì •] ì €ì¥ë‚´ìš©ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ë§Œ ìœ ì§€ -->
                                <button class="restore-btn no-print"
                                    onclick="syncFromCloud().then(() => { if (currentCustomerId) { selectCustomer(currentCustomerId); renderChecklistItems(); } })"
                                    style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="Google Sheetsì—ì„œ ì €ì¥ëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°">
                                    <span>â†© ì €ì¥ë‚´ìš©ë¶ˆëŸ¬ì˜¤ê¸°</span>
                                </button>
                                <!-- [New] ì¼ì •í‘œ ì—°ë™ ë²„íŠ¼ -->
                                <button class="sync-sch-btn no-print" onclick="syncChecklistFromSchedule()"
                                    style="background: #007aff; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="ì¼ì •í‘œì— ìˆëŠ” ê³µì •ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ìë™ ì¶”ê°€í•©ë‹ˆë‹¤">
                                    <span>ğŸ“… ì¼ì •í‘œ ì—°ë™</span>
                                </button>
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('checklist', event)"
                                    style="background: #000; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ë…¸ì…˜ìœ¼ë¡œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸°">
                                    ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°
                                </button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printChecklist()"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;">ğŸ–¨ï¸
                                    ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- ì§„í–‰ ìƒí™© ìš”ì•½ -->
                            <div
                                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
                                <div
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ì „ì²´ í•­ëª©</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistTotalCount">0</div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #34c759 0%, #28a745 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ì™„ë£Œ</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistCompletedCount">0</div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #ff9500 0%, #ff6b00 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ì§„í–‰ ì¤‘</div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistInProgressCount">0
                                    </div>
                                </div>
                                <div
                                    style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); padding: 16px; border-radius: 10px; color: white;">
                                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">ì§„í–‰ë¥ </div>
                                    <div style="font-size: 24px; font-weight: 700;" id="checklistProgressRate">0%</div>
                                </div>
                            </div>

                            <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ í•„í„° -->
                            <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <label
                                        style="font-size: 11px; color: #86868b; margin-bottom: 4px; display: block;">ì§„í–‰ë‹¨ê³„
                                        í•„í„° (ë‹¤ì¤‘ ì„ íƒ)</label>
                                    <select id="checklistStageFilter" style="display:none;"></select>
                                    <!-- í˜¸í™˜ì„± ìœ ì§€ìš© hidden -->
                                    <div class="multi-select-wrapper" id="checklistStageFilterWrapper">
                                        <div class="multi-select-box"
                                            onclick="toggleMultiSelect('checklistStageFilter')">
                                            <span id="checklistStageFilterLabel">ì „ì²´ ë³´ê¸°</span>
                                            <span style="font-size: 10px; color: #86868b;">â–¼</span>
                                        </div>
                                        <div class="multi-select-dropdown" id="checklistStageFilterDropdown"></div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 200px;">
                                    <label
                                        style="font-size: 11px; color: #86868b; margin-bottom: 4px; display: block;">ì¹´í…Œê³ ë¦¬
                                        í•„í„°</label>
                                    <select id="checklistCategoryFilter" style="display:none;"></select>
                                    <!-- í˜¸í™˜ì„± ìœ ì§€ìš© hidden -->
                                    <div class="multi-select-wrapper" id="checklistCategoryFilterWrapper">
                                        <div class="multi-select-box"
                                            onclick="toggleMultiSelect('checklistCategoryFilter')">
                                            <span id="checklistCategoryFilterLabel">ì „ì²´ ë³´ê¸°</span>
                                            <span style="font-size: 10px; color: #86868b;">â–¼</span>
                                        </div>
                                        <div class="multi-select-dropdown" id="checklistCategoryFilterDropdown"></div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 200px; display: flex; align-items: flex-end;">
                                    <button class="btn btn-primary btn-sm no-print"
                                        onclick="showAddChecklistItemModal()"
                                        style="background: rgba(52, 199, 89, 0.9); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; width: 100%;"
                                        title="í˜„ì¬ í•„í„° ì¡°ê±´ì˜ í•­ëª©ì„ ì¼ê´„ ì¶”ê°€">
                                        â• í•„í„° í•­ëª© ì¶”ê°€
                                    </button>
                                </div>
                            </div>

                            <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
                            <div id="checklistTableContainer" style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                    <thead>
                                        <tr style="background: #f5f5f7;">
                                            <!-- [ì¶”ê°€] ì‚­ì œ ì»¬ëŸ¼ -->
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 50px; color: #ff3b30;">
                                                ì‚­ì œ</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 60px;">
                                                ì²´í¬</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 60px;">
                                                NO</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 150px;">
                                                í•­ëª©</th>
                                            <th style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">ë‚´ìš©
                                            </th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 150px;">
                                                ë¹„ê³ </th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 120px;">
                                                ì§„í–‰ë‹¨ê³„</th>
                                            <th
                                                style="border: 1px solid #d2d2d7; padding: 12px; text-align: center; width: 120px;">
                                                ì¹´í…Œê³ ë¦¬</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checklistTableBody">
                                        <tr>
                                            <td colspan="7" style="text-align: center; padding: 40px; color: #86868b;">
                                                ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìŠ¤ì¼€ì¤„ ê´€ë¦¬ íŒ¨ë„ -->
                <div class="tab-panel" id="panel-schedule">
                    <div class="document-wrapper" id="scheduleDoc"
                        style="max-width:1000px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1><span class="emoji-icon">ğŸ“…</span> ê³µì‚¬ ìŠ¤ì¼€ì¤„ ê´€ë¦¬</h1>
                                <div class="subtitle">Construction Schedule Manager</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" class="notion-export-btn"
                                    onclick="exportToNotion('schedule', event)"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ë…¸ì…˜ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ ë‚´ë³´ë‚´ê¸°">
                                    ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°
                                </button>
                                <button class="notion-export-btn" onclick="openNotionShareModal()"
                                    style="background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="ë…¸ì…˜ ê³ ê° ê³µìœ  URL ìƒì„±">
                                    ğŸ“‹ ë…¸ì…˜ ê³ ê° ê³µìœ 
                                </button>
                                <button class="notion-export-btn" onclick="openScheduleMessageModal()"
                                    style="background: linear-gradient(135deg, #34C759 0%, #30B753 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 4px;"
                                    title="ìŠ¤ì¼€ì¤„ ë¬¸ì ë³´ë‚´ê¸°">
                                    ğŸ’¬ ë¬¸ìë³´ë‚´ê¸°
                                </button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printSchedule(true)"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none;">ğŸ–¨ï¸
                                    ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- ìŠ¤ì¼€ì¤„ ìƒë‹¨ ì •ë³´ (Schedule Info Table) -->
                            <table class="schedule-info-table"
                                style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:12px; border:1px solid #000;">
                                <colgroup>
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                </colgroup>
                                <tbody style="text-align: center;">
                                    <tr>
                                        <!-- Row 1 -->
                                        <th
                                            style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; font-weight:bold;">
                                            ê³µì‚¬ ë‹´ë‹¹ì</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" class="sch-input" id="schManagerInput"
                                                data-field="manager"
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                value="ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ê³µì‚¬ê¸°ê°„(ì‹œì‘~ì¢…ë£Œ)
                                        </th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schPeriod"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 2 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ê´€ë¦¬ì‚¬ë¬´ì†Œ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder="ì…ë ¥"
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="office">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">í‰ìˆ˜</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schArea"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 3 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px;" rowspan="2">ê³µì‚¬ ì˜ë¢°ì¸</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schClient1"></td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ì´ì‚¬ì˜ˆì •ì¼</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="schMoveDate"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 4 -->
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder=""
                                                style="width:100%; border:none; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="client2">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">í–‰ìœ„í—ˆê°€ í•„ì¦</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="text" placeholder="ë¹„ê³ (ì˜ˆ: í™•ì¥)" class="sch-input"
                                                data-field="permit_memo"
                                                style="width:60px; text-align:center; border:none; border-bottom:1px solid #eee; background:transparent;">
                                            <label><input type="radio" name="permit_status" value="ì™„ë£Œ" class="sch-radio"
                                                    data-field="permit_status"> ì™„ë£Œ</label>
                                            <label><input type="radio" name="permit_status" value="ë¯¸ì™„ë£Œ"
                                                    class="sch-radio" data-field="permit_status"> ë¯¸ì™„ë£Œ</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 5 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ì¸ìˆ˜ì¸ê³„</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <input type="date"
                                                style="width:100%; border:none; outline:none; text-align:center; font-family:inherit; background:transparent;"
                                                class="sch-input" data-field="handover">
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ê³µì‚¬ ë™ì˜ì„œ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <label><input type="radio" name="consent_status" value="ì™„ë£Œ"
                                                    class="sch-radio" data-field="consent_status"> ì™„ë£Œ</label>
                                            <label><input type="radio" name="consent_status" value="ë¯¸ì™„ë£Œ"
                                                    class="sch-radio" data-field="consent_status"> ë¯¸ì™„ë£Œ</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 6 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">í˜„ì¥ì£¼ì†Œ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" colspan="3"
                                            id="schSiteAddr"></td>
                                    </tr>
                                    <tr>
                                        <!-- Row 7 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ë¹„ë°€ë²ˆí˜¸</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; text-align:left;"
                                            colspan="3">
                                            ê³µë™í˜„ê´€ : <input type="text"
                                                style="width:100px; border:none; border-bottom:1px solid #eee; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="gatePw">
                                            &nbsp;&nbsp;
                                            ì„¸ëŒ€í˜„ê´€ : <input type="text"
                                                style="width:100px; border:none; border-bottom:1px solid #eee; outline:none; text-align:center; background:transparent;"
                                                class="sch-input" data-field="doorPw">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div
                                style="background:#f0f7ff; padding:12px 16px; border-radius:8px; margin-bottom:16px; font-size:13px; color:#004182; border:1px solid #c2e0ff;">
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                    <strong id="scheduleGuidelinesTitle" class="text-formattable"
                                        contenteditable="false" ondblclick="this.contentEditable=true;this.focus();"
                                        onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                                        onblur="this.contentEditable=false;">ğŸ’¡ ê³µì‚¬ ì§„í–‰ ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</strong>
                                    <button class="btn btn-sm no-print" onclick="loadScheduleGuidelines()"
                                        style="background:#0071e3; color:white; border:none; padding:4px 12px; border-radius:6px; font-size:11px; cursor:pointer;">
                                        ğŸ“¥ ìœ ì˜ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸°
                                    </button>
                                </div>
                                <ul id="scheduleGuidelinesList" class="text-formattable" contenteditable="false"
                                    ondblclick="this.contentEditable=true;this.focus();"
                                    onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                                    onblur="this.contentEditable=false;"
                                    style="margin: 5px 0 0 20px; padding: 0; list-style-type: disc; line-height: 1.6;">
                                    <li>ê³µì‚¬ëŠ” ê¸°ìƒ, ìì¬ ìˆ˜ê¸‰, ê³µì • ê°„ì„­ ë“± í˜„ì¥ ìƒí™©ì— ë”°ë¼ ì¼ì •ì´ ì¼ë¶€ ì¡°ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    <li>ê³ ê°ë‹˜ê»˜ì„œ ì§ì ‘ ë°œì£¼í•˜ì‹  ìì¬ ë˜ëŠ” ì‹œê³µ í•­ëª©ì€ ë°˜ë“œì‹œ ì‚¬ì „ í˜‘ì˜ í›„ ì§„í–‰ ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br>
                                        <span style="color:#666; font-size:0.9em;">(ì‚¬ì „ í˜‘ì˜ ì—†ì´ ì§„í–‰ ì‹œ ê³µì • ê°„ì„­ ë˜ëŠ” ì±…ì„ ë²”ìœ„ ë¬¸ì œê°€ ë°œìƒí• 
                                            ìˆ˜ ìˆìŠµë‹ˆë‹¤)</span>
                                    </li>
                                    <li>ê³µì‚¬ ê¸°ê°„ ì¤‘ì—ëŠ” ì•ˆì „ì‚¬ê³  ì˜ˆë°©ì„ ìœ„í•´ í˜„ì¥ ì¶œì…ì´ ì œí•œë  ìˆ˜ ìˆìœ¼ë©°, ì‘ì—… êµ¬ê°„ ì¶œì…ì€ ì‚¼ê°€ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</li>
                                    <li>ê³µì • íŠ¹ì„±ìƒ ì†ŒìŒ, ë¶„ì§„, ëƒ„ìƒˆê°€ ë°œìƒí•  ìˆ˜ ìˆê³ , ì¼ì • ì‹œê°„ëŒ€ì—ëŠ” ì‘ì—…ì´ ì§‘ì¤‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    <li>ê³µì‚¬ ì¤‘ ì¶”ê°€ ìš”ì²­ì´ë‚˜ ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ê²½ìš°, ê³µì • ë° ë¹„ìš©ì— ì˜í–¥ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë°˜ë“œì‹œ ê³µì‚¬ ë‹´ë‹¹ìì™€ ë¨¼ì € í˜‘ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</li>
                                    <li>ê³µì • ì™„ë£Œ í›„ì—ëŠ” ë‹¤ìŒ ê³µì •ì„ ìœ„í•´ í˜„ì¥ ì •ë¦¬ ë° ì–‘ìƒ ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ê¸°ê°„ ë™ì•ˆ í˜„ì¥ ì¶œì…ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                            <table class="data-table" style="width:100%; border-collapse:collapse;">
                                <thead>
                                    <tr style="background:#f5f5f7;">
                                        <th style="width:40px; padding:12px; border:1px solid #d2d2d7;">No</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ì¹´í…Œê³ ë¦¬</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ì„¸ë¶€ ê³µì •ëª…</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">í•µì‹¬ ì²´í¬í¬ì¸íŠ¸</th>
                                        <th style="width:130px; padding:12px; border:1px solid #d2d2d7;">ì‹œì‘ì¼</th>
                                        <th style="width:130px; padding:12px; border:1px solid #d2d2d7;">ì¢…ë£Œì¼</th>
                                        <th style="width:120px; padding:12px; border:1px solid #d2d2d7;">ë‹´ë‹¹ì</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7; text-align:center;">ë¹„ê³ </th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleTableBody">
                                    <!-- Dynamic Rows-->
                                </tbody>
                            </table>
                            <button onclick="addScheduleRow()" class="no-print"
                                style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                                + ê³µì • ì¶”ê°€
                            </button>
                            <div id="scheduleEmptyState"
                                style="text-align:center; padding:40px; color:#86868b; display:none;">
                                ë“±ë¡ëœ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤. ê³µì •ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-panel" id="panel-as_list">
                    <div class="document-wrapper" id="asListDoc"
                        style="max-width:1000px; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                        <div class="doc-header">
                            <div>
                                <div
                                    style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                    DESIGN JIG</div>
                                <h1><span class="emoji-icon">ğŸ› ï¸</span> A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸</h1>
                                <div class="subtitle">A/S Management List</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="sync-btn no-print" onclick="syncASListFromCloud()"
                                    style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="Google Sheetsì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°">â˜ï¸â†“ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                                <button type="button" class="sync-btn no-print" onclick="exportASListToNotion()"
                                    style="background: linear-gradient(135deg, #000 0%, #333 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                    title="ë…¸ì…˜ìœ¼ë¡œ A/S ë¦¬ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸°">ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°</button>
                                <button class="btn btn-secondary btn-sm no-print" onclick="printASList(true)"
                                    style="background: rgba(255,255,255,0.2); color:white; border:none;">ğŸ–¨ï¸
                                    ì¸ì‡„/PDF</button>
                            </div>
                        </div>
                        <div class="doc-content" style="padding:30px;">
                            <!-- A/S ìƒë‹¨ ì •ë³´ (Schedule Style) -->
                            <table class="schedule-info-table"
                                style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:12px; border:1px solid #000;">
                                <colgroup>
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                    <col style="width: 15%; background: #fff;">
                                    <col style="width: 35%;">
                                </colgroup>
                                <tbody style="text-align: center;">
                                    <tr>
                                        <!-- Row 1 -->
                                        <!-- Row 1 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">A/S ë‹´ë‹¹ì</th>
                                        <td
                                            style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; font-weight:bold;">
                                            <span class="synced-display" data-sync="manager">-</span>
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">ì”ê¸ˆì¼</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <span class="synced-display" data-sync="finalPaymentDate">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 2 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" rowspan="2">
                                            ê³µì‚¬ ì˜ë¢°ì¸</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; line-height: 1.4;"
                                            id="asClientInfo1">
                                            <!-- ë³¸ì¸ ì •ë³´ -->
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">A/S ê¸°ê°„</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">
                                            <span class="synced-display" data-sync="warrantyPeriod">-</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 3 -->
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px; line-height: 1.4;"
                                            id="asClientInfo2">
                                            <!-- ë°°ìš°ì ì •ë³´ -->
                                        </td>
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">í™”ì¥ì‹¤ ëˆ„ìˆ˜ ë³´ì¦ ê¸°ê°„
                                        </th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;"
                                            id="bathroomLeakWarranty">
                                            -
                                        </td>
                                    </tr>
                                    <tr>
                                        <!-- Row 4 -->
                                        <th style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;">í˜„ì¥ì£¼ì†Œ</th>
                                        <td style="border:1px solid #d2d2d7; padding:2px 4px; height:24px;" colspan="3">
                                            <span class="synced-display" data-sync="siteAddress">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <div
                                style="background:#f0f7ff; padding:12px 16px; border-radius:8px; margin-bottom:16px; font-size:13px; color:#004182; border:1px solid #c2e0ff;">
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                    <strong>ğŸ’¡ A/S(ì‚¬í›„ê´€ë¦¬) ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</strong>
                                    <button class="btn btn-sm no-print" onclick="loadASGuidelines()"
                                        style="background:#0071e3; color:white; border:none; padding:4px 12px; border-radius:6px; font-size:11px; cursor:pointer;">
                                        ğŸ“¥ ìœ ì˜ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸°
                                    </button>
                                </div>
                                <ul id="asGuidelinesList"
                                    style="margin: 5px 0 0 20px; padding: 0; list-style-type: disc; line-height: 1.6;">
                                    <li>ê¸°ë³¸ A/S ê¸°ê°„ì€ ê³µì‚¬ ì™„ë£Œì¼ë¡œë¶€í„° 12ê°œì›”ì…ë‹ˆë‹¤.</li>
                                    <li>ìì¬ A/SëŠ” ìì¬ ì…ê³ ì¼ ê¸°ì¤€ 1ë…„ì´ë©°, ì œì¡°ì‚¬ ê¸°ì¤€ì´ ìš°ì„  ì ìš©ë©ë‹ˆë‹¤.</li>
                                    <li>í™”ì¥ì‹¤ ëˆ„ìˆ˜ A/SëŠ” ì”ê¸ˆì¼ë¡œë¶€í„° 24ê°œì›”ì´ë©°, ë³„ë„ ì§€ì¹¨ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ì—ë§Œ ì ìš©ë©ë‹ˆë‹¤.</li>
                                    <li>ì‚¬ìš© ë¶€ì£¼ì˜, ìì—° ë…¸í›„, ê³ ê° ì§ì ‘ ë°œì£¼ ìì¬ë¡œ ì¸í•œ í•˜ìëŠ” A/S ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                                    <li>A/S ì ‘ìˆ˜ëŠ” ê´€ë ¨ ì´ë¯¸ì§€ ë° ë™ì˜ìƒì„ ë°˜ë“œì‹œ ì²¨ë¶€í•´ ì£¼ì…”ì•¼ ì›í™œí•˜ê²Œ ì§„í–‰ë©ë‹ˆë‹¤.</li>
                                    <li>A/S ê¸°ê°„ ë§Œë£Œ í›„ì—ëŠ” ì‚¬ì „ì— ì•ˆë‚´ë“œë¦° ê³ ê°ì„¼í„°ë¥¼ í†µí•´ ì ‘ìˆ˜í•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                            <table class="data-table" style="width:100%; border-collapse:collapse;">
                                <thead>
                                    <tr style="background:#f5f5f7;">
                                        <th style="width:40px; padding:12px; border:1px solid #d2d2d7;">No</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ì¹´í…Œê³ ë¦¬</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ë¸Œëœë“œ</th>
                                        <th style="width:150px; padding:12px; border:1px solid #d2d2d7;">ì„¸ë¶€í•­ëª©</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">í’ˆë²ˆ</th>
                                        <th style="width:80px; padding:12px; border:1px solid #d2d2d7;">ì¹˜ìˆ˜</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ì„œë¹„ìŠ¤ì„¼í„°</th>
                                        <th style="width:100px; padding:12px; border:1px solid #d2d2d7;">ë³´ì¦ê¸°ê°„</th>
                                        <th style="padding:12px; border:1px solid #d2d2d7;">ë¹„ê³ </th>
                                    </tr>
                                </thead>
                                <tbody id="asListTableBody">
                                    <!-- Dynamic Rows -->
                                </tbody>
                            </table>
                            <button onclick="addASListItem()" class="no-print"
                                style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                                + í•­ëª© ì¶”ê°€
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ì‹ ê·œ] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ -->
            <div class="tab-panel" id="panel-settlement" style="height: 100%; overflow-y: auto;">
                <div class="document-wrapper"
                    style="width:100%; margin:0 auto; background:#fff; box-shadow:0 4px 20px rgba(0,0,0,0.08); border-radius:12px; overflow:hidden;">
                    <div class="doc-header">
                        <div>
                            <div
                                style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px;">
                                DESIGN
                                JIG</div>
                            <h1>ğŸ’° ì •ì‚° ê´€ë¦¬ ëŒ€ì¥</h1>
                            <div class="subtitle">Settlement Management Ledger</div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span id="settlementDirtyIndicator"
                                style="display:none; font-size:11px; font-weight:600; padding:4px 8px; border-radius:12px; background:#fff8e6;"></span>
                            <button class="sync-btn no-print" id="btnLoadSettlement" onclick="syncSettlementFromCloud()"
                                style="background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="ë°ì´í„° ë° ì˜µì…˜ ë™ê¸°í™”">ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <button class="no-print" id="btnSaveSettlement" onclick="syncSettlementToCloud()"
                                style="background: #0071e3; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                            <button class="no-print" onclick="printSettlement()"
                                style="background: white; color: #1d1d1f; border: 1px solid #d2d2d7; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                title="ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì¸ì‡„">ğŸ–¨ï¸ ì¸ì‡„</button>
                        </div>
                    </div>

                    <!-- í•©ê³„ ìš”ì•½ ì˜ì—­ -->
                    <div
                        style="background:#f9f9f9; padding:16px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-around; align-items:center;">
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ì´ ì…ê¸ˆì•¡(ë§¤ì¶œ)</div>
                            <div style="font-size:16px; font-weight:700; color:#0071e3;" id="settlementTotalIncome">0
                            </div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ì´ ì§€ì¶œì•¡</div>
                            <div style="font-size:16px; font-weight:700; color:#ff3b30;" id="settlementTotalExpense">0
                            </div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ìˆ˜ìµê¸ˆ</div>
                            <div style="font-size:16px; font-weight:700; color:#34c759;" id="settlementProfit">0</div>
                        </div>
                        <div style="width:1px; height:30px; background:#ddd;"></div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; color:#666; margin-bottom:4px;">ìˆ˜ìµë¥ </div>
                            <div style="font-size:16px; font-weight:700; color:#333;" id="settlementProfitRate">0%</div>
                        </div>
                    </div>

                    <div style="padding:20px;">
                        <table class="data-table" style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:#f5f5f7;">
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">No
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ì¹´í…Œê³ ë¦¬
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ê³µì •ë¶„ë¥˜
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        ê±°ë˜ì²˜/ì‘ì—…ì</th>
                                    <th style="width:70px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ë¹„ìš©êµ¬ë¶„
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ëŒ€ê¸ˆë°©ì‹
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        ì‚¬ì—…ì/ì£¼ë¯¼ë²ˆí˜¸</th>
                                    <th style="width:180px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">
                                        ì€í–‰ëª…/ì˜ˆê¸ˆì£¼/ê³„ì¢Œë²ˆí˜¸</th>
                                    <th style="width:90px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ê²°ì œê¸ˆì•¡
                                    </th>
                                    <th style="width:100px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ê²°ì œì¼
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ê²°ì œìƒíƒœ
                                    </th>
                                    <th style="width:80px; padding:8px; border:1px solid #d2d2d7; font-size:11px;">ë¹„ê³ 
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="settlementTableBody">
                                <!-- Dynamic Rows -->
                            </tbody>
                        </table>
                        <button onclick="addSettlementRow()" class="no-print"
                            style="width:100%; padding:15px; margin-top:10px; border:1px dashed #d2d2d7; background:#fafafa; color:#86868b; font-size:13px; cursor:pointer; border-radius:6px; transition: all 0.2s;">
                            + í•­ëª© ì¶”ê°€
                        </button>
                        <datalist id="settlementItemOptions">
                            <option value="ê³„ì•½ê¸ˆ"></option>
                            <option value="ì°©ìˆ˜ê¸ˆ"></option>
                            <option value="ì¤‘ë„ê¸ˆ"></option>
                            <option value="ì”ê¸ˆ"></option>
                            <option value="ìì¬ë¹„"></option>
                            <option value="ì¸ê±´ë¹„"></option>
                            <option value="ì² ê±°ë¹„"></option>
                            <option value="íê¸°ë¬¼ì²˜ë¦¬ë¹„"></option>
                            <option value="ì‹ëŒ€"></option>
                            <option value="ê²½ë¹„"></option>
                            <option value="ê¸°íƒ€"></option>
                        </datalist>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- [ì‹ ê·œ] ì‘ì—…ê¸°ë¡ íŒ¨ë„ -->
    <div class="tab-panel" id="panel-stats">
        <div class="document-wrapper" style="min-height: 500px;">
            <div class="doc-header" style="border-bottom: 2px solid #e5e7eb;">
                <div>
                    <div
                        style="font-size:11px; font-weight:600; opacity:0.8; margin-bottom:4px; letter-spacing:1px; color:#667eea;">
                        DESIGN JIG</div>
                    <h1 style="margin:0 0 8px 0;">ğŸ“‹ ì‘ì—…ê¸°ë¡</h1>
                    <div
                        style="background:#f0f4ff; border-left:4px solid #667eea; padding:12px 16px; border-radius:0 8px 8px 0; margin-top:12px;">
                        <div style="font-size:13px; font-weight:600; color:#1d1d1f; margin-bottom:6px;">ğŸ“ ì‹œìŠ¤í…œ ì‘ì—… ë¡œê·¸
                        </div>
                        <div style="font-size:12px; color:#6b7280; line-height:1.6;">
                            ì €ì¥, ë¶ˆëŸ¬ì˜¤ê¸°, ì¸ì‡„, ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ë“± ëª¨ë“  ì‘ì—…ì´ ìë™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.<br>
                            <span style="color:#667eea; font-weight:500;">â€» ìµœê·¼ 50ê±´ê¹Œì§€ í‘œì‹œë©ë‹ˆë‹¤.</span>
                        </div>
                    </div>
                </div>
            </div>
            <div style="padding:20px;">
                <!-- ê³ ê° í˜„í™© ìš”ì•½ -->
                <div id="customerStatusSummary"
                    style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <div
                        style="font-size:11px; opacity:0.8; margin-bottom:12px; text-transform:uppercase; letter-spacing:1px;">
                        ğŸ“Š ê³ ê° í˜„í™© ìš”ì•½</div>
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
                        <div style="text-align:center;">
                            <div style="font-size:12px; opacity:0.85;">ê³ ê°ëª…</div>
                            <div id="logCustomerName" style="font-size:18px; font-weight:700;">-</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; opacity:0.85;">ìƒíƒœ</div>
                            <div id="logCustomerStatus" style="font-size:16px; font-weight:600;">-</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; opacity:0.85;">ë“±ë¡ì¼</div>
                            <div id="logCustomerCreated" style="font-size:14px;">-</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; opacity:0.85;">ì´ ê³„ì•½ê¸ˆì•¡</div>
                            <div id="logCustomerAmount" style="font-size:16px; font-weight:600;">â‚©0</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:12px; opacity:0.85;">ì‘ì—… ê¸°ë¡ ìˆ˜</div>
                            <div id="logEditCount" style="font-size:16px; font-weight:600;">0ê±´</div>
                        </div>
                    </div>
                </div>
                <!-- ì‘ì—… ê¸°ë¡ í…Œì´ë¸” ì„¹ì…˜ -->
                <div style="margin-bottom:12px;">
                    <h3
                        style="margin:0 0 8px 0; font-size:15px; color:#1d1d1f; display:flex; align-items:center; gap:8px;">
                        <span style="font-size:18px;">ğŸ“</span> ì‘ì—…ê¸°ë¡ (ìµœê·¼ 50ê±´)
                    </h3>
                    <p style="margin:0; font-size:12px; color:#6b7280;">ì €ì¥, ë¶ˆëŸ¬ì˜¤ê¸°, ì¸ì‡„, ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ë“± ëª¨ë“  ì‘ì—…ì´ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
                </div>
                <table class="data-table"
                    style="width:100%; border-collapse:collapse; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
                    <thead>
                        <tr
                            style="background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-bottom:2px solid #667eea;">
                            <th
                                style="width:160px; padding:12px 10px; border:1px solid #e2e8f0; font-size:12px; font-weight:600; color:#334155;">
                                ğŸ“… ì‘ì—…ì¼ì‹œ (ë‚ ì§œ/ì‹œê°„)</th>
                            <th
                                style="width:100px; padding:12px 10px; border:1px solid #e2e8f0; font-size:12px; font-weight:600; color:#334155;">
                                ğŸ‘¤ ê´€ë¦¬ì ID</th>
                            <th
                                style="padding:12px 10px; border:1px solid #e2e8f0; font-size:12px; font-weight:600; color:#334155;">
                                ğŸ”§ ì‘ì—…ë‚´ìš© (UI ë²„íŠ¼ ì ìš© ë‚´ìš©)</th>
                        </tr>
                    </thead>
                    <tbody id="auditLogTableBody">
                        <!-- JS ë Œë”ë§ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(event)">



    <!-- í†µê³„ ëª¨ë‹¬ -->
    <div class="stats-modal-overlay" id="statsModal" onclick="closeStatsModal(event)">
        <div class="stats-modal" onclick="event.stopPropagation()">
            <div class="stats-modal-header">
                <h2>ğŸ“Š ì „ì²´ í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>
                <button class="stats-close-btn" onclick="closeStatsModal()">âœ•</button>
            </div>
            <div class="stats-modal-content">

                <!-- ê¸°ê°„ í•„í„° ì˜ì—­ -->
                <div class="stats-filter-bar"
                    style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:20px; padding:15px; background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius:12px; border:1px solid #e2e8f0;">
                    <!-- ì§‘ê³„ ë‹¨ìœ„ í† ê¸€ -->
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size:13px; font-weight:600; color:#64748b;">ì§‘ê³„ ë‹¨ìœ„:</span>
                        <div
                            style="display:flex; background:#fff; border-radius:8px; border:1px solid #e2e8f0; overflow:hidden;">
                            <button id="filterMonthly" onclick="setAggregationType('monthly')"
                                style="padding:8px 16px; border:none; background:#0071e3; color:white; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s;">ì›”ë³„</button>
                            <button id="filterYearly" onclick="setAggregationType('yearly')"
                                style="padding:8px 16px; border:none; background:white; color:#64748b; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s;">ì—°ë„ë³„</button>
                        </div>
                    </div>
                    <!-- ê¸°ê°„ ë²”ìœ„ -->
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size:13px; font-weight:600; color:#64748b;">ê¸°ê°„:</span>
                        <select id="statsPeriodFilter" onchange="renderAllStats()"
                            style="padding:8px 14px; border:1px solid #e2e8f0; border-radius:8px; font-size:12px; font-weight:500; background:white; cursor:pointer;">
                            <option value="12months">ìµœê·¼ 12ê°œì›”</option>
                            <option value="thisyear">ì˜¬í•´</option>
                            <option value="lastyear">ì‘ë…„</option>
                            <option value="all">ì „ì²´ ê¸°ê°„</option>
                        </select>
                    </div>
                </div>

                <!-- í•µì‹¬ KPI ì¹´ë“œ (3ê°œ ìš°ì„  + 3ê°œ ë³´ì¡°) -->
                <div class="stats-kpi-grid"
                    style="display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-bottom:24px;">
                    <!-- í•µì‹¬ KPI 1: ì´ ë§¤ì¶œ -->
                    <div class="kpi-card primary"
                        style="background:linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 15px rgba(14,165,233,0.3);">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px;">
                                    ğŸ’° ì´ ë§¤ì¶œ</div>
                                <div id="kpiTotalRevenue" style="font-size:28px; font-weight:800; line-height:1.2;">â‚©0
                                </div>
                            </div>
                            <div style="font-size:32px; opacity:0.3;">ğŸ“ˆ</div>
                        </div>
                        <div style="margin-top:12px; font-size:11px; opacity:0.8;">
                            ê³„ì•½ê±´ìˆ˜: <span id="kpiContractCount">0</span>ê±´
                        </div>
                    </div>

                    <!-- í•µì‹¬ KPI 2: ì´ ì§€ì¶œ -->
                    <div class="kpi-card"
                        style="background:linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 15px rgba(244,63,94,0.3);">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px;">
                                    ğŸ’¸ ì´ ì§€ì¶œ</div>
                                <div id="kpiTotalExpense" style="font-size:28px; font-weight:800; line-height:1.2;">â‚©0
                                </div>
                            </div>
                            <div style="font-size:32px; opacity:0.3;">ğŸ“‰</div>
                        </div>
                        <div style="margin-top:12px; font-size:11px; opacity:0.8;">
                            ìš´ì˜ë¹„ í•­ëª©: <span id="kpiExpenseItems">0</span>ê±´
                        </div>
                    </div>

                    <!-- í•µì‹¬ KPI 3: ìˆœì´ìµ (ê°€ì¥ ëˆˆì— ë„ê²Œ) -->
                    <div class="kpi-card highlight"
                        style="background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:white; padding:20px; border-radius:16px; box-shadow:0 4px 20px rgba(16,185,129,0.4); border:3px solid rgba(255,255,255,0.3); position:relative; overflow:hidden;">
                        <div style="position:absolute; top:-20px; right:-20px; font-size:80px; opacity:0.1;">ğŸ’</div>
                        <div
                            style="display:flex; justify-content:space-between; align-items:flex-start; position:relative;">
                            <div>
                                <div
                                    style="font-size:12px; opacity:0.9; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px; display:flex; align-items:center; gap:6px;">
                                    ğŸ’ ìˆœì´ìµ <span
                                        style="background:rgba(255,255,255,0.3); padding:2px 8px; border-radius:10px; font-size:10px;">HIGHLIGHT</span>
                                </div>
                                <div id="kpiNetProfit"
                                    style="font-size:32px; font-weight:900; line-height:1.2; text-shadow:0 2px 10px rgba(0,0,0,0.2);">
                                    â‚©0</div>
                            </div>
                        </div>
                        <div style="margin-top:12px; font-size:12px; display:flex; align-items:center; gap:8px;">
                            <span
                                style="background:rgba(255,255,255,0.2); padding:4px 10px; border-radius:12px; font-weight:600;">
                                ì´ìµë¥ : <span id="kpiProfitRate">0</span>%
                            </span>
                        </div>
                    </div>
                </div>

                <!-- ë³´ì¡° KPI ì¹´ë“œ (2ì—´ ê·¸ë¦¬ë“œ) -->
                <div class="stats-secondary-kpi"
                    style="display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-bottom:24px;">
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#f0f9ff; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            ğŸ‘¥</div>
                        <div>
                            <div id="kpiTotalCustomers" style="font-size:20px; font-weight:700; color:#1e293b;">0</div>
                            <div style="font-size:11px; color:#64748b;">ì´ ê³ ê° ìˆ˜</div>
                        </div>
                    </div>
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#fef3c7; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            ğŸ“</div>
                        <div>
                            <div id="kpiContractsTotal" style="font-size:20px; font-weight:700; color:#1e293b;">0</div>
                            <div style="font-size:11px; color:#64748b;">ê³„ì•½ ê±´ìˆ˜</div>
                        </div>
                    </div>
                    <div
                        style="background:white; padding:16px; border-radius:12px; border:1px solid #e2e8f0; display:flex; align-items:center; gap:12px;">
                        <div
                            style="width:44px; height:44px; background:#f0fdf4; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                            ğŸ“Š</div>
                        <div>
                            <div id="kpiAvgContract" style="font-size:20px; font-weight:700; color:#1e293b;">â‚©0</div>
                            <div style="font-size:11px; color:#64748b;">í‰ê·  ê³„ì•½ê¸ˆì•¡</div>
                        </div>
                    </div>
                </div>

                <!-- í†µí•© ìˆ˜ìµì„± ì°¨íŠ¸ (ë§¤ì¶œ ë§‰ëŒ€, ì§€ì¶œ ë§‰ëŒ€, ìˆœì´ìµ ì„ ) -->
                <div class="stats-main-chart"
                    style="background:white; padding:24px; border-radius:16px; border:1px solid #e2e8f0; box-shadow:0 1px 3px rgba(0,0,0,0.05); margin-bottom:24px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <div>
                            <h3 style="margin:0; font-size:18px; font-weight:700; color:#1e293b;">ğŸ“Š ìˆ˜ìµì„± ë¶„ì„ ì°¨íŠ¸</h3>
                            <p style="margin:4px 0 0 0; font-size:12px; color:#64748b;">ë§¤ì¶œ vs ì§€ì¶œ vs ìˆœì´ìµ ì¶”ì´</p>
                        </div>
                        <!-- ë²”ë¡€ -->
                        <div style="display:flex; gap:16px; font-size:11px;">
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:12px; background:#0ea5e9; border-radius:2px;"></span> ë§¤ì¶œ
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:12px; background:#f43f5e; border-radius:2px;"></span> ì§€ì¶œ
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:3px; background:#10b981; border-radius:2px;"></span> ìˆœì´ìµ
                            </div>
                            <div style="display:flex; align-items:center; gap:4px;"><span
                                    style="width:12px; height:3px; background:#8b5cf6; border-radius:2px; border:1px dashed #8b5cf6;"></span>
                                ì´ìµë¥ (%)</div>
                        </div>
                    </div>
                    <div style="height:380px;">
                        <canvas id="profitabilityChart"></canvas>
                    </div>
                </div>

                <!-- íƒ­ ë©”ë‰´ (ê¸°íƒ€ ìƒì„¸ í†µê³„) -->
                <div class="stats-tabs-container"
                    style="display:flex; gap:10px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <button id="tab-expenses" class="stats-tab-btn active" onclick="switchStatsTab('expenses')"
                        style="padding:8px 16px; border:none; background:#f5f5f7; border-radius:6px; cursor:pointer; font-weight:600; color:#333; transition:all 0.2s;">ğŸ’¸
                        ìš´ì˜ë¹„ ë¶„ì„</button>
                    <button id="tab-others" class="stats-tab-btn" onclick="switchStatsTab('others')"
                        style="padding:8px 16px; border:none; background:white; border-radius:6px; cursor:pointer; font-weight:600; color:#888; transition:all 0.2s;">ğŸ¯
                        ê¸°íƒ€ í†µê³„</button>
                </div>

                <!-- íƒ­ ì»¨í…ì¸  ì˜ì—­ -->
                <div class="stats-content-area" style="min-height:300px;">
                    <!-- ìš´ì˜ë¹„ íƒ­ -->
                    <div id="view-stats-expenses" class="stats-view-content"
                        style="display:block; animation: fadeIn 0.3s;">
                        <div class="stats-chart-card wide"
                            style="height:350px; padding:25px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                            <h3 style="margin:0 0 20px 0; font-size:18px; color:#1d1d1f;">ğŸ’¸ ìš´ì˜ë¹„ ì§€ì¶œ ìƒì„¸ (ëŒ€ë¶„ë¥˜)</h3>
                            <div style="height:260px; display:flex; justify-content:center;">
                                <canvas id="expenseBreakdownChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ê¸°íƒ€ íƒ­ -->
                    <div id="view-stats-others" class="stats-view-content"
                        style="display:none; animation: fadeIn 0.3s;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                            <!-- ìƒíƒœë³„ -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>ğŸ¯ ìƒíƒœë³„ ê³ ê° ë¶„í¬</h3>
                                <div style="height:220px;"><canvas id="statusChart"></canvas></div>
                            </div>
                            <!-- ìœ ì…ê²½ë¡œ -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>ğŸ” ìœ ì…ê²½ë¡œ ë¶„ì„</h3>
                                <div style="height:220px;"><canvas id="sourceChart"></canvas></div>
                            </div>
                            <!-- ê±´ë¬¼ìœ í˜• -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>ğŸ  ê±´ë¬¼ìœ í˜•ë³„ ë¶„í¬</h3>
                                <div style="height:220px;"><canvas id="buildingChart"></canvas></div>
                            </div>
                            <!-- ì „í™˜ìœ¨ -->
                            <div class="stats-chart-card"
                                style="padding:20px; background:white; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border:1px solid #eee;">
                                <h3>âœ… ê³„ì•½ ì „í™˜ìœ¨</h3>
                                <div class="conversion-rate-display">
                                    <div class="conversion-circle" id="conversionCircle">
                                        <span id="conversionRate">0%</span>
                                    </div>
                                    <div class="conversion-details">
                                        <div class="conversion-item"><span class="dot green"></span> ê³„ì•½ ì™„ë£Œ: <strong
                                                id="contractedCount">0</strong></div>
                                        <div class="conversion-item"><span class="dot red"></span> ë¯¸ê³„ì•½: <strong
                                                id="notContractedCount">0</strong></div>
                                        <div class="conversion-item"><span class="dot gray"></span> ìƒë‹´ì¤‘: <strong
                                                id="consultingCount">0</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>





    <script>
        console.log('Main admin script loading...');

        // [Phase 2] Cleanup Function - í´ë¼ìš°ë“œ ë™ê¸°í™” ì„±ê³µ í›„ ì‹¤í–‰
        function runPhase2Cleanup() {
            const keysToRemove = [
                'dz_customers', 'dz_regular_admins', 'dz_checklist_master',
                'dz_global_cost', 'dz_admin_page_auth', 'dz_device_trust',
                'designzig_expenses', 'designzig_fixed_expenses', 'designzig_fontsize',
                'designzig_estimate_data', 'dz_estimate_data',
                'DJ_migrated_v1',
                'DJ_customers', 'DJ_global_cost', 'DJ_checklist_master', 'DJ_expenses', 'DJ_fixed_expenses',
                'DJ_regular_admins', 'DJ_editHistory'
            ];

            let removedCount = 0;
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    removedCount++;
                }
            });
            if (removedCount > 0) {
                console.log(`[Phase 2 Cleanup] ${removedCount}ê°œì˜ ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ìºì‹œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì œê±°í–ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ==========================================
        // ê¸°ê¸° ì‹ ë¢° & PIN ë¡œê·¸ì¸ ì‹œìŠ¤í…œ
        // ==========================================
        const DEVICE_TRUST_KEY = 'DJ_device_trust';
        const DEVICE_TRUST_DAYS = 30;

        // ê¸°ê¸° ì‹ ë¢° ì •ë³´ í™•ì¸
        function checkDeviceTrust() {
            try {
                const trustData = localStorage.getItem(DEVICE_TRUST_KEY);
                if (!trustData) return null;

                const trust = JSON.parse(trustData);
                const now = Date.now();
                const expiry = trust.expiry || 0;

                // 30ì¼ ê²½ê³¼ ì‹œ ë§Œë£Œ
                if (now > expiry) {
                    localStorage.removeItem(DEVICE_TRUST_KEY);
                    return null;
                }

                // í™˜ê²½ ë³€ê²½ ê°ì§€ (ê°„ë‹¨í•œ fingerprint ë¹„êµ)
                if (trust.fingerprint !== getDeviceFingerprint()) {
                    localStorage.removeItem(DEVICE_TRUST_KEY);
                    return null;
                }

                return trust;
            } catch (e) {
                localStorage.removeItem(DEVICE_TRUST_KEY);
                return null;
            }
        }

        // ê°„ë‹¨í•œ ê¸°ê¸° í•‘ê±°í”„ë¦°íŠ¸ ìƒì„±
        function getDeviceFingerprint() {
            const ua = navigator.userAgent;
            const lang = navigator.language;
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const screen = `${window.screen.width}x${window.screen.height}`;
            return btoa(ua + lang + tz + screen).slice(0, 32);
        }

        // ë¡œê·¸ì¸ í™”ë©´ ì „í™˜
        function showLoginView(view) {
            document.getElementById('loginCardIdPw').style.display = 'none';
            document.getElementById('loginCardPin').style.display = 'none';
            document.getElementById('loginCardPinSetup').style.display = 'none';

            if (view === 'idpw') {
                document.getElementById('loginCardIdPw').style.display = 'block';
                document.getElementById('loginId').focus();
            } else if (view === 'pin') {
                document.getElementById('loginCardPin').style.display = 'block';
                document.getElementById('loginPin').value = '';
                document.getElementById('loginPin').focus();
            } else if (view === 'setup') {
                document.getElementById('loginCardPinSetup').style.display = 'block';
                document.getElementById('newPin').value = '';
                document.getElementById('confirmPin').value = '';
                document.getElementById('newPin').focus();
            }
        }

        // PIN ë¡œê·¸ì¸ ì²˜ë¦¬
        async function performPinLogin() {
            const pin = document.getElementById('loginPin').value;
            if (pin.length !== 4) {
                showToast('PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'warning');
                return;
            }

            const trust = checkDeviceTrust();
            if (!trust) {
                showToast('ê¸°ê¸° ì‹ ë¢°ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'error');
                showLoginView('idpw');
                return;
            }

            const pinHash = await hashPassword(pin);
            if (pinHash !== trust.pinHash) {
                showToast('PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
                document.getElementById('loginPin').value = '';
                document.getElementById('loginPin').focus();
                return;
            }

            // PIN ì¼ì¹˜ - ì €ì¥ëœ ê´€ë¦¬ì ì •ë³´ë¡œ ë¡œê·¸ì¸
            currentAdmin = {
                id: trust.adminId,
                role: trust.adminRole,
                name: trust.adminName
            };

            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast(`${trust.adminName || trust.adminId}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`, 'success');
        }

        // PIN ì„¤ì • (ê¸°ê¸° ì‹ ë¢° ìƒì„±)
        async function setupDevicePin() {
            const newPin = document.getElementById('newPin').value;
            const confirmPin = document.getElementById('confirmPin').value;

            if (newPin.length !== 4) {
                showToast('PINì€ 4ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”', 'warning');
                return;
            }

            if (newPin !== confirmPin) {
                showToast('PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
                document.getElementById('confirmPin').value = '';
                document.getElementById('confirmPin').focus();
                return;
            }

            const pinHash = await hashPassword(newPin);
            const expiry = Date.now() + (DEVICE_TRUST_DAYS * 24 * 60 * 60 * 1000);

            const trustData = {
                adminId: currentAdmin.id,
                adminRole: currentAdmin.role,
                adminName: currentAdmin.name || currentAdmin.id,
                pinHash: pinHash,
                fingerprint: getDeviceFingerprint(),
                expiry: expiry,
                createdAt: Date.now()
            };

            localStorage.setItem(DEVICE_TRUST_KEY, JSON.stringify(trustData));

            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast('PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒë¶€í„° ë¹ ë¥´ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”!', 'success');
        }

        // PIN ì„¤ì • ê±´ë„ˆë›°ê¸°
        function skipPinSetup() {
            document.getElementById('loginOverlay').style.display = 'none';
            activateAdminMode();
            showToast(`${currentAdmin.name || currentAdmin.id}ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
        }

        // ê¸°ê¸° ì‹ ë¢° í•´ì œ (ë‹¤ë¥¸ ê³„ì • ë¡œê·¸ì¸)
        function clearDeviceTrust() {
            localStorage.removeItem(DEVICE_TRUST_KEY);
            showLoginView('idpw');
            showToast('ê¸°ê¸° ì‹ ë¢°ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ê¸° ì‹ ë¢° í™•ì¸
        function initLoginScreen() {
            const trust = checkDeviceTrust();
            if (trust) {
                // ê¸°ê¸° ì‹ ë¢° ìˆìŒ â†’ PIN ë¡œê·¸ì¸ í™”ë©´
                document.getElementById('trustedUserName').textContent = trust.adminName || trust.adminId;
                showLoginView('pin');
            } else {
                // ê¸°ê¸° ì‹ ë¢° ì—†ìŒ â†’ ID/PW ë¡œê·¸ì¸ í™”ë©´
                showLoginView('idpw');
            }
        }

        // (performLogin function has been moved to script top)
        // ì˜¤ë²„ë ˆì´ ë¡œê·¸ì¸ ì²˜ë¦¬ (ìŠ¤í¬ë¦½íŠ¸ ìµœìƒë‹¨ ì´ë™)
        async function performLogin() {
            console.log('performLogin function executed');
            const inputId = document.getElementById('loginId').value.trim();
            const inputPw = document.getElementById('loginPw').value;

            if (!inputId || !inputPw) {
                showToast('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                return;
            }

            // ë©”ì¸ê´€ë¦¬ì í™•ì¸ (í•´ì‹œ ë¹„êµ) - ë³µìˆ˜ ê´€ë¦¬ì ì§€ì›
            const inputHash = await hashPassword(inputPw);
            const mainAdmin = MAIN_ADMINS.find(admin => admin.id === inputId && admin.passwordHash === inputHash);
            if (mainAdmin) {
                currentAdmin = { id: mainAdmin.id, role: 'main', name: mainAdmin.name };
                // PIN ì„¤ì • í™”ë©´ìœ¼ë¡œ ì „í™˜
                showLoginView('setup');
                return;
            }

            // ì¼ë°˜ê´€ë¦¬ì í™•ì¸ (1ì°¨: ë¡œì»¬ ë°ì´í„°)
            let admins = getRegularAdmins();
            let found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);

            // ë¡œì»¬ì— ì—†ê±°ë‚˜ ì‹¤íŒ¨í•˜ë©´ í´ë¼ìš°ë“œ ë™ê¸°í™” í›„ ì¬ì‹œë„ (2ì°¨: í´ë¼ìš°ë“œ ë°ì´í„°)
            if (!found) {
                await syncAdminsFromCloud();
                admins = getRegularAdmins();
                found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);
            }

            if (found) {
                currentAdmin = { id: found.id, role: 'regular', name: found.name || found.id };
                // PIN ì„¤ì • í™”ë©´ìœ¼ë¡œ ì „í™˜
                showLoginView('setup');
            } else {
                showToast('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            }
        }

        let asListItems = []; // A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ ë°ì´í„°

        const categories = [
            { no: '01', name: 'ê°€ì„¤ê³µì‚¬' },
            { no: '02', name: 'ì„¤ê³„ ë° ê´€ë¦¬ë¹„' },
            { no: '03', name: 'ì² ê±°ê³µì‚¬' },
            { no: '04', name: 'ì„¤ë¹„/ë°©ìˆ˜ê³µì‚¬' },
            { no: '05', name: 'í™•ì¥/ë‹¨ì—´ê³µì‚¬' },
            { no: '06', name: 'ì°½í˜¸ê³µì‚¬' },
            { no: '07', name: 'ì „ê¸°/ì¡°ëª…ê³µì‚¬' },
            { no: '08', name: 'ì—ì–´ì»¨ê³µì‚¬' },
            { no: '09', name: 'ëª©ê³µ/ë„ì–´ê³µì‚¬' },
            { no: '10', name: 'í•„ë¦„ê³µì‚¬' },
            { no: '11', name: 'íƒ€ì¼ê³µì‚¬' },
            { no: '12', name: 'ìš•ì‹¤ê³µì‚¬' },
            { no: '13', name: 'ë„ì¥ê³µì‚¬' },
            { no: '14', name: 'ë„ë°°ê³µì‚¬' },
            { no: '15', name: 'ë°”ë‹¥ì¬ê³µì‚¬' },
            { no: '16', name: 'ê°€êµ¬ê³µì‚¬' },
            { no: '17', name: 'ë§ˆê°ê³µì‚¬' },
            { no: '18', name: 'ê¸°íƒ€ê³µì‚¬' }
        ];



        // ë‹¨ìœ„ ì˜µì…˜
        const unitOptions = ['ì‹', 'py', 'mÂ²', 'm', 'ea', 'set', 'unit', 'ë©´', 'ì', 'ë¡¤'];

        function getUnitSelectHTML(selectedValue = '') {
            const isCustom = selectedValue && !unitOptions.includes(selectedValue);
            if (isCustom) {
                // ì§ì ‘ì…ë ¥ëœ ê°’ì´ë©´ inputìœ¼ë¡œ í‘œì‹œ
                return `<div class= "unit-wrapper" >
                <input type="text" class="unit-input" value="${selectedValue}" placeholder="ë‹¨ìœ„" onblur="onUnitInputBlur(this)">
                    <button class="unit-toggle-btn" onclick="toggleUnitToSelect(this)" title="ëª©ë¡ì—ì„œ ì„ íƒ">â–¼</button>
                </div>`;
            }
            return `<select class= "unit-select" onchange = "onUnitChange(this)" > ${unitOptions.map(u =>
                `<option value="${u}" ${u === selectedValue ? 'selected' : ''}>${u}</option>`
            ).join('')
                } <option value = "__custom__" >âœï¸ ì§ì ‘ì…ë ¥</option></select> `;
        }

        // ë‹¨ìœ„ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ
        function onUnitChange(select) {
            if (select.value === '__custom__') {
                const wrapper = document.createElement('div');
                wrapper.className = 'unit-wrapper';
                wrapper.innerHTML = `
                <input type = "text" class= "unit-input" placeholder = "ë‹¨ìœ„ ì…ë ¥" autofocus onblur = "onUnitInputBlur(this)" >
                <button class="unit-toggle-btn" onclick="toggleUnitToSelect(this)" title="ëª©ë¡ì—ì„œ ì„ íƒ">â–¼</button>
    `;
                select.parentNode.replaceChild(wrapper, select);
                wrapper.querySelector('input').focus();
            }
        }

        // ì§ì ‘ì…ë ¥ -> ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì „í™˜
        function toggleUnitToSelect(btn) {
            const wrapper = btn.closest('.unit-wrapper');
            const currentValue = wrapper.querySelector('.unit-input').value || 'ì‹';
            const select = document.createElement('select');
            select.className = 'unit-select';
            select.setAttribute('onchange', 'onUnitChange(this)');
            select.innerHTML = unitOptions.map(u =>
                `<option value = "${u}" ${u === currentValue ? 'selected' : ''}> ${u}</option> `
            ).join('') + '<option value="__custom__">âœï¸ ì§ì ‘ì…ë ¥</option>';
            wrapper.parentNode.replaceChild(select, wrapper);
        }

        // ë‹¨ìœ„ ì…ë ¥ ë¸”ëŸ¬ ì‹œ ë¹ˆê°’ì´ë©´ ê¸°ë³¸ê°’
        function onUnitInputBlur(input) {
            if (!input.value.trim()) {
                input.value = 'ì‹';
            }
        }

        // ê¸°ë³¸ ì›ê°€ ë°ì´í„° (ê°€ì„¤ê³µì‚¬)
        const defaultCostData = {
            '01': [
                { div: 'ë³´ì–‘', name: 'ìŠ¹ê°•ê¸° í•˜í”„ë³´ì–‘', spec: 'ìŠ¹ê°•ê¸° í•˜í”„ë³´ì–‘', unit: 'ì‹', qty: '1', price: '90000' },
                { div: 'ë³´ì–‘', name: 'ìŠ¹ê°•ê¸° ì¤€ë³´ì–‘', spec: 'ìŠ¹ê°•ê¸° ì¤€ë³´ì–‘', unit: 'ì‹', qty: '1', price: '120000' },
                { div: 'ë³´ì–‘', name: 'ìŠ¹ê°•ê¸° ì˜¬ë³´ì–‘', spec: 'ìŠ¹ê°•ê¸° ì˜¬ë³´ì–‘', unit: 'ì‹', qty: '1', price: '160000' },
                { div: 'ë³´ì–‘', name: 'ë³µë„ë³´ì–‘', spec: 'í”Œë¼ë² ë‹ˆì•„ (ê¸°ë³¸ 12ì¥)', unit: 'ì‹', qty: '1', price: '120000' },
                { div: 'ë³´ì–‘', name: 'ë™ì„ ë³´ì–‘', spec: 'ì¶”ê°€í•­ëª©', unit: 'ì‹', qty: '1', price: '6000' },
                { div: 'ë³´ì–‘', name: 'í˜„ê´€ë¬¸ ë³´ì–‘', spec: 'í˜„ê´€ë¬¸ ë³´ì–‘', unit: 'ì‹', qty: '1', price: '50000' },
                { div: 'ë³´ì–‘', name: 'ì°½í˜¸ ë³´ì–‘', spec: 'ì§‘ ì „ì²´ ì°½í˜¸', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ë³´ì–‘', name: 'ì‹¤ë‚´ ë°”ë‹¥ ë³´ì–‘', spec: 'Floor Veneer ê¸°ë³¸ 12ì¥', unit: 'ì‹', qty: '1', price: '120000' },
                { div: 'ë³´ì–‘', name: 'ì‹¤ë‚´ ë°”ë‹¥ ë³´ì–‘ (ì¶”ê°€)', spec: 'Floor Veneer', unit: 'ì‹', qty: '1', price: '6000' },
                { div: 'ë³´ì–‘', name: 'ì‹¤ë‚´ ë°”ë‹¥ ë³´ì–‘', spec: 'ë¡¤ ê³¨íŒì§€', unit: 'ë¡¤', qty: '1', price: '90000' },
                { div: 'ë³´ì–‘', name: 'ë¹„ë‹ ë³´ì–‘', spec: 'ì»¤ë²„ë§ 2.4', unit: 'ì‹', qty: '1', price: '50000' },
                { div: 'ë™ì˜ì„œ', name: 'ì…ì£¼ë¯¼ ë™ì˜ì„œ', spec: '1~80 ì„¸ëŒ€ (50%ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '160000' },
                { div: 'ë™ì˜ì„œ', name: 'ì…ì£¼ë¯¼ ë™ì˜ì„œ', spec: '81~100 ì„¸ëŒ€ (50%ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '190000' },
                { div: 'ë™ì˜ì„œ', name: 'ì…ì£¼ë¯¼ ë™ì˜ì„œ', spec: '101~120 ì„¸ëŒ€ (50%ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '210000' },
                { div: 'ë™ì˜ì„œ', name: 'ì…ì£¼ë¯¼ ë™ì˜ì„œ', spec: '121~140 ì„¸ëŒ€ (50%ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '230000' },
                { div: 'ë™ì˜ì„œ', name: 'ì…ì£¼ë¯¼ ë™ì˜ì„œ', spec: 'ì¶”ê°€ 20ì„¸ëŒ€', unit: 'ì‹', qty: '1', price: '20000' },
                { div: 'í—ˆê°€', name: 'ê³µë™ì£¼íƒ í–‰ìœ„í—ˆê°€', spec: 'ì£¼íƒê³¼', unit: 'ì‹', qty: '1', price: '440000' },
                { div: 'í—ˆê°€', name: 'ê³µë™ì£¼íƒ í–‰ìœ„í—ˆê°€', spec: 'ê±´ì¶•ê³¼', unit: 'ì‹', qty: '1', price: '880000' },
                { div: 'í•„ì¦', name: 'ë°©í™”íŒ', spec: 'ìì¬+ì‹œê³µ (1200*550)', unit: 'ea', qty: '1', price: '50000' },
                { div: 'í•„ì¦', name: 'ë°©í™”ìœ ë¦¬ (ì§ì„ )', spec: 'ìì¬+ì‹œê³µ', unit: 'm', qty: '1', price: '180000' },
                { div: 'í•„ì¦', name: 'ë°©í™”ìœ ë¦¬ (ê³¡ì„ )', spec: 'ìì¬+ì‹œê³µ', unit: 'm', qty: '1', price: '200000' },
                { div: 'í•„ì¦', name: 'ê°‘ì¢… ë°©í™”ë¬¸', spec: 'ìì¬+ì‹œê³µ+ì‹œí—˜ì„±ì ì„œ (900*2000)', unit: 'ea', qty: '1', price: '1300000' },
                { div: 'í•„ì¦', name: 'ì†Œë°© ê°ì§€ê¸°', spec: 'ê±´ì „ì§€ ë°©ì‹', unit: 'ea', qty: '1', price: '20000' },
                { div: 'ìš©ë„ë³€ê²½', name: 'ìƒì—…ê³µê°„ ìš©ë„ë³€ê²½', spec: 'êµ¬ì¡°Â·ì„¤ë¹„Â·ìœ„ìƒÂ·ì•ˆì „ ê¸°ì¤€ ì¶©ì¡± ì—¬ë¶€ì— ë”°ë¥¸ ì‹ ê³ /í—ˆê°€', unit: 'ì‹', qty: '1', price: '0' }
            ],
            '02': [
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© ì² ê±° (ì†Œí˜•)', spec: 'ã…¡ì, ã„±ì (3.5M ë¯¸ë§Œ)', unit: 'set', qty: '1', price: '70000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© ì² ê±° (ì¤‘í˜•)', spec: 'ã…¡ì, ã„±ì (5M ë¯¸ë§Œ)', unit: 'set', qty: '1', price: '90000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© ì² ê±° (ëŒ€í˜•)', spec: 'ã…¡ì, ã„±ì (5M ì´ìƒ)', unit: 'set', qty: '1', price: '100000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© ì² ê±° (íŠ¹ëŒ€)', spec: '12M ë¯¸ë§Œ ã„·ì, ã…ì, ë³‘ë ¬í˜•', unit: 'set', qty: '1', price: '130000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© ì² ê±° (ì´ˆíŠ¹ëŒ€)', spec: '12M ì´ìƒ ã„·ì, ã…ì, ë³‘ë ¬í˜•', unit: 'set', qty: '1', price: '160000' },
                { div: 'ì£¼ë°©', name: 'ì‹±í¬ëŒ€ ì¶”ê°€ (Më‹¹)', spec: 'ê¸°ë³¸ ì„¸íŠ¸ ì´ˆê³¼ ë¬¼ëŸ‰', unit: 'M', qty: '1', price: '10000' },
                { div: 'ì£¼ë°©', name: 'ì•„ì¼ëœë“œ ì‹íƒ', spec: 'ë…ë¦½í˜• (ì¹´ìš´í„° íƒ€ì… ì œì™¸)', unit: 'set', qty: '1', price: '35000' },
                { div: 'ì£¼ë°©', name: 'ë³´ì¡°ì£¼ë°©', spec: 'ë°œì½”ë‹ˆ ë³´ì¡°ì£¼ë°©', unit: 'set', qty: '1', price: '40000' },
                { div: 'ì£¼ë°©', name: 'ëƒ‰ì¥ê³ ì¥/í‚¤í°ì¥', spec: 'ì(30cm)ë‹¹ ë‹¨ê°€', unit: 'ì', qty: '1', price: '10000' },
                { div: 'ì£¼ë°©', name: 'í‚¤í°ì¥ (ìœ ë¦¬ì¥ì‹)', spec: 'ëŒ€í˜•í‰ìˆ˜ ìœ ë¦¬ ì¥ì‹ì¥', unit: 'ì', qty: '1', price: '15000' },
                { div: 'ì£¼ë°©', name: 'ëƒ‰ì¥ê³ ì¥ (ì‹ ì¶• EP)', spec: 'ë°”ë‹¥/ì²œì¥ ì¬ì‚¬ìš© ì‹œ (ì¢Œìš° EP)', unit: 'íŒ', qty: '1', price: '50000' },
                { div: 'ì£¼ë°©', name: 'ë¹ŒíŠ¸ì¸ ê¸°ê¸°', spec: 'ì‹ê¸°ì„¸ì²™ê¸°, ì˜¤ë¸, ì„¸íƒê¸° ë“±', unit: 'ea', qty: '1', price: '20000' },
                { div: 'ì£¼ë°©', name: 'ìˆ˜ì „(ëƒ‰/ì˜¨)', spec: '1m ë¯¸ë§Œ / ë‚´ë¦¼ì„¤ë¹„', unit: 'ea', qty: '1', price: '75000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© íƒ€ì¼ ì² ê±°', spec: '1M ê¸°ì¤€ (H1200 ì´í•˜)', unit: 'M', qty: '1', price: '18000' },
                { div: 'ì£¼ë°©', name: 'ì£¼ë°© íƒ€ì¼+ì„¸ë¼í”½ìŠ¤', spec: 'ìƒŒë”© ì‘ì—… í¬í•¨ (ìµœê³ ê°€ ì ìš©)', unit: 'py', qty: '1', price: '100000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë¶™ë°•ì´ì¥/ì¥ë¡±', spec: 'ë„ì–´ 1ê°œ ê¸°ì¤€ (ìŠ¬ë¼ì´ë”© x2)', unit: 'EA', qty: '1', price: '13000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë¶™ë°•ì´ì¥ (ì ë‹¨ìœ„)', spec: 'ì(30cm)ë‹¹ ê³„ì‚° ì‹œ', unit: 'ì', qty: '1', price: '10000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'í˜„ê´€ì¥ (ì‹ ë°œì¥)', spec: 'ë„ì–´ 1ê°œ ê¸°ì¤€', unit: 'ea', qty: '1', price: '11000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë²½ë°•ì´ì¥/ì°½ê³ ì¥', spec: 'ë¬¸í‹€/ë¬¸ì„ /ë¬¸ì§ í¬í•¨ (ë¯¸ì¥ë³„ë„)', unit: 'ea', qty: '1', price: '16000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë²½ë°•ì´ì¥ (ì„¸íŠ¸)', spec: 'ë¬¸4ê°œ+ë‚´ë¶€ì¥ (ëŒ€í˜•)', unit: 'set', qty: '1', price: '120000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ê±°ì‹¤ì¥ (ì„¸íŠ¸)', spec: 'ì†Œ2+ì¤‘1 ê¸°ì¤€', unit: 'set', qty: '1', price: '30000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë¹ŒíŠ¸ì¸ í™”ì¥ëŒ€', spec: '1.5M ì´í•˜', unit: 'ea', qty: '1', price: '35000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ë² ë€ë‹¤ì¥ (ì°½ê³ )', spec: 'ë‚´ë¶€ ì„ ë°˜ í¬í•¨', unit: 'ea', qty: '1', price: '30000' },
                { div: 'ê°€êµ¬(ìˆ˜ë‚©)', name: 'ì¹¨ëŒ€+ë§¤íŠ¸ë¦¬ìŠ¤', spec: 'íê¸°ë¬¼ ìŠ¤í‹°ì»¤ ë¶€ì°© ê¶Œì¥', unit: 'ea', qty: '1', price: '60000' },
                { div: 'ë°”ë‹¥', name: 'ë§ˆë£¨ ì² ê±° (ë³¸ë“œì‹)', spec: 'ê°•ë§ˆë£¨, í•©íŒ, ì›ëª© (ê¸°ë³¸ìƒŒë”©)', unit: 'py', qty: '1', price: '25000' },
                { div: 'ë°”ë‹¥', name: 'ê°•í™”ë§ˆë£¨', spec: 'ì¡°ë¦½ì‹ (ê¸°ë³¸ìƒŒë”©)', unit: 'py', qty: '1', price: '17000' },
                { div: 'ë°”ë‹¥', name: 'ë°ì½”íƒ€ì¼', spec: '(ê¸°ë³¸ìƒŒë”©)', unit: 'py', qty: '1', price: '20000' },
                { div: 'ë°”ë‹¥', name: 'í´ë¦¬ì‹± íƒ€ì¼', spec: 'íƒ€ì¼+ë³¸ë“œ+ìƒŒë”©', unit: 'py', qty: '1', price: '90000' },
                { div: 'ë°”ë‹¥', name: 'ëŒ€ë¦¬ì„', spec: 'ëŒ€ë¦¬ì„+ì‚¬ëª¨ë˜+ëª°íƒˆë¯¸ì¥(ë‚œë°©ë°°ê´€ë¯¸í¬í•¨)', unit: 'py', qty: '1', price: '250000' },
                { div: 'ë°”ë‹¥', name: 'ëŒ€ë¦¬ì„', spec: 'ëŒ€ë¦¬ì„+ì‚¬ëª¨ë˜+ëª°íƒˆë¯¸ì¥(ë‚œë°©ë°°ê´€ì¬ì‹œê³µ)', unit: 'py', qty: '1', price: '330000' },
                { div: 'ë°”ë‹¥', name: 'ì¥íŒ ì² ê±°', spec: 'ë°© 1ê°œ ê¸°ì¤€', unit: 'ea', qty: '1', price: '12000' },
                { div: 'ë°”ë‹¥', name: 'í•œì§€ ì¥íŒ', spec: 'ìƒŒë”©', unit: 'py', qty: '1', price: '12000' },
                { div: 'ë°”ë‹¥', name: 'ë°”ë‹¥ ìƒŒë”©', spec: 'ë‹¨ì°¨/í‰í™œë„ ë¶ˆëŸ‰ì‹œ(ë¬¸í„±)', unit: 'ea', qty: '1', price: '60000' },
                { div: 'ì°½í˜¸', name: 'ê±°ì‹¤ ë¶„í•©ì°½', spec: 'í™•ì¥ì‹œ ì„ ì² ê±°', unit: 'set', qty: '1', price: '150000' },
                { div: 'ì°½í˜¸', name: 'ì‘ì€ë°© ë¶„í•©ì°½', spec: 'í™•ì¥ì‹œ ì„ ì² ê±°', unit: 'set', qty: '1', price: '90000' },
                { div: 'ì°½í˜¸', name: 'ëŒ€í˜• ìƒ·ì‹œ/í´ë”©', spec: 'íŠ¹ëŒ€í˜• êµ¬ë¶„', unit: 'set', qty: '1', price: '250000' },
                { div: 'ë„ì–´', name: 'ë„ì–´ ì„¸íŠ¸ ì² ê±°', spec: 'ë¬¸í‹€+ë¬¸ì§+ë¬¸ì„ +ì¸ë°©', unit: 'set', qty: '1', price: '32000' },
                { div: 'ë„ì–´', name: 'íŠ¹ìˆ˜ ë¬¸í‹€ (ëŒ/ABS)', spec: 'íê¸°ë¬¼ í¬í•¨ì‹œ (ìµœê³ ê°€)', unit: 'set', qty: '1', price: '50000' },
                { div: 'ë„ì–´', name: 'ë¬¸ì§ë§Œ ì² ê±°', spec: '', unit: 'ea', qty: '1', price: '30000' },
                { div: 'ë„ì–´', name: 'ë¬¸í„± ì œê±°', spec: 'ë¯¸ì¥ í¬í•¨', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ë„ì–´', name: 'ì¤‘ë¬¸ ì² ê±°', spec: '3ì—°ë™, ã„±ìë“± ì¢…ë¥˜ ë¬´ê´€', unit: 'set', qty: '1', price: '100000' },
                { div: 'ë„ì–´', name: 'ë°©í™”ë¬¸ ì² ê±°', spec: '', unit: 'ea', qty: '1', price: '80000' },
                { div: 'ë²½ë©´', name: 'ë²½ë©´ ì² ê±°', spec: 'ì„ê³  (h:2400)', unit: 'm', qty: '1', price: '40000' },
                { div: 'ë²½ë©´', name: 'ë‹¨ì—´ë²½ ì² ê±°', spec: 'ëª©ì¬+ë‹¨ì—´(ìŠ¤í‹°ë¡œí´)+ì„ê³  (h:2400)', unit: 'm', qty: '1', price: '70000' },
                { div: 'ë²½ë©´', name: 'ë‹¨ì—´ë²½ ì² ê±°', spec: 'ëª©ì¬+ë‹¨ì—´(ìœ ë¦¬ì„¬ìœ )+ì„ê³  (h:2400)', unit: 'm', qty: '1', price: '90000' },
                { div: 'ë²½ë©´', name: 'ê°€ë²½ì² ê±°', spec: 'ëª©ê³µ+ì„ê³  (h:2400)', unit: 'm', qty: '1', price: '50000' },
                { div: 'ë²½ì²´', name: 'ê°€ë²½ ì² ê±°', spec: 'ëª©ê³µ/ì„ê³ /ë‹¨ì—´ì¬ (H2400)', unit: 'M', qty: '1', price: '55000' },
                { div: 'ë²½ì²´', name: 'ALC ë¸”ëŸ­ ê°€ë²½', spec: 'ë¸Œë¼ë” ìƒì„¸ í•­ëª©', unit: 'M', qty: '1', price: '120000' },
                { div: 'ë²½ì²´', name: 'ì¡°ì ë²½ (ë¶€ë¶„/ë‚ ê°œ)', spec: 'ë¹„ë‚´ë ¥ ì¡°ì  1M', unit: 'M', qty: '1', price: '100000' },
                { div: 'ë²½ì²´', name: 'ì¡°ì ë²½ (ë‘ê²¹)', spec: 'ë¸Œë¼ë” ìƒì„¸ í•­ëª©', unit: 'M', qty: '1', price: '250000' },
                { div: 'ë²½ì²´', name: 'ì•„íŠ¸ì›” (ëª©ê³µ)', spec: 'H2400 ì´í•˜', unit: 'M', qty: '1', price: '33000' },
                { div: 'ë²½ì²´', name: 'ì•„íŠ¸ì›” (íƒ€ì¼/ì„ì¬)', spec: 'H2400 ì´í•˜ (ìµœê³ ê°€ ì ìš©)', unit: 'M', qty: '1', price: '60000' },
                { div: 'ë²½ì²´', name: 'ì˜¹ë²½ ì»·íŒ…', spec: 'ì¥ë¹„(ë²½ì²´15, ìƒ¤ì‹œí•˜ë‹¨ë¶€45, í•˜ë£¨65)', unit: 'ì‹', qty: '1', price: '650000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ì²œì¥ ê¸°ë³¸ ì² ê±°', spec: 'ì£¼ë³€ ëª°ë”©ë§Œ', unit: 'set', qty: '1', price: '30000' },
                { div: 'ì²œì¥', name: 'ë“±ë°•ìŠ¤ ì² ê±° (ëŒ€í˜•)', spec: 'ì² ì œ/ëŒ€í˜• ë“±ë°•ìŠ¤', unit: 'set', qty: '1', price: '200000' },
                { div: 'ì²œì¥', name: 'ë“±ë°•ìŠ¤ ì² ê±° (ì¼ë°˜)', spec: 'ì¼ë°˜ ëª©ê³µ ë“±ë°•ìŠ¤', unit: 'set', qty: '1', price: '50000' },
                { div: 'ì²œì¥', name: 'ì²œì¥ ì „ì²´ ì² ê±°', spec: 'ì„ê³ ë§Œ(ëŒ„ì¡° ìœ ì§€)', unit: 'py', qty: '1', price: '20000' },
                { div: 'ì²œì¥', name: 'ì²œì¥ ì „ì²´ ì² ê±°', spec: 'ìš°ë¬¼ì²œì¥ ëŒ„ì¡°í¬í•¨ í‰ë‹¹', unit: 'py', qty: '1', price: '40000' },
                { div: 'ì²œì¥', name: 'ëª°ë”©/ê±¸ë ˆë°›ì´', spec: 'í‰ë‹¹ ê¸°ì¤€', unit: 'py', qty: '1', price: '4000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ê¸°ë³¸ ì² ê±°', spec: 'ë„ê¸°/ìš•ì¡°/ì²œì¥/ì•¡ì„¸ì„œë¦¬', unit: 'set', qty: '1', price: '150000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ê¸°ë³¸ ì² ê±°', spec: 'ë„ê¸°/frpìš•ì¡°/ì²œì¥/ì•¡ì„¸ì„œë¦¬', unit: 'set', qty: '1', price: '200000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ì „ì²´ ì² ê±°', spec: 'íƒ€ì¼+ë°©ìˆ˜ì¸µ ì „ì²´ (ëŒ€í˜•) - ë‚œë°©ë°°ê´€ ë³„ë„(10)', unit: 'set', qty: '1', price: '900000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ì „ì²´ ì² ê±°', spec: 'íƒ€ì¼+ë°©ìˆ˜ì¸µ ì „ì²´ (ì¤‘í˜•) - ë‚œë°©ë°°ê´€ ë³„ë„(7)', unit: 'set', qty: '1', price: '750000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ì „ì²´ ì² ê±°', spec: 'íƒ€ì¼+ë°©ìˆ˜ì¸µ ì „ì²´ (ì†Œí˜•) - ë‚œë°©ë°°ê´€ ë³„ë„(5)', unit: 'set', qty: '1', price: '600000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ë°”ë‹¥ ì² ê±°', spec: 'ë°”ë‹¥ íƒ€ì¼+ì•¡ì²´ë°©ìˆ˜ 1ì°¨', unit: 'set', qty: '1', price: '400000' },
                { div: 'ìš•ì‹¤', name: 'UBR ìš•ì‹¤ ì² ê±°', spec: 'ì „ì²´ì² ê±°+ì„¤ë¹„+ë°©ìˆ˜ 1ì°¨ (ì¡°ì ë²½ ë³„ë„)', unit: 'set', qty: '1', price: '1200000' },
                { div: 'ìš•ì‹¤', name: 'UBR ìš•ì‹¤ ì¡°ì ', spec: 'ì…êµ¬ ë²½ë©´ (h:1500)', unit: 'ë©´', qty: '1', price: '200000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì¡° ì² ê±°', spec: 'ì•„í¬ë¦´ ìš•ì¡° (ê°œë³„ ì² ê±°ì‹œ)', unit: 'ea', qty: '1', price: '35000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì¡° ì² ê±°', spec: 'ì›”í’€ ìš•ì¡° (ê°œë³„ ì² ê±°ì‹œ)', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì¡° ì² ê±° (ì¡°ì )', spec: 'ì¡°ì /ë§¤ë¦½ í˜•íƒœ', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ìš•ì‹¤', name: 'ìš•ì‹¤ ë²½íƒ€ì¼(1ë©´)', spec: 'ë§ë°© ë¶ˆê°€ì‹œ', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ìš•ì‹¤', name: 'ë¼ë””ì—ì´í„° ì² ê±°', spec: 'ë©”ê¾¸ë¼/ë¯¸ì¥ í¬í•¨', unit: 'EA', qty: '1', price: '100000' },
                { div: 'íƒ€ì¼', name: 'í˜„ê´€ ë””ë”¤ì„', spec: 'í•œë©´', unit: 'ì‹', qty: '1', price: '50000' },
                { div: 'íƒ€ì¼', name: 'í˜„ê´€ ë°”ë‹¥', spec: 'íƒ€ì¼ë§Œ', unit: 'py', qty: '1', price: '50000' },
                { div: 'íƒ€ì¼', name: 'í˜„ê´€ ë°”ë‹¥', spec: 'ì›ë°”ë‹¥(íƒ€ì¼ ì‹œê³µì‹œ ì­ˆê¾¸ë¯¸ë¹„ìš© í‰ë‹¹ 5ë§Œì› ë³„ë„)', unit: 'py', qty: '1', price: '100000' },
                { div: 'íƒ€ì¼', name: 'ë°œì½”ë‹ˆ ë°”ë‹¥íƒ€ì¼ ì² ê±°', spec: 'íƒ€ì¼ë§Œ 0.5í‰(1.3MÃ—1.3M)', unit: 'ì‹', qty: '1', price: '50000' },
                { div: 'íƒ€ì¼', name: 'ë°œì½”ë‹ˆ ë°”ë‹¥íƒ€ì¼ ì² ê±°', spec: 'íƒ€ì¼+ì••ì°©ë³¸ë“œ 0.5í‰(1.3MÃ—1.3M)', unit: 'ì‹', qty: '1', price: '70000' },
                { div: 'íƒ€ì¼', name: 'ë°œì½”ë‹ˆ ë°”ë‹¥íƒ€ì¼ ì² ê±°', spec: 'ì› ë°”ë‹¥ê¹Œì§€(ë°©ìˆ˜ë³„ë„) 0.5í‰(1.3MÃ—1.3M)', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'ì¡°ëª…', name: 'ë°©ë“±', spec: '', unit: 'ea', qty: '1', price: '5000' },
                { div: 'ì¡°ëª…', name: 'ê±°ì‹¤ë“±', spec: '', unit: 'ea', qty: '1', price: '15000' },
                { div: 'ì¡°ëª…', name: 'ë§¤ì…ë“±', spec: '', unit: 'ea', qty: '1', price: '2000' },
                { div: 'ì¡°ëª…', name: 'ìŠ¤ìœ„ì¹˜/ì½˜ì„¼íŠ¸', spec: '', unit: 'í‰', qty: '1', price: '4000' },
                { div: 'í™”ë‹¨', name: 'í™”ë‹¨', spec: 'í™ (ì“°ë ˆê¸° ë³„ë„)', unit: 'ì‹', qty: '1', price: '100000' },
                { div: 'í™”ë‹¨', name: 'í™”ë‹¨', spec: 'ì¡°ì  (h:600 ê¸°ì¤€)', unit: 'm', qty: '1', price: '100000' },
                { div: 'í™”ë‹¨', name: 'í™”ë‹¨', spec: 'ì˜¹ë²½ (h:600 ê¸°ì¤€)', unit: 'm', qty: '1', price: '150000' },
                { div: 'í™”ë‹¨', name: 'í™”ë‹¨', spec: 'ì˜¹ë²½ (h:600 ê¸°ì¤€-í¬ë¼ìƒ¤ ì‘ì—…)', unit: 'm', qty: '1', price: '250000' },
                { div: 'ê°€ìŠ¤', name: 'ê°€ìŠ¤ë°°ê´€ ë¶€ë¶„ì² ê±°', spec: 'ê°€ìŠ¤ë°°ê´€ ë‚´ë¶€ (ê³„ëŸ‰ê¸° ìœ ì§€)', unit: 'ì‹', qty: '1', price: '100000' },
                { div: 'ê°€ìŠ¤', name: 'ê°€ìŠ¤ë°°ê´€ ì „ì²´ì² ê±°', spec: 'ê°€ìŠ¤ë°°ê´€ ì „ì²´ ì² ê±° (ì™¸ë¶€ì—ì„œ ë§ˆê° - ê³„ëŸ‰ê¸° í˜„ì¥ì— ë³´ê´€)', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'íê¸°ë¬¼', name: '1í†¤ íŠ¸ëŸ­ (ë§Œì°¨)', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ëŒ€', qty: '1', price: '550000' },
                { div: 'íê¸°ë¬¼', name: '1í†¤ íŠ¸ëŸ­ (3/4)', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ëŒ€', qty: '1', price: '520000' },
                { div: 'íê¸°ë¬¼', name: '1í†¤ íŠ¸ëŸ­ (1/2)', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ëŒ€', qty: '1', price: '320000' },
                { div: 'íê¸°ë¬¼', name: '1í†¤ íŠ¸ëŸ­ (1/4)', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ëŒ€', qty: '1', price: '250000' },
                { div: 'íê¸°ë¬¼', name: '1í†¤ íŠ¸ëŸ­ (ì ì¬í•¨ë°˜ì°¨)', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ëŒ€', qty: '1', price: '150000' },
                { div: 'íê¸°ë¬¼', name: 'ì†ŒëŸ‰ íê¸°ë¬¼', spec: 'í˜¼í•©íê¸°ë¬¼ (ì •ë¦¬ë° ì´ë™ë¹„ í¬í•¨)', unit: 'ì‹', qty: '1', price: '100000' }
            ],
            '03': [
                { div: 'ë°©ìˆ˜', name: '2ì°¨ ì•¡ì²´ ë°©ìˆ˜', spec: 'ì „ì²´ ë°”ë‹¥/ë²½(h:1000ì´ìƒ) ë°©ìˆ˜ëª°íƒˆ', unit: 'ì¹¸', qty: '1', price: '120000' },
                { div: 'ë°©ìˆ˜', name: 'ìš•ì¡° ë°©ìˆ˜', spec: 'ìš•ì¡°ë¶€ë§Œ ë°©ìˆ˜', unit: 'ea', qty: '1', price: '60000' },
                { div: 'ë°©ìˆ˜', name: '3ì°¨ ë„ë§‰ ë°©ìˆ˜ ì½”ë„ˆë§Œ (2íšŒ)', spec: 'ë§ˆí˜ì´/ì•„ë±ìŠ¤(í”„ë¼ì´ë¨¸+ë°©ìˆ˜ì œ)-ì·¨ì•½ë¶€ìœ„', unit: 'ì¹¸', qty: '1', price: '200000' },
                { div: 'ë°©ìˆ˜', name: '3ì°¨ ë„ë§‰ ë°©ìˆ˜ ì „ì²´ (2íšŒ)', spec: 'ë§ˆí˜ì´/ì•„ë±ìŠ¤(í”„ë¼ì´ë¨¸+ë°©ìˆ˜ì œ)-(h:1000ì´ìƒ)', unit: 'ì¹¸', qty: '1', price: '400000' },
                { div: 'ë‚œë°©ë°°ê´€', name: 'ë¼ì§€ì—ì´í„°', spec: 'ì² ê±° í›„ ì—‘ì…€ ë§ˆê°+ë¯¸ì¥ í¬í•¨', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ë‚œë°©ë°°ê´€', name: 'í™”ì¥ì‹¤ ë‚œë°©ë°°ê´€ ì—°ì¥', spec: 'í™”ì¥ì‹¤ ë°”ë‹¥ ë‚œë°©ë°°ê´€ ì—°ì¥ - ê¸°ë³¸', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ë‚œë°©ë°°ê´€', name: 'í™”ì¥ì‹¤ ë‚œë°©ë°°ê´€ ì—°ì¥', spec: 'í™”ì¥ì‹¤ ë°”ë‹¥ ë‚œë°©ë°°ê´€ ì—°ì¥ - íŠ¹ëŒ€', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ìˆ˜ë„', name: 'ê¸‰ìˆ˜ê´€ ì‹ ì„¤ (ë…¸ì¶œ-1ë©´)', spec: 'ëƒ‰/ì˜¨ìˆ˜ 1ì¡° ì‹ ì„¤ (1ë©´ êº¾ìŒ ê¸°ì¤€) - ë…¸ì¶œ', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ìˆ˜ë„', name: 'ê¸‰ìˆ˜ê´€ ì‹ ì„¤ (ë…¸ì¶œ-2ë©´)', spec: 'ëƒ‰/ì˜¨ìˆ˜ 1ì¡° ì‹ ì„¤ (2ë©´ êº¾ìŒ ê¸°ì¤€) - ë…¸ì¶œ', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ìˆ˜ë„', name: 'ê¸‰ìˆ˜ê´€ ì‹ ì„¤ (ë§¤ë¦½)', spec: 'ëƒ‰/ì˜¨ìˆ˜ 1ì¡° ì‹ ì„¤ (ì˜¹ë²½ì˜ ê²½ìš°) - ë§¤ë¦½', unit: 'ea', qty: '1', price: '350000' },
                { div: 'ìˆ˜ë„', name: 'ê¸‰ìˆ˜ê´€ ì´ë™', spec: 'ê¸°ì¡´ë©´ ì´ë™ (ì„¸ë©´ë¶€ ëª¨ìŒ, ìƒ¤ì›Œë¶€ ë†’ì´ ì¡°ì ˆ ë“±)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'í•˜ìˆ˜', name: 'PíŠ¸ë© ì „í™˜', spec: 'ë°”ë‹¥ ë°°ìˆ˜ â†’ ë²½ ë°°ìˆ˜ ì „í™˜ (ì² ê±°, ë§¤ë¦½ í¬í•¨)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'í•˜ìˆ˜', name: 'í•˜ìˆ˜ê´€ ì´ë™', spec: 'ë°”ë‹¥ ë°°ìˆ˜ ì´ë™', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ì˜¤ìˆ˜', name: 'ì˜¤ìˆ˜ ë°°ê´€', spec: '200~250mm ì´ë™', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ìˆ˜ë„', name: 'ìˆ˜ë„ ë§‰ìŒ', spec: 'ê¸°ì¡´ ìˆ˜ë„ ëƒ‰/ì˜¨ìˆ˜ 1ì¡°', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ìˆ˜ë„', name: 'ë§¤ë¦½ìˆ˜ì „', spec: 'ìƒ¤ì›Œ/ì„¸ë©´ëŒ€ (ì  ë‹¤ì´ í•„ìˆ˜-í¬í•¨)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'ì¡°ì ', name: 'ì¡°ì  ì  ë‹¤ì´ (ìˆ)', spec: 'ì„¸ë©´ëŒ€ë¶€ ì¡°ì  ì  ë‹¤ì´ ì‹œê³µ (h:1100)', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'ì¡°ì ', name: 'ì¡°ì  ì  ë‹¤ì´ (ë¡±)', spec: 'ì„¸ë©´ëŒ€+ìƒ¤ì›Œ ì „ì²´ ì¡°ì  ì  ë‹¤ì´ ì‹œê³µ (h:1100)', unit: 'ì‹', qty: '1', price: '250000' },
                {
                    div: 'ë¶„ë°°ê¸°', name: 'ë¶„ë°°ê¸° êµì²´ - ê¸°ë³¸', spec: 'ê¸°ì¡´ ë¶„ë°°ê¸° êµì²´ - ì¼ë°˜ (ì´ë™ ì—†ìŒ, ì‹œìŠ¤í…œ êµ¬ë™ê¸° ë³„ë„)', unit: 'ì‹', qty: '1', price: '1300000'
                },
                {
                    div: 'ë¶„ë°°ê¸°', name: 'ë¶„ë°°ê¸° êµì²´ - ë§¤ë¦½í˜•', spec: 'ê¸°ì¡´ ë¶„ë°°ê¸° êµì²´ -ë§¤ë¦½í˜• (ì´ë™ ì—†ìŒ, ì‹œìŠ¤í…œ êµ¬ë™ê¸° ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '1500000'
                },
                { div: 'ë¶„ë°°ê¸°', name: 'ë¶„ë°°ê¸° ì´ë™', spec: 'ê¸°ì¡´ ë¶„ë°°ê¸° ìœ„ì¹˜ì—ì„œ 2m ì´ë‚´ ì´ë™ (ê¸°ì¡´ ë¶„ë°°ê¸° ì¬ì‚¬ìš©)', unit: 'ì‹', qty: '1', price: '1600000' },
                { div: 'ê°€ìŠ¤ë°°ê´€ ì² ê±°', name: 'ê°€ìŠ¤ë°°ê´€ ì² ê±°', spec: 'ê¸°ë³¸ ì² ê±° (ë¶€ë¶„ ì² ê±°, ê³„ëŸ‰ê¸° ìœ ì§€ìƒíƒœ)', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'ê°€ìŠ¤ë°°ê´€ ì² ê±°', name: 'ê°€ìŠ¤ë°°ê´€ ì² ê±°', spec: 'ì „ì²´ ì² ê±° (ì™¸ë¶€ì—ì„œ ë§ˆê°, ê³„ëŸ‰ê¸° ì„¸ëŒ€ë³´ê´€)', unit: 'ì‹', qty: '1', price: '250000' },
                { div: 'ê°€ìŠ¤ë°°ê´€ ì—°ì¥', name: 'ê°€ìŠ¤ë°°ê´€ ì—°ì¥ (ê¸°ì¡´ìœ ì§€)', spec: 'ê°€ìŠ¤ë°°ê´€ ì´ë™ ê¸°ì¡´ ìœ ì§€í•˜ëŠ” ìƒíƒœì—ì„œ', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ê°€ìŠ¤ë°°ê´€ ì—°ì¥', name: 'ê°€ìŠ¤ë°°ê´€ ì—°ì¥ (ë¶€ë¶„ì² ê±°)', spec: 'ê°€ìŠ¤ë°°ê´€ ì´ë™ ë¶€ë¶„ ì² ê±°', unit: 'ì‹', qty: '1', price: '350000' },
                { div: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤', name: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤ (ìƒê°€)-ê¸°ë³¸', spec: 'ê¸°ì¡´ ê±´ë¬¼ì—ì„œ ë°°ê´€ ì—°ì¥+ì•ˆì „ê²€ì‚¬+ìŠ¹ì¸', unit: 'ì‹', qty: '1', price: '2000000' },
                {
                    div: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤', name: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤ (ìƒê°€)-ì¤‘ìƒ', spec: 'ê¸°ì¡´ ê±´ë¬¼ì—ì„œ ë°°ê´€ ì—°ì¥+ë³µì¡í•œêµ¬ì¡°+ì•ˆì „ê²€ì‚¬+ìŠ¹ì¸', unit: 'ì‹', qty: '1', price:
                        '3500000'
                },
                {
                    div: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤', name: 'ê°€ìŠ¤ë°°ê´€ ì‹ ì„¤ (ìƒê°€)-ìµœìƒ', spec: 'ê¸°ì¡´ ê±´ë¬¼ì—ì„œ ë°°ê´€ ì—°ì¥+ë³µì¡í•œêµ¬ì¡°+ì•ˆì „ê²€ì‚¬+ìŠ¹ì¸(ë§¤ë¦½-ì¥ë¹„)', unit: 'ì‹', qty: '1', price:
                        '5000000'
                },
                { div: 'ëˆ„ìˆ˜íƒì§€', name: 'ëˆ„ìˆ˜íƒì§€ ìˆ˜ë„ ë°°ê´€', spec: 'ì§‘ ë‚´ë¶€ ìˆ˜ë„ë°°ê´€(ëƒ‰/ì˜¨)', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ëˆ„ìˆ˜íƒì§€', name: 'ëˆ„ìˆ˜íƒì§€ ë‚œë°© ë°°ê´€', spec: 'ì§‘ ë‚´ë¶€ ë‚œë°©ë°°ê´€ ì ê²€', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ëˆ„ìˆ˜íƒì§€', name: 'ëˆ„ìˆ˜íƒì§€ ìˆ˜ë„/ë‚œë°© ë°°ê´€', spec: 'ì§‘ ë‚´ë¶€ ìˆ˜ë„ë°°ê´€(ëƒ‰/ì˜¨) ë° ë‚œë°©ë°°ê´€ ì ê²€', unit: 'ì‹', qty: '1', price: '500000' }
            ],
            '04': [
                { div: 'í™•ì¥', name: 'ê±°ì‹¤ í™•ì¥', spec: 'ì² ê±°+ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì—‘ìƒ (íŠ¹ëŒ€-í†µë°”ë‹¥)', unit: 'ì‹', qty: '1', price: '1100000' },
                { div: 'í™•ì¥', name: 'ê±°ì‹¤ í™•ì¥', spec: 'ì² ê±°+ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì—‘ìƒ (ëŒ€í˜•)', unit: 'ì‹', qty: '1', price: '900000' },
                { div: 'í™•ì¥', name: 'ê±°ì‹¤ í™•ì¥', spec: 'ì² ê±°+ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì—‘ìƒ (ê¸°ë³¸)', unit: 'ì‹', qty: '1', price: '800000' },
                { div: 'í™•ì¥', name: 'ë°©/ì£¼ë°© í™•ì¥', spec: 'ì² ê±°+ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì—‘ìƒ (í†µë°”ë‹¥)', unit: 'ì‹', qty: '1', price: '800000' },
                { div: 'í™•ì¥', name: 'ë°©/ì£¼ë°© í™•ì¥', spec: 'ì² ê±°+ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì—‘ìƒ (ê¸°ë³¸)', unit: 'ì‹', qty: '1', price: '700000' },
                { div: 'í™•ì¥ë‹¨ì—´', name: 'ê±°ì‹¤ í™•ì¥ë¶€ ë‹¨ì—´', spec: 'ë²½ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì²œì¥ë‹¨ì—´(ì˜¨ë„ë¦¬)-ê¸°ë³¸', unit: 'ì‹', qty: '1', price: '1100000' },
                { div: 'í™•ì¥ë‹¨ì—´', name: 'ë°©/ì£¼ë°© í™•ì¥ë¶€ ë‹¨ì—´', spec: 'ë²½ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì²œì¥ë‹¨ì—´(ì˜¨ë„ë¦¬)-ê¸°ë³¸', unit: 'ì‹', qty: '1', price: '900000' },
                { div: 'í™•ì¥ë‹¨ì—´', name: 'ê±°ì‹¤ í™•ì¥ë¶€ ë‹¨ì—´', spec: 'ë²½ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì²œì¥ë‹¨ì—´(ì˜¨ë„ë¦¬)-ëŒ€í˜•(ë‹¨ì—´ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '1500000' },
                { div: 'í™•ì¥ë‹¨ì—´', name: 'ë°©/ì£¼ë°© í™•ì¥ë¶€ ë‹¨ì—´', spec: 'ë²½ë‹¨ì—´(ì•„ì´ì†Œí•‘í¬)+ì²œì¥ë‹¨ì—´(ì˜¨ë„ë¦¬)-ëŒ€í˜•(ë‹¨ì—´ê¸°ì¤€)', unit: 'ì‹', qty: '1', price: '1200000' },
                { div: 'ë‹¨ì—´', name: 'ì•ˆë°© ì™¸ë²½ ë‹¨ì—´', spec: 'ì•„ì´ì†Œí•‘í¬(50t+50t)+ì„ê³ 1p-ê¸°ë³¸', unit: 'ë©´', qty: '1', price: '800000' },
                { div: 'ë‹¨ì—´', name: 'ì•ˆë°© ì™¸ë²½ ë‹¨ì—´', spec: 'ì•„ì´ì†Œí•‘í¬(50t+50t)+ë‹¤ë£¨ë¼+ê¸°ë°€(ë“€í°íˆ¬ìŠµ)_ì„ê³ 2p-ê³ ê¸‰', unit: 'ë©´', qty: '1', price: '1100000' },
                { div: 'ë‹¨ì—´', name: 'ë°© ì™¸ë²½ ë‹¨ì—´', spec: 'ì•„ì´ì†Œí•‘í¬(50t+50t)+ì„ê³ 1p-ê¸°ë³¸', unit: 'ë©´', qty: '1', price: '500000' },
                { div: 'ë‹¨ì—´', name: 'ë°© ì™¸ë²½ ë‹¨ì—´', spec: 'ì•„ì´ì†Œí•‘í¬(50t+50t)+ë‹¤ë£¨ë¼+ê¸°ë°€(ë“€í°íˆ¬ìŠµ)_ì„ê³ 2p-ê³ ê¸‰', unit: 'ë©´', qty: '1', price: '800000' },
                { div: 'ë‹¨ì—´', name: 'í™”ì¥ì‹¤ ë²½ë©´ ë‹¨ì—´', spec: 'ì•„ì´ì†Œí•‘í¬(30t)+ì„ê³ 1p', unit: 'ë©´', qty: '1', price: '300000' }
            ],
            '05': [
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '20í‰ ì´í•˜ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '6000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '21~25í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '8000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '26~30í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '9000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '31~35í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '10000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '36~40í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '13000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '41~45í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '16000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '46~50í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '19000000' },
                { div: 'ì°½í˜¸', name: 'kcc ì°½í˜¸', spec: '51í‰ ì´ìƒ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '22000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '20í‰ ì´í•˜ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '7000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '21~25í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '8000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '26~30í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '11000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '31~35í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '13000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '36~40í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '16000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '41~45í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '19000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '46~50í‰ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '22000000' },
                { div: 'ì°½í˜¸', name: 'LX ì§€ì¸ ì°½í˜¸ ë·°í”„ë ˆì„', spec: '51í‰ ì´ìƒ ì˜ˆìƒê²¬ì ê°€ - ì‹¤ì¸¡ ì™„ë£Œ í›„ ì¬ì•ˆë‚´.', unit: 'ì‹', qty: '1', price: '25000000' },
                { div: 'ë°©ì¶©ë§', name: 'ë¯¸ì„¸ ë°©ì¶©ë§', spec: 'í° ì°½', unit: 'ea', qty: '1', price: '70000' },
                { div: 'ë°©ì¶©ë§', name: 'ë¯¸ì„¸ ë°©ì¶©ë§', spec: 'ì‘ì€ ì°½', unit: 'ea', qty: '1', price: '50000' },
                { div: 'í¬ë¦¬ì„¼íŠ¸', name: 'í¬ë¦¬ì„¼íŠ¸ êµì²´', spec: '', unit: 'ea', qty: '1', price: '10000' },
                { div: 'í´ë”©ë„ì–´', name: 'í´ë”©ë„ì–´(ì§)', spec: '', unit: 'ea', qty: '1', price: '470000' }
            ],
            '06': [
                { div: 'ë°°ì„ ', name: 'ì „ê¸° ë°°ì„  (ê¸°ë³¸)', spec: 'ì „ê¸° ë°°ì„  ë¹„ìš©(2.5SQ-HIV)', unit: 'py', qty: '1', price: '60000' },
                { div: 'ë°°ì„ ', name: 'ë‹¨ë…ë°°ì„ (ì°¨ë‹¨ê¸°í¬í•¨)', spec: 'ì¸ë•ì…˜ (4SQ-HIV)', unit: 'ea', qty: '1', price: '300000' },
                { div: 'ë°°ì„ ', name: 'ë‹¨ë…ë°°ì„ (ì°¨ë‹¨ê¸°í¬í•¨)', spec: 'ì£¼ë°©(ë³´ì¡°ì£¼ë°©, ì •ìˆ˜ê¸° ë“±)-ì°¨ë‹¨ê¸° ê°€êµ¬ë¡œ ìˆ¨ê¹€', unit: 'ea', qty: '1', price: '250000' },
                { div: 'ë°°ì„ ', name: 'ì¼ê´„ì†Œë“±', spec: 'ì¼ê´„ ì†Œë“± í¬í•¨ ê¸°ê³„ì‹(ì „ìì‹ ë³„ë„)', unit: 'ea', qty: '1', price: '300000' },
                { div: 'ë°°ì„ ', name: 'ìŠ¤ìœ„ì¹˜ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ê°€ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ë°°ì„ ', name: '3ë¡œ ìŠ¤ìœ„ì¹˜ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ê°€ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '120000' },
                { div: 'ë°°ì„ ', name: 'ìŠ¤ìœ„ì¹˜ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ì˜¹ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '170000' },
                { div: 'ë°°ì„ ', name: '3ë¡œ ìŠ¤ìœ„ì¹˜ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ì˜¹ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '190000' },
                { div: 'ë°°ì„ ', name: 'ì½˜ì„¼íŠ¸ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ê°€ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '30000' },
                { div: 'ë°°ì„ ', name: 'ì½˜ì„¼íŠ¸ ì¦ì„¤/ì´ì„¤', spec: 'ì‹ ì„¤ ìœ„ì¹˜ê°€ ì˜¹ë²½ì˜ ê²½ìš°', unit: 'ea', qty: '1', price: '70000' },
                { div: 'ë°°ì„ ', name: 'ì½˜ì„¼íŠ¸ ë° ìŠ¤ìœ„ì¹˜ ì¦ì„¤/ì´ì„¤', spec: 'ì¹¨ëŒ€ í—¤ë” ì¢Œ/ìš° ì‹ ì„¤ (ì¼ê´„ì†Œë“± ì•ˆë¨)', unit: 'ea', qty: '1', price: '100000' },
                { div: 'ë¹„ë””ì˜¤í°', name: 'ë¹„ë””ì˜¤ì„  ë°°ì„  ì—°ì¥', spec: '1m ì´ë‚´', unit: 'ì‹', qty: '1', price: '100000' },
                { div: 'ë¹„ë””ì˜¤í°', name: 'ë¹„ë””ì˜¤í° ë°°ì„  ì—°ì¥', spec: '1m ì´ìƒ', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'ì˜¨ë„ì¡°ì ˆê¸°', name: 'ì˜¨ë„ì¡°ì ˆê¸° ë°°ì„  ì¶”ê°€', spec: 'ê°ë°© ì˜¨ë„ ì¡°ì ˆê¸° ë°°ì„  ê°ì‹¤ ê¸°ì¤€ (í­ìŠ¤íƒ€ê³µ ë³„ë„)', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ì°¨ë‹¨ê¸°', name: 'ì°¨ë‹¨ê¸° êµì²´', spec: 'ê¸°ë³¸ 6íšŒë¡œ ì°¨ë‹¨ê¸°ë§Œ êµì²´', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ì°¨ë‹¨ê¸°', name: 'ì°¨ë‹¨ê¸° êµì²´', spec: 'ì°¨ë‹¨ê¸° ì¶”ê°€ (ë²½ë©´ ì² ê±°+ì°¨ë‹¨ê¸° ì¶”ê°€)', unit: 'ì‹', qty: '1', price: '500000' },
                { div: 'í˜„ê´€', name: 'í˜„ê´€ ì¡°ëª…', spec: 'í˜„ê´€ 3ì¸ì¹˜ or 2ì¸ì¹˜ (íˆë“ ì„¼ì„œ+ë„ì›€ ì‹ ë°œì¥ ê°„ì ‘ T5)', unit: 'ì‹', qty: '1', price: '250000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë°©ë“±', spec: 'led ì—£ì§€ë“± (640*640) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '70000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë°©ë“±', spec: 'led ìŠ¤ë§ˆíŠ¸ ì—£ì§€ë“± (640*640) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì£¼ë°©ë“±', spec: 'led ì—£ì§€ë“± (640*220) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '50000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì£¼ë°©ë“±', spec: 'led ìŠ¤ë§ˆíŠ¸ ì—£ì§€ (635*320) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '120000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì£¼ë°©ë“±', spec: 'led ì—£ì§€ë“± (1280*320) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '110000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì£¼ë°©ë“±', spec: 'led ìŠ¤ë§ˆíŠ¸ ì—£ì§€ (1280*320) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '130000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë§¤ì…ë“±', spec: 'í˜¸ë¥¸ 2ì¸ì¹˜ led í™•ì‚° COB(5w) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '17000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë§¤ì…ë“±', spec: 'í˜¸ë¥¸ 3ì¸ì¹˜ led í™•ì‚° COB(8w) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '17000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë§¤ì…ë“±', spec: 'ì›€í‘¹ 2ì¸ì¹˜ led (5w) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '5000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ë§¤ì…ë“±', spec: 'ì›€í‘¹ 3ì¸ì¹˜ led (5w) - ì‹œê³µë¹„ ë³„ë„', unit: 'ea', qty: '1', price: '6000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-íŠ¸ë¦¼ë¦¬ìŠ¤', spec: 'ë ˆì¼ 4m ì´ë‚´ 205ê¸¸ì´ 6ê°œ(ëª©ê³µë³„ë„)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ê°„ì ‘ë“±', spec: 't3 led (27mm)', unit: 'm', qty: '1', price: '7000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ê°„ì ‘ë“±', spec: 't5 led (35mm)', unit: 'm', qty: '1', price: '7500' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ê°„ì ‘ë“±', spec: 'led ë°” - ì£¼ë¬¸ì œì‘', unit: 'ì‹', qty: '1', price: '0' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì§ë¶€ë“±', spec: '8ì¸ì¹˜ led (ì›í˜•/ì‚¬ê°)', unit: 'ea', qty: '1', price: '12000' },
                { div: 'ì¡°ëª…', name: 'ì¡°ëª…-ì„¼ì„œë“±', spec: '8ì¸ì¹˜ led (ì›í˜•/ì‚¬ê°)', unit: 'ea', qty: '1', price: '12000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ê¸°ë³¸í˜•', spec: 'ì œì¼ ë””ì•„íŠ¸ 20í‰ëŒ€', unit: 'ì‹', qty: '1', price: '400000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ê¸°ë³¸í˜•', spec: 'ì œì¼ ë””ì•„íŠ¸ 30í‰ëŒ€', unit: 'ì‹', qty: '1', price: '550000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ê¸°ë³¸í˜•', spec: 'ì œì¼ ë””ì•„íŠ¸ 40í‰ëŒ€', unit: 'ì‹', qty: '1', price: '700000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ë¥´ê·¸ë‘', spec: 'ì•„í…Œì˜¤ 20í‰ëŒ€', unit: 'ì‹', qty: '1', price: '650000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ë¥´ê·¸ë‘', spec: 'ì•„í…Œì˜¤ 30í‰ëŒ€', unit: 'ì‹', qty: '1', price: '850000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ë¥´ê·¸ë‘', spec: 'ì•„í…Œì˜¤ 40í‰ëŒ€', unit: 'ì‹', qty: '1', price: '1000000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ìœ ëŸ½í˜•ìœµ', spec: '20í‰ëŒ€', unit: 'ì‹', qty: '1', price: '800000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ìœ ëŸ½í˜•ìœµ', spec: '30í‰ëŒ€', unit: 'ì‹', qty: '1', price: '1100000' },
                { div: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸ - ìœ ëŸ½í˜•ìœµ', spec: '40í‰ëŒ€', unit: 'ì‹', qty: '1', price: '1600000' },
                { div: 'ê°ì§€ê¸°', name: 'ê°ì§€ê¸°', spec: 'ì°¨ë™ì‹/ì •ì˜¨ì‹', unit: 'ea', qty: '1', price: '5000' },
                { div: 'ì¸ê±´ë¹„', name: 'ì „ê¸° ê¸°ìˆ ì 1í’ˆ', spec: 'ê²½ë¹„/ì‹ëŒ€/ì¥ë¹„ í¬í•¨.', unit: 'ea', qty: '1', price: '400000' },
                { div: 'ì‹¤ë§íŒ¬', name: 'ì‹¤ë§íŒ¬', spec: 'ë³´ê°•ë° ì‹œê³µë¹„ í¬í•¨(ìì¬ ë³„ë„)', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ í™”ì´íŠ¸', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '1880' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ í™”ì´íŠ¸', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '2640' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ í™”ì´íŠ¸', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '3450' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ í™”ì´íŠ¸', spec: '4êµ¬ ìŠ¤ìœ„ì¹˜ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '4240' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ í™”ì´íŠ¸', spec: 'ë°©ë¶ˆ/ë°©ë“± ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '5350' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ ë§ˆê·¸ë„¤í‹±', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3100' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ ë§ˆê·¸ë„¤í‹±', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3740' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ ë§ˆê·¸ë„¤í‹±', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ë¥´ê·¸ë‘ ì•„í‹€ë¼ìŠ¤ ë§ˆê·¸ë„¤í‹±', spec: 'ë°©ë¶ˆ/ë°©ë“± ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4950' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 / LS ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜ (1ëª¨ë“ˆ, í™”ì´íŠ¸/ì•„ì´ë³´ë¦¬)', unit: 'ea', qty: '1', price: '10000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 / LS ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜ (2ëª¨ë“ˆ, í™”ì´íŠ¸/ì•„ì´ë³´ë¦¬)', unit: 'ea', qty: '1', price: '18000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 / LS ì‹œë¦¬ì¦ˆ', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜ (3ëª¨ë“ˆ, í™”ì´íŠ¸/ì•„ì´ë³´ë¦¬)', unit: 'ea', qty: '1', price: '43000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 ì½˜ì„¼íŠ¸ë¥˜', spec: '1êµ¬ ì½˜ì„¼íŠ¸ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '5300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 ì½˜ì„¼íŠ¸ë¥˜', spec: '2êµ¬ ì½˜ì„¼íŠ¸ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '11000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 ì½˜ì„¼íŠ¸ë¥˜', spec: '3êµ¬ ì½˜ì„¼íŠ¸ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '16500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 ì½˜ì„¼íŠ¸ë¥˜', spec: '4êµ¬ ì½˜ì„¼íŠ¸ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '27000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 ì½˜ì„¼íŠ¸ë¥˜', spec: '5êµ¬ ì½˜ì„¼íŠ¸ (ê¸°ë³¸)', unit: 'ea', qty: '1', price: '39000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 í”„ë ˆì„', spec: '1êµ¬ í”„ë ˆì„ (WHITE/BLACK ë“± êµ¬ìˆ˜ë³„)', unit: 'ea', qty: '1', price: '5200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 í”„ë ˆì„', spec: '2êµ¬ í”„ë ˆì„ (WHITE/BLACK ë“± êµ¬ìˆ˜ë³„)', unit: 'ea', qty: '1', price: '11000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 í”„ë ˆì„', spec: '3êµ¬ í”„ë ˆì„ (WHITE/BLACK ë“± êµ¬ìˆ˜ë³„)', unit: 'ea', qty: '1', price: '16000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 í”„ë ˆì„', spec: '4êµ¬ í”„ë ˆì„ (WHITE/BLACK ë“± êµ¬ìˆ˜ë³„)', unit: 'ea', qty: '1', price: '27000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ìœµ LS990 í”„ë ˆì„', spec: '5êµ¬ í”„ë ˆì„ (WHITE/BLACK ë“± êµ¬ìˆ˜ë³„)', unit: 'ea', qty: '1', price: '39000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3100' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4400' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '5400' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '4êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '6800' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '5êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '8200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '4650' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '7450' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: '3êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '10000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'VEKO ë² ì½”ë…¸ ì‹œë¦¬ì¦ˆ', spec: 'TV/í†µí•©', unit: 'ea', qty: '1', price: '8600' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T1 TRIICO', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3100' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T1 TRIICO', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T1 TRIICO', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '5000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T1 TRIICO', spec: '1êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '4000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T1 TRIICO', spec: '2êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '5500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T14 ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T14 ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '5300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T14 ì‹œë¦¬ì¦ˆ', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '6300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T14 ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '4200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'TILINS í‹°ë¦°ìŠ¤ T14 ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '5300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ì§„í¥ì „ê¸° J ì‹œë¦¬ì¦ˆ', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '2000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ì§„í¥ì „ê¸° J ì‹œë¦¬ì¦ˆ', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3100' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ì§„í¥ì „ê¸° J ì‹œë¦¬ì¦ˆ', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ì§„í¥ì „ê¸° J ì‹œë¦¬ì¦ˆ', spec: '4êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '5000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'ì§„í¥ì „ê¸° J ì‹œë¦¬ì¦ˆ', spec: 'TV/ì „í™”/í†µí•©', unit: 'ea', qty: '1', price: '8000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '1êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '2300' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '2êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '3500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '3êµ¬ ìŠ¤ìœ„ì¹˜', unit: 'ea', qty: '1', price: '4700' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '1êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '3600' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '2êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '4900' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸', name: 'NANO ë‚˜ë…¸ì „ê¸° ì˜¤ë€ì„¸ì´/ì•„íŠ¸', spec: '3êµ¬ ì½˜ì„¼íŠ¸', unit: 'ea', qty: '1', price: '6200' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '1êµ¬ (2,000 ~ 4,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '3000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '2êµ¬ (3,000 ~ 5,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '4000' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '3êµ¬ (4,000 ~ 7,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '5500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '4êµ¬ (6,000 ~ 9,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '7500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '5êµ¬ (7,000 ~ 12,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '9500' },
                { div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'êµ­ë‚´ ë¸Œëœë“œ ìŠ¤ìœ„ì¹˜', spec: '6êµ¬ (8,000 ~ 14,000ì›ëŒ€ í‰ê· )', unit: 'ea', qty: '1', price: '11000' },
                {
                    div: 'ê°œë³„ìŠ¤ìœ„ì¹˜ì½˜ì„¼íŠ¸(í‰ê· )', name: 'ë¥´ê·¸ë‘/ìœµ í”„ë¦¬ë¯¸ì—„êµ°', spec: '1êµ¬ ê¸°ì¤€ (8,000 ~ 12,000ì›ë¶€í„° ì‹œì‘)', unit: 'ea', qty: '1', price:
                        '10000'
                }
            ],
            '07': [
                {
                    div: 'ì—˜ì§€ ì—ì–´ì»¨', name: 'LG ì‹œìŠ¤í…œ ì—ì–´ì»¨ 2ëŒ€', spec: 'í”„ë¦¬ë¯¸ì—„ ì¼ë°˜í˜•(ë‹¨ë°°ê´€: 18/6) - ì‹¤ì™¸ë¹„ 3ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '3900000'
                },
                {
                    div: 'ì—˜ì§€ ì—ì–´ì»¨', name: 'LG ì‹œìŠ¤í…œ ì—ì–´ì»¨ 3ëŒ€', spec: 'í”„ë¦¬ë¯¸ì—„ ì¼ë°˜í˜•(ë‹¨ë°°ê´€: 18/6/5) - ì‹¤ì™¸ë¹„ 4ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '5200000'
                },
                {
                    div: 'ì—˜ì§€ ì—ì–´ì»¨', name: 'LG ì‹œìŠ¤í…œ ì—ì–´ì»¨ 4ëŒ€', spec: 'í”„ë¦¬ë¯¸ì—„ ì¼ë°˜í˜•(ë‹¨ë°°ê´€: 18/6/5/5) - ì‹¤ì™¸ë¹„ 4ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '6200000'
                },
                {
                    div: 'ì—˜ì§€ ì—ì–´ì»¨', name: 'LG ì‹œìŠ¤í…œ ì—ì–´ì»¨ 5ëŒ€', spec: 'í”„ë¦¬ë¯¸ì—„ ì¼ë°˜í˜•(ë‹¨ë°°ê´€: 18/6/5/5) - ì‹¤ì™¸ë¹„ 4ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '7800000'
                },
                {
                    div: 'ì—˜ì§€ ì—ì–´ì»¨', name: 'LG ì‹œìŠ¤í…œ ì—ì–´ì»¨ 6ëŒ€', spec: 'í”„ë¦¬ë¯¸ì—„ ì¼ë°˜í˜•(ë‹¨ë°°ê´€: 18/6/5/5/5) - ì‹¤ì™¸ë¹„ 5ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '8900000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 2ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/6) - ì‹¤ì™¸ê¸° 3ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '3400000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 3ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/6/5) - ì‹¤ì™¸ê¸° 4ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1', price:
                        '4500000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 4ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/6/5/5) - ì‹¤ì™¸ê¸° 4ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1',
                    price: '5300000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 5ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/6/5/5) - ì‹¤ì™¸ê¸° 5ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1',
                    price: '6700000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 6ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/8/6/5/5/5) - ì‹¤ì™¸ê¸° 5ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1',
                    price: '7800000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 7ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 10/10/8/6/6/6/6) - ì‹¤ì™¸ê¸° 6ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty:
                        '1', price: '8200000'
                },
                {
                    div: 'ì‚¼ì„± ì—ì–´ì»¨', name: 'SAMSUNG ì—ì–´ì»¨ 7ëŒ€', spec: 'ë¬´í’ ì™€ì´íŒŒì´ ë‚´ì¥í˜•(ë‹¨ë°°ê´€: 18/8/8/6/6/6/6) - ì‹¤ì™¸ê¸° 6ë§ˆë ¥/ëƒ‰ë°©', unit: 'ì‹', qty: '1',
                    price: '8500000'
                },
                { div: 'ê¸°íƒ€ ì¶”ê°€ í•­ëª©', name: 'ì‹¤ì™¸ê¸° ì•µê¸€ (1ë‹¨)', spec: 'ì•Œë£¨ë¯¸ëŠ„ ë°”ë‹¥ìš© 1ë‹¨', unit: 'ì‹', qty: '1', price: '70000' },
                { div: 'ê¸°íƒ€ ì¶”ê°€ í•­ëª©', name: 'ì‹¤ì™¸ê¸° ì•µê¸€ (í–‰ì–´ìš©)', spec: 'ì•Œë£¨ë¯¸ëŠ„ 1050~1150', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'ê¸°íƒ€ ì¶”ê°€ í•­ëª©', name: 'ì‹¤ì™¸ê¸° ë°›ì¹¨ëŒ€', spec: 'ë°œí†µ (ì£¼ê±°ìš©)', unit: 'ì‹', qty: '1', price: '30000' },
                { div: 'ê¸°íƒ€ ì¶”ê°€ í•­ëª©', name: 'ì‹¤ì™¸ê¸° ì—ì–´ê°€ë“œ', spec: 'ë°”ëŒë§‰ì´ (ì•Œë£¨ë¯¸ëŠ„)', unit: 'ì‹', qty: '1', price: '50000' },
                { div: 'ê¸°íƒ€ ì¶”ê°€ í•­ëª©', name: 'ë‹¨ìƒ ì°¨ë‹¨ê¸°', spec: 'ëˆ„ì „ 220V', unit: 'ì‹', qty: '1', price: '50000' }
            ],
            '08': [
                { div: 'ë²½ì²´', name: 'ë²½ë©´ ì„ê³  ì‹œê³µ', spec: 'ë²½ë©´ ì„ê³  ë©´ë§ì¶¤ ë– ë¶™ì„ 1p (h:2400)', unit: 'm', qty: '1', price: '70000' },
                { div: 'ê°€ë²½', name: 'ì£¼ë°© ê°€ë²½ ì‹ ì„¤', spec: 'ë‹¤ë£¨ë¼ ê°€ë²½ (ëƒ‰ì¥ê³ ) - 1mì´ë‚´ ë‘ê»˜60mm', unit: 'ea', qty: '1', price: '150000' },
                { div: 'ê°€ë²½', name: 'ì¤‘ë¬¸ ê°€ë²½ ì‹ ì„¤', spec: 'íˆ¬ë°”ì´ ê°€ë²½ (ì¤‘ë¬¸) - 1mì´ë‚´ ë‘ê»˜90mm - ê³µí‹€', unit: 'ea', qty: '1', price: '350000' },
                { div: 'ê°€ë²½', name: 'ì§ê° ê²Œì´íŠ¸ ê³µí‹€ MD', spec: 'ì¸¡ë©´ MD ë§ˆê°', unit: 'í‹€', qty: '1', price: '100000' },
                { div: 'ê°€ë²½', name: 'ì•„ì¹˜ ê²Œì´íŠ¸ ê³µí‹€ MD', spec: 'ì¸¡ë©´ MD ë§ˆê°', unit: 'í‹€', qty: '1', price: '150000' },
                { div: 'ê°€ë²½', name: 'ê°€ë²½ ì‹ ì„¤', spec: 'ê³µê°„ ë¶„ë¦¬ë¥¼ ìœ„í•œ íˆ¬ë°”ì´ ê°€ë²½ ì‹ ì„¤', unit: 'ì‹', qty: '1', price: '350000' },
                { div: 'ëª°ë”©', name: 'ì²œì¥ ëª°ë”©', spec: 'ê³„ë‹¨ ëª°ë”© (25*15)', unit: 'py', qty: '1', price: '22000' },
                { div: 'ëª°ë”©', name: 'ê±¸ë ˆ ë°›ì´', spec: 'ì§ê° í‰ ëª°ë”© (30mm or 40mm)', unit: 'py', qty: '1', price: '20000' },
                { div: 'ì²œì¥', name: 'ê°€êµ¬ìë¦¬ ìˆ˜í‰ ë§ì¶¤', spec: 'ê°€êµ¬ìë¦¬ ìˆ˜í‰ ë§ì¶¤ (ë¶€ë¶„ ì² ê±° í›„ ë§ì¶¤)', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ í‰ì‹œê³µ', spec: 'ì „ì‹¤/í˜„ê´€ (ê¸°ë³¸), (ëŒ€í˜• ì¶”ê°€ 10ë§Œì›)', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ í‰ì‹œê³µ', spec: 'ì£¼ë°© (ê¸°ë³¸), (ëŒ€í˜• ì¶”ê°€ 10ë§Œì›)', unit: 'ì‹', qty: '1', price: '250000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ í‰ì‹œê³µ', spec: 'ê±°ì‹¤ (ê¸°ë³¸), (ëŒ€í˜• ì¶”ê°€ 10ë§Œì›)', unit: 'ì‹', qty: '1', price: '350000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ ëª°ë”©', spec: '9mm ëª°ë”© ì‹œê³µ', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ ì‹ ì„¤', spec: 'ì •ì‚¬ê°, ì§ì‚¬ê° í˜•íƒœ (ê¸°ë³¸), (ëŒ€í˜• ì¶”ê°€ 10ë§Œì›)', unit: 'ì‹', qty: '1', price: '700000' },
                { div: 'ì²œì¥', name: 'ìš°ë¬¼ ì²œì¥ ì‹ ì„¤', spec: 'ë¼ìš´ë“œ í˜•íƒœ (ê¸°ë³¸), (ëŒ€í˜• ì¶”ê°€ 10ë§Œì›)', unit: 'ì‹', qty: '1', price: '800000' },
                { div: 'ì²œì¥', name: 'ë§¤ë¦½ ë“±ë°•ìŠ¤ ì‹ ì„¤ (ë¼ì¸ì¡°ëª…)', spec: 'ì² ê±°+ì¬ì‹œê³µ (ë¼ì¸ ì¼ì ì¡°ëª…) - ì¡°ëª…ë³„ë„', unit: 'm', qty: '1', price: '70000' },
                { div: 'ì²œì¥', name: 'ë§¤ë¦½ ë“±ë°•ìŠ¤ ì‹ ì„¤ (ë¼ì¸ì¡°ëª…)', spec: 'ì² ê±°+ì¬ì‹œê³µ (ë¼ì¸ ì‚¬ê° ì¡°ëª…) - ì¡°ëª…ë³„ë„', unit: 'ì‹', qty: '1', price: '500000' },
                { div: 'ì²œì¥', name: 'ë³µë„ ì¸¡ë©´ ìƒë¶€ ê°„ì ‘ë“± ë°•ìŠ¤', spec: 'ì² ê±°+ê°„ì ‘ë“±ë°•ìŠ¤ - ì¡°ëª…ë³„ë„', unit: 'm', qty: '1', price: '100000' },
                {
                    div: 'ë²½ì²´', name: 'ë³µë„ ëë²½ ë²½ ê°„ì ‘ë“±', spec: 'ì² ê±°+ê°„ì ‘ë“±ë°•ìŠ¤ (w:1200,h:2400 ê¸°ì¤€) - ì¡°ëª…ë³„ë„', unit: 'ì‹', qty: '1', price: '200000'
                },
                { div: 'ë²½ì²´', name: 'ì•ŒíŒ - í…œë°”ë³´ë“œ', spec: 'í¬ì¸íŠ¸ ë²½ë©´ í…œë°”ë³´ë“œ', unit: 'ì‹', qty: '1', price: '450000' },
                { div: 'ë²½ì²´', name: 'ì½”ë„ˆ ë¼ìš´ë“œ ë²½ì²´', spec: 'ë‚ ê°œë²½ ë˜ëŠ” ì½”ë„ˆ ë²½ë©´ ë¼ìš´ë“œ ì‹œê³µ', unit: 'ì‹', qty: '1', price: '400000' },
                { div: 'ë²½ì²´', name: 'ê±°ì‹¤ TV ë§¤ë¦½í˜• ê°€ë²½', spec: 'TV ê³ ì • ë²½ë©´ í•©íŒ ë³´ê°•', unit: 'ì‹', qty: '1', price: '600000' },
                { div: 'ë²½ì²´', name: 'íˆë“ ë„ì–´ ë²½ë©´ ë§ˆê°', spec: 'íˆë“ ë„ì–´ ì–‘ìª½ ë²½ë©´ ì•ŒíŒ (ì„ê³ +MD)', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'ë²½ì²´', name: 'ë²½ì²´ ë§‰ìŒ (ê¸°ì¡´ ë„ì–´ìë¦¬)', spec: 'ê¸°ì¡´ ë„ì–´ ìë¦¬ ë²½ì²´ ë§ˆê° (ë‚´ë¶€ ë‹¨ì—´ì¬-ë°©ìŒ)', unit: 'ì‹', qty: '1', price: '250000' },
                { div: 'ë²½ì²´', name: 'ì£¼ë°© íƒ€ì¼ ì² ê±°ìë¦¬ ë§ˆê°', spec: 'ê¸°ì¡´ ì£¼ë°©ìë¦¬ íƒ€ì¼ ì² ê±° í›„ ì„ê³  ë§ˆê°', unit: 'ì‹', qty: '1', price: '250000' },
                { div: 'ì•ŒíŒ', name: 'ì•ŒíŒ - ë²½ë©´ MD', spec: 'ë²½ë©´ ì•ŒíŒ (ì„ê³ +MD) (1000*2400)', unit: 'm', qty: '1', price: '90000' },
                { div: 'ì•ŒíŒ', name: 'ì•ŒíŒ - ë²½ë©´ MD', spec: 'ì²œì¥ ì•ŒíŒ (ì„ê³ +MD) (1000*2400)', unit: 'm', qty: '1', price: '120000' },
                { div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° í‰ - í˜„ê´€', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) í‰ë§ˆê°', unit: 'ì‹', qty: '1', price: '600000' },
                {
                    div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° ìš°ë¬¼ - í˜„ê´€', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) ìš°ë¬¼ ë§ˆê° (ê°„ì ‘ì‹œ-ì¡°ëª…ë³„ë„)', unit: 'ì‹', qty: '1',
                    price: '700000'
                },
                { div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° í‰ - ê±°ì‹¤', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) í‰ë§ˆê°', unit: 'ì‹', qty: '1', price: '800000' },
                {
                    div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° ìš°ë¬¼ - ê±°ì‹¤', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) ìš°ë¬¼ ë§ˆê° (ê°„ì ‘ì‹œ-ì¡°ëª…ë³„ë„)', unit: 'ì‹', qty: '1',
                    price: '900000'
                },
                {
                    div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° í‰ - ë°©orì£¼ë°©', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) í‰ë§ˆê°', unit: 'ì‹', qty: '1', price: '700000'
                },
                {
                    div: 'ì²œì¥', name: 'ì² ê±° í›„ ëŒ„ì¡° ë§ˆê° ìš°ë¬¼ - ê±°ì‹¤orì£¼ë°©', spec: 'ì „ì²´ ì² ê±° í›„ ì²œì¥ ë§ˆê° (ë‹¤ë£¨ë¼+ì„ê³ ) ìš°ë¬¼ ë§ˆê° (ê°„ì ‘ì‹œ-ì¡°ëª…ë³„ë„)', unit: 'ì‹', qty: '1',
                    price: '800000'
                },
                {
                    div: 'ì—ì–´ì»¨', name: 'ì‹œìŠ¤í…œ ì—ì–´ì»¨ ì²œì¥ ë‹¨ë‚´ë¦¼', spec: 'ì‹œìŠ¤í…œ ì—ì–´ì»¨ ì„¤ë¹„ì¸µ í™•ë³´ë¥¼ ìœ„í•œ ì²œì¥ ë‹¨ë‚´ë¦¼ (h:190)', unit: 'ì‹', qty: '1', price:
                        '300000'
                },
                {
                    div: 'ì—ì–´ì»¨', name: 'ì‹œìŠ¤í…œ ì—ì–´ì»¨ ì²œì¥ ë§ˆê°', spec: 'ì‹œìŠ¤í…œ ì—ì–´ì»¨ ì„ ë°°ê´€ í›„ ê¸°ê³„ìë¦¬ ë³´ê°• ë° ë°°ê´€ ìë¦¬ íƒ€ê³µë¶€ë¶„ ë§‰ìŒ', unit: 'ì‹', qty: '1', price:
                        '400000'
                },
                { div: 'ë³´ê°•', name: 'í•©íŒ ë³´ê°• ë²½ë©´ - ê±°ìš¸', spec: 'ê±°ìš¸/ì•¡ì ë“± ë²½ë©´ ë³´ê°• (1000*600 ê¸°ì¤€)', unit: 'm', qty: '1', price: '70000' },
                {
                    div: 'ë³´ê°•', name: 'í•©íŒ ë³´ê°• ì²œì • - ê°€êµ¬', spec: 'ì˜·ë´‰ or ìƒë¶€ì¥ or ë„ì›€ ì¥ í•©íŒ ë³´ê°• (1000*600 ê¸°ì¤€)', unit: 'm', qty: '1', price:
                        '90000'
                },
                { div: 'ë„ì–´', name: 'ë„ì–´ ì¬ì‚¬ìš© - í•„ë¦„', spec: 'ë„ì–´ ì¬ì‚¬ìš©+í•„ë¦„ ì‹œê³µì„ ìœ„í•œ ë„ì–´ ëŒ€íŒ¨ ì‘ì—….', unit: 'set', qty: '1', price: '20000' },
                {
                    div: 'ë„ì–´', name: 'ë„ì–´ í•˜ë“œì›¨ì–´ë§Œ êµì²´ì‹œ (ë¬¸ì¬ì‚¬ìš©)', spec: 'ì² ê±°+ê²½ì²©/ëŒí¼í˜• ë„ì–´ìŠ¤í† í¼/ì†ì¡ì´(30,000)', unit: 'set', qty: '1', price: '70000'
                },
                {
                    div: 'ë„ì–´', name: 'ë„ì–´ í•˜ë“œì›¨ì–´ë§Œ êµì²´ì‹œ (ë¬¸ì¬ì‚¬ìš©)', spec: 'ì² ê±°+ê²½ì²©/ìì„í˜• ë„ì–´ìŠ¤í† í¼/ì†ì¡ì´(30,000)', unit: 'set', qty: '1', price: '80000'
                },
                { div: 'ë„ì–´', name: 'ë„ì–´ í•˜ë“œì›¨ì–´ (ì‹ ì„¤)', spec: 'ê²½ì²©/ëŒí¼í˜• ë„ì–´ìŠ¤í† í¼/ì†ì¡ì´(30,000)', unit: 'set', qty: '1', price: '60000' },
                { div: 'ë„ì–´', name: 'ë„ì–´ í•˜ë“œì›¨ì–´ (ì‹ ì„¤)', spec: 'ê²½ì²©/ìì„í˜• ë„ì–´ìŠ¤í† í¼/ì†ì¡ì´(30,000)', unit: 'set', qty: '1', price: '70000' },
                { div: 'ë„ì–´', name: 'ì—¬ë‹«ì´ ë„ì–´', spec: 'ì˜ë¦¼ ABS ì—¬ë‹«ì´ ë„ì–´ (ë¬¸ì§ë§Œ) - ì†ì¡ì´ë³„ë„', unit: 'ea', qty: '1', price: '220000' },
                { div: 'ë„ì–´', name: 'ì—¬ë‹«ì´ ë„ì–´', spec: 'ì˜ë¦¼ ABS ì—¬ë‹«ì´ ë„ì–´ (í‹€/ë¬¸ì§/ê°€ìŠ¤ì¼“) - ì†ì¡ì´ë³„ë„', unit: 'set', qty: '1', price: '400000' },
                { div: 'ë„ì–´', name: 'í¬ì¼“ ë„ì–´', spec: 'ëª©ê³µ+ìŠ¬ë¼ì´ë“œí˜• ë„ì–´ (ì–‘ë€í¼) - ì†ì¡ì´ë³„ë„', unit: 'set', qty: '1', price: '500000' },
                { div: 'ë„ì–´', name: 'ìŠ¤í… ë„ì–´', spec: 'ëª©ê³µ+ABS ì—¬ë‹«ì´ ë„ì–´(ì–´ê¹¨ê°€ê³µ) - ì¸ë°©ì² ê±°/ì†ì¡ì´ë³„ë„', unit: 'set', qty: '1', price: '500000' },
                {
                    div: 'ë„ì–´', name: 'ìŠ¬ë¦¼ ì™€ì´ë“œ ì—¬ë‹«ì´ ë„ì–´', spec: '12mm ë¬¸ì„  ìŠ¬ë¦¼í˜• ì—¬ë‹«ì´ ë„ì–´ (ë²½ë©´ ì„ê³ /ë„ì–´ë‹¤ë¦¬ í•„ë¦„ ë³„ë„)', unit: 'ea', qty: '1', price:
                        '420000'
                },
                { div: 'ë„ì–´', name: 'íˆë“ ë„ì–´', spec: 'ì•Œë£¨ë¯¸ëŠ„ë¬¸í‹€/ABSíˆë“ ë„ì–´/ì†ì¡ì´ (ë²½ë©´ ë§ˆê° ì„ê³ +MD ë³„ë„)', unit: 'ea', qty: '1', price: '950000' },
                { div: 'ë„ì–´', name: 'í”¼ë´‡ë„ì–´ 45T', spec: '180ë„ ì—¬ë‹«ì´ (ë¶€ì†í¬í•¨)', unit: 'ea', qty: '1', price: '1200000' },
                { div: 'í„°ë‹ë„ì–´', name: 'í„°ë‹ë„ì–´', spec: 'LX í„°ë‹ë„ì–´ (ì„¸íƒì‹¤orê±°ì‹¤ë°œì½”ë‹ˆ)', unit: 'ea', qty: '1', price: '800000' },
                { div: 'ì¹¨ëŒ€í—¤ë“œ', name: 'ì¹¨ëŒ€í—¤ë“œ(ì•ŒíŒ)', spec: 'ì¹¨ëŒ€ í—¤ë“œ ì•ŒíŒ (ì„ê³ +MD)', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'ì¹¨ëŒ€í—¤ë“œ', name: 'ì¹¨ëŒ€í—¤ë“œ(ì•ŒíŒ)+ì  ë‹¤ì´(ì•ŒíŒ)', spec: 'ì¹¨ëŒ€í—¤ë“œ ìƒë¶€ ì•ŒíŒ(í¬ì¸íŠ¸)+í•˜ë¶€ì  ë‹¤ì´ ì•ŒíŒ', unit: 'ì‹', qty: '1', price: '500000' },
                {
                    div: 'ì¹¨ëŒ€í—¤ë“œ', name: 'ì¹¨ëŒ€í—¤ë“œ(ì•ŒíŒ)+ì  ë‹¤ì´(ì•ŒíŒ)+ì¡°ëª…', spec: 'ì¹¨ëŒ€í—¤ë“œ ìƒë¶€ ì•ŒíŒ(í¬ì¸íŠ¸)+í•˜ë¶€ì  ë‹¤ì´ ì•ŒíŒ -ì¡°ëª… ë³„ë„', unit: 'ì‹', qty: '1', price:
                        '700000'
                },
                {
                    div: 'ì¹¨ëŒ€í—¤ë“œ', name: 'ì¹¨ëŒ€í—¤ë“œ(ë£¨ë²„)+ì  ë‹¤ì´(ì•ŒíŒ)+ì¡°ëª…', spec: 'ì¹¨ëŒ€í—¤ë“œ ìƒë¶€ ë£¨ë²„(í¬ì¸íŠ¸)+í•˜ë¶€ì  ë‹¤ì´ ì•ŒíŒ -ì¡°ëª… ë³„ë„', unit: 'ì‹', qty: '1', price:
                        '900000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì—¬ë‹«ì´ ëª¨ë˜ì „ì°½', spec: 'ì—¬ë”›ì´ 180ë„ í¸ê°œ ë„ì–´ (ëª¨ë˜) - ë¬¸í‹€ ì—†ìŒ. (1000*2400)', unit: 'ì‹', qty: '1', price:
                        '1500000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì—¬ë‹«ì´ ê°„ì‚´ - ë¹„ëŒ€ì¹­', spec: 'ì—¬ë”›ì´ 180ë„ í¸ê°œ ë„ì–´ (ì „ì²´ê°„ì‚´) - ë¬¸í‹€ ì—†ìŒ. (1100*2400)', unit: 'ì‹', qty: '1',
                    price: '1900000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì—¬ë‹«ì´ ì–‘ê°œ ë¹„ëŒ€ì¹­-ëª¨ë˜', spec: 'ì—¬ë‹«ì´ ë¹„ëŒ€ì¹­ ì–‘ê°œ 180ë„ (ëª¨ë˜) - ë¬¸í‹€ ì—†ìŒ. (1200*2400)', unit: 'ì‹', qty: '1',
                    price: '1400000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì—¬ë‹«ì´ ì–‘ê°œ ë¹„ëŒ€ì¹­-ë°±ìœ ë¦¬', spec: 'ì—¬ë‹«ì´ ë¹„ëŒ€ì¹­ ì–‘ê°œ 180ë„(ì „ì°½ë°±ìœ ë¦¬)-ë¬¸í‹€ ì—†ìŒ.(1300*2400)', unit: 'ì‹', qty: '1',
                    price: '1500000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ìŠ¬ë¼ì´ë“œ(1ë„ì–´)-ë¸Œë¡ ì¦ˆìƒ¤í‹´', spec: 'ìŠ¬ë¼ì´ë„ 1ë„ì–´ (ëª¨ë˜) - ìƒë¶€/í•˜ë¶€ ë§¤ë¦½í˜• ë ˆì¼ (900*2400)', unit: 'ì‹', qty: '1',
                    price: '800000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ìŠ¬ë¼ì´ë“œ (1ë„ì–´)', spec: 'ìŠ¬ë¼ì´ë„ 1ë„ì–´ (ê°„ì‚´6ê°œ) - ìƒë¶€/í•˜ë¶€ ë§¤ë¦½í˜• ë ˆì¼ (1200*2400)', unit: 'ì‹', qty: '1',
                    price: '1600000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ìŠ¬ë¼ì´ë”© (2ë„ì–´)', spec: 'ìŠ¬ë¼ì´ë„ 2ë„ì–´ (ëª¨ë˜) - ìƒë¶€/í•˜ë¶€ ë§¤ë¦½í˜• ë ˆì¼ (1800*2400)', unit: 'ì‹', qty: '1', price:
                        '1400000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ìŠ¬ë¼ì´ë“œ (ê°œë³„ 4ë„ì–´)', spec: 'ìŠ¬ë¼ì´ë“œ 4ë„ì–´ (ê°„ì‚´) - ìƒë¶€/í•˜ë¶€ ë§¤ë¦½í˜• ë ˆì¼ (3000*2200)', unit: 'ì‹', qty: '1',
                    price: '5500000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ 3ì—°ë™ ìŠ¬ë¦¼í˜• (4ë„ì–´)', spec: 'ì•Œë£¨ë¯¸ëŠ„ 3ì—°ë™ 4ë„ì–´ ìŠ¬ë¼ì´ë“œ ë„ì–´ (ëª¨ë˜) (2000*2300)', unit: 'ì‹', qty: '1', price:
                        '1600000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ 3ì—°ë™ ìŠ¬ë¦¼í˜• (3ë„ì–´)', spec: 'ì•Œë£¨ë¯¸ëŠ„ 3ì—°ë™ 4ë„ì–´ ìŠ¬ë¼ì´ë“œ ë„ì–´ (ëª¨ë˜) (2000*2300)', unit: 'ì‹', qty: '1', price:
                        '1100000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì‹ ì„¤ (ë°©í™”ë„ì–´) ì–‘ê°œë„ì–´', spec: 'í˜„ê´€ë¬¸ ë°©í™”ë¬¸ ì‹ ì„¤ ì–‘ê°œ ë„ì–´ (ì² ê±° ë° ë„ì–´ë½ ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '1500000'
                },
                {
                    div: 'í˜„ê´€ë¬¸', name: 'í˜„ê´€ë¬¸ ì‹ ì„¤ (ë°©í™”ë„ì–´) í¸ê°œë„ì–´', spec: 'í˜„ê´€ë¬¸ ë°©í™”ë¬¸ ì‹ ì„¤ ì–‘ê°œ ë„ì–´ (ì² ê±° ë° ë„ì–´ë½ ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '1200000'
                },
                { div: 'ì„ ë°˜', name: 'ë¬´ì§€ì£¼ ì„ ë°˜ ì‹œê³µ', spec: 'D:200 ì´ë‚´ ì„ ë°˜ ì‹œê³µ', unit: 'ì‹', qty: '1', price: '150000' },
                { div: 'í™”ì¥ì‹¤', name: 'í™”ì¥ì‹¤ ì¸¡ë©´ ê°„ì ‘', spec: 'ì„¸ë©´ëŒ€ ìë¦¬ ì¸¡ë©´ ê°„ì ‘ì„ ìœ„í•œ ëª©ê³µ (í•˜ë¶€ ì¡°ì )', unit: 'ì‹', qty: '1', price: '300000' },
                { div: 'í™”ì¥ì‹¤', name: 'í™”ì¥ì‹¤ ë²½ë©´ ê³µê°„ë°•ìŠ¤', spec: 'ì¸¡ë©´ ê³µê°„ ë°•ìŠ¤ ë° ê°„ì ‘', unit: 'ì‹', qty: '1', price: '350000' },
                { div: 'ì•¡ìë ˆì¼', name: 'ì•¡ìë ˆì¼ - ë§¤ë¦½', spec: 'ì² ê±° í›„ ì•¡ìë ˆì¼ ë§¤ë¦½ í•œë©´', unit: 'ì‹', qty: '1', price: '200000' }
            ],
            '09': [
                { div: 'ê¸°ë³¸ (ë‹¨í’ˆ)', name: 'ê¸°ë³¸ ì‹œê³µë¹„ (í˜„ê´€ë¬¸/ê³µí‹€)', spec: 'í˜„ê´€ë¬¸ í‹€/ë¬¸ì§(ë‚´ë¶€ë§Œ), ê³µí‹€1', unit: 'ì‹', qty: '1', price: '500000' },
                {
                    div: 'ê¸°ë³¸ (ë‹¨í’ˆ)', name: 'ê¸°ë³¸ ì‹œê³µë¹„ (ë¶€ë¶„ì‹œê³µ)', spec: 'ë¶€ë¶„ ì‹œê³µì¼ ë•Œ 1í’ˆ(35) - ìì¬ 1m(ì¶”ê°€:2ë§Œì›)', unit: 'ì‹', qty: '1', price:
                        '350000'
                },
                { div: 'ì°½í˜¸ ë‹¨í’ˆ', name: 'ì°½í˜¸ (ê±°ì‹¤) - ë‹¨í’ˆ', spec: '30í‰ëŒ€ ê¸°ì¤€ ê±°ì‹¤ ì°½í˜¸', unit: 'ì‹', qty: '1', price: '1200000' },
                { div: 'ì°½í˜¸ ë‹¨í’ˆ', name: 'ì°½í˜¸ (ê±°ì‹¤) - ë‹¨í’ˆ', spec: '40í‰ëŒ€ ê¸°ì¤€ ê±°ì‹¤ ì°½í˜¸', unit: 'ì‹', qty: '1', price: '1500000' },
                { div: 'ì°½í˜¸ ë‹¨í’ˆ', name: 'ì°½í˜¸ (ëŒ€) - ë‹¨í’ˆ', spec: 'ì´ì¤‘ì°½ ê¸°ì¤€. ë‹¨ì°½ì˜ ê²½ìš° (90)', unit: 'ea', qty: '1', price: '1000000' },
                { div: 'ì°½í˜¸ ë‹¨í’ˆ', name: 'ì°½í˜¸ (ì¤‘) - ë‹¨í’ˆ', spec: 'ì´ì¤‘ì°½ ê¸°ì¤€. ë‹¨ì°½ì˜ ê²½ìš° (80)', unit: 'ea', qty: '1', price: '800000' },
                { div: 'ì°½í˜¸ ë‹¨í’ˆ', name: 'ì°½í˜¸ (ì†Œ) - ë‹¨í’ˆ', spec: 'ì´ì¤‘ì°½ ê¸°ì¤€. ë‹¨ì°½ì˜ ê²½ìš° (50)', unit: 'ea', qty: '1', price: '600000' },
                { div: 'ê°€êµ¬/ìˆ˜ë‚©ì¥', name: 'ë¶™ë°•ì´ì¥/ì‹ ë°œì¥', spec: 'ì™¸ì¸¡(ëˆˆì´ ë³´ì´ëŠ” ê³³) í‹€/ë¬¸ì§', unit: 'ì', qty: '1', price: '100000' },
                { div: 'ê°€êµ¬/ìˆ˜ë‚©ì¥', name: 'í•˜í”„ì¥', spec: 'h: 1200 ì´ë‚´', unit: 'ì', qty: '1', price: '70000' },
                { div: 'ì°½ê³ ì¥', name: 'ì°½ê³ ì¥', spec: 'w: 1200 ì´ë‚´', unit: 'ì‹', qty: '1', price: '200000' },
                { div: 'ë„ì–´', name: 'í˜„ê´€ë¬¸ or ë°©í™”ë¬¸ or í„°ë‹ë„ì–´', spec: 'ë‚´ì¸¡ ê¸°ì¤€', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ë„ì–´', name: 'ë°©í™”ë¬¸ or í„°ë‹ë„ì–´ ì•ë’¤ ì „ì²´', spec: 'ì•ë’¤ ì „ì²´ í•„ë¦„.', unit: 'ea', qty: '1', price: '250000' },
                { div: 'ë„ì–´(set)', name: 'ë¬¸í‹€/ë¬¸ì§ (ê¸°ë³¸)', spec: 'ë¯¼ì ë„ì–´/í‹€ì˜ ê²½ìš°', unit: 'set', qty: '1', price: '280000' },
                {
                    div: 'ë„ì–´(set)', name: 'ë¬¸í‹€/ë¬¸ì§ (ê³¨/í˜ì¸íŠ¸/ë¬´ëŠ¬ëª©)', spec: 'ë¬¸ì§ì— ë¬´ëŠ¬ ë˜ëŠ” ê³¨, ìƒŒë”© ë° í•¸ë””(í˜ì¸íŠ¸/ë¬´ëŠ¬ëª©) í•„ìš”í•œ ê²½ìš°', unit: 'set', qty: '1',
                    price: '310000'
                },
                { div: 'ë„ì–´(ë‹¨í’ˆ)', name: 'ë¬¸í‹€/ë„ì–´ë‹¤ë¦¬/ë¬¸ì„ ', spec: 'ë¬¸í‹€ ì „ì²´ í•´ë‹¹ë¶€ë¶„', unit: 'ea', qty: '1', price: '120000' },
                { div: 'ë„ì–´(ë‹¨í’ˆ)', name: 'ë¬¸ì§ (ë¯¼ìë„ì–´)', spec: 'ë¬¸ì§ ê¸°ë³¸ (ë¯¼ìë„ì–´)', unit: 'ea', qty: '1', price: '170000' },
                { div: 'ë„ì–´(ë‹¨í’ˆ)', name: 'ë¬¸ì§ (ë¬¸ì–‘ë„ì–´)', spec: 'ë¬¸ì§ í•¸ë””ì‘ì—… 2íšŒ', unit: 'ea', qty: '1', price: '200000' },
                { div: 'ê³µí‹€', name: 'ê³µí‹€ ì‚¬ê° ê²Œì´íŠ¸', spec: '9mm or 12mm ê³µí‹€ MD', unit: 'ea', qty: '1', price: '120000' },
                { div: 'ê³µí‹€', name: 'ê³µí‹€ ì•„ì¹˜ ê²Œì´íŠ¸', spec: 'ê³µí‹€ ì•„ì¹˜ ê²Œì´íŠ¸ (í•¸ë”” ì‘ì—… 2íšŒ)', unit: 'ea', qty: '1', price: '150000' },
                {
                    div: 'ë“±ë°•ìŠ¤ ëª°ë”©', name: 'ë“±ë°•ìŠ¤ ëª°ë”©', spec: 'ì‚¬ê°í˜• êµ¬ì¡° ë¼ìš´ë“œ í˜•íƒœ (ëŠê¹€ì—†ì´ 1íšŒì‹œ ì‹œê³µì‹œ ìì¬ë¹„ ì¶”ê°€ 1m 2ë§Œì›)', unit: 'ea', qty: '1', price:
                        '200000'
                },
                { div: 'ì•ŒíŒ', name: 'í˜„ê´€ or ì „ì‹¤ ì•ŒíŒ', spec: '34í‰ ê¸°ì¤€ í˜„ê´€ë¬¸ í¬í•¨, ì‹ ë°œì¥ ë° ì¤‘ë¬¸ ë³„', unit: 'ea', qty: '1', price: '500000' },
                { div: 'ì•ŒíŒ', name: 'ì¹¨ëŒ€ í—¤ë“œ (ë””ìì¸)', spec: 'ì¹¨ëŒ€ í—¤ë“œ ëª©ê³µ ì‘ì—… ì´í›„ í•„ë¦„ì‹œê³µ', unit: 'ì‹', qty: '1', price: '400000' },
                { div: 'ì•ŒíŒ', name: 'ê±°ì‹¤/ì£¼ë°© ì•ŒíŒ', spec: 'ë¯¼ì í˜•íƒœ ì•ŒíŒ MD', unit: 'm', qty: '1', price: '80000' },
                { div: 'ì „ì²´í•„ë¦„(ì°½í˜¸/ë„ì–´)', name: 'ì „ì²´ í•„ë¦„', spec: 'ë°©í™”ë¬¸/ë¬¸í‹€ì§/ì¤‘ë¬¸/ê³µí‹€/ì°½í˜¸', unit: 'py', qty: '1', price: '120000' },
                { div: 'ì „ì²´ ì°½í˜¸ í•„ë¦„', name: 'ì „ì²´ ì°½í˜¸ í•„ë¦„', spec: 'ì „ì²´ ì°½í˜¸ë§Œ ì‹œê³µ', unit: 'py', qty: '1', price: '80000' },
                { div: 'ì „ì²´ ë¬¸í‹€ì§ í•„ë¦„', name: 'ì „ì²´ ë¬¸í‹€ì§ í•„ë¦„', spec: 'ì „ì²´ ë¬¸í‹€ì§ ì‹œê³µ (30í‰ê¸°ì¤€)', unit: 'py', qty: '1', price: '40000' }
            ],
            '10': [
                { div: 'í˜„ê´€', name: 'í˜„ê´€ ë°”ë‹¥ (ë§ë°©)', spec: 'íƒ€ì¼ 600*600 ë§ë°© ê¸°ì¤€ : 34í‰ ì´ë‚´', unit: 'ì‹', qty: '1', price: '350000' },
                {
                    div: 'í˜„ê´€', name: 'í˜„ê´€ ë°”ë‹¥ ì² ê±° í›„ íƒ€ì¼', spec: 'íƒ€ì¼ 600*600 (ì­ˆê¾¸ë¯¸+íƒ€ì¼) : 34í‰ ì´ë‚´ (ì² ê±° ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '400000'
                },
                { div: 'í˜„ê´€/ì „ì‹¤', name: 'í˜„ê´€/ì „ì‹¤ ë°”ë‹¥ (ë§ë°©)', spec: 'íƒ€ì¼ 600*600 ë§ë°© ê¸°ì¤€ : 34í‰ ê¸°ì¤€', unit: 'ì‹', qty: '1', price: '550000' },
                {
                    div: 'í˜„ê´€/ì „ì‹¤', name: 'í˜„ê´€/ì „ì‹¤ ì² ê±° í›„ íƒ€ì¼', spec: 'íƒ€ì¼ 600*600 (ì­ˆê¾¸ë¯¸+íƒ€ì¼) : 34í‰ ê¸°ì¤€ (ì² ê±°/ë°©ìˆ˜ ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '650000'
                },
                { div: 'ì„¸íƒì‹¤', name: 'ì„¸íƒì‹¤ ë°”ë‹¥ (ë§ë°©)', spec: 'íƒ€ì¼ 600*600 ë§ë°© ê¸°ì¤€ : 34í‰ ê¸°ì¤€', unit: 'ì‹', qty: '1', price: '300000' },
                {
                    div: 'ì„¸íƒì‹¤', name: 'ì„¸íƒì‹¤ ë°”ë‹¥ ì² ê±° í›„ ì‹œê³µ', spec: 'íƒ€ì¼ 600*600 (ì­ˆê¾¸ë¯¸+íƒ€ì¼) : 34í‰ ê¸°ì¤€ (ì² ê±°/ë°©ìˆ˜ ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '400000'
                },
                { div: 'ë°œì½”ë‹ˆ', name: 'ë°œì½”ë‹ˆ ë°”ë‹¥ (ë§ë°©)', spec: 'íƒ€ì¼ 600*600 ë§ë°© ê¸°ì¤€ : 34í‰ ê¸°ì¤€', unit: 'ì‹', qty: '1', price: '700000' },
                {
                    div: 'ë°œì½”ë‹ˆ', name: 'ë°œì½”ë‹ˆ ë°”ë‹¥ ì² ê±° í›„ ì‹œê³µ', spec: 'íƒ€ì¼ 600*600 (ì­ˆê¾¸ë¯¸+íƒ€ì¼) : 34í‰ ê¸°ì¤€ (ì² ê±°/ë°©ìˆ˜ ë³„ë„)', unit: 'ì‹', qty: '1', price:
                        '850000'
                },
                {
                    div: 'ê±°ì‹¤/ì£¼ë°©/ë°©', name: 'í¬ì„¸ë¦° íƒ€ì¼ 600*600', spec: 'ê¸°ë³¸ ë°”ë‹¥ ìˆ˜í‰+ìì¬ë¹„+ì‹œê³µë¹„ - 600*600 (ì¤„ëˆˆ ë³„ë„)', unit: 'py', qty: '1', price:
                        '270000'
                },
                {
                    div: 'ê±°ì‹¤/ì£¼ë°©/ë°©', name: 'í¬ì„¸ë¦° íƒ€ì¼ 800*800', spec: 'ê¸°ë³¸ ë°”ë‹¥ ìˆ˜í‰+ìì¬ë¹„+ì‹œê³µë¹„ - 800*800 (ì¤„ëˆˆ ë³„ë„)', unit: 'py', qty: '1', price:
                        '310000'
                },
                {
                    div: 'ê±°ì‹¤/ì£¼ë°©/ë°©', name: 'í´ë¦¬ì‹± íƒ€ì¼ 600*600', spec: 'ê¸°ë³¸ ë°”ë‹¥ ìˆ˜í‰+ìì¬ë¹„+ì‹œê³µë¹„ - 600*600 (ì¤„ëˆˆ ë³„ë„)', unit: 'py', qty: '1', price:
                        '265000'
                },
                {
                    div: 'ê±°ì‹¤/ì£¼ë°©/ë°©', name: 'í´ë¦¬ì‹± íƒ€ì¼ 800*800', spec: 'ê¸°ë³¸ ë°”ë‹¥ ìˆ˜í‰+ìì¬ë¹„+ì‹œê³µë¹„ - 800*800 (ì¤„ëˆˆ ë³„ë„)', unit: 'py', qty: '1', price:
                        '300000'
                }
            ],
            '11': [],
            '12': [
                {
                    div: 'ë„ì¥', name: 'ë¿œì¹  ë„ì¥ ë§ˆê° (ë²½/ì²œì •)', spec: 'ì¤„í¼í‹°+ì˜¬í¼í‹°+2íšŒì¹  (ì‚¼í™” - ì•„ì´ìƒê° 4L ë‹¹ 30í—¤ë²  2.9) - êµ­ì‚°', unit: 'm2', qty: '1',
                    price: '50000'
                },
                {
                    div: 'ë„ì¥', name: 'ë¿œì¹  ë„ì¥ ë§ˆê° (ë²½/ì²œì •)', spec: 'ì¤„í¼í‹°+ì˜¬í¼í‹°+2íšŒì¹  (KCC - ìˆ²ìœ¼ë¡œ 4L ë‹¹ 30í—¤ë²  4.9) - êµ­ì‚°', unit: 'm2', qty: '1',
                    price: '55000'
                },
                {
                    div: 'ë„ì¥', name: 'ë¿œì¹  ë„ì¥ ë§ˆê° (ë²½/ì²œì •)', spec: 'ì¤„í¼í‹°+ì˜¬í¼í‹°+2íšŒì¹  (ë…¸ë£¨ - ì¹œí™˜ê²½ í”„ë¦¬ë¯¸ì—„ íŒ¬í†¤ 5.1) - êµ­ì‚°', unit: 'm2', qty: '1', price:
                        '55000'
                },
                {
                    div: 'ë„ì¥', name: 'ë¿œì¹  ë„ì¥ ë§ˆê° (ë²½/ì²œì •)', spec: 'ì¤„í¼í‹°+ì˜¬í¼í‹°+2íšŒì¹  (ë²¤ìë¯¼ë¬´ì–´ 4L ë‹¹ 30í—¤ë²  12) - ìˆ˜ì…', unit: 'm2', qty: '1', price:
                        '80000'
                },
                {
                    div: 'ë„ì¥', name: 'ë¿œì¹  ë„ì¥ ë§ˆê° (ë²½/ì²œì •)', spec: 'ì¤„í¼í‹°+ì˜¬í¼í‹°+2íšŒì¹  (ë˜ì—ë“œì›Œë“œ 4L ë‹¹ 30í—¤ë²  12) - ìˆ˜ì…', unit: 'm2', qty: '1', price:
                        '80000'
                },
                { div: 'íƒ„ì„±', name: 'ì„¸ë¼ë¯¹ì½”íŠ¸', spec: 'ê¸°ëŠ¥ì„± ë§ˆê° ë„ì¥ (ì „ì‹¤ ë˜ëŠ” í˜„ê´€ ì í•©) ì¹¸ ì¶”ê°€ 12ë§Œì›', unit: 'ì¹¸', qty: '1', price: '300000' },
                { div: 'íƒ„ì„±', name: 'ì›”ë“œí´ë˜ìŠ¤', spec: 'ê²°ë¡œì— ì·¨ì•½í•œ ë¶€ë¶„ (ë°œì½”ë‹ˆì— ì í•©) ì¹¸ ì¶”ê°€ 17ë§Œì›', unit: 'ì¹¸', qty: '1', price: '350000' },
                {
                    div: 'íƒ„ì„±', name: 'ì œë¡œìŠ¤íƒ‘', spec: 'ìŠµë„ ì¡°ì ˆ ë° ìœ ì§€ ëƒ„ìƒˆ ê³µê¸°ì •í™” ê¸°ëŠ¥ (ì„¸íƒìƒì— ì í•©) ì¹¸ ì¶”ê°€ 22ë§Œì›', unit: 'ì¹¸', qty: '1', price: '470000'
                },
                { div: 'ì°¸ê³ ', name: 'ë„ì¥ ì°¸ê³ ì‚¬í•­', spec: 'ë„ì¥ ê¸°ë³¸ í‰ë‹¹ 15ë§Œì›(ìˆ˜ì…ì‚°í˜ì¸íŠ¸ ë³„ë„)', unit: 'py', qty: '1', price: '150000' }
            ],
            '13': [
                {
                    div: 'í•©ì§€ë„ë°°', name: 'í•©ì§€ë„ë°°', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1', price:
                        '100000'
                },
                {
                    div: 'ì‹¤í¬ë„ë°° (ê¸°ë³¸)', name: 'ì‹¤í¬ë„ë°°', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1', price:
                        '120000'
                },
                {
                    div: 'ì‹¤í¬í”„ë¦¬ë¯¸ì—„ (ê³ ê¸‰)', name: 'ì‹¤í¬í”„ë¦¬ë¯¸ì—„', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1',
                    price: '140000'
                },
                { div: 'ë¬´ëª°ë”©', name: 'ë¬´ëª°ë”© ë°‘ì‘ì—…', spec: 'ë¬´ëª°ë”© ë°‘ì‘ì—…', unit: 'ì‹', qty: '1', price: '400000' },
                { div: 'ë¬´ê±¸ë ˆë°›ì´', name: 'ë¬´ê±¸ë ˆë°›ì´ ë°‘ì‘ì—…', spec: 'ë¬´ê±¸ë ˆë°›ì´ ë°‘ì‘ì—…', unit: 'ì‹', qty: '1', price: '400000' },
                {
                    div: 'í•©ì§€(ì¼ë°˜) - ì°¸ê³ ', name: 'ê°œë‚˜ë¦¬ë²½ì§€ (í•©ì§€)', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1',
                    price: '100000'
                },
                {
                    div: 'í•©ì§€(ì¼ë°˜) - ì°¸ê³ ', name: 'ì‹ í™”ë²½ì§€ (í•©ì§€ / ì•„ì´ë¦¬ìŠ¤ / íŒŒì¸í•˜ì„)', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit:
                        'py', qty: '1', price: '100000'
                },
                {
                    div: 'í•©ì§€(ì¼ë°˜) - ì°¸ê³ ', name: 'ì œì¼ë²½ì§€ (í•´í”¼ë°ì´ / ì„¼ìŠ¤)', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py',
                    qty: '1', price: '100000'
                },
                {
                    div: 'í•©ì§€(ì¼ë°˜) - ì°¸ê³ ', name: 'LX Z:IN (íœ˜ì•™ì„¸)', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty:
                        '1', price: '100000'
                },
                {
                    div: 'ì‹¤í¬ (ê¸°ë³¸) - ì°¸ê³ ', name: 'ê°œë‚˜ë¦¬ ë¡œí•˜ìŠ¤+', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1',
                    price: '120000'
                },
                {
                    div: 'ì‹¤í¬ (ê¸°ë³¸) - ì°¸ê³ ', name: 'ì œì¼ ë² ì´ì§í”ŒëŸ¬ìŠ¤', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty: '1',
                    price: '120000'
                },
                {
                    div: 'ì‹¤í¬ (ê¸°ë³¸) - ì°¸ê³ ', name: 'LX Z:IN ë² ìŠ¤ë ', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty:
                        '1', price: '120000'
                },
                {
                    div: 'ì‹¤í¬ (ê³ ê¸‰) - ì°¸ê³ ', name: 'ê°œë‚˜ë¦¬ í”„ë¦¬ë¯¸ì—„ / ì•„íŠ¸ë¶ / ì—ë¹„ë‰´', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit:
                        'py', qty: '1', price: '140000'
                },
                {
                    div: 'ì‹¤í¬ (ê³ ê¸‰) - ì°¸ê³ ', name: 'ì‹ í™” ì—ìƒìŠ¤ / íŒŒì‚¬ë“œ', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty:
                        '1', price: '140000'
                },
                {
                    div: 'ì‹¤í¬ (ê³ ê¸‰) - ì°¸ê³ ', name: 'ì œì¼ ë‚˜ë¬´í”ŒëŸ¬ìŠ¤ / ì œì´í”Œë˜í‹°ë„˜', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py',
                    qty: '1', price: '140000'
                },
                {
                    div: 'ì‹¤í¬ (ê³ ê¸‰) - ì°¸ê³ ', name: 'LX Z:IN ë””ì•„ë§', spec: '(LX Z:IN,ê°œë‚˜ë¦¬,ì‹ í™”,ì œì¼)íƒ 1. ë²½ë²½ì§€/ì²œì¥ì§€ í†µì¼ì‹œ ìì¬ë¹„ ì¶”ê°€.', unit: 'py', qty:
                        '1', price: '140000'
                }
            ],
            '14': [
                { div: 'ì›ëª©ë§ˆë£¨', name: 'ì›ëª©ë§ˆë£¨', spec: '', unit: 'py', qty: '1', price: '280000' },
                { div: 'ê°•ë§ˆë£¨', name: 'ë™í™” í•©íŒë§ˆë£¨', spec: '10T 600*600', unit: 'py', qty: '1', price: '150000' },
                { div: 'ë™í™”', name: 'ë‚˜íˆ¬ìŠ¤ì§„ ê·¸ë€ë° / ì´ëª¨ì…˜ë¸”ë‘(JG2012)', spec: '7T*325*810', unit: 'py', qty: '1', price: '110000' },
                { div: 'ê°•ë§ˆë£¨', name: 'ë…¸ë°” í”Œë¡œ', spec: '', unit: 'py', qty: '1', price: '140000' },
                { div: 'ë…¸ë°°', name: 'ë…¸ë°° ë¸”ë™ë¼ë²¨', spec: '7.5T*165*1200', unit: 'py', qty: '1', price: '120000' },
                { div: 'ë™í™”', name: 'ë¹„ì›€190', spec: '', unit: 'py', qty: '1', price: '260000' },
                { div: 'LX ì§€ì¸ ì—ë””í†¤', name: 'lx ì—ë””í†¤ ìŠ¤í†¤', spec: '5t*450*900 - ì†”í‹°í¬ë¦¼(EDT7725)', unit: 'py', qty: '1', price: '99000' },
                { div: 'ë°ì½”íƒ€ì¼', name: 'LX ì§€ì¸ ë°ì½”íƒ€ì¼', spec: 'LX ì§€ì¸ ë³´íƒ€ë‹‰ ì‚¬ê° 600ê° (3T*600*600)', unit: 'py', qty: '1', price: '45000' },
                { div: 'ì¥íŒ', name: 'ì¥íŒ', spec: '2.2T', unit: 'py', qty: '1', price: '60000' },
                { div: 'ì¥íŒ', name: 'ì¥íŒ', spec: '2.2T', unit: 'py', qty: '1', price: '70000' },
                { div: 'ì¥íŒ', name: 'lx ì»´í¬íŠ¸', spec: '', unit: 'py', qty: '1', price: '150000' }
            ],
            '15': [],
            '16': [
                { div: 'ì‹¤ë¦¬ì½˜', name: 'ì‹¤ë¦¬ì½˜ ë§ˆê°', spec: 'ì•„ë±ìŠ¤ ì‹¤ë¦¬ì½˜ - ìƒ‰ë§ì¶¤ ì‹œê³µ', unit: 'py', qty: '1', price: '13000' },
                { div: 'ë¹¨ë˜ê±´ì¡°ëŒ€', name: 'ë¹¨ë˜ê±´ì¡°ëŒ€ - ìˆ˜ë™', spec: 'ìŠ¤í…Œì¸ë ˆìŠ¤ ë´‰ - ìˆ˜ë™', unit: 'ea', qty: '1', price: '110000' },
                { div: 'ë¹¨ë˜ê±´ì¡°ëŒ€', name: 'ë¹¨ë˜ê±´ì¡°ëŒ€ - ì „ë™', spec: 'ìŠ¤í…Œì¸ë ˆìŠ¤ ë´‰ - ìˆ˜ë™', unit: 'ea', qty: '1', price: '300000' },
                { div: 'ì¤€ê³µì²­ì†Œ', name: 'ì¤€ê³µì²­ì†Œ', spec: '', unit: 'py', qty: '1', price: '20000' }
            ],
            '17': []
        };

        // ê¸°ë³¸ ë©”ëª¨ ë°ì´í„°
        const defaultCostMemos = {
            '01': `1. í–‰ìœ„í—ˆê°€ê°€ í•„ìš”í•œ ê²½ìš°ëŠ” êµ¬ì¡°ë‚˜ ì™¸ê´€, ì„¤ë¹„ ë“±ì— ì˜í–¥ì„ ì£¼ëŠ” ê³µì‚¬ë¥¼ í•  ë•Œ ì§€ìì²´ì— ì‚¬ì „ í—ˆê°€ë¥¼ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.
2. í–‰ìœ„í—ˆê°€ ì¦ëª…ì„œ(í•„ì¦) ë°œê¸‰ì‹œ ë°˜ë“œì‹œ ìŠ¹ì¸ì— ë”°ë¥¸ ì¡°ê±´(ê°‘ì¢… ë°©í™”ë¬¸, ë°©í™”íŒ ë° ë°©í™”ìœ ë¦¬, ê°ì§€ê¸°) ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤.
3. ì…ì£¼ë¯¼ ë™ì˜ì„œë¥¼ ë°›ëŠ” ì´ìœ ëŠ” ê³µì‚¬ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì†ŒìŒÂ·ì§„ë™Â·ë¨¼ì§€Â·ë™ì„  ì œí•œ ë“±ì˜ ë¶ˆí¸ì„ ì‚¬ì „ì— ì•Œë¦¬ê³ , ì£¼ë³€ ê±°ì£¼ìì˜ ê³µì‹ì ì¸ 'ë™ì˜'ë¥¼ ë°›ì•„ ë¶„ìŸì„ ì˜ˆë°©í•˜ê¸° ìœ„í•´ì…ë‹ˆë‹¤.
4. ê³µì‚¬ë¥¼ ìœ„í•´ ì—˜ë¦¬ë² ì´í„° ì´ìš©ë£Œ(ë³´ì¦ê¸ˆ) ë° ì£¼ì°¨ ìš”ê¸ˆì´ ë¶€ë‹´í•©ë‹ˆë‹¤.
5. ê³µì‚¬ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì „ê¸°Â·ìˆ˜ë„ ë“±ì˜ ê³µê³¼ê¸ˆì€ ê³ ê°ì´ ë¶€ë‹´í•©ë‹ˆë‹¤.
6. ì—˜ë¦¬ë² ì´í„° ì´ìš©ì´ ë¶ˆê°€ ë˜ëŠ” ì—†ëŠ” ì„¸ëŒ€ëŠ” ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.
7. ìœ ì§€ ë˜ëŠ” í•­ëª©(ê°€êµ¬, ë°”ë‹¥ì¬ ë“±)ì€ ë³´ì–‘ì´ í•„ìˆ˜ì´ë©° ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.`,
            '02': `1. ì² ê±° ì „ ì¬ì‚¬ìš© í•­ëª©ì— ëŒ€í•˜ì—¬ ì‚¬ì „ì— ë¬¸ì œ(ì‘ë™ì•ˆë¨, ì°í˜, ì˜¤ì—¼ ë“±) ë¶€ë¶„ì´ í•„ìš”í•©ë‹ˆë‹¤.
2. ì² ê±° í•­ëª©ì— ì—†ëŠ” ë¶€ë¶„ì€ ì„ì˜ë¡œ ì² ê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.ì² ê±° ì¶”ê°€ì‹œ ë¹„ìš©ì´ ì‚°ì¶œë˜ì–´ ì¶”ê°€ê¸ˆì´ ë°œìƒë©ë‹ˆë‹¤.
3. êµ¬ì¡°ì²´(ë‚´ë ¥ë²½, ë³´, ê¸°ë‘¥)ëŠ” ì„ì˜ ì² ê±°ê°€ ë¶ˆê°€í•˜ë©°, êµ¬ì¡°ê²€í†  ì—†ì´ ì² ê±° ì‹œ ì•ˆì „ì‚¬ê³  ë° ë²•ì  ì±…ì„ì´ ë°œìƒí•©ë‹ˆë‹¤.
4. ì² ê±° ì‹œ ë°œìƒí•˜ëŠ” íê¸°ë¬¼ì€ ë²•ì  ê¸°ì¤€ì— ë”°ë¼ ë¶„ë¦¬Â·ì²˜ë¦¬í•´ì•¼ í•˜ë©°, íê¸°ë¬¼ ì²˜ë¦¬ ë¹„ìš©ì´ ë³„ë„ë¡œ ë°œìƒí•©ë‹ˆë‹¤.
5. ì¸µê°„ ì†ŒìŒ ë° ì§„ë™ì´ ì‹¬í•œ ì‘ì—…ì€ ê´€ë¦¬ì‚¬ë¬´ì†Œ ì‚¬ì „ì— ê³ ì§€í•˜ë©° ì§€ì • ì‹œê°„ ë‚´ì— ì§„í–‰í•©ë‹ˆë‹¤.`,
            '03': `1. ê¸°ì¡´ ë°°ê´€ ì‚¬ìš©ì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.
2. ë°°ê´€(ì˜¤ìˆ˜, í•˜ìˆ˜, ìˆ˜ë„) ìœ„ì¹˜ ë³€ê²½ ì‹œ êµ¬ë°°ê°€ í™•ë³´ ë˜ì§€ ì•Šìœ¼ë©´ ì‹ ë°œì´ ë¬¸ì— ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. ê¸°ì¡´ ë°°ê´€ ìƒíƒœì— ë”°ë¼ êµì²´ê°€ ê¶Œì¥ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë•Œ ë°˜ë“œì‹œ ê³µì • ì¤‘ê°„ì— ëˆ„ìˆ˜íƒì§€ë¥¼ ì‹¤ì‹œí•©ë‹ˆë‹¤.
4. ë°©ìˆ˜ëŠ” ë°”ë‹¥ë¿ ì•„ë‹ˆë¼ ë²½ì²´ ì¼ì • ë†’ì´(H: 1100ì´ìƒ)ê¹Œì§€ ì‹œê³µí•´ì•¼ í•˜ë©°, 3ì°¨ ë°©ìˆ˜ê¹Œì§€ ê¶Œì¥ ë“œë¦½ë‹ˆë‹¤.
5. ë°©ìˆ˜ í›„ ì¶©ë¶„í•œ ì–‘ìƒ ê¸°ê°„(ìµœì†Œ 24~48ì‹œê°„)ì„ í™•ë³´ í›„ íƒ€ì¼ ì‹œê³µì„ ì§„í–‰ í•©ë‹ˆë‹¤.
6. ì™¸ë²½ì´ ë§ë‹¿ëŠ” ë¶€ë¶„ì— ìˆ˜ë„ ë°°ê´€ ì‹ ì„¤ ì‹œ ë™íŒŒ ë°©ì§€ ë° ë‹¨ì—´ ì²˜ë¦¬ê°€ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.
7. ê°€ìŠ¤ ì² ê±° ë° ì‹ ì„¤ì€ ë©´í—ˆ ë³´ìœ ìê°€ ì§„í–‰ í•´ì•¼ í•©ë‹ˆë‹¤.`,
            '04': `1. ë°œì½”ë‹ˆ í™•ì¥ì€ í–‰ìœ„í—ˆê°€ ëŒ€ìƒì´ë©°, í—ˆê°€ ì¡°ê±´(ë°©í™”ë¬¸, ë‹¨ì—´ ê¸°ì¤€ ë“±)ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤.
2. í™•ì¥ ì‹œ ì™¸ë¶€ ë…¸ì¶œë©´ì— ëŒ€í•œ ë‹¨ì—´ ì‹œê³µì´ í•„ìˆ˜ì´ë©°, ë¯¸í¡ ì‹œ ê²°ë¡œÂ·ê³°íŒ¡ì´ ë°œìƒì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.
3. ë‹¨ì—´ì¬ ì¢…ë¥˜ ë° ë‘ê»˜ì— ë”°ë¼ ì‹œê³µë¹„ê°€ ë‹¬ë¼ì§€ë©°, ì—ë„ˆì§€ íš¨ìœ¨ê³¼ ì§ê²°ë©ë‹ˆë‹¤.
4. ë‹¨ì—´ì€ ê²©ì ë°©ì‹ìœ¼ë¡œ ì—´êµí˜„ìƒì„ ìµœì†Œí™” í•˜ë©° ì´ìŒë¶€ìœ„ëŠ” ë°˜ë“œì‹œ í…Œì´í•‘ ì²˜ë¦¬ë¡œ ë§ˆê°í•©ë‹ˆë‹¤.`,
            '05': `1. ì°½í˜¸ êµì²´ëŠ” ì™¸ê´€ ë³€ê²½ì— í•´ë‹¹í•˜ì—¬ ì•„íŒŒíŠ¸ì˜ ê²½ìš° ê´€ë¦¬ê·œì•½ í™•ì¸ ë° ë™ì˜ ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. ê¸°ì¡´ ì°½í˜¸ ê·œê²©ê³¼ ì‹ ê·œ ì°½í˜¸ ê·œê²©ì´ ë‹¤ë¥¼ ê²½ìš° ì¶”ê°€ ë§ˆê° ê³µì‚¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
3. ì°½í˜¸ ì œì‘ ê¸°ê°„(2~3ì£¼)ì„ ê³µì •ì— ë°˜ì˜í•´ì•¼ í•˜ë©°, í˜„ì¥ ì‹¤ì¸¡ í›„ ì œì‘ ì§„í–‰í•©ë‹ˆë‹¤.
4. í•˜ì ë°œìƒ ì‹œ ê° ì œì¡°ì‚¬ A / S ê¸°ì¤€ì´ ì ìš©ë©ë‹ˆë‹¤.
5. ëª¨ë“  ì°½í˜¸ ì‹œê³µì€ ì‹œë°©ì„œì— ì¤€í•˜ì—¬ ì‹œê³µë©ë‹ˆë‹¤.`,
            '06': `1. ë¶„ì „ë°˜ ìš©ëŸ‰ ë° ì°¨ë‹¨ê¸° êµ¬ì„±ì„ í™•ì¸í•˜ê³ , í•„ìš”ì‹œ ì¦ì„¤ ë˜ëŠ” êµì²´ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
2. ì „ì„  ê·œê²©ì€ ì‚¬ìš© ìš©ëŸ‰ì— ë§ê²Œ ì„ ì •í•˜ë©° ë…¸í›„ ì „ì„ ì€ í™”ì¬ ìœ„í—˜ì´ ìˆì–´ êµì²´ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
3. ì¡°ëª… ìœ„ì¹˜ ë³€ê²½ ë° ì¶”ê°€ ì‹œ ì²œì¥ êµ¬ì¡°(ì½˜í¬ë¦¬íŠ¸ / ì„ê³ ë³´ë“œ)ì— ë”°ë¼ ì‹œê³µ ë°©ë²•ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
4. ë§¤ë¦½ ì½˜ì„¼íŠ¸ ë° ìŠ¤ìœ„ì¹˜ ìœ„ì¹˜ëŠ” ë„ë©´ í™•ì • í›„ ë³€ê²½ì´ ì–´ë ¤ìš°ë¯€ë¡œ ì‚¬ì „ í™•ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
5. ìš•ì‹¤ ë“± ìŠµê¸° ë…¸ì¶œ ê³µê°„ì€ ë°©ìˆ˜í˜• ì½˜ì„¼íŠ¸ ë° ì ‘ì§€ ì‹œê³µì„ í•„ìˆ˜ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.`,
            '07': `1. ì‹œìŠ¤í…œ ì—ì–´ì»¨ ì„¤ì¹˜ ì‹œ ì²œì¥ ë‚´ë¶€ ê³µê°„ í™•ë³´ ì—¬ë¶€ë¥¼ ì‚¬ì „ì— í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
2. ë°°ê´€ ê²½ë¡œì— ë”°ë¼ ì—ì–´ì»¨ ë‹¨ë‚´ë¦¼ ë˜ëŠ” ë°°ê´€ ê¸¸(ì²œì¥ ë°•ìŠ¤ ë° ëª°ë”©)ì˜ ì‹œê³µì— ë”°ë¥¸ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. ë°°ê´€ ì‹œê³µì— ë”°ë¥¸ ì² ê±° í›„ ë§ˆê° ë° ì—ì–´ì»¨ ìë¦¬ ë³´ê°•ì— ë”°ë¥¸ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. ì‹¤ì™¸ê¸° ì„¤ì¹˜ ìœ„ì¹˜ëŠ” ì•„íŒŒíŠ¸ ê´€ë¦¬ê·œì•½ ë° êµ¬ì¡°ì  ì œì•½ì„ í™•ì¸ í›„ ì‹œê³µ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
5. ì‹¤ì™¸ê¸°ì‹¤ ì‹ ì„¤ì‹œ ë³„ë„ ë¹„ìš©ì´ ì¶”ê°€ ë©ë‹ˆë‹¤.(ë£¨ë²„ì°½, ì¹¸ë§‰ì´: ë‹¨ì—´ - ì°¨ìŒ)
            6. ì „ê¸° ìš©ëŸ‰ í™•ì¸ í›„ ì „ìš© íšŒë¡œ ë°°ì„ ì´ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë©° ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒ ë©ë‹ˆë‹¤.
7. ì—ì–´ì»¨ ì‹œê³µì‹œ ë°°ê´€ì€ ë°˜ë“œì‹œ ì •í’ˆì„ ì‚¬ìš©í•©ë‹ˆë‹¤.`,
            '08': `1. ì²œì¥ ë° ë²½ì²´ ëª©ê³µ ì‘ì—…ì€ í›„ì† ê³µì •(ì „ê¸°, ë‹¨ì—´, ë„ì¥)ê³¼ ì—°ê³„ë˜ë¯€ë¡œ ì •í™•í•œ ìˆœì„œ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.
2. ë„ì–´ ì¢…ë¥˜ì— ë”°ë¼ ì œì‘ ê¸°ê°„ê³¼ ë¹„ìš©ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
3. ë„ì–´ ë°©í–¥(ì—´ë¦¼ / ë‹«í˜, ì¢Œ / ìš°) ë° ì†ì¡ì´ ìœ„ì¹˜ëŠ” ì‹œê³µ ì „ í™•ì •í•˜ë©° ë„ë©´ ê¸°ì¤€ìœ¼ë¡œ ì‹œê³µí•©ë‹ˆë‹¤.
4. ìˆ˜ì¶•, ë’¤í‹€ë¦¼, ê°ˆë¼ì§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ëª©ìì¬ëŠ” í•¨ìˆ˜ìœ¨ 8~12 % ê¸°ì¤€ì˜ ìì¬ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
5. í˜„ì¥ ì œì‘ ê°€êµ¬ì˜ ê²½ìš° í•©íŒ ë° ë§ˆê°ì¬ ì¢…ë¥˜ì— ë”°ë¼ í’ˆì§ˆ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
6. ëª©ìì¬ëŠ” ì ˆëŒ€ ì¬ì‚¬ìš©í’ˆì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
            '09': `1. ê¸°ì¡´ ê°€êµ¬ë‚˜ ë„ì–´ì— í•„ë¦„ ì‹œê³µ ì‹œ í‘œë©´ ìƒíƒœ(ë“¤ëœ¸, ì†ìƒ)ì— ë”°ë¼ ê²°ê³¼ë¬¼ í’ˆì§ˆì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
2. í‘œë©´ ìƒíƒœê°€ ì¢‹ì§€ ì•Šìœ¼ë©´ í•„ë¦„ ì‹œê³µì´ ë¶ˆê°€í•©ë‹ˆë‹¤.
3. í•„ë¦„ ì¢…ë¥˜(ë¬´ê´‘, ìœ ê´‘, ìš°ë“œ, ë©”íƒˆ ë“±)ì— ë”°ë¼ ë‚´êµ¬ì„± ë° ë‹¨ê°€ê°€ ìƒì´í•©ë‹ˆë‹¤.
4. ëª¨ì„œë¦¬, ê³¡ë©´, ëª¨ì–‘ ë¶€ìœ„ëŠ” ì‹œê°„ ê²½ê³¼ì— ë”°ë¼ ë“¤ëœ¸ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
5. ë„ì–´ì˜ ê²½ìš° ë¬¸ì–‘ ë¶€ë¶„ì„ ì—†ì• ê³  ë¯¼ìëª¨ì–‘ì„ ë§Œë“¤ê¸° ìœ„í•´ í•¸ë””ì‘ì—…ì€ í•„ìˆ˜ì´ë©° ì‚¬ìš©ìì˜ í™˜ê²½ì— ë”°ë¼ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
6. ê¸°ì¡´ í•„ë¦„ ìë¦¬ê°€ í˜ì¸íŠ¸ë‚˜ ë¬´ëŠ¬ëª©ì˜ ê²½ìš° ë°‘ì‘ì—… ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.
7. ìƒì—…ê³µê°„ì˜ ê²½ìš° ë°˜ë“œì‹œ ë°©í™”í•„ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.`,
            '10': `1. íƒ€ì¼ ê·œê²© ë° íŒ¨í„´ì— ë”°ë¼ ì‹œê³µ ë‚œì´ë„ì™€ ë¹„ìš©ì´ ë‹¬ë¼ì§€ë©°, ëŒ€í˜• íƒ€ì¼ì€ í• ì¦ì´ ì ìš©ë©ë‹ˆë‹¤.
2. ë°”ë‹¥ íƒ€ì¼ ì‹œê³µ ì‹œ êµ¬ë°° ë°©í–¥ì„ í™•ì¸í•˜ê³ , ë°°ìˆ˜êµ¬ ë°©í–¥ìœ¼ë¡œ ë¬¼ íë¦„ì´ ì›í™œí•˜ë„ë¡ ì‹œê³µí•©ë‹ˆë‹¤.
3. ì¤„ëˆˆ ìƒ‰ìƒ íƒ€ì¼ê³¼ í•¨ê»˜ ì„ ì •í•˜ë©° ì‹œë©˜íŠ¸ ì¤„ëˆˆì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ë©° ë°±í™”í˜„ìƒì€ ìì—°ìŠ¤ëŸ¬ìš´ í˜„ìƒì…ë‹ˆë‹¤.
4. ìš°ë ˆíƒ„ ë˜ëŠ” ì¼€ë¼í­ì‹œ ì¤„ëˆˆì€ ë³„ë„ ë¹„ìš©ì´ ë°œìƒë©ë‹ˆë‹¤.
5. ë²½íƒ€ì¼ê³¼ ë°”ë‹¥íƒ€ì¼ ì ‘í•©ë¶€, ì½”ë„ˆ ë°©ì‹(ã„±ì, ëª°ë”© ë“±) ë˜ëŠ” ì¡¸ë¦¬ì»· ë°©ì‹ ì¤‘ ë§ˆê°ì„ ì‚¬ì „ì— ê²°ì • í›„ ì§„í–‰í•©ë‹ˆë‹¤.
6. ëª¨ë“  íƒ€ì¼ì€ í¬ê¸°ê°€ ê· ì¼í•˜ì§€ ì•Šê³  ë¶ˆê· í˜•í•˜ë©° ì˜¤ì°¨ë²”ìœ„ì— ë”°ë¥¸ ë¶ˆëŸ‰ ìì¬ê°€ ì•„ë‹™ë‹ˆë‹¤.`,
            '11': '',
            '12': `1. ë„ì¥ ì „ í•˜ì§€ ì²˜ë¦¬(í¼í‹°, ìƒŒë”©)ê°€ í’ˆì§ˆì„ ì¢Œìš°í•˜ë©°, í¬ë™ ë° ìš”ì²  ë¶€ìœ„ëŠ” ë³´ìˆ˜ í›„ ì§„í–‰í•©ë‹ˆë‹¤.
2. ë„ì¥ íšŸìˆ˜(ì´ˆë²Œ, ì¤‘ë²Œ, ì •ë²Œ)ì— ë”°ë¼ ë§ˆê° í’ˆì§ˆì´ ë‹¬ë¼ì§€ë©°, ìµœì†Œ 2íšŒ ì´ìƒ ì§„í–‰í•©ë‹ˆë‹¤.
3. í˜ì¸íŠ¸ ì¢…ë¥˜(ìˆ˜ì„±, ìœ ì„±, ì¹œí™˜ê²½)ì— ë”°ë¼ ê±´ì¡° ì‹œê°„, ëƒ„ìƒˆ, ë‚´êµ¬ì„±ì´ ìƒì´í•©ë‹ˆë‹¤.
4. ë„ì¥ ì‘ì—… ì¤‘ì—ëŠ” í™˜ê¸°ë¥¼ ì¶©ë¶„íˆ í•˜ê³ , íƒ€ ê³µì • ì‘ì—…ì ë° ê³ ê°ì˜ ì¶œì…ì„ ì œí•œí•©ë‹ˆë‹¤.
5. ì²œì¥, ë²½ì²´ ë“± ì í•©í•œ ë„ë£Œë¥¼ ì„ ì • í•˜ë©°, ìƒ‰ìƒì€ ìƒ˜í”Œ í™•ì¸ í›„ ê²°ì • í›„ ë„ë©´ì— í‘œê¸°í•©ë‹ˆë‹¤.`,
            '13': `1. ë„ë°° ì „ ë²½ë©´ ìƒíƒœ(ê³°íŒ¡ì´, í¬ë™, ìŠµê¸°)ë¥¼ í™•ì¸í•˜ê³ , í•„ìš”ì‹œ ë³´ìˆ˜ ê³°íŒ¡ì´ ì œê±°ì œë¥¼ ì‹¤í–‰í•˜ë©° ìƒí™©ì— ë”°ë¼ ì¶”ê°€ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. ë²½ì§€ ì¢…ë¥˜(ì‹¤í¬, í•©ì§€, ì²œì—°)ì— ë”°ë¼ ì‹œê³µ ë°©ë²• ë° ë‹¨ê°€ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
3. ë„ë°° í›„ 24~48ì‹œê°„ í™˜ê¸°ë¥¼ ìì œí•˜ê³  ê¸‰ê²©í•œ ì˜¨ë„ ë³€í™”ë¥¼ í”¼í•´ì•¼ ë²½ì§€ ë“¤ëœ¸ì„ ë°©ì§€í•©ë‹ˆë‹¤.ê³ ê°ë‹˜ í˜„ì¥ë°©ë¬¸ì„ ìì œ ë°”ëë‹ˆë‹¤.
4. ê³°íŒ¡ì´ ì´ë ¥ì´ ìˆëŠ” ë²½ë©´ì€ ë‹¨ìˆœ ë„ë°°ë¡œ í•´ê²°ë˜ì§€ ì•Šìœ¼ë©°, ì›ì¸(ê²°ë¡œ, ëˆ„ìˆ˜) í•´ê²°(ë‹¨ì—´)ì´ ì„ í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
5. ì—ì–´ì»¨, ì¡°ëª… ì„¤ì¹˜ ë¶€ìœ„ëŠ” ë„ë°° ì „ í™•ì •í•˜ì—¬ ë§ˆê° ì†ìƒì„ ë°©ì§€í•©ë‹ˆë‹¤.`,
            '14': `1. ë°”ë‹¥ì¬ ì¢…ë¥˜(ê°•ë§ˆë£¨, ê°•í™”ë§ˆë£¨, ì˜¨ëŒë§ˆë£¨, ë°ì½”íƒ€ì¼, ì¥íŒ ë“±)ì— ë”°ë¼ ì‹œê³µ ë°©ë²•ê³¼ í•˜ì§€ ì¡°ê±´ì´ ë‹¤ë¦…ë‹ˆë‹¤.
2. ê¸°ì¡´ ë°”ë‹¥ì¬ ìœ„ ë§ë°© ì‹œê³µì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.ì´ëŠ” ë ˆë²¨ ìƒìŠ¹ ë° ë¬¸í„± ê°„ì„­ ë˜ëŠ” í•˜ìë¥¼ ìœ ë°œì‹œí‚µë‹ˆë‹¤.
3. ë°”ë‹¥ì¬ ì‹œê³µ ì „ ë°”ë‹¥ ë ˆë²¨(í‰í™œë„)ì„ í™•ì¸í•˜ê³ , ë¶ˆëŸ‰ ì‹œ ì…€í”„ ë ˆë²¨ë§ ì‘ì—…ì„ ì§„í–‰í•´ì•¼í•˜ë©° ì´ë•Œ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. ê³µìš©ë¶€ ë°”ë‹¥ì´ë‘ ë‚´ë¶€ ë°© ë°”ë‹¥ ë ˆë²¨ ë†’ì´ê°€ ë‹¤ë¥¼ ê²½ìš° ìƒŒë”©ì‘ì—…ìœ¼ë¡œ ë©´ ë§ì¶¤ìœ¼ë¡œ ì§„í–‰í•˜ë©° ì´ë•Œ ì¶”ê°€ê¸ˆ ì´ë°œìƒ ë©ë‹ˆë‹¤.
5. ë°ì½”íƒ€ì¼ ë° ì¥íŒ ì‹œê³µì˜ ê²½ìš° ë¬´ê±°ìš´ ë¬¼ê±´ì— ì˜í•œ ëˆŒë¦¼ ìêµ­ ë° ì°í˜ìœ¼ë¡œ ê°€êµ¬ê³µì‚¬ ì´í›„ì— ì§„í–‰ í•©ë‹ˆë‹¤.`,
            '15': `1. ì œì‘ ê°€êµ¬ì™€ ì‹œìŠ¤í…œ ê°€êµ¬ì˜ íŠ¹ì„±ì„ ì´í•´í•˜ê³ , ê³µê°„ ë° ì˜ˆì‚°ì— ë§ê²Œ ì„ íƒ ì§„í–‰í•©ë‹ˆë‹¤.
2. ê°€êµ¬ ì œì‘ ê¸°ê°„ì€ ë³´í†µ 1~2ì£¼ ì œì‘ ê¸°ê°„ì´ í•„ìš”í•˜ë©°, ë¬´ëŠ¬ëª© ë˜ëŠ” ë„ì¥ì˜ ê²½ìš° 2~4ì£¼ ê³µì •ì— ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
3. ê°€êµ¬ë„ë©´ì´ ì™„ì„±ë˜ê³  ì‹¤ì¸¡ì´í›„ ì œì‘ì´ ì‹¤í–‰ë˜ë©´ ë„ë©´ ë³€ê²½ì´ ë¶ˆê°€í•˜ë©´ ê³ ê°ë‹˜ ìš”ì²­ì— ì˜í•œ ë³€ê²½ì€ ì¶”ê°€ê¸ˆì´ ë°œìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. ë¶™ë°•ì´ì¥, ì‹ ë°œì¥ ë“± ì„¤ì¹˜ ì‹œ ë²½ì²´ ë³´ê°• ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , í•„ìš”ì‹œ í•©íŒ ë³´ê°•ì— ë”°ë¥¸ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
5. ê°€êµ¬ ë„ì–´ ì¢…ë¥˜(ì—¬ë‹«ì´, ìŠ¬ë¼ì´ë”©)ì— ë”°ë¼ ë ˆì¼ ë° ì†ì¡ì´ ë“± ë¶€ìì¬ê°€ ì¢…ë¥˜ ë‹¬ë¼ì§€ë©° ë¶€ìì¬ ë¸Œëœë“œì— ë”°ë¼ ë¹„ìš©ì´ ë³€ê²½ë©ë‹ˆë‹¤.
6. ì£¼ë°© ê°€êµ¬ëŠ” ê°€ì „ ê·œê²©(ëƒ‰ì¥ê³ , ë¹ŒíŠ¸ì¸ ê¸°ê¸°)ê³¼ ì„¤ë¹„ ìœ„ì¹˜ë¥¼ ì‚¬ì „(ê³µì‚¬ ì´ì „)ì— í™•ì •í•´ì•¼ ê³µì‚¬ê°€ ì›í™œí•˜ë©° ë¬¸ì œ ë°œìƒì„ ì°¨ë‹¨ë©ë‹ˆë‹¤.`,
            '16': `1. ì¸í„°í°, ì†ì¡ì´, í˜„ê´€ ì¤‘ë¬¸, ë°œì½”ë‹ˆ ë¹¨ë˜ê±´ì¡°ëŒ€ ë“± ë¶€ìì¬ ì„¤ì¹˜ëŠ” ìµœì¢… ë§ˆê° ë‹¨ê³„ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.
2. ì „ì²´ ê³µê°„ ì²­ì†Œ(ì…ì£¼ ì²­ì†Œ)ëŠ” ê³µì‚¬ ì™„ë£Œ í›„ ì§„í–‰í•˜ë©°, ë³„ë„ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.
3. ì‹¤ë¦¬ì½˜ ë§ˆê° ë¶€ìœ„(ìš•ì‹¤, ì£¼ë°©, ì°½í˜¸ ì£¼ë³€)ëŠ” ì²­ì†Œ ì´í›„ ì‹œí–‰ë˜ë©° ì™„ì „íˆ ê²½í™”ê°€ ì™„ë£Œëœ ì´í›„ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
4. í•˜ì ì ê²€ì€ ì…ì£¼ ì „ ì‹œí–‰í•˜ë©°, ë°œê²¬ëœ í•˜ìëŠ” ë³´ìˆ˜ ì™„ë£Œ í›„ ì¸ìˆ˜ì¸ê³„ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.`,
            '17': `1. ê³µì‚¬ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì¶”ê°€ ê³µì‚¬(ë°°ê´€ ëˆ„ìˆ˜ ë°œê²¬, ë§ˆê°ì¬ ì†ìƒ ë“±)ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©°, ë³„ë„ í˜‘ì˜ í›„ ì§„í–‰í•©ë‹ˆë‹¤.
2. ê³ ê° ìš”ì²­ì— ì˜í•œ ì„¤ê³„ ë³€ê²½ì€ ê³µì • ì§€ì—° ë° ì¶”ê°€ ë¹„ìš©ì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.
3. ê³ ê°ë‹˜ ë³„ë„ ê³µì‚¬ë¡œ ì¸í•˜ì—¬ ì”ì¬ë¬¼ ì²˜ë¦¬ ë° íê¸°ë¬¼ ë°œìƒì‹œ ë°˜ì¶œì— ë”°ë¥¸ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.
4. ê³µì‚¬ ì™„ë£Œ í›„ í•˜ì ë³´ìˆ˜ ê¸°ê°„ ë° ë²”ìœ„ëŠ” ê³„ì•½ì„œì— ëª…ì‹œëœ ì¡°ê±´ì— ë”°ë¦…ë‹ˆë‹¤.
5. A / S ì ‘ìˆ˜ ë° ì²˜ë¦¬ ì ˆì°¨ëŠ” ê³„ì•½ ì‹œ ì•ˆë‚´ë“œë¦¬ë©°, í•˜ìì™€ ì‚¬ìš©ì ê³¼ì‹¤ì„ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤.`
        };

        const statusLabels = {
            consulting: 'ìƒë‹´ì¤‘',
            estimate: 'ê²¬ì ì„œ',
            hold: 'ë³´ë¥˜(ê³ ë¯¼ì¤‘)',
            budget_over: 'ì˜ˆì‚°ì´ˆê³¼(ë¯¸ê³„ì•½)',
            other_company: 'íƒ€ì—…ì²´ì„ ì •(ë¯¸ê³„ì•½)',
            contracted: 'ê³„ì•½ì™„ë£Œ',
            in_progress: 'ê³µì‚¬ì¤‘',
            completed: 'ê³µì‚¬ì™„ë£Œ',
            as_done: 'A/S'
        };

        let customers = []; // Phase 2: ë‹¨ì¼ Source of Truth (Google Sheets) ê¸°ì¤€
        let globalCostData = {}; // Phase 2: ì›ê°€ê´€ë¦¬í‘œ ë§ˆìŠ¤í„° ë°ì´í„° (Source of Truth: Google Sheets)
        let currentCustomerId = null;
        let currentData = {};
        let currentCustomer = null; // í˜¸í™˜ì„± ìœ ì§€ìš© (exportToNotion ë“±)
        let currentStatusFilter = 'all';
        let cachedCloudCount = customers.length; // í´ë¼ìš°ë“œ ê³ ê° ìˆ˜ ìºì‹œ (ë™ê¸°í™” ì‹œ ì—…ë°ì´íŠ¸)

        // í˜ì´ì§• ê´€ë ¨ ë³€ìˆ˜
        const PAGE_THRESHOLD = 500; // 500ëª… ì´ìƒì´ë©´ í˜ì´ì§• í™œì„±í™”
        const ITEMS_PER_PAGE = 50; // í˜ì´ì§€ë‹¹ í‘œì‹œ ê°œìˆ˜
        let currentPage = 1;
        let filteredCustomers = []; // í•„í„°ë§ëœ ê³ ê° ëª©ë¡ ì €ì¥

        // ========== ë‹¤ì¤‘ ê´€ë¦¬ì ì‹œìŠ¤í…œ ==========
        // ========== ë‹¤ì¤‘ ê´€ë¦¬ì ì‹œìŠ¤í…œ ==========
        // ì„¤ì •ê°’ì€ admin_config.js ì—ì„œ ë¡œë“œë¨

        // ========== ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ (SHA-256 í•´ì‹±) ==========
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function verifyPassword(inputPassword, storedHash) {
            const inputHash = await hashPassword(inputPassword);
            return inputHash === storedHash;
        }


        // ì¼ë°˜ê´€ë¦¬ì ëª©ë¡ (Phase 2: In-memory ì „ìš©)
        let regularAdminsRows = [];

        function getRegularAdmins() {

            return regularAdminsRows;
        }

        function saveRegularAdmins(admins) {

            regularAdminsRows = admins || [];
        }

        // ê´€ë¦¬ì í´ë¼ìš°ë“œ ë™ê¸°í™” - ë¶ˆëŸ¬ì˜¤ê¸°
        async function syncAdminsFromCloud() {
            try {
                const params = new URLSearchParams({ sheet: 'ê´€ë¦¬ì' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                if (!response.ok) {
                    console.error('ê´€ë¦¬ì ë™ê¸°í™” ì‹¤íŒ¨: HTTP', response.status);
                    return false;
                }
                const cloudAdmins = await response.json();
                if (Array.isArray(cloudAdmins)) {
                    saveRegularAdmins(cloudAdmins);
                    if (cloudAdmins.length > 0) {
                        console.log('âœ… [Admin Sync] ê´€ë¦¬ì ë™ê¸°í™” ì™„ë£Œ:', cloudAdmins.length + 'ëª…');
                    } else {
                        console.warn('âš ï¸ [Admin Sync] ê´€ë¦¬ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (0ëª…)');
                    }
                    return true;
                } else {
                    console.error('ê´€ë¦¬ì ë™ê¸°í™” ì‹¤íŒ¨: ì˜ëª»ëœ ì‘ë‹µ í˜•ì‹', cloudAdmins);
                    return false;
                }
            } catch (e) {
                console.warn('ê´€ë¦¬ì ë™ê¸°í™” ì‹¤íŒ¨:', e);
                return false;
            }
        }

        // ê´€ë¦¬ì í´ë¼ìš°ë“œ ë™ê¸°í™” - ì €ì¥
        async function syncAdminToCloud(adminData) {
            try {
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // text/plain ì‚¬ìš© (CORS íšŒí”¼)
                    body: JSON.stringify({
                        action: 'admin',
                        data: adminData
                    })
                });
                const result = await response.json();
                console.log('âœ… [Admin Sync] ê´€ë¦¬ì ì €ì¥ ì™„ë£Œ:', result);
                return result;
            } catch (e) {
                console.error('ê´€ë¦¬ì ì €ì¥ ì‹¤íŒ¨:', e);
                return null;
            }
        }

        // ê´€ë¦¬ì í´ë¼ìš°ë“œ ì‚­ì œ
        async function deleteAdminFromCloud(adminId) {
            try {
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        action: 'deleteAdmin',
                        adminId: adminId
                    })
                });
                return await response.json();
            } catch (e) {
                console.error('ê´€ë¦¬ì ì‚­ì œ ì‹¤íŒ¨:', e);
                return null;
            }
        }

        // í˜„ì¬ ë¡œê·¸ì¸í•œ ê´€ë¦¬ì
        let currentAdmin = null; // { id, role: 'main' | 'regular'}

        // ê¶Œí•œ ì²´í¬ í•¨ìˆ˜
        function isLoggedIn() {
            return currentAdmin !== null;
        }

        function isMainAdmin() {
            return currentAdmin && currentAdmin.role === 'main';
        }

        function isCreator(customer) {
            if (!currentAdmin) return false;
            // Legacy support: if no createdBy, default to Main Admin
            if (!customer.createdBy) return isMainAdmin();
            return String(customer.createdBy).trim().toLowerCase() === String(currentAdmin.id).trim().toLowerCase();
        }

        function canEdit(customer) {
            if (!customer) customer = currentData;
            if (!currentAdmin) return false;
            if (isMainAdmin()) return true;
            if (customer.isLocked && !customer.unlockedForSession) return false;
            return isCreator(customer);
        }

        function canDelete(customer) {
            return canEdit(customer);
        }

        function isCustomerLocked() {
            if (!currentData || !currentData.isLocked) return false;
            if (isMainAdmin()) return false;
            if (currentData.unlockedForSession) return false;
            return true;
        }

        async function unlockCustomerAccess() {
            const pw = document.getElementById('lockedPasswordInput').value;
            const pwHash = await hashPassword(pw);
            if (pwHash === DELETE_PASSWORD_HASH) {
                currentData.unlockedForSession = true;
                document.getElementById('accessDeniedOverlay').style.display = 'none';
                showToast('ì ‘ê·¼ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                document.getElementById('lockedPasswordInput').value = '';
            } else {
                showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            }
        }

        function showTrashModal() {
            if (!isMainAdmin()) {
                showToast('ë©”ì¸ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                return;
            }
            const trashItems = customers.filter(c => c.status === 'trash');
            const listEl = document.getElementById('trashList');
            listEl.innerHTML = '';
            if (trashItems.length === 0) {
                listEl.innerHTML = '<div style="padding:20px; text-align:center; color:#86868b;">íœ´ì§€í†µì´ ë¹„ì—ˆìŠµë‹ˆë‹¤</div>';
            } else {
                trashItems.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'trash-item';
                    div.innerHTML = `
                <div >
        <div style="font-weight:600;">${c.name || '(ì´ë¦„ì—†ìŒ)'}</div>
        <div style="font-size:11px; color:#86868b;">
            ì‚­ì œ: ${c.deletedAt?.split('T')[0] || '-'}(${c.deletedBy || '?'})
        </div>
    </div>
                <div class="trash-actions">
                    <button onclick="restoreCustomer('${c.customerId}')"
                        style="padding:4px 8px; border:1px solid #ddd; background:#fff; border-radius:4px; font-size:11px; cursor:pointer;">ë³µì›</button>
                    <button onclick="permanentDeleteCustomer('${c.customerId}')"
                        style="padding:4px 8px; border:1px solid #ff3b30; background:#ff3b30; color:#fff; border-radius:4px; font-size:11px; cursor:pointer;">ì˜êµ¬ì‚­ì œ</button>
                </div>
            `;
                    listEl.appendChild(div);
                });
            }
            document.getElementById('trashModal').classList.add('show');
        }

        function closeTrashModal() {
            document.getElementById('trashModal').classList.remove('show');
        }

        function restoreCustomer(id) {
            const index = customers.findIndex(c => c.customerId === id);
            if (index !== -1) {
                customers[index].status = 'consulting';
                delete customers[index].deletedAt;
                delete customers[index].deletedBy;
                saveCustomers();
                showToast('ê³ ê°ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                showTrashModal();
                updateCustomerList();
            }
        }

        function permanentDeleteCustomer(id) {
            if (!confirm('ì •ë§ë¡œ ì˜êµ¬ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            const index = customers.findIndex(c => c.customerId === id);
            if (index !== -1) {
                customers.splice(index, 1);
                saveCustomers();
                showToast('ì˜êµ¬ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                showTrashModal();
            }
        }

        function canWrite() {
            return currentAdmin !== null;
        }

        function canManageAdmins() {
            return currentAdmin?.role === 'main';
        }

        // Google Sheets GAS URL


        // ê´€ë¦¬ì ëª¨ë‹¬ í‘œì‹œ
        function showAdminModal() {
            document.getElementById('adminModal').classList.add('show');
            document.getElementById('adminId').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminId').focus();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').classList.remove('show');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
        }

        // ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ í‘œì‹œ
        function showDeletePasswordModal(callback) {
            window.pendingDeleteCallback = callback;
            document.getElementById('deletePasswordModal').classList.add('show');
            document.getElementById('deletePassword').value = '';
            document.getElementById('deletePassword').focus();
        }

        function closeDeletePasswordModal() {
            document.getElementById('deletePasswordModal').classList.remove('show');
            window.pendingDeleteCallback = null;
        }

        async function confirmDeletePassword() {
            const inputPw = document.getElementById('deletePassword').value;
            const pwHash = await hashPassword(inputPw);
            if (pwHash === DELETE_PASSWORD_HASH) {
                closeDeletePasswordModal();
                if (window.pendingDeleteCallback) {
                    window.pendingDeleteCallback();
                }
            } else {
                showToast('ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤', 'error');
                document.getElementById('deletePassword').value = '';
                document.getElementById('deletePassword').focus();
            }
        }

        // ê´€ë¦¬ì ê´€ë¦¬ ëª¨ë‹¬
        function showAdminManagerModal() {
            if (!isMainAdmin()) {
                showToast('ë©”ì¸ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                return;
            }
            document.getElementById('adminManagerModal').classList.add('show');
            renderRegularAdminList();
        }

        function closeAdminManagerModal() {
            document.getElementById('adminManagerModal').classList.remove('show');
        }

        function renderRegularAdminList() {
            const admins = getRegularAdmins();
            const container = document.getElementById('regularAdminList');
            if (admins.length === 0) {
                container.innerHTML = '<div style="color:#86868b;text-align:center;padding:20px;">ë“±ë¡ëœ ì¼ë°˜ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                container.innerHTML = admins.map((admin, i) => `
                <div
            style = "display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #e8e8ed;" >
        <span>ğŸ‘¤ ${admin.id}</span>
        <button class="btn btn-secondary btn-sm" onclick="removeRegularAdmin(${i})" style="color:#ff3b30;">ì‚­ì œ</button>
    </div>
                `).join('');
            }
        }

        async function addRegularAdmin() {
            const id = document.getElementById('newAdminId').value.trim();
            const pw = document.getElementById('newAdminPw').value;

            if (!id || !pw) {
                showToast('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            // ë©”ì¸ê´€ë¦¬ì ID ì¤‘ë³µ ì²´í¬ (ë³µìˆ˜ ê´€ë¦¬ì ì§€ì›)
            if (MAIN_ADMINS.some(admin => admin.id === id)) {
                showToast('ë©”ì¸ê´€ë¦¬ì IDëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const admins = getRegularAdmins();
            if (admins.some(a => a.id === id)) {
                showToast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤', 'error');
                return;
            }

            // ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
            const pwHash = await hashPassword(pw);
            const newAdmin = {
                id,
                passwordHash: pwHash,  // í•´ì‹œê°’ ì €ì¥ (ì›ë³¸ ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì•ˆ í•¨)
                name: id,
                createdAt: new Date().toISOString()
            };

            admins.push(newAdmin);
            saveRegularAdmins(admins);

            // í´ë¼ìš°ë“œ ë™ê¸°í™”
            syncAdminToCloud(newAdmin);

            document.getElementById('newAdminId').value = '';
            document.getElementById('newAdminPw').value = '';
            renderRegularAdminList();
            showToast(`ì¼ë°˜ê´€ë¦¬ì '${id}' ì¶”ê°€ë¨(í´ë¼ìš°ë“œ ë™ê¸°í™”)`, 'success');
        }

        async function removeRegularAdmin(index) {
            if (!confirm('ì´ ê´€ë¦¬ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const admins = getRegularAdmins();
            const removed = admins.splice(index, 1)[0];
            saveRegularAdmins(admins);

            // í´ë¼ìš°ë“œì—ì„œë„ ì‚­ì œ
            deleteAdminFromCloud(removed.id);

            renderRegularAdminList();
            showToast(`ê´€ë¦¬ì '${removed.id}' ì‚­ì œë¨(í´ë¼ìš°ë“œ ë™ê¸°í™”)`, 'success');
        }


        // ê´€ë¦¬ì ë¡œê·¸ì¸
        async function loginAdmin() {
            const inputId = document.getElementById('adminId').value.trim();
            const inputPw = document.getElementById('adminPassword').value;
            const inputHash = await hashPassword(inputPw);

            // ë©”ì¸ê´€ë¦¬ì í™•ì¸ (í•´ì‹œ ë¹„êµ) - ë³µìˆ˜ ê´€ë¦¬ì ì§€ì›
            const mainAdmin = MAIN_ADMINS.find(admin => admin.id === inputId && admin.passwordHash === inputHash);
            if (mainAdmin) {
                currentAdmin = { id: mainAdmin.id, role: 'main', name: mainAdmin.name };
                closeAdminModal();
                activateAdminMode();
                showToast(`${mainAdmin.name}ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                return;
            }

            // ì¼ë°˜ê´€ë¦¬ì í™•ì¸ (í•´ì‹œ ë¹„êµ)
            const admins = getRegularAdmins();
            const found = admins.find(a => a.id === inputId && a.passwordHash === inputHash);
            if (found) {
                currentAdmin = { id: found.id, role: 'regular' };
                closeAdminModal();
                activateAdminMode();
                showToast('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                return;
            }

            showToast('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤', 'error');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').focus();
        }

        // ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”
        function activateAdminMode() {
            const roleLabel = isMainAdmin() ? 'ğŸ”‘ ë©”ì¸ê´€ë¦¬ì' : 'ğŸ‘¤ ê´€ë¦¬ì';
            const adminId = currentAdmin?.id || '';

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('adminBadge').className = 'admin-badge admin';
            document.getElementById('adminBadge').innerHTML = `${roleLabel}: ${adminId} `;

            let statusHTML = `
                <span class="admin-badge admin" id = "adminBadge" > ${roleLabel}: ${adminId}</span>
                    <button class="admin-login-btn" onclick="logoutAdmin()">ë¡œê·¸ì•„ì›ƒ</button>
            `;

            // ë©”ì¸ê´€ë¦¬ìë§Œ ê´€ë¦¬ì ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ
            if (isMainAdmin()) {
                statusHTML += `<button class="admin-login-btn" onclick = "showAdminManagerModal()" style = "margin-left:5px;" >ğŸ‘¥ ê´€ë¦¬ì
        ê´€ë¦¬</button> `;
            }

            document.getElementById('adminStatus').innerHTML = statusHTML;

            // íœ´ì§€í†µ ë²„íŠ¼ (ë©”ì¸ê´€ë¦¬ì ì „ìš©)
            const trashBtn = document.getElementById('trashBtn');
            if (trashBtn) {
                trashBtn.style.display = isMainAdmin() ? 'flex' : 'none';
            }

            // ì›ê°€ê´€ë¦¬í‘œ ì ê¸ˆ í•´ì œ
            document.getElementById('costLockOverlay').style.display = 'none';
            document.getElementById('costCategoriesWrapper').classList.remove('cost-locked');
            document.getElementById('adminSettings').style.display = 'block';

            // ì—­í• ì— ë”°ë¥¸ íƒ­ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            updateTabVisibility();
        }

        // ì—­í• ì— ë”°ë¥¸ íƒ­ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
        function updateTabVisibility() {
            const mainOnly = isMainAdmin();

            // ë©”ì¸ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆëŠ” íƒ­ ì²˜ë¦¬ (ì›ê°€ê´€ë¦¬í‘œ, í†µê³„)
            document.querySelectorAll('.customer-tab[data-main-only="true"]').forEach(tab => {
                tab.style.display = mainOnly ? '' : 'none';
            });

            // í†µê³„ íŒ¨ë„ë„ ìˆ¨ê¸°ê¸°
            const statsPanel = document.getElementById('panel-stats');
            if (statsPanel) {
                statsPanel.style.display = mainOnly ? '' : 'none';
            }

            // ì›ê°€ê´€ë¦¬í‘œ íŒ¨ë„ë„ ìˆ¨ê¸°ê¸°
            const costPanel = document.getElementById('panel-cost');
            if (costPanel) {
                costPanel.style.display = mainOnly ? '' : 'none';
            }

            // ì¼ë°˜ê´€ë¦¬ìê°€ ìˆ¨ê²¨ì§„ íƒ­ì„ ë³´ê³  ìˆë‹¤ë©´ ê³ ê°ì •ë³´ íƒ­ìœ¼ë¡œ ì´ë™
            if (!mainOnly) {
                const activeTab = document.querySelector('.customer-tab.active');
                if (activeTab && activeTab.dataset.mainOnly === 'true') {
                    showCustomerTab('info');
                }
            }
        }

        // ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ
        function logoutAdmin() {
            currentAdmin = null;

            // ê¸°ê¸° ì‹ ë¢° í•´ì œ (ì •ì±…: ë¡œê·¸ì•„ì›ƒ ì‹œ ê¸°ê¸° ì‹ ë¢° í•´ì œ)
            localStorage.removeItem(DEVICE_TRUST_KEY);

            // ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ í‘œì‹œ (ID/PW ë¡œê·¸ì¸ í™”ë©´)
            const overlay = document.getElementById('loginOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                showLoginView('idpw');
            }

            // UI ì´ˆê¸°í™” (í•„ìš”ì‹œ)
            document.getElementById('adminStatus').innerHTML = '';

            // ì›ê°€ê´€ë¦¬í‘œ ì ê¸ˆ
            document.getElementById('costLockOverlay').style.display = 'flex';
            document.getElementById('costCategoriesWrapper').classList.add('cost-locked');
            document.getElementById('adminSettings').style.display = 'none';

            // íƒ­ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            updateTabVisibility();

            showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ê¸° ì‹ ë¢°ê°€ í•´ì œë©ë‹ˆë‹¤.', 'success');
        }

        // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ê¸°ëŠ¥ ë¹„í™œì„±í™”)
        function changeAdminPassword() {
            showToast('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì€ ê´€ë¦¬ì ê´€ë¦¬ ë©”ë‰´ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
        }

        // ê´€ë¦¬ì ëª¨ë“œ ì²´í¬ (ì €ì¥ ì‹œ)
        function checkAdminForSave() {
            if (!isLoggedIn()) {
                // ì›ê°€ê´€ë¦¬í‘œëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ (ì „ì—­ ë°ì´í„°ì´ë¯€ë¡œ)
                return false;
            }
            return true;
        }

        // ì ê¸ˆ ìƒíƒœ ì²´í¬
        // ì ê¸ˆ UI ì—…ë°ì´íŠ¸
        function updateLockUI() {
            const lockBtn = document.getElementById('lockToggleBtn');
            const createdBySpan = document.getElementById('headerCreatedBy');

            if (lockBtn) {
                const isLocked = currentData && currentData.isLocked;
                lockBtn.className = 'lock-toggle-btn ' + (isLocked ? 'locked' : 'unlocked');
                lockBtn.innerHTML = isLocked ? 'ğŸ”’ ì ê¸ˆ' : 'ğŸ”“ ì—´ë¦¼';
                lockBtn.title = isLocked ? 'ì ê¸ˆ í•´ì œ' : 'ì ê¸ˆ ì„¤ì •';
            }

            if (createdBySpan) {
                createdBySpan.textContent = `ğŸ“ ${currentData?.createdBy || '-'} `;
            }
        }

        // ì ê¸ˆ í† ê¸€
        function toggleCustomerLock() {
            if (!currentCustomerId) return;

            // Only Main Admin can toggle
            if (!isMainAdmin()) {
                showToast('ë©”ì¸ê´€ë¦¬ìë§Œ ì ê¸ˆ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }

            currentData.isLocked = !currentData.isLocked;
            // Clear session unlock if re-locking
            if (currentData.isLocked) {
                delete currentData.unlockedForSession;
            }

            // Sync back to customers array
            const idx = customers.findIndex(c => c.customerId === currentCustomerId);
            if (idx !== -1) {
                customers[idx].isLocked = currentData.isLocked;
            }

            saveCustomers();
            updateLockUI();
            showToast(currentData.isLocked ? 'ê³ ê° ì •ë³´ê°€ ì ê¸ˆ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ì ê¸ˆì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }


        // ì„¤ì • íŒ¨ë„ í† ê¸€
        function toggleSettingsPanel(event) {
            if (event) event.stopPropagation();
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        // (ì„¤ì • íŒ¨ë„ì€ í†±ë‹ˆë°”í€´ í´ë¦­ìœ¼ë¡œë§Œ ì—´ê³  ë‹«ìŒ - ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ì§€ ì•ŠìŒ)

        // ê¸€ì”¨ í¬ê¸° ì¡°ì ˆ
        function changeFontSize(size) {
            document.documentElement.style.setProperty('--font-size-base', size + 'px');
            document.getElementById('fontSizeValue').textContent = size + 'px';
            localStorage.setItem('DJ_fontsize', size);
            document.body.style.fontSize = size + 'px';
        }

        // ì˜ì—­ë³„ ê¸€ì”¨ í¬ê¸° ì¡°ì ˆ (ëª¨ë“  íƒ­ ì ìš©)
        function changePartFontSize(part, size) {
            const s = size + 'px';
            document.getElementById('fs' + part.charAt(0).toUpperCase() + part.slice(1) + 'Val').textContent = s;
            switch (part) {
                case 'catHeader':
                    // ê²¬ì ì„œ + ì›ê°€ê´€ë¦¬ ì¹´í…Œê³ ë¦¬ í—¤ë” (div + h3 ëª¨ë‘)
                    document.querySelectorAll('.category-header').forEach(h => h.style.fontSize = s);
                    document.querySelectorAll('.category-header h3').forEach(h => h.style.fontSize = s);
                    document.querySelectorAll('.category-header .subtotal').forEach(h => h.style.fontSize = s);
                    // ë¬¸ì„œ ì„¹ì…˜ íƒ€ì´í‹€
                    document.querySelectorAll('.section-title').forEach(h => h.style.fontSize = s);
                    break;
                case 'colHeader':
                    // ëª¨ë“  í…Œì´ë¸” thead
                    document.querySelectorAll('.estimate-table thead th, .data-table thead th, .summary-table thead th').forEach(th => th.style.fontSize = s);
                    break;
                case 'content':
                    // ëª¨ë“  í…Œì´ë¸” tbody
                    document.querySelectorAll('.estimate-table tbody td, .data-table tbody td, .summary-table tbody td').forEach(td => td.style.fontSize = s);
                    document.querySelectorAll('.estimate-table tbody input, .estimate-table tbody select, .estimate-table tbody textarea, .data-table tbody input, .data-table tbody select').forEach(el => el.style.fontSize = s);
                    // ë¬¸ì„œ ë‚´ info-item, clause, sig-field ë“±
                    document.querySelectorAll('.info-item input, .info-item select, .info-item span, .clause-content, .sig-field input').forEach(el => el.style.fontSize = s);
                    break;
                case 'memo':
                    document.querySelectorAll('.estimate-memo, .estimate-memo textarea, .estimate-memo .memo-content, .category-memo, .category-memo textarea, .special-note textarea').forEach(el => el.style.fontSize = s);
                    break;
            }
            localStorage.setItem('DJ_fs_' + part, size);
        }

        function loadPartFontSizes() {
            ['catHeader', 'colHeader', 'content', 'memo'].forEach(part => {
                const defaults = { catHeader: '13', colHeader: '10', content: '11', memo: '11' };
                const saved = localStorage.getItem('DJ_fs_' + part) || defaults[part];
                const sliderId = 'fs' + part.charAt(0).toUpperCase() + part.slice(1);
                const slider = document.getElementById(sliderId);
                if (slider) {
                    slider.value = saved;
                    changePartFontSize(part, saved);
                }
            });
        }

        function loadFontSize() {
            const savedSize = localStorage.getItem('DJ_fontsize') || '12';
            document.getElementById('fontSizeSlider').value = savedSize;
            document.getElementById('fontSizeValue').textContent = savedSize + 'px';
            document.documentElement.style.setProperty('--font-size-base', savedSize + 'px');
        }

        // ===== í…ìŠ¤íŠ¸ ì„œì‹ (ë“œë˜ê·¸ ì„ íƒ í›„ ìƒ‰ìƒ/ë°‘ì¤„/ì·¨ì†Œì„ ) =====
        let savedSelection = null;

        function applyTextFormat(type, value) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (!savedSelection) { toolbar.classList.remove('show'); return; }

            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(savedSelection);

            try {
                if (type === 'clear' || type === 'removeFormat') {
                    // ì„œì‹ ì œê±°: ì„ íƒ ì˜ì—­ì˜ format span í’€ê¸°
                    const range = savedSelection;
                    const container = range.commonAncestorContainer;
                    const parent = container.nodeType === 3 ? container.parentElement : container;
                    // execCommand ì‹œë„ (contenteditable ë‚´ì—ì„œë§Œ ì‘ë™)
                    if (parent.closest('[contenteditable="true"]')) {
                        document.execCommand('removeFormat', false, null);

                        // ì„œì‹ ì œê±° í›„ì—ë„ ì„ íƒ ì˜ì—­ ìœ ì§€ ì‹œë„
                        savedSelection = window.getSelection().getRangeAt(0).cloneRange();
                    } else {
                        // ìˆ˜ë™ ì„œì‹ ì œê±°
                        const fragment = range.extractContents();
                        const tempDiv = document.createElement('div');
                        tempDiv.appendChild(fragment);
                        const plainText = tempDiv.textContent;
                        const textNode = document.createTextNode(plainText);
                        range.insertNode(textNode);

                        // ì„ íƒ ì˜ì—­ ì¬ì„¤ì • (í…ìŠ¤íŠ¸ ë…¸ë“œ ì „ì²´ ì„ íƒ)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(textNode);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    }
                } else {
                    // ìŠ¤íƒ€ì¼ span ê°ì‹¸ê¸° (execCommand ì—†ì´ ì‘ë™)
                    const range = savedSelection;
                    const span = document.createElement('span');
                    if (type === 'color') {
                        span.style.color = value;
                    } else if (type === 'underline') {
                        span.style.textDecoration = 'underline';
                    } else if (type === 'strikethrough') {
                        span.style.textDecoration = 'line-through';
                    } else if (type === 'bold') {
                        span.style.fontWeight = '700';
                    } else if (type === 'italic') {
                        span.style.fontStyle = 'italic';
                    }
                    try {
                        range.surroundContents(span);

                        // ì„œì‹ ì ìš© í›„ ì„ íƒ ì˜ì—­ ìœ ì§€ (span ë‚´ìš© ë‹¤ì‹œ ì„ íƒ)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(span);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    } catch (e) {
                        // ë‹¤ì¤‘ ë…¸ë“œ ì„ íƒ ì‹œ extractContents ì‚¬ìš©
                        const fragment = range.extractContents();
                        span.appendChild(fragment);
                        range.insertNode(span);

                        // ì„ íƒ ì˜ì—­ ìœ ì§€ (span ë‚´ìš© ë‹¤ì‹œ ì„ íƒ)
                        const newRange = document.createRange();
                        newRange.selectNodeContents(span);
                        sel.removeAllRanges();
                        sel.addRange(newRange);
                        savedSelection = newRange;
                    }
                }
            } catch (e) { console.warn('í…ìŠ¤íŠ¸ ì„œì‹ ì ìš© ì‹¤íŒ¨:', e); }

            // íˆ´ë°” ìˆ¨ê¹€ ë°©ì§€ (ì—°ì† ì„œì‹ ì ìš©ì„ ìœ„í•´ ìœ ì§€)
            // toolbar.classList.remove('show'); 
            // savedSelection = null; 

            saveEstimateData();
        }

        // mouseup ì‹œ ì„ íƒ ì˜ì—­ í™•ì¸ í›„ íˆ´ë°” í‘œì‹œ (ëª¨ë“  íƒ­ì—ì„œ ì‘ë™, ëª¨ë°”ì¼ ì œì™¸)
        document.addEventListener('mouseup', function (e) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (!toolbar) return;

            // ëª¨ë°”ì¼(í„°ì¹˜ ë””ë°”ì´ìŠ¤)ì—ì„œëŠ” ì„œì‹ íˆ´ë°” ë¹„í™œì„±í™”
            const isMobile = /android|ipad|iphone|ipod/i.test(navigator.userAgent) || window.innerWidth <= 768;
            if (isMobile) return;

            // íˆ´ë°” ë˜ëŠ” ì„¤ì • íŒ¨ë„ í´ë¦­ ì‹œ ë¬´ì‹œ
            if (toolbar.contains(e.target)) return;
            if (e.target.closest('.settings-panel')) return;

            setTimeout(() => {
                const sel = window.getSelection();
                if (!sel || sel.isCollapsed || !sel.toString().trim()) {
                    toolbar.classList.remove('show');
                    savedSelection = null;
                    return;
                }

                // ì„ íƒëœ í…ìŠ¤íŠ¸ì˜ ìœ„ì¹˜ í™•ì¸
                const anchorNode = sel.anchorNode;
                const parentEl = anchorNode?.nodeType === 3 ? anchorNode.parentElement : anchorNode;

                // text-formattable í´ë˜ìŠ¤ê°€ ìˆëŠ” ì˜ì—­(ì‚¬ìš©ì í¸ì§‘ ê°€ëŠ¥ ì˜ì—­)ì—ì„œë§Œ ì„œì‹ ì ìš© ê°€ëŠ¥
                const isFormattableArea = parentEl?.closest('.text-formattable');

                // ì…ë ¥ í•„ë“œ, ëª¨ë‹¬, ë¡œê·¸ì¸ í™”ë©´ì—ì„œëŠ” ì„œì‹ ì ìš© ë¶ˆê°€
                const isFormElement = parentEl?.closest('input, select, textarea');
                const isModalArea = parentEl?.closest('.modal, .login-overlay, #loginOverlay, #initialSyncOverlay');

                // í¸ì§‘ ê°€ëŠ¥ ì˜ì—­ì´ ì•„ë‹ˆê±°ë‚˜ ì œì™¸ ì˜ì—­ì¸ ê²½ìš° íˆ´ë°” ìˆ¨ê¹€
                if (!isFormattableArea || isFormElement || isModalArea) {
                    toolbar.classList.remove('show');
                    savedSelection = null;
                    return;
                }

                savedSelection = sel.getRangeAt(0).cloneRange();

                const rect = sel.getRangeAt(0).getBoundingClientRect();
                let left = rect.left + rect.width / 2 - 110;
                let top = rect.top - 44;
                if (top < 10) top = rect.bottom + 8;
                if (left < 5) left = 5;
                if (left + 240 > window.innerWidth) left = window.innerWidth - 250;

                toolbar.style.left = left + 'px';
                toolbar.style.top = top + 'px';
                toolbar.classList.add('show');
                console.log('ì„œì‹ íˆ´ë°” í‘œì‹œ:', sel.toString());
            }, 10);
        });

        // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ íˆ´ë°” ìˆ¨ê¸°ê¸°
        document.addEventListener('mousedown', function (e) {
            const toolbar = document.getElementById('textFormatToolbar');
            if (toolbar && !toolbar.contains(e.target) && !e.target.closest('.settings-panel')) {
                toolbar.classList.remove('show');
            }
        });

        document.addEventListener('DOMContentLoaded', async function () {
            // UI ì´ˆê¸°í™”
            initLoginScreen();
            loadFontSize();
            loadPartFontSizes();
            createCostCategories();
            createEstimateCategories();
            createCoverTable();
            initYearFilter();
            updateCustomerList();

            const statusEl = document.getElementById('initialSyncStatus');
            const overlay = document.getElementById('initialSyncOverlay');

            try {
                statusEl.textContent = 'ê³ ê° ë° ê¸°ì´ˆ ë°ì´í„°ë¥¼ ë™ê¸°í™” ì¤‘...';

                // [Phase 2 Sync Gate] ëª¨ë“  í•„ìˆ˜ ë°ì´í„° ë™ê¸°í™” ëŒ€ê¸°
                const results = await Promise.allSettled([
                    syncFromCloud(true),      // ê³ ê°
                    syncCostFromCloud(),      // ì›ê°€
                    syncChecklistFromCloud(), // ì²´í¬ë¦¬ìŠ¤íŠ¸
                    syncExpensesFromCloud(),  // ìš´ì˜ë¹„
                    syncAdminsFromCloud()     // ê´€ë¦¬ì
                ]);

                // í•„ìˆ˜ ë°ì´í„° ì„±ê³µ ì—¬ë¶€ í™•ì¸
                // í•„ìˆ˜ ë°ì´í„° ì„±ê³µ ì—¬ë¶€ í™•ì¸ (ê³ ê°, ê´€ë¦¬ìë§Œ í•„ìˆ˜ë¡œ ë³€ê²½ - ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µë°± í—ˆìš©)
                const criticalSuccess = (results[0].status === 'fulfilled' && results[0].value === true) &&
                    (results[4].status === 'fulfilled' && results[4].value === true);

                if (criticalSuccess) {
                    // ë¹„í•„ìˆ˜ ë°ì´í„° ì‹¤íŒ¨ ë¡œê¹…
                    const labels = ['ê³ ê°', 'ì›ê°€', 'ì²´í¬ë¦¬ìŠ¤íŠ¸', 'ìš´ì˜ë¹„', 'ê´€ë¦¬ì'];
                    results.forEach((r, i) => {
                        if (r.status !== 'fulfilled' || r.value !== true) {
                            console.warn(`âš ï¸ [Non-Critical Sync Warning] ${labels[i]} ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨ (ì•± ì‹¤í–‰ ê³„ì†)`);
                        }
                    });

                    // ë™ê¸°í™” ì„±ê³µ ì‹œ í´ë¦°ì—… ì‹¤í–‰
                    runPhase2Cleanup();

                    // ì˜¤ë²„ë ˆì´ ì œê±°
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 500);
                    console.log('âœ… ì „ì—­ ë°ì´í„° ë™ê¸°í™” ë° í´ë¦°ì—… ì™„ë£Œ');
                } else {
                    // í•„ìˆ˜ ë°ì´í„° ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
                    const failedLabels = [];
                    if (results[0].status !== 'fulfilled' || results[0].value !== true) failedLabels.push('ê³ ê°');
                    if (results[4].status !== 'fulfilled' || results[4].value !== true) failedLabels.push('ê´€ë¦¬ì');
                    throw new Error(`${failedLabels.join(', ')} í•„ìˆ˜ ë°ì´í„° ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
                }

                // ë¶€ê°€ ë¡œì§
                fetchScheduleTemplate();
                fetchSettlementMaster();

                if (typeof renderChecklistItems === 'function') {
                    renderChecklistItems();
                    if (typeof updateChecklistFilters === 'function') updateChecklistFilters();
                }

            } catch (err) {
                console.error('âŒ ì´ˆê¸° ë™ê¸°í™” ì‹¤íŒ¨:', err);
                // ì—ëŸ¬ í™”ë©´ í‘œì‹œ
                document.querySelector('.sync-loader').style.display = 'none';
                document.getElementById('syncErrorContent').style.display = 'block';
                document.getElementById('syncErrorMessage').textContent = err.message + ' ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
            }
        });

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        let toastTimer = null;
        function showToast(message, type = 'success', duration = 2000) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');

            if (toastTimer) clearTimeout(toastTimer);

            toast.className = 'toast show ' + type;
            icon.textContent = type === 'success' ? 'âœ“' : (type === 'info' ? 'â„¹ï¸' : 'âœ•');
            msg.innerHTML = message; // [ë³€ê²½] ì¤„ë°”ê¿ˆ ì§€ì›ì„ ìœ„í•´ innerHTML ì‚¬ìš©

            toastTimer = setTimeout(() => { toast.classList.remove('show'); }, duration);
        }

        // ì €ì¥ í™•ì¸ í† ìŠ¤íŠ¸ (ìš°ì¸¡ìƒë‹¨, ì§§ì€ í‘œì‹œ)
        let saveToastTimer = null;
        function showSaveConfirmToast(message) {
            let saveToast = document.getElementById('saveConfirmToast');
            if (!saveToast) {
                saveToast = document.createElement('div');
                saveToast.id = 'saveConfirmToast';
                saveToast.style.cssText = `
                    position: fixed; top: 20px; right: 20px;
                    background: linear-gradient(135deg, #34c759, #28a745);
                    color: #fff; padding: 12px 24px; border-radius: 12px;
                    font-size: 14px; font-weight: 600; z-index: 99999;
                    display: none; align-items: center; gap: 8px;
                    box-shadow: 0 8px 30px rgba(52, 199, 89, 0.4);
                    animation: slideInSaveToast 0.3s ease;
                    transition: opacity 0.3s ease;
                `;
                document.body.appendChild(saveToast);

                // ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ ì¶”ê°€
                if (!document.getElementById('saveToastKeyframes')) {
                    const style = document.createElement('style');
                    style.id = 'saveToastKeyframes';
                    style.textContent = `
                        @keyframes slideInSaveToast {
                            from { transform: translateX(100px); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            if (saveToastTimer) clearTimeout(saveToastTimer);
            saveToast.innerHTML = message;
            saveToast.style.display = 'flex';
            saveToast.style.opacity = '1';
            saveToastTimer = setTimeout(() => {
                saveToast.style.opacity = '0';
                setTimeout(() => { saveToast.style.display = 'none'; }, 300);
            }, 1500);
        }

        // ìƒíƒœ í•„í„°
        function setStatusFilter(status) {
            currentStatusFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.status === status);
            });
            updateCustomerList();
        }

        // Cost Tab Security
        const COST_ACCESS_PIN = '6454';
        let isCostUnlocked = false;

        function showCustomerTab(tabId) {
            // [SECURITY CHECK] Cost Management Tab
            // ë©”ì¸ê´€ë¦¬ì(isMainAdmin)ëŠ” íŒ¨ìŠ¤; ì¼ë°˜ê´€ë¦¬ìë§Œ ë¹„ë°€ë²ˆí˜¸ ì²´í¬
            if (tabId === 'cost' && !isMainAdmin() && !isCostUnlocked) {
                // If not unlocked, show password modal and STOP.
                document.getElementById('costPasswordModal').classList.add('show');
                document.getElementById('costAccessPin').value = '';
                document.getElementById('costAccessPin').focus();
                return;
            }

            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.customer-tab').forEach(t => t.classList.remove('active'));

            const panel = document.getElementById('panel-' + tabId);
            if (panel) panel.classList.add('active');

            // Find the button and add active class
            const buttons = document.querySelectorAll('.customer-tab');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(`'${tabId}'`)) {
                    btn.classList.add('active');
                }
            });

            syncAllFields();
            if (tabId === 'estimate') updateEstimateFromCost();
            if (tabId === 'schedule') loadScheduleForCustomer();
            if (tabId === 'as_list') loadASList();
            if (tabId === 'settlement') {
                if (typeof renderSettlementTable === 'function') renderSettlementTable();
            }
            if (tabId === 'expenses') {
                if (typeof renderExpensesTable === 'function') renderExpensesTable();
            }
            if (tabId === 'stats') {
                if (typeof renderAuditLog === 'function') renderAuditLog(currentCustomerId ? currentCustomerId : null);
            }
            if (tabId === 'dashboard') {
                if (typeof renderDashboard === 'function') renderDashboard();
            }
        }

        function renderDashboard() {
            // 1. Profile - í˜„ì¥ëª…
            document.getElementById('dashName').innerText = document.getElementById('headerCustomerName').innerText;
            const name = document.getElementById('headerCustomerName').innerText;
            document.getElementById('dashAvatar').innerText = name ? name.charAt(0) : '?';

            // ê³ ê° ì—°ë½ì²˜ í‘œì‹œ: ì„±ëª…(ì—°ë½ì²˜) | ë°°ìš°ì ì„±ëª…(ë°°ìš°ì ì—°ë½ì²˜)
            const customerName = currentData.name || currentData.clientName || '';
            const customerPhone = currentData.phone || currentData.clientPhone || '';
            const spouseName = currentData.spouseName || '';
            const spousePhone = currentData.spousePhone || '';

            let contactDisplay = '';
            if (customerName) {
                contactDisplay = customerName;
                if (customerPhone) contactDisplay += `(${customerPhone})`;
            }
            if (spouseName) {
                if (contactDisplay) contactDisplay += ' | ';
                contactDisplay += spouseName;
                if (spousePhone) contactDisplay += `(${spousePhone})`;
            }
            document.getElementById('dashPhone').innerText = contactDisplay || '-';

            const fieldAddress = document.querySelector('.customer-field[data-field="siteAddress"]');
            if (fieldAddress) document.getElementById('dashAddress').innerText = fieldAddress.value || '-';

            const fieldArea = document.querySelector('.customer-field[data-field="area"]');
            const fieldType = document.querySelector('.customer-field[data-field="buildingType"]');
            let areaType = [];
            if (fieldArea && fieldArea.value) areaType.push(fieldArea.value);
            if (fieldType && fieldType.value) areaType.push(fieldType.value);
            document.getElementById('dashAreaType').innerText = areaType.length > 0 ? areaType.join(' / ') : '-';

            // ê³„ì•½ì¼
            const contractDate = currentData.contractDate || '';
            document.getElementById('dashContractDate').innerText = contractDate || '-';

            // ì´ ê³„ì•½ê¸ˆì•¡ (VAT í¬í•¨)
            const totalAmountField = document.querySelector('.customer-field[data-field="totalAmount"]');
            const totalAmount = totalAmountField ? totalAmountField.value : (currentData.totalAmount || '');
            if (totalAmount) {
                const amountNum = parseInt(String(totalAmount).replace(/[^0-9]/g, '')) || 0;
                document.getElementById('dashContractAmount').innerText = amountNum.toLocaleString() + 'ì›';
            } else {
                document.getElementById('dashContractAmount').innerText = '-';
            }

            // 2. Status & Timeline
            const statusSelect = document.getElementById('customerStatus');
            const statusText = statusSelect.options[statusSelect.selectedIndex].text;
            const statusVal = statusSelect.value;
            // Remove emoji for badge
            let statusLabel = statusText.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2700}-\u{27BF}]|[\u{2600}-\u{26FF}]/gu, '').trim();

            // [New] A/S Period Check (ì§„í–‰ìƒí™©ì— A/S ê¸°ê°„ í‘œì‹œ)
            if (statusVal === 'completed' || statusVal === 'as_done' || statusVal === 'contracted' || statusVal === 'in_progress') {
                const finalDateStr = currentData.finalPaymentDate || '';
                if (finalDateStr) {
                    const finalDate = new Date(finalDateStr);
                    const asEndDate = new Date(finalDate);
                    asEndDate.setFullYear(finalDate.getFullYear() + 1);
                    const today = new Date();
                    if (today >= finalDate && today <= asEndDate) {
                        statusLabel = "A/S ê¸°ê°„ ì¤‘";
                    }
                }
            }

            document.getElementById('dashStatusBadge').innerText = statusLabel;

            // ê³µì‚¬ ê¸°ê°„
            const start = document.getElementById('constructionStartInput').value;
            const end = document.getElementById('constructionEndInput').value;
            document.getElementById('dashPeriod').innerText = (start || '-') + ' ~ ' + (end || '-');

            // ì´ì‚¬ì˜ˆì •ì¼
            const movingDate = currentData.movingDate || '';
            document.getElementById('dashMovingDate').innerText = movingDate || '-';

            // A/S ê¸°ê°„ (ì”ê¸ˆì¼ + 12ê°œì›”)
            const finalDateStr = currentData.finalPaymentDate || '';
            if (finalDateStr) {
                const finalDate = new Date(finalDateStr);
                const asEndDate = new Date(finalDate);
                asEndDate.setFullYear(finalDate.getFullYear() + 1);
                const formattedStart = finalDate.toISOString().split('T')[0];
                const formattedEnd = asEndDate.toISOString().split('T')[0];
                document.getElementById('dashASPeriod').innerText = `${formattedStart} ~ ${formattedEnd}`;
            } else {
                document.getElementById('dashASPeriod').innerText = '-';
            }

            // í™”ì¥ì‹¤ ëˆ„ìˆ˜ ë³´ì¦ ê¸°ê°„ (A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì—°ë™)
            let bathroomWarranty = '-';
            if (typeof asListDB !== 'undefined' && asListDB.length > 0) {
                // A/S ë¦¬ìŠ¤íŠ¸ì—ì„œ 'í™”ì¥ì‹¤' ë˜ëŠ” 'ëˆ„ìˆ˜' ê´€ë ¨ í•­ëª© ì°¾ê¸°
                const bathroomItem = asListDB.find(item =>
                    (item.category && (item.category.includes('í™”ì¥ì‹¤') || item.category.includes('ëˆ„ìˆ˜'))) ||
                    (item.name && (item.name.includes('í™”ì¥ì‹¤') || item.name.includes('ëˆ„ìˆ˜')))
                );
                if (bathroomItem && bathroomItem.warrantyPeriod) {
                    bathroomWarranty = bathroomItem.warrantyPeriod;
                } else if (bathroomItem && bathroomItem.asEndDate) {
                    bathroomWarranty = `~ ${bathroomItem.asEndDate}`;
                }
            }
            // ê¸°ë³¸ê°’: ì”ê¸ˆì¼ + 2ë…„ (í™”ì¥ì‹¤ ëˆ„ìˆ˜ ë³´ì¦ 24ê°œì›”)
            if (bathroomWarranty === '-' && finalDateStr) {
                const finalDate = new Date(finalDateStr);
                const warrantyEnd = new Date(finalDate);
                warrantyEnd.setFullYear(finalDate.getFullYear() + 2);
                bathroomWarranty = `~ ${warrantyEnd.toISOString().split('T')[0]} (2ë…„)`;
            }
            document.getElementById('dashBathroomWarranty').innerText = bathroomWarranty;

            // Update Timeline
            let progress = 0;
            document.querySelectorAll('.timeline-step').forEach(s => s.classList.remove('active'));
            let activeStepId = '';

            if (statusVal === 'consulting') { progress = 10; activeStepId = 'step-consulting'; }
            else if (statusVal === 'estimate') { progress = 25; activeStepId = 'step-consulting'; }
            else if (statusVal === 'contracted') { progress = 40; activeStepId = 'step-contract'; }
            else if (statusVal === 'in_progress') { progress = 70; activeStepId = 'step-construction'; }
            else if (statusVal === 'completed' || statusVal === 'as_done' || statusVal.includes('as_')) { progress = 100; activeStepId = 'step-completed'; }

            if (activeStepId) document.getElementById(activeStepId).classList.add('active');
            document.getElementById('dashProgressWidth').style.width = progress + '%';

            // 3. Cost Summary (ìˆ˜ì •: ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ê¸°ì¤€)
            // Get Total Amount
            const totalAmtInput = document.querySelector('.customer-field[data-field="totalAmount"]');
            const totalAmtStr = totalAmtInput ? totalAmtInput.value.replace(/[^0-9]/g, '') : '0';
            const totalAmt = parseInt(totalAmtStr) || 0;
            document.getElementById('dashTotalAmount').innerText = totalAmt.toLocaleString() + 'ì›';

            // Get Total Expenditure (Cost) from Settlement Ledger (ì •ì‚° ê´€ë¦¬ ëŒ€ì¥)
            // [ë³€ê²½] ì›ê°€ê´€ë¦¬í‘œê°€ ì•„ë‹Œ ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ì˜ 'ì§€ì¶œ' í•©ê³„ë¥¼ ì‚¬ìš©
            let totalCost = 0;
            if (currentData.settlementRows && currentData.settlementRows.length > 0) {
                currentData.settlementRows.forEach(row => {
                    // expense í•„ë“œê°€ 'ì§€ì¶œ' ê¸ˆì•¡ì„
                    const expense = parseInt((row.expense || '0').replace(/[^0-9]/g, '')) || 0;
                    totalCost += expense;
                });
            }

            document.getElementById('dashTotalCost').innerText = totalCost.toLocaleString() + 'ì›';

            // Net Profit
            const netProfit = totalAmt - totalCost;
            document.getElementById('dashNetProfit').innerText = netProfit.toLocaleString() + 'ì›';
            if (netProfit < 0) document.getElementById('dashNetProfit').style.color = '#ff3b30';
            else document.getElementById('dashNetProfit').style.color = '#34c759';

            // Profit Rate
            let rate = 0;
            if (totalAmt > 0) rate = (netProfit / totalAmt) * 100;
            document.getElementById('dashProfitRate').innerText = rate.toFixed(1) + '%';
        }

        // Helper to calc total cost from global data
        function calculateTotalConstructionCost() {
            let total = 0;
            if (typeof categories !== 'undefined' && typeof globalCostData !== 'undefined') {
                categories.forEach(cat => {
                    const items = globalCostData['cost_' + cat.no] || [];
                    items.forEach(item => {
                        const qty = parseNumber(item.qty) || 0;
                        // Price logic matches loadCostData
                        let price = 0;
                        if (item.price) {
                            price = parseNumber(item.price);
                        } else {
                            price = (parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) + (parseNumber(item.expense) || 0);
                        }
                        total += (qty * price);
                    });
                });
            }
            return total;
        }

        function closeCostPasswordModal() {
            document.getElementById('costPasswordModal').classList.remove('show');
        }

        function checkCostPassword() {
            const input = document.getElementById('costAccessPin').value;
            if (input === COST_ACCESS_PIN) {
                isCostUnlocked = true;
                closeCostPasswordModal();

                // ì ê¸ˆ í•´ì œ ì‹œ íŒ¨ë„ ê°•ì œ í‘œì‹œ (ì´ˆê¸°í™” ì‹œ ìˆ¨ê²¨ì§„ ìƒíƒœ í•´ì œ)
                const costPanel = document.getElementById('panel-cost');
                if (costPanel) costPanel.style.display = '';

                showCustomerTab('cost'); // Retry opening the tab
                showToast('ì›ê°€ê´€ë¦¬í‘œ ì ‘ê·¼ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                document.getElementById('costAccessPin').value = '';
                document.getElementById('costAccessPin').focus();
            }
        }

        let scheduleRows = [];
        let defaultScheduleSteps = [];

        async function fetchScheduleTemplate() {
            try {
                // ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸° (Google Sheet: 'ê³µì‚¬ ìŠ¤ì¼€ì¤„ ê´€ë¦¬')
                const params = new URLSearchParams({ sheet: 'schedule_template' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const data = await response.json();

                let steps = [];
                if (Array.isArray(data)) {
                    steps = data;
                } else if (data && data.steps && Array.isArray(data.steps)) {
                    steps = data.steps;
                }

                // [Fix] Merged cells handling: Fill down empty categories
                let lastCategory = '';
                steps.forEach(step => {
                    if (step.category && String(step.category).trim() !== '') {
                        lastCategory = step.category;
                    } else if (lastCategory) {
                        step.category = lastCategory;
                    }
                });

                if (steps.length > 0) {
                    defaultScheduleSteps = steps;
                    console.log('âœ… ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ë¡œë“œ ì™„ë£Œ:', defaultScheduleSteps.length + 'ê°œ í•­ëª©');
                    console.log('ğŸ“‹ ì²« ë²ˆì§¸ í•­ëª© ìƒ˜í”Œ:', defaultScheduleSteps[0]);

                    // [ì‹ ê·œ] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì˜µì…˜ ë§ˆìŠ¤í„° ë¡œë“œ
                    await fetchSettlementMaster();

                    // ë§Œì•½ ì´ë¯¸ ìŠ¤ì¼€ì¤„ íƒ­ì´ë‚˜ ì •ì‚° íƒ­ì´ ì—´ë ¤ìˆê³  ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê°±ì‹ 
                    if (document.getElementById('panel-schedule').classList.contains('active')) {
                        renderScheduleTable();
                    }
                    if (document.getElementById('panel-settlement').classList.contains('active')) {
                        renderSettlementTable();
                    }
                } else {
                    console.warn('âš ï¸ ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ì´ ë¹„ì–´ìˆê±°ë‚˜ ë¡œë“œ ì‹¤íŒ¨. ê¸°ë³¸ê°’ ì‚¬ìš©.');
                    defaultScheduleSteps = [
                        { category: 'ê¸°íšÂ·í˜„ì¥ ì‚¬ì „ ì¤€ë¹„', name: 'ë””ìì¸ ìƒë‹´ ë° ì„¤ê³„', checkPoint: 'ì„¤ê³„ ë„ë©´ í™•ì • ì—¬ë¶€', inCharge: 'DESIGN JIG' }
                    ];
                }
            } catch (error) {
                console.error('âŒ ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ë¡œë“œ ì˜¤ë¥˜:', error);
                defaultScheduleSteps = [];
            }
        }

        function loadScheduleForCustomer(targetId) {
            // [Guard] Async Race Protection
            if (targetId && targetId !== currentCustomerId) return;

            // Notion í†µí•© ì œê±°ë¨

            if (currentData.schedules && currentData.schedules.length > 0) {
                scheduleRows = [...currentData.schedules];
            } else {
                // [ìˆ˜ì •] ì‹ ê·œ ê³ ê°ì€ ë¹ˆ ìŠ¤ì¼€ì¤„ë¡œ ì‹œì‘ (í…œí”Œë¦¿ ìë™ ë¡œë“œ X)
                scheduleRows = [];
            }

            // [ì¶”ê°€] ìŠ¤ì¼€ì¤„ ìƒë‹¨ ì •ë³´ ìë™ ì±„ìš°ê¸°
            if (document.getElementById('schPeriod')) {
                // 1. Static/Auto Fields
                document.getElementById('schPeriod').textContent = currentData.constructionPeriod || '';
                document.getElementById('schArea').textContent = currentData.area ? currentData.area + ' PY' : '';
                document.getElementById('schMoveDate').textContent = currentData.movingDate || '';

                // ê³µì‚¬ ì˜ë¢°ì¸ 1: ë©”ì¸ ê³ ê°
                const clientInfo = currentData.clientName ? (currentData.clientName + ' ê³ ê°ë‹˜' + (currentData.clientPhone ? ' (' + currentData.clientPhone + ')' : '')) : '';
                document.getElementById('schClient1').textContent = clientInfo;

                // ê³µì‚¬ ì˜ë¢°ì¸ 2: ë°°ìš°ì ì •ë³´ ìë™ ì±„ìš°ê¸°
                const client2Input = document.querySelector('.sch-input[data-field="client2"]');
                if (client2Input && currentData.spouseName) {
                    const spouseInfo = currentData.spouseName + (currentData.spousePhone ? ' (' + currentData.spousePhone + ')' : '');
                    if (!currentData.sch_client2) {
                        client2Input.value = spouseInfo;
                        currentData.sch_client2 = spouseInfo;
                    }
                }

                document.getElementById('schSiteAddr').textContent = currentData.siteAddress || '';

                // 2. Manager Input (Special handling)
                const managerInput = document.getElementById('schManagerInput');
                if (managerInput) {
                    if (!currentData.manager || currentData.manager.trim() === '') {
                        currentData.manager = 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)';
                    }
                    managerInput.value = currentData.manager;

                    managerInput.oninput = function () {
                        updateCustomerField('manager', this.value);
                    };
                    managerInput.onchange = function () {
                        updateCustomerField('manager', this.value);
                        saveCustomers();
                    };
                }

                // 3. Text Inputs (sch_*)
                document.querySelectorAll('.sch-input').forEach(input => {
                    const field = input.dataset.field;
                    if (field === 'manager') return; // Skip manager

                    const key = 'sch_' + field;
                    input.value = currentData[key] || '';

                    if (field === 'client2') {
                        input.addEventListener('input', function () {
                            this.value = this.value.replace(/(010)(\d{4})(\d{4})(?!\d)/g, '$1-$2-$3');
                        });
                    }

                    input.onchange = function () {
                        currentData[key] = this.value;
                        saveCustomers();
                    };
                });

                // 4. Radio Buttons (sch_*)
                const radioFields = ['permit_status', 'consent_status'];
                radioFields.forEach(field => {
                    const key = 'sch_' + field;
                    const savedValue = currentData[key];
                    const radios = document.querySelectorAll(`input[name="${field}"]`);

                    radios.forEach(radio => {
                        radio.checked = (radio.value === savedValue);
                        radio.onchange = function () {
                            if (this.checked) {
                                currentData[key] = this.value;
                                saveCustomers();
                            }
                        };
                    });
                });
            }
            renderScheduleTable();
            syncAllFields();
        }

        // [New] Dropdown Toggle Helper (Portal Version)
        window.toggleScheduleDropdown = function (btn, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }

            // Close existing portal if any
            const existingPortal = document.querySelector('.custom-dropdown-portal');
            if (existingPortal) {
                existingPortal.remove();
                // If clicking the same button, just close it
                if (existingPortal.dataset.triggerId === btn.id) return;
            }

            // Generate unique ID for button if not exists
            if (!btn.id) btn.id = 'dropdown-btn-' + Date.now() + Math.random().toString(36).substr(2, 9);

            const hiddenList = btn.nextElementSibling;
            if (!hiddenList) {
                console.warn('Dropdown list source not found');
                return;
            }

            // Create Portal
            const portal = document.createElement('div');
            portal.className = 'custom-dropdown-portal';
            portal.dataset.triggerId = btn.id;
            portal.innerHTML = hiddenList.innerHTML;

            // Style Portal
            const rect = btn.getBoundingClientRect();
            Object.assign(portal.style, {
                top: (rect.bottom + 2) + 'px', // Add slight gap
                left: rect.left + 'px',
                minWidth: Math.max(rect.width, 140) + 'px', // Ensure minimum width
                display: 'block'
            });

            document.body.appendChild(portal);
        };

        // Global click handler to close dropdown portal
        document.addEventListener('mousedown', function (e) {
            if (!e.target.closest('.custom-dropdown-portal') && !e.target.closest('.dropdown-toggle-btn')) {
                const portal = document.querySelector('.custom-dropdown-portal');
                if (portal) portal.remove();
            }
        });

        // Close on scroll to prevent detachment, but allow scrolling inside the dropdown itself
        window.addEventListener('scroll', function (e) {
            const portal = document.querySelector('.custom-dropdown-portal');
            if (portal && e.target !== portal && !portal.contains(e.target)) {
                portal.remove();
            }
        }, true);

        // [New] Dropdown Selection Helper
        window.selectScheduleOption = function (index, field, value) {
            const portal = document.querySelector('.custom-dropdown-portal');
            if (portal) portal.remove();

            // Update the data model logic
            if (field === 'category') {
                onScheduleCategoryChange(index, value);
            } else if (field === 'name') {
                onScheduleProcessChange(index, value);
            } else if (field === 'inCharge') {
                updateScheduleRow(index, 'inCharge', value);
                renderScheduleTable(); // Re-render to update UI consistency
                saveScheduleToCustomer();
            } else {
                updateScheduleRow(index, field, value);
                renderScheduleTable();
            }
        };

        // [New] Direct Input Handler (ContentEditable)
        window.updateScheduleRowContent = function (el, index, field) {
            if (scheduleRows[index]) {
                // Save rich text content
                scheduleRows[index][field] = el.innerHTML;
            }
        };

        function renderScheduleTable() {
            const tbody = document.getElementById('scheduleTableBody');
            const empty = document.getElementById('scheduleEmptyState');
            if (!tbody) return;

            if (scheduleRows.length === 0) {
                tbody.innerHTML = '';
                if (empty) empty.style.display = 'block';
                return;
            }

            if (empty) empty.style.display = 'none';

            // Extract unique values for dropdowns
            const categories = [...new Set(defaultScheduleSteps.map(s => s.category).filter(Boolean))];

            // [ìˆ˜ì •] ë‹´ë‹¹ì ëª©ë¡ ì¶”ì¶œ (ìœ ë‹ˆí¬)
            const managers = [...new Set(defaultScheduleSteps.map(s => s.inCharge).filter(Boolean))];

            // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë‹´ë‹¹ìê°€ ëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€ (ë°ì´í„° ë³´ì¡´ìš©)
            scheduleRows.forEach(row => {
                if (row.inCharge && !managers.includes(row.inCharge)) {
                    managers.push(row.inCharge);
                }
            });

            tbody.innerHTML = scheduleRows.map((row, index) => {
                // í˜„ì¬ í–‰ì˜ ì¹´í…Œê³ ë¦¬ë¡œ ê³µì •ëª… í•„í„°ë§
                const processes = defaultScheduleSteps.filter(s => s.category === row.category);

                // [ìˆ˜ì •] ê³µì •ëª… ì¤‘ë³µ ì œê±° (ìˆœìˆ˜ ì´ë¦„ë§Œ í‘œì‹œ)
                const uniqueProcessNames = [...new Set(processes.map(p => p.name))];

                // [ìˆ˜ì •] ë‹´ë‹¹ì ëª©ë¡ ë™ì  í•„í„°ë§ (ì¹´í…Œê³ ë¦¬+ê³µì •ëª… ì¢…ì†)
                let availableManagers = [];
                if (row.category && row.name) {
                    // ì¹´í…Œê³ ë¦¬ì™€ ê³µì •ëª…ì´ ì„ íƒëœ ê²½ìš° -> í•´ë‹¹ ì¡°í•©ì˜ ë‹´ë‹¹ìë“¤ë§Œ ì¶”ì¶œ
                    availableManagers = defaultScheduleSteps
                        .filter(s => s.category === row.category && s.name === row.name)
                        .map(s => s.inCharge)
                        .filter(Boolean);
                }

                // ë§Œì•½ í•„í„°ë§ëœ ë‹´ë‹¹ìê°€ ì—†ë‹¤ë©´(ë˜ëŠ” ê³µì •ëª… ë¯¸ì„ íƒ), ì „ì²´ ë‹´ë‹¹ì í’€ì„ ë³´ì—¬ì¤„ì§€ ê²°ì •í•´ì•¼ í•¨
                // ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­: "3ê°œë§Œ ë³´ì—¬ì•¼ì§€" -> ê³µì •ëª…ì´ ì„ íƒë˜ì—ˆë‹¤ë©´ ì¢í˜€ì„œ ë³´ì—¬ì£¼ëŠ” ê²Œ í•µì‹¬
                // ê³µì •ëª…ì´ ì•„ì§ ì•ˆ ì •í•´ì¡Œë‹¤ë©´, ì „ì²´ ëª©ë¡ ë…¸ì¶œ (ìœ ì—°ì„±)
                if (availableManagers.length === 0 && !row.name) {
                    availableManagers = defaultScheduleSteps.map(s => s.inCharge).filter(Boolean);
                }

                // ì¤‘ë³µ ì œê±°
                availableManagers = [...new Set(availableManagers)];

                // í˜„ì¬ ì…ë ¥ëœ ë‹´ë‹¹ìê°€ ëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
                if (row.inCharge && !availableManagers.includes(row.inCharge)) {
                    availableManagers.push(row.inCharge);
                }

                // Helper to render editable dropdown cell
                const renderEditableDropdown = (value, options, fieldName, index, placeholder = '') => {
                    const listHtml = options.map(opt =>
                        `<div class="custom-dropdown-item ${value === opt ? 'selected' : ''}" 
                              onmousedown="selectScheduleOption(${index}, '${fieldName}', '${opt}')">${opt}</div>`
                    ).join('');

                    return `
                        <div class="editable-cell-wrapper">
                            <div contenteditable="false" class="text-formattable editable-content" 
                                 style="text-align:center;"
                                 onmousedown="event.stopPropagation();"
                                 ondblclick="this.contentEditable=true;this.focus();"
                                 onkeydown="if(event.key==='Escape'){
                                     this.contentEditable=false;
                                     this.blur();
                                     toggleScheduleDropdown(this.nextElementSibling, event);
                                 }"
                                 oninput="updateScheduleRowContent(this, ${index}, '${fieldName}')"
                                 onblur="this.contentEditable=false;saveScheduleToCustomer()"
                                 placeholder="${placeholder}">${value || ''}</div>
                            <button class="dropdown-toggle-btn no-print" onmousedown="toggleScheduleDropdown(this, event)">â–¼</button>
                            <div class="custom-dropdown-list-source" style="display:none;">
                                ${listHtml}
                            </div>
                        </div>
                    `;
                };

                // Helper for plain editable cell (Checkpoint, Memo)
                const renderEditableCell = (value, fieldName, index, placeholder = '', textAlign = 'left') => {
                    return `
                        <div contenteditable="false" class="text-formattable editable-content"
                             style="text-align:${textAlign};"
                             onmousedown="event.stopPropagation();"
                             ondblclick="this.contentEditable=true;this.focus();"
                             onkeydown="if(event.key==='Escape'){this.contentEditable=false;this.blur();}"
                             oninput="updateScheduleRowContent(this, ${index}, '${fieldName}')"
                             onblur="this.contentEditable=false;saveScheduleToCustomer()"
                             placeholder="${placeholder}">${value || ''}</div>
                    `;
                };

                return `
    <tr draggable="true" ondragstart="handleDragStart(event, ${index})" ondragover="handleDragOver(event)"
        ondrop="handleDrop(event, ${index})" ondragend="handleDragEnd(event)"
        style="cursor:move; transition: background 0.2s;">
        <td class="no-print" style="text-align:center; padding:5px; border:1px solid #d2d2d7;">
             <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                <button onclick="removeScheduleRow(${index})" class="no-print" 
                    style="width:22px; height:22px; background:#ff3b30; color:white; border:none; border-radius:50%; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; line-height:1;"
                    title="ì‚­ì œ">âˆ’</button>
                <span style="font-size:12px; color:#333;">${index + 1}</span>
             </div>
        </td>
        <!-- Print Index (displayed only when printing) -->
        <td class="print-only-cell" style="text-align:center; padding:10px; border:1px solid #d2d2d7; font-size:12px; display:none;">${index + 1}</td>

        <!-- Category -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.category, categories, 'category', index, 'ì„ íƒ')}
        </td>

        <!-- Process Name -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.name, uniqueProcessNames, 'name', index, 'ê³µì •ëª…')}
        </td>

        <!-- Checkpoint -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableCell(row.checkPoint, 'checkPoint', index, 'ì²´í¬í¬ì¸íŠ¸')}
        </td>

        <td style="padding:5px; border:1px solid #d2d2d7;">
            <input type="date" value="${(row.start || '').replace(/\./g, '-')}" class="customer-field"
                style="width:100%; border:none; background:transparent; font-size:12px; padding:5px; text-align:center;"
                onchange="handleStartDateChange(${index}, this.value)">
        </td>
        <td style="padding:5px; border:1px solid #d2d2d7;">
            <input type="date" value="${(row.end || '').replace(/\./g, '-')}" class="customer-field"
                style="width:100%; border:none; background:transparent; font-size:12px; padding:5px; text-align:center;"
                onchange="updateScheduleRow(${index}, 'end', this.value)">
        </td>
        
        <!-- Manager -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableDropdown(row.inCharge, availableManagers, 'inCharge', index, 'ë‹´ë‹¹ì')}
        </td>
        
        <!-- Memo -->
        <td style="padding:5px; border:1px solid #d2d2d7;">
            ${renderEditableCell(row.memo, 'memo', index, 'ë¹„ê³ ', 'center')}
        </td>
    </tr>
                `;
            }).join('');
        }

        function addScheduleRow() {
            // ë¹ˆ í–‰ ì¶”ê°€ (ê²¬ì ì„œ ë°©ì‹)
            scheduleRows.push({
                id: Date.now() + Math.random(),
                category: '',
                name: '',
                checkPoint: '',
                start: '',
                end: '',
                inCharge: '', // [ìˆ˜ì •] ê¸°ë³¸ê°’ ì—†ìŒ
                memo: ''
            });
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ê³µì •ëª… í•„í„°ë§ (ê²¬ì ì„œ íŒ¨í„´ ì°¸ì¡°)
        function onScheduleCategoryChange(rowIndex, category) {
            if (!scheduleRows[rowIndex]) return;

            // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ê³µì •ëª…, ì²´í¬í¬ì¸íŠ¸ ì´ˆê¸°í™”
            scheduleRows[rowIndex].category = category;
            scheduleRows[rowIndex].name = '';
            scheduleRows[rowIndex].checkPoint = '';
            // [ì¶”ê°€] ë‹´ë‹¹ìë„ ê°™ì´ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ¬ì›€
            scheduleRows[rowIndex].inCharge = '';

            // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§ (í•„í„°ë§ëœ ê³µì •ëª… ë“œë¡­ë‹¤ìš´ í‘œì‹œ)
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // ê³µì •ëª… ì„ íƒ ì‹œ ì²´í¬í¬ì¸íŠ¸/ë‹´ë‹¹ì ì—°ë™
        function onScheduleProcessChange(rowIndex, processName) {
            if (!scheduleRows[rowIndex]) return;

            scheduleRows[rowIndex].name = processName;

            // ê³µì •ëª…ì„ ë°”ê¿¨ìœ¼ë¯€ë¡œ ë‹´ë‹¹ìë„ ì´ˆê¸°í™” (ë‹¤ì‹œ ì„ íƒ ìœ ë„)
            scheduleRows[rowIndex].inCharge = '';

            if (!processName) {
                scheduleRows[rowIndex].checkPoint = '';
                renderScheduleTable();
                saveScheduleToCustomer();
                return;
            }

            // ì„ íƒëœ ê³µì •ëª…ì— í•´ë‹¹í•˜ëŠ” í›„ë³´êµ° ì°¾ê¸°
            const candidates = defaultScheduleSteps.filter(s =>
                s.category === scheduleRows[rowIndex].category && s.name === processName
            );

            if (candidates.length > 0) {
                // ì²´í¬í¬ì¸íŠ¸ëŠ” ì²« ë²ˆì§¸ í›„ë³´ì˜ ê²ƒì„ ë”°ë¦„ (ë³´í†µ ë™ì¼í•˜ë¯€ë¡œ)
                scheduleRows[rowIndex].checkPoint = candidates[0].checkPoint || '';

                // [ìˆ˜ì •] ë§Œì•½ ê°€ëŠ¥í•œ ë‹´ë‹¹ìê°€ ë”± 1ëª…ì´ë¼ë©´ ìë™ ì„ íƒ
                // 2ëª… ì´ìƒì´ë©´ ë¹ˆ ê°’ìœ¼ë¡œ ë‘ì–´ ì‚¬ìš©ìê°€ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒí•˜ê²Œ í•¨ (B.R, S.T, T.W ì¤‘ íƒ1)
                const distinctManagers = [...new Set(candidates.map(c => c.inCharge).filter(Boolean))];
                if (distinctManagers.length === 1) {
                    scheduleRows[rowIndex].inCharge = distinctManagers[0];
                }
            }

            renderScheduleTable();
            saveScheduleToCustomer();
        }

        // ìœ ì˜ì‚¬í•­ í…ìŠ¤íŠ¸ ì¶”ì¶œ í•¨ìˆ˜ (ë…¸ì…˜ ì—°ë™ìš©)
        function getScheduleGuidelinesText() {
            const list = document.getElementById('scheduleGuidelinesList');
            if (!list) return '';
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).join('\n');
        }

        function getASGuidelinesText() {
            const list = document.getElementById('asGuidelinesList');
            if (!list) return '';
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).join('\n');
        }

        // [ì¶”ê°€] ìœ ì˜ì‚¬í•­ì„ ë°°ì—´ë¡œ ë°˜í™˜ (ë…¸ì…˜ ì½œì•„ì›ƒìš©)
        function getScheduleGuidelinesArray() {
            const list = document.getElementById('scheduleGuidelinesList');
            if (!list) return [];
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).filter(t => t);
        }

        function getASGuidelinesArray() {
            const list = document.getElementById('asGuidelinesList');
            if (!list) return [];
            const items = list.querySelectorAll('li');
            return Array.from(items).map(li => li.textContent.trim()).filter(t => t);
        }

        // ìŠ¤ì¼€ì¤„ ìœ ì˜ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸° (êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ)
        async function loadScheduleGuidelines() {
            try {
                const params = new URLSearchParams({
                    sheet: 'ê³µì‚¬ìŠ¤ì¼€ì¤„ê´€ë¦¬', // ì•±ìŠ¤ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë„ì–´ì“°ê¸° ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•¨
                    action: 'getGuidelines'
                });

                // 3ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì • (ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¬ì§€ ì•Šê²Œ)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);

                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`, { signal: controller.signal });
                clearTimeout(timeoutId);

                const result = await response.json();

                if (result.success && result.guidelines && result.guidelines.length > 0) {
                    const guidelinesList = document.getElementById('scheduleGuidelinesList');
                    if (guidelinesList) {
                        guidelinesList.innerHTML = result.guidelines.map(item => `<li>${item}</li>`).join('');
                        showPersistentAlert('ê³µì‚¬ ìŠ¤ì¼€ì¤„ ìœ ì˜ì‚¬í•­ì„\nì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                    }
                } else {
                    throw new Error(result.error || 'No guidelines found');
                }
            } catch (error) {
                console.warn('âŒ ì„œë²„ ìœ ì˜ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ ë°±ì—… ë°ì´í„° ì‚¬ìš©:', error);

                // [ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ë°±ì—… ë°ì´í„°]
                // ë°°í¬ ë¬¸ì œë¡œ ì„œë²„ í†µì‹ ì´ ì•ˆ ë  ê²½ìš° ì´ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                const localBackupGuidelines = [
                    "ê³µì‚¬ ê¸°ê°„ ì¤‘ì—ëŠ” ì•ˆì „ì‚¬ê³  ì˜ˆë°©ì„ ìœ„í•´ í˜„ì¥ ì¶œì…ì´ ì œí•œë  ìˆ˜ ìˆìœ¼ë©°, ì‘ì—… êµ¬ê°„ ì¶œì…ì€ ì‚¼ê°€ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.",
                    "ê³µì • íŠ¹ì„±ìƒ ì†ŒìŒ, ë¶„ì§„, ëƒ„ìƒˆê°€ ë°œìƒí•  ìˆ˜ ìˆê³ , ì¼ì • ì‹œê°„ëŒ€ì—ëŠ” ì‘ì—…ì´ ì§‘ì¤‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "ê³µì‚¬ ì¤‘ ì¶”ê°€ ìš”ì²­ì´ë‚˜ ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ê²½ìš°, ê³µì • ë° ë¹„ìš©ì— ì˜í–¥ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë°˜ë“œì‹œ ë‹´ë‹¹ìì™€ ë¨¼ì € í˜‘ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
                    "ê³µì • ì™„ë£Œ í›„ì—ëŠ” ë‹¤ìŒ ê³µì •ì„ ìœ„í•´ í˜„ì¥ ì •ë¦¬ ë° ì–‘ìƒ ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ê¸°ê°„ ë™ì•ˆ í˜„ì¥ ì¶œì…ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                ];

                const guidelinesList = document.getElementById('scheduleGuidelinesList');
                if (guidelinesList) {
                    guidelinesList.innerHTML = localBackupGuidelines.map(item => `<li>${item}</li>`).join('');
                    showPersistentAlert('ì„œë²„ ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•Šì•„\nê¸°ë³¸ ìœ ì˜ì‚¬í•­ì„ í‘œì‹œí•©ë‹ˆë‹¤.\n(ë¡œì»¬ ëª¨ë“œ)', 'warning');
                }
            }
        }

        // A/S ìœ ì˜ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸° (êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ)
        async function loadASGuidelines() {
            try {
                const params = new URLSearchParams({
                    sheet: 'ASê´€ë¦¬ë¦¬ìŠ¤íŠ¸',
                    action: 'getGuidelines'
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.success && result.guidelines && result.guidelines.length > 0) {
                    const guidelinesList = document.getElementById('asGuidelinesList');
                    if (guidelinesList) {
                        guidelinesList.innerHTML = result.guidelines.map(item => `<li>${item}</li>`).join('');
                        showPersistentAlert('A/S ê´€ë¦¬ ìœ ì˜ì‚¬í•­ì„\nì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                    }
                } else if (result.success) {
                    showPersistentAlert('ë¶ˆëŸ¬ì˜¬ ìœ ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                } else {
                    showPersistentAlert('ìœ ì˜ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' + (result.error || ''), 'error');
                }
            } catch (error) {
                console.error('Error loading AS guidelines:', error);
                showPersistentAlert('ìœ ì˜ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' + error.message, 'error');
            }
        }

        function showScheduleTemplateModal() {
            const modal = document.createElement('div');
            modal.id = 'scheduleTemplateModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 24px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            `;

            // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶”ì¶œ
            const categories = [...new Set(defaultScheduleSteps.map(s => s.category).filter(Boolean))];
            const categoryOptions = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            modalContent.innerHTML = `
                <h3 style="margin: 0 0 16px 0; font-size: 18px; color: #333;">ğŸ“‹ ê³µì • ì„ íƒ</h3>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; color: #666; margin-bottom: 6px;">ì¹´í…Œê³ ë¦¬ (í´ë¦­í•˜ì—¬ ì„ íƒ)</label>
                    <select id="categorySelect" onchange="updateProcessOptions()" size="14" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 6px; outline: none;">
                        <option value="__CUSTOM__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥ (ë¹ˆ í–‰ ì¶”ê°€)</option>
                        ${categoryOptions}
                    </select>
                </div>

                <div id="processSelectContainer" style="margin-bottom: 16px; display: none;">
                    <label style="display: block; font-size: 13px; color: #666; margin-bottom: 6px;">ì„¸ë¶€ ê³µì •ëª… (í´ë¦­í•˜ì—¬ ì„ íƒ)</label>
                    <select id="processSelect" size="10" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ddd; border-radius: 6px; outline: none;">
                    </select>
                </div>

                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button onclick="closeScheduleTemplateModal()" style="padding: 8px 16px; background: #f0f0f0; border: none; border-radius: 6px; cursor: pointer;">ì·¨ì†Œ</button>
                    <button id="addScheduleBtn" onclick="addScheduleFromTemplate()" style="padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer;" disabled>ì¶”ê°€</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeScheduleTemplateModal();
                }
            });
        }

        function updateProcessOptions() {
            const categorySelect = document.getElementById('categorySelect');
            const processSelectContainer = document.getElementById('processSelectContainer');
            const processSelect = document.getElementById('processSelect');
            const addBtn = document.getElementById('addScheduleBtn');
            const selectedCategory = categorySelect.value;

            if (selectedCategory === '__CUSTOM__') {
                // ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ
                processSelectContainer.style.display = 'none';
                addBtn.disabled = false;
            } else if (selectedCategory) {
                // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ê³µì •ë“¤ í•„í„°ë§
                const processes = defaultScheduleSteps.filter(s => s.category === selectedCategory);
                const processOptions = processes.map((proc, idx) =>
                    `<option value="${idx}" data-category="${selectedCategory}">${proc.name}</option>`
                ).join('');

                processSelect.innerHTML = processOptions;

                // size ì†ì„± ë™ì  ì¡°ì • (ìµœì†Œ 3, ìµœëŒ€ 10)
                const optionCount = processes.length;
                processSelect.setAttribute('size', Math.min(Math.max(optionCount, 3), 10));

                processSelectContainer.style.display = 'block';
                addBtn.disabled = true;

                // ê³µì • ì„ íƒ ì‹œ ì¶”ê°€ ë²„íŠ¼ í™œì„±í™”
                processSelect.onchange = function () {
                    addBtn.disabled = !this.value;
                };
            } else {
                // ì„ íƒ ì•ˆí•¨
                processSelectContainer.style.display = 'none';
                addBtn.disabled = true;
            }
        }

        function closeScheduleTemplateModal() {
            const modal = document.getElementById('scheduleTemplateModal');
            if (modal) {
                modal.remove();
            }
        }

        function addScheduleFromTemplate() {
            const categorySelect = document.getElementById('categorySelect');
            const processSelect = document.getElementById('processSelect');
            const selectedCategory = categorySelect.value;

            let newRow;

            if (selectedCategory === '__CUSTOM__') {
                // ë¹ˆ í–‰ ì¶”ê°€
                newRow = {
                    id: Date.now() + Math.random(),
                    category: '',
                    name: '',
                    checkPoint: '',
                    start: '',
                    end: '',
                    inCharge: currentData.manager || 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)',
                    memo: ''
                };
            } else {
                // ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ ê³µì • ì°¾ê¸°
                const processes = defaultScheduleSteps.filter(s => s.category === selectedCategory);
                const selectedIndex = parseInt(processSelect.value);
                const template = processes[selectedIndex];

                if (template) {
                    // ë‹´ë‹¹ì ìš°ì„ ìˆœìœ„: 1. í…œí”Œë¦¿ ë‹´ë‹¹ì, 2. í˜„ì¬ ê³ ê° ë‹´ë‹¹ì, 3. ê¸°ë³¸ê°’ "ì›í”„ë¡œ ì†Œì¥"
                    let inChargeValue = 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)';
                    if (template.inCharge && template.inCharge.trim()) {
                        inChargeValue = template.inCharge;
                    } else if (currentData.manager && currentData.manager.trim()) {
                        inChargeValue = currentData.manager;
                    }

                    newRow = {
                        id: Date.now() + Math.random(),
                        category: template.category || '',
                        name: template.name || '',
                        checkPoint: template.checkPoint || '',
                        start: '',
                        end: '',
                        inCharge: inChargeValue,
                        memo: ''
                    };

                    console.log('ğŸ“Œ ê³µì • ì¶”ê°€:', newRow);
                }
            }

            if (newRow) {
                scheduleRows.push(newRow);
                renderScheduleTable();
                saveScheduleToCustomer();
                closeScheduleTemplateModal();
            }
        }

        function removeScheduleRow(index) {
            scheduleRows.splice(index, 1);
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        function updateScheduleRow(index, field, value) {
            scheduleRows[index][field] = value;
            saveScheduleToCustomer();
        }

        // ì‹œì‘ì¼ ë³€ê²½ ì‹œ ì¢…ë£Œì¼ ìë™ ì±„ìš°ê¸°
        function handleStartDateChange(index, value) {
            scheduleRows[index]['start'] = value;

            // ì¢…ë£Œì¼ì´ ë¹„ì–´ìˆìœ¼ë©´ ì‹œì‘ì¼ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
            if (!scheduleRows[index]['end'] && value) {
                scheduleRows[index]['end'] = value;
                renderScheduleTable(); // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ì¢…ë£Œì¼ í‘œì‹œ
            }

            saveScheduleToCustomer();
        }

        function moveScheduleRow(index, delta) {
            const newIndex = index + delta;
            if (newIndex < 0 || newIndex >= scheduleRows.length) return;
            const item = scheduleRows.splice(index, 1)[0];
            scheduleRows.splice(newIndex, 0, item);
            renderScheduleTable();
            saveScheduleToCustomer();
        }

        function saveScheduleToCustomer() {
            currentData.schedules = [...scheduleRows];
            syncAllFields();
        }

        // [New] A/S List Logic
        let asListRows = [];

        function loadASList(targetId) {
            // [Guard] Async Race Protection
            if (targetId && targetId !== currentCustomerId) return;

            if (currentData && currentData.as_list) {
                asListRows = currentData.as_list;
            } else {
                asListRows = []; // Start empty for new selection
            }
            renderASListTable();
            updateASInfoHeaders();
        }

        function updateASInfoHeaders() {
            // Manually sync fields in A/S header (since syncAllFields might not target these specific IDs if they are refreshed or not caught)
            // But they use 'data-sync' class, so syncAllFields() handles them IF called.
            // Let's call syncAllFields() just in case OR just handle the specific ID for bathroom leak.
            // We'll rely on syncAllFields() for the standard ones, but calculate bathroom leak.

            // Calculate Bathroom Leak A/S (General A/S + 18 months)
            const leakEl = document.getElementById('bathroomLeakWarranty');
            if (leakEl) {
                let endDate = currentData.asEndDate || '';
                // If no asEndDate, try to parse from warrantyPeriod string if it ends with date
                if (!endDate && currentData.warrantyPeriod) {
                    // Try to match date pattern like "~YY.MM.DD" or "~YYYY.MM.DD" or "YYYY.MM.DD"
                    const matches = currentData.warrantyPeriod.match(/(\d{2,4})[-\.](\d{2})[-\.](\d{2})$/);
                    if (matches) {
                        // Reconstruct full date
                        let year = parseInt(matches[1]);
                        if (year < 100) year += 2000;
                        const month = matches[2];
                        const day = matches[3];
                        endDate = `${year}-${month}-${day}`;
                    }
                }

                if (endDate) {
                    try {
                        const date = new Date(endDate);
                        if (!isNaN(date.getTime())) {
                            // Add 18 months
                            date.setMonth(date.getMonth() + 18);

                            // Format
                            const yy = String(date.getFullYear()).slice(-2);
                            const mm = String(date.getMonth() + 1).padStart(2, '0');
                            const dd = String(date.getDate()).padStart(2, '0');
                            leakEl.textContent = `~${yy}.${mm}.${dd}`;
                        } else {
                            leakEl.textContent = '-';
                        }
                    } catch (e) {
                        leakEl.textContent = '-';
                    }
                } else {
                    leakEl.textContent = '-';
                }
            }
        }

        function addASListItem() {
            asListRows.push({
                category: '',
                brand: '',
                item: '',
                modelNum: '',
                size: '',
                price: '',
                service: '',
                warranty: '',
                note: ''
            });
            renderASListTable();
            saveASList();
        }

        // [New] A/S DB Mock Data (Initialize global)
        // Global A/S DB
        let AS_DB = [];

        function fetchASListDB() {
            if (AS_DB && AS_DB.length > 0) return; // Already loaded

            fetch(CUSTOMER_SYNC_URL + '?sheet=as_list')
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success' && Array.isArray(data.items)) {
                        AS_DB = data.items;
                        console.log('âœ… A/S DB Loaded:', AS_DB.length + ' items');
                        renderASListTable(); // Re-render if table is open
                    } else {
                        console.error('âŒ Failed to load A/S DB or invalid format:', data);
                        AS_DB = []; // Ensure it remains an array
                    }
                })
                .catch(err => {
                    console.error('âŒ Error fetching A/S DB:', err);
                    AS_DB = []; // Ensure it remains an array on error
                });
        }

        function renderASListTable() {
            const tbody = document.getElementById('asListTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            // Extract unique categories from AS_DB
            const categories = [...new Set(AS_DB.map(item => item.category).filter(Boolean))];

            asListRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.setAttribute('draggable', 'true');
                tr.ondragstart = (e) => handleASDragStart(e, index);
                tr.ondragover = (e) => handleASDragOver(e);
                tr.ondrop = (e) => handleASDrop(e, index);
                tr.ondragend = (e) => handleASDragEnd(e);
                tr.style.cursor = 'move';
                tr.style.transition = 'background 0.2s';

                // Category Options
                const categoryOptions = categories.map(c =>
                    `<option value="${c}" ${row.category === c ? 'selected' : ''}>${c}</option>`
                ).join('');

                // Brand Options (Filtered by Category)
                let brandOptions = '<option value="">ì„ íƒ</option>';
                if (row.category) {
                    const brands = [...new Set(AS_DB.filter(d => d.category === row.category).map(d => d.brand).filter(Boolean))];
                    brandOptions += brands.map(b =>
                        `<option value="${b}" ${row.brand === b ? 'selected' : ''}>${b}</option>`
                    ).join('');
                } else {
                    brandOptions = '<option value="">ì¹´í…Œê³ ë¦¬ ë¨¼ì € ì„ íƒ</option>';
                }

                // Item Options (Filtered by Category AND Brand)
                let itemOptions = '<option value="">ì„ íƒ</option>';
                if (row.category && row.brand) {
                    const items = [...new Set(AS_DB.filter(d => d.category === row.category && d.brand === row.brand).map(d => d.item).filter(Boolean))];
                    itemOptions += items.map(i =>
                        `<option value="${i}" ${row.item === i ? 'selected' : ''}>${i}</option>`
                    ).join('');
                } else {
                    itemOptions = '<option value="">ë¸Œëœë“œ ë¨¼ì € ì„ íƒ</option>';
                }

                tr.innerHTML = `
                    <td class="no-print" style="text-align:center; padding:5px; border:1px solid #d2d2d7;">
                        <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                            <button onclick="removeASListRow(${index})" class="no-print" 
                                style="width:22px; height:22px; background:#ff3b30; color:white; border:none; border-radius:50%; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; line-height:1;"
                                title="ì‚­ì œ">âˆ’</button>
                            <span style="font-size:12px; color:#333;">${index + 1}</span>
                        </div>
                    </td>
                    <!-- Print Index (displayed only when printing) -->
                    <td class="print-only-cell" style="text-align:center; padding:10px; border:1px solid #d2d2d7; font-size:12px; display:none;">${index + 1}</td>

                    <!-- Category (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <select class="mh-input" onchange="updateASCategory(${index}, this.value)"
                             style="width:100%; border:none; outline:none; text-align:center; background:transparent;">
                             <option value="">ì„ íƒ</option>
                             ${categoryOptions}
                         </select>
                    </td>
                    <!-- Brand (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select class="mh-input" onchange="updateASBrand(${index}, this.value)"
                             style="width:100%; border:none; outline:none; text-align:center; background:transparent;">
                             ${brandOptions}
                         </select>
                    </td>
                    <!-- Item (Dropdown) -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select class="mh-input" onchange="updateASItem(${index}, this.value)"
                            style="width:100%; border:none; outline:none; background:transparent;">
                            ${itemOptions}
                        </select>
                    </td>
                    <!-- ModelNum -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" class="mh-input" value="${row.modelNum || ''}" 
                            onchange="updateASListRow(${index}, 'modelNum', this.value)"
                            style="width:100%; border:none; outline:none;">
                    </td>
                     <!-- Size -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" class="mh-input" value="${row.size || ''}" 
                            onchange="updateASListRow(${index}, 'size', this.value)"
                            style="width:100%; border:none; outline:none; text-align:center;">
                    </td>
                     <!-- Service -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" class="mh-input" value="${row.service || ''}" 
                             onchange="updateASListRow(${index}, 'service', this.value)"
                             style="width:100%; border:none; outline:none; text-align:center;">
                    </td>
                    <!-- Warranty -->
                    <td style="padding:0; border:1px solid #d2d2d7; position: relative; height: 40px;">
                        <input type="text" class="mh-input" value="${row.warranty || ''}" 
                            id="warrantyInput_${index}"
                            onchange="updateASListRow(${index}, 'warranty', this.value)"
                            style="width:100%; height:100%; border:none; outline:none; text-align:center; font-weight:bold; background: transparent; padding-right: 25px;">
                        
                        <!-- ìŠ¤ì¼€ì¤„ ì—°ë™ ë“œë¡­ë‹¤ìš´ (ì•„ì´ì½˜ìœ¼ë¡œ ìˆ¨ê¹€) -->
                        <div style="position: absolute; right: 4px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; overflow: hidden;" class="no-print">
                            <div style="font-size:14px; cursor:pointer; text-align:center; line-height:20px;">ğŸ“…</div>
                            <select onchange="applyScheduleToWarranty(${index}, this.value); this.value='';"
                                style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
                                <option value="">ìŠ¤ì¼€ì¤„ ì„ íƒ</option>
                                ${getScheduleOptions()}
                            </select>
                        </div>
                    </td>
                    <!-- Note -->
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" class="mh-input" value="${row.note || ''}" 
                             onchange="updateASListRow(${index}, 'note', this.value)"
                             style="width:100%; border:none; outline:none;">
                    </td>
                 `;
                tbody.appendChild(tr);
            });
        }

        let draggedASIndex = null;
        function handleASDragStart(e, index) {
            draggedASIndex = index;
            e.target.style.opacity = '0.4';
        }
        function handleASDragEnd(e) {
            e.target.style.opacity = '1';
            draggedASIndex = null;
        }
        function handleASDragOver(e) {
            e.preventDefault();
        }
        function handleASDrop(e, index) {
            e.preventDefault();
            if (draggedASIndex === null || draggedASIndex === index) return;
            // Move item in array
            const item = asListRows.splice(draggedASIndex, 1)[0];
            asListRows.splice(index, 0, item);
            renderASListTable();
            saveASList();
        }

        function updateASCategory(index, category) {
            asListRows[index].category = category;
            asListRows[index].brand = ''; // Reset brand
            asListRows[index].item = ''; // Reset item
            asListRows[index].modelNum = '';
            asListRows[index].size = '';
            asListRows[index].price = '';
            asListRows[index].service = '';
            asListRows[index].warranty = '';
            // Note: Don't clear note if user typed one? Or reset? Usually reset if everything changes.
            asListRows[index].note = '';

            saveASList();
            renderASListTable();
        }

        function updateASBrand(index, brand) {
            asListRows[index].brand = brand;
            asListRows[index].item = ''; // Reset item
            asListRows[index].modelNum = '';
            asListRows[index].size = '';
            asListRows[index].price = '';
            asListRows[index].service = '';
            asListRows[index].warranty = '';
            asListRows[index].note = '';

            saveASList();
            renderASListTable();
        }

        function updateASItem(index, itemName) {
            if (!itemName) {
                asListRows[index].item = '';
                // Don't reset Brand/Category
                asListRows[index].modelNum = '';
                asListRows[index].size = '';
                asListRows[index].price = '';
                asListRows[index].service = '';
                asListRows[index].warranty = '';
                asListRows[index].note = '';
                saveASList();
                renderASListTable();
                return;
            }

            // Find selected item in DB (matching category and brand)
            const selectedData = AS_DB.find(d =>
                d.category === asListRows[index].category &&
                d.brand === asListRows[index].brand &&
                d.item === itemName
            );

            if (selectedData) {
                asListRows[index].item = selectedData.item;
                asListRows[index].modelNum = selectedData.modelNum;
                asListRows[index].size = selectedData.size;
                asListRows[index].price = selectedData.price;
                asListRows[index].service = selectedData.service;
                asListRows[index].warranty = selectedData.warranty;
                asListRows[index].note = selectedData.note;
            }
            saveASList();
            renderASListTable();
        }

        function getScheduleOptions() {
            // Use currentData.schedules if scheduleRows is empty
            const schedules = (scheduleRows && scheduleRows.length > 0) ? scheduleRows : (currentData.schedules || []);

            let options = '';
            // [ì¶”ê°€] ì”ê¸ˆì¼ ì˜µì…˜
            if (currentData.finalPaymentDate) {
                options += `<option value="balanceDate" style="color:#0071e3; font-weight:bold;">ì”ê¸ˆì¼ (${currentData.finalPaymentDate})</option>`;
            }

            options += schedules.map((sch, idx) => {
                const name = sch.name || 'ì´ë¦„ ì—†ìŒ';
                const end = sch.end || '';
                if (!end) return '';
                return `<option value="${end}">${name}</option>`;
            }).join('');

            return options;
        }

        function applyScheduleToWarranty(index, endDate) {
            if (!endDate) return;

            // [ì¶”ê°€] ì”ê¸ˆì¼ ì„ íƒ ì‹œ (ì†ì„±ëª… ìˆ˜ì •: balanceDate -> finalPaymentDate)
            if (endDate === 'balanceDate') {
                endDate = currentData.finalPaymentDate;
            }

            // 1. Find the original warranty duration from AS_DB
            const row = asListRows[index];
            const dbItem = AS_DB.find(d =>
                d.category === row.category &&
                d.brand === row.brand &&
                d.item === row.item
            );

            // Default to '1ë…„' if not found or empty
            const durationStr = (dbItem && dbItem.warranty) ? dbItem.warranty : '1ë…„';

            try {
                // endDate format: YYYY-MM-DD
                const date = new Date(endDate);

                // 2. Parse duration string (e.g., "1ë…„", "2ë…„", "6ê°œì›”")
                let addYears = 0;
                let addMonths = 0;

                const yearMatch = durationStr.match(/(\d+)\s*ë…„/);
                const monthMatch = durationStr.match(/(\d+)\s*ê°œì›”/);

                addYears = yearMatch ? parseInt(yearMatch[1]) : 0;
                addMonths = monthMatch ? parseInt(monthMatch[1]) : 0;

                // Fallback: If no recognized format, default to 1 year
                if (addYears === 0 && addMonths === 0) {
                    addYears = 1;
                }

                // 3. Calculate new date
                date.setFullYear(date.getFullYear() + addYears);
                date.setMonth(date.getMonth() + addMonths);

                // 4. Format: ~YY.MM.DD
                const yy = String(date.getFullYear()).slice(-2);
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                const warrantyText = `~${yy}.${mm}.${dd}`;

                // 5. Update state and UI
                asListRows[index].warranty = warrantyText;
                const inputEl = document.getElementById(`warrantyInput_${index}`);
                if (inputEl) inputEl.value = warrantyText;

                saveASList();
                showToast(`ë³´ì¦ê¸°ê°„(${durationStr})ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');

            } catch (e) {
                console.error("Invalid Date Calculation", e);
                showToast('ë‚ ì§œ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function updateASListRow(index, field, value) {
            asListRows[index][field] = value;
            saveASList();
        }

        function removeASListRow(index) {

            asListRows.splice(index, 1);
            renderASListTable();
            saveASList();
        }

        function saveASList() {
            if (!currentData) return;
            currentData.as_list = asListRows;
            saveCustomers();
        }

        async function syncASListFromCloud() {
            if (!confirm('ê²½ê³ : í˜„ì¬ ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ê³  Google Sheetì˜ ì „ì²´ A/S ë¦¬ìŠ¤íŠ¸ë¡œ êµì²´ë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const btn = document.querySelector('button[onclick="syncASListFromCloud()"]');
            const originalText = btn ? btn.innerHTML : '';
            if (btn) {
                btn.innerHTML = 'â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                btn.disabled = true;
            }

            try {
                // Use 'as_list' to hit handleASListGet
                const params = new URLSearchParams({ sheet: 'as_list' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.result === 'success' && result.items) {
                    // Populate asListRows with ALL items from the DB
                    asListRows = result.items.map(item => ({
                        category: item.category || '',
                        brand: item.brand || '',
                        item: item.item || '',
                        modelNum: item.modelNum || '',
                        size: item.size || '',
                        price: item.price || '',
                        service: item.service || '',
                        warranty: item.warranty || '',
                        note: item.note || ''
                    }));

                    // Also update the global AS_DB for dropdowns
                    AS_DB = result.items;

                    renderASListTable();
                    saveASList();
                    showToast(`ì „ì²´ ${asListRows.length}ê°œì˜ í•­ëª©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    throw new Error(result.message || 'ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('Error syncing AS list:', error);
                showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            }
        }

        // ============================
        // [ì‹ ê·œ] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ (Settlement Management)
        // ============================
        let settlementRows = [];
        let settlementDirty = false; // UX: Track unsaved changes
        let settlementOptionsData = []; // [ì‹ ê·œ] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì˜µì…˜ ë§ˆìŠ¤í„° ë°ì´í„°

        // [ì‹ ê·œ] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì˜µì…˜ ë§ˆìŠ¤í„° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchSettlementMaster() {
            try {
                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=settlement&action=getSettlementOptions`);
                const result = await response.json();
                if (result.result === 'success' && result.options) {
                    settlementOptionsData = result.options;
                    console.log('âœ… ì •ì‚° ì˜µì…˜ ë§ˆìŠ¤í„° ë¡œë“œ ì™„ë£Œ:', settlementOptionsData.length + 'ê°œ');

                    // ì •ì‚° íƒ­ì´ ì—´ë ¤ìˆë‹¤ë©´ ê°±ì‹ 
                    if (document.getElementById('panel-settlement').classList.contains('active')) {
                        renderSettlementTable();
                    }
                } else {
                    console.warn('âš ï¸ ì •ì‚° ì˜µì…˜ ë§ˆìŠ¤í„° ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” ë¹„ì–´ìˆìŒ.');
                }
            } catch (error) {
                console.error('ì •ì‚° ì˜µì…˜ ë§ˆìŠ¤í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function formatNumberInput(input) {
            let value = input.value.replace(/,/g, '');
            if (!isNaN(value) && value !== '') {
                input.value = Number(value).toLocaleString();
            }
        }

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡
        const SETTLEMENT_CATEGORIES = [
            'ê°€ì„¤ê³µì‚¬', 'ì² ê±°ê³µì‚¬', 'ì„¤ë¹„/ë°©ìˆ˜ê³µì‚¬', 'ì „ê¸°/ì¡°ëª…ê³µì‚¬', 'ì—ì–´ì»¨ê³µì‚¬',
            'ì°½í˜¸ê³µì‚¬', 'ëª©ê³µ/ë„ì–´ê³µì‚¬', 'íƒ€ì¼ê³µì‚¬', 'ìš•ì‹¤ê³µì‚¬', 'í•„ë¦„ê³µì‚¬',
            'ë„ì¥ê³µì‚¬', 'ë°”ë‹¥ì¬ê³µì‚¬', 'ë„ë°°ê³µì‚¬', 'ê°€êµ¬ê³µì‚¬', 'ì¤‘ë¬¸ê³µì‚¬',
            'ë§ˆê°ê³µì‚¬', 'ê¸°íƒ€ê³µì‚¬'
        ];

        // ê±°ë˜ì²˜ ì •ë³´ ìë™ ì™„ì„±ì„ ìœ„í•œ ë„ìš°ë¯¸ í•¨ìˆ˜
        function autoFillPartnerInfo(index, clientName) {
            if (!clientName) return;
            // í˜„ì¬ í™œì„±í™”ëœ ì •ì‚° í–‰ë“¤ì´ë‚˜ ê³¼ê±° ê¸°ë¡ì—ì„œ í•´ë‹¹ ê±°ë˜ì²˜ì˜ ì •ë³´ê°€ ìˆëŠ”ì§€ ì°¾ìŒ
            const match = settlementRows.find((r, idx) => idx !== index && r.client === clientName && (r.bizId || r.bankInfo));
            if (match) {
                if (!settlementRows[index].bizId) settlementRows[index].bizId = match.bizId;
                if (!settlementRows[index].bankInfo) settlementRows[index].bankInfo = match.bankInfo;
                if (!settlementRows[index].payType) settlementRows[index].payType = match.payType;
                if (!settlementRows[index].costType) settlementRows[index].costType = match.costType;
            }
        }

        function onSettlementCategoryChange(index, value) {
            if (value === '__DIRECT_INPUT__') {
                const custom = prompt('ì¹´í…Œê³ ë¦¬ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”:');
                if (custom) {
                    settlementRows[index].category = custom;
                    settlementRows[index].process = '';
                    settlementRows[index].client = '';
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index].category = value;
                settlementRows[index].process = '';
                settlementRows[index].client = '';
            }
            renderSettlementTable();
            saveSettlementToLocal();
        }

        function onSettlementProcessChange(index, value) {
            if (value === '__DIRECT_INPUT__') {
                const custom = prompt('ê³µì •ëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”:');
                if (custom) {
                    settlementRows[index].process = custom;
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index].process = value;
            }

            // ê³µì • ì„ íƒ ì‹œ ê¸°ë³¸ ë‹´ë‹¹ì ìë™ ì„¸íŒ…
            const row = settlementRows[index];
            if (row.process) {
                // 1. ë§¤ì¹­ ì†ŒìŠ¤ ê²°ì • (ì •ì‚° DB ìš°ì„ , ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ DB)
                // ë§Œì•½ ì •ì‚° ì˜µì…˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ì‚¬ìš© (Fallback)
                const sourceData = (settlementOptionsData && settlementOptionsData.length > 0) ? settlementOptionsData : defaultScheduleSteps;
                const isSettlementMaster = (sourceData === settlementOptionsData);

                // 2. DBì—ì„œ ë§¤ì¹­ í™•ì¸
                const matches = sourceData.filter(s => {
                    const cat1 = (row.category || '').replace(/\s/g, '').replace('ê³µì‚¬', '');
                    const cat2 = (s.category || '').replace(/\s/g, '').replace('ê³µì‚¬', '');
                    return (cat1 === cat2 || cat1.includes(cat2) || cat2.includes(cat1)) &&
                        (isSettlementMaster ? s.process : s.name) === row.process;
                });

                if (matches.length > 0 && !row.client) {
                    const matchedItem = matches[0];
                    const clientName = isSettlementMaster ? matchedItem.client : matchedItem.inCharge;

                    if (clientName) {
                        settlementRows[index].client = clientName;

                        // ì¶”ê°€ ì •ë³´ ìë™ ê¸°ì… (ì •ì‚° DBì¸ ê²½ìš°ë§Œ ê°€ëŠ¥)
                        if (isSettlementMaster) {
                            if (matchedItem.costType) settlementRows[index].costType = matchedItem.costType;
                            if (matchedItem.payType) settlementRows[index].payType = matchedItem.payType;
                            if (matchedItem.bizId) settlementRows[index].bizId = matchedItem.bizId;
                            if (matchedItem.bankInfo) settlementRows[index].bankInfo = matchedItem.bankInfo;
                        }

                        // ê³¼ê±° ê¸°ë¡ ì°¸ì¡° (Fallback)
                        autoFillPartnerInfo(index, clientName);
                    }
                }
            }
            renderSettlementTable();
            saveSettlementToLocal();
        }

        function renderSettlementTable() {
            const tbody = document.getElementById('settlementTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            let totalPayAmount = 0; // ì´ ê²°ì œê¸ˆì•¡

            settlementRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                const payAmount = parseInt(String(row.payAmount || '0').replace(/,/g, ''), 10) || 0;
                totalPayAmount += payAmount;

                // 1. ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ìƒì„± (ë§ˆìŠ¤í„° ë°ì´í„° DB ê¸°ì¤€)
                // ë§Œì•½ ì •ì‚° ì˜µì…˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ ì‚¬ìš© (Fallback)
                const sourceData = (settlementOptionsData && settlementOptionsData.length > 0) ? settlementOptionsData : defaultScheduleSteps;
                const isSettlementMaster = (sourceData === settlementOptionsData);

                const combinedCategories = [...new Set([
                    ...SETTLEMENT_CATEGORIES,
                    ...(sourceData.map(s => s.category).filter(Boolean))
                ])];

                let categoryOptions = '<option value="">ì„ íƒ</option>';
                categoryOptions += '<option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option>';
                combinedCategories.forEach(cat => {
                    categoryOptions += `<option value="${cat}" ${row.category === cat ? 'selected' : ''}>${cat}</option>`;
                });
                if (row.category && !combinedCategories.includes(row.category)) {
                    categoryOptions = `<option value="">ì„ íƒ</option><option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option><option value="${row.category}" selected>${row.category}</option>` +
                        combinedCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                }

                // 2. ê³µì •ë¶„ë¥˜ ì˜µì…˜ ìƒì„± (DB ë°ì´í„° ì‚¬ìš©)
                // [ìˆ˜ì •] ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ DB(ë˜ëŠ” ìŠ¤ì¼€ì¤„)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë§¤ì¹­
                const filteredSteps = sourceData.filter(s => {
                    if (!row.category) return true;
                    // Comparison relaxed: 1. Remove "ê³µì‚¬", 2. Remove spaces, 3. Remove leading numbers (e.g., "01.")
                    const normalize = (str) => (str || '').replace(/^\d+\.?\s*/, '').replace(/\s/g, '').replace('ê³µì‚¬', '');
                    const cat1 = normalize(row.category);
                    const cat2 = normalize(s.category);

                    return cat1 === cat2 || cat1.includes(cat2) || cat2.includes(cat1);
                });

                // ë°ì´í„° ì†ŒìŠ¤ì— ë”°ë¼ í‚¤ê°€ ë‹¤ë¦„ (settlementOptionsData: process, defaultScheduleSteps: name)
                const uniqueProcesses = [...new Set(filteredSteps.map(s => isSettlementMaster ? s.process : s.name).filter(Boolean))];
                let processOptions = '<option value="">ì„ íƒ</option>';
                processOptions += '<option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option>';
                uniqueProcesses.forEach(p => {
                    processOptions += `<option value="${p}" ${row.process === p ? 'selected' : ''}>${p}</option>`;
                });
                if (row.process && !uniqueProcesses.includes(row.process)) {
                    processOptions = `<option value="">ì„ íƒ</option><option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option><option value="${row.process}" selected>${row.process}</option>` +
                        uniqueProcesses.map(p => `<option value="${p}">${p}</option>`).join('');
                }

                // 3. ê±°ë˜ì²˜/ì‘ì—…ì ì˜µì…˜ ìƒì„± (ê³µì •ëª… ê¸°ë°˜ í•„í„°ë§ + ê³¼ê±° ê¸°ë¡)
                let availableClients = [];
                if (row.process) {
                    availableClients = sourceData
                        .filter(s => (isSettlementMaster ? s.process : s.name) === row.process)
                        .map(s => isSettlementMaster ? s.client : s.inCharge)
                        .filter(Boolean);
                }
                const pastClients = settlementRows.map(r => r.client).filter(Boolean);
                const combinedClients = [...new Set([...availableClients, ...pastClients])];
                let clientOptions = '<option value="">ì„ íƒ</option>';
                clientOptions += '<option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option>';
                combinedClients.forEach(c => {
                    clientOptions += `<option value="${c}" ${row.client === c ? 'selected' : ''}>${c}</option>`;
                });
                if (row.client && !combinedClients.includes(row.client)) {
                    clientOptions = `<option value="">ì„ íƒ</option><option value="__DIRECT_INPUT__">ğŸ–Šï¸ ì§ì ‘ ì…ë ¥</option><option value="${row.client}" selected>${row.client}</option>` +
                        combinedClients.map(c => `<option value="${c}">${c}</option>`).join('');
                }

                tr.setAttribute('draggable', 'true');
                tr.ondragstart = (e) => handleSettlementDragStart(e, index);
                tr.ondragover = handleSettlementDragOver;
                tr.ondrop = (e) => handleSettlementDrop(e, index);
                tr.ondragend = handleSettlementDragEnd;
                tr.style.cursor = 'move';

                tr.innerHTML = `
                    <td style="padding:5px; text-align:center; border:1px solid #d2d2d7; white-space:nowrap;">
                        <span style="cursor:grab; margin-right:4px; color:#999;">â˜°</span>
                        <button onclick="removeSettlementRow(${index})" style="background:none; border:none; color:#ff3b30; cursor:pointer; font-size:14px; margin-right:4px;" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                        <span style="font-size:11px; color:#666;">${index + 1}</span>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="onSettlementCategoryChange(${index}, this.value)" style="width:100%; border:none; background:transparent; font-size:11px;">
                            ${categoryOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="onSettlementProcessChange(${index}, this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" ${row.category ? '' : 'disabled'}>
                            ${processOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="updateSettlementRow(${index}, 'client', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" ${row.process ? '' : 'disabled'}>
                            ${clientOptions}
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.costType || ''}" onchange="updateSettlementRow(${index}, 'costType', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ë¹„ìš©êµ¬ë¶„">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                         <input type="text" value="${row.payType || ''}" onchange="updateSettlementRow(${index}, 'payType', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ëŒ€ê¸ˆë°©ì‹">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.bizId || ''}" onchange="updateSettlementRow(${index}, 'bizId', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ì‚¬ì—…ìë²ˆí˜¸">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.bankInfo || ''}" onchange="updateSettlementRow(${index}, 'bankInfo', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ì€í–‰/ê³„ì¢Œ">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${Number(payAmount).toLocaleString()}" onkeyup="formatNumberInput(this); updateSettlementRow(${index}, 'payAmount', this.value.replace(/,/g,''))" style="width:100%; border:none; background:transparent; font-size:11px; text-align:right;">
                    </td>
                     <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="date" value="${row.payDate || ''}" onchange="updateSettlementRow(${index}, 'payDate', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;">
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <select onchange="updateSettlementRow(${index}, 'payStatus', this.value)" style="width:100%; border:none; background:transparent; font-size:11px; color:${row.payStatus === 'ì§€ê¸‰ì™„ë£Œ' ? '#0071e3' : (row.payStatus === 'ë¯¸ì§€ê¸‰' ? '#ff3b30' : '#333')}">
                            <option value="">ì„ íƒ</option>
                            <option value="ë¯¸ì§€ê¸‰" ${(row.payStatus || '').trim() === 'ë¯¸ì§€ê¸‰' ? 'selected' : ''}>ë¯¸ì§€ê¸‰</option>
                            <option value="ì§€ê¸‰ì™„ë£Œ" ${(row.payStatus || '').trim() === 'ì§€ê¸‰ì™„ë£Œ' ? 'selected' : ''}>ì§€ê¸‰ì™„ë£Œ</option>
                            <option value="ë¶€ë¶„ì§€ê¸‰" ${(row.payStatus || '').trim() === 'ë¶€ë¶„ì§€ê¸‰' ? 'selected' : ''}>ë¶€ë¶„ì§€ê¸‰</option>
                        </select>
                    </td>
                    <td style="padding:5px; border:1px solid #d2d2d7;">
                        <input type="text" value="${row.note || ''}" onchange="updateSettlementRow(${index}, 'note', this.value)" style="width:100%; border:none; background:transparent; font-size:11px;" placeholder="ë¹„ê³ ">
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // í•©ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            // í•©ê³„ ê³„ì‚°
            const totalIncome = currentData && currentData.totalAmount ? parseInt(String(currentData.totalAmount).replace(/,/g, '')) || 0 : 0;
            const totalExpense = totalPayAmount;
            const profit = totalIncome - totalExpense;
            const profitRate = totalIncome > 0 ? ((profit / totalIncome) * 100).toFixed(1) : 0;

            // í•©ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('settlementTotalIncome').innerText = totalIncome.toLocaleString();
            document.getElementById('settlementTotalExpense').innerText = totalExpense.toLocaleString();
            document.getElementById('settlementProfit').innerText = profit.toLocaleString();
            document.getElementById('settlementProfitRate').innerText = profitRate + '%';

            // ìƒ‰ìƒ ì²˜ë¦¬
            document.getElementById('settlementProfit').style.color = profit >= 0 ? '#34c759' : '#ff3b30';
            document.getElementById('settlementProfitRate').style.color = profit >= 0 ? '#333' : '#ff3b30';
        }

        function addSettlementRow() {
            settlementRows.push({
                category: '',
                process: '',
                client: '',
                costType: '',
                payType: '',
                bizId: '',
                bankInfo: '',
                payAmount: 0,
                payDate: '',
                payStatus: 'ë¯¸ì§€ê¸‰',
                note: ''
            });
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function removeSettlementRow(index) {
            settlementRows.splice(index, 1);
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function updateSettlementRow(index, field, value) {
            if (field === 'client' && value === '__DIRECT_INPUT__') {
                const custom = prompt('ê±°ë˜ì²˜ëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”:');
                if (custom) {
                    settlementRows[index].client = custom;
                    autoFillPartnerInfo(index, custom);
                } else {
                    renderSettlementTable();
                    return;
                }
            } else {
                settlementRows[index][field] = value;
                if (field === 'client') {
                    autoFillPartnerInfo(index, value);
                }
            }
            renderSettlementTable();
            saveSettlementToLocal();
            setSettlementDirty(true);
        }

        function saveSettlementToLocal() {
            if (currentData) {
                currentData.settlementRows = settlementRows;
                saveCustomers(); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            }
        }

        // UX: Set dirty state and update indicator
        function setSettlementDirty(dirty) {
            settlementDirty = dirty;
            const indicator = document.getElementById('settlementDirtyIndicator');
            const saveBtn = document.getElementById('btnSaveSettlement');

            if (indicator) {
                if (dirty) {
                    indicator.textContent = 'âš ï¸ ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­';
                    indicator.style.color = '#ff9500';
                    indicator.style.display = 'inline-block';
                } else {
                    indicator.textContent = 'âœ… ì €ì¥ë¨';
                    indicator.style.color = '#34c759';
                    indicator.style.display = 'inline-block';
                    setTimeout(() => { if (!settlementDirty) indicator.style.display = 'none'; }, 3000);
                }
            }

            if (saveBtn) {
                if (dirty) {
                    saveBtn.style.background = '#ff9500';
                    saveBtn.style.animation = 'pulse 1.5s infinite';
                    saveBtn.innerHTML = 'ğŸ’¾ ì €ì¥í•˜ê¸° <span style="background:#fff;color:#ff9500;padding:1px 6px;border-radius:10px;font-size:10px;margin-left:4px;">!</span>';
                } else {
                    saveBtn.style.background = '#0071e3';
                    saveBtn.style.animation = 'none';
                    saveBtn.innerHTML = 'ğŸ’¾ ì €ì¥í•˜ê¸°';
                }
            }
        }

        // [ì¶”ê°€] ì •ì‚° ë°ì´í„° ì´ˆê¸°í™” (ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ë¡œ)
        function initializeSettlementRows() {
            if (typeof SETTLEMENT_CATEGORIES === 'undefined') return;
            settlementRows = SETTLEMENT_CATEGORIES.map(cat => ({
                category: cat,
                process: '',
                client: '',
                costType: '',
                payType: '', // [ìˆ˜ì •] payMethod -> payType
                bizId: '',
                bankInfo: '',
                payAmount: 0, // [ìˆ˜ì •] amount -> payAmount
                payDate: '', // [ìˆ˜ì •] date -> payDate
                payStatus: 'ë¯¸ì§€ê¸‰', // [ìˆ˜ì •] status -> payStatus
                note: '' // [ìˆ˜ì •] memo -> note
            }));
            renderSettlementTable();
            saveSettlementToLocal();
        }

        // êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        async function syncSettlementFromCloud() {
            // [ìˆ˜ì •] ID ì²´í¬ ê°•í™” (id ë˜ëŠ” customerId)
            const custId = currentData ? (currentData.id || currentData.customerId) : null;
            if (!custId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            const btn = document.getElementById('btnLoadSettlement');
            const originalText = btn ? btn.innerText : '';
            if (btn) {
                btn.innerText = 'â³ ì—°ë™ì¤‘...';
                btn.disabled = true;
            }

            try {
                // ì˜µì…˜ ë§ˆìŠ¤í„° ë°ì´í„° ë¨¼ì € ë™ê¸°í™”
                await fetchSettlementMaster();

                const params = new URLSearchParams({
                    sheet: 'settlement',
                    customerId: custId
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                if (result.result === 'success') {
                    if (result.rows && result.rows.length > 0) {
                        settlementRows = result.rows;
                        showToast('ì •ì‚° ë‚´ì—­ ë° ì˜µì…˜ì„ ë™ê¸°í™”í–ˆìŠµë‹ˆë‹¤.', 'success');
                        logUserAction('ë¶ˆëŸ¬ì˜¤ê¸°', (currentData.clientName || '') + ' ì •ì‚° ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ê¸°');
                    } else {
                        // [ë³€ê²½] ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ ìƒì„±
                        initializeSettlementRows();
                        showToast('ì €ì¥ëœ ë‚´ì—­ì´ ì—†ì–´ ê¸°ë³¸ í•­ëª©ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.', 'info');
                    }
                    renderSettlementTable();
                    saveSettlementToLocal();
                } else {
                    throw new Error(result.error || 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error(err);
                showToast('ì—°ë™ ì‹¤íŒ¨: ' + err.message, 'error');
            } finally {
                if (btn) {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            }
        }

        // êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì €ì¥í•˜ê¸°
        async function syncSettlementToCloud() {
            // [ìˆ˜ì •] ID ì²´í¬ ê°•í™”
            const custId = currentData ? (currentData.id || currentData.customerId) : null;
            if (!custId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            if (!confirm('í˜„ì¬ ì •ì‚° ë‚´ì—­ì„ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥(ë®ì–´ì“°ê¸°)í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const btn = document.getElementById('btnSaveSettlement');
            if (btn) {
                btn.innerHTML = 'â³ ì €ì¥ì¤‘...';
                btn.disabled = true;
                btn.style.animation = 'none';
            }

            try {
                // ì €ì¥ ë°ì´í„° êµ¬ì„±
                const payload = {
                    action: 'updateSettlement',
                    customerId: custId,
                    customerName: currentData.clientName,
                    rows: settlementRows
                };

                // sendDataToAppsScript í•¨ìˆ˜ ì¬ì‚¬ìš© (ë˜ëŠ” ì§ì ‘ fetch)
                // ì—¬ê¸°ì„œëŠ” ì§ì ‘ fetch êµ¬í˜„ (post)
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload) // sendBeacon ëŒ€ì‹  ì¼ë°˜ fetch ì‚¬ìš© (ê²°ê³¼ í™•ì¸ í•„ìš”)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    showToast('ì •ì‚° ë‚´ì—­ì´ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    setSettlementDirty(false); // UX: Clear dirty state on success
                    logUserAction('ì €ì¥', (currentData.clientName || '') + ' ì •ì‚° ë‚´ì—­ ì €ì¥');
                } else {
                    throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
                }

            } catch (err) {
                console.error(err);
                showToast('ì €ì¥ ì‹¤íŒ¨: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    // Button text/style will be set by setSettlementDirty if success
                    if (settlementDirty) {
                        btn.innerHTML = 'ğŸ’¾ ì €ì¥í•˜ê¸° <span style="background:#fff;color:#ff9500;padding:1px 6px;border-radius:10px;font-size:10px;margin-left:4px;">!</span>';
                        btn.style.background = '#ff9500';
                        btn.style.animation = 'pulse 1.5s infinite';
                    }
                }
            }
        }

        // ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì¸ì‡„
        function printSettlement() {
            const panel = document.getElementById('panel-settlement');
            if (!panel) {
                showToast('ì¸ì‡„í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const customerName = currentData?.clientName || currentData?.projectName || 'ê³ ê°ëª…ì—†ìŒ';
            const printContent = panel.innerHTML;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ - ${customerName}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; padding: 20px; }
                        .doc-header { padding: 20px; border-bottom: 2px solid #333; margin-bottom: 20px; }
                        .doc-header h1 { font-size: 24px; }
                        .subtitle { font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
                        th { background: #f5f5f5; font-weight: 600; }
                        select, input { border: none; background: transparent; font-size: 11px; }
                        button, .no-print { display: none !important; }
                        @media print {
                            body { padding: 0; }
                            @page { margin: 15mm; }
                        }
                    </style>
                </head>
                <body>
                    <div style="text-align:center; margin-bottom:20px;">
                        <h2>ì •ì‚° ê´€ë¦¬ ëŒ€ì¥</h2>
                        <p style="color:#666; font-size:14px;">${customerName}</p>
                        <p style="color:#999; font-size:11px;">ì¸ì‡„ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
                    </div>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);

            // ë¡œê·¸ ê¸°ë¡
            logUserAction('ì¸ì‡„', (currentData?.clientName || customerName) + ' ì •ì‚° ê´€ë¦¬ ëŒ€ì¥ ì¸ì‡„');
        }

        // Settlement Drag & Drop Handlers
        let draggedSettlementIndex = null;

        function handleSettlementDragStart(e, index) {
            draggedSettlementIndex = index;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', index);
            setTimeout(() => e.target.style.opacity = '0.5', 0);
        }

        function handleSettlementDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleSettlementDrop(e, index) {
            e.stopPropagation();
            e.preventDefault();

            if (draggedSettlementIndex !== null && draggedSettlementIndex !== index) {
                // ë°°ì—´ ìˆœì„œ ë³€ê²½
                const item = settlementRows.splice(draggedSettlementIndex, 1)[0];
                settlementRows.splice(index, 0, item);

                renderSettlementTable();
                saveSettlementToLocal();
            }
            return false;
        }

        function handleSettlementDragEnd(e) {
            e.target.style.opacity = '1';
            draggedSettlementIndex = null;
        }

        // Existing Schedule Drag & Drop (Reference)
        let draggedIndex = null;
        function handleDragStart(e, index) {
            draggedIndex = index;
            e.target.style.opacity = '0.4';
        }
        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedIndex = null;
        }
        function handleDragOver(e) {
            e.preventDefault();
        }
        function handleDrop(e, index) {
            e.preventDefault();
            if (draggedIndex === null || draggedIndex === index) return;
            const item = scheduleRows.splice(draggedIndex, 1)[0];
            scheduleRows.splice(index, 0, item);
            renderScheduleTable();
            saveScheduleToCustomer();
        }


        function syncAllFields() {
            // [Auth Check]
            if (!currentData) return;

            // [Auto-Calc] ì”ê¸ˆì¼ ê¸°ë°˜ A/S ì¢…ë£Œì¼ ìë™ ê³„ì‚° ë° ì €ì¥ (ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ)
            if (currentData.finalPaymentDate && !currentData.asEndDate) {
                const fDate = new Date(currentData.finalPaymentDate);
                if (!isNaN(fDate.getTime())) {
                    fDate.setMonth(fDate.getMonth() + 12);
                    currentData.asEndDate = fDate.toISOString().split('T')[0];
                }
            }

            // 1. Input Fields
            document.querySelectorAll('.synced-input').forEach(field => {
                field.value = currentData[field.dataset.sync] || '';
            });

            // 2. Display Fields (.synced-display)
            document.querySelectorAll('.synced-display').forEach(field => {
                let value = currentData[field.dataset.sync] || '-';

                // 1) A/S ê¸°ê°„ (warrantyPeriod) ê³„ì‚° ë¡œì§
                if (field.dataset.sync === 'warrantyPeriod') {
                    if (currentData.asEndDate) {
                        // ì”ê¸ˆì¼ì´ ìˆìœ¼ë©´ "ì”ê¸ˆì¼ ~ ì¢…ë£Œì¼" í‘œì‹œ
                        value = currentData.finalPaymentDate ? `${currentData.finalPaymentDate} ~ ${currentData.asEndDate}` : `~ ${currentData.asEndDate}`;
                    } else if (currentData.asWarrantyEnd) {
                        value = `~ ${currentData.asWarrantyEnd}`;
                    }
                }
                field.textContent = value;
            });

            // 3. A/S List Special Fields
            const asInfo1 = document.getElementById('asClientInfo1');
            const asInfo2 = document.getElementById('asClientInfo2');
            if (asInfo1 && asInfo2) {
                // ë¼ì¸ 1: ë³¸ì¸ ì„±ëª… (ì—°ë½ì²˜)
                let name1 = currentData.clientName || '';
                const phone1 = currentData.clientPhone || '';
                if (name1 && phone1) name1 += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(phone1) : phone1})`;
                asInfo1.textContent = name1;

                // ë¼ì¸ 2: ë°°ìš°ì ì„±ëª… (ì—°ë½ì²˜)
                let name2 = currentData.spouseName || '';
                const phone2 = currentData.spousePhone || '';
                if (name2) {
                    if (phone2) name2 += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(phone2) : phone2})`;
                    asInfo2.textContent = name2;
                } else {
                    asInfo2.textContent = '';
                }
            }

            const leakEl = document.getElementById('bathroomLeakWarranty');
            if (leakEl) {
                leakEl.textContent = currentData.leakWarrantyEnd ? `~ ${currentData.leakWarrantyEnd}` : '-';
            }

            // 4. [FIX] Schedule Tab Fields Force Sync
            // ê³µì‚¬ ìŠ¤ì¼€ì¤„ íƒ­ì˜ ID ìš”ì†Œë“¤ì´ synced-display í´ë˜ìŠ¤ê°€ ì—†ì–´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°
            if (document.getElementById('schPeriod')) {
                document.getElementById('schPeriod').textContent = currentData.constructionPeriod || '';

                let areaText = (currentData.area || '').toString().replace(' PY', '');
                if (areaText) areaText += ' PY';
                document.getElementById('schArea').textContent = areaText;

                document.getElementById('schMoveDate').textContent = currentData.movingDate || '';

                // ê³µì‚¬ ì˜ë¢°ì¸ (ë³¸ì¸) - ì„±ëª… (ì—°ë½ì²˜)
                let clientInfo = '';
                if (currentData.clientName) {
                    clientInfo = currentData.clientName + ' ê³ ê°ë‹˜';
                    if (currentData.clientPhone) clientInfo += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(currentData.clientPhone) : currentData.clientPhone})`;
                }
                document.getElementById('schClient1').textContent = clientInfo;

                // ê³µì‚¬ ì˜ë¢°ì¸ (ë°°ìš°ì) - ì„±ëª… (ì—°ë½ì²˜) -> Schedule íƒ­ì˜ input í•„ë“œì— í• ë‹¹
                const client2Input = document.querySelector('.sch-input[data-field="client2"]');
                if (client2Input) {
                    let spouseInfo = currentData.spouseName || '';
                    if (spouseInfo && currentData.spousePhone) {
                        spouseInfo += ` (${typeof formatPhoneNumber === 'function' ? formatPhoneNumber(currentData.spousePhone) : currentData.spousePhone})`;
                    }
                    client2Input.value = spouseInfo;
                }

                document.getElementById('schSiteAddr').textContent = currentData.siteAddress || '';
            }

            const rep = document.getElementById('companyRep');
            if (rep) {
                document.querySelectorAll('.company-sync').forEach(f => f.value = rep.value);
            }
        }

        async function exportASListToNotion() {
            if (!currentData.clientName) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            // [UI í†µì¼] confirm ì°½ ì œê±°í•˜ê³  í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¡œ ëŒ€ì²´
            showToast('ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');

            const btn = document.querySelector('button[title="ë…¸ì…˜ìœ¼ë¡œ A/S ë¦¬ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸°"]');

            if (btn) {
                btn.innerHTML = 'â³ ë‚´ë³´ë‚´ëŠ” ì¤‘...';
                btn.disabled = true;
            }

            try {
                const exportData = {
                    manager: currentData.manager || '',
                    period: currentData.warrantyPeriod || '',
                    balanceDate: currentData.balanceDate || '',
                    clientName: currentData.clientName || '',
                    clientPhone: currentData.clientPhone || '',
                    spouseName: currentData.spouseName || '',
                    spousePhone: currentData.spousePhone || '',
                    siteAddress: currentData.siteAddress || '',
                    leakWarranty: currentData.leakWarrantyEnd || '',
                    guidelines: getASGuidelinesArray(), // [ì¶”ê°€] A/S ìœ ì˜ì‚¬í•­ ë°°ì—´
                    items: typeof asListRows !== 'undefined' ? asListRows : []
                };

                const payload = {
                    action: 'exportToNotion',
                    type: 'asList',
                    customerId: currentData.customerId,
                    data: JSON.stringify(exportData)
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('âœ… ë…¸ì…˜ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!', 'success');
                } else {
                    throw new Error(result.message || 'ë™ê¸°í™” ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('Notion Sync Error:', error);
                showToast('ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = 'ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°';
                    btn.disabled = false;
                }
            }
        }

        async function saveCustomers() {
            // Phase 2: í´ë¼ìš°ë“œë¡œ ì €ì¥ (Source of Truth: Google Sheets)
            if (!currentData || !currentData.customerId) {
                console.log('âŒ [Web Save] No customer selected, skipping save');
                return;
            }

            console.log('ğŸ“¤ [Web Save] ========== SAVE START ==========');
            console.log('ğŸ“‹ [Web Save] Customer ID:', currentData.customerId);
            console.log('ğŸ“‹ [Web Save] Checklist Items Count:', Object.keys(currentData.checklistData || {}).length);

            try {
                const payload = {
                    sheetName: 'ê³ ê°ê´€ë¦¬_ê²¬ì ì„œ',
                    data: {
                        customerId: currentData.customerId || '',
                        clientName: currentData.clientName || '',
                        clientPhone: currentData.clientPhone || '',
                        clientEmail: currentData.clientEmail || '',
                        status: currentData.status || '',
                        createdAt: currentData.createdAt || new Date().toISOString(),
                        clientAddress: currentData.clientAddress || '',
                        projectName: currentData.projectName || '',
                        siteAddress: currentData.siteAddress || '',
                        constructionPeriod: currentData.constructionPeriod || '',
                        movingDate: currentData.movingDate || '',
                        finalPaymentDate: currentData.finalPaymentDate || '',
                        contractDate: currentData.contractDate || '',
                        warrantyPeriod: currentData.asEndDate || '',
                        asEndDate: currentData.asEndDate || '',
                        pyeong: currentData.area || '',
                        inflowPath: currentData.clientSource || '',
                        buildingType: currentData.buildingType || '',
                        totalAmount: currentData.totalAmount || '',
                        estimateProfitRate: currentData.profitRate || '15%',
                        manager: currentData.manager || '',
                        updatedAt: new Date().toISOString().split('T')[0],
                        jsonData: JSON.stringify(currentData)
                    }
                };

                console.log('ğŸ“¦ [Web Save] jsonData contains checklistData?', payload.data.jsonData.includes('checklistData'));

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                console.log('ğŸ“¡ [Web Save] Response status:', response.status);

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('âœ… [Web Save] Save successful:', result);
                } catch (e) {
                    console.warn('âš ï¸ [Web Save] Response is not JSON:', responseText);
                    result = { success: true, message: responseText };
                }

                // Google Apps Script returns {result: 'success'} or {success: true}
                if (result.success || result.result === 'success') {
                    console.log('âœ… [Web Save] ========== SAVE COMPLETE ==========');
                } else {
                    console.error('âŒ [Web Save] Save failed:', result.message || 'Unknown error');
                    showToast('ì €ì¥ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }

                return result;

            } catch (error) {
                console.error('âŒ [Web Save] Error:', error);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                throw error;
            }
        }

        async function newCustomer() {
            if (!isLoggedIn()) {
                showToast('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                showAdminModal();
                return;
            }
            if (isAppBusy) return;

            const name = prompt('ê³ ê°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) {
                showToast('ê³ ê°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            setAppBusy(true, 'ìµœì‹  ì •ë³´ í™•ì¸ ì¤‘...');
            // [Task 3] Stabilization: Ensure fresh state before creation
            try {
                // 1. Sync to get latest ID/Count
                const syncSuccess = await syncFromCloud(true);
                if (!syncSuccess) {
                    setAppBusy(false);
                    if (!confirm('ë°ì´í„° ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ID ì¤‘ë³µ ìœ„í—˜)')) return;
                    setAppBusy(true, 'ì‹ ê·œ ê³ ê° ìƒì„± ì¤‘...');
                } else {
                    setAppBusy(true, 'ì‹ ê·œ ê³ ê° ìƒì„± ì¤‘...');
                }

                // 2. Generate ID using fresh count
                const cloudCount = cachedCloudCount;
                const now = new Date();
                const yy = now.getFullYear().toString().slice(-2);
                const mm = String(now.getMonth() + 1).padStart(2, '0');
                const dd = String(now.getDate()).padStart(2, '0');
                const seq = String(cloudCount + 1).padStart(3, '0');
                currentCustomerId = `${yy}${mm}${dd} -${seq} `;

                // Double check collision locally
                if (customers.some(c => c.customerId === currentCustomerId)) {
                    const seq2 = String(cloudCount + 2).padStart(3, '0');
                    currentCustomerId = `${yy}${mm}${dd} -${seq2} `;
                }

                currentData = {
                    customerId: currentCustomerId,
                    clientName: name,
                    projectName: '',
                    status: 'consulting',
                    createdAt: new Date().toISOString().split('T')[0],
                    profitRate: '15%',
                    createdBy: currentAdmin?.id || 'unknown',
                    isLocked: false,
                    manager: 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)'
                };

                // 3. Save to Cloud Immediately (Source of Truth)
                const payload = {
                    action: 'update_customer',
                    ...currentData
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                const res = await response.json();
                if (res.result !== 'success') {
                    throw new Error(res.message || 'Server Error');
                }

                // 4. Update Local State
                customers.push({ ...currentData });
                cachedCloudCount++;

                document.querySelectorAll('.customer-field').forEach(f => {
                    f.value = f.dataset.field === 'profitRate' ? '15%' : '';
                });
                document.getElementById('customerStatus').value = 'consulting';
                document.getElementById('asEndDateDisplay').style.display = 'none';
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('customerView').style.display = 'block';
                document.getElementById('headerCustomerName').textContent = 'ì‹ ê·œ ê³ ê°';
                document.getElementById('headerCustomerId').textContent = currentCustomerId;

                const clientNameField = document.querySelector('.customer-field[data-field="clientName"]');
                if (clientNameField) clientNameField.value = name;
                const projectNameField = document.querySelector('.customer-field[data-field="projectName"]');
                if (projectNameField) projectNameField.value = '';
                document.getElementById('headerCustomerName').textContent = name;

                clearCostData();
                currentData.estimateData = {};
                currentData.estimateProfitRate = 15;
                categories.forEach(cat => {
                    delete currentData[`estMemo_${cat.no}`];
                });

                scheduleRows = [];
                asListRows = [];
                settlementRows = [];
                currentData.schedules = [];
                currentData.as_list = [];
                currentData.settlementRows = [];
                currentData.checklistData = {};
                currentData.checklistFilters = {
                    checklistStageFilter: ['all'],
                    checklistCategoryFilter: ['all']
                };

                loadEstimateData();
                if (typeof renderScheduleTable === 'function') renderScheduleTable();
                if (typeof renderASListTable === 'function') renderASListTable();
                if (typeof renderSettlementTable === 'function') renderSettlementTable();
                if (typeof renderChecklistItems === 'function') renderChecklistItems();
                if (typeof loadSavedChecklistState === 'function') loadSavedChecklistState(true);

                initYearFilter();
                updateCustomerList();
                syncAllFields();

                showToast('ì‹ ê·œ ê³ ê°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

            } catch (e) {
                console.error('New Customer Error:', e);
                showPersistentAlert(`ì‹ ê·œ ê³ ê° ìƒì„± ì‹¤íŒ¨: ${e.message}`, 'error');
            } finally {
                setAppBusy(false);
            }
        }

        function selectCustomer(customerId) {
            if (typeof showMainView === 'function') showMainView('customer');
            fetchASListDB(); // Load A/S DB if not already loaded
            const customer = customers.find(c => c.customerId === customerId);
            if (!customer) return;

            // [Performance Optimization] Lazy Parsing
            // Only parse the heavy checklistData when the customer is actually selected.
            if (!customer.checklistData && customer.jsonData && typeof customer.jsonData === 'string' && customer.jsonData.trim().startsWith('{')) {
                try {
                    const parsed = JSON.parse(customer.jsonData);

                    // Normalize checklistData logic from syncFromCloud
                    let normalizedData = {};
                    if (parsed.checklistData) {
                        if (typeof parsed.checklistData === 'object') {
                            Object.entries(parsed.checklistData).forEach(([key, value]) => {
                                // Handle nested object {checked: true} or simple boolean
                                if (value && typeof value === 'object' && 'checked' in value) {
                                    normalizedData[key] = value.checked;
                                } else if (typeof value === 'boolean') {
                                    normalizedData[key] = value;
                                } else {
                                    normalizedData[key] = !!value; // Fallback
                                }
                            });
                        }
                    }
                    customer.checklistData = normalizedData;
                    console.log('âœ… [Lazy Parse] Parsed checklistData for', customer.clientName);
                } catch (e) {
                    console.warn('âš ï¸ Lazy parse failed for', customer.clientName, e);
                    customer.checklistData = {};
                }
            }

            currentCustomerId = customerId;

            // Legacy Data Compatibility (Cloud Compatibility Fix)
            // Ensure old keys (pyeong, inflowPath) map to new inputs (area, clientSource)
            customer.clientSource = customer.clientSource || customer.inflowPath || '';
            customer.area = customer.area || customer.pyeong || '';

            // 'py' í‘œê¸°ë¥¼ 'í‰'ìœ¼ë¡œ ìë™ ë³€í™˜ (ê¸°ì¡´ ì €ì¥ëœ ë°ì´í„° í˜¸í™˜)
            if (customer.area && /^\d+py$/i.test(String(customer.area).trim())) {
                customer.area = customer.area.replace(/py$/i, 'í‰');
            }

            if (!customer.profitRate && customer.estimateProfitRate) {
                // Format estimateProfitRate if it's just a number
                let rate = String(customer.estimateProfitRate);
                if (/^\d+$/.test(rate)) rate += '%';
                customer.profitRate = rate;
            }


            if (!customer.manager || customer.manager.trim() === '') {
                customer.manager = 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)';
            }


            currentData = { ...customer };

            // ì ‘ê·¼ ì œí•œ í™•ì¸
            if (document.getElementById('accessDeniedOverlay')) {
                const isLocked = isCustomerLocked();
                document.getElementById('accessDeniedOverlay').style.display = isLocked ? 'flex' : 'none';
                if (isLocked) {
                    document.getElementById('lockedPasswordInput').value = '';
                }
            }

            // ê¶Œí•œì— ë”°ë¥¸ ì…ë ¥ ë¹„í™œì„±í™” (ë³¸ì¸ ì‘ì„± ê±´ë§Œ ìˆ˜ì • ê°€ëŠ¥)
            const editable = canEdit();
            document.querySelectorAll('.customer-field, #customerStatus').forEach(el => {
                el.disabled = !editable;
            });
            const delBtn = document.querySelector('.delete-btn');
            if (delBtn) delBtn.style.visibility = (editable && !isCustomerLocked()) ? 'visible' : 'hidden';

            document.querySelectorAll('.customer-field').forEach(f => {
                f.value = currentData[f.dataset.field] || '';
            });
            document.getElementById('customerStatus').value = currentData.status || 'consulting';

            // A/S ê¸°ê°„ í‘œì‹œ
            const asDisplay = document.getElementById('asEndDateDisplay');
            if (currentData.status === 'as_done' && currentData.asEndDate) {
                asDisplay.textContent = `A / S ~${currentData.asEndDate} `;
                asDisplay.style.display = 'block';
            } else {
                asDisplay.style.display = 'none';
            }

            const emptyStateEl = document.getElementById('emptyState');
            if (emptyStateEl) emptyStateEl.style.display = 'none';
            const customerViewEl = document.getElementById('customerView');
            if (customerViewEl) customerViewEl.style.display = 'block';
            const headerNameEl = document.getElementById('headerCustomerName');
            if (headerNameEl) headerNameEl.textContent = currentData.projectName || currentData.clientName || 'ê³ ê°ëª… ì—†ìŒ';
            const headerIdEl = document.getElementById('headerCustomerId');
            if (headerIdEl) headerIdEl.textContent = currentCustomerId;
            loadCostData();
            loadEstimateData();

            // [Data Consistency] Atomic switch for all modular datasets
            if (typeof loadScheduleForCustomer === 'function') loadScheduleForCustomer(currentCustomerId);
            if (typeof loadASList === 'function') loadASList(currentCustomerId);

            settlementRows = currentData.settlementRows || [];
            if (typeof renderSettlementTable === 'function') renderSettlementTable();

            if (typeof renderChecklistItems === 'function') renderChecklistItems();
            if (typeof loadSavedChecklistState === 'function') loadSavedChecklistState(true);

            // [PERFORMANCE FIX] Direct DOM update for selection state
            // updateCustomerList(false); // Removed full re-render

            // Remove active class from previous selection
            document.querySelectorAll('.customer-item.active').forEach(el => el.classList.remove('active'));

            // Add active class to new selection
            // Use robust data attribute selector
            const activeItem = document.querySelector(`.customer-item[data-customer-id="${currentCustomerId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            syncAllFields();
            updateLockUI(); // ì ê¸ˆ ìƒíƒœ ë° ì‘ì„±ì í‘œì‹œ

            // Main Dashboard Renewal: Default to Dashboard
            showCustomerTab('dashboard');
            if (typeof renderDashboard === 'function') renderDashboard();


            // [DATE FIX] input[type="date"] requires YYYY-MM-DD format.
            // Convert any stored dots (YYYY.MM.DD) to dashes.
            ['movingDate', 'contractDate', 'finalPaymentDate'].forEach(field => {
                const el = document.querySelector(`.customer-field[data-field="${field}"]`);
                if (el && currentData[field]) {
                    el.value = currentData[field].replace(/\./g, '-');
                }
            });

            // [CONSTRUCTION PERIOD FIX] Split string into two date inputs
            if (currentData.constructionPeriod) {
                // ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›: "2025.01.01 ~ 2025.03.01" ë˜ëŠ” "2025-01-01 ~ 2025-03-01"
                const periodStr = currentData.constructionPeriod.replace(/\s+/g, ''); // ëª¨ë“  ê³µë°± ì œê±°
                const parts = periodStr.split('~');
                if (parts.length > 0 && parts[0]) {
                    // ì ì„ ëŒ€ì‹œë¡œ ë³€í™˜í•˜ì—¬ date inputì— ì„¤ì •
                    document.getElementById('constructionStartInput').value = parts[0].replace(/\./g, '-').trim();
                }
                if (parts.length > 1 && parts[1]) {
                    document.getElementById('constructionEndInput').value = parts[1].replace(/\./g, '-').trim();
                }
            } else {
                document.getElementById('constructionStartInput').value = '';
                document.getElementById('constructionEndInput').value = '';
            }
        }

        function updateConstructionPeriod() {
            const start = document.getElementById('constructionStartInput').value;
            const end = document.getElementById('constructionEndInput').value;
            const hiddenInput = document.getElementById('hiddenConstructionPeriod');

            if (start && end) {
                // ì¼ê´€ëœ í˜•ì‹ìœ¼ë¡œ ì €ì¥: "YYYY.MM.DD ~ YYYY.MM.DD"
                hiddenInput.value = `${start.replace(/-/g, '.')} ~ ${end.replace(/-/g, '.')}`;
            } else if (start) {
                hiddenInput.value = `${start.replace(/-/g, '.')}`;
            } else {
                hiddenInput.value = '';
            }
            // Trigger standard update
            updateCustomerField(hiddenInput);
        }

        // Phone Number Auto-format (Same logic as quote.html)
        function autoFormatPhone(el) {
            let value = el.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);

            if (value.length <= 3) { el.value = value; } else if (value.length <= 7) {
                el.value = value.slice(0, 3) + '-' +
                    value.slice(3);
            } else { el.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7); }
        }

        // Area Auto-format (ìˆ«ìë§Œ ì…ë ¥ ì‹œ 'í‰' ì¶”ê°€)
        function autoFormatArea(el) {
            let value = el.value.trim();
            if (!value) return;
            // ìˆ«ìë§Œ ì…ë ¥ëœ ê²½ìš° 'í‰' ë¶™ì´ê¸°
            if (/^\d+$/.test(value)) {
                el.value = value + 'í‰';
            }
            // 'py'ê°€ í¬í•¨ëœ ê²½ìš° 'í‰'ìœ¼ë¡œ ë³€í™˜
            else if (/^\d+py$/i.test(value)) {
                el.value = value.replace(/py$/i, 'í‰');
            }
        }

        // Profit Rate Auto-format (add '%')
        function autoFormatProfit(el) {
            let value = el.value.trim();
            if (!value) return;
            if (/^\d+$/.test(value)) { el.value = value + ' % '; }
        }

        function updateCustomerField(el) {
            const fieldName = el.dataset.field;
            const oldValue = currentData[fieldName] || '';
            const newValue = el.value;

            // ë³€ê²½ì´ ì—†ìœ¼ë©´ ë¡œê·¸ ì•ˆë‚¨ê¹€
            if (oldValue === newValue) {
                return;
            }

            currentData[fieldName] = newValue;

            // customers ë°°ì—´ì—ë„ ë³€ê²½ì‚¬í•­ ì¦‰ì‹œ ë°˜ì˜
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1) {
                customers[customerIndex][fieldName] = newValue;
            }

            if (fieldName === 'clientName' || fieldName === 'projectName') {
                const displayName = currentData.projectName || currentData.clientName || 'ê³ ê°ëª… ì—†ìŒ';
                document.getElementById('headerCustomerName').textContent = displayName;
            }

            // [ì¶”ê°€] ì‘ì—… ê¸°ë¡ ë¡œê·¸
            const fieldLabels = {
                clientName: 'ê³ ê°ëª…',
                projectName: 'í˜„ì¥ëª…',
                phone: 'ì—°ë½ì²˜',
                email: 'ì´ë©”ì¼',
                address: 'ì£¼ì†Œ',
                area: 'í‰ìˆ˜',
                buildingType: 'ê±´ë¬¼ìœ í˜•',
                clientSource: 'ìœ ì…ê²½ë¡œ',
                movingDate: 'ì…ì£¼ì˜ˆì •ì¼',
                contractDate: 'ê³„ì•½ì¼',
                constructionPeriod: 'ê³µì‚¬ê¸°ê°„',
                totalAmount: 'ì´ ê³„ì•½ê¸ˆì•¡',
                finalPaymentDate: 'ì”ê¸ˆì¼',
                manager: 'ê³µì‚¬ë‹´ë‹¹ì',
                memo: 'ë©”ëª¨',
                profitRate: 'ì´ìµë¥ '
            };
            const label = fieldLabels[fieldName] || fieldName;
            logUserAction(`${label} ìˆ˜ì •`, `"${newValue}"`);

            syncAllFields();
        }
        function updateStatus() {
            const status = document.getElementById('customerStatus').value;
            const oldStatus = currentData.status;
            currentData.status = status;

            // [ì¶”ê°€] ìƒíƒœ ë³€ê²½ ë¡œê·¸
            const statusLabelsKo = {
                consulting: 'ìƒë‹´ì¤‘',
                hold: 'ë³´ë¥˜',
                budget_over: 'ì˜ˆì‚°ì´ˆê³¼',
                other_company: 'íƒ€ì‚¬ê³„ì•½',
                contracted: 'ê³„ì•½ì™„ë£Œ',
                in_progress: 'ê³µì‚¬ì¤‘',
                completed: 'ê³µì‚¬ì™„ë£Œ',
                as_done: 'A/Sì™„ë£Œ',
                trash: 'íœ´ì§€í†µ'
            };
            logUserAction('ìƒíƒœ ë³€ê²½', `${statusLabelsKo[oldStatus] || oldStatus} â†’ ${statusLabelsKo[status] || status}`);

            // Auto-fill Contract Date if status is 'contracted'
            if (status === 'contracted' && !currentData.contractDate) {
                const today = new Date().toISOString().split('T')[0];
                currentData.contractDate = today;
                const contractField = document.querySelector('.customer-field[data-field="contractDate"]');
                if (contractField) contractField.value = today;
                showToast('ê³„ì•½ì¼ì´ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ìë™ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
            // Auto-calculate A/S End Date if status is 'as_done'
            if (status === 'as_done') {
                calculateAsEndDate();
            }
            const asDisplay = document.getElementById('asEndDateDisplay');
            if (status === 'as_done' && currentData.asEndDate) {
                asDisplay.textContent = `A/S ~${currentData.asEndDate}`;
                asDisplay.style.display = 'block';
            } else {
                asDisplay.style.display = 'none';
            }
            updateCustomerList();

            // Auto-sync to Google Sheets on status change
            saveCustomers(); // Save locally first
            syncToGoogleSheets({ ...currentData }); // Sync to cloud
            showToast(`ìƒíƒœê°€ '${statusLabelsKo[status] || status}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
        }
        function updateAsDate() {
            // A/S ë‚ ì§œëŠ” ì”ê¸ˆì¼ ê¸°ì¤€ ìë™ ê³„ì‚°ìœ¼ë¡œ ë³€ê²½ë¨
        }
        function calculateAsEndDate() {
            const finalPaymentDate = currentData.finalPaymentDate;
            if (finalPaymentDate) {
                const date = new Date(finalPaymentDate);
                date.setMonth(date.getMonth() + 12);
                const endDate = date.toISOString().split('T')[0];
                currentData.asEndDate = endDate;
                const asEndField = document.querySelector('.customer-field[data-field="asEndDate"]');
                if (asEndField) asEndField.value = endDate;
                syncAllFields();
            }
        }
        function deleteCurrentCustomer() {
            if (!currentCustomerId) return;

            // 1. Permission check
            if (!canDelete()) {
                showToast('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤ (ë³¸ì¸ ì‘ì„± ê±´ë§Œ ì‚­ì œ ê°€ëŠ¥)', 'error');
                return;
            }

            // 2. Lock check
            if (isCustomerLocked()) {
                showToast('ì ê¸ˆ ì„¤ì •ëœ ê³ ê°ì…ë‹ˆë‹¤. ë©”ì¸ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.', 'error');
                return;
            }

            // 3. Confirm Soft Delete
            if (!confirm('íœ´ì§€í†µìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ëŠ” ë©”ì¸ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤)')) return;

            // 4. Perform Soft Delete (Trash)
            const index = customers.findIndex(c => c.customerId === currentCustomerId);
            if (index !== -1) {
                const deletedName = customers[index].clientName || customers[index].projectName || currentCustomerId;
                customers[index].status = 'trash';
                customers[index].deletedAt = new Date().toISOString();
                customers[index].deletedBy = currentAdmin.id;

                // [ì¶”ê°€] ì‚­ì œ ë¡œê·¸
                logUserAction('íœ´ì§€í†µìœ¼ë¡œ ì´ë™', deletedName);

                saveCustomers();
                showToast('íœ´ì§€í†µìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');

                // Reset View
                currentCustomerId = null;
                currentData = {};
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('customerView').style.display = 'none';
                updateCustomerList();
            }
        }

        // [New] Global Main Board Rendering
        function renderMainBoard() {
            const grid = document.getElementById('mainBoardGrid');
            if (!grid) return;

            // [NEW] Filters
            const yearFilter = document.getElementById('mbYearFilter')?.value;
            const statusFilter = document.getElementById('mbStatusFilter')?.value;

            // Filter Logic
            let filtered = customers.filter(c => {
                // Year Check
                let date = c.contractDate || c.consultDate || '';
                let year = date.split('-')[0];
                if (yearFilter && year !== yearFilter) return false;

                // Status Check
                if (statusFilter && c.status !== statusFilter) return false;

                return true;
            });

            // Stats Logic (Update based on filtered view)
            const total = filtered.length;
            const inProgress = filtered.filter(c => c.status === 'in_progress').length;

            const statsTotalEl = document.getElementById('statsTotal');
            const statsProgressEl = document.getElementById('statsProgress');

            if (statsTotalEl) statsTotalEl.innerText = total;
            if (statsProgressEl) statsProgressEl.innerText = inProgress;

            // Sort
            const sorted = [...filtered].sort((a, b) => {
                const dateA = a.contractDate || '0000-00-00';
                const dateB = b.contractDate || '0000-00-00';
                return dateB.localeCompare(dateA);
            });

            grid.innerHTML = sorted.map(c => {
                let statusClass = 'status-consulting';
                if (c.status === 'estimate') statusClass = 'status-estimate';
                else if (c.status === 'contracted') statusClass = 'status-contracted';
                else if (c.status === 'in_progress') statusClass = 'status-in_progress';
                else if (c.status === 'completed' || c.status === 'as_done') statusClass = 'status-completed';

                const statusMap = {
                    'consulting': 'ìƒë‹´ì¤‘', 'estimate': 'ê²¬ì ', 'contracted': 'ê³„ì•½ì™„ë£Œ',
                    'in_progress': 'ê³µì‚¬ì¤‘', 'completed': 'ì™„ë£Œ', 'as_done': 'A/S',
                    'hold': 'ë³´ë¥˜', 'budget_over': 'ì˜ˆì‚°ì´ˆê³¼', 'other_company': 'íƒ€ì—…ì²´'
                };
                const statusText = statusMap[c.status] || c.status;

                return `
                    <div class="project-card" onclick="selectCustomer('${c.customerId}')">
                        <div class="project-card-header">
                            <div class="project-card-title">${c.clientName || 'ê³ ê°ëª… ì—†ìŒ'}</div>
                            <div class="project-card-client">${c.projectName || ''}</div>
                            <div class="project-card-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div class="project-card-footer">
                             <div>${c.siteAddress || '-'}</div>
                             <div>${c.manager ? c.manager.split(' ')[0] : 'ë¯¸ì§€ì •'}</div>
                        </div>
                    </div>
                 `;
            }).join('');
        }

        function updateCustomerList(resetPage = true) {
            const container = document.getElementById('customerList');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;

            // í•„í„°ë§
            filteredCustomers = customers.filter(c => {
                // customerIdê°€ ì—†ëŠ” í•­ëª© ì œì™¸
                if (!c.customerId) return false;

                // íœ´ì§€í†µ í•­ëª© ì œì™¸
                if (c.status === 'trash') return false;

                const matchSearch = [c.name, c.phone, c.siteAddress, c.projectName].join(' ').toLowerCase().includes(searchTerm);
                const matchStatus = currentStatusFilter === 'all' || c.status === currentStatusFilter;

                // ë…„/ì›” í•„í„° (customerId ê¸°ì¤€: YYMMDD-XXX)
                let matchDate = true;
                if (yearFilter || monthFilter) {
                    const idParts = (c.customerId || '').split('-')[0];
                    if (idParts && idParts.length >= 4) {
                        const year = '20' + idParts.substring(0, 2);
                        const month = idParts.substring(2, 4);
                        if (yearFilter && year !== yearFilter) matchDate = false;
                        if (monthFilter && month !== monthFilter) matchDate = false;
                    }
                }

                return matchSearch && matchStatus && matchDate;
            });

            // ìµœì‹ ìˆœ ì •ë ¬ (customerId ê¸°ì¤€: YYMMDD-XXX)
            filteredCustomers.sort((a, b) => {
                // createdAtì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                if (a.createdAt && b.createdAt) {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                // customerIdë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ) - YYMMDD-NNN í˜•ì‹
                const aId = a.customerId || '';
                const bId = b.customerId || '';
                const [aDate, aNum] = aId.split('-');
                const [bDate, bNum] = bId.split('-');
                // ë‚ ì§œ ë¹„êµ (ë‚´ë¦¼ì°¨ìˆœ)
                if (aDate !== bDate) {
                    return bDate.localeCompare(aDate);
                }
                // ê°™ì€ ë‚ ì§œë©´ ë²ˆí˜¸ ë¹„êµ (ë‚´ë¦¼ì°¨ìˆœ)
                return parseInt(bNum || 0) - parseInt(aNum || 0);
            });

            // í˜ì´ì§€ ë¦¬ì…‹ (í•„í„° ë³€ê²½ ì‹œ)
            if (resetPage) {
                currentPage = 1;
            }

            // í˜ì´ì§• ì ìš© ì—¬ë¶€ ê²°ì •
            const paginationContainer = document.getElementById('paginationContainer');
            const usePaging = filteredCustomers.length >= PAGE_THRESHOLD;

            if (usePaging) {
                // í˜ì´ì§• UI í‘œì‹œ
                paginationContainer.style.display = 'block';

                const totalPages = Math.ceil(filteredCustomers.length / ITEMS_PER_PAGE);
                const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, filteredCustomers.length);
                const pageItems = filteredCustomers.slice(startIdx, endIdx);

                // í˜ì´ì§• ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('paginationInfo').textContent =
                    `ì „ì²´ ${filteredCustomers.length}ëª… ì¤‘ ${startIdx + 1}-${endIdx}ëª… í‘œì‹œ`;
                document.getElementById('currentPageSpan').textContent =
                    `${currentPage} / ${totalPages}`;
                document.getElementById('prevPageBtn').disabled = currentPage <= 1;
                document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;

                // í˜ì´ì§•ëœ ëª©ë¡ ë Œë”ë§
                renderCustomerItems(container, pageItems);
            } else {
                // í˜ì´ì§• UI ìˆ¨ê¹€
                paginationContainer.style.display = 'none';

                // ì „ì²´ ëª©ë¡ ë Œë”ë§
                renderCustomerItems(container, filteredCustomers);
            }
            // [NEW] Update Main Board if visible
            const mainBoard = document.getElementById('mainBoardView');
            if (mainBoard && mainBoard.style.display !== 'none') {
                if (typeof renderMainBoard === 'function') renderMainBoard();
            }
        }

        // [NEW] ë©”ì¸ ë³´ë“œ ë³´ê¸° (í™ˆ ë²„íŠ¼)
        function showMainBoardView() {
            // 1. ê³ ê° ìƒì„¸ ë·° ìˆ¨ê¸°ê¸°
            const customerView = document.getElementById('customerView');
            if (customerView) customerView.style.display = 'none';

            // 2. ë©”ì¸ ë³´ë“œ ë³´ì´ê¸°
            const mainBoard = document.getElementById('mainBoardView');
            if (mainBoard) {
                mainBoard.style.display = 'block';
                renderMainBoard(); // ë°ì´í„° ê°±ì‹ 
            }

            // 3. ì‚¬ì´ë“œë°” ì„ íƒ í•´ì œ
            const activeItems = document.querySelectorAll('.customer-item.active');
            activeItems.forEach(el => el.classList.remove('active'));

            // 4. ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸°í™”
            currentCustomerId = null;
        }

        // ê³ ê° ëª©ë¡ ì•„ì´í…œ ë Œë”ë§ (ê³µí†µ)
        function renderCustomerItems(container, items) {
            if (items.length === 0) {
                container.innerHTML = '<div style="padding:30px 16px;text-align:center;color:#86868b;font-size:12px;">í•´ë‹¹ ì¡°ê±´ì˜ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                container.innerHTML = items.map(c => {
                    let statusKey = (c.status || '').trim();
                    if (!statusLabels[statusKey] && statusLabels[statusKey.toLowerCase()]) {
                        statusKey = statusKey.toLowerCase();
                    }
                    let statusText = statusLabels[statusKey] || c.status;
                    if (c.status === 'as_done' && c.asEndDate) {
                        statusText = `A/S ~${c.asEndDate}`;
                    }
                    // [MOD] Format: Name | Spouse | Project
                    let displayParts = [];
                    if (c.clientName || c.name) displayParts.push(c.clientName || c.name);
                    if (c.spouseName) displayParts.push(c.spouseName);
                    displayParts.push(c.projectName || 'í˜„ì¥ëª… ë¯¸ì§€ì •');
                    const displayName = displayParts.join(' | ');

                    // Sub info: Site Address only
                    let subInfo = c.siteAddress || 'ì£¼ì†Œ ë¯¸ì…ë ¥';
                    const lockIcon = c.isLocked ? 'ğŸ”’' : '';
                    const creatorInfo = c.createdBy ? ` / <span style="color:#ff9500; font-weight:600;">${c.createdBy}</span>` : '';
                    // [ìˆ˜ì •] ë‚ ì§œ(updatedAt) ì œê±° - ê³ ê°ëª©ë¡ì—ì„œ ë‚ ì§œ í‘œì‹œ ì•ˆí•¨

                    return `
                <div class="customer-item ${c.customerId === currentCustomerId ? 'active' : ''}"
                    data-customer-id="${c.customerId}"
                    onclick="selectCustomer('${c.customerId}')">
                    <div class="customer-item-header">
                        <span class="customer-item-id">${lockIcon}${c.customerId}${creatorInfo}</span>
                        <span class="status-badge ${statusKey}">${statusText}</span>
                    </div>
                    <div class="customer-item-name" style="font-weight: 700;">${displayName}</div>
                    <div class="customer-item-info">${subInfo}</div>
                </div>`;
                }).join('');
            }
        }

        // í˜ì´ì§• í•¨ìˆ˜
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateCustomerList(false);
            }
        }

        function goToNextPage() {
            const totalPages = Math.ceil(filteredCustomers.length / ITEMS_PER_PAGE);
            if (currentPage < totalPages) {
                currentPage++;
                updateCustomerList(false);
            }
        }

        // ë…„ë„ í•„í„° ì˜µì…˜ ì´ˆê¸°í™”
        function initYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const years = new Set();

            customers.forEach(c => {
                if (!c.customerId) return; // customerIdê°€ ì—†ìœ¼ë©´ ê±´ë„ˆë›°ê¸°
                const idParts = (c.customerId || '').split('-')[0];
                if (idParts && idParts.length >= 2) {
                    years.add('20' + idParts.substring(0, 2));
                }
            });

            // í˜„ì¬ ë…„ë„ë„ ì¶”ê°€
            const currentYear = new Date().getFullYear().toString();
            years.add(currentYear);

            // ì •ë ¬ í›„ ì˜µì…˜ ì¶”ê°€
            const sortedYears = [...years].sort().reverse();
            yearFilter.innerHTML = '<option value="">ì „ì²´ ë…„ë„</option>' +
                sortedYears.map(y => `<option value = "${y}" > ${y}ë…„</option> `).join('');
        }

        function filterCustomers() { updateCustomerList(); }


        // ==========================================
        // [ì›ê°€ê´€ë¦¬í‘œ DB ë³µêµ¬]
        // ==========================================
        async function restoreCostDB() {
            if (!isMainAdmin()) {
                showToast('ë©”ì¸ê´€ë¦¬ìë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (!confirm('í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ë°ì´í„°ë¡œ\nêµ¬ê¸€ ì‹œíŠ¸ì˜ [ì›ê°€ê´€ë¦¬í‘œë°ì´í„°ë² ì´ìŠ¤]ë¥¼ ì—…ë°ì´íŠ¸(ì €ì¥)í•©ë‹ˆë‹¤.\n\nêµ¬ê¸€ ì‹œíŠ¸ì˜ ê¸°ì¡´ ë°ì´í„°ëŠ” í˜„ì¬ ë°ì´í„°ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.\nì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            showToast('DB ì €ì¥(ë™ê¸°í™”) ì¤‘...', 'info');

            // DOMì—ì„œ ë°ì´í„° ì¶”ì¶œ
            const rows = [];
            const categoryDivs = document.querySelectorAll('#costCategories .category-section');
            let totalItems = 0;

            categoryDivs.forEach(div => {
                // ì¹´í…Œê³ ë¦¬ëª… ì¶”ì¶œ (ì˜ˆ: "01 ê°€ì„¤ê³µì‚¬")
                const catText = div.querySelector('h3')?.innerText || '';
                // "01 " ì œê±° (ì„ íƒì‚¬í•­ì´ë‚˜ ê¹”ë”í•˜ê²Œ)
                const catName = catText.replace(/^[0-9]+\s*/, '').trim();

                const trs = div.querySelectorAll('tbody tr');

                trs.forEach(tr => {
                    const inputs = tr.querySelectorAll('input');
                    const select = tr.querySelector('select');

                    // inputs: 0=êµ¬ë¶„, 1=í’ˆëª…, 2=ìƒì„¸, 3=ìˆ˜ëŸ‰, 4=ë‹¨ê°€
                    // (addCostRow êµ¬ì¡° ê¸°ì¤€)

                    const noVal = tr.querySelector('.col-no')?.textContent.trim() || '';
                    const name = inputs[1]?.value.trim() || '';
                    const spec = inputs[2]?.value.trim() || '';
                    const unit = select?.value || '';
                    const price = inputs[4]?.value.replace(/,/g, '') || '0';

                    // í’ˆëª…ì´ ìˆëŠ” ê²½ìš°ë§Œ ì €ì¥
                    if (name) {
                        // ['ì¹´í…Œê³ ë¦¬', 'No', 'í’ˆëª…', 'ìƒì„¸ë‚´ìš©', 'ë‹¨ìœ„', 'ë‹¨ê°€']
                        rows.push([catName, noVal, name, spec, unit, price]);
                        totalItems++;
                    }
                });
            });

            if (rows.length === 0) {
                showToast('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            console.log(`Saving ${rows.length} items to DB...`, rows);

            try {
                // CORS ëª¨ë“œ: no-cors ì œê±°
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'restoreCostDatabase',
                        data: rows
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`DB ì €ì¥ ì™„ë£Œ! (${result.message})`, 'success');
                } else {
                    // ì—ëŸ¬ ë©”ì‹œì§€ê°€ message í˜¹ì€ error í”„ë¡œí¼í‹°ì— ìˆì„ ìˆ˜ ìˆìŒ
                    const errMsg = result.message || result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    showToast('ì €ì¥ ì‹¤íŒ¨: ' + errMsg, 'error');
                }

            } catch (error) {
                console.error('DB Restore Error:', error);
                showToast('ì „ì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ==========================================
        // [ì»¤ìŠ¤í…€ ì•Œë¦¼ í•¨ìˆ˜] - ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ì•Œë¦¼ì°½
        // ==========================================
        function showPersistentAlert(message, type = 'success') {
            showToast(message, type);
        }

        // ==========================================
        // [í´ë¼ìš°ë“œ ë™ê¸°í™”] Google Sheetsì—ì„œ ê³ ê° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        // ==========================================
        // [Helper] Normalize status for UI compatibility
        function normalizeCustomerStatus(customerList) {
            const statusMapNormalizer = {
                'ìƒë‹´ì¤‘': 'consulting',
                'ê²¬ì ': 'estimate', 'ê²¬ì ì„œ': 'estimate',
                'ê³„ì•½ì™„ë£Œ': 'contracted',
                'ê³µì‚¬ì¤‘': 'in_progress',
                'ì™„ë£Œ': 'completed',
                'ê³µì‚¬ì™„ë£Œ': 'completed',
                'ASì™„ë£Œ': 'as_done', 'A/S': 'as_done', 'A/Sì™„ë£Œ': 'as_done',
                'ë³´ë¥˜': 'hold',
                'ì˜ˆì‚°ì´ˆê³¼': 'budget_over',
                'íƒ€ì—…ì²´': 'other_company', 'íƒ€ì‚¬ê³„ì•½': 'other_company'
            };

            customerList.forEach(c => {
                if (c.status && statusMapNormalizer[c.status]) {
                    c.status = statusMapNormalizer[c.status];
                }
                // Flatten key fields if needed (compatibility)
                if (!c.clientName && c.name) c.clientName = c.name;
            });
        }

        async function syncFromCloud(silent = false) {
            // [Task 3] Stabilization: Block UI during sync
            if (!silent) setAppBusy(true, 'ìµœì‹  í˜„ì¥ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');

            try {
                // [Phase 1] Load recent items first for speed (Pagination)
                const INITIAL_LOAD_LIMIT = 50;
                // Add sorting param if supported, but relying on backend "Recent First" logic for page=1
                const params = new URLSearchParams({
                    sheet: 'ê³ ê°ê´€ë¦¬_ê²¬ì ì„œ',
                    page: '1',
                    limit: INITIAL_LOAD_LIMIT.toString(),
                    t: new Date().getTime()
                });

                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                let initialData = await response.json();

                // Handle various response types (Array or {data: [], meta: {}})
                if (!Array.isArray(initialData) && initialData.data) {
                    initialData = initialData.data;
                } else if (!Array.isArray(initialData)) {
                    // If error object or unknown
                    if (initialData.error) throw new Error(initialData.error);
                    initialData = [];
                }

                if (initialData.length === 0) {
                    if (!silent) showToast('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    customers = [];
                    updateCustomerList();
                    return true;
                }

                // 1. Normalize & Update UI immediately
                normalizeCustomerStatus(initialData);

                // Replace local data with cloud data
                cloudCustomers = initialData;
                customers = cloudCustomers;

                // Render List
                updateCustomerList(true);
                initYearFilter();

                // Unblock UI immediately
                if (!silent) {
                    setAppBusy(false);
                    // showToast(`ìµœì‹  ${initialData.length}ê±´ ë¡œë“œ ì™„ë£Œ`, 'success');
                }

                // [Phase 2] Load remaining data in background if needed
                // If we received a full page (limit reached), assume there is more.
                // If backend ignored 'limit' and sent 1000 items, length > limit.
                if (initialData.length >= INITIAL_LOAD_LIMIT) {
                    console.log('ğŸ”„ [Background Sync] Fetching remaining data...');

                    const restParams = new URLSearchParams({
                        sheet: 'ê³ ê°ê´€ë¦¬_ê²¬ì ì„œ',
                        page: '2',          // Get the rest
                        limit: '10000',     // Large limit
                        t: new Date().getTime()
                    });

                    // Background fetch - do not await
                    fetch(`${CUSTOMER_SYNC_URL}?${restParams}`)
                        .then(res => res.json())
                        .then(restData => {
                            let restList = restData;
                            if (!Array.isArray(restList) && restList.data) restList = restList.data;

                            if (Array.isArray(restList) && restList.length > 0) {
                                console.log(`ğŸ”„ [Background Sync] Received ${restList.length} more records.`);
                                normalizeCustomerStatus(restList);

                                // Merge: We append restList to cloudCustomers
                                // (Assuming 'page=2' returns OLDER items if page=1 was recent)

                                // Use Map to ensure no duplicates in case of overlap or ID collision
                                const currentMap = new Map();
                                cloudCustomers.forEach(c => currentMap.set(c.customerId, c));
                                restList.forEach(c => currentMap.set(c.customerId, c));

                                // Update global list
                                cloudCustomers = Array.from(currentMap.values());
                                customers = cloudCustomers;

                                // Silent update (maintain scroll/page)
                                updateCustomerList(false);
                                initYearFilter();

                                console.log('âœ… [Background Sync] Complete. Total:', cloudCustomers.length);
                                if (!silent) showToast(`ì „ì²´ ë™ê¸°í™” ì™„ë£Œ (ì´ ${cloudCustomers.length}ëª…)`, 'success');
                            }
                        })
                        .catch(err => console.error('Background fetch failed:', err));
                } else {
                    if (!silent) showToast(`ë™ê¸°í™” ì™„ë£Œ (ì´ ${cloudCustomers.length}ëª…)`, 'success');
                }

                return true;

            } catch (error) {
                console.error('âŒ [Cloud Sync] Error:', error);
                if (!silent) showPersistentAlert(`í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹¤íŒ¨\n\n${error.message}`, 'error');
                return false;
            } finally {
                // Safety: Ensure busy is off
                if (!silent) setAppBusy(false);
            }
        }

        async function syncToGoogleSheets(data) {
            console.log('ğŸ“¤ [Google Sheets Sync] Starting sync process...');
            console.log('ğŸ“‹ [Google Sheets Sync] Customer Data:', data);

            try {
                const statusKey = (data.status || '').trim();
                let koreanStatus = statusLabels[statusKey] || statusLabels[statusKey.toLowerCase()] || data.status;

                const payload = {
                    sheetName: 'ê³ ê°ê´€ë¦¬_ê²¬ì ì„œ',
                    data: {
                        customerId: data.customerId || '',
                        clientName: data.clientName || '',
                        clientPhone: data.clientPhone || '',
                        clientEmail: data.clientEmail || '',
                        status: koreanStatus, // Send Korean status
                        createdAt: data.createdAt || new Date().toISOString(),
                        clientAddress: data.clientAddress || '',
                        projectName: data.projectName || '',
                        siteAddress: data.siteAddress || '',
                        constructionPeriod: data.constructionPeriod || '',
                        movingDate: data.movingDate || '',           // ì´ì‚¬ì˜ˆì •ì¼ ì¶”ê°€
                        finalPaymentDate: data.finalPaymentDate || '', // ì”ê¸ˆì¼
                        contractDate: data.contractDate || '', // ê³„ì•½ì¼
                        warrantyPeriod: data.asEndDate ? (data.asEndDate) : '', // A/S ê¸°ê°„
                        asEndDate: data.asEndDate || '',             // A/S ì¢…ë£Œì¼ ì¶”ê°€

                        pyeong: data.area || '',
                        inflowPath: data.clientSource || '',      // ìœ ì…ê²½ë¡œ
                        buildingType: data.buildingType || '',    // ê±´ë¬¼ìœ í˜•
                        totalAmount: data.totalAmount || '',
                        estimateProfitRate: data.profitRate || (data.estimateProfitRate ? data.estimateProfitRate + '%' : '15%'),
                        manager: data.manager || '',              // ë‹´ë‹¹ì ì¶”ê°€
                        updatedAt: data.updatedAt || '',          // ìµœì¢…ìˆ˜ì •ì¼ ì¶”ê°€
                        jsonData: JSON.stringify(data)
                    }
                };


                console.log('ğŸ“¦ [Web Save] Payload:', payload);
                console.log('ğŸ“¦ [Web Save] Payload (full):', JSON.stringify(payload, null, 2));
                console.log('ğŸ“¦ [Web Save] jsonData field length:', payload.data.jsonData.length);
                console.log('ğŸ“¦ [Web Save] jsonData contains checklistData?', payload.data.jsonData.includes('checklistData'));

                // Parse jsonData to verify checklistData is included
                try {
                    const parsedJsonData = JSON.parse(payload.data.jsonData);
                    console.log('ğŸ“¦ [Web Save] Verified - checklistData in jsonData:', Object.keys(parsedJsonData.checklistData || {}).length, 'items');
                    if (parsedJsonData.checklistData && Object.keys(parsedJsonData.checklistData).length > 0) {
                        console.log('ğŸ“¦ [Web Save] Sample checklist items:', Object.entries(parsedJsonData.checklistData).slice(0, 3).map(([k, v]) => `${k}: ${v}`));
                    }
                } catch (e) {
                    console.error('âŒ [Web Save] Failed to verify jsonData:', e);
                }

                console.log('ğŸŒ [Google Sheets Sync] Target URL:', CUSTOMER_SYNC_URL);

                // no-cors ëª¨ë“œ ì œê±°í•˜ì—¬ ì‹¤ì œ ì‘ë‹µ í™•ì¸ ê°€ëŠ¥
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                console.log('ğŸ“¡ [Google Sheets Sync] Response status:', response.status);
                console.log('ğŸ“¡ [Google Sheets Sync] Response headers:', [...response.headers.entries()]);

                // ì‘ë‹µ ë³¸ë¬¸ í™•ì¸
                const responseText = await response.text();
                console.log('ğŸ“„ [Google Sheets Sync] Response text:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('âœ… [Google Sheets Sync] Parsed response:', result);
                } catch (e) {
                    console.warn('âš ï¸ [Google Sheets Sync] Response is not JSON:', responseText);
                }

                if (response.ok || response.status === 200) {
                    console.log('âœ… [Google Sheets Sync] Request completed successfully');
                    showToast('êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™” ì™„ë£Œ!', 'success');
                } else {
                    throw new Error(`HTTP${response.status}: ${responseText} `);
                }

            } catch (error) {
                console.error('âŒ [Google Sheets Sync] Error:', error);
                console.error('âŒ [Google Sheets Sync] Error name:', error.name);
                console.error('âŒ [Google Sheets Sync] Error message:', error.message);
                console.error('âŒ [Google Sheets Sync] Error stack:', error.stack);

                // CORS ì—ëŸ¬ì¸ ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showToast('êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™”: CORS ì—ëŸ¬. GAS ë°°í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'error');
                    console.error('ğŸ’¡ [Google Sheets Sync] Hint: Apps Scriptê°€ "ëª¨ë“  ì‚¬ìš©ì(ìµëª… ì‚¬ìš©ì í¬í•¨)" ê¶Œí•œìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                } else {
                    showToast('êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
                }
            }
        }

        async function saveData() {
            if (!currentCustomerId) return showToast('ë¨¼ì € ê³ ê°ì„ ë“±ë¡í•˜ì„¸ìš”', 'error');

            if (!isLoggedIn()) {
                showToast('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (ì—´ëŒ ëª¨ë“œì—ì„œëŠ” ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)', 'error');
                showAdminModal();
                return;
            }

            // ì ê¸ˆëœ ê³ ê°ì€ ë¹„ë°€ë²ˆí˜¸ í•„ìš”
            if (isCustomerLocked()) {
                showDeletePasswordModal(() => {
                    performSaveData();
                });
                return;
            }

            performSaveData();
        }

        function performSaveData() {
            // [ìˆ˜ì •] ì›ê°€ê´€ë¦¬í‘œ(CostData)ëŠ” ê³ ê° ë°ì´í„°(Quote)ë¥¼ ìœ„í•´ ì €ì¥í•©ë‹ˆë‹¤.
            // ë‹¨, ê¸€ë¡œë²Œ DB(Master Spec)ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. (Read-Only Policy)
            if (isLoggedIn()) {
                saveCostData();
            }

            // ê³ ê°ë³„ ê²¬ì  ë°ì´í„°ëŠ” í•­ìƒ ì €ì¥
            saveEstimateData();

            // [ì¶”ê°€] ì²´í¬ë¦¬ìŠ¤íŠ¸ í•„í„° ìƒíƒœ ì €ì¥
            if (typeof multiSelectState !== 'undefined') {
                currentData.checklistFilters = JSON.parse(JSON.stringify(multiSelectState));
            }
            const idx = customers.findIndex(c => c.customerId === currentCustomerId);

            // FUNDAMENTAL LOCK CHECK
            if (idx >= 0) {
                const original = customers[idx];

                // If it was locked, BLOCK save operations (except for main admin)
                if (original.isLocked && !isMainAdmin()) {
                    showToast('ì ê¸ˆ ìƒíƒœì—ì„œëŠ” ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                // ì‘ì„±ì ê¶Œí•œ ì²´í¬: ì‘ì„±ì ë˜ëŠ” ë©”ì¸ê´€ë¦¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥
                if (original.createdBy && String(original.createdBy).trim().toLowerCase() !== String(currentAdmin?.id).trim().toLowerCase() && !isMainAdmin()) {
                    showToast(`ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. (ì‘ì„±ì: ${original.createdBy})`, 'error');
                    return;
                }

                // ì²« ì €ì¥ ì‹œ ì‘ì„±ì í• ë‹¹ (createdByê°€ ì—†ëŠ” ê²½ìš°)
                if (!original.createdBy && currentAdmin) {
                    currentData.createdBy = currentAdmin.id;
                }

                // ìˆ˜ì •ì¼ ì—…ë°ì´íŠ¸
                currentData.updatedAt = new Date().toISOString().split('T')[0];

                customers[idx] = { ...currentData };
            } else {
                // ìƒˆ ê³ ê°: ì‘ì„±ì í• ë‹¹
                if (!currentData.createdBy && currentAdmin) {
                    currentData.createdBy = currentAdmin.id;
                }
                customers.push({ ...currentData });
            }
            // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€


            // ë¦¬ìŠ¤íŠ¸ UI ì¦‰ì‹œ ê°±ì‹  (ìµœì¢…ìˆ˜ì •ì¼ ë“± ë°˜ì˜)
            updateCustomerList();

            if (isLoggedIn()) {
                showSaveConfirmToast('âœ… ì €ì¥ ì™„ë£Œ! (ì›ê°€ê´€ë¦¬í‘œ ì œì™¸)');
            } else {
                showSaveConfirmToast('âœ… ì €ì¥ ì™„ë£Œ!');
            }

            // Google Sheets ë™ê¸°í™” (ë°±ê·¸ë¼ìš´ë“œ)
            syncToGoogleSheets({ ...currentData });

            // ì €ì¥ í›„ í™”ë©´ ìœ ì§€ (ê³ ê° ëª©ë¡ë§Œ ê°±ì‹ )
            updateCustomerList();
        }

        function createCoverTable() {
            const tbody = document.getElementById('coverTableBody');
            let html = categories.map((cat, i) => `
                <tr >
                <td class="no">${i + 1}</td>
                <td>${cat.name}</td>
                <td class="amount" id="coverCat${cat.no}"><div class="money-align"><span class="currency">â‚©</span><span class="value">0</span></div></td>
            </tr>
                `).join('');
            html += `
                <tr class="subtotal" >
                <td></td>
                <td>ì†Œê³„ (ê³µê¸‰ê°€ì•¡)</td>
                <td class="amount" id="coverSubtotal"><div class="money-align"><span class="currency">â‚©</span><span class="value">0</span></div></td>
            </tr>
            <tr style="background:#f0f7ff;">
                <td></td>
                <td>ê¸°ì—…ì´ìœ¤ (<span id="coverProfitRate">0</span>%)</td>
                <td class="amount" id="coverProfit"><div class="money-align"><span class="currency">â‚©</span><span class="value">0</span></div></td>
            </tr>
            <tr class="vat">
                <td></td>
                <td>ë¶€ê°€ê°€ì¹˜ì„¸ (VAT 10%)</td>
                <td class="amount" id="coverVat"><div class="money-align"><span class="currency">â‚©</span><span class="value">0</span></div></td>
            </tr>
            <tr class="total">
                <td></td>
                <td>ì´ ê³„ì•½ê¸ˆì•¡</td>
                <td class="amount" id="coverTotal"><div class="money-align"><span class="currency">â‚©</span><span class="value">0</span></div></td>
            </tr>
            `;
            tbody.innerHTML = html;
        }


        function createCostCategories() {
            const container = document.getElementById('costCategories');
            container.innerHTML = categories.map(cat => `
                <div class="category-section" >
                <div class="category-header">
                    <h3><span class="cat-no">${cat.no}</span> ${cat.name}</h3>
                    <div class="subtotal">â‚© <span id="costSubtotal${cat.no}">0</span></div>
                </div>
                <table class="data-table">
                    <colgroup>
                        <col style="width:35px;"><!-- No-->
                        <col style="width:50px;"><!-- êµ¬ë¶„ -->
                        <col style="width:160px;"><!-- í’ˆëª… -->
                        <col style="width:auto;"><!-- ìƒì„¸ë‚´ìš© (ë‚˜ë¨¸ì§€ ê³µê°„) -->
                        <col style="width:55px;"><!-- ë‹¨ìœ„ -->
                        <col style="width:65px;"><!-- ìˆ˜ëŸ‰ -->
                        <col style="width:70px;"><!-- ë‹¨ê°€ -->
                        <col style="width:80px;"><!-- í•©ê³„ -->
                    </colgroup>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>êµ¬ë¶„</th>
                            <th>í’ˆëª…</th>
                            <th>ìƒì„¸ë‚´ìš©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ë‹¨ê°€</th>
                            <th>í•©ê³„</th>
                        </tr>
                    </thead>
                    <tbody id="costBody${cat.no}">
                        <tr>
                            <td class="col-no">1</td>
                            <td class="col-div"><input type="text" placeholder="êµ¬ë¶„" readonly></td>
                            <td class="col-name"><input type="text" placeholder="í’ˆëª…" readonly></td>
                            <td class="col-spec"><input type="text" placeholder="ìƒì„¸" readonly></td>
                            <td class="col-unit">${getUnitSelectHTML()}</td>
                            <td class="col-qty"><input type="text" placeholder="ìˆ˜ëŸ‰" oninput="calcCostRow(this)" readonly></td>
                            <td class="col-price"><input type="text" placeholder="ë‹¨ê°€" oninput="calcCostRow(this)" readonly></td>
                            <td class="col-total">0</td>
                        </tr>
                    </tbody>
                </table>
                <div class="category-memo"><label>MEMO</label><textarea id="costMemo${cat.no}" placeholder="Master Data (Read Only)" readonly
                        oninput="autoResizeTextarea(this);"></textarea></div>
                <!-- Master DB ë³´í˜¸ë¥¼ ìœ„í•´ í•­ëª© ì¶”ê°€ ë²„íŠ¼ ì œê±° -->
            </div>
            `).join('');
        }

        function addCostRow(catNo) {
            const tbody = document.getElementById(`costBody${catNo}`);
            const n = tbody.querySelectorAll('tr').length + 1;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="col-no">${n}</td>
            <td class="col-div"><input type="text"></td>
            <td class="col-name"><input type="text"></td>
            <td class="col-spec"><input type="text"></td>
            <td class="col-unit">${getUnitSelectHTML()}</td>
            <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
            <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
            <td class="col-total">0</td>`;
            tbody.appendChild(tr);
        }

        // ì›ê°€ê´€ë¦¬í‘œëŠ” ì „ì—­ ë°ì´í„°ë¡œ ê´€ë¦¬ (ëª¨ë“  ê³ ê°ì—ê²Œ ë™ì¼)
        // ê³„ì•½ê²¬ì ì„œëŠ” ê³ ê°ë³„ë¡œ ë…ë¦½ ê´€ë¦¬

        // ê³„ì•½ê²¬ì ì„œì—ì„œ ìƒì„¸ë‚´ìš© ë“œë¡­ë‹¤ìš´ ì„ íƒ ì‹œ


        // ì›ê°€ê´€ë¦¬í‘œ í–‰ë³„ í•©ê³„ ê³„ì‚°
        function calcCostRow(input) {
            const row = input.closest('tr');
            const inputs = row.querySelectorAll('input');
            const qty = parseNumber(inputs[3]?.value) || 0;
            const price = parseNumber(inputs[4]?.value) || 0;
            const total = qty * price;

            const totalCell = row.querySelector('.col-total');
            if (totalCell) {
                totalCell.textContent = formatNumber(total);
            }

            // ì¹´í…Œê³ ë¦¬ ì†Œê³„ ì—…ë°ì´íŠ¸
            const tbody = row.closest('tbody');
            if (tbody && tbody.id) {
                const catNo = tbody.id.replace('costBody', '');
                updateCostCategorySubtotal(catNo);
            }
        }

        // ì›ê°€ê´€ë¦¬í‘œ ì¹´í…Œê³ ë¦¬ë³„ ì†Œê³„ ê³„ì‚°
        function updateCostCategorySubtotal(catNo) {
            const tbody = document.getElementById(`costBody${catNo}`);
            const subtotalSpan = document.getElementById(`costSubtotal${catNo}`);
            if (!tbody || !subtotalSpan) return;

            let subtotal = 0;
            tbody.querySelectorAll('tr').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const qty = parseNumber(inputs[3]?.value) || 0;
                const price = parseNumber(inputs[4]?.value) || 0;
                subtotal += qty * price;
            });

            subtotalSpan.textContent = formatNumber(subtotal);
        }

        function createEstimateCategories() {
            const container = document.getElementById('estimateCategories');
            container.innerHTML = categories.map(cat => `
            <div class="category-section">
                <div class="category-header">
                    <h3><span class="cat-no">${cat.no}</span> ${cat.name}</h3>
                    <div class="subtotal">â‚© <span id="estSubtotal${cat.no}">0</span></div>
                </div>
                <table class="estimate-table">
                    <colgroup>
                        <col><!-- No-->
                        <col class="col-div"><!-- êµ¬ë¶„ (ì¸ì‡„ì‹œ ìˆ¨ê¹€) -->
                        <col><!-- í’ˆëª… -->
                        <col><!-- ìƒì„¸ë‚´ìš© -->
                        <col><!-- ë‹¨ìœ„ -->
                        <col><!-- ìˆ˜ëŸ‰ -->
                        <col><!-- ë‹¨ê°€ -->
                        <col><!-- ê¸ˆì•¡ -->
                        <col><!-- ë¹„ê³  -->

                    </colgroup>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th class="col-div">êµ¬ë¶„</th>
                            <th>í’ˆëª…</th>
                            <th>ìƒì„¸ë‚´ìš©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ë‹¨ê°€</th>
                            <th>ê¸ˆì•¡</th>
                            <th>ë¹„ê³ </th>

                        </tr>
                    </thead>
                    <tbody id="estBody${cat.no}">
                        <tr class="draggable-row" draggable="true" ondragstart="onEstRowDragStart(event)" ondragover="onEstRowDragOver(event)" ondragend="onEstRowDragEnd(event)">
                            <td class="drag-handle" style="position: relative;">
                                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${cat.no}')" title="ì‚­ì œ">
                                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                                </button>
                                1
                            </td>
                            <td class="col-div"><select class="div-select" onchange="onEstDivChange(this, '${cat.no}')">
                                    <option value="">ì„ íƒ</option>
                                </select></td>
                            <td><select class="name-select" onchange="onEstNameChange(this, '${cat.no}')" disabled>
                                    <option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>
                                </select></td>
                            <td class="spec-cell">-</td>
                            <td class="unit-cell">-</td>
                            <td><input type="number" class="qty-input" value="1" min="0"
                                    onchange="onEstQtyChange(this, '${cat.no}')"></td>
                            <td class="price-cell" data-price="0"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
                            <td class="amount-cell"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
                            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()"></div></td>
                        </tr>
                    </tbody>
                </table>
                <div class="estimate-memo" id="estMemo${cat.no}">
                    <div style="color:#0071e3; font-weight:600; margin-bottom:6px;">ğŸ“ ë©”ëª¨</div>
                    <div class="memo-editable text-formattable" id="estMemoText${cat.no}" contenteditable="true"
                        data-placeholder="ë©”ëª¨ ì…ë ¥..." oninput="saveEstimateData()"></div>
                </div>
                <button class="add-row-btn no-print" onclick="addEstimateRowTo('${cat.no}')">+ í•­ëª© ì¶”ê°€</button>
            </div>
            `).join('');

            // ê° ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë¶„ ì˜µì…˜ ì´ˆê¸°í™”
            categories.forEach(cat => {
                updateDivOptions(cat.no);
            });

            // ì…€ í´ë¦­ í¸ì§‘ ì´ë²¤íŠ¸ ìœ„ì„ (spec-cell, unit-cell, price-cell)
            container.addEventListener('click', function (e) {
                const specCell = e.target.closest('.spec-cell');
                const unitCell = e.target.closest('.unit-cell');
                const priceCell = e.target.closest('.price-cell');

                if (specCell && !specCell.querySelector('input')) {
                    // ë“œë¡­ë‹¤ìš´(select)ì´ ì•„ë‹Œ í…ìŠ¤íŠ¸ ì˜ì—­ì„ í´ë¦­í•œ ê²½ìš° í¸ì§‘ ëª¨ë“œ ì „í™˜
                    if (!specCell.querySelector('select')) {
                        const row = specCell.closest('tr');
                        const catNo = row.closest('tbody').id.replace('estBody', '');
                        makeSpecEditable(specCell, catNo);
                        return;
                    }
                }
                if (unitCell && !unitCell.querySelector('input')) {
                    const row = unitCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    makeUnitEditable(unitCell, catNo);
                    return;
                }
                if (priceCell && !priceCell.querySelector('input')) {
                    const row = priceCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    makePriceEditable(priceCell, catNo);
                    return;
                }
            });

            // ë”ë¸”í´ë¦­: ë“œë¡­ë‹¤ìš´ì´ ìˆëŠ” spec-cellë„ ì§ì ‘ í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜
            container.addEventListener('dblclick', function (e) {
                const specCell = e.target.closest('.spec-cell');
                if (specCell && specCell.querySelector('select') && !specCell.querySelector('input')) {
                    const row = specCell.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');
                    convertSpecSelectToInput(specCell, catNo);
                    return;
                }
            });

            // ì—”í„° í‚¤ë¡œ ëª¨ë“  ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ í•´ì œ (ì „ì—­ ì´ë²¤íŠ¸ ìœ„ì„)
            container.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    const target = e.target;
                    // input, textareaì—ì„œ ì—”í„° ì‹œ blur (textareaëŠ” shift+enterë¡œ ì¤„ë°”ê¿ˆ í—ˆìš©)
                    if (target.tagName === 'INPUT' || (target.tagName === 'TEXTAREA' && !e.shiftKey)) {
                        e.preventDefault();
                        target.blur();
                    }
                }
            });

            // select ë”ë¸”í´ë¦­ ê°ì§€ (selectëŠ” ë¸Œë¼ìš°ì €ê°€ dblclickì„ ë¨¹ìœ¼ë¯€ë¡œ mousedown íƒ€ì´ë°ìœ¼ë¡œ ì²˜ë¦¬)
            let lastSelectClick = { time: 0, target: null };
            container.addEventListener('mousedown', function (e) {
                const selectEl = e.target.closest('select.div-select, select.name-select, select.spec-select');
                if (!selectEl) { lastSelectClick = { time: 0, target: null }; return; }

                const now = Date.now();
                if (lastSelectClick.target === selectEl && (now - lastSelectClick.time) < 400) {
                    // ë”ë¸”í´ë¦­ ê°ì§€
                    e.preventDefault();
                    e.stopPropagation();
                    const row = selectEl.closest('tr');
                    const catNo = row.closest('tbody').id.replace('estBody', '');

                    if (selectEl.classList.contains('div-select')) {
                        convertDivSelectToInput(selectEl, row, catNo);
                    } else if (selectEl.classList.contains('name-select')) {
                        convertNameSelectToInput(selectEl, row, catNo);
                    } else if (selectEl.classList.contains('spec-select')) {
                        convertSpecSelectToInput(selectEl.closest('.spec-cell'), catNo);
                    }
                    lastSelectClick = { time: 0, target: null };
                } else {
                    lastSelectClick = { time: now, target: selectEl };
                }
            });

            // selectì˜ ì´ì „ ê°’ ì¶”ì  (focus ì‹œ ì €ì¥) - ë‚´ìš©ìˆ˜ì •ìš©
            container.addEventListener('focus', function (e) {
                const sel = e.target;
                if (sel.tagName === 'SELECT' && (sel.classList.contains('div-select') || sel.classList.contains('name-select') || sel.classList.contains('spec-select'))) {
                    sel._prevValue = sel.value;
                    const opt = sel.selectedOptions[0];
                    // spec-selectì˜ ê²½ìš° data-spec ìš°ì„ , ê·¸ ì™¸ëŠ” textContent
                    sel._prevText = opt?.dataset?.spec || opt?.textContent?.trim() || '';
                }
            }, true);

            // ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ ì´ˆê¸°í™”
            initColumnResize();
        }

        // êµ¬ë¶„ select â†’ input ì „í™˜ (ë”ë¸”í´ë¦­ìš©)
        function convertDivSelectToInput(selectEl, row, catNo) {
            const td = selectEl.closest('td');
            const currentVal = selectEl.value || '';
            const currentText = selectEl.selectedOptions[0]?.textContent?.trim() || '';
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
            const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');

            td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${currentVal && currentVal !== '__custom_div__' ? currentVal : ''}" placeholder="êµ¬ë¶„ ì…ë ¥"
                onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
            const inp = td.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                        <option value="">ì„ íƒ</option>${divOpts}<option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option></select>`;
                    if (currentVal && currentVal !== '__custom_div__') {
                        td.querySelector('.div-select').value = currentVal;
                    }
                    saveEstimateData();
                }
            });
            inp.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
        }

        // í’ˆëª… select â†’ input ì „í™˜ (ë”ë¸”í´ë¦­ìš©)
        function convertNameSelectToInput(selectEl, row, catNo) {
            const td = selectEl.closest('td');
            const currentVal = selectEl.value || '';
            const currentText = selectEl.selectedOptions[0]?.textContent?.trim() || '';
            const divSelect = row.querySelector('.div-select');
            const divCustom = row.querySelector('.div-custom-input');
            const curDiv = divCustom ? divCustom.value : (divSelect ? divSelect.value : '');
            const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
            const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
            const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');

            const displayVal = currentVal && currentVal !== '__custom_name__' && currentText !== 'í’ˆëª… ì„ íƒ' && currentText !== 'êµ¬ë¶„ ë¨¼ì € ì„ íƒ' ? currentText : '';
            td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${displayVal}" placeholder="í’ˆëª… ì…ë ¥"
                onchange="saveEstimateData()">`;
            const inp = td.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                        ${curDiv ? '<option value="">í’ˆëª… ì„ íƒ</option>' + nameOpts + '<option value="__edit_name__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_name__">âœï¸ ì§ì ‘ì…ë ¥</option>' : '<option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>'}</select>`;
                    if (currentVal && currentVal !== '__custom_name__') {
                        const ns = td.querySelector('.name-select');
                        for (let opt of ns.options) {
                            if (opt.value === currentVal) { opt.selected = true; break; }
                        }
                    }
                    saveEstimateData();
                }
            });
            inp.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
        }

        // ìƒì„¸ë‚´ìš© select â†’ input ì „í™˜ (ë”ë¸”í´ë¦­ìš©)
        function convertSpecSelectToInput(specCell, catNo) {
            const specSelect = specCell.querySelector('select');
            const selectedOpt = specSelect?.selectedOptions[0];
            const currentSpec = selectedOpt?.dataset?.spec || selectedOpt?.textContent?.trim() || '';
            const savedHTML = specCell.innerHTML;

            specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${currentSpec && currentSpec !== 'ìƒì„¸ ì„ íƒ' ? currentSpec : ''}"
                placeholder="ìƒì„¸ë‚´ìš© ì…ë ¥" onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            const inp = specCell.querySelector('input');
            inp.focus();
            inp.select();
            inp.addEventListener('keydown', function (ev) {
                if (ev.key === 'Enter') {
                    ev.preventDefault();
                    inp.blur();
                } else if (ev.key === 'Escape') {
                    specCell.innerHTML = savedHTML;
                    saveEstimateData();
                }
            });

        }

        // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ êµ¬ë¶„ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateDivOptions(catNo) {
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();

            const tbody = document.getElementById(`estBody${catNo}`);
            if (!tbody) return;

            tbody.querySelectorAll('.div-select').forEach(select => {
                const currentVal = select.value;
                select.innerHTML = '<option value="">ì„ íƒ</option>' + divs.map(d =>
                    `<option value="${d}" ${d === currentVal ? 'selected' : ''}>${d}</option>`
                ).join('') + '<option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option>';
            });
        }

        // íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ ì›ê°€ í•­ëª© ê°€ì ¸ì˜¤ê¸° (ì „ì—­ ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„° ì‚¬ìš©)
        function getCostItemsByCategory(catNo) {
            // ì „ì—­ ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸° (Phase 2: In-memory ì‚¬ìš©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');
            let data = globalCostData[`cost_${catNo}`] || [];

            // ì „ì—­ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
            if (data.length === 0 && defaultCostData[catNo]) {
                data = defaultCostData[catNo];
            }

            const items = [];
            data.forEach(item => {
                if (item.name) {
                    // price í•„ë“œ ìš°ì„ , ì—†ìœ¼ë©´ material+labor+expense í•©ì‚° (ê¸°ì¡´ ë°ì´í„° í˜¸í™˜)
                    const unitPrice = parseNumber(item.price) || ((parseNumber(item.material) || 0) + (parseNumber(item.labor)
                        || 0) + (parseNumber(item.expense) || 0));
                    items.push({
                        div: item.div || '',
                        name: item.name,
                        spec: item.spec || '',
                        unit: item.unit || '',
                        unitPrice: unitPrice
                    });
                }
            });
            return items;
        }

        // êµ¬ë¶„ë³„ í’ˆëª… ëª©ë¡
        function getItemsByDivInCat(catNo, div) {
            const items = getCostItemsByCategory(catNo);
            return items.filter(i => i.div === div);
        }

        // ê²¬ì  í–‰ ì¶”ê°€
        function addEstimateRowTo(catNo) {
            const tbody = document.getElementById(`estBody${catNo}`);
            const rowCount = tbody.querySelectorAll('tr').length + 1;
            const items = getCostItemsByCategory(catNo);
            const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
            const divOptions = divs.map(d => `<option value="${d}">${d}</option>`).join('');

            const tr = document.createElement('tr');
            tr.className = 'draggable-row';
            tr.draggable = true;
            tr.ondragstart = onEstRowDragStart;
            tr.ondragover = onEstRowDragOver;
            tr.ondragend = onEstRowDragEnd;
            tr.innerHTML = `
            <td class="drag-handle" style="position: relative;">
                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${catNo}')" title="ì‚­ì œ">
                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                </button>
                ${rowCount}
            </td>
            <td class="col-div"><select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                    <option value="">ì„ íƒ</option>${divOptions}
                    <option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option>
                    <option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option>
                </select></td>
            <td><select class="name-select" onchange="onEstNameChange(this, '${catNo}')" disabled>
                    <option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>
                </select></td>
            <td class="spec-cell">-</td>
            <td class="unit-cell">-</td>
            <td><input type="number" class="qty-input" value="1" min="0" onchange="onEstQtyChange(this, '${catNo}')">
            </td>
            <td class="price-cell" data-price="0"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
            <td class="amount-cell"><div class="money-wrapper"><span style="margin:auto">-</span></div></td>
            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()"></div></td>
            `;
            tbody.appendChild(tr);
        }

        // ê²¬ì  í–‰ ì‚­ì œ
        function deleteEstimateRow(btn, catNo) {
            const row = btn.closest('tr');
            const tbody = row.closest('tbody');
            row.remove();

            // ë²ˆí˜¸ ì¬ì •ë ¬ ë° ì‚­ì œ ë²„íŠ¼ ìœ ì§€
            renumberEstimateRows(tbody, catNo);

            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // êµ¬ë¶„ ì„ íƒ ë³€ê²½
        function onEstDivChange(select, catNo) {
            const row = select.closest('tr');
            const nameSelect = row.querySelector('.name-select');
            const div = select.value;

            // _prevValueëŠ” focus ì´ë²¤íŠ¸ì—ì„œ ì €ì¥ (ì•„ë˜ initSelectPrevTracking ì°¸ì¡°)
            if (div === '__edit_div__') {
                // ë‚´ìš©ìˆ˜ì •: ì´ì „ì— ì„ íƒëœ ê°’ì„ ìœ ì§€í•œ ì±„ inputìœ¼ë¡œ ì „í™˜
                const td = select.closest('td');
                const prevSelected = select._prevValue || '';
                const items = getCostItemsByCategory(catNo);
                const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${prevSelected}" placeholder="êµ¬ë¶„ ìˆ˜ì •"
                    onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                const editInput = td.querySelector('input');
                editInput.focus();
                editInput.select();
                editInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); editInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                            <option value="">ì„ íƒ</option>${divOpts}<option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option></select>`;
                        if (prevSelected) td.querySelector('.div-select').value = prevSelected;
                        saveEstimateData();
                    }
                });
                editInput.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                return;
            }

            if (div === '__custom_div__') {
                // ì§ì ‘ì…ë ¥: selectë¥¼ inputìœ¼ë¡œ êµì²´ (ESCë¡œ ë³µì› ê°€ëŠ¥)
                const td = select.closest('td');
                const items = getCostItemsByCategory(catNo);
                const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                const divOpts = divs.map(d => `<option value="${d}">${d}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input div-custom-input" placeholder="êµ¬ë¶„ ì…ë ¥"
                    onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                const divInput = td.querySelector('input');
                divInput.focus();
                divInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); divInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="div-select" onchange="onEstDivChange(this, '${catNo}')">
                            <option value="">ì„ íƒ</option>${divOpts}<option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option></select>`;
                        // í’ˆëª…ë„ ë‹¤ì‹œ selectë¡œ
                        const nameTd = row.children[2];
                        nameTd.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" disabled>
                            <option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option></select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                divInput.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                // í’ˆëª…ë„ ì§ì ‘ì…ë ¥ ëª¨ë“œë¡œ
                const nameTd = nameSelect.closest('td');
                nameTd.innerHTML = `<input type="text" class="editable-input name-custom-input" placeholder="í’ˆëª… ì…ë ¥"
                    onchange="saveEstimateData()">`;
                const nameInput = nameTd.querySelector('input');
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        const divSel = row.querySelector('.div-select');
                        const curDiv = divSel ? divSel.value : '';
                        nameTd.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            <option value="">${curDiv ? 'í’ˆëª… ì„ íƒ' : 'êµ¬ë¶„ ë¨¼ì € ì„ íƒ'}</option></select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                resetEstRowValues(row);
                enableDirectEditCells(row, catNo);
                return;
            }

            if (!div) {
                nameSelect.innerHTML = '<option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>';
                nameSelect.disabled = true;
                resetEstRowValues(row);
                return;
            }

            const items = getItemsByDivInCat(catNo, div);

            // ê³ ìœ í•œ í’ˆëª…ë§Œ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
            const uniqueNames = [...new Set(items.map(item => item.name).filter(n => n))];

            nameSelect.innerHTML = '<option value="">í’ˆëª… ì„ íƒ</option>' + uniqueNames.map(name =>
                `<option value="${name}">${name}</option>`
            ).join('') + '<option value="__edit_name__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_name__">âœï¸ ì§ì ‘ì…ë ¥</option>';
            nameSelect.disabled = false;
            resetEstRowValues(row);
        }

        // í’ˆëª… ì„ íƒ ë³€ê²½
        function onEstNameChange(select, catNo) {
            const row = select.closest('tr');
            const option = select.selectedOptions[0];

            if (select.value === '__edit_name__') {
                // ë‚´ìš©ìˆ˜ì •: ì´ì „ì— ì„ íƒëœ ê°’ì„ ìœ ì§€í•œ ì±„ inputìœ¼ë¡œ ì „í™˜
                const td = select.closest('td');
                const prevText = select._prevText || '';
                const prevVal = select._prevValue || '';
                const divSelect = row.querySelector('.div-select');
                const curDiv = divSelect ? divSelect.value : '';
                const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
                const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
                const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${prevText && prevText !== 'í’ˆëª… ì„ íƒ' && prevText !== 'êµ¬ë¶„ ë¨¼ì € ì„ íƒ' ? prevText : ''}" placeholder="í’ˆëª… ìˆ˜ì •"
                    onchange="saveEstimateData()">`;
                const nameInput = td.querySelector('input');
                nameInput.focus();
                nameInput.select();
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            ${curDiv ? '<option value="">í’ˆëª… ì„ íƒ</option>' + nameOpts + '<option value="__edit_name__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_name__">âœï¸ ì§ì ‘ì…ë ¥</option>' : '<option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>'}</select>`;
                        if (prevVal) {
                            const ns = td.querySelector('.name-select');
                            for (let opt of ns.options) { if (opt.value === prevVal) { opt.selected = true; break; } }
                        }
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                return;
            }

            if (select.value === '__custom_name__') {
                // ì§ì ‘ì…ë ¥: selectë¥¼ inputìœ¼ë¡œ êµì²´ (ESCë¡œ ë³µì› ê°€ëŠ¥)
                const td = select.closest('td');
                const divSelect = row.querySelector('.div-select');
                const curDiv = divSelect ? divSelect.value : '';
                const nameItems = curDiv ? getItemsByDivInCat(catNo, curDiv) : [];
                const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];
                const nameOpts = uniqueNames.map(n => `<option value="${n}">${n}</option>`).join('');
                td.innerHTML = `<input type="text" class="editable-input name-custom-input" placeholder="í’ˆëª… ì…ë ¥"
                    onchange="saveEstimateData()">`;
                const nameInput = td.querySelector('input');
                nameInput.focus();
                nameInput.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); nameInput.blur(); }
                    else if (e.key === 'Escape') {
                        td.innerHTML = `<select class="name-select" onchange="onEstNameChange(this, '${catNo}')" ${curDiv ? '' : 'disabled'}>
                            ${curDiv ? '<option value="">í’ˆëª… ì„ íƒ</option>' + nameOpts + '<option value="__edit_name__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_name__">âœï¸ ì§ì ‘ì…ë ¥</option>' : '<option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>'}</select>`;
                        resetEstRowValues(row);
                        revertEditCellsToReadonly(row);
                        saveEstimateData();
                    }
                });
                nameInput.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                resetEstRowValues(row);
                enableDirectEditCells(row, catNo);
                return;
            }

            if (!option || !option.value) {
                resetEstRowValues(row);
                return;
            }

            const selectedName = option.value.trim(); // ì„ íƒëœ í’ˆëª… (valueê°€ í’ˆëª… ì´ë¦„)
            const divSelect = row.querySelector('.div-select');
            const div = divSelect ? divSelect.value : '';

            // ê°™ì€ êµ¬ë¶„ ë‚´ì—ì„œ ê°™ì€ í’ˆëª…ì„ ê°€ì§„ í•­ëª©ë“¤ ì°¾ê¸°
            const items = getItemsByDivInCat(catNo, div);
            const sameNameItems = items.filter(item => item.name && item.name.trim() === selectedName);

            if (sameNameItems.length > 1) {
                // ê°™ì€ í’ˆëª…ì´ ì—¬ëŸ¬ ê°œ ìˆìœ¼ë©´ ìƒì„¸ë‚´ìš© ë“œë¡­ë‹¤ìš´ í‘œì‹œ
                const specCell = row.querySelector('.spec-cell');
                const specOptions = sameNameItems.map((item, i) =>
                    `<option value="${i}" data-spec="${item.spec || ''}" data-unit="${item.unit || ''}" data-price="${item.unitPrice || 0}">
                ${item.spec || '(ìƒì„¸ë‚´ìš© ì—†ìŒ)'}</option>`
                ).join('');

                specCell.innerHTML = `
            <select class="spec-select" onchange="onEstSpecSelect(this, '${catNo}')"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;">
                <option value="">ìƒì„¸ ì„ íƒ</option>
                ${specOptions}
                <option value="__edit_spec__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option>
                <option value="__custom__">âœï¸ ì§ì ‘ì…ë ¥</option>
            </select>
            `;

                // ë‹¨ìœ„/ë‹¨ê°€/ê¸ˆì•¡ì€ ì•„ì§ ì„ íƒ ì•ˆ ë¨
                row.querySelector('.unit-cell').textContent = '-';
                row.querySelector('.price-cell').innerHTML = '<span style="margin:auto">-</span>';
                row.querySelector('.price-cell').dataset.price = '0';
                row.querySelector('.amount-cell').innerHTML = '<span style="margin:auto">-</span>';
            } else if (sameNameItems.length === 1) {
                // ê°™ì€ í’ˆëª…ì´ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ìë™ ì…ë ¥
                const item = sameNameItems[0];
                const spec = item.spec || '-';
                const unit = item.unit || '-';
                const price = parseInt(item.unitPrice) || 0;

                // ë‹¨ìœ„ê°€ "í‰"ì´ë©´ ê³ ê° ì •ë³´ì˜ í‰ìˆ˜ë¥¼ ìë™ ì…ë ¥
                let qty = parseInt(row.querySelector('.qty-input').value) || 1;
                if (unit === 'í‰' || unit === 'py') {
                    const customerArea = getCustomerArea();
                    if (customerArea > 0) {
                        qty = customerArea;
                        row.querySelector('.qty-input').value = qty;
                    }
                }

                const amount = price * qty;

                row.querySelector('.spec-cell').textContent = spec;
                row.querySelector('.unit-cell').textContent = unit;
                row.querySelector('.price-cell').innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>â‚©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                row.querySelector('.price-cell').dataset.price = price;
                row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            } else {
                // í•­ëª©ì„ ì°¾ì§€ ëª»í•œ ê²½ìš°
                resetEstRowValues(row);
            }

            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // ê³ ê° í‰ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        function getCustomerArea() {
            if (!currentCustomerId) return 0;
            const customer = customers.find(c => c.customerId === currentCustomerId);
            if (!customer) return 0;

            // í‰ìˆ˜ íŒŒì‹± (ìˆ«ìë§Œ ì¶”ì¶œ)
            const areaStr = customer.area || customer.pyeong || '';
            const match = areaStr.toString().match(/[\d.]+/);
            return match ? parseFloat(match[0]) : 0;
        }

        // ê³„ì•½ê²¬ì ì„œ ìƒì„¸ë‚´ìš© ë“œë¡­ë‹¤ìš´ ì„ íƒ ì‹œ
        function onEstSpecSelect(select, catNo) {
            const row = select.closest('tr');
            const option = select.selectedOptions[0];

            if (select.value === '__edit_spec__') {
                // ë‚´ìš©ìˆ˜ì •: ì´ì „ì— ì„ íƒëœ ìƒì„¸ë‚´ìš©ì„ ìœ ì§€í•œ ì±„ inputìœ¼ë¡œ ì „í™˜
                const specCell = row.querySelector('.spec-cell');
                const prevSpec = select._prevText || '';
                const savedHTML = specCell.innerHTML;
                specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${prevSpec && prevSpec !== 'ìƒì„¸ ì„ íƒ' ? prevSpec : ''}" placeholder="ìƒì„¸ ìˆ˜ì •"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;"
                onchange="saveEstimateData()">`;
                const inp = specCell.querySelector('input');
                inp.focus();
                inp.select();
                inp.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); inp.blur(); }
                    if (e.key === 'Escape') {
                        specCell.innerHTML = savedHTML;
                        const restoredSelect = specCell.querySelector('select');
                        if (restoredSelect && select._prevValue) restoredSelect.value = select._prevValue;
                        saveEstimateData();
                    }
                });
                inp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                return;
            }

            if (select.value === '__custom__') {
                const specCell = row.querySelector('.spec-cell');
                // ê¸°ì¡´ ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì €ì¥ (ESC ë³µì›ìš©)
                const savedHTML = specCell.innerHTML;
                specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ìƒì„¸ ì…ë ¥"
                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;"
                onchange="saveEstimateData()">`;
                const inp = specCell.querySelector('input');
                inp.focus();
                inp.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); inp.blur(); }
                    if (e.key === 'Escape') {
                        specCell.innerHTML = savedHTML;
                        // ë“œë¡­ë‹¤ìš´ ë³µì› í›„ ì²« ë²ˆì§¸ ì˜µì…˜ ì„ íƒ
                        const restoredSelect = specCell.querySelector('select');
                        if (restoredSelect) restoredSelect.value = '';
                        saveEstimateData();
                    }
                });
                inp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                return;
            }

            if (!option || !option.value) {
                row.querySelector('.unit-cell').textContent = '-';
                row.querySelector('.price-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                row.querySelector('.price-cell').dataset.price = '0';
                row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                return;
            }

            // ì„ íƒëœ ìƒì„¸ë‚´ìš©ì˜ ë‹¨ìœ„, ë‹¨ê°€ ì ìš©
            const unit = option.dataset.unit || '-';
            const price = parseInt(option.dataset.price) || 0;

            // ë‹¨ìœ„ê°€ "í‰"ì´ë©´ ê³ ê° ì •ë³´ì˜ í‰ìˆ˜ë¥¼ ìë™ ì…ë ¥
            let qty = parseInt(row.querySelector('.qty-input').value) || 1;
            if (unit === 'í‰' || unit === 'py') {
                const customerArea = getCustomerArea();
                if (customerArea > 0) {
                    qty = customerArea;
                    row.querySelector('.qty-input').value = qty;
                }
            }

            const amount = price * qty;

            row.querySelector('.unit-cell').textContent = unit;
            row.querySelector('.price-cell').innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>â‚©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            row.querySelector('.price-cell').dataset.price = price;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;

            // ì†Œê³„ ì—…ë°ì´íŠ¸
            const effectiveCatNo = catNo || row.closest('tbody').id.replace('estBody', '');
            updateCategorySubtotal(effectiveCatNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // ê³„ì•½ê²¬ì ì„œ í–‰ ê³„ì‚°
        function calcEstimateRow(row) {
            const priceCell = row.querySelector('.price-cell');
            const priceInput = priceCell?.querySelector('input');
            const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell?.dataset.price) || 0);
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 1;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
        }

        // ìˆ˜ëŸ‰ ë³€ê²½
        function onEstQtyChange(input, catNo) {
            const row = input.closest('tr');
            const priceCell = row.querySelector('.price-cell');
            const priceInput = priceCell.querySelector('input');
            const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell.dataset.price) || 0);
            const qty = parseInt(input.value) || 0;
            const amount = price * qty;

            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // í–‰ ê°’ ì´ˆê¸°í™”
        function resetEstRowValues(row) {
            row.querySelector('.spec-cell').textContent = '-';
            row.querySelector('.unit-cell').textContent = '-';
            row.querySelector('.price-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
            row.querySelector('.price-cell').dataset.price = '0';
            row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
        }

        // ===== ê²¬ì ì„œ í…Œì´ë¸” ì»¬ëŸ¼ ìˆ˜ë™ ë„ˆë¹„ ì¡°ì ˆ =====
        function initColumnResize() {
            document.querySelectorAll('.estimate-table').forEach(table => {
                const ths = table.querySelectorAll('thead th');
                // ê¸°ì¡´ í•¸ë“¤ ì œê±°
                table.querySelectorAll('.col-resize-handle').forEach(h => h.remove());

                ths.forEach((th, idx) => {
                    // col-div(êµ¬ë¶„)ëŠ” ì¸ì‡„ì‹œ ìˆ¨ê²¨ì§€ë¯€ë¡œ ì œì™¸ ê°€ëŠ¥í•˜ë‚˜, í™”ë©´ì—ì„  í¬í•¨
                    const handle = document.createElement('div');
                    handle.className = 'col-resize-handle no-print';
                    th.appendChild(handle);

                    let startX, startWidth, colIndex;

                    handle.addEventListener('mousedown', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        startX = e.pageX;
                        startWidth = th.offsetWidth;
                        colIndex = idx;
                        handle.classList.add('resizing');
                        document.body.style.cursor = 'col-resize';
                        document.body.style.userSelect = 'none';

                        function onMouseMove(e2) {
                            const diff = e2.pageX - startX;
                            const newWidth = Math.max(20, startWidth + diff);
                            // colgroupì˜ col ë˜ëŠ” th ì§ì ‘ ì„¤ì •
                            const cols = table.querySelectorAll('colgroup col');
                            if (cols[colIndex]) {
                                cols[colIndex].style.width = newWidth + 'px';
                            }
                            th.style.width = newWidth + 'px';
                            th.style.minWidth = newWidth + 'px';
                            th.style.maxWidth = newWidth + 'px';
                        }

                        function onMouseUp() {
                            handle.classList.remove('resizing');
                            document.body.style.cursor = '';
                            document.body.style.userSelect = '';
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                        }

                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                });
            });
        }

        // ì§ì ‘ì…ë ¥ ëª¨ë“œ: ìƒì„¸ë‚´ìš©, ë‹¨ìœ„, ë‹¨ê°€ë¥¼ ì…ë ¥ í•„ë“œë¡œ ì „í™˜
        function enableDirectEditCells(row, catNo) {
            const specCell = row.querySelector('.spec-cell');
            const unitCell = row.querySelector('.unit-cell');
            const priceCell = row.querySelector('.price-cell');

            specCell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ìƒì„¸ë‚´ìš© ì…ë ¥"
                onchange="saveEstimateData()">`;
            specCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                else if (e.key === 'Escape') { specCell.textContent = '-'; saveEstimateData(); }
            });
            specCell.querySelector('input').addEventListener('blur', function () { finalizeDirectSpecEdit(this); });

            unitCell.innerHTML = `<input type="text" class="editable-input" placeholder="ë‹¨ìœ„" style="width:100%; text-align:center;"
                onchange="saveEstimateData()">`;
            unitCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                else if (e.key === 'Escape') { unitCell.textContent = '-'; saveEstimateData(); }
            });
            unitCell.querySelector('input').addEventListener('blur', function () { finalizeDirectUnitEdit(this); });

            priceCell.innerHTML = `<input type="text" class="editable-price-input" placeholder="ë‹¨ê°€" value=""
                oninput="onEstDirectPriceInput(this, '${catNo}')" onblur="finalizePriceEdit(this, '${catNo}')" onchange="saveEstimateData()">`;
            priceCell.dataset.price = '0';
            priceCell.querySelector('input').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.blur();
                } else if (e.key === 'Escape') {
                    priceCell.innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                    priceCell.dataset.price = '0';
                    row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                    updateCategorySubtotal(catNo);
                    updateEstimateTotals();
                    saveEstimateData();
                }
            });
        }

        // ì§ì ‘ì…ë ¥ ëª¨ë“œ í•´ì œ: ìƒì„¸ë‚´ìš©, ë‹¨ìœ„, ë‹¨ê°€ë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
        function revertEditCellsToReadonly(row) {
            const specCell = row.querySelector('.spec-cell');
            const unitCell = row.querySelector('.unit-cell');
            const priceCell = row.querySelector('.price-cell');

            if (specCell && specCell.querySelector('.spec-custom-input')) {
                specCell.textContent = '-';
            }
            if (unitCell && unitCell.querySelector('input')) {
                unitCell.textContent = '-';
            }
            if (priceCell && priceCell.querySelector('input')) {
                priceCell.innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
                priceCell.dataset.price = '0';
            }
            row.querySelector('.amount-cell').innerHTML = '<div class="money-wrapper"><span style="margin:auto">-</span></div>';
        }

        // ì§ì ‘ì…ë ¥ ë‹¨ê°€ ë³€ê²½ ì‹œ ê¸ˆì•¡ ê³„ì‚°
        function onEstDirectPriceInput(input, catNo) {
            const row = input.closest('tr');
            const price = parseNumber(input.value) || 0;
            row.querySelector('.price-cell').dataset.price = price;
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            input.value = formatNumber(price);
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
        }

        // ì…€ í´ë¦­ìœ¼ë¡œ í¸ì§‘ ëª¨ë“œ ì „í™˜ (spec-cell)
        function makeSpecEditable(cell, catNo) {
            const currentText = cell.textContent?.trim() || '';
            const originalText = currentText;
            if (currentText === '-') {
                cell.innerHTML = `<input type="text" class="editable-input spec-custom-input" placeholder="ìƒì„¸ë‚´ìš© ì…ë ¥"
                    onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            } else {
                cell.innerHTML = `<input type="text" class="editable-input spec-custom-input" value="${currentText}"
                    onchange="saveEstimateData()" onblur="finalizeSpecEdit(this, '${catNo}')">`;
            }
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    inp.blur();
                } else if (e.key === 'Escape') {
                    cell.textContent = originalText || '-';
                    saveEstimateData();
                }
            });
        }

        function finalizeSpecEdit(input, catNo) {
            const val = input.value.trim();
            const cell = input.closest('.spec-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
            }
            saveEstimateData();
        }

        // ì…€ í´ë¦­ìœ¼ë¡œ í¸ì§‘ ëª¨ë“œ ì „í™˜ (unit-cell)
        function makeUnitEditable(cell, catNo) {
            const currentText = cell.textContent?.trim() || '';
            const originalText = currentText;
            if (cell.querySelector('input')) return;
            cell.innerHTML = `<input type="text" class="editable-input" value="${currentText === '-' ? '' : currentText}"
                placeholder="ë‹¨ìœ„" style="width:100%; text-align:center;"
                onchange="saveEstimateData()" onblur="finalizeUnitEdit(this)">`;
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    inp.blur();
                } else if (e.key === 'Escape') {
                    cell.textContent = originalText || '-';
                    saveEstimateData();
                }
            });
        }

        function finalizeUnitEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.unit-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
            }
            saveEstimateData();
        }

        // ì…€ í´ë¦­ìœ¼ë¡œ í¸ì§‘ ëª¨ë“œ ì „í™˜ (price-cell)
        function makePriceEditable(cell, catNo) {
            if (cell.querySelector('input')) return;
            const currentPrice = parseInt(cell.dataset.price) || 0;
            const originalPrice = currentPrice;
            cell.innerHTML = `<input type="text" class="editable-price-input" value="${currentPrice > 0 ? formatNumber(currentPrice) : ''}"
                placeholder="ë‹¨ê°€ ì…ë ¥" oninput="onEstDirectPriceInput(this, '${catNo}')"
                onblur="finalizePriceEdit(this, '${catNo}')" onchange="saveEstimateData()">`;
            const inp = cell.querySelector('input');
            inp.focus();
            inp.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    // ì—”í„° í‚¤: í¸ì§‘ ì™„ë£Œ, â‚© í‘œì‹œ, blur ì²˜ë¦¬
                    e.preventDefault();
                    inp.blur(); // blur ì´ë²¤íŠ¸ê°€ finalizePriceEdit í˜¸ì¶œ
                } else if (e.key === 'Escape') {
                    cell.dataset.price = originalPrice;
                    cell.innerHTML = `<div class="money-wrapper">${originalPrice > 0 ? `<span>â‚©</span><span>${formatNumber(originalPrice)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                    const row = cell.closest('tr');
                    const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
                    const amount = originalPrice * qty;
                    row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
                    updateCategorySubtotal(catNo);
                    updateEstimateTotals();
                    saveEstimateData();
                }
            });
        }


        function finalizePriceEdit(input, catNo) {
            const price = parseNumber(input.value) || 0;
            const cell = input.closest('.price-cell');
            cell.dataset.price = price;
            cell.style.border = '';
            cell.style.boxShadow = '';
            cell.style.background = '';
            cell.innerHTML = `<div class="money-wrapper">${price > 0 ? `<span>â‚©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            const row = cell.closest('tr');
            const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
            const amount = price * qty;
            row.querySelector('.amount-cell').innerHTML = `<div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div>`;
            updateCategorySubtotal(catNo);
            updateEstimateTotals();
            saveEstimateData();
        }

        // ì§ì ‘ì…ë ¥ êµ¬ë¶„ blur ì‹œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (íŒŒë€ í…Œë‘ë¦¬ ì œê±°)
        function finalizeDirectDivEdit(input, catNo) {
            const val = input.value.trim();
            const td = input.closest('td');
            if (td) {
                td.style.border = '';
                td.style.boxShadow = '';
                td.style.background = '';
                td.innerHTML = `<span class="div-custom-text" style="cursor:pointer; display:block; text-align:center;">${val || '-'}</span>`;
                td.dataset.customDiv = val || '';
                // í´ë¦­ ì‹œ ë‹¤ì‹œ í¸ì§‘ ê°€ëŠ¥
                td.querySelector('.div-custom-text').addEventListener('click', function () {
                    td.innerHTML = `<input type="text" class="editable-input div-custom-input" value="${val}" placeholder="êµ¬ë¶„ ì…ë ¥"
                        onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                    const newInp = td.querySelector('input');
                    newInp.focus();
                    newInp.select();
                    newInp.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') { e.preventDefault(); newInp.blur(); }
                    });
                    newInp.addEventListener('blur', function () { finalizeDirectDivEdit(this, catNo); });
                });
            }
            saveEstimateData();
        }

        // ì§ì ‘ì…ë ¥ í’ˆëª… blur ì‹œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (íŒŒë€ í…Œë‘ë¦¬ ì œê±°)
        function finalizeDirectNameEdit(input, catNo) {
            const val = input.value.trim();
            const td = input.closest('td');
            if (td) {
                td.style.border = '';
                td.style.boxShadow = '';
                td.style.background = '';
                td.innerHTML = `<span class="name-custom-text" style="cursor:pointer; display:block;">${val || '-'}</span>`;
                td.dataset.customName = val || '';
                // í´ë¦­ ì‹œ ë‹¤ì‹œ í¸ì§‘ ê°€ëŠ¥
                td.querySelector('.name-custom-text').addEventListener('click', function () {
                    td.innerHTML = `<input type="text" class="editable-input name-custom-input" value="${val}" placeholder="í’ˆëª… ì…ë ¥"
                        onchange="saveEstimateData()">`;
                    const newInp = td.querySelector('input');
                    newInp.focus();
                    newInp.select();
                    newInp.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') { e.preventDefault(); newInp.blur(); }
                    });
                    newInp.addEventListener('blur', function () { finalizeDirectNameEdit(this, catNo); });
                });
            }
            saveEstimateData();
        }

        // ì§ì ‘ì…ë ¥ ìƒì„¸ë‚´ìš© blur ì‹œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (íŒŒë€ í…Œë‘ë¦¬ ì œê±°)
        function finalizeDirectSpecEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.spec-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
                cell.dataset.customSpec = val || '';
            }
            saveEstimateData();
        }

        // ì§ì ‘ì…ë ¥ ë‹¨ìœ„ blur ì‹œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (íŒŒë€ í…Œë‘ë¦¬ ì œê±°)
        function finalizeDirectUnitEdit(input) {
            const val = input.value.trim();
            const cell = input.closest('.unit-cell');
            if (cell) {
                cell.style.border = '';
                cell.style.boxShadow = '';
                cell.style.background = '';
                cell.textContent = val || '-';
                cell.dataset.customUnit = val || '';
            }
            saveEstimateData();
        }

        // ì¹´í…Œê³ ë¦¬ ì†Œê³„ ì—…ë°ì´íŠ¸
        function updateCategorySubtotal(catNo) {
            const tbody = document.getElementById(`estBody${catNo}`);
            let subtotal = 0;

            tbody.querySelectorAll('tr').forEach(row => {
                const priceCell = row.querySelector('.price-cell');
                const priceInput = priceCell?.querySelector('input');
                const price = priceInput ? (parseNumber(priceInput.value) || 0) : (parseInt(priceCell?.dataset.price) || 0);
                const qty = parseInt(row.querySelector('.qty-input')?.value) || 0;
                subtotal += price * qty;
            });

            document.getElementById(`estSubtotal${catNo}`).textContent = formatNumber(subtotal);
            return subtotal;
        }

        // ì „ì²´ í•©ê³„ ê³„ì‚°
        function updateEstimateTotals() {
            let grandTotal = 0;
            const categoryTotals = {};

            categories.forEach(cat => {
                const catTotal = updateCategorySubtotal(cat.no);
                categoryTotals[cat.no] = catTotal;
                grandTotal += catTotal;
            });

            const profitRate = parseFloat(document.getElementById('estimateProfitRate')?.value) || 0;
            const profit = Math.round(grandTotal * profitRate / 100);
            const subtotalWithProfit = grandTotal + profit;
            const vat = Math.round(subtotalWithProfit * 0.1);
            const total = subtotalWithProfit + vat;

            document.getElementById('estimateSubtotal').textContent = 'â‚© ' + formatNumber(grandTotal);
            document.getElementById('estimateProfit').textContent = 'â‚© ' + formatNumber(profit);
            document.getElementById('estimateVat').textContent = 'â‚© ' + formatNumber(vat);
            document.getElementById('estimateTotal').textContent = 'â‚© ' + formatNumber(total);

            // ê³ ê°ì •ë³´ì— ì´ ê³„ì•½ê¸ˆì•¡ ë°˜ì˜
            const totalAmountField = document.querySelector('.customer-field[data-field="totalAmount"]');
            if (totalAmountField) {
                totalAmountField.value = 'â‚© ' + formatNumber(total);
                currentData.totalAmount = 'â‚© ' + formatNumber(total);
            }

            currentData.estimateProfitRate = profitRate;

            // í‘œì§€ê³„ì•½ì„œ ì—°ë™
            updateCoverFromEstimate(categoryTotals, grandTotal, profitRate, profit, vat, total);

            // ë„ê¸‰ê³„ì•½ì„œ ëŒ€ê¸ˆì§€ê¸‰ ì—°ë™
            updateContractPayments(total);
        }

        // í‘œì§€ê³„ì•½ì„œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
        function updateCoverFromEstimate(categoryTotals, subtotal, profitRate, profit, vat, total) {
            // ê¸ˆì•¡ì„ ì •ë ¬ëœ HTMLë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            function formatAmountHtml(amount) {
                if (amount > 0) {
                    return `<div class="money-align"><span class="currency">â‚©</span><span class="value">${formatNumber(amount)}</span></div>`;
                }
                return '<div class="money-align"><span class="currency"></span><span class="value">-</span></div>';
            }

            // ê° ì¹´í…Œê³ ë¦¬ë³„ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            categories.forEach(cat => {
                const el = document.getElementById(`coverCat${cat.no}`);
                if (el) {
                    const amount = categoryTotals[cat.no] || 0;
                    el.innerHTML = formatAmountHtml(amount);
                }
            });

            // ì†Œê³„, ê¸°ì—…ì´ìœ¤, VAT, ì´ì•¡ ì—…ë°ì´íŠ¸
            const coverSubtotal = document.getElementById('coverSubtotal');
            const coverProfitRate = document.getElementById('coverProfitRate');
            const coverProfit = document.getElementById('coverProfit');
            const coverVat = document.getElementById('coverVat');
            const coverTotal = document.getElementById('coverTotal');

            if (coverSubtotal) coverSubtotal.innerHTML = formatAmountHtml(subtotal);
            if (coverProfitRate) coverProfitRate.textContent = profitRate;
            if (coverProfit) coverProfit.innerHTML = formatAmountHtml(profit);
            if (coverVat) coverVat.innerHTML = formatAmountHtml(vat);
            if (coverTotal) coverTotal.innerHTML = formatAmountHtml(total);
        }


        // ë„ê¸‰ê³„ì•½ì„œ ëŒ€ê¸ˆì§€ê¸‰ ìë™ ê³„ì‚°
        function updateContractPayments(total) {
            // ëŒ€ê¸ˆ ì§€ê¸‰ ë¹„ìœ¨: 1ì°¨ 27%, 2ì°¨ 23%, 3ì°¨ 23%, 4ì°¨ 23%, ì”ê¸ˆ 4%
            const payment1 = Math.round(total * 0.27);
            const payment2 = Math.round(total * 0.23);
            const payment3 = Math.round(total * 0.23);
            const payment4 = Math.round(total * 0.23);
            const payment5 = total - payment1 - payment2 - payment3 - payment4; // ë‚˜ë¨¸ì§€ ì”ê¸ˆ

            // currentDataì— ì €ì¥
            currentData.payment1 = 'â‚© ' + formatNumber(payment1) + ' (27%)';
            currentData.payment2 = 'â‚© ' + formatNumber(payment2) + ' (23%)';
            currentData.payment3 = 'â‚© ' + formatNumber(payment3) + ' (23%)';
            currentData.payment4 = 'â‚© ' + formatNumber(payment4) + ' (23%)';
            currentData.payment5 = 'â‚© ' + formatNumber(payment5) + ' (4%)';

            // synced-input ì—…ë°ì´íŠ¸
            document.querySelectorAll('.synced-input[data-sync="payment1"]').forEach(el => el.value =
                currentData.payment1);
            document.querySelectorAll('.synced-input[data-sync="payment2"]').forEach(el => el.value =
                currentData.payment2);
            document.querySelectorAll('.synced-input[data-sync="payment3"]').forEach(el => el.value =
                currentData.payment3);
            document.querySelectorAll('.synced-input[data-sync="payment4"]').forEach(el => el.value =
                currentData.payment4);
            document.querySelectorAll('.synced-input[data-sync="payment5"]').forEach(el => el.value =
                currentData.payment5);

            // ë„ê¸‰ê³„ì•½ì„œ ì´ ê³„ì•½ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.synced-input[data-sync="totalAmount"]').forEach(el => {
                el.value = 'â‚© ' + formatNumber(total);
            });
        }

        // ê²¬ì  ë°ì´í„° ì €ì¥
        function saveEstimateData() {
            const estimateData = {};
            const estimateMemos = {};

            categories.forEach(cat => {
                const tbody = document.getElementById(`estBody${cat.no}`);
                const memoTextarea = document.getElementById(`estMemoText${cat.no}`);
                if (!tbody) return;

                const rows = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const divSelect = row.querySelector('.div-select');
                    const divCustomInput = row.querySelector('.div-custom-input');
                    const nameSelect = row.querySelector('.name-select');
                    const nameCustomInput = row.querySelector('.name-custom-input');
                    const qtyInput = row.querySelector('.qty-input');
                    const specCell = row.querySelector('.spec-cell');

                    // êµ¬ë¶„ ê°’: select ë˜ëŠ” ì§ì ‘ì…ë ¥ ë˜ëŠ” í…ìŠ¤íŠ¸ ë³€í™˜ í›„
                    let divValue = '';
                    let isCustomDiv = false;
                    const divCustomText = row.querySelector('.div-custom-text');
                    if (divCustomInput) {
                        divValue = divCustomInput.value || '';
                        isCustomDiv = true;
                    } else if (divCustomText) {
                        divValue = divCustomText.textContent?.trim() || '';
                        if (divValue === '-') divValue = '';
                        isCustomDiv = true;
                    } else if (divSelect) {
                        divValue = divSelect.value || '';
                    }

                    // í’ˆëª… ê°’: select ë˜ëŠ” ì§ì ‘ì…ë ¥ ë˜ëŠ” í…ìŠ¤íŠ¸ ë³€í™˜ í›„
                    let nameValue = '';
                    let nameIndexValue = '';
                    let isCustomName = false;
                    const nameCustomText = row.querySelector('.name-custom-text');
                    if (nameCustomInput) {
                        nameValue = nameCustomInput.value || '';
                        nameIndexValue = '';
                        isCustomName = true;
                    } else if (nameCustomText) {
                        nameValue = nameCustomText.textContent?.trim() || '';
                        if (nameValue === '-') nameValue = '';
                        nameIndexValue = '';
                        isCustomName = true;
                    } else if (nameSelect) {
                        nameIndexValue = nameSelect.value || '';
                        nameValue = nameSelect.selectedOptions[0]?.textContent || '';
                    }

                    // spec-cellì´ selectë‚˜ inputì¸ ê²½ìš° ê°’ ê°€ì ¸ì˜¤ê¸°
                    let specValue = '-';
                    if (specCell) {
                        const specSelect = specCell.querySelector('select');
                        const specInput = specCell.querySelector('input');
                        if (specSelect) {
                            const selectedOpt = specSelect.selectedOptions[0];
                            specValue = selectedOpt?.dataset?.spec || selectedOpt?.textContent || '-';
                        } else if (specInput) {
                            specValue = specInput.value || '-';
                        } else {
                            specValue = specCell.textContent || '-';
                        }
                    }

                    // ë‹¨ìœ„: input ë˜ëŠ” í…ìŠ¤íŠ¸
                    const unitCell = row.querySelector('.unit-cell');
                    let unitValue = '-';
                    if (unitCell) {
                        const unitInput = unitCell.querySelector('input');
                        unitValue = unitInput ? (unitInput.value || '-') : (unitCell.textContent || '-');
                    }

                    // ë¹„ê³  ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° (contenteditable div)
                    const remarkDiv = row.querySelector('.remark-editable');
                    const remarkValue = remarkDiv?.innerHTML || '';

                    // ë‹¨ê°€: input ë˜ëŠ” dataset
                    const priceCell = row.querySelector('.price-cell');
                    const priceInput = priceCell?.querySelector('input');
                    let priceValue = '0';
                    if (priceInput) {
                        priceValue = String(parseNumber(priceInput.value) || 0);
                    } else {
                        priceValue = priceCell?.dataset.price || '0';
                    }

                    rows.push({
                        div: divValue,
                        nameIndex: nameIndexValue,
                        name: nameValue,
                        spec: specValue,
                        unit: unitValue,
                        qty: qtyInput?.value || '1',
                        price: priceValue,
                        remark: remarkValue,
                        isCustomDiv: isCustomDiv,
                        isCustomName: isCustomName
                    });
                });

                estimateData[cat.no] = rows;

                // ë©”ëª¨ ì €ì¥ (contenteditable div)
                const memoDiv = document.getElementById(`estMemoText${cat.no}`);
                if (memoDiv) {
                    currentData[`estMemo_${cat.no}`] = memoDiv.innerHTML;
                }
            });

            currentData.estimateData = estimateData;
            currentData.estimateProfitRate = document.getElementById('estimateProfitRate')?.value || 15;
        }

        // ê²¬ì  ë°ì´í„° ë¡œë“œ
        // [New] ê²¬ì  ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (00ë²ˆ ì„¤ê³„ -> 02ë²ˆ ì„¤ê³„ ë“± ìˆœì„œ ë³€ê²½ ëŒ€ì‘)
        function migrateEstimateData(data) {
            if (!data || !data.estimateData) return;

            if (data.estimateData['00']) {
                console.log('Migrating estimate data from old order to new order...');
                const newData = {};
                const newMemos = {};
                const pad = (n) => n.toString().padStart(2, '0');

                Object.keys(data.estimateData).forEach(oldKey => {
                    let newKey = oldKey;
                    const n = parseInt(oldKey, 10);

                    if (oldKey === '00') {
                        newKey = '02';
                    } else if (oldKey === '01') {
                        newKey = '01';
                    } else if (n >= 2 && n <= 17) {
                        newKey = pad(n + 1);
                    }

                    newData[newKey] = data.estimateData[oldKey];

                    if (data[`estMemo_${oldKey}`]) {
                        newMemos[`estMemo_${newKey}`] = data[`estMemo_${oldKey}`];
                        delete data[`estMemo_${oldKey}`];
                    }
                });

                data.estimateData = newData;
                Object.assign(data, newMemos);
                showToast('ê²¬ì  ë°ì´í„°ê°€ ìƒˆë¡œìš´ ìˆœì„œë¡œ ìë™ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ í›„ ì €ì¥í•´ì£¼ì„¸ìš”.', 'info');
            }
        }

        function loadEstimateData() {
            migrateEstimateData(currentData);
            const profitRateInput = document.getElementById('estimateProfitRate');

            // ê¸°ì—…ì´ìœ¤ìœ¨ ë¡œë“œ
            if (currentData.estimateProfitRate !== undefined) {
                profitRateInput.value = currentData.estimateProfitRate;
            } else {
                profitRateInput.value = 15;
            }

            // ì €ì¥ëœ ê²¬ì  ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¡œë“œ
            if (currentData.estimateData) {
                categories.forEach(cat => {
                    const tbody = document.getElementById(`estBody${cat.no}`);
                    if (!tbody) return;

                    const savedRows = currentData.estimateData[cat.no];
                    if (!savedRows || savedRows.length === 0) {
                        // ê¸°ë³¸ ë¹ˆ í–‰ ìœ ì§€
                        updateDivOptions(cat.no);
                        return;
                    }

                    tbody.innerHTML = '';
                    const items = getCostItemsByCategory(cat.no);
                    const divs = [...new Set(items.map(i => i.div).filter(d => d))].sort();
                    const divOptions = divs.map(d => `<option value="${d}">${d}</option>`).join('');


                    savedRows.forEach((item, i) => {
                        const isCustomDiv = item.isCustomDiv || false;
                        const isCustomName = item.isCustomName || false;
                        const nameItems = (!isCustomDiv && item.div) ? getItemsByDivInCat(cat.no, item.div) : [];

                        // ê³ ìœ í•œ í’ˆëª…ë§Œ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
                        const uniqueNames = [...new Set(nameItems.map(it => it.name).filter(n => n))];

                        const currentName = item.name || '';

                        const nameOptions = uniqueNames.map(name =>
                            `<option value="${name}" ${name === currentName ? 'selected' : ''}>${name}</option>`
                        ).join('');

                        const price = parseInt(item.price) || 0;
                        const qty = parseInt(item.qty) || 0;
                        const amount = price * qty;

                        // êµ¬ë¶„ ì…€ ì²˜ë¦¬
                        let divCellContent;
                        if (isCustomDiv) {
                            divCellContent = `<input type="text" class="editable-input div-custom-input" value="${item.div || ''}" placeholder="êµ¬ë¶„ ì…ë ¥"
                                onchange="saveEstimateData()" style="width:100%; text-align:center;">`;
                        } else {
                            divCellContent = `<select class="div-select" onchange="onEstDivChange(this, '${cat.no}')">
                                <option value="">ì„ íƒ</option>${divOptions.replace(`"${item.div}"`, `"${item.div}" selected`)}
                                <option value="__edit_div__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option>
                                <option value="__custom_div__">âœï¸ ì§ì ‘ì…ë ¥</option>
                            </select>`;
                        }

                        // í’ˆëª… ì…€ ì²˜ë¦¬
                        let nameCellContent;
                        if (isCustomName) {
                            nameCellContent = `<input type="text" class="editable-input name-custom-input" value="${currentName}" placeholder="í’ˆëª… ì…ë ¥"
                                onchange="saveEstimateData()">`;
                        } else {
                            nameCellContent = `<select class="name-select" onchange="onEstNameChange(this, '${cat.no}')" ${item.div ? '' : 'disabled'
                                }>${item.div ? '<option value="">í’ˆëª… ì„ íƒ</option>' + nameOptions + '<option value="__edit_name__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option><option value="__custom_name__">âœï¸ ì§ì ‘ì…ë ¥</option>' : '<option value="">êµ¬ë¶„ ë¨¼ì € ì„ íƒ</option>'}</select>`;
                        }

                        // ìƒì„¸ë‚´ìš© ì…€ ì²˜ë¦¬
                        let specCellContent = item.spec || '-';
                        const sameNameItems = nameItems.filter(it => it.name === currentName);

                        if (isCustomDiv || isCustomName) {
                            // ì§ì ‘ì…ë ¥ ëª¨ë“œë©´ ìƒì„¸ë‚´ìš©ë„ ì…ë ¥ í•„ë“œ
                            specCellContent = `<input type="text" class="editable-input spec-custom-input" value="${item.spec && item.spec !== '-' ? item.spec : ''}" placeholder="ìƒì„¸ë‚´ìš© ì…ë ¥"
                                onchange="saveEstimateData()">`;
                        } else if (sameNameItems.length > 1) {
                            const specOptions = sameNameItems.map((it, idx) => {
                                const isSelected = (it.spec || '') === item.spec || (it.spec === null && item.spec === '-');
                                return `<option value="${idx}" data-spec="${it.spec || ''}" data-unit="${it.unit || ''}" data-price="${it.unitPrice || 0}" ${isSelected ? 'selected' : ''}>
                                ${it.spec || '(ìƒì„¸ë‚´ìš© ì—†ìŒ)'}</option>`;
                            }).join('');

                            specCellContent = `
                            <select class="spec-select" onchange="onEstSpecSelect(this, '${cat.no}')"
                                style="width:100%; padding:4px; border:1px solid #0071e3; border-radius:4px; font-size:11px; background:#f0f7ff;">
                                <option value="">ìƒì„¸ ì„ íƒ</option>
                                ${specOptions}
                                <option value="__edit_spec__">ğŸ“ ë‚´ìš©ìˆ˜ì •</option>
                                <option value="__custom__" ${item.spec && !sameNameItems.find(it => it.spec === item.spec) ? 'selected' : ''}>âœï¸ ì§ì ‘ì…ë ¥</option>
                            </select>`;
                        }

                        // ë‹¨ìœ„ ì…€ ì²˜ë¦¬
                        let unitCellContent;
                        if (isCustomDiv || isCustomName) {
                            unitCellContent = `<input type="text" class="editable-input" value="${item.unit && item.unit !== '-' ? item.unit : ''}" placeholder="ë‹¨ìœ„" style="width:100%; text-align:center;"
                                onchange="saveEstimateData()">`;
                        } else {
                            unitCellContent = item.unit || '-';
                        }

                        // ë‹¨ê°€ ì…€ ì²˜ë¦¬ (ì§ì ‘ì…ë ¥/ì¼ë°˜ ëª¨ë‘ ë™ì¼í•œ ì™„ì„± í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ)
                        const priceCellContent = `<div class="money-wrapper">${price > 0 ? `<span>â‚©</span><span>${formatNumber(price)}</span>` : '<span style="margin:auto">-</span>'}</div>`;

                        const tr = document.createElement('tr');
                        tr.className = 'draggable-row';
                        tr.draggable = true;
                        tr.ondragstart = onEstRowDragStart;
                        tr.ondragover = onEstRowDragOver;
                        tr.ondragend = onEstRowDragEnd;
                        tr.innerHTML = `
            <td class="drag-handle" style="position: relative;">
                <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${cat.no}')" title="ì‚­ì œ">
                     <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                </button>
                ${i + 1}
            </td>
            <td class="col-div">${divCellContent}</td>
            <td>${nameCellContent}</td>
            <td class="spec-cell">${specCellContent}</td>
            <td class="unit-cell">${unitCellContent}</td>
            <td><input type="number" class="qty-input" value="${item.qty || 1}" min="0"
                    onchange="onEstQtyChange(this, '${cat.no}')"></td>
            <td class="price-cell" data-price="${price}">${priceCellContent}</td>
            <td class="amount-cell"><div class="money-wrapper">${amount > 0 ? `<span>â‚©</span><span>${formatNumber(amount)}</span>` : '<span style="margin:auto">-</span>'}</div></td>
            <td><div class="remark-editable text-formattable" contenteditable="true" oninput="saveEstimateData()">${item.remark || ''}</div></td>
                        `;
                        tbody.appendChild(tr);

                        // ë¡œë“œëœ ì§ì ‘ì…ë ¥ í•„ë“œì— Enterí‚¤/blur ì´ë²¤íŠ¸ ë°”ì¸ë”©
                        if (isCustomDiv || isCustomName) {
                            const divInp = tr.querySelector('.div-custom-input');
                            if (divInp) {
                                divInp.addEventListener('blur', function () { finalizeDirectDivEdit(this, cat.no); });
                                divInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const nameInp = tr.querySelector('.name-custom-input');
                            if (nameInp) {
                                nameInp.addEventListener('blur', function () { finalizeDirectNameEdit(this, cat.no); });
                                nameInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const priceInp = tr.querySelector('.editable-price-input');
                            if (priceInp) {
                                priceInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const specInp = tr.querySelector('.spec-cell .editable-input');
                            if (specInp) {
                                specInp.addEventListener('blur', function () { finalizeDirectSpecEdit(this); });
                                specInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                            const unitInp = tr.querySelector('.unit-cell .editable-input');
                            if (unitInp) {
                                unitInp.addEventListener('blur', function () { finalizeDirectUnitEdit(this); });
                                unitInp.addEventListener('keydown', function (e) {
                                    if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
                                });
                            }
                        }
                    });
                });
            } else {
                // êµ¬ë¶„ ì˜µì…˜ë§Œ ì´ˆê¸°í™”
                categories.forEach(cat => {
                    updateDivOptions(cat.no);
                });
            }

            // ë©”ëª¨ ë¡œë“œ (contenteditable div)
            categories.forEach(cat => {
                const memoDiv = document.getElementById(`estMemoText${cat.no}`);
                if (memoDiv && currentData[`estMemo_${cat.no}`] !== undefined) {
                    memoDiv.innerHTML = currentData[`estMemo_${cat.no}`];
                }
            });

            updateEstimateTotals();

            syncCostMemoToEstimate(); // ì›ê°€ê´€ë¦¬í‘œ ë©”ëª¨ë¥¼ ê²¬ì ì„œì— ë™ê¸°í™”

            // ì‘ì„±ì í‘œì‹œ
            const authorSpan = document.getElementById('estimateAuthor');
            if (authorSpan) {
                authorSpan.textContent = currentData?.createdBy || '-';
            }

            // ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ ì´ˆê¸°í™”
            initColumnResize();
        }

        // textarea ìë™ ë†’ì´ ì¡°ì ˆ
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // ì›ê°€ê´€ë¦¬í‘œ ë©”ëª¨ë¥¼ ê³„ì•½ê²¬ì ì„œì— ë™ê¸°í™”
        function syncCostMemoToEstimate() {
            // ì›ê°€ê´€ë¦¬í‘œ ë©”ëª¨ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš© (í•­ìƒ í‘œì‹œ) (Phase 2: In-memory ì‚¬ìš©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const estMemoTextarea = document.getElementById(`estMemoText${cat.no}`);
                const costMemoTextarea = document.getElementById(`costMemo${cat.no}`);

                if (estMemoTextarea) {
                    // ì›ê°€ê´€ë¦¬í‘œ ë©”ëª¨ (ê¸°ë³¸ê°’ìœ¼ë¡œ í•­ìƒ í‘œì‹œ)
                    const costMemo = globalCostData[`costMemo_${cat.no}`] ||
                        (costMemoTextarea ? costMemoTextarea.value : '') || '';

                    // í•­ìƒ ì›ê°€ê´€ë¦¬í‘œ ë©”ëª¨ í‘œì‹œ
                    estMemoTextarea.value = costMemo;
                    autoResizeTextarea(estMemoTextarea);
                }
            });
        }

        // ------------------------------------------------------------------------------------------------
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ í–‰ ìˆœì„œ ë³€ê²½ (ê³„ì•½ê²¬ì ì„œ)
        // ------------------------------------------------------------------------------------------------

        let estDragSrcEl = null;
        let isEstDragHandleClicked = false;

        // ë“œë˜ê·¸ í•¸ë“¤(NO ì»¬ëŸ¼) í´ë¦­ ì—¬ë¶€ í™•ì¸
        document.addEventListener('mousedown', function (e) {
            isEstDragHandleClicked = !!e.target.closest('.drag-handle');
        });

        function onEstRowDragStart(e) {
            // í•¸ë“¤ì„ í´ë¦­í•œ ê²½ìš°ì—ë§Œ ë“œë˜ê·¸ ì‹œì‘
            if (!isEstDragHandleClicked) {
                e.preventDefault();
                return;
            }

            estDragSrcEl = e.target.closest('tr');
            if (estDragSrcEl) {
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', estDragSrcEl.innerHTML);
                estDragSrcEl.classList.add('dragging');
            }
        }

        function onEstRowDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';

            const targetRow = e.target.closest('tr');
            if (targetRow && targetRow !== estDragSrcEl && estDragSrcEl && targetRow.parentElement === estDragSrcEl.parentElement) {
                const bounding = targetRow.getBoundingClientRect();
                const offset = bounding.y + (bounding.height / 2);
                if (e.clientY - offset > 0) {
                    targetRow.after(estDragSrcEl);
                } else {
                    targetRow.before(estDragSrcEl);
                }
            }
            return false;
        }

        function onEstRowDragEnd(e) {
            if (estDragSrcEl) {
                estDragSrcEl.classList.remove('dragging');

                const tbody = estDragSrcEl.parentElement;
                if (tbody) {
                    const catNo = tbody.id.replace('estBody', '');
                    renumberEstimateRows(tbody, catNo);
                    saveEstimateData();
                }
            }
            estDragSrcEl = null;
        }

        function renumberEstimateRows(tbody, catNo) {
            tbody.querySelectorAll('tr').forEach((row, index) => {
                const td = row.querySelector('td:first-child');
                // ê¸°ì¡´ ë²„íŠ¼ HTML ë³´ì¡´í•˜ë©° ë²ˆí˜¸ë§Œ ë³€ê²½
                td.innerHTML = `
                    <button class="del-btn-floating no-print" onclick="deleteEstimateRow(this, '${catNo}')" title="ì‚­ì œ">
                         <span style="font-size: 14px; font-weight: bold; line-height: 0;">-</span>
                    </button>
                    ${index + 1}
                `;
                td.classList.add('drag-handle');
                td.style.position = 'relative';
            });
        }

        // ê¸°ì¡´ í•¨ìˆ˜ë“¤ ì œê±°/êµì²´
        function updateEstimateFromCost() { }
        function getAllCostItems() { return []; }
        function loadAllCostItems() { }
        function clearEstimateRows() { }
        function onCheckChange() { }
        function onQtyChange() { }

        // ì›ê°€ê´€ë¦¬í‘œ ì €ì¥ (ì „ì—­ ë°ì´í„°ë¡œ ì €ì¥ - ëª¨ë“  ê³ ê°ì—ê²Œ ë™ì¼í•˜ê²Œ ì ìš©)
        function saveCostData() {
            const globalCostData = {};

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);
                if (!tbody) return;
                globalCostData[`cost_${cat.no}`] = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const inputs = row.querySelectorAll('.col-div input, .col-name input');
                    const specCell = row.querySelector('.col-spec');
                    const unitCell = row.querySelector('.col-unit');
                    const qtyInput = row.querySelector('.col-qty input');
                    const priceInput = row.querySelector('.col-price input');

                    // ìƒì„¸ë‚´ìš©: select ë˜ëŠ” inputì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
                    let specValue = '';
                    if (specCell) {
                        const specSelect = specCell.querySelector('select');
                        const specInput = specCell.querySelector('input');
                        specValue = specSelect ? specSelect.value : (specInput ? specInput.value : '');
                    }

                    // ë‹¨ìœ„: select ë˜ëŠ” inputì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
                    let unitValue = '';
                    if (unitCell) {
                        const unitSelect = unitCell.querySelector('.unit-select');
                        const unitInput = unitCell.querySelector('.unit-input');
                        unitValue = unitSelect ? unitSelect.value : (unitInput ? unitInput.value : '');
                    }

                    if (inputs.length >= 2 && inputs[1].value) {
                        globalCostData[`cost_${cat.no}`].push({
                            div: inputs[0].value,
                            name: inputs[1].value,
                            spec: specValue,
                            unit: unitValue,
                            qty: qtyInput ? qtyInput.value : '',
                            price: priceInput ? priceInput.value : ''
                        });
                    }
                });
                // MEMO ì €ì¥
                if (memo) {
                    globalCostData[`costMemo_${cat.no}`] = memo.value;
                }
            });

            // Master DBëŠ” ì´ í™”ë©´ì—ì„œ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (Read-Only)
            // if (currentAdmin && currentAdmin.role === 'main') { syncCostToCloud(globalCostData); }
        }

        // ì›ê°€ê´€ë¦¬í‘œ ì €ì¥ ìš”ì²­ (ë¹„í™œì„±í™” - Read Only)
        async function requestCostSave() {
            showToast('ë§ˆìŠ¤í„° ì›ê°€ê´€ë¦¬í‘œëŠ” ì‹œíŠ¸ì—ì„œ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.', 'info');
        }

        // ==========================================
        // [ì›ê°€ê´€ë¦¬í‘œ í´ë¼ìš°ë“œ ë™ê¸°í™”]
        // ==========================================

        // ì›ê°€ê´€ë¦¬í‘œë¥¼ Google Sheetsì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        async function syncCostFromCloud() {
            try {
                showToast('ì›ê°€ê´€ë¦¬í‘œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');

                const params = new URLSearchParams({
                    sheet: 'ì›ê°€ê´€ë¦¬í‘œ',
                    t: new Date().getTime()
                });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status);
                }

                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                if (result.data && Array.isArray(result.data)) {
                    // ë°ì´í„°ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë¦¬
                    let cloudCostData = {};
                    let loadCount = 0;
                    let unmappedCount = 0;

                    result.data.forEach(item => {
                        // ì¹´í…Œê³ ë¦¬ ë²ˆí˜¸ ë§¤í•‘ (í—¤ë”ê°’ ìš°ì„ , ì—†ìœ¼ë©´ êµ¬ë¶„ê°’ ì‚¬ìš©)
                        // item.categoryê°€ ìƒìœ„ í—¤ë”(ì˜ˆ: 'ìš•ì‹¤ê³µì‚¬')ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ì´ê²ƒë¶€í„° ë§¤í•‘ ì‹œë„
                        let catNo = mapCategoryToNo(item.category);
                        if (!catNo) catNo = mapCategoryToNo(item.div);

                        if (!catNo) {
                            unmappedCount++;
                            // console.warn('ë¶„ë¥˜ ì‹¤íŒ¨:', item.category, item.div, item.name); // ë””ë²„ê¹…ìš©
                            return;
                        }

                        if (!cloudCostData[`cost_${catNo}`]) {
                            cloudCostData[`cost_${catNo}`] = [];
                        }

                        cloudCostData[`cost_${catNo}`].push({
                            div: item.div || '',
                            name: item.name || '',
                            spec: item.spec || '',
                            unit: item.unit || '',
                            qty: item.qty || '',
                            price: item.price || ''
                        });
                        loadCount++;
                    });

                    // ë©”ëª¨ ë°ì´í„° ì²˜ë¦¬
                    if (result.memos && typeof result.memos === 'object') {
                        Object.keys(result.memos).forEach(categoryName => {
                            const catNo = mapCategoryToNo(categoryName);
                            if (catNo && result.memos[categoryName] && result.memos[categoryName].length > 0) {
                                // ë©”ëª¨ ë°°ì—´ì„ ì¤„ ë‹¨ìœ„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ì•ì— ë™ê·¸ë¼ë¯¸ ì¶”ê°€)
                                const memoLines = result.memos[categoryName]
                                    .map(m => m.content || '')
                                    .filter(line => line.trim())
                                    .map(line => 'â€¢ ' + line)
                                    .join('\n');
                                cloudCostData[`costMemo_${catNo}`] = memoLines;
                            }
                        });
                    }

                    // In-memory ë°ì´í„° ì—…ë°ì´íŠ¸
                    globalCostData = cloudCostData;
                    // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€


                    // UI ë¦¬ë¡œë“œ
                    createCostCategories();
                    loadCostData();

                    let msg = `ì›ê°€ê´€ë¦¬í‘œ ${loadCount}ê°œ í•­ëª©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`;
                    if (unmappedCount > 0) {
                        msg += ` (ë¶„ë¥˜ ì‹¤íŒ¨: ${unmappedCount}ê±´)`;
                        console.warn(`ì´ ${unmappedCount}ê°œ í•­ëª©ì„ ë¶„ë¥˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ì˜ [êµ¬ë¶„] ë˜ëŠ” [ì¹´í…Œê³ ë¦¬] ëª…ì¹­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                        showToast(`ì¼ë¶€ í•­ëª©(${unmappedCount}ê°œ)ì„ ë¶„ë¥˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ ì–‘ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`, 'warning');
                    } else {
                        showToast(msg, 'success');
                    }
                } else {
                    showToast('ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }

                return true;

            } catch (error) {
                console.error('ì›ê°€ê´€ë¦¬í‘œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                showToast('ì›ê°€ê´€ë¦¬í‘œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
                return false;
            }
        }


        // ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ë²ˆí˜¸ë¡œ ë§¤í•‘
        function mapCategoryToNo(categoryName) {
            if (!categoryName) return null;
            const name = categoryName.trim();

            const categoryMap = {
                'ê°€ì„¤ê³µì‚¬': '01', 'ê°€ì„¤': '01',
                'ì„¤ê³„ ë° ê´€ë¦¬ë¹„': '02', 'ì„¤ê³„': '02', 'ê´€ë¦¬ë¹„': '02', 'ì„¤ê³„ë¹„': '02',
                'ì² ê±°ê³µì‚¬': '03', 'ì² ê±°': '03',
                'ì„¤ë¹„/ë°©ìˆ˜ê³µì‚¬': '04', 'ì„¤ë¹„': '04', 'ë°©ìˆ˜': '04',
                'í™•ì¥/ë‹¨ì—´ê³µì‚¬': '05', 'í™•ì¥': '05', 'ë‹¨ì—´': '05',
                'ì°½í˜¸ê³µì‚¬': '06', 'ì°½í˜¸': '06', 'ìƒ¤ì‹œ': '06', 'ìƒ·ì‹œ': '06',
                'ì „ê¸°/ì¡°ëª…ê³µì‚¬': '07', 'ì „ê¸°': '07', 'ì¡°ëª…': '07', 'ì½˜ì„¼íŠ¸': '07',
                'ì—ì–´ì»¨ê³µì‚¬': '08', 'ì—ì–´ì»¨ ê³µì‚¬': '08', 'ì—ì–´ì»¨': '08',
                'ëª©ê³µ/ë„ì–´ê³µì‚¬': '09', 'ëª©ê³µ': '09', 'ë„ì–´': '09', 'ëª°ë”©': '09', 'ê±¸ë ˆë°›ì´': '09',
                'í•„ë¦„ê³µì‚¬': '10', 'í•„ë¦„': '10', 'ì¸í…Œë¦¬ì–´í•„ë¦„': '10',
                'íƒ€ì¼ê³µì‚¬': '11', 'íƒ€ì¼': '11',
                'ìš•ì‹¤ê³µì‚¬': '12', 'ìš•ì‹¤': '12', 'ë„ê¸°': '12', 'ìˆ˜ì „': '12', 'ì„¸ë©´': '12', 'ì–‘ë³€ê¸°': '12', 'ìš•ì¡°': '12', 'ì  ë‹¤ì´': '12', 'íŒŒí‹°ì…˜': '12',
                'ë„ì¥ê³µì‚¬': '13', 'ë„ì¥': '13', 'í˜ì¸íŠ¸': '13', 'íƒ„ì„±': '13',
                'ë„ë°°ê³µì‚¬': '14', 'ë„ë°°': '14', 'ë²½ì§€': '14',
                'ë°”ë‹¥ì¬ê³µì‚¬': '15', 'ë°”ë‹¥': '15', 'ë°”ë‹¥ì¬': '15', 'ë§ˆë£¨': '15', 'ì¥íŒ': '15', 'ë°ì½”íƒ€ì¼': '15',
                'ê°€êµ¬ê³µì‚¬': '16', 'ê°€êµ¬': '16', 'ì‹±í¬ëŒ€': '16', 'ì‹ ë°œì¥': '16', 'ë¶™ë°•ì´ì¥': '16',
                'ë§ˆê°ê³µì‚¬': '17', 'ë§ˆê°': '17', 'ì…ì£¼ì²­ì†Œ': '17', 'ì¤€ê³µì²­ì†Œ': '17',
                'ê¸°íƒ€ê³µì‚¬': '18', 'ê¸°íƒ€': '18'
            };

            // 1. ì™„ì „ ì¼ì¹˜ ë˜ëŠ” ë§¤í•‘ í…Œì´ë¸” ê²€ìƒ‰
            if (categoryMap[name]) return categoryMap[name];

            // 2. í‚¤ì›Œë“œ ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰ (ìš°ì„ ìˆœìœ„ì— ì£¼ì˜)
            // ì„¤ê³„ ë° ê´€ë¦¬ë¹„ í‚¤ì›Œë“œ ì²´í¬
            if (name.includes('ì„¤ê³„') || name.includes('ê´€ë¦¬ë¹„')) return '02';
            // ìš•ì‹¤ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ ê°€ì¥ ë¨¼ì € ì²´í¬ (ìš•ì‹¤ê³µì‚¬ì— ë‹¤ì–‘í•œ ì„¸ë¶€ ê³µì •ì´ í¬í•¨ë¨)
            if (name.includes('ìš•ì‹¤') || name.includes('UBR') || name.includes('ìˆ˜ë„') ||
                name.includes('ì¡°ì ') || name.includes('ì°¸ê³ ') || name.includes('ì•…ì„¸') ||
                name.includes('ì•¡ì„¸') || name.includes('ë¼ë””ì—ì´í„°') || name.includes('ë”') ||
                name.includes('ì²œì¥') || name.includes('í™˜í’') || name.includes('ë³€ê¸°') ||
                name.includes('ì„¸ë©´') || name.includes('ìƒ¤ì›Œ') || name.includes('ìš•ì¡°')) return '12';
            if (name.includes('íƒ€ì¼')) return '11';
            if (name.includes('ëª©ê³µ') || name.includes('ë„ì–´') || name.includes('ë¬¸')) return '09';
            if (name.includes('í•„ë¦„')) return '10';
            if (name.includes('ë„ë°°')) return '14';
            if (name.includes('ë°”ë‹¥') || name.includes('ë§ˆë£¨') || name.includes('ì¥íŒ')) return '15';
            if (name.includes('ê°€êµ¬') || name.includes('ì‹±í¬')) return '16';
            if (name.includes('ì „ê¸°') || name.includes('ì¡°ëª…') || name.includes('ìŠ¤ìœ„ì¹˜')) return '07';
            if (name.includes('ì„¤ë¹„') || name.includes('ë°©ìˆ˜') || name.includes('ë³´ì¼ëŸ¬')) return '04';
            if (name.includes('ì² ê±°')) return '03';
            if (name.includes('ì°½í˜¸') || name.includes('ìƒ¤ì‹œ') || name.includes('ìƒ·ì‹œ')) return '06';
            if (name.includes('ì—ì–´ì»¨')) return '07';
            if (name.includes('ë„ì¥') || name.includes('í˜ì¸íŠ¸')) return '12';
            if (name.includes('ë§ˆê°') || name.includes('ì²­ì†Œ')) return '16';

            return null;
        }



        // ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„° ë¡œë“œ (ì „ì—­ ë°ì´í„°)
        function loadCostData() {
            // ì „ì—­ ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„° ë¡œë“œ (Phase 2: In-memory ì‚¬ìš©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);
                if (!tbody) return;

                // ì „ì—­ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
                let data = globalCostData[`cost_${cat.no}`] || [];
                if (data.length === 0 && defaultCostData[cat.no]) {
                    data = defaultCostData[cat.no];
                }

                if (data.length === 0) {
                    tbody.innerHTML = `<tr>
                <td class="col-no">1</td>
                <td class="col-div"><input type="text"></td>
                <td class="col-name"><input type="text"></td>
                <td class="col-spec"><input type="text"></td>
                <td class="col-unit">${getUnitSelectHTML()}</td>
                <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-total">0</td>
            </tr>`;
                } else {
                    tbody.innerHTML = data.map((item, i) => {
                        const price = item.price || ((parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) +
                            (parseNumber(item.expense) || 0)) || '';
                        const qty = parseNumber(item.qty) || 0;
                        const priceNum = parseNumber(price) || 0;
                        const total = qty * priceNum;
                        return `<tr>
                <td class="col-no">${i + 1}</td>
                <td class="col-div"><input type="text" value="${item.div || ''}"></td>
                <td class="col-name"><input type="text" value="${item.name || ''}"></td>
                <td class="col-spec"><input type="text" value="${item.spec || ''}"></td>
                <td class="col-unit">${getUnitSelectHTML(item.unit || 'ì‹')}</td>
                <td class="col-qty"><input type="text" value="${item.qty || ''}" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" value="${price}" oninput="calcCostRow(this)"></td>
                <td class="col-total">${formatNumber(total)}</td>
            </tr>`;
                    }).join('');
                }
                // MEMO ë¡œë“œ (ì €ì¥ëœ ë©”ëª¨ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ëª¨ ì‚¬ìš©)
                if (memo) {
                    memo.value = globalCostData[`costMemo_${cat.no}`] || defaultCostMemos[cat.no] || '';
                    autoResizeTextarea(memo);
                }
                // ì†Œê³„ ì—…ë°ì´íŠ¸
                updateCostCategorySubtotal(cat.no);
            });
            // ë©”ëª¨ë¥¼ ê³„ì•½ê²¬ì ì„œì— ë™ê¸°í™”
            syncCostMemoToEstimate();
        }

        function clearCostData() {
            // ì „ì—­ ì›ê°€ê´€ë¦¬í‘œ ë°ì´í„° ë¡œë“œ (Phase 2: In-memory ì‚¬ìš©)
            // const globalCostData = JSON.parse(localStorage.getItem('DJ_global_cost') || '{}');

            categories.forEach(cat => {
                const tbody = document.getElementById(`costBody${cat.no}`);
                const memo = document.getElementById(`costMemo${cat.no}`);

                // ì „ì—­ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„°
                let data = globalCostData[`cost_${cat.no}`] || [];
                if (data.length === 0) {
                    data = defaultCostData[cat.no] || [];
                }

                if (tbody) {
                    if (data.length > 0) {
                        tbody.innerHTML = data.map((item, i) => {
                            const price = item.price || ((parseNumber(item.material) || 0) + (parseNumber(item.labor) || 0) +
                                (parseNumber(item.expense) || 0)) || '';
                            const qty = parseNumber(item.qty) || 0;
                            const priceNum = parseNumber(price) || 0;
                            const total = qty * priceNum;
                            return `<tr>
                <td class="col-no">${i + 1}</td>
                <td class="col-div"><input type="text" value="${item.div || ''}"></td>
                <td class="col-name"><input type="text" value="${item.name || ''}"></td>
                <td class="col-spec"><input type="text" value="${item.spec || ''}"></td>
                <td class="col-unit">${getUnitSelectHTML(item.unit || 'ì‹')}</td>
                <td class="col-qty"><input type="text" value="${item.qty || ''}" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" value="${price}" oninput="calcCostRow(this)"></td>
                <td class="col-total">${formatNumber(total)}</td>
            </tr>`;
                        }).join('');
                    } else {
                        tbody.innerHTML = `<tr>
                <td class="col-no">1</td>
                <td class="col-div"><input type="text"></td>
                <td class="col-name"><input type="text"></td>
                <td class="col-spec"><input type="text"></td>
                <td class="col-unit">${getUnitSelectHTML()}</td>
                <td class="col-qty"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-price"><input type="text" oninput="calcCostRow(this)"></td>
                <td class="col-total">0</td>
            </tr>`;
                    }
                }
                if (memo) {
                    memo.value = globalCostData[`costMemo_${cat.no}`] || defaultCostMemos[cat.no] || '';
                    autoResizeTextarea(memo);
                }
                // ì†Œê³„ ì—…ë°ì´íŠ¸
                updateCostCategorySubtotal(cat.no);
            });
        }

        function downloadPDF(elementId, filename) {
            const element = document.getElementById(elementId);
            if (!element) {
                showToast('ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const customerName = currentData.clientName || 'ê³ ê°';
            const today = new Date().toISOString().split('T')[0];
            const pdfFilename = ` ${customerName}_${filename}_${today} `;

            // ìƒˆ ì°½ì—ì„œ ì¸ì‡„
            const printWindow = window.open('', '_blank');

            if (!printWindow) {
                showToast('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ìŠ¤íƒ€ì¼ ë³µì‚¬
            const styles = document.querySelectorAll('style, link[rel="stylesheet"]');
            let styleHTML = '';
            styles.forEach(s => styleHTML += s.outerHTML);

            // element ë³µì œ
            const clonedElement = element.cloneNode(true);

            // ìˆ˜ë™ ì¡°ì ˆëœ ì»¬ëŸ¼ ë„ˆë¹„ë¥¼ colgroup colì— ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ë™ê¸°í™”
            element.querySelectorAll('.estimate-table').forEach((origTable, tableIdx) => {
                const clonedTable = clonedElement.querySelectorAll('.estimate-table')[tableIdx];
                if (!clonedTable) return;
                const origThs = origTable.querySelectorAll('thead th');
                const clonedCols = clonedTable.querySelectorAll('colgroup col');
                origThs.forEach((th, i) => {
                    if (clonedCols[i]) {
                        clonedCols[i].style.width = th.offsetWidth + 'px';
                    }
                });
            });

            // ì¸ì‡„ì— ë¶ˆí•„ìš”í•œ ìš”ì†Œ ì œê±° (ë…¸ì…˜ ë²„íŠ¼, ì•„ì´ì½˜ ë“±)
            clonedElement.querySelectorAll('.no-print, .btn, .pdf-btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // [Fix] Clone does not copy dynamic values! Sync manually.
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');
            originalInputs.forEach((inp, i) => {
                if (clonedInputs[i]) {
                    if (inp.type === 'checkbox' || inp.type === 'radio') {
                        clonedInputs[i].checked = inp.checked;
                    } else {
                        clonedInputs[i].value = inp.value;
                    }
                }
            });

            // ëª¨ë“  inputì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
            clonedElement.querySelectorAll('input').forEach(input => {
                // Radio/Checkbox handling
                if (input.type === 'radio' || input.type === 'checkbox') {
                    const span = document.createElement('span');
                    span.textContent = input.checked ? 'â˜‘' : 'â˜';
                    span.style.cssText = 'display:inline-block; margin-right:4px; font-weight:bold;';
                    input.parentNode.replaceChild(span, input);
                    return;
                }

                const span = document.createElement('span');
                span.textContent = input.value || '-';
                span.style.cssText = 'display:inline-block; padding:3px 0; font-size:inherit;';
                input.parentNode.replaceChild(span, input);
            });

            // ëª¨ë“  textareaë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ìŠ¤í¬ë¡¤ ì—†ì´ ì „ì²´ í‘œì‹œ)
            clonedElement.querySelectorAll('textarea').forEach(textarea => {
                const div = document.createElement('div');
                div.textContent = textarea.value || '';
                div.style.cssText = 'white-space:pre-wrap; padding:6px 0; font-size:inherit; line-height:1.5;';
                textarea.parentNode.replaceChild(div, textarea);
            });

            // ëª¨ë“  selectë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
            clonedElement.querySelectorAll('select').forEach(select => {
                const span = document.createElement('span');
                const selectedOption = select.options[select.selectedIndex];
                span.textContent = selectedOption ? selectedOption.text : '-';
                span.style.cssText = 'display:inline-block; padding:3px 0; font-size:inherit;';
                select.parentNode.replaceChild(span, select);
            });

            // ê²¬ì ì„œì¸ ê²½ìš° ì¶”ê°€ ì²˜ë¦¬
            if (elementId === 'estimateDoc') {
                // í’ˆëª…ì´ ì„ íƒë˜ì§€ ì•Šì€ í–‰ ì œê±° (ê¸ˆì•¡ì´ '-'ì¸ í–‰)
                clonedElement.querySelectorAll('.estimate-table tbody tr').forEach(tr => {
                    const amountCell = tr.querySelector('.amount-cell');
                    if (amountCell && (amountCell.textContent === '-' || amountCell.textContent === '0')) {
                        tr.remove();
                    }
                });

                // ê° ì¹´í…Œê³ ë¦¬ë³„ ë²ˆí˜¸ ì¬ì •ë ¬
                clonedElement.querySelectorAll('.estimate-table tbody').forEach(tbody => {
                    tbody.querySelectorAll('tr').forEach((tr, i) => {
                        const cells = tr.querySelectorAll('td');
                        if (cells[0]) cells[0].textContent = i + 1;
                    });
                });

                // ë¹ˆ ì¹´í…Œê³ ë¦¬ ìˆ¨ê¸°ê¸° (í•­ëª©ì´ ì—†ëŠ” ì¹´í…Œê³ ë¦¬)
                clonedElement.querySelectorAll('.category-section').forEach(section => {
                    const tbody = section.querySelector('.estimate-table tbody');
                    if (tbody && tbody.querySelectorAll('tr').length === 0) {
                        section.style.display = 'none';
                    }
                });


            }

            // ì¸ì‡„ìš© HTML ìƒì„±
            printWindow.document.write(`
                            <!DOCTYPE html>
                                <html>

                                    <head>
                                        <meta charset="UTF-8">
                                            <title>${pdfFilename}</title>
                                            ${styleHTML}                                            <style>
                                                @page {
                                                    size: A4;
                                                margin: 8mm 5mm 10mm 5mm;
                        /* ì¢Œìš° ìµœì†Œí™” */
                   }

                                                * {
                                                    -webkit-print - color-adjust: exact !important;
                                                print-color-adjust: exact !important;
                   }

                                                html,
                                                body {
                                                    margin: 0 !important;
                                                padding: 0 !important;
                                                width: 100% !important;
                                                background: white !important;
                   }

                                                .document-wrapper {
                                                    box-shadow: none !important;
                                                border: none !important;
                                                margin: 0 !important;
                                                padding: 10px !important;
                                                width: 100% !important;
                                                max-width: none !important;
                   }

                                                .doc-content {
                                                    padding: 0 !important;
                   }

                                                .pdf-btn,
                                                .no-print,
                                                .add-row-btn,
                                                .estimate-actions {
                                                    display: none !important;
                   }

                                                /* í…Œì´ë¸” ì „ì²´ ë„ˆë¹„ */
                                                .data-table,
                                                .estimate-table,
                                                .summary-table,
                                                .estimate-select-table {
                                                    width: 100% !important;
                                                table-layout: fixed !important;
                                                font-size: 10px !important;
                   }

                                                /* í…Œì´ë¸” í—¤ë” */
                                                .data-table th,
                                                .estimate-table th,
                                                .summary-table th {
                                                    padding: 5px 3px !important;
                                                font-size: 9px !important;
                                                white-space: nowrap !important;
                   }

                                                /* í…Œì´ë¸” ì…€ */
                                                .data-table td,
                                                .estimate-table td,
                                                .summary-table td {
                                                    padding: 4px 3px !important;
                                                font-size: 10px !important;
                   }

                                                /* ===== ê²¬ì ì„œ í…Œì´ë¸” ì»¬ëŸ¼ë³„ ì„¤ì • ===== */
                                                /* í—¤ë” ê°€ìš´ë° ì •ë ¬ */
                                                .estimate-table th {
                                                    text-align: center !important;
                   }
                                                /* No (1ë²ˆì§¸) */
                                                .estimate-table th:nth-child(1),
                                                .estimate-table td:nth-child(1) {
                                                    width: 20px !important;
                                                text-align: center !important;
                   }

                                                /* êµ¬ë¶„ (2ë²ˆì§¸) - ì¸ì‡„ ì‹œ ì¢ê²Œ */
                                                .estimate-table th:nth-child(2),
                                                .estimate-table td:nth-child(2) {
                                                    width: 50px !important;
                                                text-align: left !important;
                   }

                                                /* í’ˆëª… (3ë²ˆì§¸) - ì¢Œì¸¡ì •ë ¬ */
                                                .estimate-table th:nth-child(3),
                                                .estimate-table td:nth-child(3) {
                                                    width: 15% !important;
                                                text-align: left !important;
                   }

                                                /* ìƒì„¸ë‚´ìš© (4ë²ˆì§¸) - ì¢Œì¸¡ì •ë ¬, ê°€ì¥ ë„“ê²Œ */
                                                .estimate-table th:nth-child(4),
                                                .estimate-table td:nth-child(4) {
                                                    width: 25% !important;
                                                text-align: left !important;
                   }

                                                /* ë‹¨ìœ„ (5ë²ˆì§¸) - ì¤‘ì•™, ê³ ì • */
                                                .estimate-table th:nth-child(5),
                                                .estimate-table td:nth-child(5) {
                                                    width: 30px !important;
                                                text-align: center !important;
                   }

                                                /* ìˆ˜ëŸ‰ (6ë²ˆì§¸) - ì¤‘ì•™, ê³ ì • */
                                                .estimate-table th:nth-child(6),
                                                .estimate-table td:nth-child(6) {
                                                    width: 35px !important;
                                                text-align: center !important;
                   }

                                                /* ë‹¨ê°€ (7ë²ˆì§¸) - ë„ˆë¹„ ì¶•ì†Œ, ì¤‘ì•™ ì •ë ¬ */
                                                .estimate-table th:nth-child(7),
                                                .estimate-table td:nth-child(7) {
                                                    width: 75px !important;
                                                text-align: center !important;
                   }
                                                .estimate-table td:nth-child(7) .won-amount {
                                                    display: flex !important;
                                                justify-content: center !important;
                                                gap: 4px !important;
                   }

                                                /* ê¸ˆì•¡ (8ë²ˆì§¸) - ë„ˆë¹„ ì¶•ì†Œ, ì¤‘ì•™ ì •ë ¬ */
                                                .estimate-table th:nth-child(8),
                                                .estimate-table td:nth-child(8) {
                                                    width: 80px !important;
                                                text-align: center !important;
                   }
                                                .estimate-table td:nth-child(8) .won-amount {
                                                    display: flex !important;
                                                justify-content: center !important;
                                                gap: 4px !important;
                   }

                                                /* ë¹„ê³  (9ë²ˆì§¸) - ë‚˜ë¨¸ì§€ ê³µê°„ */
                                                .estimate-table th:nth-child(9),
                                                .estimate-table td:nth-child(9) {
                                                    width: auto !important;
                                                text-align: left !important;
                   }

                                                /* ì›ê°€ê´€ë¦¬í‘œ ì»¬ëŸ¼ ë„ˆë¹„ */
                                                .data-table colgroup col:nth-child(1) {
                                                    width: 18px;
                   }

                                                /* No */
                                                .data-table colgroup col:nth-child(2) {
                                                    width: 32px;
                   }

                                                /* êµ¬ë¶„ */
                                                .data-table colgroup col:nth-child(3) {
                                                    width: auto;
                   }

                                                /* í’ˆëª… */
                                                .data-table colgroup col:nth-child(4) {
                                                    width: 70px;
                   }

                                                /* ê·œê²© */
                                                .data-table colgroup col:nth-child(5) {
                                                    width: 28px;
                   }

                                                /* ë‹¨ìœ„ */
                                                .data-table colgroup col:nth-child(6) {
                                                    width: 28px;
                   }

                                                /* ìˆ˜ëŸ‰ */
                                                .data-table colgroup col:nth-child(7) {
                                                    width: 65px;
                   }

                                                /* ë‹¨ê°€ */
                                                .data-table colgroup col:nth-child(8) {
                                                    width: 60px;
                   }

                                                /* ê¸ˆì•¡ */
                                                .data-table colgroup col:nth-child(9) {
                                                    width: 45px;
                   }

                                                /* ë¹„ê³  */

                                                /* ê²¬ì ì„œ ì»¬ëŸ¼ - ê³ ì • ë„ˆë¹„ */
                                                .estimate-table colgroup col {
                                                    width: auto !important;
                   }

                                                /* êµ¬ë¶„ ì—´ ìˆ¨ê¸°ê¸° */
                                                .col-div,
                                                th.col-div {
                                                    display: none !important;
                   }

                                                /* ì²´í¬ë°•ìŠ¤ ìˆ¨ê¸°ê¸° */
                                                input[type="checkbox"] {
                                                    display: none !important;
                   }

                                                /* í–‰ ìŠ¤íƒ€ì¼ ì •ë¦¬ */
                                                tr {
                                                    opacity: 1 !important;
                                                text-decoration: none !important;
                   }

                                                /* ì¹´í…Œê³ ë¦¬ í—¤ë” */
                                                .category-header {
                                                    padding: 5px 8px !important;
                   }

                                                .category-header h3 {
                                                    font-size: 10px !important;
                   }

                                                .category-header .subtotal {
                                                    font-size: 10px !important;
                   }

                                                /* ì´í•©ê³„ */
                                                .grand-total {
                                                    padding: 8px !important;
                                                margin-top: 6px !important;
                   }

                                                .total-row {
                                                    padding: 3px 0 !important;
                   }

                                                .total-row label {
                                                    font-size: 9px !important;
                   }

                                                .total-row .amount {
                                                    font-size: 10px !important;
                   }

                                                .total-row.main .amount {
                                                    font-size: 12px !important;
                   }

                                                /* ì •ë³´ ê·¸ë¦¬ë“œ */
                                                .info-grid {
                                                    gap: 5px !important;
                   }

                                                .info-item {
                                                    padding: 5px 6px !important;
                   }

                                                .info-item label {
                                                    font-size: 7px !important;
                   }

                                                .info-item input,
                                                .info-item select,
                                                .info-item span {
                                                    font-size: 9px !important;
                   }

                                                /* ë©”ëª¨ ì „ì²´ í‘œì‹œ */
                                                .estimate-memo,
                                                .category-memo {
                                                    overflow: visible !important;
                                                max-height: none !important;
                   }

                                                .estimate-memo .memo-content,
                                                .category-memo textarea {
                                                    white-space: pre-wrap !important;
                                                word-break: break-word !important;
                                                font-size: 8px !important;
                   }

                                                /* ì„œëª… ì˜ì—­ */
                                                .signature-grid {
                                                    display: grid !important;
                                                    grid-template-columns: repeat(2, 1fr) !important;
                                                    gap: 12px !important;
                   }

                                                .signature-card {
                                                    background: #fbfbfd !important;
                                                    border-radius: 8px !important;
                                                    padding: 14px !important;
                                                    border: 1px solid #e8e8ed !important;
                   }

                                                .signature-card h4 {
                                                    font-size: 11px !important;
                                                    text-align: center !important;
                                                    font-weight: 700 !important;
                                                    margin-bottom: 10px !important;
                                                    padding-bottom: 6px !important;
                                                    border-bottom: 1px solid #e8e8ed !important;
                   }

                                                .sig-row {
                                                    display: grid !important;
                                                    grid-template-columns: repeat(2, 1fr) !important;
                                                    gap: 8px !important;
                                                    margin-bottom: 6px !important;
                   }

                                                .sig-field {
                                                    margin-bottom: 4px !important;
                   }

                                                .sig-field label {
                                                    font-size: 8px !important;
                                                    display: block !important;
                                                    color: #86868b !important;
                                                    font-weight: 600 !important;
                                                    margin-bottom: 2px !important;
                   }

                                                .sig-field input,
                                                .sig-field span {
                                                    font-size: 10px !important;
                                                    border: none !important;
                                                    border-bottom: 1px solid #d2d2d7 !important;
                                                    padding: 3px 0 !important;
                                                    font-weight: 500 !important;
                   }

                                                .signature-box {
                                                    margin-top: 8px !important;
                                                    padding: 14px !important;
                                                    background: #fff !important;
                                                    border: 2px dashed #d2d2d7 !important;
                                                    border-radius: 6px !important;
                                                    text-align: center !important;
                                                    color: #86868b !important;
                                                    font-size: 10px !important;
                   }

                                                .stamp-warning {
                                                    margin-top: 6px !important;
                                                    background: #fff9e6 !important;
                                                    border: 2px solid #ffcc00 !important;
                                                    border-radius: 4px !important;
                                                    padding: 5px !important;
                                                    text-align: center !important;
                                                    font-size: 10px !important;
                                                    color: #1d1d1f !important;
                                                    font-weight: 500 !important;
                   }

                                                .date-box {
                                                    text-align: center !important;
                                                    padding: 16px !important;
                                                    background: #fbfbfd !important;
                                                    border-radius: 8px !important;
                                                    margin: 16px 0 !important;
                                                    border: 1px solid #e8e8ed !important;
                   }

                                                .date-box label {
                                                    font-size: 9px !important;
                                                    color: #86868b !important;
                                                    font-weight: 600 !important;
                                                    display: block !important;
                                                    margin-bottom: 4px !important;
                   }

                                                .date-box input,
                                                .date-box .synced-display {
                                                    font-size: 13px !important;
                                                    font-weight: 600 !important;
                                                    text-align: center !important;
                   }

                                                /* ì¡°í•­ */
                                                .clause {
                                                    padding: 6px !important;
                                                margin-bottom: 3px !important;
                   }

                                                .clause-title {
                                                    font-size: 9px !important;
                   }

                                                .clause-content {
                                                    font-size: 8px !important;
                                                line-height: 1.4 !important;
                   }

                                                /* ëŒ€ê¸ˆì§€ê¸‰ */
                                                .payment-item {
                                                    padding: 5px !important;
                   }

                                                .payment-item label {
                                                    font-size: 7px !important;
                   }

                                                .payment-item input,
                                                .payment-item span {
                                                    font-size: 9px !important;
                   }

                                                /* í˜ì´ì§€ ë²ˆí˜¸ */
                                                .page-number {
                                                    position: fixed;
                                                bottom: 3mm;
                                                left: 0;
                                                right: 0;
                                                text-align: center;
                                                font-size: 8px;
                                                color: #86868b;
                   }

                                                .page-number::after {
                                                    content: counter(page);
                   }

                                                @media screen {
                        .page-number {
                                                    display: none;
                       }
                   }

                                                @media print {
                        .page-number {
                                                    display: block;
                       }
                   }
                                            </style>
                                    </head>

                                    <body>
                                        ${clonedElement.outerHTML}                                        <div class="page-number"></div>
                                        <script>
                                            window.onload = function () {
                                                setTimeout(function () {
                                                    window.print();
                                                    window.onafterprint = function () { window.close(); };
                                                }, 500);
                   };
    <\/script>
</body>
</html>
`);

            printWindow.document.close();
            showToast('ì¸ì‡„ ì˜µì…˜ì—ì„œ "ë¨¸ë¦¬ê¸€/ë°”ë‹¥ê¸€" í•´ì œ í›„ PDF ì €ì¥', 'success');
        }

        function printSchedule(isPdf) {
            const element = document.getElementById('scheduleDoc');
            if (!element) {
                showToast('ìŠ¤ì¼€ì¤„ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // Clone the element to perform modifications specifically for printing
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Convert input, select, textarea values to text for static printing
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originalInputs.length; i++) {
                const origin = originalInputs[i]; const clone = clonedInputs[i]; if
                    (!clone) continue; let text = ''; if (origin.tagName === 'SELECT') {
                        if (origin.options.length > 0 &&
                            origin.selectedIndex >= 0) {
                            text = origin.options[origin.selectedIndex].text;
                            // 'ì„ íƒ' ê°™ì€ ê¸°ë³¸ê°’ì€ ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
                            if (text === 'ì„ íƒ' || text === 'ì¹´í…Œê³ ë¦¬ ë¨¼ì € ì„ íƒ' || text === 'ë‹´ë‹¹ì ì„ íƒ') text = '';
                        }
                    } else {
                    text = origin.value;
                }

                // Create a text span to replace the input element
                const span = document.createElement('span');

                // Handle Radios and Checkboxes specifically - keep them visual or convert to text
                if (origin.type === 'radio' || origin.type === 'checkbox') {
                    // For print, we might want to just show the checked status text or a symbol
                    // However, the original code had labels around them.
                    // Simplest approach: If checked, show "â˜‘ ", if not "â˜ "
                    // But the user's HTML has label wrapping text.
                    // Let's just keep the checked one's text and hide the unchecked ones?
                    // Or better: Replace the entire parent label with just the text if checked.

                    // Current fallback: Just let them render but minimize checkmark size
                    // Actually, the previous issue might be the label spacing.
                    const symbol = origin.checked ? 'â˜‘' : 'â˜';
                    span.textContent = symbol;
                    span.style.cssText = 'font-size: 10px; margin-right: 2px; line-height: 24px; vertical-align: middle;';
                    if (clone.parentNode) clone.parentNode.replaceChild(span, clone);
                    continue;
                }

                span.textContent = text || ''; // Ensure explicit empty string if null

                // Apply strict minimal styles to avoid inheritance bloat
                span.style.cssText = 'border:none; background:transparent; padding:0; margin:0; display:inline-block; width:100%; height:100%; line-height:24px; vertical-align:middle; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:10px;';

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
    <!DOCTYPE html>
    <html>

    <head>
        <title>ê³µì‚¬ ìŠ¤ì¼€ì¤„ - ${isPdf ? 'PDF ì €ì¥' : 'ì¸ì‡„'}</title>
        <style>
            body {
                font-family: 'Inter', -apple-system, sans-serif;
                padding: 20px;
                background: white;
            }

            /* Header Styles */
            .doc-header {
                background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                color: #ffffff !important;
                padding: 20px 24px !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                margin-bottom: 20px !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                border-radius: 0 !important;
            }

            /* Hide unwanted elements */
            .no-print, 
            .btn, 
            .restore-btn, 
            .notion-export-btn, 
            button {
                display: none !important;
            }

            .doc-header h1 {
                font-size: 24px !important;
                font-weight: 700 !important;
                margin: 0 !important;
                color: #fff !important;
                line-height: 1.2 !important;
            }

            /* Hide emojis in header */
            .doc-header h1 .emoji-icon { display: none !important; }

            .doc-header .subtitle {
                font-size: 14px !important;
                opacity: 0.9 !important;
                color: #fff !important;
                margin-top: 4px !important;
            }

            /* Reset Grid/Flex for print if needed */
            .info-grid {
                display: block;
            }

            /* Table Styles */
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 10px;
                margin-bottom: 10px;
                table-layout: fixed;
            }

            /* Height Enforcement */
            tr {
                height: 24px !important;
                max-height: 24px !important;
            }

            th,
            td {
                border: 1px solid #d2d2d7;
                padding: 0 4px !important;
                height: 24px !important;
                max-height: 24px !important;
                line-height: 24px !important;
                vertical-align: middle !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
                white-space: nowrap !important;
            }

            /* Customer Info Table Specifics */
            .schedule-info-table th {
                background: #f9f9fb;
                font-weight: 600;
                color: #333;
                width: 15%;
            }

            .schedule-info-table td {
                text-align: left;
                width: 35%;
            }

            /* Rowspan handling */
            th[rowspan],
            td[rowspan] {
                height: auto !important;
                max-height: none !important;
            }

            /* Data Table Specifics */
            .data-table th {
                background: #f5f5f7;
                font-weight: 600;
                color: #333;
            }

            /* Remove any other interfering elements */
            .no-print,
            .restore-btn,
            .notion-export-btn,
            button {
                display: none !important;
            }
            
            /* Hide emoji icons in headers during print */
            h1 .emoji-icon,
            h1 .icon,
            h1 span[role="img"] {
                display: none !important;
            }

            /* Reset all internal elements */
            td *,
            th * {
                vertical-align: middle !important;
                line-height: 24px !important;
                /* Force content align */
            }

            @media print {
                @page {
                    size: A4 landscape;
                    margin: 10mm;
                }

                body {
                    -webkit-print-color-adjust: exact;
                }

                th,
                td {
                    border-color: #d2d2d7 !important;
                }
            }
        </style>
    </head>

    <body>
        ${clonedElement.innerHTML}
        <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                // window.onafterprint = function() { window.close(); };
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();

            if (isPdf) {
                showToast('ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'success');
            }
        }

        function printASList(isPdf) {
            const element = document.getElementById('asListDoc');
            if (!element) {
                showToast('A/S ë¦¬ìŠ¤íŠ¸ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // Clone the element to perform modifications specifically for printing
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Convert input, select, textarea values to text for static printing
            const originalInputs = element.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedElement.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originalInputs.length; i++) {
                const origin = originalInputs[i];
                const clone = clonedInputs[i];
                if (!clone) continue;

                let text = '';
                if (origin.tagName === 'SELECT') {
                    if (origin.options.length > 0 && origin.selectedIndex >= 0) {
                        text = origin.options[origin.selectedIndex].text;
                        // 'ì„ íƒ' ê°™ì€ ê¸°ë³¸ê°’ì€ ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
                        if (text === 'ì„ íƒ' || text === 'ì¹´í…Œê³ ë¦¬ ë¨¼ì € ì„ íƒ' || text === 'ë‹´ë‹¹ì ì„ íƒ') text = '';
                    }
                } else {
                    text = origin.value;
                }

                // Create a text span to replace the input element
                const span = document.createElement('span');

                // Handle Radios and Checkboxes specifically
                if (origin.type === 'radio' || origin.type === 'checkbox') {
                    const symbol = origin.checked ? 'â˜‘' : 'â˜';
                    span.textContent = symbol;
                    span.style.cssText = 'font-size: 10px; margin-right: 2px; line-height: 24px; vertical-align: middle;';
                    if (clone.parentNode) clone.parentNode.replaceChild(span, clone);
                    continue;
                }

                span.textContent = text || ''; // Ensure explicit empty string if null

                // Apply strict minimal styles to avoid inheritance bloat
                span.style.cssText = 'border:none; background:transparent; padding:0; margin:0; display:inline-block; width:100%; height:100%; line-height:24px; vertical-align:middle; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:10px;';

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ - ${isPdf ? 'PDF ì €ì¥' : 'ì¸ì‡„'}</title>
                    <style>
                        body {
                            font-family: 'Inter', -apple-system, sans-serif;
                            padding: 20px;
                            background: white;
                        }

                        /* Header Styles */
                        .doc-header {
                            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                            color: #ffffff !important;
                            padding: 20px 24px !important;
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            margin-bottom: 10px !important; /* Adjusted to match table spacing */
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                        .doc-header h1 { font-size: 20px; margin: 0; color: #fff !important; line-height: 1.2; }
                        .doc-header .subtitle { font-size: 10px; opacity: 0.9; color: #fff !important; margin-top: 4px; }

                        /* Reset Grid/Flex for print if needed */
                        .info-grid { display: block; }

                        /* Table Styles */
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            font-size: 10px;
                            margin-bottom: 10px;
                            table-layout: fixed;
                        }

                        /* Height Enforcement */
                        tr { height: 24px !important; max-height: 24px !important; }
                        th, td {
                            border: 1px solid #d2d2d7;
                            padding: 0 4px !important;
                            height: 24px !important;
                            max-height: 24px !important;
                            line-height: 24px !important;
                            vertical-align: middle !important;
                            box-sizing: border-box !important;
                            overflow: hidden !important;
                            white-space: nowrap !important;
                        }

                        /* Customer Info Table Specifics */
                        .schedule-info-table th { background: #f9f9fb; font-weight: 600; color: #333; width: 15%; }
                        .schedule-info-table td { text-align: left; width: 35%; }

                        /* Rowspan handling */
                        th[rowspan], td[rowspan] {
                            height: auto !important;
                            max-height: none !important;
                        }

                        /* Data Table Specifics */
                        .data-table th { background: #f5f5f7; font-weight: 600; color: #333; }

                        /* Remove any other interfering elements */
                        .no-print, button { display: none !important; }
                        
                        /* Print Only Cells - NEW: Override display:none */
                        .print-only-cell { display: table-cell !important; }

                        /* Reset all internal elements */
                        td *, th * {
                            vertical-align: middle !important;
                            line-height: 24px !important; /* Force content align */
                        }

                        @media print {
                            @page { size: A4 landscape; margin: 10mm; }
                            body { -webkit-print-color-adjust: exact; }
                            th, td { border-color: #d2d2d7 !important; }
                        }
                    </style>
                </head>
                <body>
                    ${clonedElement.innerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                // window.onafterprint = function() { window.close(); };
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();

            if (isPdf) {
                showToast('ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'success');
            }
        }


        async function exportAllData() {
            // Capture currentCustomerId before showing modal
            const capturedCustomerId = currentCustomerId;

            // Excel ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ì„ íƒ
            const choice = await new Promise(resolve => {
                const modal = document.createElement('div');
                modal.className = 'admin-modal show';
                modal.id = 'exportExcelModal';
                modal.innerHTML = `
                    <div class="admin-modal-content" style="width:360px;">
                        <h3>ğŸ“Š Excel ë‚´ë³´ë‚´ê¸°</h3>
                        <p style="margin-bottom:16px;">ë‚´ë³´ë‚¼ ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <button id="exportChoiceAll" class="header-btn primary" style="width:100%; justify-content:center;">
                                ğŸ“ ì „ì²´ ê³ ê° ë‚´ë³´ë‚´ê¸°
                            </button>
                            ${capturedCustomerId ? `
                            <button id="exportChoiceCurrent" class="header-btn secondary" style="width:100%; justify-content:center;">
                                ğŸ‘¤ í˜„ì¬ ê³ ê°ë§Œ ë‚´ë³´ë‚´ê¸°
                            </button>
                            ` : ''}
                            <button id="exportChoiceCancel" class="header-btn" style="width:100%; justify-content:center; background:#f5f5f7; color:#1d1d1f;">
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Attach event listeners after modal is in DOM
                document.getElementById('exportChoiceAll').onclick = () => {
                    modal.remove();
                    resolve('all');
                };
                if (capturedCustomerId) {
                    document.getElementById('exportChoiceCurrent').onclick = () => {
                        modal.remove();
                        resolve('current');
                    };
                }
                document.getElementById('exportChoiceCancel').onclick = () => {
                    modal.remove();
                    resolve('cancel');
                };
            });

            if (choice === 'cancel') return;

            const customerId = choice === 'current' ? capturedCustomerId : 'all';

            showToast('Excel ë°ì´í„° ì¤€ë¹„ ì¤‘...', 'info');

            try {
                // ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const params = new URLSearchParams({
                    action: 'exportExcel',
                    customerId: customerId,
                    t: Date.now()
                });

                const response = await fetch(CUSTOMER_SYNC_URL + '?' + params.toString());
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }

                if (result.fileName && result.data) {
                    // Base64 to Blob ë³€í™˜
                    const byteCharacters = atob(result.data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: result.mimeType });

                    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŠ¸ë¦¬ê±°
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'designjig_data_' + new Date().toISOString().slice(0, 10).replace(/-/g, '') + '.xlsx';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    showToast('ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤. (' + result.customerCount + 'ëª…)', 'success');
                    logUserAction('Excel ë‚´ë³´ë‚´ê¸°', `${result.customerCount}ëª… ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸°`);
                } else {
                    throw new Error('ì—‘ì…€ íŒŒì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('Excel Export Error:', error);
                showToast('Excel ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }


        function importData() {
            if (!isLoggedIn()) {
                showToast('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                showAdminModal();
                return;
            }
            document.getElementById('importFile').click();
        }
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.customers) {
                        customers = data.customers;
                        // [Phase 2] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì¤‘ë‹¨

                        updateCustomerList();
                        showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤', 'success');
                    }
                } catch { showToast('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error'); }
            };
            reader.readAsText(file);
        }

        function parseNumber(str) {
            if (typeof str === 'number') return str;
            return parseInt((String(str || '')).replace(/[^0-9-]/g, '')) || 0;
        }
        function formatNumber(num) { return num.toLocaleString('ko-KR'); }

        // í†µê³„ ëª¨ë‹¬
        let chartInstances = {};

        function openStatsModal() {
            document.getElementById('statsModal').classList.add('show');
            renderAllStats();
        }

        function closeStatsModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('statsModal').classList.remove('show');
            // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};
        }

        // ì§‘ê³„ ë‹¨ìœ„ ë³€ìˆ˜ (ê¸°ë³¸: ì›”ë³„)
        let statsAggregationType = 'monthly';

        function setAggregationType(type) {
            statsAggregationType = type;
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const monthlyBtn = document.getElementById('filterMonthly');
            const yearlyBtn = document.getElementById('filterYearly');
            if (type === 'monthly') {
                monthlyBtn.style.background = '#0071e3';
                monthlyBtn.style.color = 'white';
                yearlyBtn.style.background = 'white';
                yearlyBtn.style.color = '#64748b';
            } else {
                yearlyBtn.style.background = '#0071e3';
                yearlyBtn.style.color = 'white';
                monthlyBtn.style.background = 'white';
                monthlyBtn.style.color = '#64748b';
            }
            renderAllStats();
        }

        function renderAllStats() {
            const data = customers;
            const periodFilter = document.getElementById('statsPeriodFilter')?.value || 'all';
            const now = new Date();
            const thisYear = now.getFullYear().toString();
            const lastYear = (now.getFullYear() - 1).toString();

            // ê¸°ê°„ í•„í„°ë§ í•¨ìˆ˜
            function filterByPeriod(dateStr) {
                if (!dateStr) return false;
                const date = new Date(dateStr);
                if (periodFilter === '12months') {
                    const twelveMonthsAgo = new Date();
                    twelveMonthsAgo.setMonth(twelveMonthsAgo.getMonth() - 12);
                    return date >= twelveMonthsAgo;
                } else if (periodFilter === 'thisyear') {
                    return dateStr.startsWith(thisYear);
                } else if (periodFilter === 'lastyear') {
                    return dateStr.startsWith(lastYear);
                }
                return true; // all
            }

            // ìš”ì•½ í†µê³„
            const filteredData = data.filter(c => filterByPeriod(c.createdAt || c.contractDate));
            const totalCustomers = filteredData.length;
            const contractedCustomers = filteredData.filter(c => ['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status));
            const totalContracts = contractedCustomers.length;
            const totalRevenue = contractedCustomers.reduce((sum, c) => sum + parseNumber(c.totalAmount), 0);
            const avgContract = totalContracts > 0 ? Math.round(totalRevenue / totalContracts) : 0;

            // ì§€ì¶œ í•©ê³„ (ìš´ì˜ë¹„)
            let totalExpense = 0;
            let expenseCount = 0;
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (filterByPeriod(e.date)) {
                        totalExpense += parseNumber(e.amount);
                        expenseCount++;
                    }
                });
            }

            // ìˆœì´ìµ ë° ì´ìµë¥ 
            const netProfit = totalRevenue - totalExpense;
            const profitRate = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : 0;

            // í•µì‹¬ KPI ì—…ë°ì´íŠ¸
            const kpiRevenueEl = document.getElementById('kpiTotalRevenue');
            const kpiExpenseEl = document.getElementById('kpiTotalExpense');
            const kpiNetProfitEl = document.getElementById('kpiNetProfit');
            const kpiProfitRateEl = document.getElementById('kpiProfitRate');
            const kpiContractCountEl = document.getElementById('kpiContractCount');
            const kpiExpenseItemsEl = document.getElementById('kpiExpenseItems');

            if (kpiRevenueEl) kpiRevenueEl.textContent = 'â‚©' + formatNumber(totalRevenue);
            if (kpiExpenseEl) kpiExpenseEl.textContent = 'â‚©' + formatNumber(totalExpense);
            if (kpiNetProfitEl) kpiNetProfitEl.textContent = 'â‚©' + formatNumber(netProfit);
            if (kpiProfitRateEl) kpiProfitRateEl.textContent = profitRate;
            if (kpiContractCountEl) kpiContractCountEl.textContent = totalContracts;
            if (kpiExpenseItemsEl) kpiExpenseItemsEl.textContent = expenseCount;

            // ë³´ì¡° KPI ì—…ë°ì´íŠ¸
            const kpiCustomersEl = document.getElementById('kpiTotalCustomers');
            const kpiContractsTotalEl = document.getElementById('kpiContractsTotal');
            const kpiAvgEl = document.getElementById('kpiAvgContract');

            if (kpiCustomersEl) kpiCustomersEl.textContent = totalCustomers;
            if (kpiContractsTotalEl) kpiContractsTotalEl.textContent = totalContracts;
            if (kpiAvgEl) kpiAvgEl.textContent = 'â‚©' + formatNumber(avgContract);

            // ê¸°ì¡´ ìš”ì•½ ì—…ë°ì´íŠ¸ (í˜¸í™˜ì„±)
            const oldTotalCustomers = document.getElementById('totalCustomers');
            const oldTotalContracts = document.getElementById('totalContracts');
            const oldTotalRevenue = document.getElementById('totalRevenue');
            const oldAvgContract = document.getElementById('avgContract');
            if (oldTotalCustomers) oldTotalCustomers.textContent = totalCustomers;
            if (oldTotalContracts) oldTotalContracts.textContent = totalContracts;
            if (oldTotalRevenue) oldTotalRevenue.textContent = 'â‚©' + formatNumber(totalRevenue);
            if (oldAvgContract) oldAvgContract.textContent = 'â‚©' + formatNumber(avgContract);

            // ì°¨íŠ¸ ë Œë”ë§
            renderProfitabilityChart(filteredData, periodFilter); // ìƒˆë¡œìš´ í†µí•© ìˆ˜ìµì„± ì°¨íŠ¸
            renderStatusChart(data);
            renderSourceChart(data);
            renderBuildingChart(data);
            renderConversionRate(data);
            renderExpenseBreakdownChart(); // ìš´ì˜ë¹„ ë¶„ì„

            // [ì¶”ê°€] ì‘ì—… ë¡œê·¸ ë Œë”ë§
            renderAuditLog();
        }

        // [ì‹ ê·œ] í†µí•© ìˆ˜ìµì„± ì°¨íŠ¸ (ë§¤ì¶œ ë§‰ëŒ€, ì§€ì¶œ ë§‰ëŒ€, ìˆœì´ìµ ì„ , ì´ìµë¥  ì„ )
        function renderProfitabilityChart(data, periodFilter) {
            const canvas = document.getElementById('profitabilityChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // ì§‘ê³„ ë°ì´í„° êµ¬ì¡°
            const aggregatedData = {};
            const isMonthly = statsAggregationType === 'monthly';

            // 1. ë§¤ì¶œ ì§‘ê³„
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (!date) return;

                const key = isMonthly ? date.substring(0, 7) : date.substring(0, 4); // YYYY-MM or YYYY
                if (!aggregatedData[key]) aggregatedData[key] = { revenue: 0, expense: 0 };

                if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                    aggregatedData[key].revenue += parseNumber(c.totalAmount);
                }
            });

            // 2. ì§€ì¶œ ì§‘ê³„
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const key = isMonthly ? e.date.substring(0, 7) : e.date.substring(0, 4);
                    if (!aggregatedData[key]) aggregatedData[key] = { revenue: 0, expense: 0 };
                    aggregatedData[key].expense += parseNumber(e.amount);
                });
            }

            const sortedKeys = Object.keys(aggregatedData).sort();
            const labels = sortedKeys.map(k => {
                if (isMonthly) {
                    const [y, m] = k.split('-');
                    return `${y.slice(2)}/${m}`;
                }
                return k + 'ë…„';
            });

            const revenueData = sortedKeys.map(k => aggregatedData[k].revenue);
            const expenseData = sortedKeys.map(k => aggregatedData[k].expense);
            const netProfitData = sortedKeys.map(k => aggregatedData[k].revenue - aggregatedData[k].expense);
            const profitRateData = sortedKeys.map(k => {
                const rev = aggregatedData[k].revenue;
                const net = rev - aggregatedData[k].expense;
                return rev > 0 ? ((net / rev) * 100).toFixed(1) : 0;
            });

            if (chartInstances.profitability) chartInstances.profitability.destroy();

            chartInstances.profitability = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.length ? labels : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [
                        {
                            label: 'ë§¤ì¶œ',
                            data: revenueData,
                            backgroundColor: 'rgba(14, 165, 233, 0.8)',
                            borderRadius: 6,
                            yAxisID: 'y',
                            order: 3
                        },
                        {
                            label: 'ì§€ì¶œ',
                            data: expenseData,
                            backgroundColor: 'rgba(244, 63, 94, 0.8)',
                            borderRadius: 6,
                            yAxisID: 'y',
                            order: 4
                        },
                        {
                            label: 'ìˆœì´ìµ',
                            data: netProfitData,
                            type: 'line',
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointBackgroundColor: '#10b981',
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y',
                            order: 1
                        },
                        {
                            label: 'ì´ìµë¥ (%)',
                            data: profitRateData,
                            type: 'line',
                            borderColor: '#8b5cf6',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointBackgroundColor: '#8b5cf6',
                            yAxisID: 'y1',
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    if (context.dataset.label === 'ì´ìµë¥ (%)') {
                                        return context.dataset.label + ': ' + context.parsed.y + '%';
                                    }
                                    return context.dataset.label + ': â‚©' + formatNumber(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'ê¸ˆì•¡ (ì›)' },
                            ticks: {
                                callback: v => {
                                    if (v >= 100000000) return (v / 100000000).toFixed(0) + 'ì–µ';
                                    if (v >= 10000000) return (v / 10000000).toFixed(0) + 'ì²œë§Œ';
                                    if (v >= 1000000) return (v / 1000000).toFixed(0) + 'M';
                                    return v;
                                }
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'ì´ìµë¥  (%)' },
                            max: 100,
                            grid: { display: false },
                            ticks: { callback: v => v + '%' }
                        }
                    }
                }
            });
        }

        // ìš´ì˜ë¹„ ë¶„ì„ ì°¨íŠ¸ (ë„ë„›)
        function renderExpenseBreakdownChart() {
            const canvas = document.getElementById('expenseBreakdownChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const categoryTotals = {};
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    const cat = e.category || 'ê¸°íƒ€';
                    categoryTotals[cat] = (categoryTotals[cat] || 0) + parseNumber(e.amount);
                });
            }

            const labels = Object.keys(categoryTotals);
            const values = Object.values(categoryTotals);
            const colors = ['#0ea5e9', '#f43f5e', '#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#ec4899', '#84cc16'];

            if (chartInstances.expenseBreakdown) chartInstances.expenseBreakdown.destroy();

            chartInstances.expenseBreakdown = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.length ? labels : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [{
                        data: values.length ? values : [1],
                        backgroundColor: colors.slice(0, labels.length || 1),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': â‚©' + formatNumber(context.parsed) + ' (' + pct + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderMonthlyChart(data) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            const yearFilter = document.getElementById('statsYearFilter');
            const selectedYear = yearFilter ? yearFilter.value : 'all';

            // ì›”ë³„ ë§¤ì¶œ/ìš´ì˜ë¹„ ì§‘ê³„
            const monthlyData = {};

            // 1. ë§¤ì¶œ ì§‘ê³„
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (date) {
                    const year = date.substring(0, 4);
                    if (selectedYear !== 'all' && year !== selectedYear) return;

                    const month = date.substring(0, 7); // YYYY-MM
                    if (!monthlyData[month]) monthlyData[month] = { count: 0, revenue: 0, expense: 0 };

                    monthlyData[month].count++;
                    if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                        const amount = parseNumber(c.totalAmount);
                        monthlyData[month].revenue += Math.round(amount / 1.1); // VAT ë³„ë„
                    }
                }
            });

            // 2. ìš´ì˜ë¹„ ì§‘ê³„ (ì „ì—­ expensesRows ì‚¬ìš©)
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const year = e.date.substring(0, 4);
                    if (selectedYear !== 'all' && year !== selectedYear) return;

                    const month = e.date.substring(0, 7);
                    if (!monthlyData[month]) monthlyData[month] = { count: 0, revenue: 0, expense: 0 };

                    monthlyData[month].expense += parseNumber(e.amount);
                });
            }

            const sortedMonths = Object.keys(monthlyData).sort();
            const labels = sortedMonths.map(m => {
                const [y, mo] = m.split('-');
                return `${y.slice(2)}ë…„ ${parseInt(mo)}ì›”`;
            });

            if (chartInstances.monthly) chartInstances.monthly.destroy();

            chartInstances.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.length ? labels : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [
                        {
                            label: 'ìš´ì˜ë¹„ (ì§€ì¶œ)',
                            data: sortedMonths.map(m => monthlyData[m].expense),
                            type: 'bar',
                            backgroundColor: '#ff3b30', // Red
                            borderRadius: 4,
                            yAxisID: 'y1',
                            stack: 'money'
                        },
                        {
                            label: 'ê³µê¸‰ê°€ì•¡ (ë§¤ì¶œ, VATë³„ë„)',
                            data: sortedMonths.map(m => monthlyData[m].revenue),
                            type: 'bar', // ë§¤ì¶œë„ ë§‰ëŒ€ë¡œ ë¹„êµ (Stack or Group)
                            backgroundColor: '#34c759', // Green
                            borderRadius: 4,
                            yAxisID: 'y1',
                            stack: 'money2' // ê²¹ì¹˜ì§€ ì•Šê²Œ ë³„ë„ ìŠ¤íƒ í˜¹ì€ ê°™ê²Œ
                        },
                        {
                            label: 'ê³ ê° ë“±ë¡ ìˆ˜',
                            data: sortedMonths.map(m => monthlyData[m].count),
                            type: 'line',
                            borderColor: '#0071e3', // Blue
                            borderWidth: 2,
                            pointBackgroundColor: '#0071e3',
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'ê±´ìˆ˜' },
                            grid: { display: false }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'ê¸ˆì•¡' },
                            ticks: { callback: v => 'â‚©' + (v / 1000000).toFixed(0) + 'M' }
                        }
                    }
                }
            });
        }

        // [ì‹ ê·œ] ì—°ë„ë³„ ì°¨íŠ¸ (VAT ë³„ë„)
        function renderYearlyChart(data) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');

            const yearlyData = {};
            // 1. ë§¤ì¶œ
            data.forEach(c => {
                const date = c.createdAt || c.contractDate;
                if (date) {
                    const year = date.substring(0, 4);
                    if (!yearlyData[year]) yearlyData[year] = { count: 0, revenue: 0, expense: 0 };

                    yearlyData[year].count++;
                    if (['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)) {
                        const amount = parseNumber(c.totalAmount);
                        yearlyData[year].revenue += Math.round(amount / 1.1);
                    }
                }
            });

            // 2. ìš´ì˜ë¹„
            if (typeof expensesRows !== 'undefined') {
                expensesRows.forEach(e => {
                    if (!e.date) return;
                    const year = e.date.substring(0, 4);
                    if (!yearlyData[year]) yearlyData[year] = { count: 0, revenue: 0, expense: 0 };

                    yearlyData[year].expense += parseNumber(e.amount);
                });
            }

            const sortedYears = Object.keys(yearlyData).sort();

            if (chartInstances.yearly) chartInstances.yearly.destroy();

            chartInstances.yearly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedYears.length ? sortedYears : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [
                        {
                            label: 'ì´ ìš´ì˜ë¹„ (ì§€ì¶œ)',
                            data: sortedYears.map(y => yearlyData[y].expense),
                            backgroundColor: '#ff3b30',
                            borderRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'ì´ ê³µê¸‰ê°€ì•¡ (ë§¤ì¶œ)',
                            data: sortedYears.map(y => yearlyData[y].revenue),
                            backgroundColor: '#34c759',
                            borderRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'ì´ ê³„ì•½ ê±´ìˆ˜',
                            data: sortedYears.map(y => yearlyData[y].count),
                            type: 'line',
                            borderColor: '#0071e3',
                            borderWidth: 2,
                            pointBackgroundColor: '#0071e3',
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.dataset.yAxisID === 'y1') {
                                        label += 'â‚©' + context.raw.toLocaleString();
                                        label += context.raw + 'ê±´';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'ê±´ìˆ˜' },
                            grid: { display: false }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'ê¸ˆì•¡' },
                            ticks: { callback: v => 'â‚©' + (v / 1000000).toFixed(0) + 'M' }
                        }
                    }
                }
            });
        }

        function renderStatusChart(data) {
            const ctx = document.getElementById('statusChart').getContext('2d');

            const statusCount = {};
            data.forEach(c => {
                const status = c.status || 'consulting';
                statusCount[status] = (statusCount[status] || 0) + 1;
            });

            const statusColors = {
                consulting: '#ff9500',
                hold: '#8e8e93',
                budget_over: '#ff3b30',
                other_company: '#5856d6',
                contracted: '#34c759',
                in_progress: '#ff9500',
                completed: '#30d158',
                as_done: '#00c7be'
            };

            if (chartInstances.status) chartInstances.status.destroy();

            chartInstances.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCount).map(s => statusLabels[s] || s),
                    datasets: [{
                        data: Object.values(statusCount),
                        backgroundColor: Object.keys(statusCount).map(s => statusColors[s] || '#86868b'),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { font: { size: 10 }, padding: 8 } }
                    }
                }
            });
        }

        function renderSourceChart(data) {
            const ctx = document.getElementById('sourceChart').getContext('2d');

            const sourceCount = {};
            data.forEach(c => {
                const source = c.clientSource || 'ë¯¸ì§€ì •';
                sourceCount[source] = (sourceCount[source] || 0) + 1;
            });

            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#fa709a'];

            if (chartInstances.source) chartInstances.source.destroy();

            chartInstances.source = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(sourceCount),
                    datasets: [{
                        data: Object.values(sourceCount),
                        backgroundColor: colors.slice(0, Object.keys(sourceCount).length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { font: { size: 10 }, padding: 8 } }
                    }
                }
            });
        }

        function renderBuildingChart(data) {
            const ctx = document.getElementById('buildingChart').getContext('2d');

            const buildingCount = {};
            data.forEach(c => {
                const building = c.buildingType || 'ë¯¸ì§€ì •';
                buildingCount[building] = (buildingCount[building] || 0) + 1;
            });

            if (chartInstances.building) chartInstances.building.destroy();

            chartInstances.building = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(buildingCount),
                    datasets: [{
                        label: 'ê±´ìˆ˜',
                        data: Object.values(buildingCount),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(240, 147, 251, 0.8)',
                            'rgba(245, 87, 108, 0.8)',
                            'rgba(79, 172, 254, 0.8)'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function renderConversionRate(data) {
            const contracted = data.filter(c => ['contracted', 'in_progress', 'completed', 'as_done'].includes(c.status)).length;
            const notContracted = data.filter(c => ['budget_over', 'other_company'].includes(c.status)).length;
            const consulting = data.filter(c => ['consulting', 'hold'].includes(c.status)).length;

            const total = contracted + notContracted;
            const rate = total > 0 ? Math.round((contracted / total) * 100) : 0;

            document.getElementById('conversionRate').textContent = rate + '%';
            document.getElementById('contractedCount').textContent = contracted;
            document.getElementById('notContractedCount').textContent = notContracted;
            document.getElementById('consultingCount').textContent = consulting;

            // ì›í˜• ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
            const circle = document.getElementById('conversionCircle');
            circle.style.background = `conic-gradient(#34c759 0%, #34c759${rate}%, #e8e8ed${rate}%, #e8e8ed 100%)`;
        }

        // =====================
        // ìƒ˜í”Œ ê²¬ì ì„œ ê¸°ëŠ¥
        // =====================

        // ìƒ˜í”Œ ê²¬ì ì„œ ëª¨ë‹¬ ì—´ê¸°
        function openSampleEstimateModal() {
            document.getElementById('sampleEstimateModal').style.display = 'flex';
            document.getElementById('sampleEstimateTitle').value = '';
            loadSampleEstimateList();
        }

        // ìƒ˜í”Œ ê²¬ì ì„œ ëª¨ë‹¬ ë‹«ê¸°
        function closeSampleEstimateModal() {
            document.getElementById('sampleEstimateModal').style.display = 'none';
        }

        // ìƒ˜í”Œ ê²¬ì ì„œ ëª©ë¡ ë¡œë“œ
        async function loadSampleEstimateList() {
            const listContainer = document.getElementById('sampleEstimateList');
            listContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ë¡œë”© ì¤‘...</div>';

            try {
                const response = await fetch(`${GOOGLE_SHEET_URL}?action=getSampleEstimates`);
                const result = await response.json();

                if (result.success && result.samples && result.samples.length > 0) {
                    listContainer.innerHTML = result.samples.map(sample => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border: 1px solid #e5e5e5; border-radius: 8px; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${sample.title}</div>
                                <div style="font-size: 11px; color: #999;">ğŸ“… ${sample.createdAt} | ğŸ‘¤ ${sample.createdBy || '-'}</div>
                            </div>
                            <div style="display: flex; gap: 6px;">
                                <button onclick="loadSampleEstimate('${sample.id}')" 
                                    style="background: #007aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                                <button onclick="deleteSampleEstimate('${sample.id}', '${sample.title}')" 
                                    style="background: #ff3b30; color: white; border: none; padding: 6px 10px; border-radius: 6px; font-size: 12px; cursor: pointer;">âœ•</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    listContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ì €ì¥ëœ ìƒ˜í”Œì´ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            } catch (error) {
                console.error('ìƒ˜í”Œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                listContainer.innerHTML = '<div style="text-align: center; color: #ff3b30; padding: 20px;">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</div>';
            }
        }

        // í˜„ì¬ ê²¬ì ì„ ìƒ˜í”Œë¡œ ì €ì¥
        async function saveSampleEstimate() {
            const title = document.getElementById('sampleEstimateTitle').value.trim();
            if (!title) {
                showToast('ìƒ˜í”Œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            // í˜„ì¬ ê²¬ì  ë°ì´í„° ìˆ˜ì§‘
            saveEstimateData(); // ë¨¼ì € í˜„ì¬ ë°ì´í„° ì €ì¥

            const sampleData = {
                action: 'saveSampleEstimate',
                title: title,
                estimateData: currentData.estimateData || {},
                estimateProfitRate: currentData.estimateProfitRate || 15,
                estimateMemos: {},
                createdBy: currentAdmin?.id || 'unknown',
                createdAt: new Date().toISOString()
            };

            // ë©”ëª¨ ë°ì´í„° ìˆ˜ì§‘
            categories.forEach(cat => {
                if (currentData[`estMemo_${cat.no}`]) {
                    sampleData.estimateMemos[cat.no] = currentData[`estMemo_${cat.no}`];
                }
            });

            try {
                showToast('ì €ì¥ ì¤‘...', 'info');
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(sampleData)
                });
                const result = await response.json();

                if (result.success) {
                    showToast(`ìƒ˜í”Œ "${title}" ì €ì¥ ì™„ë£Œ!`, 'success');
                    document.getElementById('sampleEstimateTitle').value = '';
                    loadSampleEstimateList();
                } else {
                    showToast('ì €ì¥ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('ìƒ˜í”Œ ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ìƒ˜í”Œ ê²¬ì  ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSampleEstimate(sampleId) {
            if (!confirm('í˜„ì¬ ê²¬ì  ë°ì´í„°ë¥¼ ìƒ˜í”Œë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                showToast('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
                const response = await fetch(`${GOOGLE_SHEET_URL}?action=getSampleEstimate&id=${sampleId}`);
                const result = await response.json();

                if (result.success && result.sample) {
                    const sample = result.sample;

                    // ê²¬ì  ë°ì´í„° ì ìš©
                    currentData.estimateData = sample.estimateData || {};
                    currentData.estimateProfitRate = sample.estimateProfitRate || 15;

                    // ë©”ëª¨ ì ìš©
                    if (sample.estimateMemos) {
                        Object.keys(sample.estimateMemos).forEach(catNo => {
                            currentData[`estMemo_${catNo}`] = sample.estimateMemos[catNo];
                        });
                    }

                    // UI ìƒˆë¡œê³ ì¹¨
                    loadEstimateData();

                    closeSampleEstimateModal();
                    showToast(`ìƒ˜í”Œ "${sample.title}" ì ìš© ì™„ë£Œ!`, 'success');
                } else {
                    showToast('ìƒ˜í”Œì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ìƒ˜í”Œ ì‚­ì œ
        async function deleteSampleEstimate(sampleId, sampleTitle) {
            if (!confirm(`"${sampleTitle}" ìƒ˜í”Œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            try {
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'deleteSampleEstimate',
                        id: sampleId
                    })
                });
                const result = await response.json();

                if (result.success) {
                    showToast('ìƒ˜í”Œì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    loadSampleEstimateList();
                } else {
                    showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                console.error('ìƒ˜í”Œ ì‚­ì œ ì‹¤íŒ¨:', error);
                showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        function importMasterSchedule() {
            if (scheduleRows.length > 0) {
                if (!confirm('í˜„ì¬ ì‘ì„±ëœ ìŠ¤ì¼€ì¤„ì´ ëª¨ë‘ ì‚­ì œë˜ê³ , ë§ˆìŠ¤í„° ìŠ¤ì¼€ì¤„ í…œí”Œë¦¿ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }

            if (!defaultScheduleSteps || defaultScheduleSteps.length === 0) {
                alert('ë§ˆìŠ¤í„° ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                fetchScheduleTemplate(); // Try fetching again
                return;
            }

            // Copy template
            scheduleRows = defaultScheduleSteps.map(step => ({
                id: Date.now() + Math.random(),
                category: step.category || '',
                name: step.name || '',
                checkPoint: step.checkPoint || '',
                start: '', // Date is usually empty in template
                end: '',
                inCharge: step.inCharge || currentData.manager || 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)',
                memo: step.memo || ''
            }));

            renderScheduleTable();
            saveScheduleToCustomer();
            alert('ë§ˆìŠ¤í„° ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
        }

        async function syncScheduleToNotion() {
            if (!currentData.clientName) {
                alert('ê³ ê°ëª…ì´ ì—†ìŠµë‹ˆë‹¤. ê³ ê°ì„ ë¨¼ì € ì„ íƒí•˜ê±°ë‚˜ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (confirm(`'${currentData.clientName}' ê³ ê°ì˜ ìŠ¤ì¼€ì¤„ì„ Notionìœ¼ë¡œ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    const btn = document.querySelector('button[onclick="syncScheduleToNotion()"]');
                    if (btn) {
                        btn.innerHTML = 'â³ ì „ì†¡ ì¤‘...';
                        btn.disabled = true;
                    }

                    const payload = {
                        action: 'exportToNotion',
                        type: 'schedule',
                        customerId: currentData.customerId,
                        data: JSON.stringify({
                            project: currentData.clientName,
                            schedules: scheduleRows // scheduleRows ì „ì—­ ë³€ìˆ˜
                        })
                    };

                    const response = await fetch(CUSTOMER_SYNC_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(`âœ… Notion ë™ê¸°í™” ì„±ê³µ!`);
                        if (result.notionUrl) {
                            // console.log(result.notionUrl);
                        }
                    } else {
                        throw new Error(result.message || 'ë™ê¸°í™” ì‹¤íŒ¨');
                    }
                } catch (error) {
                    console.error('Notion Sync Error:', error);
                    alert(`ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì‘ë‹µ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message})`);
                } finally {
                    const btn = document.querySelector('button[onclick="syncScheduleToNotion()"]');
                    if (btn) {
                        btn.innerHTML = 'ğŸ“¥ Notion ë™ê¸°í™”';
                        btn.disabled = false;
                    }
                }
            }
        }

        // Initialize Master Data
        fetchScheduleTemplate();
    </script>
    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ (ìµœìš°ì„  í‘œì‹œ) - PIN ê¸°ë°˜ ê¸°ê¸° ì‹ ë¢° ì •ì±… -->
    <div class="login-overlay" id="loginOverlay">
        <!-- ID/PW ë¡œê·¸ì¸ (ìµœì´ˆ ë˜ëŠ” ê¸°ê¸° ì‹ ë¢° ë§Œë£Œ ì‹œ) -->
        <div class="login-card" id="loginCardIdPw">
            <div class="login-logo">DESIGN JIG</div>
            <div class="login-subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <input type="text" class="login-input" id="loginId" placeholder="ì•„ì´ë””" autocomplete="username"
                onkeypress="if(event.key==='Enter') document.getElementById('loginPw').focus()">
            <input type="password" class="login-input" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password"
                onkeypress="if(event.key==='Enter') performLogin()">
            <button class="login-btn-primary" onclick="performLogin()">ë¡œê·¸ì¸</button>
        </div>

        <!-- PIN ë¡œê·¸ì¸ (ê¸°ê¸° ì‹ ë¢° ì‹œ) -->
        <div class="login-card" id="loginCardPin" style="display:none;">
            <div class="login-logo">DESIGN JIG</div>
            <div class="login-subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div style="margin-bottom:16px; color:#666; font-size:13px;">
                <span id="trustedUserName" style="color:#B4956F; font-weight:600;"></span>ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤
            </div>
            <input type="password" class="login-input" id="loginPin" placeholder="PIN 4ìë¦¬" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') performPinLogin()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <button class="login-btn-primary" onclick="performPinLogin()">PIN ë¡œê·¸ì¸</button>
            <button onclick="clearDeviceTrust()"
                style="margin-top:12px; background:transparent; border:none; color:#86868b; font-size:12px; cursor:pointer; text-decoration:underline;">
                ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
            </button>
        </div>

        <!-- PIN ì„¤ì • (ìµœì´ˆ ë¡œê·¸ì¸ ì„±ê³µ í›„) -->
        <div class="login-card" id="loginCardPinSetup" style="display:none;">
            <div class="login-logo">ğŸ”</div>
            <div class="login-subtitle" style="margin-bottom:8px;">PIN ì„¤ì •</div>
            <div style="margin-bottom:16px; color:#666; font-size:13px; line-height:1.5;">
                ì´ ê¸°ê¸°ë¥¼ ì‹ ë¢°í•˜ë©´ ë‹¤ìŒë¶€í„°<br>
                <strong>4ìë¦¬ PIN</strong>ìœ¼ë¡œ ë¹ ë¥´ê²Œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <span style="font-size:11px; color:#999;">(30ì¼ê°„ ìœ íš¨)</span>
            </div>
            <input type="password" class="login-input" id="newPin" placeholder="ìƒˆ PIN 4ìë¦¬" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') document.getElementById('confirmPin').focus()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <input type="password" class="login-input" id="confirmPin" placeholder="PIN í™•ì¸" maxlength="4"
                inputmode="numeric" pattern="[0-9]*" autocomplete="off"
                onkeypress="if(event.key==='Enter') setupDevicePin()"
                oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            <button class="login-btn-primary" onclick="setupDevicePin()">PIN ì„¤ì • ì™„ë£Œ</button>
            <button onclick="skipPinSetup()"
                style="margin-top:12px; background:transparent; border:none; color:#86868b; font-size:12px; cursor:pointer; text-decoration:underline;">
                ê±´ë„ˆë›°ê¸° (ë§¤ë²ˆ ID/PW ì…ë ¥)
            </button>
        </div>

        <div style="margin-top: 20px; font-size: 11px; color: #a1a1a6;">
            Unauthorized access is strictly prohibited.
        </div>
    </div>

    <!-- ìƒ˜í”Œ ê²¬ì ì„œ ëª¨ë‹¬ -->
    <div id="sampleEstimateModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; align-items: center; justify-content: center;">
        <div class="modal-backdrop" onclick="closeSampleEstimateModal()"
            style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5);"></div>
        <div class="modal-content"
            style="max-width: 500px; width: 90%; position: relative; z-index: 10001; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #ff9500, #ff6600); color: white; padding: 20px; border-radius: 16px 16px 0 0;">
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">ğŸ“‹ ìƒ˜í”Œ ê²¬ì ì„œ</h3>
                <button onclick="closeSampleEstimateModal()"
                    style="background: transparent; border: none; color: white; font-size: 20px; cursor: pointer;">âœ•</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- í˜„ì¬ ê²¬ì  ì €ì¥ -->
                <div style="margin-bottom: 24px; padding: 16px; background: #f5f5f7; border-radius: 12px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #333;">ğŸ’¾ í˜„ì¬ ê²¬ì ì„ ìƒ˜í”Œë¡œ ì €ì¥</h4>
                    <input type="text" id="sampleEstimateTitle" placeholder="ìƒ˜í”Œ ì œëª© ì…ë ¥ (ì˜ˆ: ê¸°ë³¸ ìš•ì‹¤ ê³µì‚¬)"
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; margin-bottom: 12px; box-sizing: border-box;">
                    <button onclick="saveSampleEstimate()"
                        style="width: 100%; padding: 12px; background: #ff9500; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px;">
                        ìƒ˜í”Œë¡œ ì €ì¥
                    </button>
                </div>

                <!-- ì €ì¥ëœ ìƒ˜í”Œ ëª©ë¡ -->
                <div>
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #333;">ğŸ“‚ ì €ì¥ëœ ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</h4>
                    <div id="sampleEstimateList" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            ë¡œë”© ì¤‘...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // ê³µì •ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥
        // ============================
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” CUSTOMER_SYNC_URL ì‚¬ìš©
        // [Fix] ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—°ë™ (ì´ˆê¸°í™” ë°©ì§€)
        let checklistMasterData = [];
        // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë§ˆìŠ¤í„° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (Google Sheet)
        async function syncChecklistFromCloud() {
            // Phase 2: ì´ˆê¸° ë™ê¸°í™” ê²Œì´íŠ¸ë¥¼ ìœ„í•´ ë¡œê·¸ì¸ ì²´í¬ ìƒëµ (GET ì „ìš©)
            // if (!isLoggedIn()) { ... }

            const btn = document.querySelector('button[onclick="syncChecklistFromCloud()"]');
            const originalHTML = btn ? btn.innerHTML : 'ğŸ”„ DB ë¶ˆëŸ¬ì˜¤ê¸°';

            if (btn) {
                btn.innerHTML = '<span class="loading-spinner"></span> ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                btn.disabled = true;
            }

            console.log('[Checklist Load] Request started...');

            try {
                // [Fix] ì‹œíŠ¸ ì´ë¦„ì„ 'checklist'ë¡œ ë³€ê²½ (ì„œë²„ í˜¸í™˜ì„± ëª…í™•í™”) ë° ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
                const params = new URLSearchParams({ sheet: 'checklist' });
                const response = await fetch(`${CUSTOMER_SYNC_URL}?${params}`);
                const result = await response.json();

                console.log('[Checklist Load] Response:', result);

                if (result.success === true || result.result === 'success' || Array.isArray(result) || (result.data && Array.isArray(result.data))) {
                    let items = [];
                    if (Array.isArray(result)) items = result;
                    else if (result.data) items = result.data;
                    else if (result.items) items = result.items;

                    // [Fix] Empty checklist is a valid state, not an error
                    if (!items || items.length === 0) {
                        console.warn('âš ï¸ [Checklist Load] ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. (0ê±´)');
                        checklistMasterData = [];

                        // ë¹ˆ ë°ì´í„°ë¼ë„ ë Œë”ë§ ê°±ì‹  í•„ìš”
                        renderChecklistItems();
                        return true;
                    }

                    // [Fix] ë°ì´í„° ê³µë°± ì œê±° (í•„í„°ë§ ì •í™•ë„ í–¥ìƒ)
                    checklistMasterData = items.map(item => ({
                        ...item,
                        'ì§„í–‰ë‹¨ê³„': String(item['ì§„í–‰ë‹¨ê³„'] || '').trim(),
                        'category': String(item['category'] || item['ì¹´í…Œê³ ë¦¬'] || item['ë¶„ë¥˜'] || '').trim()
                    }));

                    // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€

                    console.log(`âœ… [Checklist Load] Loaded ${items.length} items.`);
                    console.log(`ğŸ“Š [Web Debug] checklistMasterData length:`, checklistMasterData.length);
                    console.log(`ğŸ“Š [Web Debug] First 3 items:`, checklistMasterData.slice(0, 3).map(i => i['í•­ëª©ëª…'] || i.ë²ˆí˜¸));

                    // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
                    updateChecklistFilters();

                    // í…Œì´ë¸” ë Œë”ë§
                    renderChecklistItems();

                    showToast(`ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ (${items.length}ê±´)`, 'success');
                    return true;
                } else {
                    throw new Error(result.message || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('âŒ [Checklist Load Error]', error);

                // [Fix] ì‹œíŠ¸ê°€ ì—†ê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°, ì—ëŸ¬ ëŒ€ì‹  ë¹ˆ ìƒíƒœë¡œ ì´ˆê¸°í™”í•˜ì—¬ ì•± ì¤‘ë‹¨ ë°©ì§€
                if (error.message && (error.message.includes('ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || error.message.includes('Sheet not found'))) {
                    console.warn('âš ï¸ [Safeguard] ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‹œíŠ¸ ë¯¸ë°œê²¬ -> ë¹ˆ ëª©ë¡ìœ¼ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
                    checklistMasterData = [];
                    renderChecklistItems();
                    showToast('ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ì‹œíŠ¸ ë¯¸ë°œê²¬)', 'info');
                    return true; // ì„±ê³µìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì´ˆê¸° ë¡œë”© íë¦„ ìœ ì§€
                }

                showToast('ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'error');
                return false;
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        }


        // [ì¶”ê°€] ì €ì¥ëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•„í„° ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedChecklistState(silent = false) {
            if (!currentData || !currentData.checklistFilters) {
                if (!silent) showToast('ì €ì¥ëœ í•„í„° ìƒíƒœê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            const savedFilters = currentData.checklistFilters;

            // ì €ì¥ëœ í•„í„° ì ìš©
            Object.keys(savedFilters).forEach(key => {
                const values = savedFilters[key];
                multiSelectState[key] = values;

                // UI ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë™ê¸°í™”
                const dropdown = document.getElementById(key + 'Dropdown');
                if (dropdown) {
                    // ì „ì²´ ì²´í¬ë°•ìŠ¤
                    const allCb = dropdown.querySelector('input[value="all"]');
                    if (allCb) allCb.checked = values.includes('all');

                    // ê°œë³„ ì²´í¬ë°•ìŠ¤
                    dropdown.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                        if (cb.value !== 'all') {
                            cb.checked = values.includes(cb.value);
                        }
                    });

                    updateMultiSelectLabel(key);
                }
            });

            // í•„í„° ì¢…ì†ì„± ì—…ë°ì´íŠ¸ (ì§„í–‰ë‹¨ê³„ -> ì¹´í…Œê³ ë¦¬)
            if (typeof updateCategoryOptionsBasedOnStage === 'function') {
                updateCategoryOptionsBasedOnStage();
            }

            renderChecklistItems();
            if (!silent) showToast('ì´ì „ í•„í„° ìƒíƒœë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
        }

        // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸ (ë©€í‹° ì…€ë ‰íŠ¸ ì´ˆê¸°í™”)
        function updateChecklistFilters() {
            // [Fix] ë°ì´í„°ê°€ ì—†ì–´ë„ í•„í„° ì´ˆê¸°í™” (ë¹ˆ ìƒíƒœë¼ë„ 'ì „ì²´' ì˜µì…˜ í‘œì‹œ)
            const data = checklistMasterData || [];

            // ì§„í–‰ë‹¨ê³„ ì˜µì…˜
            const stages = [...new Set(data.map(item => item.ì§„í–‰ë‹¨ê³„).filter(Boolean))].sort();
            initMultiSelect('checklistStageFilter', stages);

            // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ (ë²ˆí˜¸ìˆœ ì •ë ¬)
            const categories = [...new Set(data.map(item => item.category).filter(Boolean))].sort((a, b) => {
                // ê° ì¹´í…Œê³ ë¦¬ì˜ ëŒ€í‘œ ì•„ì´í…œ(ê°€ì¥ ì‘ì€ ë²ˆí˜¸) ì°¾ê¸°
                const itemA = data.find(i => i.category === a);
                const itemB = data.find(i => i.category === b);
                return (itemA ? parseInt(itemA.ë²ˆí˜¸) : 9999) - (itemB ? parseInt(itemB.ë²ˆí˜¸) : 9999);
            });
            initMultiSelect('checklistCategoryFilter', categories);
        }

        // [ì¶”ê°€] ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆœì„œ ì €ì¥
        async function saveChecklistOrder() {
            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('ì €ì¥í•  ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            if (!confirm('í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ìˆœì„œëŒ€ë¡œ ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ë§¤ê²¨ì„œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê¸°ì¡´ ì‹œíŠ¸ì˜ ë°ì´í„° ìˆœì„œê°€ ë³€ê²½ë©ë‹ˆë‹¤)')) {
                return;
            }

            const btn = document.querySelector('button[onclick="saveChecklistOrder()"]');
            const originalHTML = btn ? btn.innerHTML : 'ğŸ’¾ ìˆœì„œ ì €ì¥';

            try {
                if (btn) {
                    btn.innerHTML = '<span class="loading-spinner"></span> ì €ì¥ ì¤‘...';
                    btn.disabled = true;
                }

                // 1. ìˆœì„œ ì¬ì •ë ¬ ë° ë²ˆí˜¸ ê°±ì‹  (ì´ë¯¸ drag drop ì‹œ í–ˆì§€ë§Œ ì•ˆì „ì„ ìœ„í•´ ë‹¤ì‹œ í™•ì¸)
                // í˜„ì¬ checklistMasterDataëŠ” ì´ë¯¸ í™”ë©´ ìˆœì„œëŒ€ë¡œ ì •ë ¬ë˜ì–´ ìˆìŒ
                const sortedData = checklistMasterData.map((item, index) => ({
                    ...item,
                    'ë²ˆí˜¸': index + 1
                }));

                // 2. ì„œë²„ ì „ì†¡
                const payload = {
                    action: 'updateChecklistMaster',
                    data: sortedData
                };

                // sendPostRequest ëŒ€ì‹  ì§ì ‘ fetch ì‚¬ìš© (handleChecklistMasterUpdate ë¼ìš°íŒ… í™•ì¸ë¨)
                // í•˜ì§€ë§Œ ê¸°ì¡´ í•¨ìˆ˜ ì¬ì‚¬ìš© ê¶Œì¥ -> doPostê°€ actionì„ ì²˜ë¦¬í•˜ë¯€ë¡œ fetch ì‚¬ìš©
                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Apps Script POST often requires no-cors or redirect handling, but we usually use a proxy or specific setup. 
                    // Wait, standard fetch to Apps Script Web App works if we handle redirects or return JSON.
                    // Existing syncChecklistFromCloud uses GET. 
                    // Let's copy the pattern from other save functions in this file.
                    // Actually, looking at other save functions would be safer.
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: JSON.stringify(payload)
                });

                // Apps Script 'no-cors' issue means we can't read response directly if it redirects.
                // However, updated_apps_script.js returns JSON.
                // Let's trust the deployment.
                if (response.ok || response.type === 'opaque') {
                    // 3. ë¡œì»¬ ë°ì´í„° ê°±ì‹ 
                    checklistMasterData = sortedData;
                    renderChecklistItems();
                    showToast('ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆœì„œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    throw new Error('Server response not ok');
                }

                // * Fetch with Apps Script POST can be tricky with CORS. 
                // Let's use the text output directly if possible or the typical 'fetch' pattern used in this project.
                // Re-reading 'syncChecklistFromCloud' -> it uses GET.
                // Re-reading 'saveCustomers' -> it likely uses POST.

            } catch (error) {
                console.error('Save Order Error:', error);

                // Fallback: If fetch failed, it might still have succeeded on server if no-cors.
                // But to be sure, we can also try 'saveChecklistMaster' action if we added it? Yes we did.

                showToast('ìˆœì„œ ì €ì¥ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í™•ì¸í•´ë³´ì„¸ìš”)', 'info');
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        }

        // [ì¶”ê°€] ì§„í–‰ë‹¨ê³„ ì„ íƒì— ë”°ë¥¸ ì¹´í…Œê³ ë¦¬ í•„í„° ì˜µì…˜ ê°±ì‹ 
        function updateCategoryOptionsBasedOnStage() {
            const selectedStages = multiSelectState['checklistStageFilter'];
            console.log('[Filter Logic] Selected Stages:', selectedStages);

            // [Fix] ë°ì´í„°ê°€ ì—†ì–´ë„ ì§„í–‰ (ë¹ˆ ìƒíƒœë¼ë„ í•„í„° ë¦¬ì…‹ì„ ìœ„í•´)
            const data = checklistMasterData || [];

            if (data.length === 0) {
                console.warn('[Filter Logic] No master data available for filtering (Proceeding with empty)');
            }

            let validCategories = [];

            if (selectedStages.includes('all') || selectedStages.length === 0) {
                // ì „ì²´ ì„ íƒ ì‹œ -> ëª¨ë“  ì¹´í…Œê³ ë¦¬ í‘œì‹œ
                validCategories = [...new Set(data.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            } else {
                // íŠ¹ì • ë‹¨ê³„ ì„ íƒ ì‹œ -> í•´ë‹¹ ë‹¨ê³„ì— í¬í•¨ëœ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ì¶œ
                const filteredItems = data.filter(item => {
                    const itemStage = (item.ì§„í–‰ë‹¨ê³„ || '').trim();
                    // selectedStages could have untrimmed values if init was untrimmed, but typically they match.
                    // To be safe, we rely on exact values from options. 
                    // But here we just used item.ì§„í–‰ë‹¨ê³„ to build options, so it should match.
                    return selectedStages.some(stage => stage === item.ì§„í–‰ë‹¨ê³„ || stage === itemStage);
                });
                validCategories = [...new Set(filteredItems.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            }

            console.log('[Filter Logic] Valid Categories:', validCategories);

            // ê¸°ì¡´ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì¤‘ ìœ íš¨í•˜ì§€ ì•Šì€ ê²ƒì€ ì œê±° (UX ê°œì„ )
            const currentCategoryState = multiSelectState['checklistCategoryFilter'];

            if (!currentCategoryState.includes('all')) {
                const newCategoryState = currentCategoryState.filter(cat => validCategories.includes(cat));
                // í•˜ë‚˜ë„ ì—†ìœ¼ë©´ 'all'ë¡œ ë¦¬ì…‹
                multiSelectState['checklistCategoryFilter'] = newCategoryState.length > 0 ? newCategoryState : ['all'];
            } else {
                // If it was 'all', keep it 'all' unless validCategories is empty? 
                // 'all' is always valid if validCategories has items.
            }

            // ì¹´í…Œê³ ë¦¬ í•„í„° ì˜µì…˜ ì¬ìƒì„±
            initMultiSelect('checklistCategoryFilter', validCategories);
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ë Œë”ë§

        // [New] ì¼ì •í‘œ ê¸°ë°˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—°ë™
        function syncChecklistFromSchedule() {
            if (!currentCustomerId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            // checklistMasterData í™•ì¸
            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ê°€ ì—†ì–´ì„œ ì—°ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ì¼ì •í‘œ ë°ì´í„° í™•ì¸
            if (!scheduleRows || scheduleRows.length === 0) {
                if (!confirm('ì¼ì •í‘œ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            } else {
                if (!confirm('ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì¼ì •í‘œ ê¸°ì¤€ìœ¼ë¡œ ì¬ì„¤ì •í•©ë‹ˆë‹¤. ì¼ì •í‘œì— ì—†ëŠ” í•­ëª©ì€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            }

            // í˜„ì¬ ê³ ê° ë°ì´í„° í™•ë³´
            const currentChecklistData = currentData.checklistData || {};
            const newChecklistData = {};

            // 1. ì¼ì •í‘œì—ì„œ ìœ íš¨í•œ ê³µì •/ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ì¶”ì¶œ
            const activeKeywords = new Set();
            scheduleRows.forEach(row => {
                if (row.name && row.name.trim()) activeKeywords.add(row.name.trim());
                if (row.category && row.category.trim()) activeKeywords.add(row.category.trim());
            });

            console.log('ğŸ“… [Sync] Schedule Keywords:', [...activeKeywords]);

            let keptCount = 0;
            let addedCount = 0;
            let removedCount = 0;

            // 2. ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ë§¤ì¹­ (Strict Mode)
            checklistMasterData.forEach(item => {
                const itemNo = String(item.ë²ˆí˜¸);
                const category = (item.category || '').trim();
                const itemName = (item.í•­ëª©ëª… || '').trim();

                // ë§¤ì¹­ ë¡œì§: í‚¤ì›Œë“œ í¬í•¨ ì—¬ë¶€ í™•ì¸
                let isMatch = false;

                // ì¼ì •í‘œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë§¤ì¹­ ì‹¤íŒ¨ (ì´ˆê¸°í™”)
                if (activeKeywords.size > 0) {
                    for (const keyword of activeKeywords) {
                        // í‚¤ì›Œë“œê°€ ì¹´í…Œê³ ë¦¬ë‚˜ í•­ëª©ëª…ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
                        if (category && category.includes(keyword)) { isMatch = true; break; }
                        if (itemName && itemName.includes(keyword)) { isMatch = true; break; }

                        // ë°˜ëŒ€ë¡œ ì¹´í…Œê³ ë¦¬ê°€ í‚¤ì›Œë“œì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸ (e.g. ì¼ì • "ëª©ê³µ ê³µì‚¬" -> ì¹´í…Œê³ ë¦¬ "ëª©ê³µ")
                        // ë„ˆë¬´ ì§§ì€ í‚¤ì›Œë“œëŠ” ì˜¤íƒì§€ ë°©ì§€ (2ê¸€ì ì´ìƒ)
                        if (category && keyword.includes(category) && category.length > 1) { isMatch = true; break; }
                    }
                }

                if (isMatch) {
                    // ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìƒíƒœ ìœ ì§€, ì—†ìœ¼ë©´ false(ë¯¸ì™„ë£Œ)ë¡œ ì´ˆê¸°í™”
                    if (currentChecklistData.hasOwnProperty(itemNo)) {
                        newChecklistData[itemNo] = currentChecklistData[itemNo];
                        keptCount++;
                    } else {
                        newChecklistData[itemNo] = false;
                        addedCount++;
                    }
                } else {
                    // ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” í•­ëª©ì€ ì œê±° (newChecklistDataì— ì¶”ê°€ ì•ˆ í•¨)
                    if (currentChecklistData.hasOwnProperty(itemNo)) {
                        removedCount++;
                    }
                }
            });

            // 3. ë°ì´í„° ì—…ë°ì´íŠ¸
            currentData.checklistData = newChecklistData;

            // Customers ë°°ì—´ì—ë„ ë™ê¸°í™”
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1) {
                // Deep copy to prevent reference issues
                customers[customerIndex].checklistData = JSON.parse(JSON.stringify(newChecklistData));
            }

            saveCustomers(); // ì €ì¥ (LocalStorage & Cloud if enabled)
            renderChecklistItems();

            // ê²°ê³¼ ì•Œë¦¼
            if (addedCount > 0 || removedCount > 0) {
                showToast(`ì—°ë™ ì™„ë£Œ! (ì¶”ê°€: ${addedCount}, ì‚­ì œ: ${removedCount}, ìœ ì§€: ${keptCount})`, 'success');
            } else {
                showToast(`ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. (ìœ ì§€: ${keptCount})`, 'info');
            }
        }

        function renderChecklistItems() {
            if (!checklistMasterData || checklistMasterData.length === 0) {
                document.getElementById('checklistTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #86868b;">
                            ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.
                        </td>
                    </tr>`;
                return;
            }

            // í˜„ì¬ ê³ ê°ì˜ ì²´í¬ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const customerChecklistData = getCurrentCustomerChecklistData();
            console.log('ğŸ” [Web Render] Customer ID:', currentCustomerId);
            console.log('ğŸ” [Web Render] customerChecklistData:', customerChecklistData);
            console.log('ğŸ” [Web Render] customerChecklistData keys:', Object.keys(customerChecklistData));
            console.log('ğŸ” [Web Render] Sample values:', Object.entries(customerChecklistData).slice(0, 3));

            // í•„í„° ì ìš© (ë©€í‹° ì…€ë ‰íŠ¸ ì§€ì›)
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            // [CRITICAL] ê³ ê°ì´ ì„ íƒí•œ í•­ëª©ë§Œ í‘œì‹œ (checklistDataì— ìˆëŠ” í•­ëª© ë²ˆí˜¸)
            const savedItemNumbers = Object.keys(customerChecklistData || {});
            console.log('ğŸ“Š [Web Debug] Customer selected items:', savedItemNumbers.length, 'items');
            console.log('ğŸ“Š [Web Debug] Selected item numbers:', savedItemNumbers);

            let filteredData = checklistMasterData.filter(item => {
                // 1. [CRITICAL] ê³ ê°ì´ ì„ íƒí•œ í•­ëª©ë§Œ í‘œì‹œ
                if (!savedItemNumbers.includes(String(item.ë²ˆí˜¸))) return false;

                // 2. ì§„í–‰ë‹¨ê³„ í•„í„°
                if (!stageFilter.includes('all')) {
                    if (!stageFilter.includes(item.ì§„í–‰ë‹¨ê³„ || '')) return false;
                }
                // 3. ì¹´í…Œê³ ë¦¬ í•„í„°
                if (!categoryFilter.includes('all')) {
                    if (!categoryFilter.includes(item.category || '')) return false;
                }

                return true;
            });

            // í…Œì´ë¸” ë Œë”ë§
            const tbody = document.getElementById('checklistTableBody');

            // ì¹´í…Œê³ ë¦¬ë³„ ë…¸ì…˜ ìƒ‰ìƒ ë§¤í•‘
            function getCategoryColor(category) {
                if (!category) return { bg: '#F1F1EF', text: '#37352F' }; // ê¸°ë³¸

                const c = category.trim();

                // Notion Color Palette (Standard)
                const palette = [
                    { bg: '#E3E2E0', text: '#32302C' }, // Gray
                    { bg: '#EEE0DA', text: '#442A1E' }, // Brown
                    { bg: '#FADEC9', text: '#49290E' }, // Orange
                    { bg: '#FDECC8', text: '#402C1B' }, // Yellow
                    { bg: '#DBEDDB', text: '#1C3829' }, // Green
                    { bg: '#D3E5EF', text: '#183347' }, // Blue
                    { bg: '#E8DEEE', text: '#412454' }, // Purple
                    { bg: '#F5E0E9', text: '#4C2337' }, // Pink
                    { bg: '#FFE2DD', text: '#5D1715' }, // Red
                ];

                // [Optional] ì£¼ìš” í‚¤ì›Œë“œ ê³ ì • ë§¤í•‘
                if (c.includes('ì² ê±°')) return palette[8]; // Red
                if (c.includes('ì„¤ë¹„') || c.includes('ìˆ˜ë„')) return palette[5]; // Blue
                if (c.includes('ì „ê¸°') || c.includes('ì¡°ëª…')) return palette[3]; // Yellow
                if (c.includes('ëª©ê³µ')) return palette[2]; // Orange
                if (c.includes('íƒ€ì¼') || c.includes('ìš•ì‹¤')) return palette[4]; // Green
                if (c.includes('ë„ë°°') || c.includes('ë°”ë‹¥') || c.includes('ë§ˆë£¨')) return palette[1]; // Brown
                if (c.includes('ë„ì¥') || c.includes('í•„ë¦„') || c.includes('í˜ì¸íŠ¸')) return palette[7]; // Pink
                if (c.includes('ê°€êµ¬') || c.includes('ì‹±í¬') || c.includes('ì£¼ë°©')) return palette[6]; // Purple
                if (c.includes('ê³µí†µ') || c.includes('ê°€ì„¤') || c.includes('ì¤€ê³µ') || c.includes('ë§ˆê°')) return palette[0]; // Gray

                // ê·¸ ì™¸: ë¬¸ìì—´ í•´ì‹œë¡œ ìë™ ìƒ‰ìƒ ì„ íƒ (ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— ìƒ‰ìƒ ì ìš© ë³´ì¥)
                let hash = 0;
                for (let i = 0; i < c.length; i++) {
                    hash = c.charCodeAt(i) + ((hash << 5) - hash);
                }
                const index = Math.abs(hash) % palette.length;
                return palette[index];
            }

            tbody.innerHTML = filteredData.map((item, index) => {
                const isChecked = customerChecklistData[item.ë²ˆí˜¸] || false;
                if (index === 0) {
                    console.log('ğŸ” [Web Render] First item #' + item.ë²ˆí˜¸ + ' isChecked:', isChecked, 'value:', customerChecklistData[item.ë²ˆí˜¸]);
                }
                const categoryColor = getCategoryColor(item.category);
                return `
                    <tr draggable="true" 
                        ondragstart="handleChecklistDragStart(event, ${index})" 
                        ondragover="handleChecklistDragOver(event)" 
                        ondrop="handleChecklistDrop(event, ${index})"
                        ondragend="handleChecklistDragEnd(event)"
                        data-index="${index}"
                        style="background: ${isChecked ? '#f0f9ff' : 'white'}; cursor: grab;">
                        <!-- [ì¶”ê°€] ì‚­ì œ ë²„íŠ¼ -->
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <button onclick="deleteChecklistItem(${item.ë²ˆí˜¸})" 
                                    style="border: none; background: transparent; color: #ff3b30; cursor: pointer; font-size: 14px; padding: 4px;"
                                    title="ì‚­ì œ">
                                ğŸ—‘ï¸
                            </button>
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <input type="checkbox"
                                   ${isChecked ? 'checked' : ''}
                                   onchange="toggleChecklistItem(${item.ë²ˆí˜¸})"
                                   style="width: 18px; height: 18px; cursor: pointer;">
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">${item.ë²ˆí˜¸}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.í•­ëª© || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.ë‚´ìš© || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px;">${item.ë¹„ê³  || ''}</td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <span style="background: ${(item.ì§„í–‰ë‹¨ê³„ === 'ì¸í…Œë¦¬ì–´ ì‹œì‘ ì „') ? '#fff3e0' : '#e8f5e9'}; color: ${(item.ì§„í–‰ë‹¨ê³„ === 'ì¸í…Œë¦¬ì–´ ì‹œì‘ ì „') ? '#e65100' : '#2e7d32'}; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                ${item.ì§„í–‰ë‹¨ê³„ || ''}
                            </span>
                        </td>
                        <td style="border: 1px solid #d2d2d7; padding: 12px; text-align: center;">
                            <span style="background: ${categoryColor.bg}; color: ${categoryColor.text}; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                ${item.category || ''}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            // í†µê³„ ì—…ë°ì´íŠ¸
            updateChecklistStats();
        }

        // í˜„ì¬ ê³ ê°ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getCurrentCustomerChecklistData() {
            if (!currentCustomerId) return {};

            const customer = customers.find(c => c.customerId === currentCustomerId);
            if (!customer) return {};

            return customer.checklistData || {};
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ í† ê¸€
        function toggleChecklistItem(itemNumber) {
            if (!currentCustomerId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex === -1) return;

            // checklistData ì´ˆê¸°í™”
            if (!customers[customerIndex].checklistData) {
                customers[customerIndex].checklistData = {};
            }

            // ì²´í¬ ìƒíƒœ í† ê¸€
            const currentState = customers[customerIndex].checklistData[itemNumber] || false;
            const newState = !currentState;
            customers[customerIndex].checklistData[itemNumber] = newState;

            // [FIX] currentDataì—ë„ ì¦‰ì‹œ ë°˜ì˜ (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ë®ì–´ì“°ê¸° ë°©ì§€)
            if (!currentData.checklistData) currentData.checklistData = {};
            currentData.checklistData[itemNumber] = newState;

            // ì €ì¥
            saveCustomers();

            // ë‹¤ì‹œ ë Œë”ë§
            renderChecklistItems();

            showToast(currentState ? 'ì²´í¬ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤' : 'ì²´í¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // [ìˆ˜ì •] ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì‚­ì œ - í˜„ì¬ ê³ ê°ì˜ í•­ëª©ë§Œ ì œê±°
        async function deleteChecklistItem(itemNumber) {
            if (!currentCustomerId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            // í˜„ì¬ ê³ ê°ì˜ checklistDataì—ì„œ í•´ë‹¹ í•­ëª© ë²ˆí˜¸ ì œê±°
            const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
            if (customerIndex !== -1 && customers[customerIndex].checklistData) {
                delete customers[customerIndex].checklistData[itemNumber];
                console.log('ğŸ—‘ï¸ [Web] Removed item', itemNumber, 'from customer', currentCustomerId);
            }

            // currentDataì—ë„ ë°˜ì˜
            if (currentData.checklistData) {
                delete currentData.checklistData[itemNumber];
            }

            // Google Sheetsì— ì €ì¥
            await saveCustomers();

            // UI ê°±ì‹ 
            renderChecklistItems();

            showToast('í•­ëª©ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // [ìˆ˜ì •] í•„í„° ê¸°ë°˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¼ê´„ ì¶”ê°€ ê¸°ëŠ¥
        async function showAddChecklistItemModal() {
            if (!currentData || !currentData.checklistData) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (!checklistMasterData || checklistMasterData.length === 0) {
                showToast('ë§ˆìŠ¤í„° ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ì„¸ìš”. (ğŸ”„ DB ë¶ˆëŸ¬ì˜¤ê¸°)', 'warning');
                return;
            }

            // í˜„ì¬ í•„í„° ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            // í˜„ì¬ ê³ ê°ì´ ì´ë¯¸ ì„ íƒí•œ í•­ëª© ë²ˆí˜¸
            const selectedItemNumbers = Object.keys(currentData.checklistData);

            // í•„í„°ë§ëœ í•­ëª© ì¤‘ ì•„ì§ ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©
            const availableItems = checklistMasterData.filter(item => {
                // ì´ë¯¸ ì„ íƒí•œ í•­ëª© ì œì™¸
                if (selectedItemNumbers.includes(String(item.ë²ˆí˜¸))) return false;

                // ì§„í–‰ë‹¨ê³„ í•„í„°
                if (!stageFilter.includes('all')) {
                    if (!stageFilter.includes(item.ì§„í–‰ë‹¨ê³„ || '')) return false;
                }

                // ì¹´í…Œê³ ë¦¬ í•„í„°
                if (!categoryFilter.includes('all')) {
                    if (!categoryFilter.includes(item.category || '')) return false;
                }

                return true;
            });

            if (availableItems.length === 0) {
                showToast('í˜„ì¬ í•„í„° ì¡°ê±´ì— ì¶”ê°€í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            // ì¼ê´„ ì¶”ê°€ (confirm ì œê±°)
            let addedCount = 0;
            availableItems.forEach(item => {
                if (!currentData.checklistData[item.ë²ˆí˜¸]) {
                    currentData.checklistData[item.ë²ˆí˜¸] = false;
                    addedCount++;
                }
            });

            // ë¡œì»¬ customers ë°°ì—´ì—ë„ ë°˜ì˜
            if (currentCustomerId) {
                const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
                if (customerIndex !== -1) {
                    if (!customers[customerIndex].checklistData) {
                        customers[customerIndex].checklistData = {};
                    }
                    availableItems.forEach(item => {
                        if (!customers[customerIndex].checklistData[item.ë²ˆí˜¸]) {
                            customers[customerIndex].checklistData[item.ë²ˆí˜¸] = false;
                        }
                    });
                }
            }

            console.log('âœ… [Web] Added', addedCount, 'items to customer checklist');

            // Google Sheetsì— ì €ì¥
            await saveCustomers();

            // UI ê°±ì‹ 
            renderChecklistItems();

            showToast(`${addedCount}ê°œ í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // [ì œê±°ë¨] closeAddChecklistModal() - ë” ì´ìƒ ëª¨ë‹¬ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

        // [ì œê±°ë¨] addChecklistItemToCustomer() - showAddChecklistItemModal()ì—ì„œ ì¼ê´„ ì²˜ë¦¬

        async function addChecklistItemToCustomer_DEPRECATED(itemNumber) {
            // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (í•„í„° ê¸°ë°˜ ì¼ê´„ ì¶”ê°€ë¡œ ë³€ê²½)
            if (!currentData || !currentData.checklistData) {
                showToast('ê³ ê° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                closeAddChecklistModal();
                return;
            }

            // ë§ˆìŠ¤í„° ë°ì´í„°ì—ì„œ í•´ë‹¹ í•­ëª© ì°¾ê¸°
            const item = checklistMasterData.find(i => i.ë²ˆí˜¸ === itemNumber);
            if (!item) {
                showToast('í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // ê³ ê°ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ê¸°ë³¸ê°’: ì²´í¬ ì•ˆë¨, boolean ì €ì¥)
            currentData.checklistData[itemNumber] = false;

            // ë¡œì»¬ customers ë°°ì—´ì—ë„ ë°˜ì˜
            if (currentCustomerId) {
                const customerIndex = customers.findIndex(c => c.customerId === currentCustomerId);
                if (customerIndex !== -1) {
                    if (!customers[customerIndex].checklistData) {
                        customers[customerIndex].checklistData = {};
                    }
                    customers[customerIndex].checklistData[itemNumber] = false;
                }
            }

            console.log('âœ… [Web] Added item', itemNumber, 'to customer checklist');

            // Google Sheetsì— ì €ì¥
            await saveCustomers();

            // UI ê°±ì‹ 
            renderChecklistItems();

            // ëª¨ë‹¬ ë‹«ê¸°
            closeAddChecklistModal();

            showToast(`"${item.í•­ëª©}" í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // [ì¶”ê°€] ì²´í¬ë¦¬ìŠ¤íŠ¸ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
        let checklistDraggedIndex = null;
        let checklistFilteredData = []; // í•„í„°ë§ëœ ë°ì´í„° ì €ì¥ìš©

        function handleChecklistDragStart(e, index) {
            checklistDraggedIndex = index;
            e.target.style.opacity = '0.4';
            e.dataTransfer.effectAllowed = 'move';

            // í˜„ì¬ í•„í„°ë§ëœ ë°ì´í„° ì €ì¥
            const stageFilter = typeof getMultiSelectValues === 'function' ? getMultiSelectValues('checklistStageFilter') : ['all'];
            const categoryFilter = typeof getMultiSelectValues === 'function' ? getMultiSelectValues('checklistCategoryFilter') : ['all'];

            checklistFilteredData = checklistMasterData.filter(item => {
                if (!stageFilter.includes('all') && !stageFilter.includes(item.ì§„í–‰ë‹¨ê³„ || '')) return false;
                if (!categoryFilter.includes('all') && !categoryFilter.includes(item.category || '')) return false;
                return true;
            });
        }

        function handleChecklistDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const row = e.target.closest('tr');
            if (row) {
                row.style.borderTop = '2px solid #0071e3';
            }
        }

        function handleChecklistDrop(e, targetIndex) {
            e.preventDefault();
            if (checklistDraggedIndex === null || checklistDraggedIndex === targetIndex) return;

            // í•„í„°ëœ ë°ì´í„°ì—ì„œ ì‹¤ì œ ë§ˆìŠ¤í„° ë°ì´í„°ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
            const draggedItem = checklistFilteredData[checklistDraggedIndex];
            const targetItem = checklistFilteredData[targetIndex];

            const draggedMasterIndex = checklistMasterData.findIndex(item => item.ë²ˆí˜¸ === draggedItem.ë²ˆí˜¸);
            const targetMasterIndex = checklistMasterData.findIndex(item => item.ë²ˆí˜¸ === targetItem.ë²ˆí˜¸);

            if (draggedMasterIndex === -1 || targetMasterIndex === -1) return;

            // ë§ˆìŠ¤í„° ë°ì´í„°ì—ì„œ ìˆœì„œ ë³€ê²½
            const [removed] = checklistMasterData.splice(draggedMasterIndex, 1);
            checklistMasterData.splice(targetMasterIndex, 0, removed);

            // [ì¶”ê°€] ë²ˆí˜¸ ì¬ì •ë ¬ (1, 2, 3, 4, 5... ìˆœì„œë¡œ)
            checklistMasterData.forEach((item, idx) => {
                item.ë²ˆí˜¸ = idx + 1;
            });

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸ (Phase 2: ê¸ˆì§€)


            // UI ê°±ì‹ 
            renderChecklistItems();
            showToast('ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function handleChecklistDragEnd(e) {
            e.target.style.opacity = '1';
            checklistDraggedIndex = null;
            // ëª¨ë“  í–‰ì˜ border ì´ˆê¸°í™”
            document.querySelectorAll('#checklistTableBody tr').forEach(row => {
                row.style.borderTop = '';
            });
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateChecklistStats() {
            // í˜„ì¬ í•„í„° ì ìš©í•˜ì—¬ ë³´ì´ëŠ” í•­ëª©ë§Œ ê³„ì‚°
            let stageFilter = ['all'];
            let categoryFilter = ['all'];

            if (typeof getMultiSelectValues === 'function') {
                stageFilter = getMultiSelectValues('checklistStageFilter');
                categoryFilter = getMultiSelectValues('checklistCategoryFilter');
            }

            const filteredData = checklistMasterData.filter(item => {
                if (!stageFilter.includes('all') && !stageFilter.includes(item.ì§„í–‰ë‹¨ê³„ || '')) return false;
                if (!categoryFilter.includes('all') && !categoryFilter.includes(item.category || '')) return false;
                return true;
            });

            const total = filteredData.length; // í•„í„°ëœ í•­ëª© ìˆ˜
            const customerChecklistData = getCurrentCustomerChecklistData();

            // í•„í„°ëœ í•­ëª© ì¤‘ ì²´í¬ëœ ê²ƒë§Œ ì¹´ìš´íŠ¸
            const completed = filteredData.filter(item => customerChecklistData[item.ë²ˆí˜¸] === true).length;
            const inProgress = total - completed;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('checklistTotalCount').textContent = total;
            document.getElementById('checklistCompletedCount').textContent = completed;
            document.getElementById('checklistInProgressCount').textContent = inProgress;
            document.getElementById('checklistProgressRate').textContent = rate + '%';
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¸ì‡„
        function printChecklist() {
            const element = document.querySelector('#panel-checklist .document-wrapper');
            if (!element) {
                showToast('ì²´í¬ë¦¬ìŠ¤íŠ¸ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // Clone element
            const clonedElement = element.cloneNode(true);

            // Remove elements marked as no-print, buttons, and emoji icons
            clonedElement.querySelectorAll('.no-print, .btn, .notion-export-btn, .emoji-icon, button').forEach(el => el.remove());

            // Checkbox/Input handling
            const originalInputs = element.querySelectorAll('input, select, textarea');
            const clonedInputs = clonedElement.querySelectorAll('input, select, textarea');

            originalInputs.forEach((inp, i) => {
                if (clonedInputs[i]) {
                    if (inp.type === 'checkbox' || inp.type === 'radio') {
                        // Replace checkbox with symbol
                        const span = document.createElement('span');
                        span.textContent = inp.checked ? 'â˜‘' : 'â˜';
                        span.style.cssText = 'font-weight:bold; font-size:14px; margin-right:5px;';
                        if (clonedInputs[i].parentNode) {
                            clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                        }
                    } else if (inp.tagName === 'SELECT') {
                        const span = document.createElement('span');
                        span.textContent = inp.options[inp.selectedIndex]?.text || '';
                        if (clonedInputs[i].parentNode) clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                    } else {
                        const span = document.createElement('span');
                        span.textContent = inp.value;
                        if (clonedInputs[i].parentNode) clonedInputs[i].parentNode.replaceChild(span, clonedInputs[i]);
                    }
                }
            });

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ê³µì • ì²´í¬ë¦¬ìŠ¤íŠ¸ - ì¸ì‡„</title>
                    <style>
                        body {
                            font-family: 'Inter', -apple-system, sans-serif;
                            padding: 20px;
                            background: white;
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        /* Header Styles - Matches Cover Contract exactly */
                        .doc-header {
                            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%) !important;
                            color: #ffffff !important;
                            padding: 20px 24px !important;
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            margin-bottom: 30px !important;
                            border-radius: 0 !important;
                        }
                        .doc-header h1 {
                            font-size: 24px !important;
                            font-weight: 700 !important;
                            margin: 0 !important;
                            color: #fff !important;
                        }
                        .doc-header .subtitle {
                            font-size: 14px !important;
                            opacity: 0.9 !important;
                            color: #fff !important;
                            margin-top: 4px !important;
                        }

                        /* Content Styles */
                        table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            font-size: 11px !important;
                        }
                        th, td {
                            border: 1px solid #d2d2d7 !important;
                            padding: 8px !important;
                            text-align: left;
                        }
                        th { background: #f5f5f7 !important; font-weight: 600; text-align: center; }
                        
                        /* Layout Tweaks */
                        .checklist-table { margin-top: 20px; }
                        
                        /* Hide unwanted */
                        .no-print, button, .restore-btn, .notion-export-btn { display: none !important; }
                    </style>
                </head>
                <body>
                    ${clonedElement.innerHTML}
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ íƒ­ ì—´ë¦´ ë•Œ ìë™ìœ¼ë¡œ ë Œë”ë§
        const originalShowCustomerTab = showCustomerTab;
        showCustomerTab = function (tabId) {
            originalShowCustomerTab(tabId);

            if (tabId === 'checklist') {
                // ë§ˆìŠ¤í„° ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
                if (checklistMasterData.length === 0) {
                    // ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê³  ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë„ë¡ ìœ ë„
                    updateChecklistStats();
                } else {
                    renderChecklistItems();
                }
            }

            // í†µê³„ íƒ­ í™œì„±í™” ì‹œ ë°ì´í„° ì—…ë°ì´íŠ¸
            if (tabId === 'stats') {
                updateSettlementStats();
                updateProfitStats();
                updateEditHistory();
            }
        };

        // ============================================
        // ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ============================================


        /**
         * ë…¸ì…˜ìœ¼ë¡œ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
         * @param {string} type - 'customer', 'schedule', 'checklist'
         */
        window.exportToNotion = async function (type, event) {
            console.log('ğŸš€ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ì‹œì‘ - íƒ€ì…:', type);

            // ì´ë²¤íŠ¸ ê°ì²´ í™•ë³´ & ê¸°ë³¸ ë™ì‘ ë°©ì§€ (í¼ ì œì¶œ ë°©ì§€ ë“±)
            const evt = event || window.event;
            if (evt) {
                evt.preventDefault();
                evt.stopPropagation();
            }

            // currentCustomer ëŒ€ì‹  currentData ì‚¬ìš© (í˜¸í™˜ì„±)
            const targetData = currentData || currentCustomer;

            if (!targetData || !currentCustomerId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            // ì‹œì‘ ì•Œë¦¼ (í† ìŠ¤íŠ¸)
            showToast('ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');

            let btn = null;
            let originalHTML = '';

            if (evt && evt.target) {
                btn = evt.target.closest('button');
                if (btn) {
                    originalHTML = btn.innerHTML;
                    btn.innerHTML = 'â³ ë‚´ë³´ë‚´ëŠ” ì¤‘...';
                    btn.disabled = true;
                }
            }

            try {
                let requestData = {
                    action: 'exportToNotion',
                    type: type,
                    customerId: currentCustomerId // currentCustomer.id -> currentCustomerId
                };

                // ë‚ ì§œ ë° ê¸°ê°„ ì •ë³´ ì¶”ì¶œ (yyyy.MM.dd -> yyyy-MM-dd ì •ê·œí™”)
                const normalizeDate = (d) => d ? d.replace(/\./g, '-') : '';
                const startDateVal = normalizeDate(document.getElementById('constructionStartInput')?.value || targetData.startDate || '');
                const endDateVal = normalizeDate(document.getElementById('constructionEndInput')?.value || targetData.endDate || '');
                const periodVal = document.getElementById('hiddenConstructionPeriod')?.value || targetData.constructionPeriod || '';

                // íƒ€ì…ë³„ ë°ì´í„° ì¤€ë¹„ (Backend update_apps_script.jsì™€ í‚¤ ì¼ì¹˜ì‹œí‚´)
                if (type === 'customer') {
                    // ìŠ¤ì¼€ì¤„ ë°ì´í„° ì¤€ë¹„
                    const scheduleData = targetData.schedules || [];
                    const scheduleRows = scheduleData.map((item, idx) => ({
                        category: item.category || '',
                        process: item.name || '',
                        startDate: normalizeDate(item.start || ''),
                        endDate: normalizeDate(item.end || ''),
                        status: item.checkPoint || '',
                        manager: item.inCharge || ''
                    }));

                    requestData.data = {
                        'ì„±ëª…': targetData.clientName || '',
                        'ì—°ë½ì²˜': targetData.clientPhone || '',
                        'ì´ë©”ì¼': targetData.clientEmail || '',
                        'ì£¼ì†Œ': targetData.clientAddress || '',
                        'í˜„ì¥ì£¼ì†Œ': targetData.siteAddress || '',

                        'ë°°ìš°ì ì„±ëª…': targetData.spouseName || '',
                        'ë°°ìš°ì ì—°ë½ì²˜': targetData.spousePhone || '',

                        'í‰ìˆ˜': targetData.area || '',
                        'ê±´ë¬¼ìœ í˜•': targetData.buildingType || '',
                        'ìœ ì…ê²½ë¡œ': targetData.clientSource || '',

                        'ê³µì‚¬ê¸°ê°„': periodVal,
                        'ì°©ê³µì¼': startDateVal,
                        'ì¤€ê³µì¼': endDateVal,
                        'ì´ì‚¬ë‚ ì§œ': targetData.movingDate || '',
                        'ì”ê¸ˆì¼': targetData.finalPaymentDate || '',
                        'ê³„ì•½ì¼': targetData.contractDate || '',
                        'ê³µì‚¬ëª…': targetData.projectName || '',

                        'ê³µì‚¬ ë‹´ë‹¹ì': targetData.manager || '',
                        'ì´ê³„ì•½ê¸ˆì•¡': targetData.totalAmount || '',

                        'ê³ ê° ìš”ì²­ì‚¬í•­': targetData.customerRequest || '',
                        'ë‚´ë¶€ ë©”ëª¨': targetData.internalMemo || '',
                        'íŠ¹ì•½ì‚¬í•­': targetData.specialNote || '',
                        'A/S ê¸°ê°„': targetData.asEndDate || '', // A/S ì¢…ë£Œì¼

                        // ìœ ì˜ì‚¬í•­ (ìŠ¤ì¼€ì¤„/A/S)
                        'ê³µì‚¬ ìœ ì˜ì‚¬í•­': getScheduleGuidelinesText(),
                        'A/S ìœ ì˜ì‚¬í•­': getASGuidelinesText(),

                        // ìŠ¤ì¼€ì¤„ ë°ì´í„° í¬í•¨
                        scheduleRows: scheduleRows
                    };

                } else if (type === 'all') {
                    // [í†µí•©] ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸°

                    // 1. Customer (ê¸°ì¡´ customer ë¡œì§ ì¬ì‚¬ìš©)
                    const customerData = {
                        'ì„±ëª…': targetData.clientName || '',
                        'ì—°ë½ì²˜': targetData.clientPhone || '',
                        'ì´ë©”ì¼': targetData.clientEmail || '',
                        'ì£¼ì†Œ': targetData.clientAddress || '',
                        'í˜„ì¥ì£¼ì†Œ': targetData.siteAddress || '',
                        'ë°°ìš°ì ì„±ëª…': targetData.spouseName || '',
                        'ë°°ìš°ì ì—°ë½ì²˜': targetData.spousePhone || '',
                        'ê³ ê° ìš”ì²­ì‚¬í•­': targetData.clientNeeds || '',
                        'ë‚´ë¶€ ë©”ëª¨': targetData.internalNote || '',
                        'íŠ¹ì•½ì‚¬í•­': targetData.specialContract || '',
                        'ê³µì‚¬ ë‹´ë‹¹ì': targetData.constructionManager || '',
                        'ê±´ë¬¼ìœ í˜•': targetData.buildingType || '',
                        'ìœ ì…ê²½ë¡œ': targetData.funnel || '',
                        'ì´ ê³„ì•½ê¸ˆì•¡ (VAT í¬í•¨)': typeof calculateTotalAmount === 'function' ? calculateTotalAmount() : 0,
                        'í‰ìˆ˜': document.getElementById('pyeongInput')?.value || targetData.area || 0,
                        'ì´ì‚¬ë‚ ì§œ': targetData.moveDate || '',
                        'ê³„ì•½ì¼': targetData.contractDate || '',
                        'ì°©ê³µì¼': startDateVal,
                        'ì¤€ê³µì¼': endDateVal,
                        'ì”ê¸ˆì¼': targetData.balanceDate || '',
                        'A/S ê¸°ê°„': targetData.asEndDate || '',
                        'ê³µì‚¬ ìœ ì˜ì‚¬í•­': getScheduleGuidelinesText(),
                        'A/S ìœ ì˜ì‚¬í•­': getASGuidelinesText()
                    };

                    // 2. Schedule
                    // ì „ì—­ scheduleRows ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì €ì¥ëœ ë°ì´í„° fallback
                    const sData = (typeof scheduleRows !== 'undefined' && scheduleRows.length > 0) ? scheduleRows : (targetData.schedules || []);
                    let scheduleData = null;
                    if (sData.length > 0) {
                        scheduleData = {
                            'guidelines': getScheduleGuidelinesArray(),
                            'ê³µì •ëª©ë¡': sData.map(item => ({
                                ê³µì •: (item.category ? item.category + ' - ' : '') + (item.name || ''),
                                ì‹œì‘ì¼: item.start || '',
                                ì¢…ë£Œì¼: item.end || '',
                                ë‹´ë‹¹ì: item.inCharge || '',
                                ìƒíƒœ: item.checkPoint || '',
                                ë¹„ê³ : item.memo || ''
                            }))
                        };
                    }

                    // 3. Checklist
                    let checklistData = null;
                    if (checklistMasterData && checklistMasterData.length > 0) {
                        const customerChecklistData = getCurrentCustomerChecklistData();

                        // ê³ ê°ì´ ì„ íƒí•œ í•­ëª© ë²ˆí˜¸
                        const selectedItemNumbers = Object.keys(customerChecklistData);

                        // ê³ ê°ì´ ì„ íƒí•œ í•­ëª©ë§Œ í•„í„°ë§
                        const customerItems = checklistMasterData.filter(item =>
                            selectedItemNumbers.includes(String(item.ë²ˆí˜¸))
                        );

                        checklistData = {
                            'ì™„ë£Œí•­ëª©ìˆ˜': Object.values(customerChecklistData).filter(v => v).length,
                            'ì „ì²´í•­ëª©ìˆ˜': customerItems.length,
                            'ì²´í¬ë¦¬ìŠ¤íŠ¸': customerItems.map(item => {
                                const isChecked = !!customerChecklistData[item.ë²ˆí˜¸];
                                return {
                                    ë²ˆí˜¸: item.ë²ˆí˜¸,
                                    í•­ëª©: item.í•­ëª© || '',
                                    ë‚´ìš©: item.ë‚´ìš© || '',
                                    ì§„í–‰ë‹¨ê³„: item.ì§„í–‰ë‹¨ê³„ || '',
                                    ì¹´í…Œê³ ë¦¬: item.category || '',
                                    ë¹„ê³ : (isChecked ? '[ì™„ë£Œ] ' : '') + (item.ë¹„ê³  || ''),
                                    isChecked: isChecked
                                };
                            })
                        };
                    }

                    // 4. A/S List
                    let asListData = null;
                    const aData = (typeof asListRows !== 'undefined' && asListRows.length > 0) ? asListRows : [];
                    if (aData.length > 0) {
                        asListData = {
                            manager: targetData.manager || '',
                            period: targetData.warrantyPeriod || '',
                            guidelines: getASGuidelinesArray(),
                            items: aData
                        };
                    }

                    requestData.data = {
                        customer: customerData,
                        schedule: scheduleData,
                        checklist: checklistData,
                        asList: asListData
                    };

                } else if (type === 'schedule') {
                    const scheduleData = targetData.schedules || [];

                    requestData.data = {
                        'ì„±ëª…': targetData.clientName || '',
                        'í˜„ì¥ì£¼ì†Œ': targetData.siteAddress || '',
                        'ì°©ê³µì¼': startDateVal,
                        'ì¤€ê³µì¼': endDateVal,
                        'guidelines': getScheduleGuidelinesArray(), // [ì¶”ê°€] ìœ ì˜ì‚¬í•­ ë°°ì—´
                        'ê³µì •ëª©ë¡': scheduleData.map(item => ({
                            ê³µì •: (item.category ? item.category + ' - ' : '') + (item.name || ''),
                            ì‹œì‘ì¼: normalizeDate(item.start || ''),
                            ì¢…ë£Œì¼: normalizeDate(item.end || ''),
                            ë‹´ë‹¹ì: item.inCharge || '',
                            ìƒíƒœ: item.checkPoint || '',
                            ë¹„ê³ : item.memo || ''
                        }))
                    };
                } else if (type === 'checklist') {
                    const customerChecklistData = getCurrentCustomerChecklistData();

                    // ê³ ê°ì´ ì„ íƒí•œ í•­ëª© ë²ˆí˜¸
                    const selectedItemNumbers = Object.keys(customerChecklistData);

                    // ê³ ê°ì´ ì„ íƒí•œ í•­ëª©ë§Œ í•„í„°ë§
                    const customerItems = checklistMasterData.filter(item =>
                        selectedItemNumbers.includes(String(item.ë²ˆí˜¸))
                    );

                    // [ë³€ê²½] ê³ ê°ì´ ì„ íƒí•œ í•­ëª©ë§Œ ë‚´ë³´ë‚´ê¸° (ì²´í¬ ì—¬ë¶€ í¬í•¨)
                    requestData.data = {
                        'ì„±ëª…': targetData.clientName || '',
                        'í˜„ì¥ì£¼ì†Œ': targetData.siteAddress || '',
                        'ì™„ë£Œí•­ëª©ìˆ˜': Object.values(customerChecklistData).filter(v => v).length,
                        'ì „ì²´í•­ëª©ìˆ˜': customerItems.length,
                        'ì²´í¬ë¦¬ìŠ¤íŠ¸': customerItems.map(item => {
                            const isChecked = !!customerChecklistData[item.ë²ˆí˜¸];
                            return {
                                ë²ˆí˜¸: item.ë²ˆí˜¸,
                                í•­ëª©: item.í•­ëª© || '',
                                ë‚´ìš©: item.ë‚´ìš© || '',
                                ì§„í–‰ë‹¨ê³„: item.ì§„í–‰ë‹¨ê³„ || '',
                                ì¹´í…Œê³ ë¦¬: item.category || '',
                                // ì²´í¬ëœ í•­ëª©ì€ ë¹„ê³  ì•ì— [ì™„ë£Œ] í‘œì‹œ
                                ë¹„ê³ : (isChecked ? '[ì™„ë£Œ] ' : '') + (item.ë¹„ê³  || ''),
                                isChecked: isChecked
                            };
                        })
                    };

                    // [Validation] ë‚´ë³´ë‚¼ í•­ëª©ì´ ì—†ìœ¼ë©´ ì¤‘ë‹¨
                    if (requestData.data.ì²´í¬ë¦¬ìŠ¤íŠ¸.length === 0) {
                        showToast('ì„ íƒëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € ì²´í¬ë¦¬ìŠ¤íŠ¸ì—ì„œ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                        if (btn) {
                            btn.innerHTML = originalHTML;
                            btn.disabled = false;
                        }
                        return;
                    }
                }

                console.log('ğŸ“¤ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ìš”ì²­:', requestData);

                // data ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
                const formData = new URLSearchParams();
                formData.append('action', requestData.action);
                formData.append('type', requestData.type);
                formData.append('customerId', requestData.customerId);
                formData.append('data', JSON.stringify(requestData.data));

                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status + ' ' + response.statusText);
                }

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨: ' + e.message);
                }

                if (result.success) {
                    if (type === 'all' && result.details) {
                        let lines = [];
                        lines.push('<b>[ë…¸ì…˜ í†µí•© ë‚´ë³´ë‚´ê¸° ê²°ê³¼]</b>');
                        const map = { customer: 'ê³ ê°ì •ë³´', schedule: 'ê³µì‚¬ìŠ¤ì¼€ì¤„', checklist: 'ì²´í¬ë¦¬ìŠ¤íŠ¸', asList: 'A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸' };

                        ['customer', 'schedule', 'checklist', 'asList'].forEach(k => {
                            const d = result.details[k];
                            if (d) {
                                if (d.message === 'ë°ì´í„° ì—†ìŒ') {
                                    lines.push(`${map[k]}: <span style="opacity:0.7">âšªï¸ ë¹ˆ ìƒíƒœ</span>`);
                                } else if (d.success) {
                                    lines.push(`${map[k]}: <b>âœ… ì„±ê³µ</b>`);
                                } else {
                                    lines.push(`${map[k]}: âŒ ì‹¤íŒ¨ (${d.message})`);
                                }
                            }
                        });
                        showToast(lines.join('<br>'), 'info', 5000);
                    } else {
                        showToast('âœ… ë…¸ì…˜ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!', 'success');
                    }
                    // ì„±ê³µ ë¡œê·¸ (íƒ€ì…ë³„ ìƒì„¸ ë‚´ìš©)
                    const typeNameMap = { 'customer': 'ê³ ê° ì •ë³´', 'schedule': 'ê³µì‚¬ ìŠ¤ì¼€ì¤„', 'checklist': 'ì²´í¬ë¦¬ìŠ¤íŠ¸', 'all': 'ì „ì²´ ë°ì´í„°' };
                    const tName = typeNameMap[type] || type;
                    logUserAction('ë…¸ì…˜ ë‚´ë³´ë‚´ê¸°', (targetData.clientName || targetData.projectName || 'ê³ ê°') + ' ' + tName + ' ë‚´ë³´ë‚´ê¸°');
                } else {
                    throw new Error(result.message || 'ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('âŒ ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                let errMsg = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                if (typeof error === 'string') errMsg = error;
                else if (error.message) errMsg = error.message;
                else if (error.toString) errMsg = error.toString();

                showToast('ë…¸ì…˜ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ' + errMsg, 'error');
            } finally {
                if (btn) {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }
        };

        // ============================================
        // í†µê³„ íƒ­ ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ============================================

        let processChartInstance = null; // Chart.js ì¸ìŠ¤í„´ìŠ¤ ì €ì¥

        // ì •ì‚° í˜„í™© í†µê³„ ì—…ë°ì´íŠ¸
        function updateSettlementStats() {
            if (!currentCustomer) return;

            const settlementData = currentCustomer.settlementData || [];
            const totalContract = parseFloat(currentCustomer.totalAmount) || 0;

            // ì •ì‚° ì™„ë£Œ ê¸ˆì•¡ ê³„ì‚° (ì…ê¸ˆì™„ë£Œ í•­ëª©ë“¤ì˜ í•©)
            let settled = 0;
            settlementData.forEach(item => {
                if (item['ì…ê¸ˆì—¬ë¶€'] === 'ì™„ë£Œ' || item['ì…ê¸ˆì—¬ë¶€'] === 'ì…ê¸ˆì™„ë£Œ') {
                    settled += parseFloat(item['ê¸ˆì•¡']) || 0;
                }
            });

            const outstanding = totalContract - settled;
            const rate = totalContract > 0 ? ((settled / totalContract) * 100).toFixed(1) : 0;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('stats-total-contract').textContent = formatCurrency(totalContract);
            document.getElementById('stats-settled').textContent = formatCurrency(settled);
            document.getElementById('stats-outstanding').textContent = formatCurrency(outstanding);
            document.getElementById('stats-settlement-rate').textContent = rate + '%';
        }

        // ìˆ˜ìµì„± í†µê³„ ì—…ë°ì´íŠ¸ ë° ì°¨íŠ¸ ìƒì„±
        function updateProfitStats() {
            if (!currentCustomer) return;

            const costData = currentCustomer.costData || [];
            let totalEstimate = 0;
            let totalCost = 0;
            const processData = {};

            // ê³µì •ë³„ ë°ì´í„° ì§‘ê³„
            costData.forEach(item => {
                const process = item['ê³µì •'] || 'ê¸°íƒ€';
                const estimate = parseFloat(item['ê²¬ì ê¸ˆì•¡']) || 0;
                const cost = parseFloat(item['ì›ê°€']) || 0;

                totalEstimate += estimate;
                totalCost += cost;

                if (!processData[process]) {
                    processData[process] = { estimate: 0, cost: 0 };
                }
                processData[process].estimate += estimate;
                processData[process].cost += cost;
            });

            const totalProfit = totalEstimate - totalCost;
            const profitRate = totalEstimate > 0 ? ((totalProfit / totalEstimate) * 100).toFixed(1) : 0;

            // ìˆ˜ìµì„± ìš”ì•½ ì—…ë°ì´íŠ¸
            document.getElementById('stats-total-estimate').textContent = formatCurrency(totalEstimate);
            document.getElementById('stats-total-cost').textContent = formatCurrency(totalCost);
            document.getElementById('stats-total-profit').textContent = formatCurrency(totalProfit);
            document.getElementById('stats-profit-rate').textContent = profitRate + '%';

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawProcessChart(processData);
        }

        // ê³µì •ë³„ ì°¨íŠ¸ ê·¸ë¦¬ê¸° (Chart.js)
        function drawProcessChart(processData) {
            const canvas = document.getElementById('processChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
            if (processChartInstance) {
                processChartInstance.destroy();
            }

            const processes = Object.keys(processData);
            const estimates = processes.map(p => processData[p].estimate);
            const costs = processes.map(p => processData[p].cost);
            const profits = processes.map((p, i) => estimates[i] - costs[i]);

            processChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processes,
                    datasets: [
                        {
                            label: 'ê²¬ì ê¸ˆì•¡',
                            data: estimates,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ì›ê°€',
                            data: costs,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ì´ìµ',
                            data: profits,
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return 'â‚©' + (value / 10000).toFixed(0) + 'ë§Œ';
                                }
                            }
                        }
                    }
                }
            });
        }

        // í¸ì§‘ ì´ë ¥ ê´€ë¦¬ (Phase 2: In-memory ì „ìš©)
        let editHistoryRows = [];

        // í¸ì§‘ ì´ë ¥ ì—…ë°ì´íŠ¸
        function updateEditHistory() {
            const timeline = document.getElementById('edit-history-timeline');
            if (!timeline) return;

            // In-memoryì—ì„œ í¸ì§‘ ì´ë ¥ ê°€ì ¸ì˜¤ê¸°
            const history = editHistoryRows;

            if (history.length === 0) {
                timeline.innerHTML = '<div style="text-align: center; color: #8e8e93; padding: 40px;">í¸ì§‘ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // íƒ€ì„ë¼ì¸ HTML ìƒì„±
            let html = '';
            history.slice(0, 50).forEach(item => {
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleString('ko-KR');

                html += `
                    <div style="border-left: 3px solid #007aff; padding-left: 16px; margin-bottom: 20px; position: relative;">
                        <div style="position: absolute; left: -7px; top: 5px; width: 10px; height: 10px; background: #007aff; border-radius: 50%;"></div>
                        <div style="font-size: 12px; color: #8e8e93; margin-bottom: 4px;">${dateStr}</div>
                        <div style="font-size: 14px; font-weight: 600; color: #1d1d1f; margin-bottom: 4px;">
                            ğŸ‘¤ ${item.userName || item.userId} (${item.userId})
                        </div>
                        <div style="font-size: 13px; color: #1d1d1f; margin-bottom: 4px;">
                            ğŸ“„ ${item.menu} ${item.item ? '> ' + item.item : ''}
                        </div>
                        <div style="font-size: 13px; color: #636366;">
                            ìˆ˜ì •: ${item.field}
                            <span style="color: #ff3b30;">[${item.oldValue || '-'}]</span> â†’
                            <span style="color: #34c759;">[${item.newValue || '-'}]</span>
                        </div>
                    </div>
                `;
            });

            timeline.innerHTML = html;
        }

        // í¸ì§‘ ì´ë ¥ ì €ì¥ í•¨ìˆ˜ (ë‹¤ë¥¸ ê³³ì—ì„œ í˜¸ì¶œ)
        function saveEditHistory(menu, item, field, oldValue, newValue) {
            const history = editHistoryRows;

            const entry = {
                timestamp: new Date().toISOString(),
                userId: currentUser?.id || 'unknown',
                userName: currentUser?.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                menu: menu,
                item: item,
                field: field,
                oldValue: oldValue,
                newValue: newValue
            };

            history.unshift(entry);
            if (history.length > 100) history.splice(100);
            editHistoryRows = history;
            // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€

        }
        // ==========================================
        // ìƒˆ ê¸°ëŠ¥: í˜„ì¬ ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë° í†µí•© ì¸ì‡„
        // ==========================================

        function exportCurrentCustomerData() {
            if (!currentData || !currentData.customerId) {
                showToast('ì„ íƒëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // í˜„ì¬ ê³ ê° ê°ì²´ë§Œ ì¶”ì¶œ
            const dataToExport = {
                customer: currentData,
                exportDate: new Date().toISOString(),
                type: 'single_customer_export'
            };

            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ë””ìì¸ì§€ê·¸_${currentData.customerName || 'ê³ ê°'}_ë°ì´í„°.json`;
            a.click();
            showToast('í˜„ì¬ ê³ ê° ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function printCurrentCustomerAll() {
            if (!currentData || !currentData.customerId) {
                showToast('ì„ íƒëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // ì¸ì‡„í•  ì„¹ì…˜ ì •ì˜ (ì‚¬ìš©ì ìš”ì²­ í•­ëª©)
            const sections = [
                { id: 'customerInfoDoc', title: 'ê³ ê° ì •ë³´' },
                { id: 'contractDoc', title: 'ë„ê¸‰ê³„ì•½ì„œ' },
                { id: 'coverDoc', title: 'í‘œì§€ê³„ì•½ì„œ' },
                { id: 'estimateDoc', title: 'ê³„ì•½ê²¬ì ì„œ' },
                { id: 'costDoc', title: 'ì›ê°€ê´€ë¦¬í‘œ' },
                { id: 'scheduleDoc', title: 'ê³µì‚¬ ìŠ¤ì¼€ì¤„' },
                { id: 'asListDoc', title: 'A/S ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸' }
            ];

            const printContainer = document.createElement('div');
            let hasContent = false;

            sections.forEach((section, index) => {
                const originalEl = document.getElementById(section.id);
                if (!originalEl) return;

                hasContent = true;
                const wrapper = document.createElement('div');
                wrapper.className = 'print-section';
                // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ì•„ë‹ˆë©´ í˜ì´ì§€ ë„˜ê¹€
                if (index < sections.length - 1) {
                    wrapper.style.pageBreakAfter = 'always';
                }
                wrapper.style.marginBottom = '40px'; // ì„¹ì…˜ ê°„ ê°„ê²© (í™”ë©´ìƒì—ì„œ ì˜ ë³´ì´ê²Œ)

                const clonedEl = originalEl.cloneNode(true);

                // ì…ë ¥ í•„ë“œê°’ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ì›ë³¸ ì—˜ë¦¬ë¨¼íŠ¸ ì°¸ì¡°í•˜ì—¬ ê°’ ê°€ì ¸ì˜¤ê¸°)
                convertInputsToTextForPrint(originalEl, clonedEl);

                // ë¶ˆí•„ìš”í•œ ìš”ì†Œ ì œê±° (ë²„íŠ¼, no-print í´ë˜ìŠ¤)
                clonedEl.querySelectorAll('button, .no-print').forEach(el => el.remove());

                wrapper.appendChild(clonedEl);
                printContainer.appendChild(wrapper);
            });

            if (!hasContent) {
                showToast('ì¸ì‡„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const printWindow = window.open('', '_blank');


            // ê¸°ë³¸ HTML êµ¬ì¡° ì‘ì„± (ìŠ¤íƒ€ì¼ ì œì™¸)
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${currentData.customerName || 'ê³ ê°'} - í†µí•© ë¬¸ì„œ</title>
                    <style>
                        @media print {
                            @page { size: A4; margin: 10mm; }
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white; }
                            .print-section { page-break-after: always; display: block !important; }
                            .print-section:last-child { page-break-after: auto; }
                            
                            /* ìˆ¨ê²¨ì§„ íƒ­ íŒ¨ë„ ê°•ì œ í‘œì‹œ */
                            .tab-panel, .document-wrapper { 
                                display: block !important; 
                                opacity: 1 !important; 
                                visibility: visible !important;
                                height: auto !important;
                                overflow: visible !important;
                            }
                        }
                        
                        body { background: white; padding: 20px; font-family: 'Inter', sans-serif; }
                        
                        /* ì¸ì‡„ìš© í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
                        .print-text-val { 
                            font-weight: 500; 
                            color: #000; 
                            display: inline-block;
                        }
                        
                        /* ë¬¸ì„œ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ (ì—¬ë°± ë“±) */
                        .document-wrapper {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                            max-width: 100% !important;
                            width: 100% !important;
                        }
                    </style>
                </head>
                <body>
                    ${printContainer.innerHTML}
                </body>
                </html>
            `);

            // ìŠ¤íƒ€ì¼ íƒœê·¸ ë³µì‚¬ (ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ ë°©ì§€ìš©)
            // document.head.innerHTMLì„ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì— ë„£ìœ¼ë©´ ë°±í‹± ë¬¸ì œë¡œ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
            const styles = document.querySelectorAll('style, link[rel="stylesheet"]');
            styles.forEach(style => {
                printWindow.document.head.appendChild(style.cloneNode(true));
            });

            // ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì¸ì‡„)
            const script = printWindow.document.createElement('script');
            script.textContent = `
                window.onload = function() {
                    setTimeout(function() {
                        window.print();
                    }, 1000);
                };
            `;
            printWindow.document.body.appendChild(script);

            printWindow.document.close();
        }

        // ì…ë ¥ í•„ë“œë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function convertInputsToTextForPrint(originParent, clonedParent) {
            const originInputs = originParent.querySelectorAll('input, textarea, select');
            const clonedInputs = clonedParent.querySelectorAll('input, textarea, select');

            for (let i = 0; i < originInputs.length; i++) {
                const origin = originInputs[i];
                const clone = clonedInputs[i];
                if (!clone) continue;

                let val = '';
                if (origin.tagName === 'SELECT') {
                    if (origin.selectedIndex >= 0) val = origin.options[origin.selectedIndex].text;
                    // 'ì„ íƒ' ê°™ì€ ê±´ ë¹ˆì¹¸ ì²˜ë¦¬
                    if (val.includes('ì„ íƒ')) val = '';
                } else if (origin.type === 'checkbox' || origin.type === 'radio') {
                    val = origin.checked ? 'â˜‘' : 'â˜';
                } else {
                    val = origin.value;
                }

                const span = document.createElement('span');
                span.className = 'print-text-val';
                span.textContent = val;

                if (origin.type !== 'checkbox' && origin.type !== 'radio') {
                    span.style.whiteSpace = 'pre-wrap';
                } else {
                    span.style.fontSize = '14px';
                    span.style.marginRight = '4px';
                }

                if (clone.parentNode) {
                    clone.parentNode.replaceChild(span, clone);
                }
            }
        }

        // ==========================================
        // ë©€í‹° ì…€ë ‰íŠ¸ (Multi-Select) í—¬í¼ í•¨ìˆ˜ë“¤
        // ==========================================
        const multiSelectState = {
            checklistStageFilter: ['all'],
            checklistCategoryFilter: ['all']
        };

        // ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initMultiSelect(elementId, options) {
            const dropdown = document.getElementById(elementId + 'Dropdown');
            if (!dropdown) return;

            // ê¸°ì¡´ ìƒíƒœ ìœ ì§€í•˜ë©´ì„œ ì˜µì…˜ ì¬ìƒì„±
            const currentState = multiSelectState[elementId];

            let html = '';
            // ì „ì²´ ë³´ê¸° í•­ëª©
            const isAllChecked = currentState.includes('all');
            html += `<div class="multi-select-option">
                        <label>
                            <input type="checkbox" value="all" ${isAllChecked ? 'checked' : ''} onchange="handleMultiSelectChange('${elementId}', this)">
                            ì „ì²´ ë³´ê¸°
                        </label>
                     </div>`;

            // ê°œë³„ í•­ëª©ë“¤
            options.forEach(opt => {
                const isChecked = currentState.includes(opt);
                html += `<div class="multi-select-option">
                            <label>
                                <input type="checkbox" value="${opt}" ${isChecked ? 'checked' : ''} onchange="handleMultiSelectChange('${elementId}', this)">
                                ${opt}
                            </label>
                         </div>`;
            });

            dropdown.innerHTML = html;
            updateMultiSelectLabel(elementId);
        }

        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì²˜ë¦¬
        function handleMultiSelectChange(elementId, input) {
            const value = input.value;
            const isChecked = input.checked;
            const checkboxes = document.querySelectorAll(`#${elementId}Dropdown input[type="checkbox"]`);

            if (value === 'all') {
                if (isChecked) {
                    // ì „ì²´ ì„ íƒ ì‹œ -> ë‚˜ë¨¸ì§€ í•´ì œ
                    checkboxes.forEach(cb => {
                        if (cb.value !== 'all') cb.checked = false;
                    });
                    multiSelectState[elementId] = ['all'];
                } else {
                    // ì „ì²´ í•´ì œ ì‹œ -> ë¹ˆ ìƒíƒœ (í—ˆìš©)
                    multiSelectState[elementId] = [];
                }
            } else {
                // ê°œë³„ ì„ íƒ ì‹œ
                if (isChecked) {
                    // ì „ì²´ ì²´í¬ë°•ìŠ¤ í•´ì œ
                    const allCb = document.querySelector(`#${elementId}Dropdown input[value="all"]`);
                    if (allCb) allCb.checked = false;
                }

                // ì²´í¬ëœ í•­ëª©ë“¤ ìˆ˜ì§‘
                const selected = [];
                checkboxes.forEach(cb => {
                    if (cb.value !== 'all' && cb.checked) {
                        selected.push(cb.value);
                    }
                });

                if (selected.length === 0) {
                    // ëª¨ë‘ í•´ì œë˜ë©´ ìë™ìœ¼ë¡œ 'ì „ì²´'ë¡œ ë³µê·€
                    const allCb = document.querySelector(`#${elementId}Dropdown input[value="all"]`);
                    if (allCb) allCb.checked = true;
                    multiSelectState[elementId] = ['all'];
                } else {
                    multiSelectState[elementId] = selected;
                }
            }

            updateMultiSelectLabel(elementId);

            // [ì¶”ê°€] ì§„í–‰ë‹¨ê³„ í•„í„°ê°€ ë³€ê²½ë˜ë©´ ì¹´í…Œê³ ë¦¬ í•„í„° ì˜µì…˜ì„ ê°±ì‹  (Dependent Dropdown)
            if (elementId === 'checklistStageFilter') {
                updateCategoryOptionsBasedOnStage();
            }

            renderChecklistItems();
        }

        // [ì¶”ê°€] ì§„í–‰ë‹¨ê³„ ì„ íƒì— ë”°ë¥¸ ì¹´í…Œê³ ë¦¬ í•„í„° ì˜µì…˜ ê°±ì‹ 
        function updateCategoryOptionsBasedOnStage() {
            const selectedStages = multiSelectState['checklistStageFilter'];
            console.log('[Filter Logic] Selected Stages:', selectedStages);

            if (!checklistMasterData || checklistMasterData.length === 0) {
                console.warn('[Filter Logic] No master data available for filtering');
                return;
            }

            let validCategories = [];

            if (selectedStages.includes('all') || selectedStages.length === 0) {
                // ì „ì²´ ì„ íƒ ì‹œ -> ëª¨ë“  ì¹´í…Œê³ ë¦¬ í‘œì‹œ
                validCategories = [...new Set(checklistMasterData.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            } else {
                // íŠ¹ì • ë‹¨ê³„ ì„ íƒ ì‹œ -> í•´ë‹¹ ë‹¨ê³„ì— í¬í•¨ëœ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ì¶œ
                const filteredItems = checklistMasterData.filter(item => {
                    const itemStage = (item.ì§„í–‰ë‹¨ê³„ || '').trim();
                    // selectedStages could have untrimmed values if init was untrimmed, but typically they match.
                    // To be safe, we rely on exact values from options. 
                    // But here we just used item.ì§„í–‰ë‹¨ê³„ to build options, so it should match.
                    return selectedStages.some(stage => stage === item.ì§„í–‰ë‹¨ê³„ || stage === itemStage);
                });
                validCategories = [...new Set(filteredItems.map(item => (item.category || '').trim()).filter(Boolean))].sort();
            }

            console.log('[Filter Logic] Valid Categories:', validCategories);

            // ê¸°ì¡´ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì¤‘ ìœ íš¨í•˜ì§€ ì•Šì€ ê²ƒì€ ì œê±° (UX ê°œì„ )
            const currentCategoryState = multiSelectState['checklistCategoryFilter'];

            if (!currentCategoryState.includes('all')) {
                const newCategoryState = currentCategoryState.filter(cat => validCategories.includes(cat));
                // í•˜ë‚˜ë„ ì—†ìœ¼ë©´ 'all'ë¡œ ë¦¬ì…‹
                multiSelectState['checklistCategoryFilter'] = newCategoryState.length > 0 ? newCategoryState : ['all'];
            } else {
                // If it was 'all', keep it 'all' unless validCategories is empty? 
                // 'all' is always valid if validCategories has items.
            }

            // ì¹´í…Œê³ ë¦¬ í•„í„° ì˜µì…˜ ì¬ìƒì„±
            initMultiSelect('checklistCategoryFilter', validCategories);
        }

        // ë¼ë²¨ ì—…ë°ì´íŠ¸
        function updateMultiSelectLabel(elementId) {
            const label = document.getElementById(elementId + 'Label');
            if (!label) return;

            const state = multiSelectState[elementId];
            if (state.includes('all') || state.length === 0) {
                label.innerText = 'ì „ì²´ ë³´ê¸°';
                label.style.fontWeight = 'normal';
                label.style.color = 'inherit';
            } else {
                // ì„ íƒëœ í•­ëª© ì´ë¦„ í‘œì‹œ (ë„ˆë¬´ ê¸¸ë©´ ì¤„ì„)
                let text = state.join(', ');
                if (text.length > 20) {
                    text = state[0] + (state.length > 1 ? ` ì™¸ ${state.length - 1}ê°œ` : '');
                }
                label.innerText = text;
                label.style.fontWeight = '600';
                label.style.color = '#0071e3';
            }
        }

        // ë“œë¡­ë‹¤ìš´ í† ê¸€
        function toggleMultiSelect(elementId, event) {
            // [Fix] ë“œë¡­ë‹¤ìš´ ë‚´ë¶€ í´ë¦­ ì‹œ ë‹«íˆì§€ ì•Šë„ë¡ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
            if (event && event.target.closest('.multi-select-dropdown')) return;

            const dropdown = document.getElementById(elementId + 'Dropdown');
            if (!dropdown) return;

            const isVisible = dropdown.style.display === 'block';

            // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.querySelectorAll('.multi-select-dropdown').forEach(d => {
                if (d.id !== elementId + 'Dropdown') d.style.display = 'none';
            });

            dropdown.style.display = isVisible ? 'none' : 'block';

            // [Fix] ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€ (í•„ìš” ì‹œ)
            if (event) event.stopPropagation();
        }

        function getMultiSelectValues(elementId) {
            const val = multiSelectState[elementId];
            if (!val || val.length === 0) return ['all'];
            return val;
        }

        // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.multi-select-wrapper')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(d => {
                    d.style.display = 'none';
                });
            }
        });

        // ============================
        // [ì‹ ê·œ] í˜„í™© ë° ì‘ì—…ê¸°ë¡ (System Action Log)
        // ============================
        // ì„œë²„ ì—°ë™ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë¨

        // ë¡œê·¸ ê¸°ë¡ í•¨ìˆ˜ (ì„œë²„ ì „ì†¡)
        async function logUserAction(actionType, detailText) {
            const adminId = (currentAdmin && currentAdmin.id) ? currentAdmin.id : 'unknown';

            // UIì— ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´ ë¡œì»¬ í˜¸ì¶œ (ì„ íƒì )
            // renderAuditLog(); // ì„œë²„ì—ì„œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ì •í™•í•¨

            try {
                // ë¹„ë™ê¸° ì „ì†¡ (ê²°ê³¼ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ)
                fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'logUserAction',
                        adminId: adminId,
                        actionType: actionType,
                        detail: detailText
                    })
                }).then(res => res.json())
                    .then(data => {
                        console.log('Log saved:', data);
                        // í˜„ì¬ ì‘ì—…ê¸°ë¡ íƒ­ì„ ë³´ê³  ìˆë‹¤ë©´ ê°±ì‹ 
                        if (document.getElementById('panel-stats') &&
                            (document.getElementById('panel-stats').style.display === 'block' ||
                                document.getElementById('panel-stats').classList.contains('active'))) {
                            renderActionLog();
                        }
                    })
                    .catch(err => console.error('Log save error:', err));
            } catch (e) {
                console.error('Log error:', e);
            }
        }

        // [ì‹ ê·œ] ë¡œê·¸ ìƒì„¸ë‚´ìš© í¬ë§·í„°
        function formatLogDetail(detail) {
            if (!detail) return '';
            let parsed = null;
            let isJson = false;

            if (typeof detail === 'string' && detail.trim().startsWith('{')) {
                try {
                    parsed = JSON.parse(detail);
                    isJson = true;
                } catch (e) { }
            }

            if (isJson && parsed) {
                // {type:"ExcelExport", scope:"single", customerName:"..."}
                if (parsed.type === 'ExcelExport') {
                    const scope = (parsed.scope === 'single' || parsed.scope === 'current') ? '1ëª… ê³ ê°' : 'ì „ì²´ ê³ ê°';
                    const name = parsed.customerName ? ` Â· ${parsed.customerName}` : '';
                    return `Excel ë‚´ë³´ë‚´ê¸° Â· ${scope}${name}`;
                }
                // {module:"expenses", action:"load"}
                if (parsed.module) {
                    const modName = parsed.module === 'expenses' ? 'ìš´ì˜ë¹„ ì‹œíŠ¸' : (parsed.module === 'fixed' ? 'ê³ ì •ì§€ì¶œ ì„¤ì •' : parsed.module);
                    const actName = parsed.action === 'load' ? 'ë¶ˆëŸ¬ì˜¤ê¸°' : (parsed.action === 'save' ? 'ì €ì¥' : parsed.action);
                    return `${modName} ${actName}`;
                }
                // Fallback
                return Object.entries(parsed).map(([k, v]) => `${k}:${v}`).join(' Â· ');
            }

            // Plain text (Truncate)
            let str = String(detail);
            return str.length > 200 ? str.slice(0, 200) + '...' : str;
        }

        // ë¡œê·¸ ë Œë”ë§ í•¨ìˆ˜ (ì„œë²„ ì¡°íšŒ)
        async function renderActionLog(targetId) {
            const reqId = targetId || currentCustomerId;
            let tbody = document.getElementById('auditLogTableBody');

            if (!tbody) {
                const panel = document.getElementById('panel-stats');
                if (panel) {
                    const tbl = panel.querySelector('tbody');
                    if (tbl) tbody = tbl;
                }
            }

            if (!tbody) return;

            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">ë¡œë”© ì¤‘...</td></tr>';

            try {
                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=action_log&action=getLogs`);
                const result = await response.json();

                // [Guard] Check if customer changed during fetch
                if (reqId && reqId !== currentCustomerId) return;

                if (result.success && result.logs) {
                    if (result.logs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">í¸ì§‘ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                        return;
                    }

                    // ìµœê·¼ 200ê±´ ì œí•œ
                    const displayLogs = result.logs.slice(0, 200);

                    let html = '';
                    displayLogs.forEach(log => {
                        const formattedDetail = formatLogDetail(log.detail);
                        html += `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 8px 10px; color:#666; font-size:12px; white-space:nowrap;">${log.timestamp}</td>
                                <td style="padding: 8px 10px; font-weight:600; font-size:12px; color:#0071e3;">${log.adminId}</td>
                                <td style="padding: 8px 10px; color:#333; font-size:12px;">
                                    <span style="font-weight:600; color:#1d1d1f; margin-right:4px;">[${log.actionType}]</span>
                                    ${formattedDetail}
                                </td>
                            </tr>
                        `;
                    });
                    tbody.innerHTML = html;

                    // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
                    const countEl = document.getElementById('logEditCount');
                    if (countEl) countEl.textContent = result.logs.length + 'ê±´';

                    const nameEl = document.getElementById('logCustomerName');
                    if (nameEl) nameEl.textContent = 'ì „ì²´ ì‹œìŠ¤í…œ';

                    const statusEl = document.getElementById('logCustomerStatus');
                    if (statusEl) statusEl.textContent = 'Active';

                    const amountEl = document.getElementById('logCustomerAmount');
                    if (amountEl) amountEl.textContent = '-';

                } else {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:red;">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</td></tr>';
                }
            } catch (e) {
                console.error('Log fetch error:', e);
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì•ˆì „í•˜ê²Œ ë©”ì‹œì§€ ì¶œë ¥
                if (tbody) tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">ì˜¤ë¥˜ ë°œìƒ</td></tr>';
            }
        }

        // renderAuditLog (êµ¬ë²„ì „ í˜¸í™˜)
        const renderAuditLog = renderActionLog;


        // ============================
        // [ì‹ ê·œ] ìš´ì˜ë¹„ ê´€ë¦¬ (Operating Expenses) & ë·° ìŠ¤ìœ„ì¹­
        // ============================
        let expensesRows = [];
        let fixedExpenseItems = []; // ê³ ì •ì§€ì¶œ ì„¤ì • í•­ëª©
        const EXPENSE_CATEGORIES = ['ì¸ê±´ë¹„', 'ì°¨ëŸ‰ìš´ì˜ë¹„', 'ì„ëŒ€ë£Œ', 'ìš´ì˜ë¹„', 'ë§ˆì¼€íŒ…/ì˜ì—…', 'ì„¸ê¸ˆ/ê¸ˆìœµ', 'ê¸°íƒ€'];

        // Phase 2: ì´ˆê¸° ë¡œë“œ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê¸ˆì§€)

        // í˜„ì¬ ì›” í•„í„° ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const monthFilter = document.getElementById('expenseMonthFilter');
            if (monthFilter) {
                const now = new Date();
                monthFilter.value = now.toISOString().slice(0, 7); // YYYY-MM
            }
        });

        // ê³ ì •ì§€ì¶œ ì„¤ì • íŒ¨ë„ í† ê¸€
        function toggleFixedExpenseSettings() {
            const panel = document.getElementById('fixedExpenseSettingsPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                if (panel.style.display === 'block') {
                    renderFixedExpenseTable();
                }
            }
        }

        // ê³ ì •ì§€ì¶œ í•­ëª© ì¶”ê°€
        function addFixedExpenseItem() {
            fixedExpenseItems.push({
                category: '',
                detail: '', // í•­ëª©ëª… -> ìƒì„¸ë‚´ì—­
                amount: 0,
                payMethod: '',
                receipt: '', // ì¦ë¹™ìë£Œ ì¶”ê°€
                active: true
            });
            renderFixedExpenseTable();
        }

        // ê³ ì •ì§€ì¶œ í•­ëª© ì‚­ì œ
        function removeFixedExpenseItem(index) {
            fixedExpenseItems.splice(index, 1);
            renderFixedExpenseTable();
        }

        // ê³ ì •ì§€ì¶œ í•­ëª© ìˆ˜ì •
        function updateFixedExpenseItem(index, field, value) {
            if (field === 'active') {
                fixedExpenseItems[index][field] = value;
            } else if (field === 'amount') {
                fixedExpenseItems[index][field] = parseNumber(value);
            } else {
                fixedExpenseItems[index][field] = value;
            }
        }

        // ê³ ì •ì§€ì¶œ ì„¤ì • í…Œì´ë¸” ë Œë”ë§
        function renderFixedExpenseTable() {
            const tbody = document.getElementById('fixedExpenseTableBody');
            if (!tbody) return;

            tbody.innerHTML = fixedExpenseItems.map((item, index) => `
                <tr>
                    <td style="text-align:center; padding:8px;">
                        <button onclick="removeFixedExpenseItem(${index})" style="color:#dc2626; border:none; background:none; cursor:pointer; font-size:14px;">ğŸ—‘ï¸</button>
                    </td>
                    <td style="padding:4px;">
                        <select onchange="updateFixedExpenseItem(${index}, 'category', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;">
                            <option value="">ì„ íƒ</option>
                            ${EXPENSE_CATEGORIES.map(c => `<option value="${c}" ${c === item.category ? 'selected' : ''}>${c}</option>`).join('')}
                        </select>
                    </td>
                    <td style="padding:4px;"><input type="text" value="${item.detail || item.itemName || ''}" onchange="updateFixedExpenseItem(${index}, 'detail', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px;"><input type="text" value="${formatNumber(item.amount)}" onchange="updateFixedExpenseItem(${index}, 'amount', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px; text-align:right;"></td>
                    <td style="padding:4px;"><input type="text" value="${item.payMethod || ''}" onchange="updateFixedExpenseItem(${index}, 'payMethod', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px;"><input type="text" value="${item.receipt || ''}" onchange="updateFixedExpenseItem(${index}, 'receipt', this.value)" style="width:100%; padding:6px; border:1px solid #fcd34d; border-radius:4px;"></td>
                    <td style="padding:4px; text-align:center;">
                        <input type="checkbox" ${item.active ? 'checked' : ''} onchange="updateFixedExpenseItem(${index}, 'active', this.checked)" style="width:18px; height:18px; cursor:pointer;">
                    </td>
                </tr>
            `).join('');
        }

        // ê³ ì •ì§€ì¶œ ì €ì¥ (í´ë¼ìš°ë“œ)
        async function saveFixedExpensesToCloud() {
            const btn = document.getElementById('btnSaveFixed');
            const originalText = btn?.innerText || 'ğŸ’¾ ì €ì¥';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'ì €ì¥ ì¤‘...';
                }

                const payload = {
                    action: 'updateExpenses',
                    fixedExpenses: fixedExpenseItems.map(item => ({
                        category: item.category || '',
                        detail: item.detail || item.itemName || '',
                        amount: parseNumber(item.amount),
                        payMethod: item.payMethod || '',
                        receipt: item.receipt || '',
                        active: item.active !== false
                    }))
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    // ë¡œì»¬ì—ë„ ì €ì¥
                    // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    showToast(`ì €ì¥ ì™„ë£Œ ${timeStr}`, 'success');
                    renderExpensesTable();
                    logUserAction('ì €ì¥', 'ê³ ì •ì§€ì¶œ ì„¤ì • ì €ì¥');
                } else {
                    throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error('ê³ ì •ì§€ì¶œ ì €ì¥ ì˜¤ë¥˜:', err);
                showToast('ì €ì¥ ì‹¤íŒ¨: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        // ê³ ì •ì§€ì¶œ ë¶ˆëŸ¬ì˜¤ê¸° (í´ë¼ìš°ë“œ)
        async function loadFixedExpensesFromCloud() {
            const btn = document.getElementById('btnLoadFixed');
            const originalText = btn?.innerText || 'ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                }

                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=expenses`);
                const result = await response.json();

                if (result.result === 'success') {
                    // ê³ ì •ì§€ì¶œ ë°ì´í„°ë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
                    if (result.fixedExpenses && result.fixedExpenses.length > 0) {
                        fixedExpenseItems = result.fixedExpenses.map(f => ({
                            category: f.category || '',
                            detail: f.detail || f.itemName || '',
                            amount: f.amount || 0,
                            payMethod: f.payMethod || '',
                            receipt: f.receipt || '',
                            active: f.active !== false
                        }));
                        // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€

                        renderFixedExpenseTable();
                        renderExpensesTable();
                        showToast(`ê³ ì •ì§€ì¶œ ${result.fixedExpenses.length}ê±´ ë¶ˆëŸ¬ì˜´`, 'success');
                        logUserAction('ë¶ˆëŸ¬ì˜¤ê¸°', 'ê³ ì •ì§€ì¶œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°');
                    } else {
                        showToast('ì €ì¥ëœ ê³ ì •ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    }
                } else {
                    throw new Error(result.error || 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error('ê³ ì •ì§€ì¶œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);
                showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message, 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        function showMainView(viewName) {
            const mainContent = document.getElementById('mainContent');
            const mainBoardView = document.getElementById('mainBoardView');
            const customerView = document.getElementById('customerView');
            const expensesView = document.getElementById('view-expenses');

            // ì´ˆê¸°í™” - ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            if (mainBoardView) mainBoardView.style.display = 'none';
            if (customerView) customerView.style.display = 'none';
            if (expensesView) expensesView.style.display = 'none';

            if (viewName === 'expenses') {
                if (expensesView) expensesView.style.display = 'block';
                // ì‚¬ì´ë“œë°” ì„ íƒ í•´ì œ
                document.querySelectorAll('.customer-item').forEach(el => el.classList.remove('active'));
                renderExpensesTable();
            } else if (viewName === 'customer') {
                if (customerView) customerView.style.display = 'block';
            } else {
                // Default: Main Board
                if (mainBoardView) {
                    mainBoardView.style.display = 'block';
                    if (typeof renderMainBoard === 'function') renderMainBoard();
                }
            }
        }

        function renderExpensesTable() {
            const tbody = document.getElementById('expensesTableBody');
            if (!tbody) return;

            // í˜„ì¬ ì„ íƒëœ ì›” ê°€ì ¸ì˜¤ê¸°
            const monthFilter = document.getElementById('expenseMonthFilter');
            const selectedMonth = monthFilter?.value || new Date().toISOString().slice(0, 7);

            let fixedTotal = 0;
            let variableTotal = 0;
            let rows = [];

            // 1. í™œì„±í™”ëœ ê³ ì •ì§€ì¶œ í•­ëª©ì„ í–‰ìœ¼ë¡œ ì¶”ê°€ (ì½ê¸° ì „ìš©)
            const activeFixed = fixedExpenseItems.filter(f => f.active);
            activeFixed.forEach((item, idx) => {
                const amt = parseNumber(item.amount);
                fixedTotal += amt;
                const detailText = item.detail || item.itemName || '-';
                rows.push(`
                    <tr style="border-bottom:1px solid #fcd34d; background:linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);">
                        <td style="text-align:center; padding:10px; color:#92400e; font-weight:600;">
                            ${idx + 1}
                        </td>
                        <td style="padding:8px;">
                            <span style="color:#92400e; font-size:12px;">${selectedMonth}-01</span>
                        </td>
                        <td style="padding:8px;">
                            <span style="background:#f59e0b; color:white; padding:2px 8px; border-radius:4px; font-size:11px; font-weight:600;">${item.category || '-'}</span>
                        </td>
                        <td style="padding:8px;">
                            <span style="color:#92400e; font-weight:600;">${detailText}</span>
                            <span style="font-size:10px; color:#d97706; margin-left:6px; background:#fef3c7; padding:2px 6px; border-radius:10px;">ê³ ì •ì§€ì¶œ</span>
                        </td>
                        <td style="padding:8px; text-align:right; font-weight:700; color:#92400e;">${formatNumber(amt)}</td>
                        <td style="padding:8px; color:#92400e;">${item.payMethod || '-'}</td>
                        <td style="padding:8px; color:#92400e;">${item.receipt || '-'}</td>
                        <td style="padding:8px; color:#92400e; font-size:11px;">ë§¤ì›” ìë™ ë°˜ì˜</td>
                    </tr>
                `);
            });

            // 2. ë³€ë™ì§€ì¶œ í•­ëª© (ì„ íƒëœ ì›”ê³¼ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ)
            expensesRows.forEach((row, index) => {
                const rowMonth = (row.date || '').substring(0, 7);
                if (rowMonth !== selectedMonth && selectedMonth !== 'all') return;

                const amt = parseNumber(row.amount);
                variableTotal += amt;
                rows.push(`
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="text-align:center; padding:10px;">
                            <button onclick="removeExpenseRow(${index})" style="color:#ff3b30;border:none;background:none;cursor:pointer;">ğŸ—‘ï¸</button>
                            ${activeFixed.length + index + 1}
                        </td>
                        <td style="padding:4px;"><input type="date" value="${row.date || ''}" onchange="updateExpenseRow(${index}, 'date', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;">
                            <select onchange="updateExpenseRow(${index}, 'category', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;">
                                <option value="">ì„ íƒ</option>
                                ${EXPENSE_CATEGORIES.map(c => `<option value="${c}" ${c === row.category ? 'selected' : ''}>${c}</option>`).join('')}
                            </select>
                        </td>
                        <td style="padding:4px;"><input type="text" value="${row.detail || ''}" onchange="updateExpenseRow(${index}, 'detail', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${formatNumber(row.amount)}" onchange="updateExpenseRow(${index}, 'amount', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px; text-align:right;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.method || row.payMethod || ''}" onchange="updateExpenseRow(${index}, 'method', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.proof || row.receipt || ''}" onchange="updateExpenseRow(${index}, 'proof', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                        <td style="padding:4px;"><input type="text" value="${row.note || row.memo || ''}" onchange="updateExpenseRow(${index}, 'note', this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td>
                    </tr>
                `);
            });

            tbody.innerHTML = rows.join('');

            // í•©ê³„ í‘œì‹œ (ê³ ì • + ë³€ë™)
            const totalAmount = fixedTotal + variableTotal;
            const footer = document.getElementById('totalExpenseFooter');
            if (footer) {
                footer.innerHTML = `
                    <span style="font-size:12px; color:#64748b; margin-right:12px;">
                        ê³ ì •: â‚©${formatNumber(fixedTotal)} / ë³€ë™: â‚©${formatNumber(variableTotal)}
                    </span>
                    <span style="color:#dc2626; font-weight:700; font-size:16px;">â‚©${formatNumber(totalAmount)}</span>
                `;
            }
        }

        function addExpenseRow() {
            expensesRows.push({
                date: new Date().toISOString().split('T')[0],
                category: '',
                detail: '',
                amount: 0,
                method: '',
                proof: '',
                note: ''
            });
            renderExpensesTable();
            saveExpensesLocal();
        }

        function removeExpenseRow(index) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            expensesRows.splice(index, 1);
            renderExpensesTable();
            saveExpensesLocal();
        }

        function updateExpenseRow(index, field, value) {
            if (field === 'amount') {
                // ì½¤ë§ˆ ì œê±° í›„ ìˆ«ì ì €ì¥
                value = parseNumber(value);
            }
            expensesRows[index][field] = value;
            if (field === 'amount') renderExpensesTable();
            saveExpensesLocal();
        }

        function saveExpensesLocal() {
            // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€
        }

        async function saveExpensesToCloud() {
            const btn = document.getElementById('btnSaveExpenses') || event?.target;
            const originalText = btn?.innerText || 'â˜ï¸ ì €ì¥í•˜ê¸°';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'ì €ì¥ ì¤‘...';
                }

                const payload = {
                    action: 'updateExpenses',
                    expenses: expensesRows.map((row, idx) => ({
                        no: idx + 1,
                        date: row.date || '',
                        category: row.category || '',
                        detail: row.detail || '',
                        amount: parseNumber(row.amount),
                        payMethod: row.payMethod || row.method || '',
                        receipt: row.receipt || row.proof || '',
                        memo: row.memo || row.note || ''
                    }))
                };

                const response = await fetch(CUSTOMER_SYNC_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.result === 'success') {
                    saveExpensesLocal(); // ë¡œì»¬ì—ë„ ì €ì¥
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    showToast(`ì €ì¥ ì™„ë£Œ ${timeStr}`, 'success');
                    logUserAction('ì €ì¥', 'ìš´ì˜ë¹„ ì‹œíŠ¸ ì €ì¥');
                } else {
                    throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error('ìš´ì˜ë¹„ ì €ì¥ ì˜¤ë¥˜:', err);
                showToast('ì €ì¥ ì‹¤íŒ¨: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                saveExpensesLocal(); // ì‹¤íŒ¨í•´ë„ ë¡œì»¬ì—ëŠ” ì €ì¥
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }

        async function syncExpensesFromCloud() {
            const btn = document.getElementById('btnLoadExpenses') || event?.target;
            const originalText = btn?.innerText || 'ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°';

            try {
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                }

                const response = await fetch(`${CUSTOMER_SYNC_URL}?sheet=expenses`);
                const result = await response.json();

                console.log('[ìš´ì˜ë¹„ ë¶ˆëŸ¬ì˜¤ê¸°] API ì‘ë‹µ:', result);

                if (result.result === 'success') {
                    let loadedCount = 0;

                    // ë³€ë™ ìš´ì˜ë¹„ ë¶ˆëŸ¬ì˜¤ê¸°
                    if (result.expenses && result.expenses.length > 0) {
                        expensesRows = result.expenses.map(exp => ({
                            date: exp.date || '',
                            category: exp.category || '',
                            detail: exp.detail || '',
                            amount: exp.amount || 0,
                            method: exp.payMethod || '',
                            proof: exp.receipt || '',
                            note: exp.memo || ''
                        }));
                        saveExpensesLocal();
                        loadedCount = result.expenses.length;
                    }

                    // ê³ ì •ì§€ì¶œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
                    if (result.fixedExpenses && result.fixedExpenses.length > 0) {
                        fixedExpenseItems = result.fixedExpenses.map(f => ({
                            category: f.category || '',
                            detail: f.detail || f.itemName || '',
                            amount: f.amount || 0,
                            payMethod: f.payMethod || '',
                            receipt: f.receipt || '',
                            active: f.active !== false
                        }));
                        // Phase 2: ì—…ë¬´ ë°ì´í„° ë¡œì»¬ ì €ì¥ ê¸ˆì§€

                    }

                    renderExpensesTable();
                    renderFixedExpenseTable();

                    const fixedCount = result.fixedExpenses?.length || 0;
                    if (loadedCount > 0 || fixedCount > 0) {
                        showToast(`ìš´ì˜ë¹„ ${loadedCount}ê±´, ê³ ì •ì§€ì¶œ ${fixedCount}ê±´ ë¶ˆëŸ¬ì˜´`, 'success');
                        logUserAction('ë¶ˆëŸ¬ì˜¤ê¸°', 'ìš´ì˜ë¹„ ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°');
                    } else {
                        showToast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    }
                    return true;
                } else {
                    throw new Error(result.error || 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                }
            } catch (err) {
                console.error('ìš´ì˜ë¹„ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);
                console.error('API URL:', `${CUSTOMER_SYNC_URL}?sheet=expenses`);
                showToast('ìš´ì˜ë¹„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message, 'error');
                return false;
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        }


        function switchStatsTab(tabName) {
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.stats-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'white';
                btn.style.color = '#888';
            });
            const activeBtn = document.getElementById('tab-' + tabName);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = '#f5f5f7';
                activeBtn.style.color = '#333';
            }

            // ë·° ì „í™˜
            document.querySelectorAll('.stats-view-content').forEach(view => view.style.display = 'none');
            const targetView = document.getElementById('view-stats-' + tabName);
            if (targetView) {
                targetView.style.display = 'block';
            }

            // ì°¨íŠ¸ í¬ê¸° ê°•ì œ ì¬ì¡°ì •
            if (typeof Chart !== 'undefined') {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') chart.resize();
                });
            }
        }

    </script>
    <script>
        // [ì¶”ê°€] íƒ­ ì „í™˜ ê°ì§€ ë° ì‘ì—…ê¸°ë¡ ê°±ì‹  (MutationObserver)
        document.addEventListener('DOMContentLoaded', () => {
            const statsPanel = document.getElementById('panel-stats');
            if (statsPanel) {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'class') {
                            if (statsPanel.classList.contains('active')) {
                                renderActionLog();
                            }
                        }
                        if (mutation.attributeName === 'style') {
                            if (statsPanel.style.display === 'block' && statsPanel.style.display !== 'none') {
                                renderActionLog();
                            }
                        }
                    });
                });
                observer.observe(statsPanel, { attributes: true });
            }
        });
    </script>



    <script>


        // [Task 3] Stability Logic
        let isAppBusy = false;
        function setAppBusy(busy, message = 'ë°ì´í„° ì²˜ë¦¬ ì¤‘...') {
            isAppBusy = busy;
            let overlay = document.getElementById('globalLoadingOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'globalLoadingOverlay';
                overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:99999; flex-direction:column; justify-content:center; align-items:center;';
                overlay.innerHTML = '<div style="width:50px; height:50px; border:5px solid #f3f3f3; border-top:5px solid #3498db; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:15px;"></div><div id="loadingMessage" style="font-size:18px; font-weight:600; color:#333;">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</div><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>';
                document.body.appendChild(overlay);
            }
            const msgEl = overlay.querySelector('#loadingMessage');
            if (msgEl) msgEl.textContent = message;
            overlay.style.display = busy ? 'flex' : 'none';
            document.body.style.pointerEvents = busy ? 'none' : 'auto';
            if (overlay) overlay.style.pointerEvents = 'auto';
        }
    </script>
    <script>
        // PWA Service Worker ë“±ë¡
        // PWA Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // ==========================================
        // [New] ë…¸ì…˜ ê³ ê° ê³µìœ  URL ìƒì„±
        // ==========================================
        function openNotionShareModal() {
            if (!currentData || !currentData.customerId) {
                showToast('ê³ ê°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // Modal HTML Injection (Lazy Load)
            if (!document.getElementById('notionShareModal')) {
                const modalHtml = `
                <div id="notionShareModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center;">
                    <div class="modal-content" style="background:#fff; border-radius:16px; width:90%; max-width:500px; max-height:80vh; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.2);">
                        <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:18px; font-weight:700;">ğŸ“‹ ë…¸ì…˜ ê³ ê° ê³µìœ </h3>
                            <button onclick="document.getElementById('notionShareModal').style.display='none'" style="background:#f0f0f0; border:none; width:32px; height:32px; border-radius:50%; font-size:20px; cursor:pointer;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <label style="font-weight:600; font-size:14px; display:block; margin-bottom:8px;">ë…¸ì…˜ ê³µìœ  URL</label>
                            <input type="text" id="notionShareUrlInput" placeholder="https://notion.site/..." style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;">
                            <p style="font-size:12px; color:#666; margin-top:8px;">ë…¸ì…˜ í˜ì´ì§€ì˜ ê³µìœ  URLì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                        </div>
                        <div style="padding:20px; border-top:1px solid #eee; display:flex; gap:10px; justify-content:flex-end;">
                            <button onclick="document.getElementById('notionShareModal').style.display='none'" style="padding:10px 20px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;">ì·¨ì†Œ</button>
                            <button onclick="generateNotionShareMessage()" style="padding:10px 20px; border:none; background:linear-gradient(135deg, #0071e3 0%, #005bb5 100%); color:#fff; border-radius:8px; cursor:pointer; font-weight:600;">ìƒì„±í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
                <div id="notionShareResultModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10001; justify-content:center; align-items:center;">
                    <div class="modal-content" style="background:#fff; border-radius:16px; width:90%; max-width:600px; max-height:80vh; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.2);">
                        <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:18px; font-weight:700;">ğŸ“‹ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë©”ì‹œì§€</h3>
                            <button onclick="document.getElementById('notionShareResultModal').style.display='none'" style="background:#f0f0f0; border:none; width:32px; height:32px; border-radius:50%; font-size:20px; cursor:pointer;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <textarea id="notionShareResultText" readonly style="width:100%; height:300px; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:13px; line-height:1.6; resize:none; box-sizing:border-box; font-family:'Noto Sans KR', sans-serif;"></textarea>
                        </div>
                        <div style="padding:20px; border-top:1px solid #eee; display:flex; gap:10px; justify-content:flex-end;">
                            <button onclick="document.getElementById('notionShareResultModal').style.display='none'" style="padding:10px 20px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;">ë‹«ê¸°</button>
                            <button onclick="copyNotionShareMessage()" style="padding:10px 20px; border:none; background:linear-gradient(135deg, #34c759 0%, #2da44e 100%); color:#fff; border-radius:8px; cursor:pointer; font-weight:600;">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                    </div>
                </div>`;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            document.getElementById('notionShareUrlInput').value = '';
            document.getElementById('notionShareModal').style.display = 'flex';
        }

        function generateNotionShareMessage() {
            const notionUrl = document.getElementById('notionShareUrlInput').value.trim();
            if (!notionUrl) {
                showToast('ë…¸ì…˜ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ê³ ê° ì •ë³´ ìˆ˜ì§‘
            const customerName = currentData.customerName || '';
            const customerPhone = currentData.phone || '';
            const spouseName = currentData.spouseName || '';
            const spousePhone = currentData.spousePhone || '';
            const siteAddress = currentData.siteAddress || '';
            const constructionStart = currentData.constructionStart || '';
            const constructionEnd = currentData.constructionEnd || '';
            const movingDate = currentData.movingDate || '';
            const gatePw = currentData.gatePw || '';
            const doorPw = currentData.doorPw || '';

            // ê³ ê°ëª… í‘œì‹œ í˜•ì‹: ì„±ëª…(ì—°ë½ì²˜) | ë°°ìš°ì ì„±ëª…(ë°°ìš°ì ì—°ë½ì²˜)
            let customerDisplayStr = customerName;
            if (customerPhone) customerDisplayStr += `(${customerPhone})`;
            if (spouseName) {
                customerDisplayStr += ` | ${spouseName}`;
                if (spousePhone) customerDisplayStr += `(${spousePhone})`;
            }

            // ê³µì‚¬ê¸°ê°„ í‘œì‹œ
            let periodStr = '';
            if (constructionStart && constructionEnd) {
                periodStr = `${constructionStart} ~ ${constructionEnd}`;
            } else if (constructionStart) {
                periodStr = constructionStart;
            }

            // í”„ë¡ì‹œ URL ìƒì„±
            const encodedName = encodeURIComponent(customerName);
            const encodedUrl = encodeURIComponent(notionUrl);
            const proxyUrl = `https://www.designjig.com/api/notion?name=${encodedName}&url=${encodedUrl}`;

            // í˜„ì¥ ë‹´ë‹¹ì ì •ë³´
            const managerInput = document.querySelector('input[data-field="manager"]');
            const projectManager = managerInput ? managerInput.value : (currentData.manager || 'ì›í”„ë¡œ ì†Œì¥ (010-7653-5386)');

            // ë©”ì‹œì§€ ìƒì„±
            let message = `ì•ˆë…•í•˜ì„¸ìš”. ë””ìì¸ì§€ê·¸ì…ë‹ˆë‹¤.\n\n`;
            message += `ê³µì‚¬ ì§„í–‰ê³¼ ê´€ë ¨í•˜ì—¬ ì•„ë˜ ë‚´ìš© ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n`;
            message += `ê³µì‚¬ ê¸°ê°„ ì¤‘ í•„ìš”í•˜ì‹¤ ë•Œ ì–¸ì œë“  ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ğŸ“Œ ê¸°ë³¸ í˜„ì¥ ì •ë³´\n\n`;
            message += `â€¢ ê³ ê°ëª… : ${customerDisplayStr}\n`;
            message += `â€¢ í˜„ì¥ì£¼ì†Œ : ${siteAddress}\n`;
            message += `â€¢ ê³µì‚¬ê¸°ê°„ : ${periodStr}\n`;
            message += `â€¢ ë¹„ë°€ë²ˆí˜¸\n`;
            message += `  - ê³µë™í˜„ê´€ : ${gatePw || 'ì—†ìŒ'}\n`;
            message += `  - ì„¸ëŒ€í˜„ê´€ : ${doorPw || 'ì—†ìŒ'}\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ğŸ‘· í˜„ì¥ ë‹´ë‹¹ì\n\n`;
            message += `â€¢ í˜„ì¥ì†Œì¥ : ${projectManager}\n`;
            message += `â€¢ ì—°ë½ê°€ëŠ¥ : í‰ì¼ 09:00~17:00\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ğŸ“‹ ê³µì‚¬ ì•ˆë‚´ë¬¸ (ë…¸ì…˜)\n\n`;
            message += `ê³µì‚¬ ìŠ¤ì¼€ì¤„ / ì²´í¬ë¦¬ìŠ¤íŠ¸ / ìì¬ ì •ë³´ / A/S / FAQ ì•ˆë‚´ë¥¼\n`;
            message += `í•œ ë²ˆì— í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n`;
            message += `ğŸ‘‰ ë°”ë¡œê°€ê¸°\n${proxyUrl}\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ğŸ  ë””ìì¸ì§€ê·¸ ê³µì‹ ì±„ë„\n\n`;
            message += `â€¢ í™ˆí˜ì´ì§€\nhttps://www.designjig.com\n\n`;
            message += `â€¢ ë¸”ë¡œê·¸\nhttps://blog.naver.com/sweet00700\n\n`;
            message += `â€¢ ì¹´í˜\nhttps://cafe.naver.com/supermanhome\n\n`;
            message += `â€¢ ì¸ìŠ¤íƒ€ê·¸ë¨\nhttps://www.instagram.com/design__jig\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ë¬¸ì˜ì‚¬í•­ì€ ì–¸ì œë“  í¸í•˜ê²Œ ì—°ë½ ì£¼ì„¸ìš”.\n`;
            message += `ê³µì‚¬ ì§„í–‰ ì¤‘ì—ë„ ì§€ì†ì ìœ¼ë¡œ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n`;
            message += `ê°ì‚¬í•©ë‹ˆë‹¤.\n\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            message += `ë””ìì¸ì§€ê·¸\n`;
            message += `í™”ë ¤í•¨ë³´ë‹¤ ë³¸ì§ˆì„ ì„ íƒí•©ë‹ˆë‹¤.\n`;
            message += `Pro. Beyond.`;

            document.getElementById('notionShareResultText').value = message;
            document.getElementById('notionShareModal').style.display = 'none';
            document.getElementById('notionShareResultModal').style.display = 'flex';
        }

        function copyNotionShareMessage() {
            const text = document.getElementById('notionShareResultText').value;
            navigator.clipboard.writeText(text).then(() => {
                showToast('ğŸ“‹ ë©”ì‹œì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }).catch(err => {
                showToast('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message, 'error');
            });
        }

        // ==========================================
        // [New] Schedule Message Generation
        // ==========================================
        function openScheduleMessageModal() {
            if (!scheduleRows || scheduleRows.length === 0) {
                showToast('ìƒì„±í•  ìŠ¤ì¼€ì¤„ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // Modal HTML Injection (Lazy Load)
            if (!document.getElementById('messageModal')) {
                const modalHtml = `
            <div id="messageModal" class="modal-overlay" style="display:none; z-index: 10000; justify-content: center; align-items: center;">
                <div class="modal-content" style="width: 95%; max-width: 1600px; height: 85vh; display: flex; flex-direction: column; padding: 0; overflow: hidden; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff;">
                        <div>
                            <h3 style="margin: 0; font-size: 18px; font-weight: 700;">ìŠ¤ì¼€ì¤„ ë¬¸ì ë³´ë‚´ê¸°</h3>
                            <span style="font-size: 13px; color: #666; margin-top: 4px; display:block;">ì´ <span id="msgTotalCount" style="color:#000; font-weight:600;">0</span>ëª…ì˜ ë‹´ë‹¹ìì—ê²Œ ë³´ë‚¼ ë©”ì‹œì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                        </div>
                        <button onclick="document.getElementById('messageModal').style.display='none'" style="background: #f0f0f0; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 20px; cursor: pointer; display:flex; align-items:center; justify-content:center;">&times;</button>
                    </div>
                    <div id="messageList" style="padding: 24px; overflow-y: auto; background: #f5f5f7; flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; align-content: start;">
                        <!-- Message Cards will be injected here -->
                    </div>
                    <div style="padding: 14px; font-size: 13px; color: #666; text-align: center; background: #fff; border-top: 1px solid #eee; display:flex; justify-content:center; align-items:center; gap:6px;">
                        <span>ğŸ’¡ ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ë‚´ìš©ì´ ë³µì‚¬ë©ë‹ˆë‹¤.</span>
                    </div>
                </div>
            </div>
        `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            const messageList = document.getElementById('messageList');
            const messages = generateScheduleMessages();

            // Update Total Count
            const countEl = document.getElementById('msgTotalCount');
            if (countEl) countEl.textContent = messages.length;

            if (messages.length === 0) {
                messageList.innerHTML = '<div style="grid-column: 1 / -1; width:100%; display:flex; justify-content:center; align-items:center; color:#999; flex-direction:column; padding: 40px;"><span style="font-size:48px; margin-bottom:16px;">ğŸ“­</span><span>ë‹´ë‹¹ìê°€ ì§€ì •ëœ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</span></div>';
            } else {
                messageList.innerHTML = messages.map(msg => {
                    const isSent = msg.isSent;
                    const cardClass = isSent ? 'message-card copied-card' : 'message-card';
                    const cardStyle = isSent
                        ? 'display: flex; flex-direction: column; background: #f1f8e9; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; outline: 2px solid #4cd964; position: relative; overflow: hidden; height: 100%;'
                        : 'display: flex; flex-direction: column; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; outline: 1px solid transparent; position: relative; overflow: hidden; height: 100%;';
                    const badgeStyle = isSent
                        ? 'font-size: 11px; background: #4cd964; color: #fff; padding: 4px 10px; border-radius: 20px; font-weight: 600; flex-shrink: 0;'
                        : 'font-size: 11px; background: #e8f5e9; color: #2e7d32; padding: 4px 10px; border-radius: 20px; font-weight: 600; flex-shrink: 0;';
                    const badgeText = isSent ? 'ë³µì‚¬ì™„ë£Œ' : 'ë³µì‚¬í•˜ê¸°';

                    return `
            <div class="${cardClass}" onclick="copyMessageToClipboard(this)" 
                data-copytext="${msg.fullText.replace(/"/g, '&quot;')}" 
                data-manager="${msg.manager.replace(/"/g, '&quot;')}"
                style="${cardStyle}">
                
                <div style="padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; background: #fff;">
                    <span style="font-weight: 700; font-size: 16px; color:#1d1d1f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%;">${msg.cardTitle} <span style="font-size:13px; color:#86868b; font-weight:400;">(${msg.count}ê±´)</span></span>
                    <span class="copy-badge" style="${badgeStyle}">${badgeText}</span>
                </div>
                
                <div style="flex: 1; padding: 0; overflow-y: auto; background: #fafafa; min-height: 300px;">
                    <div style="font-size: 13px; color: #333; line-height: 1.6; white-space: pre-wrap; padding: 20px; font-family: 'Menlo', 'Monaco', 'Courier New', monospace;">${msg.previewText}</div>
                </div>

                <div class="hover-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.02); opacity: 0; transition: opacity 0.2s; pointer-events: none;"></div>
            </div>
        `;
                }).join('');
            }

            // Modal Styling Fix (ensure flex display)
            const modal = document.getElementById('messageModal');
            modal.style.display = 'flex';
        }

        function generateScheduleMessages() {
            const grouped = {};

            scheduleRows.forEach(row => {
                if (!row.inCharge || !row.start) return;
                const manager = row.inCharge.trim();
                if (!grouped[manager]) {
                    grouped[manager] = {
                        rows: [],
                        startDates: [],
                        endDates: []
                    };
                }
                grouped[manager].rows.push(row);
                grouped[manager].startDates.push(new Date(row.start));
                if (row.end) grouped[manager].endDates.push(new Date(row.end));
                else grouped[manager].endDates.push(new Date(row.start));
            });

            const results = [];
            const siteAddress = currentData.siteAddress || 'ì£¼ì†Œ ë¯¸ì…ë ¥';

            const gatePwInput = document.querySelector('input[data-field="gatePw"]');
            const doorPwInput = document.querySelector('input[data-field="doorPw"]');
            const gatePw = gatePwInput ? gatePwInput.value : (currentData.gatePw || '');
            const doorPw = doorPwInput ? doorPwInput.value : (currentData.doorPw || '');

            const managerInput = document.querySelector('input[data-field="manager"]');
            const projectManager = managerInput ? managerInput.value : (currentData.manager || 'ì›í”„ë¡œ (010-7653-5386)');

            Object.keys(grouped).forEach(manager => {
                const data = grouped[manager];

                // Sort rows by start date to find the earliest process
                data.rows.sort((a, b) => new Date(a.start) - new Date(b.start));

                // Determine Title
                const earliestProcessName = data.rows[0].name;
                const managerNameOnly = manager.split('(')[0].trim();
                const cardTitle = `${earliestProcessName} - ${managerNameOnly}`;

                // Calculate Overall Range
                const minStart = new Date(Math.min(...data.startDates)).toISOString().split('T')[0];
                const maxEnd = new Date(Math.max(...data.endDates)).toISOString().split('T')[0];

                // Date Logic
                const dateRangeDisplay = (minStart === maxEnd) ? minStart : `${minStart} ~ ${maxEnd}`;

                // Build Process List
                let processSection = "";
                if (data.rows.length > 1) {
                    const processList = data.rows.map(r => {
                        const rStart = r.start;
                        const rEnd = r.end || r.start;
                        const rRange = (rStart === rEnd) ? rStart : `${rStart} ~ ${rEnd}`;
                        return `- ${r.name} : ${rRange}`;
                    }).join('\n');
                    processSection = `\nâ–  ê³µì • ì¼ì •\n${processList}\n`;
                }

                const managerName = managerNameOnly;

                // Determine 'sent' status
                const isSent = data.rows.some(r => r.messageSent === true);

                const fullText = `ì•ˆë…•í•˜ì„¸ìš”.
ë””ìì¸ì§€ê·¸ì…ë‹ˆë‹¤.
í˜„ì¥ ì¼ì • ë° ë‚´ìš©ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
**ì¼ì • í™•ì¸ í›„ ë°˜ë“œì‹œ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.**

â–  ì¼ì •
- ${dateRangeDisplay}
${processSection}
â–  í˜„ì¥ ì£¼ì†Œ
- ${siteAddress}

â–  ì¶œì… ë¹„ë°€ë²ˆí˜¸
- ê³µë™ ì¶œì…ë¬¸ : ${gatePw}
- ì„¸ëŒ€ ë¹„ë°€ë²ˆí˜¸ : ${doorPw}

â–  ê³µì‚¬ ë‹´ë‹¹ì
- ${projectManager}

â–  í˜„ì¥ ì•ˆë‚´ì‚¬í•­
1. ì„¸ëŒ€ ë‚´ í¡ì—° ê¸ˆì§€
2. ì‘ì—…ì‹œê°„ ì¤€ìˆ˜
3. ì‘ì—… í›„ ì •ë¦¬ì •ëˆ
4. ì°½ë¬¸Â·ì¶œì…ë¬¸ ë¬¸ë‹¨ì† í•„ìˆ˜

ê°ì‚¬í•©ë‹ˆë‹¤.
ë””ìì¸ì§€ê·¸ ë“œë¦¼.

ë””ìì¸ì§€ê·¸ëŠ” í™”ë ¤í•¨ë³´ë‹¤ ë³¸ì§ˆì„ ì„ íƒí•©ë‹ˆë‹¤.
í˜„ì¥ì´ í¸í•´ì•¼ ê²°ê³¼ë„ ì¢‹ì•„ì§„ë‹¤ê³  ë¯¿ìŠµë‹ˆë‹¤.
ë””ìì¸ì§€ê·¸ëŠ” ê°ì´ ì•„ë‹Œ ê¸°ì¤€ìœ¼ë¡œ ì¼í•©ë‹ˆë‹¤.`;

                results.push({
                    cardTitle: cardTitle,
                    manager: manager,
                    fullText: fullText,
                    previewText: fullText,
                    count: data.rows.length,
                    isSent: isSent // [New] Pass sent status to UI
                });
            });

            return results;
        }

        function copyMessageToClipboard(element) {
            // Toggle Logic
            if (element.classList.contains('copied-card')) {
                // If already copied/active, revert to normal
                element.classList.remove('copied-card');
                element.style.backgroundColor = '#fff';
                element.style.outline = '1px solid transparent';

                const badge = element.querySelector('.copy-badge');
                if (badge) {
                    badge.style.backgroundColor = '#e8f5e9';
                    badge.style.color = '#2e7d32';
                    badge.textContent = 'ë³µì‚¬í•˜ê¸°';
                }
                return; // Stop here, do not copy again
            }

            // Normal State -> Copy & Activate
            const text = element.getAttribute('data-copytext');
            navigator.clipboard.writeText(text).then(() => {
                showToast('ë¬¸ìê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                // Visual Feedback: Active State (Green)
                element.classList.add('copied-card');
                element.style.backgroundColor = '#f1f8e9'; // Light Green Background
                element.style.outline = '2px solid #4cd964'; // Green Outline

                const badge = element.querySelector('.copy-badge');
                if (badge) {
                    badge.style.backgroundColor = '#4cd964';
                    badge.style.color = '#fff';
                    badge.textContent = 'ë³µì‚¬ì™„ë£Œ';
                }

                // [New] Update Schedule Rows marked as sent
                const manager = element.getAttribute('data-manager');
                if (manager) {
                    let updateCount = 0;
                    scheduleRows.forEach(row => {
                        if (row.inCharge && row.inCharge.trim() === manager) {
                            row.messageSent = true;
                            row.messageSentAt = new Date().toISOString();
                            updateCount++;
                        }
                    });
                    if (updateCount > 0) {
                        saveScheduleToCustomer(); // Persist to currentData in memory
                        console.log(`[Schedule] Marked ${updateCount} rows as sent for manager: ${manager}`);
                    }

                    // [New] Log to Notion Share Sheet (Backend)
                    // ë©”ì‹œì§€ ë³µì‚¬ ì‹œ ìë™ìœ¼ë¡œ ì‹œíŠ¸ì— ì €ì¥
                    fetch(CUSTOMER_SYNC_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'logNotionShare',
                            customerId: currentData.customerId,
                            message: text,
                            manager: manager
                        })
                    }).then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                console.log('Message logged to sheet:', data);
                                showToast('ë©”ì‹œì§€ê°€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                            } else {
                                console.error('Failed to log message:', data.error);
                            }
                        })
                        .catch(err => console.error('Error logging message:', err));
                }

            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }
    </script>
    <script>
        // ë””ë²„ê¹…ìš© ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
        const originalShowToast = window.showToast;
        window.showToast = function (message, type, duration) {
            console.log('showToast í˜¸ì¶œ:', { message, type, duration });
            if (originalShowToast) originalShowToast(message, type, duration);
        };

        document.addEventListener('submit', function (e) {
            console.log('í¼ ì œì¶œ ê°ì§€:', e.target);
            // e.preventDefault(); // ë””ë²„ê¹…ìš©: ì œì¶œ ë§‰ê¸° (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
        });
    </script>
</body>

</html>