<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTFOLIO - 디자인 지그</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* [기본 스타일 및 헤더 고정] */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; color: #1a1a1a; line-height: 1.6; background: #fff; }
        .header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 1.5rem 3rem; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #f0f0f0; }
        .header-container { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
        .logo { font-size: 1.3rem; font-weight: 700; color: #1a1a1a; text-decoration: none; letter-spacing: -0.02em; }
        .nav-list { display: flex; gap: 2.5rem; list-style: none; }
        .nav-link { color: #1a1a1a; text-decoration: none; font-size: 0.85rem; font-weight: 500; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: #B4956F; }
        .nav-link-cta { color: #B4956F; }

        /* 포트폴리오 섹션 */
        .page-hero { padding: 160px 3rem 60px; text-align: center; background: #fcfcfc; }
        .page-hero h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; }
        .page-hero p { font-size: 1.1rem; color: #666; }
        .portfolio-section { max-width: 1400px; margin: 0 auto; padding: 40px 3rem 80px; }
        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 30px; }
        .portfolio-card { cursor: pointer; border-radius: 8px; overflow: hidden; }
        .portfolio-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; transition: 0.5s; }
        .portfolio-card:hover img { transform: scale(1.03); }
        .portfolio-card h3 { margin-top: 15px; font-size: 1rem; font-weight: 500; }

        /* 로딩 */
        .loading { text-align: center; padding: 60px; color: #888; }

        /* [핵심] 라이트박스 (림디자인 스타일) */
        .lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 3000; overflow-y: auto; padding-top: 80px; }
        .lightbox.show { display: block; }
        .lightbox-container { display: flex; max-width: 1400px; margin: 0 auto; padding: 4rem; gap: 60px; min-height: 100vh; }
        
        .lightbox-main { flex: 1.3; position: relative; background: #fbfbfb; height: 75vh; display: flex; align-items: center; justify-content: center; }
        .lightbox-main img { max-width: 100%; max-height: 100%; object-fit: contain; transition: opacity 0.5s; }
        
        .lightbox-sidebar { flex: 0.7; padding-top: 10px; }
        .lightbox-sidebar h2 { font-size: 1.8rem; font-weight: 400; margin-bottom: 40px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; border-top: 1px solid #eee; padding-top: 30px; }
        .info-item h4 { font-size: 0.75rem; color: #aaa; font-weight: 400; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
        .info-item p { font-size: 0.95rem; color: #333; }

        .lightbox-close { position: fixed; top: 30px; right: 40px; font-size: 3rem; border: none; background: none; cursor: pointer; z-index: 3100; font-weight: 100; color: #333; }
        .lightbox-close:hover { color: #B4956F; }
        .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 3rem; color: #ddd; cursor: pointer; padding: 20px; transition: 0.3s; }
        .nav-btn:hover { color: #B4956F; }

        /* 푸터 */
        .footer { background: #1a1a1a; color: #fff; padding: 60px 3rem; text-align: center; }
        .footer p { color: #888; font-size: 0.9rem; }
        .footer a { color: #B4956F; text-decoration: none; }
        
        @media (max-width: 1024px) { 
            .lightbox-container { flex-direction: column; } 
            .lightbox-sidebar { padding-left: 0; }
            .lightbox-main { height: 50vh; }
        }
        @media (max-width: 768px) {
            .header { padding: 1rem 1.5rem; }
            .nav-list { display: none; }
            .page-hero { padding: 120px 1.5rem 40px; }
            .page-hero h1 { font-size: 1.8rem; }
            .portfolio-section { padding: 30px 1.5rem 60px; }
            .portfolio-grid { grid-template-columns: 1fr; }
            .lightbox-container { padding: 2rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">DESIGN JIG</a>
            <nav>
                <ul class="nav-list">
                    <li><a href="columns.html" class="nav-link">COLUMNS</a></li>
                    <li><a href="portfolio.html" class="nav-link active">PORTFOLIO</a></li>
                    <li><a href="quote.html" class="nav-link nav-link-cta">ASK A QUOTE</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="page-hero">
            <h1>PORTFOLIO</h1>
            <p>디자인 지그가 완성한 공간들을 소개합니다</p>
        </section>
        
        <section class="portfolio-section">
            <div id="portfolioGrid" class="portfolio-grid">
                <div class="loading">데이터를 불러오는 중입니다...</div>
            </div>
        </section>
    </main>
    
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">×</button>
        <div class="lightbox-container">
            <div class="lightbox-main">
                <button class="nav-btn" style="left:0" onclick="changeImg(-1)">‹</button>
                <img id="lightboxImage" src="">
                <button class="nav-btn" style="right:0" onclick="changeImg(1)">›</button>
            </div>
            <div class="lightbox-sidebar">
                <h2 id="lightboxTitle"></h2>
                <div class="info-grid">
                    <div class="info-item"><h4>면적</h4><p id="specArea">-</p></div>
                    <div class="info-item"><h4>주거형태</h4><p id="specType">-</p></div>
                    <div class="info-item"><h4>바닥</h4><p id="specFloor">-</p></div>
                    <div class="info-item"><h4>가구</h4><p id="specFurniture">-</p></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>© 2024 디자인 지그. All rights reserved.</p>
        <p style="margin-top: 10px;">경기도 용인시 수지구 보정동 | <a href="tel:031-000-0000">031-000-0000</a></p>
    </footer>

    <script>
        let PORTFOLIO_DATA = [];
        let curIdx = 0;
        let imgIdx = 0;
        let slideTimer = null;

        // 로컬 테스트용 샘플 데이터
        const fallbackData = [{
            properties: {
                이름: { title: [{ plain_text: "반포 자이 거실 인테리어" }] },
                면적: { select: { name: "32py" } },
                카테고리: { select: { name: "거실 주방 욕실" } },
                바닥: { select: { name: "lx 에디톤" } },
                가구: { select: { name: "패트 제품" } },
                URL: { files: [
                    { external: { url: "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?auto=format&fit=crop&w=1200&q=80" } },
                    { external: { url: "https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?auto=format&fit=crop&w=1200&q=80" } }
                ]}
            }
        }];

        async function loadPortfolio() {
            try {
                // Vercel API 경로
                const res = await fetch('/api/portfolio');
                if (!res.ok) throw new Error("API Error");
                const data = await res.json();
                PORTFOLIO_DATA = data.results || data;
            } catch (error) {
                console.warn("로컬 테스트 모드 (Notion 연동 대기 중):", error.message);
                PORTFOLIO_DATA = fallbackData;
            }
            displayPortfolio();
        }

        function displayPortfolio() {
            const grid = document.getElementById('portfolioGrid');
            
            if (PORTFOLIO_DATA.length === 0) {
                grid.innerHTML = '<div class="loading">등록된 포트폴리오가 없습니다.</div>';
                return;
            }
            
            grid.innerHTML = PORTFOLIO_DATA.map((p, i) => {
                const imgUrl = p.properties.URL?.files?.[0]?.external?.url || 
                              p.properties.URL?.files?.[0]?.file?.url || "";
                const title = p.properties.이름?.title?.[0]?.plain_text || "Project";
                return `
                    <article class="portfolio-card" onclick="openLightbox(${i})">
                        <img src="${imgUrl}" alt="${title}" onerror="this.src='https://via.placeholder.com/600x600?text=Design+Jig'">
                        <h3>${title}</h3>
                    </article>
                `;
            }).join('');
        }

        function openLightbox(i) {
            curIdx = i; 
            imgIdx = 0;
            updateLightbox();
            document.getElementById('lightbox').classList.add('show');
            document.body.style.overflow = 'hidden';
            startAutoSlide();
        }

        function updateLightbox() {
            const p = PORTFOLIO_DATA[curIdx].properties;
            const images = p.URL?.files || [];
            
            const imgUrl = images[imgIdx]?.external?.url || images[imgIdx]?.file?.url || "";
            document.getElementById('lightboxImage').src = imgUrl;
            document.getElementById('lightboxTitle').textContent = p.이름?.title?.[0]?.plain_text || "-";
            
            // Notion 데이터 매핑
            document.getElementById('specArea').textContent = p.면적?.select?.name || "-";
            document.getElementById('specType').textContent = p.카테고리?.select?.name || "-";
            document.getElementById('specFloor').textContent = p.바닥?.select?.name || "-";
            document.getElementById('specFurniture').textContent = p.가구?.select?.name || "-";
        }

        function changeImg(dir) {
            const imgs = PORTFOLIO_DATA[curIdx].properties.URL?.files || [];
            if (imgs.length <= 1) return;
            imgIdx = (imgIdx + dir + imgs.length) % imgs.length;
            updateLightbox();
            startAutoSlide();
        }

        function startAutoSlide() {
            if (slideTimer) clearInterval(slideTimer);
            const imgs = PORTFOLIO_DATA[curIdx]?.properties?.URL?.files || [];
            if (imgs.length > 1) {
                slideTimer = setInterval(() => changeImg(1), 4000);
            }
        }

        function closeLightbox() {
            if (slideTimer) clearInterval(slideTimer);
            document.getElementById('lightbox').classList.remove('show');
            document.body.style.overflow = '';
        }

        // ESC 키, 방향키로 제어
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') changeImg(-1);
            if (e.key === 'ArrowRight') changeImg(1);
        });

        window.onload = loadPortfolio;
    </script>
</body>
</html>
